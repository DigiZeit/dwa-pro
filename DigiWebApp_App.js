DigiWebApp.Booking=M.Model.create({__name__:"Booking",modelVersion:M.Model.attr("String",{isRequired:NO}),fileName:M.Model.attr("String",{isRequired:NO}),fileType:M.Model.attr("String",{isRequired:NO}),orderId:M.Model.attr("String",{isRequired:NO}),orderName:M.Model.attr("String",{isRequired:NO}),timezoneOffset:M.Model.attr("String",{isRequired:NO}),timezone:M.Model.attr("String",{isRequired:NO}),timeStampStart:M.Model.attr("String",{isRequired:NO}),timeStampEnd:M.Model.attr("String",{isRequired:NO}),
date:M.Model.attr("String",{}),startTimeString:M.Model.attr("String",{isRequired:NO}),endeTimeString:M.Model.attr("String",{isRequired:NO}),startDateString:M.Model.attr("String",{isRequired:NO}),endeDateString:M.Model.attr("String",{isRequired:NO}),latitude:M.Model.attr("String",{isRequired:NO}),longitude:M.Model.attr("String",{isRequired:NO}),latitude_bis:M.Model.attr("String",{isRequired:NO}),longitude_bis:M.Model.attr("String",{isRequired:NO}),gpsLaengeVon:M.Model.attr("String",{isRequired:NO}),
gpsBreiteVon:M.Model.attr("String",{isRequired:NO}),gpsLaengeBis:M.Model.attr("String",{isRequired:NO}),gpsBreiteBis:M.Model.attr("String",{isRequired:NO}),handOrderId:M.Model.attr("String",{isRequired:NO}),handOrderName:M.Model.attr("String",{isRequired:NO}),handauftragsId:M.Model.attr("String",{isRequired:NO}),handauftragsBezeichnung:M.Model.attr("String",{isRequired:NO}),positionId:M.Model.attr("String",{isRequired:NO}),positionName:M.Model.attr("String",{isRequired:NO}),activityId:M.Model.attr("String",
{isRequired:NO}),activityName:M.Model.attr("String",{isRequired:NO}),isCurrent:M.Model.attr("Boolean",{isRequired:NO}),spesenAuswahl:M.Model.attr("String",{isRequired:NO}),uebernachtungAuswahl:M.Model.attr("String",{isRequired:NO}),gefahreneKilometer:M.Model.attr("Number",{isRequired:NO}),employees:M.Model.attr("String",{isRequired:NO}),mitarbeiterId:M.Model.attr("String",{isRequired:NO}),remark:M.Model.attr("String",{isRequired:NO}),unterschrift_hoehe:M.Model.attr("String",{isRequired:NO}),unterschrift_breite:M.Model.attr("String",
{isRequired:NO}),istFeierabend:M.Model.attr("Boolean",{isRequired:NO}),istKolonnenbuchung:M.Model.attr("Boolean",{isRequired:NO}),genauigkeitVon:M.Model.attr("String",{isRequired:NO}),gps_zeitstempelVon:M.Model.attr("String",{isRequired:NO}),ermittlungsverfahrenVon:M.Model.attr("String",{isRequired:NO}),genauigkeitBis:M.Model.attr("String",{isRequired:NO}),gps_zeitstempelBis:M.Model.attr("String",{isRequired:NO}),ermittlungsverfahrenBis:M.Model.attr("String",{isRequired:NO}),ServiceApp_Status:M.Model.attr("String",
{isRequired:NO}),closeBooking:function(a){try{this.set("timeStampEnd",DigiWebApp.BookingController.currentBookingTimesStampBook.getTime())}catch(b){this.set("timeStampEnd",(new Date).getTime())}var c=new Date(Number(this.get("timeStampEnd"))+6E4*((new Date).getTimezoneOffset()-this.get("timezoneOffset"))),d=M.Date.create(c.getTime());c=d.format("dd.mm.yyyy");d=d.format("HH:MM");this.set("endeDateString",c);this.set("endeTimeString",d);if(a){this.set("latitude_bis",a.latitude);this.set("longitude_bis",
a.longitude)}},setRemark:function(a){this.set("remark",a)},setAsCurrent:function(){this.set("isCurrent",YES)},removeAsCurrent:function(){this.set("isCurrent",NO)},deleteAll:function(){try{_.each(this.find(),function(b){if(b.hasFileName())try{b.deleteFile(function(){b.del()})}catch(c){b.del()}else b.del()})}catch(a){console.error(a)}},hasFileName:function(){return!this.get("fileName")||this.get("fileName")&&this.get("fileName").length===0?NO:YES},saveToFile:function(a,b,c){var d=this,f=new String(a);
if(!d.hasFileName()){d.set("fileName",d.__proto__.name+"_Signature_"+D8.now().getTimestamp());d.save()}if(typeof b!=="function"){console.error("saveToFileError: successCallback is not a function");return false}var e;e=!c||typeof c!=="function"?function(i){console.error("saveToFileError",i)}:c;if(typeof window.requestFileSystem==="undefined"){console.error("saveToFileError: no LocalFileSystem available");b("");return true}try{var g=DigiWebApp.ApplicationController.CONSTApplicationQuota;typeof navigator.webkitPersistentStorage!==
"undefined"?navigator.webkitPersistentStorage.requestQuota(g,function(i){window.requestFileSystem(PERSISTENT,i,function(j){j.root.getDirectory("DIGIWebAppData",{create:true,exclusive:false},function(l){l.getFile(d.get("fileName"),{create:true,exclusive:false},function(m){m.createWriter(function(n){n.onerror=function(p){console.error("writeError",p);e(p)};n.onwriteend=function(){n.onwriteend=function(p){b(p)};n.truncate(f.length)};var o=new Blob([f],{type:"text/plain"});n.write(o)},e)},e)},e)},e)},
function(i){console.error("Error while requesting Quota",i);DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("error"),message:M.I18N.l("errorWhileRequestingQuota")+": "+err})}):window.requestFileSystem(LocalFileSystem.PERSISTENT,0,function(i){i.root.getDirectory("DIGIWebAppData",{create:true,exclusive:false},function(j){j.getFile(d.get("fileName"),{create:true,exclusive:false},function(l){l.createWriter(function(m){m.onerror=function(n){console.error("writeError",n);e(n)};m.onwriteend=
function(){m.onwriteend=function(n){b(n)};m.truncate(f.length)};m.write(f.toString())},e)},e)},e)},e)}catch(h){e(h)}},readFromFile:function(a,b){var c=this,d;d=!b||typeof b!=="function"?function(g){console.error("readFromFileError",g)}:b;if(typeof a!=="function"){console.error("readFromFileError: successCallback is not a function");return false}if(!c.hasFileName()){console.error("readFromFileError: no fileName given");d();return false}if(typeof window.requestFileSystem==="undefined"){console.error("readFromFileError: no LocalFileSystem available");
a("");return true}try{var f=DigiWebApp.ApplicationController.CONSTApplicationQuota;typeof navigator.webkitPersistentStorage!=="undefined"?navigator.webkitPersistentStorage.requestQuota(f,function(g){window.requestFileSystem(PERSISTENT,g,function(h){h.root.getDirectory("DIGIWebAppData",{create:true,exclusive:false},function(i){i.getFile(c.get("fileName"),null,function(j){j.file(function(l){var m=new FileReader;m.onloadend=function(){a(this.result)};m.readAsText(l)},d)},d)},d)},d)},function(g){console.error("Error while requesting Quota",
g);DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("error"),message:M.I18N.l("errorWhileRequestingQuota")+": "+err})}):window.requestFileSystem(LocalFileSystem.PERSISTENT,0,function(g){g.root.getDirectory("DIGIWebAppData",{create:true,exclusive:false},function(h){h.getFile(c.get("fileName"),null,function(i){i.file(function(j){var l=new FileReader;l.onloadend=function(m){a(m.target.result)};l.readAsText(j)},d)},d)},d)},d)}catch(e){d(e)}},deleteFile:function(a,b){var c=this;if(!c.hasFileName()){console.error("deleteFileError: no fileName given");
return false}if(typeof a!=="function"){console.error("deleteFileError: successCallback is not a function");return false}var d;d=!b||typeof b!=="function"?function(g){console.error("deleteFileError",g)}:b;if(typeof window.requestFileSystem==="undefined"){console.error("deleteFileError: no LocalFileSystem available");a("");return true}try{var f=DigiWebApp.ApplicationController.CONSTApplicationQuota;typeof navigator.webkitPersistentStorage!=="undefined"?navigator.webkitPersistentStorage.requestQuota(f,
function(g){window.requestFileSystem(PERSISTENT,g,function(h){h.root.getDirectory("DIGIWebAppData",{create:true,exclusive:false},function(i){i.getFile(c.get("fileName"),null,function(j){j.remove(a,d)},d)},d)},d)},function(g){console.error("Error while requesting Quota",g);DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("error"),message:M.I18N.l("errorWhileRequestingQuota")+": "+err})}):window.requestFileSystem(LocalFileSystem.PERSISTENT,0,function(g){g.root.getDirectory("DIGIWebAppData",
{create:true,exclusive:false},function(h){h.getFile(c.get("fileName"),null,function(i){i.remove(a,d)},d)},d)},d)}catch(e){d(e)}}},M.DataProviderLocalStorage);
DigiWebApp.BautagebuchMediaFile=M.Model.create({__name__:"BautagebuchMediaFile",name:M.Model.attr("String",{isRequired:NO}),bautagesberichtId:M.Model.attr("String",{isRequired:NO}),positionId:M.Model.attr("String",{isRequired:NO}),positionName:M.Model.attr("String",{isRequired:NO}),activityId:M.Model.attr("String",{isRequired:NO}),activityName:M.Model.attr("String",{isRequired:NO}),fileName:M.Model.attr("String",{isRequired:NO}),fileType:M.Model.attr("String",{isRequired:YES}),timeStamp:M.Model.attr("String",
{isRequired:NO}),date:M.Model.attr("String",{}),icon:M.Model.attr("String",{isRequired:NO}),latitude:M.Model.attr("String",{isRequired:NO}),longitude:M.Model.attr("String",{isRequired:NO}),mitarbeiterId:M.Model.attr("String",{isRequired:NO}),remark:M.Model.attr("String",{isRequired:NO}),data:M.Model.attr("String",{isRequired:NO}),setRemark:function(a){this.set("remark",a)},writeError:M.Model.attr("Boolean",{isRequired:NO}),deleteAll:function(){_.each(this.find(),function(a){a.deleteSorted()})},hasFileName:function(){return!this.get("fileName")||
this.get("fileName")&&this.get("fileName").length===0?NO:YES},saveToFile:function(a,b,c){var d=this,f=new String(a);if(!d.hasFileName()){d.set("fileName",d.__proto__.name+"_"+D8.now().getTimestamp());d.save()}if(typeof b!=="function"){console.error("saveToFileError: successCallback is not a function");return false}var e;e=!c||typeof c!=="function"?function(i){console.error("saveToFileError",i)}:c;if(typeof window.requestFileSystem==="undefined"){console.error("saveToFileError: no LocalFileSystem available");
b("");return true}try{var g=DigiWebApp.ApplicationController.CONSTApplicationQuota;typeof navigator.webkitPersistentStorage!=="undefined"?navigator.webkitPersistentStorage.requestQuota(g,function(i){window.requestFileSystem(PERSISTENT,i,function(j){j.root.getDirectory("DIGIWebAppData",{create:true,exclusive:false},function(l){l.getFile(d.get("fileName"),{create:true,exclusive:false},function(m){m.createWriter(function(n){n.onerror=function(p){console.error("writeError",p);e(p)};n.onwriteend=function(){n.onwriteend=
function(p){b(p)};n.truncate(f.length)};var o=new Blob([f],{type:"text/plain"});n.write(o)},e)},e)},e)},e)},function(i){console.error("Error while requesting Quota",i);DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("error"),message:M.I18N.l("errorWhileRequestingQuota")+": "+err})}):window.requestFileSystem(LocalFileSystem.PERSISTENT,0,function(i){i.root.getDirectory("DIGIWebAppData",{create:true,exclusive:false},function(j){j.getFile(d.get("fileName"),{create:true,exclusive:false},
function(l){l.createWriter(function(m){m.onerror=function(n){console.error("writeError",n);e(n)};m.onwriteend=function(){m.onwriteend=function(n){b(n)};m.truncate(f.length)};m.write(f.toString())},e)},e)},e)},e)}catch(h){e(h)}},readFromFile:function(a,b){var c=this,d;d=!b||typeof b!=="function"?function(g){console.error("readFromFileError",g)}:b;if(typeof a!=="function"){console.error("readFromFileError: successCallback is not a function");return false}if(!c.hasFileName()){console.error("readFromFileError: no fileName given");
d();return false}if(typeof window.requestFileSystem==="undefined"){console.error("readFromFileError: no LocalFileSystem available");a("");return true}try{var f=DigiWebApp.ApplicationController.CONSTApplicationQuota;typeof navigator.webkitPersistentStorage!=="undefined"?navigator.webkitPersistentStorage.requestQuota(f,function(g){window.requestFileSystem(PERSISTENT,g,function(h){h.root.getDirectory("DIGIWebAppData",{create:true,exclusive:false},function(i){i.getFile(c.get("fileName"),null,function(j){j.file(function(l){var m=
new FileReader;m.onloadend=function(){a(this.result)};m.readAsText(l)},d)},d)},d)},d)},function(g){console.error("Error while requesting Quota",g);DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("error"),message:M.I18N.l("errorWhileRequestingQuota")+": "+err})}):window.requestFileSystem(LocalFileSystem.PERSISTENT,0,function(g){g.root.getDirectory("DIGIWebAppData",{create:true,exclusive:false},function(h){h.getFile(c.get("fileName"),null,function(i){i.file(function(j){var l=
new FileReader;l.onloadend=function(m){a(m.target.result)};l.readAsText(j)},d)},d)},d)},d)}catch(e){d(e)}},deleteFile:function(a,b){var c=this;if(!c.hasFileName()){console.error("deleteFileError: no fileName given");return false}if(typeof a!=="function"){console.error("deleteFileError: successCallback is not a function");return false}var d;d=!b||typeof b!=="function"?function(g){console.error("deleteFileError",g)}:b;if(typeof window.requestFileSystem==="undefined"){console.error("deleteFileError: no LocalFileSystem available");
a("");return true}try{var f=DigiWebApp.ApplicationController.CONSTApplicationQuota;typeof navigator.webkitPersistentStorage!=="undefined"?navigator.webkitPersistentStorage.requestQuota(f,function(g){window.requestFileSystem(PERSISTENT,g,function(h){h.root.getDirectory("DIGIWebAppData",{create:true,exclusive:false},function(i){i.getFile(c.get("fileName"),null,function(j){j.remove(a,d)},d)},d)},d)},function(g){console.error("Error while requesting Quota",g);DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("error"),
message:M.I18N.l("errorWhileRequestingQuota")+": "+err})}):window.requestFileSystem(LocalFileSystem.PERSISTENT,0,function(g){g.root.getDirectory("DIGIWebAppData",{create:true,exclusive:false},function(h){h.getFile(c.get("fileName"),null,function(i){i.remove(a,d)},d)},d)},d)}catch(e){d(e)}},deleteSorted:function(){var a=this,b=[],c=[];try{var d=localStorage.getItem(DigiWebApp.ApplicationController.storagePrefix+"_"+a.name.toLowerCase()+"Keys");if(d!==null)b=JSON.parse(d)}catch(f){console.error("ERROR in "+
a.name+".deleteSorted: "+f)}if(b){_.each(b,function(e){e!==a.m_id&&c.push(e)});localStorage.setItem(DigiWebApp.ApplicationController.storagePrefix+"_"+a.name.toLowerCase()+"Keys",JSON.stringify(c))}if(a.hasFileName())a.deleteFile(function(){return a.del()});else return a.del()},saveSorted:function(){var a=this;if(!a.save())return false;var b=[];try{var c=localStorage.getItem(DigiWebApp.ApplicationController.storagePrefix+"_"+a.name.toLowerCase()+"Keys");if(c!==null)b=JSON.parse(c)}catch(d){console.error("ERROR in "+
a.name+".saveSorted: "+d)}var f=NO;_.each(b,function(e){if(a.m_id===e)f=YES});f===NO&&b.push(a.m_id);localStorage.setItem(DigiWebApp.ApplicationController.storagePrefix+"_"+a.name.toLowerCase()+"Keys",JSON.stringify(b));return true},findSorted:function(a){var b=this,c=[];try{var d=localStorage.getItem(DigiWebApp.ApplicationController.storagePrefix+"_"+b.name.toLowerCase()+"Keys");if(d!==null)c=JSON.parse(d)}catch(f){console.error("ERROR in "+b.name+".findSorted: "+f)}var e=[];c&&_.each(c,function(g){g=
b.find({key:DigiWebApp.ApplicationController.storagePrefix+b.name+"_"+g});if(a&&g.get("bautagesberichtId")===a||typeof a==="undefined")e.push(g)});return e}},M.DataProviderLocalStorage);
DigiWebApp.HandOrder=M.Model.create({__name__:"HandOrder",id:M.Model.attr("String",{isRequired:NO}),name:M.Model.attr("String",{isRequired:NO}),isLocalOnly:M.Model.attr("Boolean",{isRequired:NO}),deleteAll:function(){var a=DigiWebApp.Booking.find(),b=_.detect(a,function(c){return c.get("isCurrent")===true});_.each(this.find(),function(c){if(b)c.get("id")===b.get("handOrderId")||c.get("name")===b.get("handOrderName")||c.del();else c.del()})},findSorted:function(){return this.find()}},M.DataProviderLocalStorage);
DigiWebApp.Zeitbuchungen=M.Model.create({__name__:"Zeitbuchungen",auftragsBezeichnung:M.Model.attr("String",{}),auftragsId:M.Model.attr("String",{}),bis:M.Model.attr("String",{}),datum:M.Model.attr("String",{}),dauer:M.Model.attr("String",{}),farbeAmpel:M.Model.attr("String",{}),gpsBreite:M.Model.attr("String",{}),gpsBreitePosition:M.Model.attr("String",{}),gpsLaenge:M.Model.attr("String",{}),gpsLaengePosition:M.Model.attr("String",{}),handauftragsBezeichnung:M.Model.attr("String",{}),handauftragsId:M.Model.attr("String",
{}),mitarbeiterId:M.Model.attr("String",{}),name:M.Model.attr("String",{}),nameVorname:M.Model.attr("String",{}),positionsBezeichnung:M.Model.attr("String",{}),positionsId:M.Model.attr("String",{}),taetigkeit:M.Model.attr("String",{}),taetigkeitsId:M.Model.attr("String",{}),taetigkeitsart:M.Model.attr("String",{}),von:M.Model.attr("String",{}),vorname:M.Model.attr("String",{}),remark:M.Model.attr("String",{})},M.DataConsumer.configure({appendRecords:NO,responsePath:"zeitbuchungen",url:function(a,
b){var c="http://"+DigiWebApp.RequestController.DatabaseServer+"/WebAppServices/zeitdaten?modus=0&firmenId="+DigiWebApp.SettingsController.getSetting("company")+"&kennwort="+DigiWebApp.SettingsController.getSetting("password")+"&geraeteId="+DigiWebApp.SettingsController.getSetting("workerId")+"&geraeteTyp=2&softwareVersion="+DigiWebApp.RequestController.softwareVersion+"&mitarbeiterId="+b+"&datum="+a+"&requestTimestamp="+M.Date.now().date.valueOf();DigiWebApp.ApplicationController.profilingIntervalVar===
null&&console.log("Zeitbuchungen: using "+c);return c},map:function(a){if(a===null)return{auftragsBezeichnung:null,auftragsId:null,bis:null,datum:null,dauer:null,farbeAmpel:null,gpsBreite:null,gpsBreitePosition:null,gpsLaenge:null,gpsLaengePosition:null,handauftragsBezeichnung:null,handauftragsId:null,mitarbeiterId:null,name:null,nameVorname:null,positionsBezeichnung:null,positionsId:null,taetigkeit:null,taetigkeitsId:null,taetigkeitsart:null,von:null,vorname:null,remark:null};return{auftragsBezeichnung:a.auftragsBezeichnung,
auftragsId:a.auftragsId,bis:a.bis,datum:a.datum,dauer:a.dauer,farbeAmpel:a.farbeAmpel,gpsBreite:a.gpsBreite,gpsBreitePosition:a.gpsBreitePosition,gpsLaenge:a.gpsLaenge,gpsLaengePosition:a.gpsLaengePosition,handauftragsBezeichnung:a.handauftragsBezeichnung,handauftragsId:a.handauftragsId,mitarbeiterId:a.mitarbeiterId,name:a.name,nameVorname:a.nameVorname,positionsBezeichnung:a.positionsBezeichnung,positionsId:a.positionsId,taetigkeit:a.taetigkeit,taetigkeitsId:a.taetigkeitsId,taetigkeitsart:a.taetigkeitsart,
von:a.von,vorname:a.vorname,remark:a.bemerkung}}}));DigiWebApp.WorkPlan=M.Model.create({__name__:"WorkPlan",id:M.Model.attr("String",{isRequired:NO}),workplanType:M.Model.attr("String",{isRequired:NO}),activityIds:M.Model.attr("String",{isRequired:NO}),activityPositions:M.Model.attr("String",{isRequired:NO}),deleteAll:function(){_.each(this.find(),function(a){a.del()})}},M.DataProviderLocalStorage);
DigiWebApp.MediaFile=M.Model.create({__name__:"MediaFile",name:M.Model.attr("String",{isRequired:NO}),fileName:M.Model.attr("String",{isRequired:NO}),fileType:M.Model.attr("String",{isRequired:YES}),timeStamp:M.Model.attr("String",{isRequired:NO}),date:M.Model.attr("String",{}),icon:M.Model.attr("String",{isRequired:NO}),orderId:M.Model.attr("String",{isRequired:NO}),orderName:M.Model.attr("String",{isRequired:NO}),positionId:M.Model.attr("String",{isRequired:NO}),positionName:M.Model.attr("String",
{isRequired:NO}),activityId:M.Model.attr("String",{isRequired:NO}),activityName:M.Model.attr("String",{isRequired:NO}),mitarbeiterId:M.Model.attr("String",{isRequired:NO}),handOrderName:M.Model.attr("String",{isRequired:NO}),handOrderId:M.Model.attr("String",{isRequired:NO}),latitude:M.Model.attr("String",{isRequired:NO}),longitude:M.Model.attr("String",{isRequired:NO}),remark:M.Model.attr("String",{isRequired:NO}),data:M.Model.attr("String",{isRequired:NO}),setRemark:function(a){this.set("remark",
a)},writeError:M.Model.attr("Boolean",{isRequired:NO}),deleteAll:function(a){var b=this.find().length,c=0,d=function(f){f.del();c+=1;c===b&&a()};_.each(this.find(),function(f){f.hasFileName()?f.deleteFile(function(){d(f)},function(){d(f)}):d(f)})},hasFileName:function(){return!this.get("fileName")||this.get("fileName")&&this.get("fileName").length===0?NO:YES},saveToFile:function(a,b,c){var d=this,f=new String(a);if(!d.hasFileName()){d.set("fileName",d.__proto__.name+"_"+D8.now().getTimestamp());d.save()}if(typeof b!==
"function"){console.error("saveToFileError: successCallback is not a function");return false}var e;e=!c||typeof c!=="function"?function(i){console.error("saveToFileError",i)}:c;if(typeof window.requestFileSystem==="undefined"){console.error("saveToFileError: no LocalFileSystem available");b("");return true}try{var g=DigiWebApp.ApplicationController.CONSTApplicationQuota;typeof navigator.webkitPersistentStorage!=="undefined"?navigator.webkitPersistentStorage.requestQuota(g,function(i){window.requestFileSystem(PERSISTENT,
i,function(j){j.root.getDirectory("DIGIWebAppData",{create:true,exclusive:false},function(l){l.getFile(d.get("fileName"),{create:true,exclusive:false},function(m){m.createWriter(function(n){n.onerror=function(p){console.error("writeError",p);e(p)};n.onwriteend=function(){n.onwriteend=function(p){b(p)};n.truncate(f.length)};var o=new Blob([f],{type:"text/plain"});n.write(o)},e)},e)},e)},e)},function(i){console.error("Error while requesting Quota",i);DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("error"),
message:M.I18N.l("errorWhileRequestingQuota")+": "+err})}):window.requestFileSystem(LocalFileSystem.PERSISTENT,0,function(i){i.root.getDirectory("DIGIWebAppData",{create:true,exclusive:false},function(j){j.getFile(d.get("fileName"),{create:true,exclusive:false},function(l){l.createWriter(function(m){m.onerror=function(n){console.error("writeError",n);e(n)};m.onwriteend=function(){m.onwriteend=function(n){b(n)};m.truncate(f.length)};m.write(f.toString())},e)},e)},e)},e)}catch(h){e(h)}},readFromFile:function(a,
b){var c=this;if(!c.hasFileName()){console.error("readFromFileError: no fileName given");return false}if(typeof a!=="function"){console.error("readFromFileError: successCallback is not a function");return false}var d;d=!b||typeof b!=="function"?function(g){console.error("readFromFileError",g)}:b;if(typeof window.requestFileSystem==="undefined"){console.error("readFromFileError: no LocalFileSystem available");a("");return true}try{var f=DigiWebApp.ApplicationController.CONSTApplicationQuota;typeof navigator.webkitPersistentStorage!==
"undefined"?navigator.webkitPersistentStorage.requestQuota(f,function(g){window.requestFileSystem(PERSISTENT,g,function(h){h.root.getDirectory("DIGIWebAppData",{create:true,exclusive:false},function(i){i.getFile(c.get("fileName"),null,function(j){j.file(function(l){var m=new FileReader;m.onloadend=function(){a(this.result)};m.readAsText(l)},d)},d)},d)},d)},function(g){console.error("Error while requesting Quota",g);DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("error"),message:M.I18N.l("errorWhileRequestingQuota")+
": "+err})}):window.requestFileSystem(LocalFileSystem.PERSISTENT,0,function(g){g.root.getDirectory("DIGIWebAppData",{create:true,exclusive:false},function(h){h.getFile(c.get("fileName"),null,function(i){i.file(function(j){var l=new FileReader;l.onloadend=function(m){a(m.target.result)};l.readAsText(j)},d)},d)},d)},d)}catch(e){d(e)}},deleteFile:function(a,b){var c=this;if(!c.hasFileName()){console.error("deleteFileError: no fileName given");return false}if(typeof a!=="function"){console.error("deleteFileError: successCallback is not a function");
return false}var d;d=!b||typeof b!=="function"?function(g){console.error("deleteFileError",g)}:b;if(typeof window.requestFileSystem==="undefined"){console.error("deleteFileError: no LocalFileSystem available");a("");return true}try{var f=DigiWebApp.ApplicationController.CONSTApplicationQuota;typeof navigator.webkitPersistentStorage!=="undefined"?navigator.webkitPersistentStorage.requestQuota(f,function(g){window.requestFileSystem(PERSISTENT,g,function(h){h.root.getDirectory("DIGIWebAppData",{create:true,
exclusive:false},function(i){i.getFile(c.get("fileName"),null,function(j){j.remove(a,d)},d)},d)},d)},function(g){console.error("Error while requesting Quota",g);DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("error"),message:M.I18N.l("errorWhileRequestingQuota")+": "+err})}):window.requestFileSystem(LocalFileSystem.PERSISTENT,0,function(g){g.root.getDirectory("DIGIWebAppData",{create:true,exclusive:false},function(h){h.getFile(c.get("fileName"),null,function(i){i.remove(a,
d)},d)},d)},d)}catch(e){d(e)}}},M.DataProviderLocalStorage);
DigiWebApp.UebernachtungAuswahlOption=M.Model.create({__name__:"UebernachtungAuswahlOption",id:M.Model.attr("String",{isRequired:NO}),beschreibung:M.Model.attr("String",{isRequired:NO}),deleteAll:function(){_.each(this.find(),function(a){a.deleteSorted()})},deleteSorted:function(){var a=this,b=[],c=[];try{var d=localStorage.getItem(DigiWebApp.ApplicationController.storagePrefix+"_"+a.name.toLowerCase()+"Keys");if(d!==null)b=JSON.parse(d)}catch(f){console.error("ERROR in "+a.name+".deleteSorted: "+
f)}if(b){_.each(b,function(e){e!==a.m_id&&c.push(e)});localStorage.setItem(DigiWebApp.ApplicationController.storagePrefix+"_"+a.name.toLowerCase()+"Keys",JSON.stringify(c))}return a.del()},saveSorted:function(){var a=this;if(!a.save())return false;var b=[];try{var c=localStorage.getItem(DigiWebApp.ApplicationController.storagePrefix+"_"+a.name.toLowerCase()+"Keys");if(c!==null)b=JSON.parse(c)}catch(d){console.error("ERROR in "+a.name+".saveSorted: "+d)}var f=NO;_.each(b,function(e){if(a.m_id===e)f=
YES});f===NO&&b.push(a.m_id);localStorage.setItem(DigiWebApp.ApplicationController.storagePrefix+"_"+a.name.toLowerCase()+"Keys",JSON.stringify(b));return true},findSorted:function(){var a=this,b=[];try{var c=localStorage.getItem(DigiWebApp.ApplicationController.storagePrefix+"_"+a.name.toLowerCase()+"Keys");if(c!==null)b=JSON.parse(c)}catch(d){console.error("ERROR in "+a.name+".findSorted: "+d)}var f=[];b&&_.each(b,function(e){e=a.find({key:DigiWebApp.ApplicationController.storagePrefix+a.name+"_"+
e});f.push(e)});return f}},M.DataProviderLocalStorage);
DigiWebApp.SentBooking=M.Model.create({__name__:"SentBooking",fileName:M.Model.attr("String",{isRequired:NO}),fileType:M.Model.attr("String",{isRequired:NO}),orderId:M.Model.attr("String",{isRequired:NO}),orderName:M.Model.attr("String",{isRequired:NO}),timezoneOffset:M.Model.attr("String",{isRequired:NO}),timezone:M.Model.attr("String",{isRequired:NO}),timeStampStart:M.Model.attr("String",{isRequired:NO}),timeStampEnd:M.Model.attr("String",{isRequired:NO}),date:M.Model.attr("String",{}),startTimeString:M.Model.attr("String",
{isRequired:NO}),endeTimeString:M.Model.attr("String",{isRequired:NO}),startDateString:M.Model.attr("String",{isRequired:NO}),endeDateString:M.Model.attr("String",{isRequired:NO}),latitude:M.Model.attr("String",{isRequired:NO}),longitude:M.Model.attr("String",{isRequired:NO}),latitude_bis:M.Model.attr("String",{isRequired:NO}),longitude_bis:M.Model.attr("String",{isRequired:NO}),gpsLaengeVon:M.Model.attr("String",{isRequired:NO}),gpsBreiteVon:M.Model.attr("String",{isRequired:NO}),gpsLaengeBis:M.Model.attr("String",
{isRequired:NO}),gpsBreiteBis:M.Model.attr("String",{isRequired:NO}),handOrderName:M.Model.attr("String",{isRequired:NO}),handOrderId:M.Model.attr("String",{isRequired:NO}),positionId:M.Model.attr("String",{isRequired:NO}),positionName:M.Model.attr("String",{isRequired:NO}),activityId:M.Model.attr("String",{isRequired:NO}),activityName:M.Model.attr("String",{isRequired:NO}),isCurrent:M.Model.attr("Boolean",{isRequired:NO}),spesenAuswahl:M.Model.attr("String",{isRequired:NO}),uebernachtungAuswahl:M.Model.attr("String",
{isRequired:NO}),gefahreneKilometer:M.Model.attr("Number",{isRequired:NO}),employees:M.Model.attr("String",{isRequired:NO}),mitarbeiterId:M.Model.attr("String",{isRequired:NO}),remark:M.Model.attr("String",{isRequired:NO}),istFeierabend:M.Model.attr("Boolean",{isRequired:NO}),istKolonnenbuchung:M.Model.attr("Boolean",{isRequired:NO}),genauigkeitVon:M.Model.attr("String",{isRequired:NO}),gps_zeitstempelVon:M.Model.attr("String",{isRequired:NO}),ermittlungsverfahrenVon:M.Model.attr("String",{isRequired:NO}),
genauigkeitBis:M.Model.attr("String",{isRequired:NO}),gps_zeitstempelBis:M.Model.attr("String",{isRequired:NO}),ermittlungsverfahrenBis:M.Model.attr("String",{isRequired:NO}),ServiceApp_Status:M.Model.attr("String",{isRequired:NO}),closeBooking:function(){this.set("timeStampEnd",+new Date)},setRemark:function(a){this.set("remark",a)},setAsCurrent:function(){this.set("isCurrent",YES)},removeAsCurrent:function(){this.set("isCurrent",NO)},deleteAll:function(){_.each(this.find(),function(a){a.del()})}},
M.DataProviderLocalStorage);
DigiWebApp.Settings=M.Model.create({__name__:"Settings",debug:M.Model.attr("Boolean"),settingsPassword:M.Model.attr("String"),treatAllAsTablet:M.Model.attr("Boolean"),treatAllAsPhone:M.Model.attr("Boolean"),company:M.Model.attr("String"),password:M.Model.attr("String"),connectionCode:M.Model.attr("String"),workerId:M.Model.attr("String"),timeouthappened:M.Model.attr("String"),skipEvents:M.Model.attr("String"),platform:M.Model.attr("String"),userAgent:M.Model.attr("String"),mapType:M.Model.attr("String"),
autoTransferAfterBookTime:M.Model.attr("Boolean"),autoTransferAfterClosingDay:M.Model.attr("Boolean"),autoSyncAfterBookTime:M.Model.attr("Boolean"),autoSaveGPSData:M.Model.attr("Boolean"),GPSDataIsMandatory:M.Model.attr("Boolean"),remarkIsMandatory:M.Model.attr("Boolean"),remarkIsOptional:M.Model.attr("Boolean"),useTransitionsSetting:M.Model.attr("Boolean"),daysToHoldBookingsOnDevice:M.Model.attr("String"),bautagebuchLimit_autoStartUhrzeit:M.Model.attr("Boolean"),datatransfer_min_delay:M.Model.attr("String"),
branding:M.Model.attr("String"),GPSTimeOut:M.Model.attr("Integer"),silentLoader:M.Model.attr("Boolean"),ServiceApp_ermittleGeokoordinate:M.Model.attr("Boolean"),ServiceApp_datenUebertragen:M.Model.attr("Boolean"),ServiceApp_engeKopplung:M.Model.attr("Boolean"),ServiceApp_PORT:M.Model.attr("String"),ServiceApp_FallBack:M.Model.attr("Boolean"),currentTimezoneOffset:M.Model.attr("String"),currentTimezone:M.Model.attr("String"),debugDatabaseServer:M.Model.attr("String"),mitarbeiterVorname:M.Model.attr("String"),
mitarbeiterNachname:M.Model.attr("String"),mitarbeiterId:M.Model.attr("String"),auftragsDetailsKoppeln:M.Model.attr("Boolean"),detailierteZeitdaten:M.Model.attr("Boolean"),vibrationsDauer:M.Model.attr("String")},M.DataProviderLocalStorage);
DigiWebApp.BautagebuchMengeneinheit=M.Model.create({__name__:"BautagebuchMengeneinheit",id:M.Model.attr("Number",{isRequired:NO}),bezeichnung:M.Model.attr("String",{isRequired:NO}),kuerzel:M.Model.attr("String",{isRequired:NO}),deleteAll:function(){_.each(this.find(),function(a){a.deleteSorted()})},deleteSorted:function(){var a=this,b=[],c=[];try{var d=localStorage.getItem(DigiWebApp.ApplicationController.storagePrefix+"_"+a.name.toLowerCase()+"Keys");if(d!==null)b=JSON.parse(d)}catch(f){console.error("ERROR in "+
a.name+".deleteSorted: "+f)}if(b){_.each(b,function(e){e!==a.m_id&&c.push(e)});localStorage.setItem(DigiWebApp.ApplicationController.storagePrefix+"_"+a.name.toLowerCase()+"Keys",JSON.stringify(c))}return a.del()},saveSorted:function(){var a=this;if(!a.save())return false;var b=[];try{var c=localStorage.getItem(DigiWebApp.ApplicationController.storagePrefix+"_"+a.name.toLowerCase()+"Keys");if(c!==null)b=JSON.parse(c)}catch(d){console.error("ERROR in "+a.name+".saveSorted: "+d)}var f=NO;_.each(b,function(e){if(a.m_id===
e)f=YES});f===NO&&b.push(a.m_id);localStorage.setItem(DigiWebApp.ApplicationController.storagePrefix+"_"+a.name.toLowerCase()+"Keys",JSON.stringify(b));return true},findSorted:function(a){var b=this,c=[];try{var d=localStorage.getItem(DigiWebApp.ApplicationController.storagePrefix+"_"+b.name.toLowerCase()+"Keys");if(d!==null)c=JSON.parse(d)}catch(f){console.error("ERROR in "+b.name+".findSorted: "+f)}var e=[];c&&_.each(c,function(g){g=b.find({key:DigiWebApp.ApplicationController.storagePrefix+b.name+
"_"+g});if(a&&g.get("id")===a||typeof a==="undefined")e.push(g)});return e}},M.DataProviderLocalStorage);
DigiWebApp.BautagebuchProjektleiter=M.Model.create({__name__:"BautagebuchProjektleiter",id:M.Model.attr("Number",{isRequired:NO}),vorname:M.Model.attr("String",{isRequired:NO}),nachname:M.Model.attr("String",{isRequired:NO}),vollername:function(){return this.get("vorname")+" "+this.get("nachname")},deleteAll:function(){_.each(this.find(),function(a){a.deleteSorted()})},deleteSorted:function(){var a=this,b=[],c=[];try{var d=localStorage.getItem(DigiWebApp.ApplicationController.storagePrefix+"_"+a.name.toLowerCase()+
"Keys");if(d!==null)b=JSON.parse(d)}catch(f){console.error("ERROR in "+a.name+".deleteSorted: "+f)}if(b){_.each(b,function(e){e!==a.m_id&&c.push(e)});localStorage.setItem(DigiWebApp.ApplicationController.storagePrefix+"_"+a.name.toLowerCase()+"Keys",JSON.stringify(c))}return a.del()},saveSorted:function(){var a=this;if(!a.save())return false;var b=[];try{var c=localStorage.getItem(DigiWebApp.ApplicationController.storagePrefix+"_"+a.name.toLowerCase()+"Keys");if(c!==null)b=JSON.parse(c)}catch(d){console.error("ERROR in "+
a.name+".saveSorted: "+d)}var f=NO;_.each(b,function(e){if(a.m_id===e)f=YES});f===NO&&b.push(a.m_id);localStorage.setItem(DigiWebApp.ApplicationController.storagePrefix+"_"+a.name.toLowerCase()+"Keys",JSON.stringify(b));return true},findSorted:function(){var a=this,b=[];try{var c=localStorage.getItem(DigiWebApp.ApplicationController.storagePrefix+"_"+a.name.toLowerCase()+"Keys");if(c!==null)b=JSON.parse(c)}catch(d){console.error("ERROR in "+a.name+".findSorted: "+d)}var f=[];b&&_.each(b,function(e){f.push(a.find({key:DigiWebApp.ApplicationController.storagePrefix+
a.name+"_"+e}))});return f}},M.DataProviderLocalStorage);
DigiWebApp.Order=M.Model.create({__name__:"Order",id:M.Model.attr("String",{isRequired:NO}),name:M.Model.attr("String",{isRequired:NO}),deleteAll:function(){_.each(this.find(),function(a){a.del()})},findSorted:function(){var a=this,b=[];try{b=JSON.parse(localStorage.getItem(DigiWebApp.ApplicationController.storagePrefix+"_"+this.name.toLowerCase()+"Keys"))}catch(c){console.error("ERROR in findSorted: "+c)}var d=[];b&&_.each(b,function(f){d.push(a.find({key:M.LOCAL_STORAGE_PREFIX+M.Application.name+
M.LOCAL_STORAGE_SUFFIX+a.name+"_"+f}))});return d}},M.DataProviderLocalStorage);
DigiWebApp.Activity=M.Model.create({__name__:"Activity",id:M.Model.attr("String",{isRequired:NO}),name:M.Model.attr("String",{isRequired:NO}),istStandardPause:M.Model.attr("Boolean",{isRequired:NO}),istUnterschriftsAbnahme:M.Model.attr("Boolean",{isRequired:NO}),istFahrzeitRelevant:M.Model.attr("Boolean",{isRequired:NO}),positionId:M.Model.attr("String",{isRequired:NO}),deleteAll:function(){_.each(this.find(),function(a){a.del()});localStorage.removeItem(DigiWebApp.ApplicationController.storagePrefix+
"_"+this.name.toLowerCase()+"Keys")},findById:function(a){var b=null;$.each(this.find(),function(c,d){if(parseInt(a)===parseInt(d.get("id"))){b=d;return false}return true});return b},findSorted:function(){var a=this,b=[];try{b=JSON.parse(localStorage.getItem(DigiWebApp.ApplicationController.storagePrefix+"_"+this.name.toLowerCase()+"Keys"))}catch(c){console.error("ERROR in findSorted: "+c)}var d=[];b&&_.each(b,function(f){d.push(a.find({key:M.LOCAL_STORAGE_PREFIX+M.Application.name+M.LOCAL_STORAGE_SUFFIX+
a.name+"_"+f}))});return d},saveSorted:function(){var a=this;if(!a.save())return false;var b=[];try{var c=localStorage.getItem(DigiWebApp.ApplicationController.storagePrefix+"_"+a.name.toLowerCase()+"Keys");if(c!==null)b=JSON.parse(c)}catch(d){console.error("ERROR in "+a.name+".saveSorted: "+d)}var f=NO;_.each(b,function(e){if(a.m_id===e)f=YES});f===NO&&b.push(a.m_id);localStorage.setItem(DigiWebApp.ApplicationController.storagePrefix+"_"+a.name.toLowerCase()+"Keys",JSON.stringify(b));return true}},
M.DataProviderLocalStorage);
DigiWebApp.Position=M.Model.create({__name__:"Position",id:M.Model.attr("String",{isRequired:NO}),name:M.Model.attr("String",{isRequired:NO}),strasse:M.Model.attr("String",{isRequired:NO}),hausnummer:M.Model.attr("String",{isRequired:NO}),plz:M.Model.attr("String",{isRequired:NO}),ort:M.Model.attr("String",{isRequired:NO}),land:M.Model.attr("String",{isRequired:NO}),countrycode:M.Model.attr("String",{isRequired:NO}),telefon:M.Model.attr("String",{isRequired:NO}),fax:M.Model.attr("String",{isRequired:NO}),
email:M.Model.attr("String",{isRequired:NO}),ansprechpartner:M.Model.attr("String",{isRequired:NO}),kundenname:M.Model.attr("String",{isRequired:NO}),longitude:M.Model.attr("String",{isRequired:NO}),latitude:M.Model.attr("String",{isRequired:NO}),description:M.Model.attr("String",{isRequired:NO}),orderId:M.Model.attr("String",{isRequired:NO}),deleteAll:function(){_.each(this.find(),function(a){a.del()})},findSorted:function(){var a=this,b=[];try{b=JSON.parse(localStorage.getItem(DigiWebApp.ApplicationController.storagePrefix+
"_"+this.name.toLowerCase()+"Keys"))}catch(c){console.error("ERROR in findSorted: "+c)}var d=[];b&&_.each(b,function(f){d.push(a.find({key:M.LOCAL_STORAGE_PREFIX+M.Application.name+M.LOCAL_STORAGE_SUFFIX+a.name+"_"+f}))});return d}},M.DataProviderLocalStorage);
DigiWebApp.OnlinePosition=M.Model.create({__name__:"OnlinePosition",positionsId:M.Model.attr("String",{isRequired:NO}),auftragsBezeichnung:M.Model.attr("String",{isRequired:NO}),positionsBezeichnung:M.Model.attr("String",{isRequired:NO}),strasse:M.Model.attr("String",{isRequired:NO}),hausnummer:M.Model.attr("String",{isRequired:NO}),plz:M.Model.attr("String",{isRequired:NO}),ort:M.Model.attr("String",{isRequired:NO}),land:M.Model.attr("String",{isRequired:NO}),countrycode:M.Model.attr("String",{isRequired:NO}),
telefon:M.Model.attr("String",{isRequired:NO}),fax:M.Model.attr("String",{isRequired:NO}),email:M.Model.attr("String",{isRequired:NO}),ansprechpartner:M.Model.attr("String",{isRequired:NO}),kundenname:M.Model.attr("String",{isRequired:NO}),longitude:M.Model.attr("String",{isRequired:NO}),latitude:M.Model.attr("String",{isRequired:NO}),positionsBeschreibung:M.Model.attr("String",{isRequired:NO}),orderId:M.Model.attr("String",{isRequired:NO}),deleteAll:function(){_.each(this.find(),function(a){a.del()})}},
M.DataConsumer.configure({appendRecords:NO,responsePath:"positionen",url:function(){var a=DigiWebApp.ZeitbuchungenController.itemForDetails.get("positionsId");a="http://"+DigiWebApp.RequestController.DatabaseServer+"/WebAppServices/positionen?modus=0&firmenId="+DigiWebApp.SettingsController.getSetting("company")+"&kennwort="+DigiWebApp.SettingsController.getSetting("password")+"&geraeteId="+DigiWebApp.SettingsController.getSetting("workerId")+"&geraeteTyp=2&softwareVersion="+DigiWebApp.RequestController.softwareVersion+
"&positionsId="+a+"&requestTimestamp="+M.Date.now().date.valueOf();DigiWebApp.ApplicationController.profilingIntervalVar===null&&console.log("Positionen: using "+a);return a},map:function(a){if(a===null)return{positionsId:null,positionsBezeichnung:null,strasse:null,hausnummer:null,plz:null,ort:null,land:null,countrycode:null,telefon:null,fax:null,email:null,ansprechpartner:null,kundenname:null,longitude:null,latitude:null,positionsBeschreibung:null,orderId:null,auftragsBezeichnung:null};return{positionsId:a.positionsId,
positionsBezeichnung:a.positionsBezeichnung,strasse:a.strasse,hausnummer:a.hausnummer,plz:a.plz,ort:a.ort,land:a.land,countrycode:a.countrycode,telefon:a.telefon,fax:a.fax,email:a.email,ansprechpartner:a.ansprechpartner,kundenname:a.kundenname,longitude:a.longitude,latitude:a.latitude,positionsBeschreibung:a.positionsBeschreibung,orderId:a.orderId,auftragsBezeichnung:a.auftragsBezeichnung}}}));
DigiWebApp.SentBookingArchived=M.Model.create({__name__:"SentBookingArchived",fileName:M.Model.attr("String",{isRequired:NO}),fileType:M.Model.attr("String",{isRequired:NO}),orderId:M.Model.attr("String",{isRequired:NO}),orderName:M.Model.attr("String",{isRequired:NO}),timezoneOffset:M.Model.attr("String",{isRequired:NO}),timezone:M.Model.attr("String",{isRequired:NO}),timeStampStart:M.Model.attr("String",{isRequired:NO}),timeStampEnd:M.Model.attr("String",{isRequired:NO}),tagLabel:M.Model.attr("String",
{isRequired:NO}),date:M.Model.attr("String",{}),startTimeString:M.Model.attr("String",{isRequired:NO}),endeTimeString:M.Model.attr("String",{isRequired:NO}),startDateString:M.Model.attr("String",{isRequired:NO}),endeDateString:M.Model.attr("String",{isRequired:NO}),latitude:M.Model.attr("String",{isRequired:NO}),longitude:M.Model.attr("String",{isRequired:NO}),latitude_bis:M.Model.attr("String",{isRequired:NO}),longitude_bis:M.Model.attr("String",{isRequired:NO}),gpsLaengeVon:M.Model.attr("String",
{isRequired:NO}),gpsBreiteVon:M.Model.attr("String",{isRequired:NO}),gpsLaengeBis:M.Model.attr("String",{isRequired:NO}),gpsBreiteBis:M.Model.attr("String",{isRequired:NO}),handOrderName:M.Model.attr("String",{isRequired:NO}),handOrderId:M.Model.attr("String",{isRequired:NO}),positionId:M.Model.attr("String",{isRequired:NO}),positionName:M.Model.attr("String",{isRequired:NO}),activityId:M.Model.attr("String",{isRequired:NO}),activityName:M.Model.attr("String",{isRequired:NO}),isCurrent:M.Model.attr("Boolean",
{isRequired:NO}),spesenAuswahl:M.Model.attr("String",{isRequired:NO}),uebernachtungAuswahl:M.Model.attr("String",{isRequired:NO}),gefahreneKilometer:M.Model.attr("Number",{isRequired:NO}),employees:M.Model.attr("String",{isRequired:NO}),mitarbeiterId:M.Model.attr("String",{isRequired:NO}),remark:M.Model.attr("String",{isRequired:NO}),istFeierabend:M.Model.attr("Boolean",{isRequired:NO}),istKolonnenbuchung:M.Model.attr("Boolean",{isRequired:NO}),genauigkeitVon:M.Model.attr("String",{isRequired:NO}),
gps_zeitstempelVon:M.Model.attr("String",{isRequired:NO}),ermittlungsverfahrenVon:M.Model.attr("String",{isRequired:NO}),genauigkeitBis:M.Model.attr("String",{isRequired:NO}),gps_zeitstempelBis:M.Model.attr("String",{isRequired:NO}),ermittlungsverfahrenBis:M.Model.attr("String",{isRequired:NO}),ServiceApp_Status:M.Model.attr("String",{isRequired:NO}),closeBooking:function(){this.set("timeStampEnd",+new Date)},setRemark:function(a){this.set("remark",a)},setAsCurrent:function(){this.set("isCurrent",
YES)},removeAsCurrent:function(){this.set("isCurrent",NO)},deleteAll:function(){_.each(this.find(),function(a){a.del()})},deleteOld:function(){var a=0;try{a=0+new Number(DigiWebApp.SettingsController.getSetting("daysToHoldBookingsOnDevice"))}catch(b){a=DigiWebApp.SettingsController.defaultsettings.get("daysToHoldBookingsOnDevice")}var c=D8.create(D8.now().format("dd.mm.yyyy")).addDays(-a).getTimestamp();_.each(this.find(),function(d){D8.create(d.get("timeStampStart")).getTimestamp()<c&&d.del()})}},
M.DataProviderLocalStorage);
DigiWebApp.BautagebuchNotiz=M.Model.create({__name__:"BautagebuchNotiz",bautagesberichtId:M.Model.attr("String",{isRequired:NO}),data:M.Model.attr("String",{isRequired:NO}),positionId:M.Model.attr("String",{isRequired:NO}),positionName:M.Model.attr("String",{isRequired:NO}),activityId:M.Model.attr("String",{isRequired:NO}),activityName:M.Model.attr("String",{isRequired:NO}),deleteAll:function(){_.each(this.find(),function(a){a.deleteSorted()})},deleteSorted:function(){var a=this,b=[],c=[];try{var d=
localStorage.getItem(DigiWebApp.ApplicationController.storagePrefix+"_"+a.name.toLowerCase()+"Keys");if(d!==null)b=JSON.parse(d)}catch(f){console.error("ERROR in "+a.name+".deleteSorted: "+f)}if(b){_.each(b,function(e){e!==a.m_id&&c.push(e)});localStorage.setItem(DigiWebApp.ApplicationController.storagePrefix+"_"+a.name.toLowerCase()+"Keys",JSON.stringify(c))}return a.del()},saveSorted:function(){var a=this;if(!a.save())return false;var b=[];try{var c=localStorage.getItem(DigiWebApp.ApplicationController.storagePrefix+
"_"+a.name.toLowerCase()+"Keys");if(c!==null)b=JSON.parse(c)}catch(d){console.error("ERROR in "+a.name+".saveSorted: "+d)}var f=NO;_.each(b,function(e){if(a.m_id===e)f=YES});f===NO&&b.push(a.m_id);localStorage.setItem(DigiWebApp.ApplicationController.storagePrefix+"_"+a.name.toLowerCase()+"Keys",JSON.stringify(b));return true},findSorted:function(a){var b=this,c=[];try{var d=localStorage.getItem(DigiWebApp.ApplicationController.storagePrefix+"_"+b.name.toLowerCase()+"Keys");if(d!==null)c=JSON.parse(d)}catch(f){console.error("ERROR in "+
b.name+".findSorted: "+f)}var e=[];c&&_.each(c,function(g){g=b.find({key:DigiWebApp.ApplicationController.storagePrefix+b.name+"_"+g});if(a&&g.get("bautagesberichtId")===a||typeof a==="undefined")e.push(g)});return e}},M.DataProviderLocalStorage);
DigiWebApp.Features=M.Model.create({__name__:"Features",id:M.Model.attr("String",{isRequired:NO}),name:M.Model.attr("String",{isRequired:NO}),isAvailable:M.Model.attr("Boolean",{isRequired:NO}),deleteAll:function(){_.each(this.find(),function(a){a.del()})}},M.DataProviderLocalStorage);
DigiWebApp.SpesenAuswahlOption=M.Model.create({__name__:"SpesenAuswahlOption",id:M.Model.attr("String",{isRequired:NO}),beschreibung:M.Model.attr("String",{isRequired:NO}),deleteAll:function(){_.each(this.find(),function(a){a.deleteSorted()})},deleteSorted:function(){var a=this,b=[],c=[];try{var d=localStorage.getItem(DigiWebApp.ApplicationController.storagePrefix+"_"+a.name.toLowerCase()+"Keys");if(d!==null)b=JSON.parse(d)}catch(f){console.error("ERROR in "+a.name+".deleteSorted: "+f)}if(b){_.each(b,
function(e){e!==a.m_id&&c.push(e)});localStorage.setItem(DigiWebApp.ApplicationController.storagePrefix+"_"+a.name.toLowerCase()+"Keys",JSON.stringify(c))}return a.del()},saveSorted:function(){var a=this;if(!a.save())return false;var b=[];try{var c=localStorage.getItem(DigiWebApp.ApplicationController.storagePrefix+"_"+a.name.toLowerCase()+"Keys");if(c!==null)b=JSON.parse(c)}catch(d){console.error("ERROR in "+a.name+".saveSorted: "+d)}var f=NO;_.each(b,function(e){if(a.m_id===e)f=YES});f===NO&&b.push(a.m_id);
localStorage.setItem(DigiWebApp.ApplicationController.storagePrefix+"_"+a.name.toLowerCase()+"Keys",JSON.stringify(b));return true},findSorted:function(){var a=this,b=[];try{var c=localStorage.getItem(DigiWebApp.ApplicationController.storagePrefix+"_"+a.name.toLowerCase()+"Keys");if(c!==null)b=JSON.parse(c)}catch(d){console.error("ERROR in "+a.name+".findSorted: "+d)}var f=[];b&&_.each(b,function(e){e=a.find({key:DigiWebApp.ApplicationController.storagePrefix+a.name+"_"+e});f.push(e)});return f}},
M.DataProviderLocalStorage);
DigiWebApp.BautagebuchEinstellungen=M.Model.create({__name__:"BautagebuchEinstellungen",startUhrzeit:M.Model.attr("String",{isRequired:NO}),inStundenBuchen:M.Model.attr("String",{isRequired:NO}),falscheZeitenIgnorieren:M.Model.attr("String",{isRequired:NO}),deleteAll:function(){_.each(this.find(),function(a){a.deleteSorted()})},deleteSorted:function(){var a=this,b=[],c=[];try{var d=localStorage.getItem(DigiWebApp.ApplicationController.storagePrefix+"_"+a.name.toLowerCase()+"Keys");if(d!==null)b=JSON.parse(d)}catch(f){console.error("ERROR in "+
a.name+".deleteSorted: "+f)}if(b){_.each(b,function(e){e!==a.m_id&&c.push(e)});localStorage.setItem(DigiWebApp.ApplicationController.storagePrefix+"_"+a.name.toLowerCase()+"Keys",JSON.stringify(c))}a.del()},saveSorted:function(){var a=this;a.save();var b=[];try{var c=localStorage.getItem(DigiWebApp.ApplicationController.storagePrefix+"_"+a.name.toLowerCase()+"Keys");if(c!==null)b=JSON.parse(c)}catch(d){console.error("ERROR in "+a.name+".saveSorted: "+d)}var f=NO;_.each(b,function(e){if(a.m_id===e)f=
YES});f===NO&&b.push(a.m_id);localStorage.setItem(DigiWebApp.ApplicationController.storagePrefix+"_"+a.name.toLowerCase()+"Keys",JSON.stringify(b))},findSorted:function(){var a=this,b=[];try{var c=localStorage.getItem(DigiWebApp.ApplicationController.storagePrefix+"_"+a.name.toLowerCase()+"Keys");if(c!==null)b=JSON.parse(c)}catch(d){console.error("ERROR in "+a.name+".findSorted: "+d)}var f=[];b&&_.each(b,function(e){f.push(a.find({key:DigiWebApp.ApplicationController.storagePrefix+a.name+"_"+e}))});
return f}},M.DataProviderLocalStorage);
DigiWebApp.SentTimeDataDays=M.Model.create({__name__:"SentTimeDataDays",tagLabel:M.Model.attr("String",{isRequired:NO}),deleteAll:function(){_.each(this.find(),function(a){a.del()})},deleteOld:function(){var a=0;try{a=0+new Number(DigiWebApp.SettingsController.getSetting("daysToHoldBookingsOnDevice"))}catch(b){a=DigiWebApp.SettingsController.defaultsettings.get("daysToHoldBookingsOnDevice")}var c=D8.create(D8.now().format("dd.mm.yyyy")).addDays(-a).getTimestamp();_.each(this.find(),function(d){D8.create(d.get("tagLabel")).getTimestamp()<
c&&d.del()})}},M.DataProviderLocalStorage);
DigiWebApp.Employee=M.Model.create({__name__:"Employee",id:M.Model.attr("String",{isRequired:NO}),name:M.Model.attr("String",{isRequired:NO}),kolonnenId:M.Model.attr("String",{isRequired:NO}),isSelected:M.Model.attr("Boolean",{isRequired:NO}),deleteAll:function(){_.each(this.find(),function(a){a.del()})},findSorted:function(){var a=this,b=[];try{b=JSON.parse(localStorage.getItem(DigiWebApp.ApplicationController.storagePrefix+"_"+this.name.toLowerCase()+"Keys"))}catch(c){console.error("ERROR in findSorted: "+c)}var d=
[];b&&_.each(b,function(f){d.push(a.find({key:M.LOCAL_STORAGE_PREFIX+M.Application.name+M.LOCAL_STORAGE_SUFFIX+a.name+"_"+f}))});return d}},M.DataProviderLocalStorage);
DigiWebApp.BautagebuchMitarbeiter=M.Model.create({__name__:"BautagebuchMitarbeiter",id:M.Model.attr("Number",{isRequired:NO}),vorname:M.Model.attr("String",{isRequired:NO}),nachname:M.Model.attr("String",{isRequired:NO}),webAppId:M.Model.attr("String",{isRequired:NO}),webAppPin:M.Model.attr("String",{isRequired:NO}),projektleiterId:M.Model.attr("Number",{isRequired:NO}),vollername:function(){return this.get("vorname")+" "+this.get("nachname")},deleteAll:function(){_.each(this.find(),function(a){a.deleteSorted()})},
deleteSorted:function(){var a=this,b=[],c=[];try{var d=localStorage.getItem(DigiWebApp.ApplicationController.storagePrefix+"_"+a.name.toLowerCase()+"Keys");if(d!==null)b=JSON.parse(d)}catch(f){console.error("ERROR in "+a.name+".deleteSorted: "+f)}if(b){_.each(b,function(e){e!==a.m_id&&c.push(e)});localStorage.setItem(DigiWebApp.ApplicationController.storagePrefix+"_"+a.name.toLowerCase()+"Keys",JSON.stringify(c))}return a.del()},saveSorted:function(){var a=this;if(!a.save())return false;var b=[];
try{var c=localStorage.getItem(DigiWebApp.ApplicationController.storagePrefix+"_"+a.name.toLowerCase()+"Keys");if(c!==null)b=JSON.parse(c)}catch(d){console.error("ERROR in "+a.name+".saveSorted: "+d)}var f=NO;_.each(b,function(e){if(a.m_id===e)f=YES});f===NO&&b.push(a.m_id);localStorage.setItem(DigiWebApp.ApplicationController.storagePrefix+"_"+a.name.toLowerCase()+"Keys",JSON.stringify(b));return true},findSorted:function(){var a=this,b=[];try{var c=localStorage.getItem(DigiWebApp.ApplicationController.storagePrefix+
"_"+a.name.toLowerCase()+"Keys");if(c!==null)b=JSON.parse(c)}catch(d){console.error("ERROR in "+a.name+".findSorted: "+d)}var f=[];b&&_.each(b,function(e){f.push(a.find({key:DigiWebApp.ApplicationController.storagePrefix+a.name+"_"+e}))});return f}},M.DataProviderLocalStorage);
DigiWebApp.Anwesenheitsliste=M.Model.create({__name__:"Anwesenheitsliste",auftragsBezeichnung:M.Model.attr("String",{}),auftragsId:M.Model.attr("String",{}),bis:M.Model.attr("String",{}),datum:M.Model.attr("String",{}),datumLabel:M.Model.attr("String",{}),farbeAmpel:M.Model.attr("String",{}),farbeAnwesenheit:M.Model.attr("String",{}),fehlzeitBezeichnung:M.Model.attr("String",{}),gpsBreite:M.Model.attr("String",{}),gpsBreitePosition:M.Model.attr("String",{}),gpsLaenge:M.Model.attr("String",{}),gpsLaengePosition:M.Model.attr("String",
{}),handauftragsBezeichnung:M.Model.attr("String",{}),handauftragsId:M.Model.attr("String",{}),mitarbeiterId:M.Model.attr("String",{}),name:M.Model.attr("String",{}),nameVorname:M.Model.attr("String",{}),positionsBezeichnung:M.Model.attr("String",{}),positionsId:M.Model.attr("String",{}),taetigkeit:M.Model.attr("String",{}),taetigkeitsId:M.Model.attr("String",{}),taetigkeitsart:M.Model.attr("String",{}),uhrzeit:M.Model.attr("String",{}),vorname:M.Model.attr("String",{})},M.DataConsumer.configure({appendRecords:NO,
responsePath:"anwesenheitsliste",url:function(){var a="http://"+DigiWebApp.RequestController.DatabaseServer+"/WebAppServices/anwesenheitsliste?modus=0&firmenId="+DigiWebApp.SettingsController.getSetting("company")+"&kennwort="+DigiWebApp.SettingsController.getSetting("password")+"&geraeteId="+DigiWebApp.SettingsController.getSetting("workerId")+"&geraeteTyp=2&softwareVersion="+DigiWebApp.RequestController.softwareVersion+"&requestTimestamp="+M.Date.now().date.valueOf();DigiWebApp.ApplicationController.profilingIntervalVar===
null&&console.log("Anwesenheitsliste: using "+a);return a},map:function(a){a={auftragsBezeichnung:a.auftragsBezeichnung,auftragsId:a.auftragsId,bis:a.bis,datum:a.datum,datumLabel:"",farbeAmpel:a.farbeAmpel,farbeAnwesenheit:a.farbeAnwesenheit,fehlzeitBezeichnung:a.fehlzeitBezeichnung,gpsBreite:a.gpsBreite,gpsBreitePosition:a.gpsBreitePosition,gpsLaenge:a.gpsLaenge,gpsLaengePosition:a.gpsLaengePosition,handauftragsBezeichnung:a.handauftragsBezeichnung,handauftragsId:a.handauftragsId,mitarbeiterId:a.mitarbeiterId,
name:a.name,nameVorname:a.nameVorname,positionsBezeichnung:a.positionsBezeichnung,positionsId:a.positionsId,taetigkeit:a.taetigkeit,taetigkeitsId:a.taetigkeitsId,taetigkeitsart:a.taetigkeitsart,uhrzeit:a.uhrzeit,vorname:a.vorname};if(a.datum!=="-")if(a.bis==="-")a.datumLabel=M.I18N.l("bookingSince")+": ";else{a.datumLabel=M.I18N.l("lastWorkday")+": ";a.uhrzeit="-"}else{a.datumLabel=M.I18N.l("noData");a.uhrzeit="-";a.bis="-"}return a}}));
DigiWebApp.BautagebuchZeitbuchung=M.Model.create({__name__:"BautagebuchZeitbuchung",id:M.Model.attr("Number",{isRequired:NO}),bautagesberichtId:M.Model.attr("String",{isRequired:NO}),mitarbeiterIds:M.Model.attr("String",{isRequired:NO}),mitarbeiterId:M.Model.attr("String",{isRequired:NO}),von:M.Model.attr("String",{isRequired:NO}),bis:M.Model.attr("String",{isRequired:NO}),dauer:M.Model.attr("String",{isRequired:NO}),timeStampStart:M.Model.attr("String",{isRequired:NO}),timeStampEnd:M.Model.attr("String",
{isRequired:NO}),verbuchen:M.Model.attr("String",{isRequired:NO}),latitude:M.Model.attr("String",{isRequired:NO}),longitude:M.Model.attr("String",{isRequired:NO}),latitude_bis:M.Model.attr("String",{isRequired:NO}),longitude_bis:M.Model.attr("String",{isRequired:NO}),positionId:M.Model.attr("String",{isRequired:NO}),positionName:M.Model.attr("String",{isRequired:NO}),activityId:M.Model.attr("String",{isRequired:NO}),activityName:M.Model.attr("String",{isRequired:NO}),deleteAll:function(){_.each(this.find(),
function(a){a.deleteSorted()})},deleteSorted:function(){var a=this,b=[],c=[];try{var d=localStorage.getItem(DigiWebApp.ApplicationController.storagePrefix+"_"+a.name.toLowerCase()+"Keys");if(d!==null)b=JSON.parse(d)}catch(f){console.error("ERROR in "+a.name+".deleteSorted: "+f)}if(b){_.each(b,function(e){e!==a.m_id&&c.push(e)});localStorage.setItem(DigiWebApp.ApplicationController.storagePrefix+"_"+a.name.toLowerCase()+"Keys",JSON.stringify(c))}return a.del()},saveSorted:function(){var a=this;if(!a.save())return false;
var b=[];try{var c=localStorage.getItem(DigiWebApp.ApplicationController.storagePrefix+"_"+a.name.toLowerCase()+"Keys");if(c!==null)b=JSON.parse(c)}catch(d){console.error("ERROR in "+a.name+".saveSorted: "+d)}var f=NO;_.each(b,function(e){if(a.m_id===e)f=YES});f===NO&&b.push(a.m_id);localStorage.setItem(DigiWebApp.ApplicationController.storagePrefix+"_"+a.name.toLowerCase()+"Keys",JSON.stringify(b));return true},findSorted:function(a){var b=this,c=[];try{var d=localStorage.getItem(DigiWebApp.ApplicationController.storagePrefix+
"_"+b.name.toLowerCase()+"Keys");if(d!==null)c=JSON.parse(d)}catch(f){console.error("ERROR in "+b.name+".findSorted: "+f)}var e=[];c&&_.each(c,function(g){g=b.find({key:DigiWebApp.ApplicationController.storagePrefix+b.name+"_"+g});if(a&&g.get("bautagesberichtId")===a||typeof a==="undefined")e.push(g)});return e}},M.DataProviderLocalStorage);
DigiWebApp.BautagebuchMaterialBuchung=M.Model.create({__name__:"BautagebuchMaterialBuchung",id:M.Model.attr("Number",{isRequired:NO}),bautagesberichtId:M.Model.attr("String",{isRequired:YES}),artikel:M.Model.attr("String",{isRequired:NO}),menge:M.Model.attr("String",{isRequired:NO}),einheit:M.Model.attr("String",{isRequired:NO}),materialId:M.Model.attr("String",{isRequired:NO}),mengeneinheitId:M.Model.attr("String",{isRequired:NO}),positionId:M.Model.attr("String",{isRequired:NO}),positionName:M.Model.attr("String",
{isRequired:NO}),activityId:M.Model.attr("String",{isRequired:NO}),activityName:M.Model.attr("String",{isRequired:NO}),deleteAll:function(){_.each(this.find(),function(a){a.deleteSorted()})},deleteSorted:function(){var a=this,b=[],c=[];try{var d=localStorage.getItem(DigiWebApp.ApplicationController.storagePrefix+"_"+a.name.toLowerCase()+"Keys");if(d!==null)b=JSON.parse(d)}catch(f){console.error("ERROR in "+a.name+".deleteSorted: "+f)}if(b){_.each(b,function(e){e!==a.m_id&&c.push(e)});localStorage.setItem(DigiWebApp.ApplicationController.storagePrefix+
"_"+a.name.toLowerCase()+"Keys",JSON.stringify(c))}return a.del()},saveSorted:function(){var a=this;if(!a.save())return false;var b=[];try{var c=localStorage.getItem(DigiWebApp.ApplicationController.storagePrefix+"_"+a.name.toLowerCase()+"Keys");if(c!==null)b=JSON.parse(c)}catch(d){console.error("ERROR in "+a.name+".saveSorted: "+d)}var f=NO;_.each(b,function(e){if(a.m_id===e)f=YES});f===NO&&b.push(a.m_id);localStorage.setItem(DigiWebApp.ApplicationController.storagePrefix+"_"+a.name.toLowerCase()+
"Keys",JSON.stringify(b));return true},findSorted:function(a){var b=this,c=[];try{var d=localStorage.getItem(DigiWebApp.ApplicationController.storagePrefix+"_"+b.name.toLowerCase()+"Keys");if(d!==null)c=JSON.parse(d)}catch(f){console.error("ERROR in "+b.name+".findSorted: "+f)}var e=[];c&&_.each(c,function(g){g=b.find({key:DigiWebApp.ApplicationController.storagePrefix+b.name+"_"+g});if(a&&g.get("bautagesberichtId")===a||typeof a==="undefined")e.push(g)});return e}},M.DataProviderLocalStorage);
DigiWebApp.BautagebuchMaterial=M.Model.create({__name__:"BautagebuchMaterial",id:M.Model.attr("String",{isRequired:NO}),bezeichnung:M.Model.attr("String",{isRequired:NO}),deleteAll:function(){_.each(this.find(),function(a){a.deleteSorted()})},deleteSorted:function(){var a=this,b=[],c=[];try{var d=localStorage.getItem(DigiWebApp.ApplicationController.storagePrefix+"_"+a.name.toLowerCase()+"Keys");if(d!==null)b=JSON.parse(d)}catch(f){console.error("ERROR in "+a.name+".deleteSorted: "+f)}if(b){_.each(b,
function(e){e!==a.m_id&&c.push(e)});localStorage.setItem(DigiWebApp.ApplicationController.storagePrefix+"_"+a.name.toLowerCase()+"Keys",JSON.stringify(c))}return a.del()},saveSorted:function(){var a=this;if(!a.save())return false;var b=[];try{var c=localStorage.getItem(DigiWebApp.ApplicationController.storagePrefix+"_"+a.name.toLowerCase()+"Keys");if(c!==null)b=JSON.parse(c)}catch(d){console.error("ERROR in "+a.name+".saveSorted: "+d)}var f=NO;_.each(b,function(e){if(a.m_id===e)f=YES});f===NO&&b.push(a.m_id);
localStorage.setItem(DigiWebApp.ApplicationController.storagePrefix+"_"+a.name.toLowerCase()+"Keys",JSON.stringify(b));return true},findSorted:function(){var a=this,b=[];try{var c=localStorage.getItem(DigiWebApp.ApplicationController.storagePrefix+"_"+a.name.toLowerCase()+"Keys");if(c!==null)b=JSON.parse(c)}catch(d){console.error("ERROR in "+a.name+".findSorted: "+d)}var f=[];b&&_.each(b,function(e){f.push(a.find({key:DigiWebApp.ApplicationController.storagePrefix+a.name+"_"+e}))});return f}},M.DataProviderLocalStorage);
DigiWebApp.BautagebuchBautagesbericht=M.Model.create({__name__:"BautagebuchBautagesbericht",datum:M.Model.attr("String",{isRequired:YES}),startUhrzeit:M.Model.attr("String",{isRequired:YES}),bautagesberichtId:M.Model.attr("String",{isRequired:NO}),transferCompleted:M.Model.attr("Boolean",{isRequired:NO}),projektleiterId:M.Model.attr("String",{isRequired:NO}),selektierteMitarbeiter:M.Model.attr("String",{isRequired:NO}),orderId:M.Model.attr("String",{isRequired:NO}),orderName:M.Model.attr("String",
{isRequired:NO}),temperatur:M.Model.attr("String",{isRequired:NO}),luftfeuchtigkeit:M.Model.attr("String",{isRequired:NO}),bewoelkung:M.Model.attr("String",{isRequired:NO}),niederschlag:M.Model.attr("String",{isRequired:NO}),wind:M.Model.attr("String",{isRequired:NO}),wechselhaft:M.Model.attr("String",{isRequired:NO}),latitude:M.Model.attr("String",{isRequired:NO}),longitude:M.Model.attr("String",{isRequired:NO}),abgeschlossen:M.Model.attr("String",{isRequired:NO}),unterschrift:M.Model.attr("String",
{isRequired:NO}),unterschrift_hoehe:M.Model.attr("String",{isRequired:NO}),unterschrift_breite:M.Model.attr("String",{isRequired:NO}),fileName:M.Model.attr("String",{isRequired:NO}),fileType:M.Model.attr("String",{isRequired:NO}),hasFileName:function(){return!this.get("fileName")||this.get("fileName")&&this.get("fileName").length===0?NO:YES},saveToFile:function(a,b,c){var d=this,f=new String(a);if(!d.hasFileName()){d.set("fileName",d.__proto__.name+"_Signature_"+D8.now().getTimestamp());d.save()}if(typeof b!==
"function"){console.error("saveToFileError: successCallback is not a function");return false}var e;e=!c||typeof c!=="function"?function(i){console.error("saveToFileError",i)}:c;if(typeof window.requestFileSystem==="undefined"){console.error("saveToFileError: no LocalFileSystem available");b("");return true}try{var g=DigiWebApp.ApplicationController.CONSTApplicationQuota;typeof navigator.webkitPersistentStorage!=="undefined"?navigator.webkitPersistentStorage.requestQuota(g,function(i){window.requestFileSystem(PERSISTENT,
i,function(j){j.root.getDirectory("DIGIWebAppData",{create:true,exclusive:false},function(l){l.getFile(d.get("fileName"),{create:true,exclusive:false},function(m){m.createWriter(function(n){n.onerror=function(p){console.error("writeError",p);e(p)};n.onwriteend=function(){n.onwriteend=function(p){b(p)};n.truncate(f.length)};var o=new Blob([f],{type:"text/plain"});n.write(o)},e)},e)},e)},e)},function(i){console.error("Error while requesting Quota",i);DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("error"),
message:M.I18N.l("errorWhileRequestingQuota")+": "+err})}):window.requestFileSystem(LocalFileSystem.PERSISTENT,0,function(i){i.root.getDirectory("DIGIWebAppData",{create:true,exclusive:false},function(j){j.getFile(d.get("fileName"),{create:true,exclusive:false},function(l){l.createWriter(function(m){m.onerror=function(n){console.error("writeError",n);e(n)};m.onwriteend=function(){m.onwriteend=function(n){b(n)};m.truncate(f.length)};m.write(f.toString())},e)},e)},e)},e)}catch(h){e(h)}},readFromFile:function(a,
b){var c=this;if(!c.hasFileName()){console.error("readFromFileError: no fileName given");return false}if(typeof a!=="function"){console.error("readFromFileError: successCallback is not a function");return false}var d;d=!b||typeof b!=="function"?function(g){console.error("readFromFileError",g)}:b;if(typeof window.requestFileSystem==="undefined"){console.error("readFromFileError: no LocalFileSystem available");a("");return true}try{var f=DigiWebApp.ApplicationController.CONSTApplicationQuota;typeof navigator.webkitPersistentStorage!==
"undefined"?navigator.webkitPersistentStorage.requestQuota(f,function(g){window.requestFileSystem(PERSISTENT,g,function(h){h.root.getDirectory("DIGIWebAppData",{create:true,exclusive:false},function(i){i.getFile(c.get("fileName"),null,function(j){j.file(function(l){var m=new FileReader;m.onloadend=function(){a(this.result)};m.readAsText(l)},d)},d)},d)},d)},function(g){console.error("Error while requesting Quota",g);DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("error"),message:M.I18N.l("errorWhileRequestingQuota")+
": "+err})}):window.requestFileSystem(LocalFileSystem.PERSISTENT,0,function(g){g.root.getDirectory("DIGIWebAppData",{create:true,exclusive:false},function(h){h.getFile(c.get("fileName"),null,function(i){i.file(function(j){var l=new FileReader;l.onloadend=function(m){a(m.target.result)};l.readAsText(j)},d)},d)},d)},d)}catch(e){d(e)}},deleteFile:function(a,b){var c=this;if(!c.hasFileName()){console.error("deleteFileError: no fileName given");return false}if(typeof a!=="function"){console.error("deleteFileError: successCallback is not a function");
return false}var d;d=!b||typeof b!=="function"?function(g){console.error("deleteFileError",g)}:b;if(typeof window.requestFileSystem==="undefined"){console.error("deleteFileError: no LocalFileSystem available");a("");return true}try{var f=DigiWebApp.ApplicationController.CONSTApplicationQuota;typeof navigator.webkitPersistentStorage!=="undefined"?navigator.webkitPersistentStorage.requestQuota(f,function(g){window.requestFileSystem(PERSISTENT,g,function(h){h.root.getDirectory("DIGIWebAppData",{create:true,
exclusive:false},function(i){i.getFile(c.get("fileName"),null,function(j){j.remove(a,d)},d)},d)},d)},function(g){console.error("Error while requesting Quota",g);DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("error"),message:M.I18N.l("errorWhileRequestingQuota")+": "+err})}):window.requestFileSystem(LocalFileSystem.PERSISTENT,0,function(g){g.root.getDirectory("DIGIWebAppData",{create:true,exclusive:false},function(h){h.getFile(c.get("fileName"),null,function(i){i.remove(a,
d)},d)},d)},d)}catch(e){d(e)}},deleteAll:function(){_.each(this.find(),function(a){a.deleteSorted()})},deleteSorted:function(a){var b=this;_.each(DigiWebApp.BautagebuchZeitbuchung.find({bautagesberichtId:b.m_id}),function(g){g.deleteSorted()});_.each(DigiWebApp.BautagebuchMaterialBuchung.find({bautagesberichtId:b.m_id}),function(g){g.deleteSorted()});_.each(DigiWebApp.BautagebuchNotiz.find({bautagesberichtId:b.m_id}),function(g){g.deleteSorted()});_.each(DigiWebApp.BautagebuchMediaFile.find({bautagesberichtId:b.m_id}),
function(g){g.deleteSorted()});var c=[],d=[];try{var f=localStorage.getItem(DigiWebApp.ApplicationController.storagePrefix+"_"+b.name.toLowerCase()+"Keys");if(f!==null)c=JSON.parse(f)}catch(e){console.error("ERROR in "+b.name+".deleteSorted: "+e)}if(c){_.each(c,function(g){g!==b.m_id&&d.push(g)});localStorage.setItem(DigiWebApp.ApplicationController.storagePrefix+"_"+b.name.toLowerCase()+"Keys",JSON.stringify(d))}if(b.hasFileName())b.deleteFile(function(){b.del();typeof a==="function"&&a()},function(){b.del();
typeof a==="function"&&a()});else{b.del();typeof a==="function"&&a()}},saveSorted:function(){var a=this;if(!a.save())return false;var b=[];try{var c=localStorage.getItem(DigiWebApp.ApplicationController.storagePrefix+"_"+a.name.toLowerCase()+"Keys");if(c!==null)b=JSON.parse(c)}catch(d){console.error("ERROR in "+a.name+".saveSorted: "+d)}var f=NO;_.each(b,function(e){if(a.m_id===e)f=YES});f===NO&&b.push(a.m_id);localStorage.setItem(DigiWebApp.ApplicationController.storagePrefix+"_"+a.name.toLowerCase()+
"Keys",JSON.stringify(b));return true},findSorted:function(){var a=this,b=[];try{var c=localStorage.getItem(DigiWebApp.ApplicationController.storagePrefix+"_"+a.name.toLowerCase()+"Keys");if(c!==null)b=JSON.parse(c)}catch(d){console.error("ERROR in "+a.name+".findSorted: "+d)}var f=[];b&&_.each(b,function(e){f.push(a.find({key:DigiWebApp.ApplicationController.storagePrefix+a.name+"_"+e}))});return f}},M.DataProviderLocalStorage);
DigiWebApp.BautagebuchMaterialienDetailsController=M.Controller.extend({item:null,positionId:null,positionName:null,positionenList:null,activityId:null,activityName:null,activityList:null,materialId:null,materialienList:null,artikel:null,mengeneinheitId:null,mengeneinheitenList:null,einheit:null,menge:null,init:function(){},load:function(a){this.set("item",a);this.set("positionId",a.get("positionId"));this.set("positionName",a.get("positionName"));this.set("activityId",a.get("activityId"));this.set("activityName",
a.get("activityName"));this.set("materialId",a.get("materialId"));this.set("mengeneinheitId",a.get("mengeneinheitId"));this.set("artikel",a.get("artikel"));this.set("menge",a.get("menge"));this.set("einheit",a.get("einheit"));this.setTaetigkeiten(a.get("positionId"))},save:function(){if(M.ViewManager.getView("bautagebuchMaterialienDetailsPage","positionComboBox").getSelection()==="0"){DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("noPosSelected"),message:M.I18N.l("noPosSelectedMsg")});
return false}if(!this.artikel){DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("BautagebuchKeinMaterial"),message:M.I18N.l("BautagebuchKeinMaterialMsg")});return false}if(!this.einheit){DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("BautagebuchKeineEinheit"),message:M.I18N.l("BautagebuchKeineEinheitMsg")});return false}if(this.menge)if(this.menge.indexOf(".")!==-1&&this.menge.indexOf(",")!==-1){DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("ungueltigeZahl"),
message:M.I18N.l("ungueltigeZahlMsg")});return false}else{if(isNaN(parseFloat(this.menge))){DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("BautagebuchUngueltigeMenge"),message:M.I18N.l("BautagebuchUngueltigeMengeMsg")});return false}}else{DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("BautagebuchKeineMenge"),message:M.I18N.l("BautagebuchKeineMengeMsg")});return false}M.I18N.getLanguage()!=="de_de"&&M.I18N.getLanguage();this.set("menge",this.menge.replace(",",
"."));this.set("menge",parseFloat(this.menge));this.item.set("positionId",this.positionId);this.item.set("positionName",this.positionName);if(parseInt(this.activityId)!==0){this.item.set("activityId",this.activityId);this.item.set("activityName",this.activityName)}else{this.item.set("activityId",null);this.item.set("activityName",null)}this.item.set("materialId",this.materialId);this.item.set("mengeneinheitId",this.mengeneinheitId);this.item.set("artikel",this.artikel);this.item.set("einheit",this.einheit);
this.item.set("menge",this.menge);if(this.item.saveSorted()){DigiWebApp.BautagebuchMaterialienListeController.set("items",DigiWebApp.BautagebuchMaterialBuchung.findSorted(DigiWebApp.BautagebuchBautageberichtDetailsController.item.m_id));DigiWebApp.NavigationController.backToBautagebuchMaterialienListePageTransition();return true}else return false},deleteMaterialbuchung:function(){if(this.item.deleteSorted()){DigiWebApp.BautagebuchMaterialienListeController.set("items",DigiWebApp.BautagebuchMaterialBuchung.findSorted(DigiWebApp.BautagebuchBautageberichtDetailsController.item.m_id));
DigiWebApp.NavigationController.backToBautagebuchMaterialienListePageTransition();return true}else return false},setTaetigkeiten:function(a){var b=this;if(typeof a!=="undefined"){var c=_.select(DigiWebApp.WorkPlan.find(),function(f){if(f)return f.get("id")==a}),d=NO;c=c.length>0?DigiWebApp.SelectionController.getActivitiesFromWorkplan(c[0]):DigiWebApp.SelectionController.getActivities();c=_.map(c,function(f){if(typeof f==="undefined")console.log("UNDEFINED activity");else{f={label:f.get("name"),value:f.get("id"),
isSelected:NO};if(b.activityId===f.value)d=f.isSelected=YES;return f}});c=_.compact(c);c.push({label:M.I18N.l("selectSomethingOptional"),value:"0",isSelected:!d});b.set("activityList",c)}}});
DigiWebApp.BautagebuchZusammenfassungController=M.Controller.extend({item:null,lastTimestampDatatransfer:null,bautagesberichtId:null,projektleiterId:null,projektleiterList:null,mitarbeiterIds:null,mitarbeiterList:null,mitarbeiterListSelected:null,datum:null,auftragsId:null,auftragsName:null,auftraegeList:null,positionenList:null,latitude:null,longitude:null,wetter:null,setWetter:function(a){if(typeof a==="undefined")return NO;else{this.set("wetter",JSON.parse(JSON.stringify(a)));return YES}},startUhrzeit:null,
ZeitbuchungenPerMitarbeiterList:[],init:function(){},load:function(a){this.set("item",a);this.set("bautagesberichtId",a.m_id);this.set("datum",a.get("datum"));this.set("projektleiterId",a.get("projektleiterId"));this.set("auftragsId",a.get("orderId"));this.set("auftragsName",a.get("orderName"));this.set("mitarbeiterIds",a.get("selektierteMitarbeiter"));this.set("startUhrzeit",a.get("startUhrzeit"));this.setWetter(DigiWebApp.BautagebuchMainController.wetterDefaults);this.set("wetter.temperatur",a.get("temperatur"));
this.set("wetter.luftfeuchtigkeit",a.get("luftfeuchtigkeit"));this.set("wetter.bewoelkung",a.get("bewoelkung"));this.set("wetter.niederschlag",a.get("niederschlag"));this.set("wetter.wind",a.get("wind"));this.set("wetter.wechselhaft",a.get("wechselhaft"));this.set("wetter.wechselhaftItem",[{value:"wechselhaft",label:M.I18N.l("BautagebuchWechselhaft"),isSelected:a.get("wechselhaft")}]);this.setPositionen(a.get("orderId"));this.set("ZeitbuchungenPerMitarbeiterList",this.getZeitbuchungenPerMitarbeiterList())},
save:function(a,b){if(this.item.saveSorted()){DigiWebApp.BautagebuchBautageberichteListeController.set("items",DigiWebApp.BautagebuchBautagesbericht.findSorted());typeof a==="function"&&a();return true}else{typeof b==="function"&&b();return false}},deleteBautagesbericht:function(a,b){if(this.item.deleteSorted()){DigiWebApp.BautagebuchBautageberichteListeController.set("items",DigiWebApp.BautagebuchBautagesbericht.findSorted());typeof a==="function"&&a();return true}else{typeof b==="function"&&b();
return false}},finish:function(a,b){var c=this;c.item.set("abgeschlossen",YES);c.berechneVonBis(YES);var d="";if(DigiWebApp.SettingsController.featureAvailable("405")&&typeof window.requestFileSystem!=="undefined"){d=DigiWebApp.BautagebuchZusammenfassungPage.signaturePadAPI.getSignatureString();c.item.set("fileType",DigiWebApp.ApplicationController.CONSTTextFiletype);c.item.saveToFile(d,function(){c.item.set("unterschrift_breite",DigiWebApp.BautagebuchZusammenfassungPage.content.container.signature.signatureform.signaturecanvas.canvasWidth);
c.item.set("unterschrift_hoehe",DigiWebApp.BautagebuchZusammenfassungPage.content.container.signature.signatureform.signaturecanvas.canvasHeight);if(c.save()){DigiWebApp.BautagebuchBautageberichteListeController.set("items",DigiWebApp.BautagebuchBautagesbericht.findSorted());typeof a==="function"&&a();return true}else{typeof b==="function"&&b();return false}})}else if(c.save()){DigiWebApp.BautagebuchBautageberichteListeController.set("items",DigiWebApp.BautagebuchBautagesbericht.findSorted());typeof a===
"function"&&a();return true}else{typeof b==="function"&&b();return false}},setPositionen:function(a){if(typeof a==="undefined")return false;else{var b=_.map(DigiWebApp.Position.find(),function(c){if(typeof c==="undefined")console.log("UNDEFINED Position");else if(c.get("orderId")===a)return{label:c.get("name"),value:c.get("id"),isSelected:NO}});b=_.compact(b);DigiWebApp.BautagebuchBautageberichtDetailsController.set("positionenList",b)}},berechneVonBis:function(a){var b=[],c=D8.create(DigiWebApp.BautagebuchBautageberichtDetailsController.item.get("datum")+
" "+DigiWebApp.BautagebuchBautageberichtDetailsController.startUhrzeit),d=DigiWebApp.BautagebuchZeitbuchung.find({query:{identifier:"bautagesberichtId",operator:"=",value:this.bautagesberichtId}});d=_.sortBy(d,function(f){return parseInt(f.get("_createdAt"))});_.each(d,function(f){f.set("von",c.format("HH:MM"));f.set("timeStampStart",c.getTimestamp());var e=f.get("dauer");c=c.addHours(parseInt(e.split(":")[0])).addMinutes(parseInt(e.split(":")[1]));f.set("bis",c.format("HH:MM"));f.set("timeStampEnd",
c.getTimestamp());typeof a!=="undefined"&&parseBool(a)&&f.saveSorted();b.push(f)});return _.sortBy(b,function(f){return parseInt(f.get("von"))})},getZeitbuchungenPerMitarbeiterList:function(){var a=[],b=[];if(parseBool(this.item.get("abgeschlossen"))||!DigiWebApp.BautagebuchEinstellungen.find()[0].get("inStundenBuchen")){var c=DigiWebApp.BautagebuchZeitbuchung.find({query:{identifier:"bautagesberichtId",operator:"=",value:this.bautagesberichtId}});b=_.sortBy(c,function(f){return parseInt(f.get("von"))})}else b=
this.berechneVonBis();_.each(b,function(f){f=JSON.parse(f.get("mitarbeiterIds"));_.each(f,function(e){var g=DigiWebApp.BautagebuchMitarbeiter.find({query:{identifier:"id",operator:"=",value:e}})[0];if(typeof g!=="undefined"){var h=NO;_.each(a,function(i){if(i.get("id")===g.get("id"))h=YES});h===NO&&a.push(g)}})});var d=[];_.each(a,function(f){var e=[],g=D8.create(DigiWebApp.BautagebuchBautageberichtDetailsController.item.get("datum")+" 00:00");_.each(b,function(i){var j=JSON.parse(i.get("mitarbeiterIds"));
_.each(j,function(l){if(l===f.get("id")){g=g.addHours(i.get("dauer").split(":")[0]).addMinutes(i.get("dauer").split(":")[1]);l={vonbisdauer:i.get("von")+" - "+i.get("bis")+" ("+i.get("dauer")+"h)",positionName:i.get("positionName"),activityName:i.get("activityName"),mitarbeiterId:l};e.push(l)}})});var h={label:f.vollername()+": "+g.format("HH:MM")+"h",items:e};d.push(h)});return d}});
DigiWebApp.JSONDatenuebertragungController=M.Controller.extend({consoleLogOutput:YES,sendData:function(a,b,c,d,f,e){!DigiWebApp.RequestController.DatabaseServer||DigiWebApp.RequestController.DatabaseServerTimestamp&&DigiWebApp.RequestController.DatabaseServerTimestamp-(new Date).getTime()>6E4?DigiWebApp.RequestController.getDatabaseServer(function(){DigiWebApp.JSONDatenuebertragungController.sendDataWithServer(a,b,c,d,f,e)},null):DigiWebApp.JSONDatenuebertragungController.sendDataWithServer(a,b,c,
d,f,e)},sendDataWithServer:function(a,b,c,d,f,e){b="http://"+DigiWebApp.RequestController.DatabaseServer+"/WebAppServices/"+b+"?modus=0&firmenId="+DigiWebApp.SettingsController.getSetting("company")+"&kennwort="+DigiWebApp.SettingsController.getSetting("password")+"&geraeteId="+DigiWebApp.SettingsController.getSetting("workerId")+"&geraeteTyp=2&softwareVersion="+DigiWebApp.RequestController.softwareVersion+"&requestTimestamp="+M.Date.now().date.valueOf();if(e)b=b+"&"+e;M.Request.init({url:b,method:"POST",
data:JSON.stringify(a),timeout:15E3,contentType:"text/plain",dataType:"text",beforeSend:function(g){DigiWebApp.ApplicationController.DigiLoaderView.show(c);g.setRequestHeader("Content-Type","text/plain")},onSuccess:function(g,h,i){DigiWebApp.ApplicationController.DigiLoaderView.hide();d(a,h,i)},onError:function(g,h){DigiWebApp.ApplicationController.DigiLoaderView.hide();f(g,h)}}).send()},recieveData:function(a,b,c,d,f,e,g){!DigiWebApp.RequestController.DatabaseServer||DigiWebApp.RequestController.DatabaseServerTimestamp&&
DigiWebApp.RequestController.DatabaseServerTimestamp-(new Date).getTime()>6E4?DigiWebApp.RequestController.getDatabaseServer(function(){DigiWebApp.JSONDatenuebertragungController.recieveDataWithServer(a,b,c,d,f,e,g)},null):DigiWebApp.JSONDatenuebertragungController.recieveDataWithServer(a,b,c,d,f,e,g)},recieveDataWithServer:function(a,b,c,d,f,e,g){var h="0";if(typeof g!=="undefined")h=g;g=DigiWebApp.SettingsController.getSetting("workerId");var i=2;if(e){g=0;i=3}a="http://"+DigiWebApp.RequestController.DatabaseServer+
"/WebAppServices/"+a+"?modus="+h+"&firmenId="+DigiWebApp.SettingsController.getSetting("company")+"&kennwort="+DigiWebApp.SettingsController.getSetting("password")+"&geraeteId="+g+"&geraeteTyp="+i+"&softwareVersion="+DigiWebApp.RequestController.softwareVersion+"&requestTimestamp="+M.Date.now().date.valueOf();if(f)a=a+"&"+f;M.Request.init({url:a,beforeSend:function(){DigiWebApp.ApplicationController.DigiLoaderView.show(b)},method:"GET",sendNoCacheHeader:YES,sendTimestamp:YES,isJSON:YES,onSuccess:function(j,
l,m){DigiWebApp.ApplicationController.DigiLoaderView.hide();c(j,l,m)},onError:function(j,l){DigiWebApp.ApplicationController.DigiLoaderView.hide();d(j,l)}}).send()},sendeZeitdaten:function(a,b,c,d,f){var e=function(g,h,i,j){var l=[];g=_.sortBy(g,function(o){return parseInt(o.get("_createdAt"))});var m=localStorage.getItem(DigiWebApp.EmployeeController.empSelectionKey)||localStorage.getItem(DigiWebApp.EmployeeController.empSelectionKeyTmp),n=[];n=m&&m!=="0"?m.split(","):[DigiWebApp.SettingsController.getSetting("mitarbeiterId")];
_.each(g,function(o){_.each(n,function(p){var q=DigiWebApp.Booking.createRecord({m_id:o.m_id}),r;for(r in o.record)try{typeof JSON.parse(o.get(r)).length!=="undefined"?q.set(r,JSON.parse(o.get(r))):q.set(r,o.get(r))}catch(s){q.set(r,o.get(r))}if(parseInt(q.get("timeStampEnd"))===0){q.set("timeStampEnd",null);q.set("longitude_bis","0");q.set("latitude_bis","0");q.get("longitude")||q.set("longitude","0");q.get("latitude")||q.set("latitude","0")}q.set("gpsLaengeVon",q.get("longitude"));q.set("gpsBreiteVon",
q.get("latitude"));q.set("gpsLaengeBis",q.get("longitude_bis"));q.set("gpsBreiteBis",q.get("latitude_bis"));q.set("handauftragsId",q.get("handOrderId"));q.set("handauftragsBezeichnung",q.get("handOrderName"));q.set("mitarbeiterId",p);l.push(q.record)})});l.length!==0?DigiWebApp.JSONDatenuebertragungController.sendData({zeitdaten:l},"zeitdaten",M.I18N.l("sendDataMsg"),function(){h()},function(){if(j){DigiWebApp.EmployeeController.getEmployeeState()==2&&DigiWebApp.EmployeeController.setEmployeeState(1);
localStorage.removeItem(DigiWebApp.EmployeeController.empSelectionKey);localStorage.removeItem(DigiWebApp.EmployeeController.empSelectionKeyTmp)}i()}):h()};if(DigiWebApp.SettingsController.featureAvailable("417")&&(DigiWebApp.SettingsController.getSetting("ServiceApp_ermittleGeokoordinate")||DigiWebApp.SettingsController.getSetting("ServiceApp_datenUebertragen"))){DigiWebApp.ApplicationController.DigiLoaderView.show(M.I18N.l("ServiceAppKommunikation"));DigiWebApp.ServiceAppController.refreshWAITBookings(function(){DigiWebApp.ApplicationController.DigiLoaderView.hide();
e(a,b,c,d,f)},function(){DigiWebApp.ApplicationController.DigiLoaderView.hide();e(a,b,c,d,f)},[],true)}else e(a,b,c,d,f)},empfangeTaetigkeiten:function(a,b){DigiWebApp.JSONDatenuebertragungController.recieveData("leistungen",M.I18N.l("getActivitiesLoader"),function(c){if(typeof c.leistungen==="undefined"&&c.leistungen!==null&&c.leistungen.length>0){console.error("missing leistungen");return b()}var d=null;try{d=c.leistungen.length}catch(f){console.error(d)}if(c.leistungen===null)return b();else{d=
null;try{d=c.leistungen.length}catch(e){console.error(d);return b()}}DigiWebApp.Activity.deleteAll();_.each(c.leistungen,function(g){if(typeof g.leistungsId==="undefined"){console.error("missing leistungsId");return b()}else if(typeof g.leistungsBezeichnung==="undefined"){console.error("missing leistungsBezeichnung");return b()}else{var h=0;if(g.istMitarbeiterZugeordnet)h=1;DigiWebApp.Activity.createRecord({id:g.leistungsId,name:g.leistungsBezeichnung,positionId:h,istStandardPause:g.istStandardPause,
istUnterschriftsAbnahme:g.istUnterschriftsAbnahme,istFahrzeitRelevant:g.istFahrzeitRelevant}).saveSorted()}});a()},b,"",false,"1")}});
DigiWebApp.AnwesenheitslisteController=M.Controller.extend({items:null,init:function(a){DigiWebApp.AnwesenheitslisteController.items===null?DigiWebApp.RequestController.getDatabaseServer(DigiWebApp.AnwesenheitslisteController.initWithServer,a):DigiWebApp.AnwesenheitslisteController.initWithServer(a)},initWithServer:function(){var a=DigiWebApp.AnwesenheitslisteController;if(a.items===null){DigiWebApp.ApplicationController.DigiLoaderView.show(M.I18N.l("AnwesenheitslisteLaden"));DigiWebApp.Anwesenheitsliste.find({urlParams:{},
callbacks:{success:{action:function(b){DigiWebApp.ApplicationController.DigiLoaderView.hide();b&&b.length===0?DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("error"),message:M.I18N.l("AnwesenheitslisteKonnteNichtGeladenWerden"),callbacks:{confirm:{target:a,action:function(){DigiWebApp.SettingsController.featureAvailable("404")?DigiWebApp.NavigationController.backToButtonDashboardPageFlipTransition():DigiWebApp.NavigationController.backToDashboardPageFlipTransition()}}}}):DigiWebApp.AnwesenheitslisteController.set("items",
b)}},error:{action:function(){DigiWebApp.ApplicationController.DigiLoaderView.hide();DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("error"),message:M.I18N.l("AnwesenheitslisteKonnteNichtGeladenWerden"),callbacks:{confirm:{target:a,action:function(){DigiWebApp.SettingsController.featureAvailable("404")?DigiWebApp.NavigationController.backToButtonDashboardPageFlipTransition():DigiWebApp.NavigationController.backToDashboardPageFlipTransition()}}}})}}}})}}});
DigiWebApp.DashboardController=M.Controller.extend({items:null,itemsButtons:null,itemsWithoutUpdate:null,latestId:null,lastTimestampDatatransfer:null,appCacheUpdateReady:function(){if(window.applicationCache)if(window.applicationCache.status==window.applicationCache.UPDATEREADY)return true;else{if(DigiWebApp.ApplicationController.timeouthappened&&window.applicationCache.status!==window.applicationCache.UNCACHED)try{window.applicationCache.update()}catch(a){console.error(a)}return window.applicationCache.status==
window.applicationCache.UPDATEREADY}else return false},initButtons:function(a){this.init(a);a={};for(var b=[],c=0;c<this.items.length;c++){a.label=this.items[c].label;a.id=this.items[c].id;switch(this.items[c].label){case M.I18N.l("closingTime"):a.icon="48x48_plain_home.png";break;case M.I18N.l("dataTransfer"):a.icon="48x48_plain_refresh.png";break;case M.I18N.l("handApplications"):a.icon="48x48_plain_handauftrag.png";break;case M.I18N.l("timeData"):a.icon="48x48_plain_note_view.png";break;case M.I18N.l("orderInfo"):a.icon=
"48x48_plain_folder_view.png";break;case M.I18N.l("media"):a.icon="48x48_plain_index.png";break;case M.I18N.l("materialPickUp"):a.icon="48x48_plain_shelf.png";break;case M.I18N.l("dailyChecklist"):a.icon="48x48_plain_pda_write.png";break;case M.I18N.l("Anwesenheitsliste"):a.icon="48x48_plain_text_code.png";break;case M.I18N.l("Bautagebuch"):a.icon="48x48_plain_graphics-tablet.png";break;case M.I18N.l("settings"):a.icon="48x48_plain_gears.png";break;case M.I18N.l("info"):a.icon="48x48_plain_about.png";
break;default:a.icon="icon_info.png"}b.push(JSON.parse(JSON.stringify(a)))}this.set("itemsButtons",b)},init:function(a){if(DigiWebApp.DashboardPage.needsUpdate||a||this.appCacheUpdateReady()){a=DigiWebApp.SettingsController.featureAvailable("409");var b;b=a?[{label:M.I18N.l("dataTransfer"),icon:"icon_dataTransfer.png",id:"dataTransfer"}]:[{label:M.I18N.l("closingTime"),icon:"icon_closingTime.png",id:"closingTime"},{label:M.I18N.l("dataTransfer"),icon:"icon_dataTransfer.png",id:"dataTransfer"},{label:M.I18N.l("handApplications"),
icon:"icon_handApplication.png",id:"handOrder"},{label:M.I18N.l("timeData"),icon:"icon_timeData.png",id:"timeData"}];if(DigiWebApp.SettingsController.featureAvailable("410")){b=_.map(b,function(d){if(d.id!=="handOrder")return d});b=_.compact(b)}if(DigiWebApp.SettingsController.featureAvailable("420")){b=_.map(b,function(d){if(d.id!=="closingTime")return d});b=_.compact(b)}DigiWebApp.SettingsController.featureAvailable("406")&&!a&&b.push({label:M.I18N.l("orderInfo"),icon:"icon_info.png",id:"orderInfo"});
var c=DigiWebApp.SettingsController.featureAvailable("400");DigiWebApp.SettingsController.featureAvailable("401")&&!a&&b.push({label:M.I18N.l("media")+" (DEMO)",icon:"icon_media.png",id:"demomedia"});c&&b.push({label:M.I18N.l("media"),icon:"icon_media.png",id:"media"});c=DigiWebApp.SettingsController.featureAvailable("402");if($(window).width()<=480&&DigiWebApp.SettingsController.getSetting("treatAllAsTablet")===false)c=false;c&&!a&&b.push({label:M.I18N.l("materialPickUp"),icon:"icon_info.png",id:"materialerfassung"});
DigiWebApp.SettingsController.featureAvailable("407")&&!a&&b.push({label:M.I18N.l("dailyChecklist"),icon:"icon_info.png",id:"tagescheckliste"});DigiWebApp.SettingsController.featureAvailable("408")&&b.push({label:M.I18N.l("Anwesenheitsliste"),icon:"icon_info.png",id:"anwesenheitsliste"});DigiWebApp.SettingsController.featureAvailable("412")&&b.push({label:M.I18N.l("Bautagebuch"),icon:"icon_info.png",id:"bautagebuch"});b.push({label:M.I18N.l("settings"),icon:"icon_settings.png",id:"settings"});b.push({label:M.I18N.l("info"),
icon:"icon_info.png",id:"info"});this.set("items",b);this.set("itemsWithoutUpdate",b);DigiWebApp.DashboardPage.needsUpdate=false}if(window.newAppVersionAvailable){a=this.itemsWithoutUpdate;a.push({label:M.I18N.l("updateApplication"),icon:"icon_info.png",id:"updateApplication"});this.set("items",a)}else this.set("items",this.itemsWithoutUpdate);(a=M.ViewManager.getView("dashboard","list"))&&$("#"+a.id).find("li").each(function(){$(this).removeClass("selected")})},itemSelected:function(a,b){try{DigiWebApp.ApplicationController.vibrate()}catch(c){}var d=
this;this.latestId&&$("#"+this.latestId).removeClass("selected");$("#"+a).addClass("selected");this.latestId=a;if(b&&typeof this[b]==="function")this[b]();else try{_.each(DigiWebApp.ButtonDashboardPage.content.list.contentBinding.target[DigiWebApp.ButtonDashboardPage.content.list.contentBinding.property],function(e){var g=$("#"+a).html(),h=d[e.id];e.label===g&&typeof h==="function"&&h()})}catch(f){}},bookTime:function(){DigiWebApp.NavigationController.toBookTimePageTransition(YES)},closingTime:function(){DigiWebApp.ApplicationController.DigiLoaderView.show(M.I18N.l("bucheFeierabend"));
setTimeout(DigiWebApp.BookingController.closeDay,100)},dataTransfer:function(a){var b=NO;if(DigiWebApp.DashboardController.lastTimestampDatatransfer!==null)if(D8.now().getTimestamp()-DigiWebApp.DashboardController.lastTimestampDatatransfer>parseInt(DigiWebApp.SettingsController.getSetting("datatransfer_min_delay")))b=YES;if(b===YES||DigiWebApp.DashboardController.lastTimestampDatatransfer===null){DigiWebApp.ApplicationController.DigiLoaderView.show(M.I18N.l("starteDatenuebertragung"));DigiWebApp.DashboardController.set("lastTimestampDatatransfer",
D8.now().getTimestamp());if(DigiWebApp.Booking.find().length>0){var c=function(){DigiWebApp.BookingController.sendBookings(a,true)};DigiWebApp.SettingsController.featureAvailable("417")&&DigiWebApp.SettingsController.getSetting("ServiceApp_ermittleGeokoordinate")?function(){DigiWebApp.SettingsController.getSetting("debug")&&console.log("polling for bookinglocations");var d=[];DigiWebApp.BookingController.currentBooking!==null&&typeof DigiWebApp.BookingController.currentBooking.get("timeStampEnd")!==
"undefined"&&parseInt(DigiWebApp.BookingController.currentBooking.get("timeStampEnd"))>0&&d.push(DigiWebApp.BookingController.currentBooking.m_id);DigiWebApp.BookingController.currentBookingClosed!==null&&d.push(DigiWebApp.BookingController.currentBookingClosed.m_id);DigiWebApp.ServiceAppController.pollBookings(d,function(f){DigiWebApp.SettingsController.getSetting("debug")&&console.log(f.length+" Datens\u00e4tze empfangen");_.each(f,function(e){try{DigiWebApp.SettingsController.getSetting("debug")&&
console.log("speichere gepollten Datensatz "+e.m_id);var g=_.find(DigiWebApp.Booking.find(),function(j){return j.m_id===e.m_id}),h=e.record;DigiWebApp.SettingsController.getSetting("debug")&&console.log("modelBooking: ",g);DigiWebApp.SettingsController.getSetting("debug")&&console.log("datensatz: ",h);g.set("latitude",h.latitude);g.set("latitude_bis",h.latitude_bis);g.set("longitude",h.longitude);g.set("longitude_bis",h.longitude_bis);g.set("ermittlungsverfahrenBis",h.ermittlungsverfahren_bis);g.set("ermittlungsverfahrenVon",
h.ermittlungsverfahren);g.set("genauigkeitBis",h.genauigkeit_bis);g.set("genauigkeitVon",h.genauigkeit);g.set("gps_zeitstempelBis",h.gps_zeitstempel_bis);g.set("gps_zeitstempelVon",h.gps_zeitstempel);g.set("ServiceApp_Status",h.status);g.save();DigiWebApp.SettingsController.getSetting("debug")&&console.log("datensatz "+e.m_id+" gespeichert")}catch(i){DigiWebApp.SettingsController.getSetting("debug")&&console.log("datensatz "+e.m_id+" nicht gefunden")}});c()},c,DigiWebApp.SettingsController.getSetting("GPSTimeOut"))}():
c()}else DigiWebApp.ApplicationController.startsync(YES)}},settings:function(){DigiWebApp.NavigationController.toSettingsPasswordPageTransition()},timeData:function(){DigiWebApp.NavigationController.toTimeDataPageTransition()},handOrder:function(){DigiWebApp.NavigationController.toHandOrderPageTransition()},info:function(){DigiWebApp.NavigationController.toInfoPageTransition()},demomedia:function(){},media:function(){DigiWebApp.NavigationController.toMediaListPageTransition()},orderInfo:function(){DigiWebApp.NavigationController.toOrderInfoPageTransition()},
updateApplication:function(){if(this.appCacheUpdateReady()){window.applicationCache.swapCache();typeof localStorage!=="undefined"&&localStorage.setItem("reloadAppOneMoreTime","true");if(typeof navigator.app!=="undefined")typeof location.origin!=="undefined"?navigator.app.loadUrl(location.origin+location.pathname):navigator.app.loadUrl(location.protocol+"//"+location.pathname);else window.location.reload()}else DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("noApplicationUpdateAvailable"),
message:M.I18N.l("noApplicationUpdateAvailableMsg")})},materialerfassung:function(){},tagescheckliste:function(){DigiWebApp.NavigationController.toStudieChecklistePage()},anwesenheitsliste:function(){DigiWebApp.NavigationController.toAnwesenheitslistePageTransition()},bautagebuch:function(){DigiWebApp.NavigationController.toBautagebuchBautageberichteListePageTransition()},buttonMenu:function(){DigiWebApp.NavigationController.toButtonsDashboardPageFlipTransition()}});
DigiWebApp.OrderDetailsController=M.Controller.extend({positionForDetails:null,loadedPosition:null,init:function(a){var b=DigiWebApp.OrderDetailsController;b.items===null?DigiWebApp.RequestController.getDatabaseServer(b.initWithServer,a):b.initWithServer(a)},initWithServer:function(){var a=DigiWebApp.OrderDetailsController;if(a.positionForDetails===null){DigiWebApp.ApplicationController.DigiLoaderView.show(M.I18N.l("positionLaden"));DigiWebApp.OnlinePosition.find({urlParams:{},callbacks:{success:{action:function(b){DigiWebApp.ApplicationController.DigiLoaderView.hide();
if(b&&b.length===0||parseInt(DigiWebApp.ZeitbuchungenController.itemForDetails.get("positionsId"))===0)DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("error"),message:M.I18N.l("positionKonnteNichtGeladenWerden"),callbacks:{confirm:{target:a,action:function(){DigiWebApp.NavigationController.backToZeitbuchungDetailsPageTransition()}}}});else{a.set("loadedPosition",b);a.setItem()}}},error:{action:function(){DigiWebApp.ApplicationController.DigiLoaderView.hide();DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("error"),
message:M.I18N.l("positionKonnteNichtGeladenWerden"),callbacks:{confirm:{target:a,action:function(){DigiWebApp.NavigationController.backToZeitbuchungDetailsPageTransition()}}}})}}}})}},setItem:function(){var a=DigiWebApp.OrderDetailsController,b={orderName:"",positionName:"",positionStrasse:"",positionHausnummer:"",positionPLZ:"",positionOrt:"",positionLand:"",positionStrasseUndHausnummer:"",positionPLZundOrt:"",positionCountryCode:"",positionTelefon:"",positionFax:"",positionEmail:"",positionAnsprechpartner:"",
positionKundenname:"",positionLongitude:"",positionLatitude:"",positionBeschreibung:""};b.orderName=a.loadedPosition[0].get("auftragsBezeichnung");b.positionName=a.loadedPosition[0].get("positionsBezeichnung");b.positionStrasse=a.loadedPosition[0].get("strasse");b.positionHausnummer=a.loadedPosition[0].get("hausnummer");b.positionPLZ=a.loadedPosition[0].get("plz");b.positionOrt=a.loadedPosition[0].get("ort");b.positionLand=a.loadedPosition[0].get("land");b.positionTelefon=a.loadedPosition[0].get("telefon");
b.positionFax=a.loadedPosition[0].get("fax");b.positionEmail=a.loadedPosition[0].get("email");b.positionAnsprechpartner=a.loadedPosition[0].get("ansprechpartner");b.positionKundenname=a.loadedPosition[0].get("kundenname");b.positionLongitude=a.loadedPosition[0].get("longitude");b.positionLatitude=a.loadedPosition[0].get("latitude");b.positionBeschreibung=a.loadedPosition[0].get("positionsBeschreibung");b.positionCountryCode=a.loadedPosition[0].get("countrycode");b.positionPLZundOrt=b.positionPLZ+
" "+b.positionOrt;b.positionStrasseUndHausnummer=b.positionStrasse+" "+b.positionHausnummer;b.orderName===""&&b.positionName===""?a.set("positionForDetails",[]):a.set("positionForDetails",[b])}});
DigiWebApp.NavigationController=M.Controller.extend({toSplashViewPage:function(){DigiWebApp.SettingsController.featureAvailable("409")?DigiWebApp.NavigationController.switchToPage("splashView",M.TRANSITION.NONE,NO):DigiWebApp.NavigationController.toBookTimePage()},toSplashViewPageTransition:function(){DigiWebApp.NavigationController.toBookTimePageTransition();DigiWebApp.SettingsController.featureAvailable("409")?DigiWebApp.NavigationController.switchToPage("splashView",M.TRANSITION.FADE,NO):DigiWebApp.NavigationController.toBookTimePageTransition()},
toInfoPage:function(){DigiWebApp.NavigationController.switchToPage("infoPage",M.TRANSITION.NONE,NO)},toInfoPageTransition:function(){DigiWebApp.NavigationController.switchToPage("infoPage",M.TRANSITION.SLIDEUP,NO)},backToBookTimePage:function(){if(DigiWebApp.SettingsController.featureAvailable("409")){DigiWebApp.ApplicationController.useSplashJustForFade=YES;DigiWebApp.NavigationController.toSplashViewPage();DigiWebApp.ApplicationController.useSplashJustForFade=0}else try{DigiWebApp.SettingsController.featureAvailable("416")?
DigiWebApp.NavigationController.switchToPage("bookingPageWithIconsScholpp",M.TRANSITION.SLIDEUP,YES):DigiWebApp.NavigationController.switchToPage("bookingPage",M.TRANSITION.SLIDEUP,YES)}catch(a){console.error(a)}},backToBookTimePagePOP:function(){if(DigiWebApp.SettingsController.featureAvailable("409")){DigiWebApp.ApplicationController.useSplashJustForFade=YES;DigiWebApp.NavigationController.toSplashViewPage();DigiWebApp.ApplicationController.useSplashJustForFade=0}else try{DigiWebApp.SettingsController.featureAvailable("416")?
DigiWebApp.NavigationController.switchToPage("bookingPageWithIconsScholpp",M.TRANSITION.POP,YES):DigiWebApp.NavigationController.switchToPage("bookingPage",M.TRANSITION.POP,YES)}catch(a){console.error(a)}},toBookTimePage:function(){if(DigiWebApp.SettingsController.featureAvailable("409")){DigiWebApp.ApplicationController.useSplashJustForFade=YES;DigiWebApp.NavigationController.toSplashViewPage();DigiWebApp.ApplicationController.useSplashJustForFade=0}else DigiWebApp.SettingsController.featureAvailable("416")?
DigiWebApp.NavigationController.switchToPage("bookingPageWithIconsScholpp",M.TRANSITION.NONE,NO):DigiWebApp.NavigationController.switchToPage("bookingPage",M.TRANSITION.NONE,NO)},toBookTimePageTransition:function(){if(DigiWebApp.SettingsController.featureAvailable("409")){DigiWebApp.ApplicationController.useSplashJustForFade=YES;DigiWebApp.NavigationController.toSplashViewPage();DigiWebApp.ApplicationController.useSplashJustForFade=0}else try{DigiWebApp.SettingsController.featureAvailable("416")?
DigiWebApp.NavigationController.switchToPage("bookingPageWithIconsScholpp",M.TRANSITION.SLIDEUP,NO):DigiWebApp.NavigationController.switchToPage("bookingPage",M.TRANSITION.SLIDEUP,NO)}catch(a){console.error(a)}},toBookTimePageFlipTransition:function(){if(DigiWebApp.SettingsController.featureAvailable("409")){DigiWebApp.ApplicationController.useSplashJustForFade=YES;DigiWebApp.NavigationController.toSplashViewPage();DigiWebApp.ApplicationController.useSplashJustForFade=0}else try{DigiWebApp.SettingsController.featureAvailable("416")?
DigiWebApp.NavigationController.switchToPage("bookingPageWithIconsScholpp",M.TRANSITION.FLIP,YES):DigiWebApp.NavigationController.switchToPage("bookingPage",M.TRANSITION.FLIP,YES)}catch(a){console.error(a)}},backToBookTimePageFlipTransition:function(){if(DigiWebApp.SettingsController.featureAvailable("409")){DigiWebApp.ApplicationController.useSplashJustForFade=YES;DigiWebApp.NavigationController.toSplashViewPage();DigiWebApp.ApplicationController.useSplashJustForFade=0}else try{DigiWebApp.SettingsController.featureAvailable("416")?
DigiWebApp.NavigationController.switchToPage("bookingPageWithIconsScholpp",M.TRANSITION.FLIP,NO):DigiWebApp.NavigationController.switchToPage("bookingPage",M.TRANSITION.FLIP,NO)}catch(a){console.error(a)}},toHandOrderPage:function(){if(DigiWebApp.SettingsController.featureAvailable("409"))DigiWebApp.SettingsController.featureAvailable("404")?DigiWebApp.NavigationController.toButtonDashboardPage():DigiWebApp.NavigationController.toDashboardPage();else DigiWebApp.NavigationController.switchToPage("handOrderPage",
M.TRANSITION.NONE,NO)},toHandOrderPageTransition:function(){if(DigiWebApp.SettingsController.featureAvailable("409"))DigiWebApp.SettingsController.featureAvailable("404")?DigiWebApp.NavigationController.toButtonDashboardPage():DigiWebApp.NavigationController.toDashboardPage();else DigiWebApp.NavigationController.switchToPage("handOrderPage",M.TRANSITION.SLIDEUP,NO)},toSettingsPage:function(){DigiWebApp.NavigationController.switchToPage("settingsPage",M.TRANSITION.NONE,NO)},backToSettingsPage:function(){DigiWebApp.NavigationController.switchToPage("settingsPage",
M.TRANSITION.POP,YES)},toSettingsPasswordPage:function(){DigiWebApp.NavigationController.switchToPage("settingsPasswordPage",M.TRANSITION.NONE,NO)},toSettingsPasswordPageTransition:function(){DigiWebApp.NavigationController.switchToPage("settingsPasswordPage",M.TRANSITION.POP,NO)},toTimeDataPage:function(){DigiWebApp.NavigationController.switchToPage("timeDataPage",M.TRANSITION.NONE,NO)},toTimeDataPageTransition:function(){DigiWebApp.NavigationController.switchToPage("timeDataPage",M.TRANSITION.SLIDEUP,
NO)},backToTimeDataPage:function(){DigiWebApp.NavigationController.switchToPage("timeDataPage",M.TRANSITION.SLIDEUP,YES)},toEmployeePage:function(){DigiWebApp.NavigationController.switchToPage("employeePage",M.TRANSITION.POP,NO)},toDashboardPage:function(){DigiWebApp.NavigationController.switchToPage("dashboard",M.TRANSITION.NONE,NO)},toDashboardPageTransition:function(){DigiWebApp.NavigationController.switchToPage("dashboard",M.TRANSITION.SLIDEUP,NO)},backToDashboardPage:function(){DigiWebApp.NavigationController.switchToPage("dashboard",
M.TRANSITION.SLIDEUP,YES)},backToDashboardPagePOP:function(){DigiWebApp.NavigationController.switchToPage("dashboard",M.TRANSITION.POP,YES)},backToDashboardPageFlipTransition:function(){DigiWebApp.NavigationController.switchToPage("dashboard",M.TRANSITION.FLIP,YES)},toDashboardPageFlipTransition:function(){DigiWebApp.NavigationController.switchToPage("dashboard",M.TRANSITION.FLIP,NO)},toButtonDashboardPage:function(){DigiWebApp.NavigationController.switchToPage("buttonsDashboard",M.TRANSITION.NONE,
NO)},toButtonDashboardPageTransition:function(){DigiWebApp.NavigationController.switchToPage("buttonsDashboard",M.TRANSITION.SLIDEUP,NO)},backToButtonDashboardPage:function(){DigiWebApp.NavigationController.switchToPage("buttonsDashboard",M.TRANSITION.SLIDEUP,YES)},backToButtonDashboardPagePOP:function(){DigiWebApp.NavigationController.switchToPage("buttonsDashboard",M.TRANSITION.POP,YES)},backToButtonDashboardPageFlipTransition:function(){DigiWebApp.NavigationController.switchToPage("buttonsDashboard",
M.TRANSITION.FLIP,YES)},toButtonDashboardPageFlipTransition:function(){DigiWebApp.NavigationController.switchToPage("buttonsDashboard",M.TRANSITION.FLIP,NO)},toOrderInfoPage:function(){DigiWebApp.NavigationController.switchToPage("orderInfoPage",M.TRANSITION.NONE,NO)},toOrderInfoPageTransition:function(){DigiWebApp.NavigationController.switchToPage("orderInfoPage",M.TRANSITION.SLIDEUP,NO)},toEditPicturePage:function(){DigiWebApp.NavigationController.switchToPage("editPicturePage",M.TRANSITION.NONE,
NO)},toEditPicturePageTransition:function(){DigiWebApp.NavigationController.switchToPage("editPicturePage",M.TRANSITION.SLIDEUP,NO)},backToEditPicturePage:function(){DigiWebApp.NavigationController.switchToPage("editPicturePage",M.TRANSITION.SLIDEUP,YES)},toMediaListPage:function(){DigiWebApp.NavigationController.switchToPage("mediaListPage",M.TRANSITION.NONE,NO)},toMediaListPageTransition:function(){DigiWebApp.NavigationController.switchToPage("mediaListPage",M.TRANSITION.SLIDEUP,NO)},backToMediaListPage:function(){DigiWebApp.NavigationController.switchToPage("mediaListPage",
M.TRANSITION.NONE,YES)},backToMediaListPageTransition:function(){DigiWebApp.NavigationController.switchToPage("mediaListPage",M.TRANSITION.SLIDEUP,YES)},toCameraPage:function(){DigiWebApp.NavigationController.switchToPage("cameraPage",M.TRANSITION.NONE,NO)},toCameraPageTransition:function(){DigiWebApp.NavigationController.switchToPage("cameraPage",M.TRANSITION.SLIDEUP,NO)},toSpesenPage:function(a){if(typeof a==="function"){DigiWebApp.SpesenPage.myCallback=a;DigiWebApp.NavigationController.switchToPage("spesenPage",
M.TRANSITION.POP,NO)}},toRemarkPage:function(a){DigiWebApp.RemarkPage.myCallback=typeof a==="function"?a:function(){DigiWebApp.NavigationController.toBookTimePage();DigiWebApp.BookingController.bookWithRemark()};DigiWebApp.NavigationController.switchToPage("remarkPage",M.TRANSITION.POP,NO)},toEditTimeDataPage:function(a){DigiWebApp.EditTimeDataPage.myCallback=typeof a==="function"?a:function(){DigiWebApp.NavigationController.backToTimeDataPage()};DigiWebApp.NavigationController.switchToPage("editTimeDataPage",
M.TRANSITION.SLIDEUP,NO)},toAnwesenheitslistePage:function(){DigiWebApp.AnwesenheitslisteController.set("items",{});DigiWebApp.AnwesenheitslisteController.items=null;DigiWebApp.NavigationController.switchToPage("anwesenheitslistePage",M.TRANSITION.NONE,NO)},toAnwesenheitslistePageTransition:function(){DigiWebApp.AnwesenheitslisteController.set("items",{});DigiWebApp.AnwesenheitslisteController.items=null;DigiWebApp.NavigationController.switchToPage("anwesenheitslistePage",M.TRANSITION.SLIDEUP,NO)},
backToAnwesenheitslistePage:function(){DigiWebApp.ZeitbuchungenController.set("items",{});DigiWebApp.ZeitbuchungenController.items=null;DigiWebApp.NavigationController.switchToPage("anwesenheitslistePage",M.TRANSITION.NONE,YES)},backToAnwesenheitslistePageTransition:function(){DigiWebApp.ZeitbuchungenController.set("items",{});DigiWebApp.ZeitbuchungenController.items=null;DigiWebApp.NavigationController.switchToPage("anwesenheitslistePage",M.TRANSITION.SLIDEUP,YES)},toZeitbuchungenPage:function(){DigiWebApp.ZeitbuchungenController.set("items",
{});DigiWebApp.ZeitbuchungenController.items=null;DigiWebApp.NavigationController.switchToPage("zeitbuchungenPage",M.TRANSITION.NONE,NO)},toZeitbuchungenPageTransition:function(){DigiWebApp.ZeitbuchungenController.set("items",{});DigiWebApp.ZeitbuchungenController.items=null;DigiWebApp.NavigationController.switchToPage("zeitbuchungenPage",M.TRANSITION.SLIDEUP,NO)},backToZeitbuchungenPage:function(){DigiWebApp.ZeitbuchungenController.set("itemForDetails",{});DigiWebApp.ZeitbuchungenController.itemForDetails=
null;DigiWebApp.NavigationController.switchToPage("zeitbuchungenPage",M.TRANSITION.NONE,YES)},backToZeitbuchungenPageTransition:function(){DigiWebApp.ZeitbuchungenController.set("itemForDetails",{});DigiWebApp.ZeitbuchungenController.itemForDetails=null;DigiWebApp.NavigationController.switchToPage("zeitbuchungenPage",M.TRANSITION.SLIDEUP,YES)},toZeitbuchungDetailsPage:function(){DigiWebApp.NavigationController.switchToPage("zeitbuchungDetailsPage",M.TRANSITION.NONE,NO)},toZeitbuchungDetailsPageTransition:function(){DigiWebApp.NavigationController.switchToPage("zeitbuchungDetailsPage",
M.TRANSITION.SLIDEUP,NO)},backToZeitbuchungDetailsPage:function(){DigiWebApp.OrderDetailsController.set("positionForDetails",{});DigiWebApp.OrderDetailsController.positionForDetails=null;DigiWebApp.NavigationController.switchToPage("zeitbuchungDetailsPage",M.TRANSITION.NONE,YES)},backToZeitbuchungDetailsPageTransition:function(){DigiWebApp.OrderDetailsController.set("positionForDetails",{});DigiWebApp.OrderDetailsController.positionForDetails=null;DigiWebApp.NavigationController.switchToPage("zeitbuchungDetailsPage",
M.TRANSITION.SLIDEUP,YES)},toOrderDetailsPage:function(){DigiWebApp.NavigationController.switchToPage("orderDetailsPage",M.TRANSITION.NONE,NO)},toOrderDetailsPageTransition:function(){DigiWebApp.NavigationController.switchToPage("orderDetailsPage",M.TRANSITION.SLIDEUP,NO)},toTimeDataArchivePage:function(){DigiWebApp.NavigationController.switchToPage("timeDataArchivePage",M.TRANSITION.NONE,NO)},toTimeDataArchivePageTransition:function(){DigiWebApp.NavigationController.switchToPage("timeDataArchivePage",
M.TRANSITION.SLIDEUP,NO)},toBautagebuchBautageberichteListePageTransition:function(){DigiWebApp.NavigationController.switchToPage("bautagebuchBautageberichteListePage",M.TRANSITION.SLIDEUP,NO)},backToBautagebuchBautageberichteListePageTransition:function(){DigiWebApp.NavigationController.switchToPage("bautagebuchBautageberichteListePage",M.TRANSITION.SLIDEUP,YES)},toBautagebuchBautageberichtDetailsPageTransition:function(){DigiWebApp.NavigationController.switchToPage("bautagebuchBautageberichtDetailsPage",
M.TRANSITION.SLIDEUP,NO)},backToBautagebuchBautageberichtDetailsPageTransition:function(){DigiWebApp.NavigationController.switchToPage("bautagebuchBautageberichtDetailsPage",M.TRANSITION.SLIDEUP,YES)},toBautagebuchMaterialienListePageTransition:function(){DigiWebApp.NavigationController.switchToPage("bautagebuchMaterialienListePage",M.TRANSITION.SLIDEUP,NO)},backToBautagebuchMaterialienListePageTransition:function(){DigiWebApp.NavigationController.switchToPage("bautagebuchMaterialienListePage",M.TRANSITION.SLIDEUP,
YES)},toBautagebuchMaterialienDetailsPageTransition:function(){DigiWebApp.NavigationController.switchToPage("bautagebuchMaterialienDetailsPage",M.TRANSITION.SLIDEUP,NO)},backToBautagebuchMaterialienDetailsPageTransition:function(){DigiWebApp.NavigationController.switchToPage("bautagebuchMaterialienDetailsPage",M.TRANSITION.SLIDEUP,YES)},toBautagebuchZeitenListePageTransition:function(){DigiWebApp.NavigationController.switchToPage("bautagebuchZeitenListePage",M.TRANSITION.SLIDEUP,NO)},backToBautagebuchZeitenListePageTransition:function(){DigiWebApp.NavigationController.switchToPage("bautagebuchZeitenListePage",
M.TRANSITION.SLIDEUP,YES)},toBautagebuchZeitenDetailsPageTransition:function(){DigiWebApp.NavigationController.switchToPage("bautagebuchZeitenDetailsPage",M.TRANSITION.SLIDEUP,NO)},backToBautagebuchZeitenDetailsPageTransition:function(){DigiWebApp.NavigationController.switchToPage("bautagebuchZeitenDetailsPage",M.TRANSITION.SLIDEUP,YES)},toBautagebuchNotizenListePageTransition:function(){DigiWebApp.NavigationController.switchToPage("bautagebuchNotizenListePage",M.TRANSITION.SLIDEUP,NO)},backToBautagebuchNotizenListePageTransition:function(){DigiWebApp.NavigationController.switchToPage("bautagebuchNotizenListePage",
M.TRANSITION.SLIDEUP,YES)},toBautagebuchNotizenDetailsPageTransition:function(){DigiWebApp.NavigationController.switchToPage("bautagebuchNotizenDetailsPage",M.TRANSITION.SLIDEUP,NO)},backToBautagebuchNotizenDetailsPageTransition:function(){DigiWebApp.NavigationController.switchToPage("bautagebuchNotizenDetailsPage",M.TRANSITION.SLIDEUP,YES)},toBautagebuchMedienListePageTransition:function(){DigiWebApp.NavigationController.switchToPage("bautagebuchMedienListePage",M.TRANSITION.SLIDEUP,NO)},backToBautagebuchMedienListePageTransition:function(){DigiWebApp.NavigationController.switchToPage("bautagebuchMedienListePage",
M.TRANSITION.SLIDEUP,YES)},toBautagebuchMedienDetailsPageTransition:function(){DigiWebApp.NavigationController.switchToPage("bautagebuchMedienDetailsPage",M.TRANSITION.SLIDEUP,NO)},backToBautagebuchMedienDetailsPageTransition:function(){DigiWebApp.NavigationController.switchToPage("bautagebuchMedienDetailsPage",M.TRANSITION.SLIDEUP,YES)},toBautagebuchEinstellungenPageTransition:function(){DigiWebApp.NavigationController.switchToPage("bautagebuchEinstellungenPage",M.TRANSITION.SLIDEUP,NO)},backToBautagebuchEinstellungenPageTransition:function(){DigiWebApp.NavigationController.switchToPage("bautagebuchEinstellungenPage",
M.TRANSITION.SLIDEUP,YES)},toBautagebuchWetterPageTransition:function(){DigiWebApp.NavigationController.switchToPage("bautagebuchWetterPage",M.TRANSITION.SLIDEUP,NO)},backToBautagebuchWetterPageTransition:function(){DigiWebApp.NavigationController.switchToPage("bautagebuchWetterPage",M.TRANSITION.SLIDEUP,YES)},toBautagebuchZusammenfassungPageTransition:function(){DigiWebApp.NavigationController.switchToPage("bautagebuchZusammenfassungPage",M.TRANSITION.SLIDEUP,NO)},backToBautagebuchZusammenfassungPageTransition:function(){DigiWebApp.NavigationController.switchToPage("bautagebuchZusammenfassungPage",
M.TRANSITION.SLIDEUP,YES)},toFileChooserPageTransition:function(){DigiWebApp.NavigationController.switchToPage("fileChooserPage",M.TRANSITION.POP,NO)},toButtonsDashboardPage:function(){DigiWebApp.NavigationController.switchToPage("buttonsDashboard",M.TRANSITION.NONE,NO)},toButtonsDashboardPageTransition:function(){DigiWebApp.NavigationController.switchToPage("buttonsDashboard",M.TRANSITION.SLIDEUP,NO)},backToButtonsDashboardPage:function(){DigiWebApp.NavigationController.switchToPage("buttonsDashboard",
M.TRANSITION.SLIDEUP,YES)},backToButtonsDashboardPagePOP:function(){DigiWebApp.NavigationController.switchToPage("buttonsDashboard",M.TRANSITION.POP,YES)},backToButtonsDashboardPageFlipTransition:function(){DigiWebApp.NavigationController.switchToPage("buttonsDashboard",M.TRANSITION.FLIP,YES)},toButtonsDashboardPageFlipTransition:function(){DigiWebApp.NavigationController.switchToPage("buttonsDashboard",M.TRANSITION.FLIP,NO)}});
DigiWebApp.BautagebuchDatenuebertragungController=M.Controller.extend({successReturnCallback:function(){},errorReturnCallback:function(){},consoleLogOutput:NO,empfangen:function(a,b){var c=DigiWebApp.BautagebuchDatenuebertragungController;c.successReturnCallback=a;c.errorReturnCallback=b;DigiWebApp.RequestController.getDatabaseServer(function(){c.empfangeProjektleiter(function(){c.empfangeMitarbeiter(function(){c.empfangeMengeneinheiten(function(){c.empfangeMaterialien(c.successReturnCallback,c.successReturnCallback)},
c.errorReturnCallback)},c.errorReturnCallback)},c.errorReturnCallback)})},empfangeMengeneinheiten:function(a){a()},empfangeMaterialien:function(a,b){var c=DigiWebApp.BautagebuchDatenuebertragungController;DigiWebApp.JSONDatenuebertragungController.recieveData("materialliste",M.I18N.l("BautagebuchLadeMaterialien"),function(d,f,e){c.consoleLogOutput&&console.log("empfangeMaterialien Status: "+e.status);if(typeof d.materialliste==="undefined"){console.error("missing materialliste");return b()}if(d.materialliste!==
null){f=null;try{f=d.materialliste.length}catch(g){console.error(f)}}DigiWebApp.BautagebuchMaterial.deleteAll();_.each(d.materialliste,function(h){if(typeof h.materialbezeichnung==="undefined"){console.error("missing materialbezeichnung");return b()}else DigiWebApp.BautagebuchMaterial.createRecord({bezeichnung:h.materialbezeichnung,id:h.materialbezeichnung}).saveSorted()});a()},b)},empfangeProjektleiter:function(a,b){var c=DigiWebApp.BautagebuchDatenuebertragungController;DigiWebApp.JSONDatenuebertragungController.recieveData("mitarbeiter",
M.I18N.l("BautagebuchLadeProjektleiter"),function(d,f,e){c.consoleLogOutput&&console.log("empfangeProjektleiter Status: "+e.status);if(typeof d.mitarbeiter==="undefined"){console.error("missing mitarbeiterliste");return b()}if(d.mitarbeiter===null)return b();else{f=null;try{f=d.mitarbeiter.length}catch(g){console.error(f);return b()}}DigiWebApp.BautagebuchProjektleiter.deleteAll();_.each(d.mitarbeiter,function(h){if(typeof h.id==="undefined"){console.error("missing id");return b()}else if(typeof h.projektleiterId===
"undefined"){console.error("missing projektleiterId");return b()}else if(typeof h.vorname==="undefined"){console.error("missing projektleiter vorname");return b()}else if(typeof h.nachname==="undefined"){console.error("missing projektleiter nachname");return b()}else h.id===h.projektleiterId&&DigiWebApp.BautagebuchProjektleiter.find({query:{identifier:"id",operator:"=",value:h.id}}).length===0&&DigiWebApp.BautagebuchProjektleiter.createRecord({id:h.id,vorname:h.vorname,nachname:h.nachname}).saveSorted()});
a()},b,"getAll=true&nurKolonne=false")},empfangeMitarbeiter:function(a,b){var c=DigiWebApp.BautagebuchDatenuebertragungController;DigiWebApp.JSONDatenuebertragungController.recieveData("mitarbeiter",M.I18N.l("BautagebuchLadeMitarbeiter"),function(d,f,e){c.consoleLogOutput&&console.log("empfangeMitarbeiter Status: "+e.status);if(typeof d.mitarbeiter==="undefined"){console.error("missing projektleiterliste");return b()}if(d.mitarbeiter===null)return b();else{f=null;try{f=d.mitarbeiter.length}catch(g){console.error(f);
return b()}}DigiWebApp.BautagebuchMitarbeiter.deleteAll();_.each(d.mitarbeiter,function(h){if(typeof h.id==="undefined"){console.error("missing mitarbeiter id");return b()}else if(typeof h.vorname==="undefined"){console.error("missing mitarbeiter vorname");return b()}else if(typeof h.nachname==="undefined"){console.error("missing mitarbeiter nachname");return b()}else if(typeof h.projektleiterId==="undefined"){console.error("missing mitarbeiter projektleiterId");return b()}else DigiWebApp.BautagebuchMitarbeiter.find({query:{identifier:"id",
operator:"=",value:h.id}}).length===0&&DigiWebApp.BautagebuchMitarbeiter.createRecord({id:h.id,vorname:h.vorname,nachname:h.nachname,projektleiterId:h.projektleiterId,webAppId:h.webAppId,webAppPin:h.webAppPin}).saveSorted()});a()},b,"getAll=true&nurKolonne=true")},senden:function(a,b,c){var d=DigiWebApp.BautagebuchDatenuebertragungController;d.successReturnCallback=b;d.errorReturnCallback=c;DigiWebApp.RequestController.getDatabaseServer(function(){d.sendeBautagesbericht(a,function(){d.sendeZeitbuchungen(a,
function(){d.sendeMaterialbuchungen(a,function(){d.sendeNotizen(a,function(){d.sendeMedien(a,function(){d.sendeBautagesberichtFertig(a,d.successReturnCallback,d.errorReturnCallback)},d.errorReturnCallback)},d.errorReturnCallback)},d.errorReturnCallback)},d.errorReturnCallback)},d.errorReturnCallback)})},sendeBautagesbericht:function(a,b,c){var d=DigiWebApp.BautagebuchDatenuebertragungController;a.set("bautagesberichtId",a.m_id);a.set("transferCompleted",NO);var f=function(e,g,h){d.consoleLogOutput&&
console.log("sendeBautagesbericht Status: "+h.status);b()};if(a.hasFileName())a.readFromFile(function(e){a.set("unterschrift",JSON.parse(e));DigiWebApp.JSONDatenuebertragungController.sendData(a.record,"bautagesbericht",M.I18N.l("BautagebuchSendeBautagesbericht"),f,c)},function(){a.set("unterschrift",[{lx:1,ly:1,mx:1,my:1}]);DigiWebApp.JSONDatenuebertragungController.sendData(a.record,"bautagesbericht",M.I18N.l("BautagebuchSendeBautagesbericht"),f,c)});else{a.set("unterschrift",[{lx:1,ly:1,mx:1,my:1}]);
DigiWebApp.JSONDatenuebertragungController.sendData(a.record,"bautagesbericht",M.I18N.l("BautagebuchSendeBautagesbericht"),f,c)}},sendeZeitbuchungen:function(a,b,c){var d=[],f=DigiWebApp.BautagebuchZeitbuchung.find({query:{identifier:"bautagesberichtId",operator:"=",value:a.m_id}});f=_.sortBy(f,function(e){return parseInt(e.get("_createdAt"))});_.each(f,function(e){_.each(JSON.parse(e.get("mitarbeiterIds")),function(g){var h=DigiWebApp.BautagebuchZeitbuchung.createRecord({bautagesberichtId:a.m_id}),
i;for(i in e.record)try{typeof JSON.parse(e.get(i)).length!=="undefined"?h.set(i,JSON.parse(e.get(i))):h.set(i,e.get(i))}catch(j){h.set(i,e.get(i))}h.set("mitarbeiterId",g);d.push(h.record)})});d.length!==0?DigiWebApp.JSONDatenuebertragungController.sendData({zeitdaten:d},"zeitdaten",M.I18N.l("BautagebuchSendeZeitbuchungen"),function(e,g,h){console.log("sendeZeitbuchungen Status: "+h.status);b()},c):b()},sendeMaterialbuchungen:function(a,b,c){var d=[];_.each(DigiWebApp.BautagebuchMaterialBuchung.find({query:{identifier:"bautagesberichtId",
operator:"=",value:a.m_id}}),function(f){f=f.record;f.menge=parseInt(f.menge);d.push(f)});d.length!==0?DigiWebApp.JSONDatenuebertragungController.sendData({materialbuchungen:d},"bautagesbericht/materialbuchung",M.I18N.l("BautagebuchSendeMaterialbuchungen"),function(f,e,g){DigiWebApp.BautagebuchDatenuebertragungController.consoleLogOutput&&console.log("sendeMaterialbuchungen Status: "+g.status);b()},c):b()},sendeNotizen:function(a,b,c){var d=[];_.each(DigiWebApp.BautagebuchNotiz.find({query:{identifier:"bautagesberichtId",
operator:"=",value:a.m_id}}),function(f){d.push(f.record)});d.length!==0?DigiWebApp.JSONDatenuebertragungController.sendData({notizen:d},"bautagesbericht/notiz",M.I18N.l("BautagebuchSendeNotizen"),function(f,e,g){DigiWebApp.BautagebuchDatenuebertragungController.consoleLogOutput&&console.log("sendeNotizen Status: "+g.status);b()},c):b()},sendeMedien:function(a,b,c){DigiWebApp.ApplicationController.DigiLoaderView.show(M.I18N.l("loadMediaFiles"));var d=function(i){if(i.length!==0){var j=[];_.each(i,
function(l){j.push(l.record)});DigiWebApp.JSONDatenuebertragungController.sendData({medien:j},"medien",M.I18N.l("BautagebuchSendeMedien"),function(l,m,n){DigiWebApp.BautagebuchDatenuebertragungController.consoleLogOutput&&console.log("sendeMedien Status: "+n.status);b()},c)}else b()},f=DigiWebApp.BautagebuchMediaFile.find({query:{identifier:"bautagesberichtId",operator:"=",value:a.m_id}}),e=f.length,g=0,h=false;if(e!==0)_.each(f,function(i){console.log("loading mediaFile for mediaFilesIndex "+g);
if(i.hasFileName()){console.log("fileName: "+i.get("fileName"));i.readFromFile(function(j){j&&j!==""&&_.each(f,function(l){if(l.m_id===i.m_id){l.set("data",j);g+=1}});if(g===e&&h===false){console.log("last mediaFile done (with file)");DigiWebApp.ApplicationController.DigiLoaderView.hide();h=true;d(f)}},function(){if(g===e&&h===false){console.log("last mediaFile done (last file load failed)");DigiWebApp.ApplicationController.DigiLoaderView.hide();h=true;d(f)}})}else if(g===e&&h===false){console.log("last mediaFile done (no file)");
DigiWebApp.ApplicationController.DigiLoaderView.hide();h=true;d(f)}});else{DigiWebApp.ApplicationController.DigiLoaderView.hide();d(f)}},sendeBautagesberichtFertig:function(a,b,c){a.set("bautagesberichtId",a.m_id);a.set("transferCompleted",YES);DigiWebApp.JSONDatenuebertragungController.sendData(a.record,"bautagesbericht",M.I18N.l("BautagebuchSendeBautagesbericht"),function(d,f,e){e.status>199&&e.status<300?a.deleteSorted(function(){DigiWebApp.BautagebuchBautageberichteListeController.set("items",
DigiWebApp.BautagebuchBautagesbericht.findSorted());DigiWebApp.BautagebuchDatenuebertragungController.consoleLogOutput&&console.log("sendeBautagesberichtFertig Status: "+e.status);typeof b==="function"&&b(d,f,e)}):console.error("Request ended with status: "+e.status)},c)}});
DigiWebApp.BautagebuchZeitenListeController=M.Controller.extend({items:null,init:function(){this.set("items",DigiWebApp.BautagebuchZeitbuchung.findSorted(DigiWebApp.BautagebuchBautageberichtDetailsController.item.m_id))},neu:function(a){DigiWebApp.BautagebuchZeitenDetailsController.set("item",DigiWebApp.BautagebuchZeitbuchung.createRecord({bautagesberichtId:DigiWebApp.BautagebuchBautageberichtDetailsController.item.m_id}));DigiWebApp.BautagebuchZeitenDetailsController.set("positionId",null);DigiWebApp.BautagebuchZeitenDetailsController.set("positionName",
null);DigiWebApp.BautagebuchZeitenDetailsController.set("activityId",null);DigiWebApp.BautagebuchZeitenDetailsController.set("activityName",null);a?DigiWebApp.BautagebuchZeitenDetailsController.set("mitarbeiterIds",[a]):DigiWebApp.BautagebuchZeitenDetailsController.set("mitarbeiterIds",null);DigiWebApp.BautagebuchZeitenDetailsController.set("von","");DigiWebApp.BautagebuchZeitenDetailsController.set("bis","");DigiWebApp.BautagebuchZeitenDetailsController.set("dauer","00:00");DigiWebApp.NavigationController.toBautagebuchZeitenDetailsPageTransition();
$("#"+DigiWebApp.BautagebuchZeitenDetailsPage.header.delButton.id).hide()}});
DigiWebApp.BautagebuchEinstellungenController=M.Controller.extend({settings:{startUhrzeit:"08:00",inStundenBuchen:YES,inStundenBuchenItem:[{value:"inStundenBuchen",label:M.I18N.l("BautagebuchInStundenBuchen"),isSelected:YES}],falscheZeitenIgnorieren:NO,falscheZeitenIgnorierenItem:[{value:"falscheZeitenIgnorieren",label:M.I18N.l("falscheZeitenIgnorieren"),isSelected:NO}]},init:function(){this.load()},lastPage:null,load:function(){this.set("settings.startUhrzeit",this.settings.startUhrzeit);this.set("settings.inStundenBuchen",
this.settings.inStundenBuchen);this.set("settings.inStundenBuchenItem",this.settings.inStundenBuchenItem);this.set("settings.falscheZeitenIgnorieren",this.settings.falscheZeitenIgnorieren);this.set("settings.falscheZeitenIgnorierenItem",this.settings.falscheZeitenIgnorierenItem);if(DigiWebApp.BautagebuchEinstellungen.find().length===0){var a=DigiWebApp.BautagebuchEinstellungen.createRecord({startUhrzeit:this.settings.startUhrzeit,inStundenBuchen:this.settings.inStundenBuchen,falscheZeitenIgnorieren:this.settings.falscheZeitenIgnorieren});
a.save()}else{a=DigiWebApp.BautagebuchEinstellungen.find()[0];this.set("settings.startUhrzeit",a.get("startUhrzeit"));if(typeof a.get("inStundenBuchen")!=="undefined"){this.set("settings.inStundenBuchen",a.get("inStundenBuchen"));this.set("settings.inStundenBuchenItem",[{value:"inStundenBuchen",label:M.I18N.l("BautagebuchInStundenBuchen"),isSelected:a.get("inStundenBuchen")}])}if(typeof a.get("falscheZeitenIgnorieren")!=="undefined"){this.set("settings.falscheZeitenIgnorieren",a.get("falscheZeitenIgnorieren"));
this.set("settings.falscheZeitenIgnorierenItem",[{value:"falscheZeitenIgnorieren",label:M.I18N.l("falscheZeitenIgnorieren"),isSelected:a.get("falscheZeitenIgnorieren")}])}}},save:function(){var a=DigiWebApp.BautagebuchEinstellungen.find()[0];a.set("startUhrzeit",this.settings.startUhrzeit);a.set("inStundenBuchen",this.settings.inStundenBuchen);a.set("falscheZeitenIgnorieren",this.settings.falscheZeitenIgnorieren);a.save()}});
DigiWebApp.ServiceAppController=M.Controller.extend({ServiceAppCommunication:function(a,b,c){this.timeout=typeof c!=="undefined"?c:5E3;this._requestInterval=300;this.sendData=a;this.callback=b;this._requestFileName="DigiWebAppServiceApp."+(new Date).getTime()+".response.json";this.returnData=null;this.internalCallback=function(d){this.callback(d)};this.available=null;this.ermittleGeokoordinate=DigiWebApp.SettingsController.getSetting("ServiceApp_ermittleGeokoordinate");this.uebertragen=DigiWebApp.SettingsController.getSetting("ServiceApp_datenUebertragen");
this.engeKopplung=DigiWebApp.SettingsController.getSetting("ServiceApp_engeKopplung");this.debug=DigiWebApp.SettingsController.getSetting("debug");this.password=DigiWebApp.SettingsController.getSetting("password");this.workerId=DigiWebApp.SettingsController.getSetting("workerId");if(this.workerId==="")this.workerId=0;this.company=DigiWebApp.SettingsController.getSetting("company");if(this.company==="")this.company=0;this.WebAppVersion=DigiWebApp.app.config.version;this.WebAppGPSTimeout=DigiWebApp.SettingsController.getSetting("GPSTimeOut");
this.sendData.parameter={};this.send=function(){var d=this;d.sendData.parameter={ermittleGeokoordinate:this.ermittleGeokoordinate,uebertragen:this.uebertragen,engeKopplung:this.engeKopplung,debug:this.debug,fileName:this._requestFileName,kennwort:this.password,GeraeteId:this.workerId,firmenId:this.company,WebAppVersion:this.WebAppVersion,WebAppGPSTimeout:this.WebAppGPSTimeout};$.ajax({dataType:"json",type:"POST",crossDomain:true,processData:false,async:true,contentType:"application/json",url:"http://127.0.0.1:"+
DigiWebApp.SettingsController.getSetting("ServiceApp_PORT")+"/",data:JSON.stringify(a),success:function(f,e,g){d.returnHandler(f,e,g)},error:function(f,e,g){d.returnHandler(f,e,g)},timeout:1E3})};this.returnHandler=function(){var d=this;this._readFile_Interval_Counter=0;this._readFile_IntervalVar=window.setInterval(function(){d.readFileHandler()},this._requestInterval)};this.readFileHandler=function(){var d=this;this._readFile_Interval_Counter++;if(this._readFile_Interval_Counter>this.timeout/this._requestInterval){window.clearInterval(this._readFile_IntervalVar);
this._readFile_Interval_Counter=null;this.available=false;console.log(Error("@@@ ServiceApp is UNavailable !!!").stack);DigiWebApp.ApplicationController.DigiLoaderView.hide();this.callback(null)}this.readFromFile(this._requestFileName,function(f){window.clearInterval(d._readFile_IntervalVar);d.returnData=f;d.available=true;d.internalCallback(d.returnData)},function(){d.available=false})};this.readFromFile=function(d,f,e){var g;g=!e||typeof e!=="function"?function(j){console.error("readFromFileError",
j)}:e;if(typeof f!=="function"){console.error("readFromFileError: successCallback is not a function");return false}if(!d||d&&d.length===0){console.error("readFromFileError: no fileName given");g();return false}if(typeof window.requestFileSystem==="undefined"){console.error("readFromFileError: no LocalFileSystem available");f("");return true}try{var h=DigiWebApp.ApplicationController.CONSTApplicationQuota;typeof navigator.webkitPersistentStorage!=="undefined"?navigator.webkitPersistentStorage.requestQuota(h,
function(j){window.requestFileSystem(PERSISTENT,j,function(l){l.root.getDirectory("DIGIWebAppData",{create:true,exclusive:false},function(m){m.getFile(d,null,function(n){n.file(function(o){try{var p=new FileReader;p.onloadend=function(r){f(r.target.result)};p.readAsText(o)}catch(q){}},g)},g)},g)},g)},function(j){console.error("Error while requesting Quota",j);DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("error"),message:M.I18N.l("errorWhileRequestingQuota")+": "+err})}):
window.requestFileSystem(LocalFileSystem.PERSISTENT,0,function(j){j.root.getDirectory("DIGIWebAppData",{create:true,exclusive:false},function(l){l.getFile(d,null,function(m){m.file(function(n){try{var o=new FileReader;o.onloadend=function(q){f(q.target.result)};o.readAsText(n)}catch(p){}},g)},g)},g)},g)}catch(i){g(i)}};this.deleteFile=function(d,f,e){if(!d||d&&d.length===0){console.error("deleteFileError: no fileName given");return false}if(typeof f!=="function"){console.error("deleteFileError: successCallback is not a function");
return false}var g;g=!e||typeof e!=="function"?function(j){console.error("deleteFileError",j)}:e;if(typeof window.requestFileSystem==="undefined"){console.error("deleteFileError: no LocalFileSystem available");f("");return true}try{var h=DigiWebApp.ApplicationController.CONSTApplicationQuota;typeof navigator.webkitPersistentStorage!=="undefined"?navigator.webkitPersistentStorage.requestQuota(h,function(j){window.requestFileSystem(PERSISTENT,j,function(l){l.root.getDirectory("DIGIWebAppData",{create:true,
exclusive:false},function(m){m.getFile(d,null,function(n){try{n.remove(f,g)}catch(o){}},g)},g)},g)},function(j){console.error("Error while requesting Quota",j);DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("error"),message:M.I18N.l("errorWhileRequestingQuota")+": "+err})}):window.requestFileSystem(LocalFileSystem.PERSISTENT,0,function(j){j.root.getDirectory("DIGIWebAppData",{create:true,exclusive:false},function(l){l.getFile(d,null,function(m){try{m.remove(f,g)}catch(n){}},
g)},g)},g)}catch(i){g(i)}};this.listDataDirectory=function(d,f){var e;e=!f||typeof f!=="function"?function(i){console.error("deleteFileError",i)}:f;if(typeof d!=="function"){console.error("listDataDirectoryError: successCallback is not a function");return false}if(typeof window.requestFileSystem==="undefined"){console.error("listDataDirectoryError: no LocalFileSystem available");d("");return true}try{var g=DigiWebApp.ApplicationController.CONSTApplicationQuota;typeof navigator.webkitPersistentStorage!==
"undefined"?navigator.webkitPersistentStorage.requestQuota(g,function(i){window.requestFileSystem(PERSISTENT,i,function(j){j.root.getDirectory("DIGIWebAppData",{create:true,exclusive:false},function(l){var m=l.createReader();(function(){m.readEntries(function(n){var o=[];_.each(n,function(p){p=p.fullPath.split("/");o.push(p[p.length-1])});d(o)},function(n){console.error("error in readEntries:",n)})})()},e)},e)},function(i){console.error("Error while requesting Quota",i);DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("error"),
message:M.I18N.l("errorWhileRequestingQuota")+": "+err})}):window.requestFileSystem(LocalFileSystem.PERSISTENT,0,function(i){i.root.getDirectory("DIGIWebAppData",{create:true,exclusive:false},function(j){var l=j.createReader();(function(){l.readEntries(function(m){var n=[];_.each(m,function(o){o=o.fullPath.split("/");n.push(o[o.length-1])});d(n)},function(m){console.error("error in readEntries:",m)})})()},e)},e)}catch(h){e(h)}}},listDirectory:function(a){(new DigiWebApp.ServiceAppController.ServiceAppCommunication({},
a)).listDataDirectory(a)},deleteFile:function(a,b){(new DigiWebApp.ServiceAppController.ServiceAppCommunication({},b)).deleteFile(a,b,b)},knockknock:function(a,b,c){(new DigiWebApp.ServiceAppController.ServiceAppCommunication({GET:{buchungen:[],queryParameter:null}},function(d){if(this.available)a(d);else{console.log("this.available = "+this.available);b()}},c)).send()},getBookings:function(a,b,c,d,f){a=new DigiWebApp.ServiceAppController.ServiceAppCommunication({GET:{buchungen:[],queryParameter:{ids:a}}},
function(e){this.available?b(e):c()},d);a.engeKopplung=typeof f!=="undefined"&&f===true;a.send()},deleteFilesInServiceApp:function(a,b,c,d,f){a=new DigiWebApp.ServiceAppController.ServiceAppCommunication({DELETEFILES:{files:[],queryParameter:{fileNames:a}}},function(e){this.available?b(e):c()},d);a.engeKopplung=typeof f!=="undefined"&&f===true;a.send()},pollBookings:function(a,b,c,d){DigiWebApp.ApplicationController.DigiLoaderView.show(M.I18N.l("ServiceAppKommunikation"));this.getBookings(a,function(f){try{var e=
[];_.each(JSON.parse(f).GET.buchungen,function(h){h.status==="OK"&&e.push(h.datensatz)});b(e)}catch(g){console.error(g);c(g.message)}},function(){c()},d,true)},putBookings:function(a,b,c,d){DigiWebApp.ApplicationController.DigiLoaderView.show(M.I18N.l("ServiceAppKommunikation"));var f={PUT:{buchungen:[]}};_.each(a,function(e){f.PUT.buchungen.push({datensatz:e,status:"WAIT"})});(new DigiWebApp.ServiceAppController.ServiceAppCommunication(f,function(e){this.available?b(e):c()},d)).send()},postBookings:function(a,
b,c,d){DigiWebApp.ApplicationController.DigiLoaderView.show(M.I18N.l("ServiceAppKommunikation"));var f={POST:{buchungen:[]}};_.each(a,function(e){f.POST.buchungen.push({datensatz:e,status:"WAIT"})});(new DigiWebApp.ServiceAppController.ServiceAppCommunication(f,function(e){this.available?b(e):c()},d)).send()},deleteBookings:function(a,b,c,d){DigiWebApp.ApplicationController.DigiLoaderView.show(M.I18N.l("ServiceAppKommunikation"));a=new DigiWebApp.ServiceAppController.ServiceAppCommunication({DELETE:{buchungen:[],
queryParameter:{ids:a}}},function(f){this.available?b(f):c()},d);a.engeKopplung=typeof engeKopplungOverride!=="undefined"&&engeKopplungOverride===true;a.send()},refreshWAITBookings:function(a,b,c,d){var f=this;c=DigiWebApp.Booking.find();var e=[];_.each(c,function(h){if(typeof h.get("ServiceApp_Status")=="undefined"||h.get("ServiceApp_Status")==="WAIT")e.push(h.m_id)});var g=[];if(e.length>0)f.getBookings(e,function(h){try{var i=JSON.parse(h).GET.buchungen;_.each(i,function(l){var m=l.datensatz,n=
function(p,q){if(DigiWebApp.SettingsController.getSetting("ServiceApp_ermittleGeokoordinate")){var r=q.record;typeof r.latitude!=="undefined"&&p.set("latitude",r.latitude);typeof r.latitude_bis!=="undefined"&&p.set("latitude_bis",r.latitude_bis);typeof r.longitude!=="undefined"&&p.set("longitude",r.longitude);typeof r.longitude_bis!=="undefined"&&p.set("longitude_bis",r.longitude_bis);typeof r.ermittlungsverfahren_bis!=="undefined"&&p.set("ermittlungsverfahrenBis",r.ermittlungsverfahren_bis);typeof r.ermittlungsverfahren!==
"undefined"&&p.set("ermittlungsverfahrenVon",r.ermittlungsverfahren);typeof r.genauigkeit_bis!=="undefined"&&p.set("genauigkeitBis",r.genauigkeit_bis);typeof r.genauigkeit!=="undefined"&&p.set("genauigkeitVon",r.genauigkeit);typeof r.gps_zeitstempel_bis!=="undefined"&&p.set("gps_zeitstempelBis",r.gps_zeitstempel_bis);typeof r.gps_zeitstempel!=="undefined"&&p.set("gps_zeitstempelVon",r.gps_zeitstempel);typeof r.status!=="undefined"&&p.set("ServiceApp_Status",r.status);p.save()}},o=_.find(DigiWebApp.Booking.find(),
function(p){return p.m_id===m.m_id});o.set("ServiceApp_Status",l.status);o.save();switch(l.status){case "WAIT":n(o,m);g.push(m.m_id);break;case "OK":n(o,m);break;case "SENT":if(DigiWebApp.SettingsController.getSetting("ServiceApp_datenUebertragen")){DigiWebApp.BookingController.sentBooking(o).save();o.del()}break;case "DELETE":o.del();break;default:b("refreshWAITBookings: Unbekannter Status")}});DigiWebApp.ApplicationController.DigiLoaderView.hide();if(g.length>0&&typeof a==="function"&&d)f.pollBookings(g,
function(l){_.each(l,function(m){try{var n=_.find(DigiWebApp.Booking.find(),function(q){return q.m_id===m.m_id}),o=m.record;n.set("latitude",o.latitude);n.set("latitude_bis",o.latitude_bis);n.set("longitude",o.longitude);n.set("longitude_bis",o.longitude_bis);n.set("ermittlungsverfahrenBis",o.ermittlungsverfahren_bis);n.set("ermittlungsverfahrenVon",o.ermittlungsverfahren);n.set("genauigkeitBis",o.genauigkeit_bis);n.set("genauigkeitVon",o.genauigkeit);n.set("gps_zeitstempelBis",o.gps_zeitstempel_bis);
n.set("gps_zeitstempelVon",o.gps_zeitstempel);n.set("ServiceApp_Status",o.status);n.save()}catch(p){}});a()},a,DigiWebApp.SettingsController.getSetting("GPSTimeOut"));else typeof a==="function"&&a()}catch(j){DigiWebApp.ApplicationController.DigiLoaderView.hide();b("ERROR in refreshWAITBookings: "+j.message)}},function(){DigiWebApp.ApplicationController.DigiLoaderView.hide();b("refreshWAITBookings: ServiceApp hat nicht geantwortet!")});else typeof a==="function"&&a()}});
DigiWebApp.SelectionController=M.Controller.extend({orders:null,positions:null,activities:null,selections:{order:null,position:null,activity:null,uebernachtungskennzeichenScholpp:null,spesenkennzeichenScholpp:null},useSelections:NO,showHandOrderFirst:NO,uebernachtungskennzeichenScholpp:null,spesenkennzeichenScholpp:null,setSelectionByPreviousSelection:function(){var a=JSON.parse(JSON.stringify(this.selections));this.resetSelection();var b=DigiWebApp.HandOrder.findSorted().concat(DigiWebApp.Order.findSorted()),
c=NO;b=_.map(b,function(f){if(f){f={label:f.get("name"),value:f.get("id")};if(f.value===a.order)c=f.isSelected=YES;return f}});b=_.compact(b);DigiWebApp.SettingsController.featureAvailable("419")?b.push({label:M.I18N.l("order"),value:"0",isSelected:!c}):b.push({label:M.I18N.l("selectSomething"),value:"0",isSelected:!c});this.set("orders",b);this.setPositions();c=NO;b=_.map(this.get("positions"),function(f){if(f){f={label:f.label,value:f.value};if(f.value===a.position)c=f.isSelected=YES;return f}});
b=_.compact(b);this.set("positions",b);this.setActivities(YES);c=NO;b=_.map(this.get("activities"),function(f){if(typeof f==="undefined")console.log("UNDEFINED ACTIVITY");else{f={label:f.label,value:f.value};if(f.value===a.activity)c=f.isSelected=YES;return f}});b=_.compact(b);this.set("activities",b);if(DigiWebApp.SettingsController.featureAvailable("419")){c=NO;b=_.map(this.uebernachtungskennzeichenScholpp,function(f){if(typeof f==="undefined")console.log("UNDEFINED uebernachtungskennzeichenScholpp");
else{f={label:f.label,value:f.value};if(f.value===a.uebernachtungskennzeichenScholpp)c=f.isSelected=YES;return f}});b=_.compact(b);this.set("uebernachtungskennzeichenScholpp",b);this.saveSelection()}typeof DigiWebAppOrdinaryDesign.bookingPageWithIconsScholpp!=="undefined"&&DigiWebApp.ScholppBookingController.resetButtons();if(typeof DigiWebAppOrdinaryDesign.bookingPageWithIconsScholpp!=="undefined"){var d=M.ViewManager.getView("bookingPageWithIconsScholpp","activity").getSelection(YES);if(typeof d!==
"undefined")if(b=_.find(DigiWebApp.Activity.find(),function(f){return parseInt(f.get("id"))===d.value})){b=b.get("name");if(b.indexOf("Reisezeit")>=0||b.indexOf("Fahrzeit")>=0)DigiWebApp.ScholppBookingController.selectFahrzeit();else if(b.indexOf("Arbeitszeit")>=0)DigiWebApp.ScholppBookingController.selectArbeitszeit();else if(b.indexOf("Unterbrechung")>=0)DigiWebApp.ScholppBookingController.selectUnterbrechung();else b.indexOf("Pause")>=0?DigiWebApp.ScholppBookingController.selectPause():DigiWebApp.ScholppBookingController.selectArbeitsende()}else DigiWebApp.ScholppBookingController.selectArbeitsende();
else DigiWebApp.ScholppBookingController.selectArbeitsende()}},setSelectionWithCurrentHandOrderFirst:function(){var a=DigiWebApp.HandOrder.findSorted().concat(DigiWebApp.Order.findSorted()),b=DigiWebApp.SelectionController.getActivities(),c=NO;a=_.map(a,function(h){if(h){h={label:h.get("name"),value:h.get("id")};if(h.label===DigiWebApp.HandOrderController.currentHandOrderName)c=h.isSelected=YES;else h.isSelected=NO;return h}});a=_.compact(a);DigiWebApp.SettingsController.featureAvailable("419")?a.push({label:M.I18N.l("order"),
value:"0",isSelected:!c}):a.push({label:M.I18N.l("selectSomething"),value:"0",isSelected:!c});var d=[];d.push({label:M.I18N.l("noData"),value:"0",isSelected:YES});var f=0;b=_.map(b,function(h){if(typeof h==="undefined"){console.log("UNDEFINED ACTIVITY");return null}else{var i=null;if(f===0){c=YES;i={label:h.get("name"),value:h.get("id"),isSelected:YES}}else i={label:h.get("name"),value:h.get("id")};f++;return i}});b=_.compact(b);DigiWebApp.SettingsController.featureAvailable("419")?b.push({label:M.I18N.l("activity"),
value:"0",isSelected:!c}):b.push({label:M.I18N.l("selectSomething"),value:"0",isSelected:!c});this.resetSelection();if(DigiWebApp.SettingsController.featureAvailable("419")){c=NO;var e=_.map(this.uebernachtungskennzeichenScholpp,function(h){if(typeof h==="undefined")console.log("UNDEFINED uebernachtungskennzeichenScholpp");else{h={label:h.label,value:h.value};if(parseInt(h.value)===6)c=h.isSelected=YES;return h}});e=_.compact(e);this.set("uebernachtungskennzeichenScholpp",e);this.saveSelection()}this.set("orders",
a);this.set("positions",d);this.set("activities",b);if(typeof DigiWebAppOrdinaryDesign.bookingPageWithIconsScholpp!=="undefined"){M.ViewManager.getView("bookingPageWithIconsScholpp","position").setSelection("0");DigiWebApp.ScholppBookingController.resetButtons()}else M.ViewManager.getView("bookingPage","position").setSelection("0");if(typeof DigiWebAppOrdinaryDesign.bookingPageWithIconsScholpp!=="undefined"){var g=M.ViewManager.getView("bookingPageWithIconsScholpp","activity").getSelection(YES);if(typeof g!==
"undefined"){a=_.find(DigiWebApp.Activity.find(),function(h){return parseInt(h.get("id"))===g.value});if(typeof a==="undefined")DigiWebApp.ScholppBookingController.selectArbeitsende();else{a=a.get("name");if(a.indexOf("Reisezeit")>=0||a.indexOf("Fahrzeit")>=0)DigiWebApp.ScholppBookingController.selectFahrzeit();else if(a.indexOf("Arbeitszeit")>=0)DigiWebApp.ScholppBookingController.selectArbeitszeit();else if(a.indexOf("Unterbrechung")>=0)DigiWebApp.ScholppBookingController.selectUnterbrechung();
else a.indexOf("Pause")>=0?DigiWebApp.ScholppBookingController.selectPause():DigiWebApp.ScholppBookingController.selectArbeitsende()}}else DigiWebApp.ScholppBookingController.selectArbeitsende()}},setSelectionByCurrentBooking:function(){this.resetSelection();var a=DigiWebApp.BookingController.currentBooking,b=DigiWebApp.HandOrder.findSorted().concat(DigiWebApp.Order.findSorted()),c=(a.get("orderId")=="0"?0:a.get("orderId"))||a.get("handOrderId"),d=a.get("positionId"),f=a.get("activityId"),e=a.get("uebernachtungAuswahl");
a=_.map(b,function(i){if(i)return i.get("id")==c?{label:i.get("name"),value:i.get("id"),isSelected:YES}:{label:i.get("name"),value:i.get("id")}});a=_.compact(a);DigiWebApp.SettingsController.featureAvailable("419")?a.push({label:M.I18N.l("order"),value:"0",isSelected:!g}):a.push({label:M.I18N.l("selectSomething"),value:"0",isSelected:!g});this.set("orders",a);this.setPositions();a=_.map(this.get("positions"),function(i){if(i)return i.value===d?{label:i.label,value:i.value,isSelected:YES}:{label:i.label,
value:i.value}});a=_.compact(a);DigiWebApp.SettingsController.featureAvailable("419")?a.push({label:M.I18N.l("position"),value:"0",isSelected:!g}):a.push({label:M.I18N.l("selectSomething"),value:"0",isSelected:!g});this.set("positions",a);this.setActivities(YES);var g=NO;a=_.map(this.get("activities"),function(i){if(typeof i==="undefined"){console.log("UNDEFINED ACTIVITY");return null}else{var j=null;if(i.value==f){j={label:i.label,value:i.value,isSelected:YES};g=YES}else j={label:i.label,value:i.value};
return j}});a=_.compact(a);DigiWebApp.SettingsController.featureAvailable("419")?a.push({label:M.I18N.l("activity"),value:"0",isSelected:!g}):a.push({label:M.I18N.l("selectSomething"),value:"0",isSelected:!g});this.set("activities",a);if(typeof DigiWebAppOrdinaryDesign.bookingPageWithIconsScholpp!=="undefined"){var h=M.ViewManager.getView("bookingPageWithIconsScholpp","activity").getSelection(YES);if(typeof h!=="undefined"){a=_.find(DigiWebApp.Activity.find(),function(i){return parseInt(i.get("id"))===
h.value});if(typeof a==="undefined"){e="6";DigiWebApp.ScholppBookingController.selectArbeitsende()}else{a=a.get("name");if(a.indexOf("Reisezeit")>=0||a.indexOf("Fahrzeit")>=0)DigiWebApp.ScholppBookingController.selectFahrzeit();else if(a.indexOf("Arbeitszeit")>=0){e="6";DigiWebApp.ScholppBookingController.selectArbeitszeit()}else if(a.indexOf("Unterbrechung")>=0){e="6";DigiWebApp.ScholppBookingController.selectUnterbrechung()}else if(a.indexOf("Pause")>=0){e="6";DigiWebApp.ScholppBookingController.selectPause()}else{e=
"6";DigiWebApp.ScholppBookingController.selectArbeitsende()}}}else{e="6";DigiWebApp.ScholppBookingController.selectArbeitsende()}}if(DigiWebApp.SettingsController.featureAvailable("419")){g=NO;a=_.map(this.uebernachtungskennzeichenScholpp,function(i){if(typeof i==="undefined")console.log("UNDEFINED uebernachtungskennzeichenScholpp");else{i={label:i.label,value:i.value};if(i.value===e)g=i.isSelected=YES;return i}});a=_.compact(a);this.set("uebernachtungskennzeichenScholpp",a);this.saveSelection()}},
setPositions:function(){var a;if(typeof DigiWebAppOrdinaryDesign.bookingPageWithIconsScholpp!=="undefined"){a=M.ViewManager.getView("bookingPageWithIconsScholpp","order").getSelection(YES).value;M.ViewManager.getView("bookingPageWithIconsScholpp","uebernachtungskennzeichen").resetSelection();M.ViewManager.getView("bookingPageWithIconsScholpp","uebernachtungskennzeichen").setSelection("6")}else a=M.ViewManager.getView("bookingPage","order").getSelection(YES).value;if(a){if(DigiWebApp.SettingsController.featureAvailable("406")&&
DigiWebApp.SettingsController.getSetting("auftragsDetailsKoppeln")){typeof M.ViewManager.getView("orderInfoPage","order").getSelection()==="undefined"&&DigiWebApp.OrderInfoController.init();M.ViewManager.getView("orderInfoPage","order").setSelection(a);DigiWebApp.OrderInfoController.setPositions();DigiWebApp.OrderInfoController.setItem()}var b=DigiWebApp.Position.findSorted(),c=0;b=_.map(b,function(d){if(d){if(d.get("orderId")===a){d={label:d.get("name"),value:d.get("id")};if(c===0)d.isSelected=YES;
c+=1;return d}return null}});b=_.compact(b);b.length<1&&b.push({label:M.I18N.l("noData"),value:"0"});typeof DigiWebAppOrdinaryDesign.bookingPageWithIconsScholpp!=="undefined"?M.ViewManager.getView("bookingPageWithIconsScholpp","position").resetSelection():M.ViewManager.getView("bookingPage","position").resetSelection();this.set("positions",b);this.setActivities(YES);this.saveSelection()}},setActivities:function(a){var b=null,c=[],d=0;if(a)if(a=typeof DigiWebAppOrdinaryDesign.bookingPageWithIconsScholpp!==
"undefined"?M.ViewManager.getView("bookingPageWithIconsScholpp","position").getSelection(YES):M.ViewManager.getView("bookingPage","position").getSelection(YES))b=a.value;if(b){if(DigiWebApp.SettingsController.featureAvailable("406")&&DigiWebApp.SettingsController.getSetting("auftragsDetailsKoppeln")){typeof M.ViewManager.getView("orderInfoPage","position").getSelection()==="undefined"&&DigiWebApp.OrderInfoController.init();M.ViewManager.getView("orderInfoPage","position").setSelection(b);DigiWebApp.OrderInfoController.setItem()}var f=
[];_.each(DigiWebApp.WorkPlan.find(),function(h){parseInt(h.get("id"))===parseInt(b)&&f.push(h)});d=0;c=f.length===1?DigiWebApp.SelectionController.getActivitiesFromWorkplan(f[0]):DigiWebApp.SelectionController.getActivities()}else c=DigiWebApp.SelectionController.getActivities();var e=-1;if(typeof DigiWebApp.BookingController.currentBooking!=="undefined"&&DigiWebApp.BookingController.currentBooking!==null)e=DigiWebApp.BookingController.currentBooking.get("activityId");var g=false;_.each(c,function(h){if(typeof h===
"undefined"){console.log("UNDEFINED ACTIVITY");return null}else if(h.get("id")===e)g=true});c=_.map(c,function(h){if(typeof h==="undefined"){console.log("UNDEFINED ACTIVITY");return null}else{var i=null;i=g?{label:h.get("name"),value:h.get("id"),isSelected:h.get("id")===e?YES:NO}:{label:h.get("name"),value:h.get("id"),isSelected:d===0?YES:NO};d+=1;return i}});c=_.compact(c);if(c.length>0)DigiWebApp.SettingsController.featureAvailable("419")?c.push({label:M.I18N.l("activity"),value:"0",isSelected:NO}):
c.push({label:M.I18N.l("selectSomething"),value:"0",isSelected:NO});else c.push({label:M.I18N.l("noData"),value:"0"});if(typeof DigiWebAppOrdinaryDesign.bookingPageWithIconsScholpp!=="undefined"){M.ViewManager.getView("bookingPageWithIconsScholpp","activity").resetSelection();this.set("activities",c);DigiWebApp.ScholppBookingController.resetButtons()}else{M.ViewManager.getView("bookingPage","activity").resetSelection();this.set("activities",c)}this.saveSelection()},initSelection:function(){var a=
DigiWebApp.HandOrder.findSorted().concat(DigiWebApp.Order.findSorted()),b=DigiWebApp.Position.findSorted(),c=DigiWebApp.SelectionController.getActivities(),d=[];if(a)d=_.map(a,function(e){if(e)return{label:e.get("name"),value:e.get("id")}});DigiWebApp.SettingsController.featureAvailable("419")?d.push({label:M.I18N.l("order"),value:"0",isSelected:YES}):d.push({label:M.I18N.l("selectSomething"),value:"0",isSelected:YES});a=[];if(b)a=_.map(b,function(e){if(e)return{label:e.get("name"),value:e.get("id")}});
DigiWebApp.SettingsController.featureAvailable("419")?a.push({label:M.I18N.l("position"),value:"0",isSelected:YES}):a.push({label:M.I18N.l("selectSomething"),value:"0",isSelected:YES});b=[];if(c)b=_.map(c,function(e){if(typeof e==="undefined"){console.log("UNDEFINED ACTIVITY");return null}else return{label:e.get("name"),value:e.get("id")}});DigiWebApp.SettingsController.featureAvailable("419")?b.push({label:M.I18N.l("activity"),value:"0",isSelected:YES}):b.push({label:M.I18N.l("selectSomething"),
value:"0",isSelected:YES});this.resetSelection();this.set("orders",d);this.set("positions",a);this.set("activities",b);try{if(typeof DigiWebAppOrdinaryDesign.bookingPageWithIconsScholpp!=="undefined"){M.ViewManager.getView("bookingPageWithIconsScholpp","uebernachtungskennzeichen").setSelection("6");M.ViewManager.getView("bookingPageWithIconsScholpp","order").setSelection("0");M.ViewManager.getView("bookingPageWithIconsScholpp","position").setSelection("0");M.ViewManager.getView("bookingPageWithIconsScholpp",
"activity").setSelection("0");DigiWebApp.ScholppBookingController.resetButtons()}else{M.ViewManager.getView("bookingPage","order").setSelection("0");M.ViewManager.getView("bookingPage","position").setSelection("0");M.ViewManager.getView("bookingPage","activity").setSelection("0")}}catch(f){console.error(f)}},resetSelection:function(){try{if(typeof DigiWebAppOrdinaryDesign.bookingPageWithIconsScholpp!=="undefined"){M.ViewManager.getView("bookingPageWithIconsScholpp","uebernachtungskennzeichen").resetSelection();
M.ViewManager.getView("bookingPageWithIconsScholpp","uebernachtungskennzeichen").setSelection("6");M.ViewManager.getView("bookingPageWithIconsScholpp","order").resetSelection();M.ViewManager.getView("bookingPageWithIconsScholpp","position").resetSelection();M.ViewManager.getView("bookingPageWithIconsScholpp","activity").resetSelection()}else{M.ViewManager.getView("bookingPage","order").resetSelection();M.ViewManager.getView("bookingPage","position").resetSelection();M.ViewManager.getView("bookingPage",
"activity").resetSelection()}}catch(a){console.error(a)}},isPositionSelected:function(){var a;return(a=typeof DigiWebAppOrdinaryDesign.bookingPageWithIconsScholpp!=="undefined"?M.ViewManager.getView("bookingPageWithIconsScholpp","position").getSelection(YES):M.ViewManager.getView("bookingPage","position").getSelection(YES))&&a.value!="0"?YES:NO},isActivitySelected:function(){var a;return(a=typeof DigiWebAppOrdinaryDesign.bookingPageWithIconsScholpp!=="undefined"?M.ViewManager.getView("bookingPageWithIconsScholpp",
"activity").getSelection(YES):M.ViewManager.getView("bookingPage","activity").getSelection(YES))&&a.value!="0"?YES:NO},saveSelection:function(){var a=null,b=null,c=null,d=null,f=null;if(typeof DigiWebAppOrdinaryDesign.bookingPageWithIconsScholpp!=="undefined"){a=M.ViewManager.getView("bookingPageWithIconsScholpp","order").getSelection();b=M.ViewManager.getView("bookingPageWithIconsScholpp","position").getSelection();c=M.ViewManager.getView("bookingPageWithIconsScholpp","activity").getSelection();
d=M.ViewManager.getView("bookingPageWithIconsScholpp","uebernachtungskennzeichen").getSelection();f=M.ViewManager.getView("bookingPageWithIconsScholpp","spesenkennzeichen").getSelection()}else{a=M.ViewManager.getView("bookingPage","order").getSelection();b=M.ViewManager.getView("bookingPage","position").getSelection();c=M.ViewManager.getView("bookingPage","activity").getSelection()}this.selections.order=a;this.selections.position=b;this.selections.activity=c;this.selections.uebernachtungskennzeichenScholpp=
d;this.selections.spesenkennzeichenScholpp=f;if(!DigiWebApp.SelectionController.showHandOrderFirst)this.useSelections=YES},getActivities:function(a){a=a?DigiWebApp.Activity.find(a):DigiWebApp.Activity.findSorted();a=_.map(a,function(b){if(b)return parseInt(b.get("positionId"))===1?b:null});return a=_.compact(a)},getActivitiesFromWorkplan:function(a){var b=a.get("activityIds").split(","),c=[];if(b&&b.length>0)for(var d=DigiWebApp.Activity.find(),f=0;f<b.length;f++){var e=_.find(d,function(g){return parseInt(g.get("id"))===
parseInt(b[f])});e&&c.push(e)}if(parseInt(a.get("workplanType"))===1)c=_.map(c,function(g){if(typeof g==="undefined"){console.log("UNDEFINED ACTIVITY");return null}else{var h=NO,i=DigiWebApp.Activity.findSorted();_.each(i,function(j){if(g.get("id")===j.get("id")&&parseInt(j.get("positionId"))===1)h=YES});return h?g:null}});return c=_.compact(c)}});
DigiWebApp.BookingController=M.Controller.extend({currentBooking:null,currentBookingClosed:null,currentBookingStr:"",currentBookingTimesStampBook:null,isBackFromEmployeePage:NO,isBackFromRemarkPage:NO,timeData:null,timeDataSent:null,timeDataForEdit:null,timeDataSentDays:null,timeDataSentArchived:null,dayToDisplay:null,init:function(a){if(a){DigiWebApp.SelectionController.set("uebernachtungskennzeichenScholpp",JSON.parse('[{"label":"Keine \u00dcbernachtung","value":"1","isSelected":true},{"label":"Pauschal","value":"2"},{"label":"Beleg (Hotel)","value":"3"},{"label":"Heimreise","value":"4"},{"label":"Baustellenwechsel","value":"5"},{"label":"- -","value":"6"}]'));
DigiWebApp.SelectionController.set("spesenkennzeichenScholpp",JSON.parse('[{"label":" ","value":"1","isSelected":true}]'))}a=M.Environment.getPlatform();a.substr(0,10)!=="BlackBerry"&&a.substr(0,12)!=="Linux armv7l"&&DigiWebApp.ApplicationController.setTransitionsSetting();this.isBackFromRemarkPage||this.isBackFromEmployeePage?this.refreshCurrentBooking(false):this.refreshCurrentBooking(true);if(this.isBackFromEmployeePage)DigiWebApp.BookingController.set("isBackFromEmployeePage",NO);else if(this.isBackFromRemarkPage)DigiWebApp.BookingController.set("isBackFromRemarkPage",
NO);else if(DigiWebApp.SelectionController.useSelections)DigiWebApp.SelectionController.setSelectionByPreviousSelection();else if(DigiWebApp.SelectionController.showHandOrderFirst){DigiWebApp.SelectionController.showHandOrderFirst=NO;DigiWebApp.SelectionController.setSelectionWithCurrentHandOrderFirst()}else this.currentBooking?DigiWebApp.SelectionController.setSelectionByCurrentBooking():DigiWebApp.SelectionController.initSelection()},refreshCurrentBooking:function(a){var b=DigiWebApp.Booking.find(),
c=null;if(b.length>0)c=_.select(b,function(d){if(d)return d.get("isCurrent")===true});if(c&&c.length>0){this.set("currentBooking",c[0]);this.set("currentBookingStr",this.buildBookingStr(this.currentBooking));a&&DigiWebApp.SelectionController.setSelectionByCurrentBooking()}},book:function(){DigiWebApp.BookingController.currentBookingTimesStampBook=new Date;try{DigiWebApp.ApplicationController.vibrate()}catch(a){}DigiWebApp.SettingsController.getSetting("debug")&&console.log("in book");if(this.checkBooking())if(this.currentBooking)if(DigiWebApp.SettingsController.featureAvailable("403")&&
!DigiWebApp.SettingsController.getSetting("remarkIsOptional")||DigiWebApp.SettingsController.featureAvailable("422")&&DigiWebApp.Activity.findById(DigiWebApp.BookingController.currentBooking.get("activityId")).get("istFahrzeitRelevant")){this.refreshCurrentBooking(false);DigiWebApp.NavigationController.toRemarkPage(function(){DigiWebApp.BookingController.set("isBackFromRemarkPage",YES);DigiWebApp.NavigationController.backToBookTimePagePOP();DigiWebApp.ApplicationController.DigiLoaderView.hide();DigiWebApp.ApplicationController.DigiLoaderView.show(M.I18N.l("Save"));
DigiWebApp.BookingController.bookWithRemark()})}else{DigiWebApp.ApplicationController.DigiLoaderView.hide();DigiWebApp.ApplicationController.DigiLoaderView.show(M.I18N.l("Save"));DigiWebApp.BookingController.bookWithRemark()}else{DigiWebApp.ApplicationController.DigiLoaderView.hide();DigiWebApp.ApplicationController.DigiLoaderView.show(M.I18N.l("Save"));DigiWebApp.BookingController.bookWithRemark()}},bookWithRemark:function(){DigiWebApp.SettingsController.getSetting("debug")&&console.log("in bookWithRemark");
this.setNotBookedBookings();this.refreshCurrentBooking(false);if(DigiWebApp.EmployeeController.getEmployeeState()==1){DigiWebApp.ApplicationController.DigiLoaderView.hide();!localStorage.getItem(DigiWebApp.EmployeeController.empSelectionKey)&&DigiWebApp.Booking.find().length===0?DigiWebApp.NavigationController.toEmployeePage():DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("transmitFirst"),message:M.I18N.l("transmitFirstMsg")})}else this.getBookingLocation(this.proceedBooking)},
getBookingLocation:function(a){DigiWebApp.SettingsController.getSetting("debug")&&console.log("in getBookingLocation");var b=DigiWebApp.BookingController,c=function(d){DigiWebApp.ApplicationController.DigiLoaderView.show(M.I18N.l("getGPSPositionMsg"));var f={enableHighAccuracy:NO,timeout:DigiWebApp.SettingsController.getSetting("GPSTimeOut")};M.LocationManager.getLocation(b,d,function(){var e={enableHighAccuracy:YES,timeout:DigiWebApp.SettingsController.getSetting("GPSTimeOut")};M.LocationManager.getLocation(b,
d,function(g){if(g==="POSITION_UNAVAILABLE")DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("GPSError"),message:M.I18N.l("GPSunavailable")});else if(g==="TIMEOUT")DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("GPSError"),message:M.I18N.l("GPStimeout")});else g==="PERMISSION_DENIED"?DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("GPSError"),message:M.I18N.l("GPSmissingPermission")}):DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("GPSError"),
message:M.I18N.l("GPSunknownError")+g});d()},e)},f)};if(DigiWebApp.SettingsController.featureAvailable("417")&&DigiWebApp.SettingsController.getSetting("ServiceApp_ermittleGeokoordinate")&&DigiWebApp.SettingsController.getSetting("autoSaveGPSData"))DigiWebApp.SettingsController.getSetting("ServiceApp_FallBack")?DigiWebApp.ServiceAppController.knockknock(function(){DigiWebApp.SettingsController.getSetting("debug")&&console.log("ServiceApp is available");a()},function(){DigiWebApp.SettingsController.getSetting("debug")&&
console.log("ServiceApp is NOT available");c(a)}):a();else DigiWebApp.SettingsController.getSetting("autoSaveGPSData")?c(a):a()},checkBooking:function(a){DigiWebApp.SettingsController.getSetting("debug")&&console.log("in checkBooking");var b;b=typeof DigiWebAppOrdinaryDesign.bookingPageWithIconsScholpp!=="undefined"?M.ViewManager.getView("bookingPageWithIconsScholpp","order").getSelection():M.ViewManager.getView("bookingPage","order").getSelection();if(!b||b&&parseInt(b)===0){DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("noOrderSelected"),
message:M.I18N.l("noOrderSelectedMsg")});return false}else{if(this.isHandOrder(b)){if(!DigiWebApp.SelectionController.isActivitySelected()){DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("noActSelected"),message:M.I18N.l("noActSelectedMsg")});return false}}else if(DigiWebApp.SelectionController.isPositionSelected()){if(!DigiWebApp.SelectionController.isActivitySelected()){DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("noActSelected"),message:M.I18N.l("noActSelectedMsg")});
return false}}else{DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("noPosSelected"),message:M.I18N.l("noPosSelectedMsg")});return false}var c;if(typeof a==="undefined"){a=(a=typeof DigiWebAppOrdinaryDesign.bookingPageWithIconsScholpp!=="undefined"?M.ViewManager.getView("bookingPageWithIconsScholpp","position").getSelection(YES):M.ViewManager.getView("bookingPage","position").getSelection(YES))?a.value:null;c=(c=typeof DigiWebAppOrdinaryDesign.bookingPageWithIconsScholpp!=="undefined"?
M.ViewManager.getView("bookingPageWithIconsScholpp","activity").getSelection(YES):M.ViewManager.getView("bookingPage","activity").getSelection(YES))?c.value:null;if(this.currentBooking){var d=this.currentBooking.get("orderId"),f=this.currentBooking.get("handOrderId"),e=this.currentBooking.get("positionId"),g=this.currentBooking.get("activityId");if(d===b||f===b){if(!this.isHandOrder(b)&&e===a&&g===c){DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("doubleBooking"),message:M.I18N.l("doubleBookingMsg")});
return false}if(this.isHandOrder(b)&&g===c){DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("doubleBooking"),message:M.I18N.l("doubleBookingMsg")});return false}}return true}}return true}},proceedBooking:function(a){DigiWebApp.SettingsController.getSetting("debug")&&console.log("in proceedBooking");var b=DigiWebApp.BookingController,c;c=typeof DigiWebAppOrdinaryDesign.bookingPageWithIconsScholpp!=="undefined"?M.ViewManager.getView("bookingPageWithIconsScholpp","order").getSelection():
M.ViewManager.getView("bookingPage","order").getSelection();var d;d=(d=typeof DigiWebAppOrdinaryDesign.bookingPageWithIconsScholpp!=="undefined"?M.ViewManager.getView("bookingPageWithIconsScholpp","position").getSelection(YES):M.ViewManager.getView("bookingPage","position").getSelection(YES))?d.value:null;var f;f=(f=typeof DigiWebAppOrdinaryDesign.bookingPageWithIconsScholpp!=="undefined"?M.ViewManager.getView("bookingPageWithIconsScholpp","activity").getSelection(YES):M.ViewManager.getView("bookingPage",
"activity").getSelection(YES))?f.value:null;if(b.currentBooking){b.currentBooking.closeBooking(a);b.currentBooking.removeAsCurrent();b.currentBooking.save();b.currentBookingClosed=b.currentBooking}else{DigiWebApp.SettingsController.setSetting("currentTimezoneOffset",(new Date).getTimezoneOffset());DigiWebApp.SettingsController.setSetting("currentTimezone",jstz.determine().name())}var e=null,g=null;if(b.isHandOrder(c)){e=c;g=_.select(DigiWebApp.HandOrder.findSorted(),function(n){if(n)return n.get("id")===
c||n.get("name")===c})[0].get("name");d=c=null}var h=null,i=null;if(a){if(a.latitude)h=a.latitude;if(a.longitude)i=a.longitude}try{M.ViewManager.getView("remarkPage","remarkInput").value=""}catch(j){}a=b.openBooking({oId:c,hoId:e,hoName:g,lat:h,lon:i,pId:d,aId:f,remark:""});d=localStorage.getItem(DigiWebApp.EmployeeController.empSelectionKey)||localStorage.getItem(DigiWebApp.EmployeeController.empSelectionKeyTmp);f=[];if(d&&d!=="0"){a.set("istKolonnenbuchung",true);f=d.split(",")}else{a.set("istKolonnenbuchung",
false);f=[DigiWebApp.SettingsController.getSetting("mitarbeiterId")]}a.set("employees",f.join());if(DigiWebApp.SettingsController.featureAvailable("419"))if(a.get("activityName")==="Reisezeit"||a.get("activityName")==="Fahrzeit"){d=M.ViewManager.getView("bookingPageWithIconsScholpp","uebernachtungskennzeichen").getSelection(YES);a.set("uebernachtungAuswahl",d?d.value:6)}else a.set("uebernachtungAuswahl",0);else a.set("uebernachtungAuswahl",0);b.set("currentBooking",a);b.currentBooking.setAsCurrent();
b.currentBooking.save();b.set("currentBookingStr",b.buildBookingStr(b.currentBooking));DigiWebApp.SelectionController.useSelections=NO;var l=function(){DigiWebApp.ApplicationController.DigiLoaderView.hide();DigiWebApp.SettingsController.getSetting("debug")&&console.log("Kommunikation mit ServiceApp beendet");b.autoSend()&&b.sendCurrentBookings()};if(DigiWebApp.SettingsController.featureAvailable("417")&&DigiWebApp.SettingsController.getSetting("ServiceApp_ermittleGeokoordinate"))if(DigiWebApp.SettingsController.getSetting("ServiceApp_engeKopplung")||
DigiWebApp.SettingsController.getSetting("autoTransferAfterBookTime")){var m=function(){DigiWebApp.SettingsController.getSetting("debug")&&console.log("polling for bookinglocations");var n=[];DigiWebApp.BookingController.currentBooking!==null&&n.push(DigiWebApp.BookingController.currentBooking.m_id);DigiWebApp.BookingController.currentBookingClosed!==null&&n.push(DigiWebApp.BookingController.currentBookingClosed.m_id);DigiWebApp.ServiceAppController.pollBookings(n,function(o){DigiWebApp.SettingsController.getSetting("debug")&&
console.log(o.length+" Datens\u00e4tze empfangen");_.each(o,function(p){try{DigiWebApp.SettingsController.getSetting("debug")&&console.log("speichere gepollten Datensatz "+p.m_id);var q=_.find(DigiWebApp.Booking.find(),function(t){return t.m_id===p.m_id}),r=p.record;DigiWebApp.SettingsController.getSetting("debug")&&console.log("modelBooking: ",q);DigiWebApp.SettingsController.getSetting("debug")&&console.log("datensatz: ",r);q.set("latitude",r.latitude);q.set("latitude_bis",r.latitude_bis);q.set("longitude",
r.longitude);q.set("longitude_bis",r.longitude_bis);q.set("ermittlungsverfahrenBis",r.ermittlungsverfahren_bis);q.set("ermittlungsverfahrenVon",r.ermittlungsverfahren);q.set("genauigkeitBis",r.genauigkeit_bis);q.set("genauigkeitVon",r.genauigkeit);q.set("gps_zeitstempelBis",r.gps_zeitstempel_bis);q.set("gps_zeitstempelVon",r.gps_zeitstempel);q.set("ServiceApp_Status",r.status);q.save();DigiWebApp.SettingsController.getSetting("debug")&&console.log("datensatz "+p.m_id+" gespeichert")}catch(s){DigiWebApp.SettingsController.getSetting("debug")&&
console.log("datensatz "+p.m_id+" nicht gefunden")}});l()},l,DigiWebApp.SettingsController.getSetting("GPSTimeOut"))};a=function(){DigiWebApp.SettingsController.getSetting("debug")&&console.log("put currentBooking");DigiWebApp.ServiceAppController.putBookings([b.currentBooking],m,l)};if(b.currentBookingClosed!==null){DigiWebApp.SettingsController.getSetting("debug")&&console.log("post currentBookingClosed");DigiWebApp.ServiceAppController.postBookings([b.currentBookingClosed],a,a)}else{DigiWebApp.SettingsController.getSetting("debug")&&
console.log("put currentBooking");DigiWebApp.ServiceAppController.putBookings([b.currentBooking],m,a)}}else if(b.currentBookingClosed!==null){a=function(){var n=function(){DigiWebApp.SettingsController.getSetting("debug")&&console.log("refreshWAIT");DigiWebApp.ServiceAppController.refreshWAITBookings(function(){DigiWebApp.SettingsController.getSetting("debug")&&console.log("refreshWAIT done");l()},function(o){DigiWebApp.ApplicationController.DigiLoaderView.hide();console.error(o)})};DigiWebApp.SettingsController.getSetting("debug")&&
console.log("put currentBooking");DigiWebApp.ServiceAppController.putBookings([b.currentBooking],n,n)};DigiWebApp.SettingsController.getSetting("debug")&&console.log("post currentBookingClosed");DigiWebApp.ServiceAppController.postBookings([b.currentBookingClosed],a,a)}else{DigiWebApp.SettingsController.getSetting("debug")&&console.log("put currentBooking");DigiWebApp.ServiceAppController.putBookings([b.currentBooking],l,l)}else l()},sendCurrentBookings:function(){DigiWebApp.BookingController.sendBookings()},
isHandOrder:function(a){return _.select(DigiWebApp.HandOrder.findSorted(),function(b){if(b)return b.get("id")==a||b.get("name")==a}).length>0?YES:NO},autoSend:function(){return DigiWebApp.SettingsController.getSetting("autoTransferAfterBookTime")},openBooking:function(a){var b=M.I18N.l("notDefined"),c=M.I18N.l("notDefined"),d=M.I18N.l("notDefined");try{var f=a.oId,e=a.hoId;if(f!==null||e!=null){var g=_.select(DigiWebApp.Order.findSorted().concat(DigiWebApp.HandOrder.findSorted()),function(p){if(p){p=
p.get("id");return f==p||e==p}});if(g&&g.length>0){g=g[0];b=g.get("name")}}}catch(h){console.error(h)}try{if(a.pId!=null){var i=_.find(DigiWebApp.Position.find(),function(p){return parseInt(p.get("id"))===a.pId});if(i&&a.pId!==0)c=i.get("name")}}catch(j){console.error(j)}try{if(a.aId!=null){var l=_.find(DigiWebApp.Activity.find(),function(p){return parseInt(p.get("id"))===a.aId});if(l&&a.aId!==0)d=l.get("name")}}catch(m){console.error(m)}var n;try{n=DigiWebApp.BookingController.currentBookingTimesStampBook}catch(o){n=
new Date}g=new Date(n.getTime()+6E4*((new Date).getTimezoneOffset()-Number(DigiWebApp.SettingsController.getSetting("currentTimezoneOffset"))));i=M.Date.create(g.getTime());g=i.format("dd.mm.yyyy");i=i.format("HH:MM");return DigiWebApp.Booking.createRecord({orderId:a.oId?a.oId:null,orderName:b,handOrderId:a.hoId?a.hoId:null,handOrderName:a.hoName?a.hoName:null,latitude:a.lat?a.lat:null,longitude:a.lon?a.lon:null,latitude_bis:null,longitude_bis:null,positionId:a.pId?a.pId:null,positionName:c,activityId:a.aId?
a.aId:null,activityName:d,remark:a.remark?a.remark:"",istFeierabend:false,istKolonnenbuchung:false,mitarbeiterId:DigiWebApp.SettingsController.getSetting("mitarbeiterId"),genauigkeitVon:null,gps_zeitstempelVon:null,ermittlungsverfahrenVon:null,genauigkeitBis:null,gps_zeitstempelBis:null,ermittlungsverfahrenBis:null,ServiceApp_Status:"WAIT",timezoneOffset:DigiWebApp.SettingsController.getSetting("currentTimezoneOffset"),timezone:DigiWebApp.SettingsController.getSetting("currentTimezone"),timeStampStart:n.getTime(),
timeStampEnd:"0",startDateString:g,endeDateString:"",startTimeString:i,endeTimeString:"",modelVersion:"1",gefahreneKilometer:0})},sentBooking:function(a){var b=M.I18N.l("notDefined"),c=M.I18N.l("notDefined"),d=M.I18N.l("notDefined");if(typeof a.get("orderName")!=="undefined")b=a.get("orderName");else try{var f=a.get("orderId"),e=a.get("handOrderId");if(f!==0||e!==0){var g=_.select(DigiWebApp.Order.findSorted().concat(DigiWebApp.HandOrder.findSorted()),function(l){if(l){l=l.get("id");return f==l||
e==l}});if(g&&g.length>0){g=g[0];b=g.get("name")}}}catch(h){console.error(h)}if(typeof a.get("positionName")!=="undefined")c=a.get("positionName");else try{if(a.get("positionId")!==0)c=_.find(DigiWebApp.Position.find(),function(l){return parseInt(l.get("id"))===a.get("positionId")}).get("name")}catch(i){console.error(i)}if(typeof a.get("activityName")!=="undefined")d=a.get("activityName");else try{if(a.get("activityId")!==0)d=_.find(DigiWebApp.Activity.find(),function(l){return parseInt(l.get("id"))===
a.get("activityId")}).get("name")}catch(j){console.error(j)}return DigiWebApp.SentBooking.createRecord({orderId:a.get("orderId"),orderName:b,handOrderId:a.get("handOrderId"),handOrderName:a.get("handOrderName"),latitude:a.get("latitude"),longitude:a.get("longitude"),latitude_bis:a.get("latitude_bis"),longitude_bis:a.get("longitude_bis"),positionId:a.get("positionId"),positionName:c,activityId:a.get("activityId"),activityName:d,remark:a.get("remark"),istFeierabend:a.get("istFeierabend"),istKolonnenbuchung:a.get("istKolonnenbuchung"),
genauigkeitVon:a.get("genauigkeitVon"),gps_zeitstempelVon:a.get("gps_zeitstempelVon"),ermittlungsverfahrenVon:a.get("ermittlungsverfahrenVon"),genauigkeitBis:a.get("genauigkeitBis"),gps_zeitstempelBis:a.get("gps_zeitstempelBis"),ermittlungsverfahrenBis:a.get("ermittlungsverfahrenBis"),ServiceApp_Status:a.get("ServiceApp_Status"),timezoneOffset:a.get("timezoneOffset"),timeStampStart:a.get("timeStampStart"),timeStampEnd:a.get("timeStampEnd"),startDateString:a.get("startDateString"),endeDateString:a.get("endeDateString"),
startTimeString:a.get("startTimeString"),endeTimeString:a.get("endeTimeString"),employees:a.get("employees"),isCurrent:false,gefahreneKilometer:a.get("gefahreneKilometer")})},sentBookingArchived:function(a){var b=D8.create(a.get("timeStampStart")).format("dd.mm.yyyy"),c=M.I18N.l("notDefined"),d=M.I18N.l("notDefined"),f=M.I18N.l("notDefined");if(typeof a.get("orderName")!=="undefined")c=a.get("orderName");else try{var e=a.get("orderId"),g=a.get("handOrderId");if(e!==0||g!==0){var h=_.select(DigiWebApp.Order.findSorted().concat(DigiWebApp.HandOrder.findSorted()),
function(m){if(m){m=m.get("id");return e==m||g==m}});if(h&&h.length>0){h=h[0];c=h.get("name")}}}catch(i){console.error(i)}if(typeof a.get("positionName")!=="undefined")d=a.get("positionName");else try{if(a.get("positionId")!==0)d=_.find(DigiWebApp.Position.find(),function(m){return parseInt(m.get("id"))===a.get("positionId")}).get("name")}catch(j){console.error(j)}if(typeof a.get("activityName")!=="undefined")f=a.get("activityName");else try{if(a.get("activityId")!==0)f=_.find(DigiWebApp.Activity.find(),
function(m){return parseInt(m.get("id"))===a.get("activityId")}).get("name")}catch(l){console.error(l)}return DigiWebApp.SentBookingArchived.createRecord({orderId:a.get("orderId"),orderName:c,handOrderId:a.get("handOrderId"),handOrderName:a.get("handOrderName"),latitude:a.get("latitude"),longitude:a.get("longitude"),latitude_bis:a.get("latitude_bis"),longitude_bis:a.get("longitude_bis"),positionId:a.get("positionId"),positionName:d,activityId:a.get("activityId"),activityName:f,remark:a.get("remark"),
istFeierabend:a.get("istFeierabend"),istKolonnenbuchung:a.get("istKolonnenbuchung"),genauigkeitVon:a.get("genauigkeitVon"),gps_zeitstempelVon:a.get("gps_zeitstempelVon"),ermittlungsverfahrenVon:a.get("ermittlungsverfahrenVon"),genauigkeitBis:a.get("genauigkeitBis"),gps_zeitstempelBis:a.get("gps_zeitstempelBis"),ermittlungsverfahrenBis:a.get("ermittlungsverfahrenBis"),ServiceApp_Status:a.get("ServiceApp_Status"),timezoneOffset:a.get("timezoneOffset"),timeStampStart:a.get("timeStampStart"),timeStampEnd:a.get("timeStampEnd"),
startDateString:a.get("startDateString"),endeDateString:a.get("endeDateString"),startTimeString:a.get("startTimeString"),endeTimeString:a.get("endeTimeString"),employees:a.get("employees"),tagLabel:b,isCurrent:false,gefahreneKilometer:a.get("gefahreneKilometer")})},setNotBookedBookings:function(){try{var a=DigiWebApp.Booking.find();if(a.length>0){var b=D8.create("11/01/"+(new Date).getFullYear()+" 02:00:00").addDays(-D8.create("11/01/"+(new Date).getFullYear()+" 02:00:00").date.getDay()),c=D8.create("04/01/"+
(new Date).getFullYear()+" 02:00:00").addDays(-D8.create("04/01/"+(new Date).getFullYear()+" 02:00:00").date.getDay()),d=new D8;c.timeBetween(d)>=0&&b.timeBetween(d);_.each(a,function(e){var g=e.get("startDateString"),h=e.get("startTimeString");if(typeof g==="undefined"||!g||g===""||typeof h==="undefined"||!h||h===""){h=D8.create(new Date(Number(e.get("timeStampStart"))+6E4*((new Date(Number(e.get("timeStampStart")))).getTimezoneOffset()-e.get("timezoneOffset"))));g=h.format("dd.mm.yyyy");h=h.format("HH:MM")}var i=
e.get("endeDateString"),j=e.get("endeTimeString");if(typeof i==="undefined"||!i||i===""||typeof j==="undefined"||!j||j===""){j=D8.create(new Date(Number(e.get("timeStampEnd"))+6E4*((new Date(Number(e.get("timeStampEnd")))).getTimezoneOffset()-e.get("timezoneOffset"))));i=j.format("dd.mm.yyyy");j=j.format("HH:MM")}typeof e.get("timezoneOffset")==="undefined"?e.set("date",e.get("timeStampStart")+","+e.get("timeStampEnd")+",-120,"+g+","+h+","+i+","+j):e.set("date",e.get("timeStampStart")+","+e.get("timeStampEnd")+
","+e.get("timezoneOffset")+","+g+","+h+","+i+","+j);parseInt(e.get("orderId"))===0&&parseInt(e.get("handOrderId"))!==0&&e.set("orderId",e.get("handOrderId"))});a=_.sortBy(a,function(e){return parseInt(e.get("timeStampStart"))});this.set("timeData",a.reverse())}else this.set("timeData",[])}catch(f){this.set("timeData",[])}DigiWebApp.BookingController.setBookedBookings();DigiWebApp.BookingController.setArchivedDays()},setBookedBookings:function(){try{var a=DigiWebApp.SentBooking.find();if(a.length>
0){var b=D8.create("11/01/"+(new Date).getFullYear()+" 02:00:00").addDays(-D8.create("11/01/"+(new Date).getFullYear()+" 02:00:00").date.getDay()),c=D8.create("04/01/"+(new Date).getFullYear()+" 02:00:00").addDays(-D8.create("04/01/"+(new Date).getFullYear()+" 02:00:00").date.getDay()),d=new D8;c.timeBetween(d)>=0&&b.timeBetween(d);_.each(a,function(e){var g=e.get("startDateString"),h=e.get("startTimeString");if(typeof g==="undefined"||!g||g===""||typeof h==="undefined"||!h||h===""){h=D8.create(new Date(Number(e.get("timeStampStart"))+
6E4*((new Date(Number(e.get("timeStampStart")))).getTimezoneOffset()-e.get("timezoneOffset"))));g=h.format("dd.mm.yyyy");h=h.format("HH:MM")}var i=e.get("endeDateString"),j=e.get("endeTimeString");if(typeof i==="undefined"||!i||i===""||typeof j==="undefined"||!j||j===""){j=D8.create(new Date(Number(e.get("timeStampEnd"))+6E4*((new Date(Number(e.get("timeStampEnd")))).getTimezoneOffset()-e.get("timezoneOffset"))));i=j.format("dd.mm.yyyy");j=j.format("HH:MM")}typeof e.get("timezoneOffset")==="undefined"?
e.set("date",e.get("timeStampStart")+","+e.get("timeStampEnd")+",-120,"+g+","+h+","+i+","+j):e.set("date",e.get("timeStampStart")+","+e.get("timeStampEnd")+","+e.get("timezoneOffset")+","+g+","+h+","+i+","+j);parseInt(e.get("orderId"))===0&&parseInt(e.get("handOrderId"))!==0&&e.set("orderId",e.get("handOrderId"))});a=_.sortBy(a,function(e){return parseInt(e.get("timeStampStart"))});this.set("timeDataSent",a.reverse())}else this.set("timeDataSent",[])}catch(f){this.set("timeDataSent",[])}},setArchivedDays:function(){try{var a=
DigiWebApp.SentTimeDataDays.find();if(a.length>0){a=_.sortBy(a,function(c){return parseInt(D8.create(c.get("tagLabel")).getTimestamp())});this.set("timeDataSentDays",a.reverse())}else this.set("timeDataSentDays",[])}catch(b){this.set("timeDataSentDays",[])}},setArchivedBookings:function(){try{if(DigiWebApp.BookingController.dayToDisplay!==null){var a=DigiWebApp.SentBookingArchived.find({query:{identifier:"tagLabel",operator:"=",value:DigiWebApp.BookingController.dayToDisplay.get("tagLabel")}});if(a.length>
0){var b=D8.create("11/01/"+(new Date).getFullYear()+" 02:00:00").addDays(-D8.create("11/01/"+(new Date).getFullYear()+" 02:00:00").date.getDay()),c=D8.create("04/01/"+(new Date).getFullYear()+" 02:00:00").addDays(-D8.create("04/01/"+(new Date).getFullYear()+" 02:00:00").date.getDay()),d=new D8;c.timeBetween(d)>=0&&b.timeBetween(d);_.each(a,function(e){var g=e.get("startDateString"),h=e.get("startTimeString");if(typeof g==="undefined"||!g||g===""||typeof h==="undefined"||!h||h===""){h=D8.create(new Date(Number(e.get("timeStampStart"))+
6E4*((new Date(Number(e.get("timeStampStart")))).getTimezoneOffset()-e.get("timezoneOffset"))));g=h.format("dd.mm.yyyy");h=h.format("HH:MM")}var i=e.get("endeDateString"),j=e.get("endeTimeString");if(typeof i==="undefined"||!i||i===""||typeof j==="undefined"||!j||j===""){j=D8.create(new Date(Number(e.get("timeStampEnd"))+6E4*((new Date(Number(e.get("timeStampEnd")))).getTimezoneOffset()-e.get("timezoneOffset"))));i=j.format("dd.mm.yyyy");j=j.format("HH:MM")}typeof e.get("timezoneOffset")==="undefined"?
e.set("date",e.get("timeStampStart")+","+e.get("timeStampEnd")+",-120,"+g+","+h+","+i+","+j):e.set("date",e.get("timeStampStart")+","+e.get("timeStampEnd")+","+e.get("timezoneOffset")+","+g+","+h+","+i+","+j);parseInt(e.get("orderId"))===0&&parseInt(e.get("handOrderId"))!==0&&e.set("orderId",e.get("handOrderId"))});a=_.sortBy(a,function(e){return parseInt(e.get("timeStampStart"))});this.set("timeDataSentArchived",a.reverse())}else this.set("timeDataSentArchived",[])}else this.set("timeDataSentArchived",
[])}catch(f){this.set("timeDataSentArchived",[])}},setTimeDataForRemark:function(){try{if(DigiWebApp.BookingController.currentBooking!==null){var a=[DigiWebApp.BookingController.currentBooking];if(a.length>0){var b=D8.create("11/01/"+(new Date).getFullYear()+" 02:00:00").addDays(-D8.create("11/01/"+(new Date).getFullYear()+" 02:00:00").date.getDay()),c=D8.create("04/01/"+(new Date).getFullYear()+" 02:00:00").addDays(-D8.create("04/01/"+(new Date).getFullYear()+" 02:00:00").date.getDay()),d=new D8;
c.timeBetween(d)>=0&&b.timeBetween(d);_.each(a,function(e){var g=e.get("startDateString"),h=e.get("startTimeString");if(typeof g==="undefined"||!g||g===""||typeof h==="undefined"||!h||h===""){h=D8.create(new Date(Number(e.get("timeStampStart"))+6E4*((new Date(Number(e.get("timeStampStart")))).getTimezoneOffset()-e.get("timezoneOffset"))));g=h.format("dd.mm.yyyy");h=h.format("HH:MM")}var i=e.get("endeDateString"),j=e.get("endeTimeString");if(typeof i==="undefined"||!i||i===""||typeof j==="undefined"||
!j||j===""){j=D8.create(new Date(Number(e.get("timeStampEnd"))+6E4*((new Date(Number(e.get("timeStampEnd")))).getTimezoneOffset()-e.get("timezoneOffset"))));i=j.format("dd.mm.yyyy");j=j.format("HH:MM")}typeof e.get("timezoneOffset")==="undefined"?e.set("date",e.get("timeStampStart")+","+e.get("timeStampEnd")+",-120,"+g+","+h+","+i+","+j):e.set("date",e.get("timeStampStart")+","+e.get("timeStampEnd")+","+e.get("timezoneOffset")+","+g+","+h+","+i+","+j);parseInt(e.get("orderId"))===0&&parseInt(e.get("handOrderId"))!==
0&&e.set("orderId",e.get("handOrderId"))});a=_.sortBy(a,function(e){return parseInt(e.get("timeStampStart"))});this.set("timeDataForEdit",a.reverse())}else this.set("timeDataForEdit",[])}}catch(f){this.set("timeDataForEdit",[])}},setTimeDataForEdit:function(){try{if(DigiWebApp.EditTimeDataPage.bookingToEdit!==null){var a=[DigiWebApp.EditTimeDataPage.bookingToEdit];if(a.length>0){var b=D8.create("11/01/"+(new Date).getFullYear()+" 02:00:00").addDays(-D8.create("11/01/"+(new Date).getFullYear()+" 02:00:00").date.getDay()),
c=D8.create("04/01/"+(new Date).getFullYear()+" 02:00:00").addDays(-D8.create("04/01/"+(new Date).getFullYear()+" 02:00:00").date.getDay()),d=new D8;c.timeBetween(d)>=0&&b.timeBetween(d);_.each(a,function(e){var g=e.get("startDateString"),h=e.get("startTimeString");if(typeof g==="undefined"||!g||g===""||typeof h==="undefined"||!h||h===""){h=D8.create(new Date(Number(e.get("timeStampStart"))+6E4*((new Date(Number(e.get("timeStampStart")))).getTimezoneOffset()-e.get("timezoneOffset"))));g=h.format("dd.mm.yyyy");
h=h.format("HH:MM")}var i=e.get("endeDateString"),j=e.get("endeTimeString");if(typeof i==="undefined"||!i||i===""||typeof j==="undefined"||!j||j===""){j=D8.create(new Date(Number(e.get("timeStampEnd"))+6E4*((new Date(Number(e.get("timeStampEnd")))).getTimezoneOffset()-e.get("timezoneOffset"))));i=j.format("dd.mm.yyyy");j=j.format("HH:MM")}typeof e.get("timezoneOffset")==="undefined"?e.set("date",e.get("timeStampStart")+","+e.get("timeStampEnd")+",-120,"+g+","+h+","+i+","+j):e.set("date",e.get("timeStampStart")+
","+e.get("timeStampEnd")+","+e.get("timezoneOffset")+","+g+","+h+","+i+","+j);parseInt(e.get("orderId"))===0&&parseInt(e.get("handOrderId"))!==0&&e.set("orderId",e.get("handOrderId"))});a=_.sortBy(a,function(e){return parseInt(e.get("timeStampStart"))});this.set("timeDataForEdit",a.reverse())}else this.set("timeDataForEdit",[])}}catch(f){this.set("timeDataForEdit",[])}},closeDay:function(){var a=DigiWebApp.BookingController;a.currentBookingTimesStampBook=new Date;try{DigiWebApp.ApplicationController.vibrate()}catch(b){}if(a.currentBooking){var c=
function(){if(DigiWebApp.SettingsController.featureAvailable("403")&&!DigiWebApp.SettingsController.getSetting("remarkIsOptional")||DigiWebApp.SettingsController.featureAvailable("422")&&DigiWebApp.Activity.findById(DigiWebApp.BookingController.currentBooking.get("activityId")).get("istFahrzeitRelevant")){a.refreshCurrentBooking(false);DigiWebApp.NavigationController.toRemarkPage(function(){DigiWebApp.SettingsController.featureAvailable("404")?DigiWebApp.NavigationController.backToButtonDashboardPagePOP():
DigiWebApp.NavigationController.backToDashboardPagePOP();a.closeDayWithRemark()})}else a.closeDayWithRemark()};DigiWebApp.SettingsController.featureAvailable("418")?DigiWebApp.NavigationController.toSpesenPage(function(){DigiWebApp.SettingsController.featureAvailable("404")?DigiWebApp.NavigationController.backToButtonDashboardPagePOP():DigiWebApp.NavigationController.backToDashboardPagePOP();c()}):c()}else a.closeDayWithRemark()},closeDayWithRemark:function(){DigiWebApp.BookingController.getBookingLocation(this.closeDayWithRemarkWithPosition)},
closeDayWithRemarkWithPosition:function(a){var b=DigiWebApp.BookingController;if(b.currentBooking){b.currentBooking.set("istFeierabend",true);b.currentBooking.closeBooking(a);b.currentBooking.removeAsCurrent();b.currentBooking.save();b.currentBookingClosed=b.currentBooking;b.currentBooking=null;DigiWebApp.SettingsController.setSetting("currentTimezoneOffset",null);DigiWebApp.SettingsController.setSetting("currentTimezone",null);b.set("currentBookingStr","");DigiWebApp.SelectionController.resetSelection();
DigiWebApp.SelectionController.initSelection();DigiWebApp.SelectionController.useSelections=NO;var c=function(){DigiWebApp.ApplicationController.DigiLoaderView.hide();if(DigiWebApp.SettingsController.getSetting("autoTransferAfterClosingDay"))DigiWebApp.DashboardController.dataTransfer(YES);else{localStorage.setItem(DigiWebApp.EmployeeController.empSelectionKeyTmp,localStorage.getItem(DigiWebApp.EmployeeController.empSelectionKey));localStorage.removeItem(DigiWebApp.EmployeeController.empSelectionKey);
DigiWebApp.EmployeeController.getEmployeeState()==2&&DigiWebApp.EmployeeController.setEmployeeState(1);DigiWebApp.ApplicationController.DigiLoaderView.hide();DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("closingDaySuccess"),message:M.I18N.l("closingDaySuccessWithoutMsg")})}};if(DigiWebApp.SettingsController.featureAvailable("417")&&DigiWebApp.SettingsController.getSetting("ServiceApp_ermittleGeokoordinate"))if(DigiWebApp.SettingsController.getSetting("ServiceApp_engeKopplung")||
DigiWebApp.SettingsController.getSetting("autoTransferAfterClosingDay")){DigiWebApp.SettingsController.getSetting("debug")&&console.log("post currentBookingClosed");DigiWebApp.ServiceAppController.postBookings([b.currentBookingClosed],function(){DigiWebApp.SettingsController.getSetting("debug")&&console.log("polling for bookinglocations");var d=[];b.currentBooking!==null&&d.push(b.currentBooking.m_id);b.currentBookingClosed!==null&&d.push(b.currentBookingClosed.m_id);DigiWebApp.ServiceAppController.pollBookings(d,
function(f){DigiWebApp.SettingsController.getSetting("debug")&&console.log(f.length+" Datens\u00e4tze empfangen");_.each(f,function(e){try{DigiWebApp.SettingsController.getSetting("debug")&&console.log("speichere gepullten Datensatz "+e.m_id);var g=_.find(DigiWebApp.Booking.find(),function(j){return j.m_id===e.m_id}),h=e.record;DigiWebApp.SettingsController.getSetting("debug")&&console.log("modelBooking: ",g);DigiWebApp.SettingsController.getSetting("debug")&&console.log("datensatz: ",h);g.set("latitude",
h.latitude);g.set("latitude_bis",h.latitude_bis);g.set("longitude",h.longitude);g.set("longitude_bis",h.longitude_bis);g.set("ermittlungsverfahrenBis",h.ermittlungsverfahren_bis);g.set("ermittlungsverfahrenVon",h.ermittlungsverfahren);g.set("genauigkeitBis",h.genauigkeit_bis);g.set("genauigkeitVon",h.genauigkeit);g.set("gps_zeitstempelBis",h.gps_zeitstempel_bis);g.set("gps_zeitstempelVon",h.gps_zeitstempel);g.set("ServiceApp_Status",h.status);g.save();DigiWebApp.SettingsController.getSetting("debug")&&
console.log("datensatz "+e.m_id+" gespeichert")}catch(i){DigiWebApp.SettingsController.getSetting("debug")&&console.log("datensatz "+e.m_id+" nicht gefunden")}});b.currentBookingClosed=null;c()},c,DigiWebApp.SettingsController.getSetting("GPSTimeOut"))},c)}else if(b.currentBookingClosed!==null){a=function(){DigiWebApp.SettingsController.getSetting("debug")&&console.log("refreshWAIT");DigiWebApp.ServiceAppController.refreshWAITBookings(function(){DigiWebApp.SettingsController.getSetting("debug")&&
console.log("refreshWAIT done");c()},function(d){console.error(d);c()})};DigiWebApp.SettingsController.getSetting("debug")&&console.log("post currentBookingClosed");DigiWebApp.ServiceAppController.postBookings([b.currentBookingClosed],a,a)}else c();else c()}else{DigiWebApp.ApplicationController.DigiLoaderView.hide();DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("hint"),message:M.I18N.l("noOpenBookings")})}},loadSignatures:function(a,b){if(typeof b!=="function")console.error("loadSignaturesError: successCallback is not a function");
else{DigiWebApp.ApplicationController.DigiLoaderView.show(M.I18N.l("loadSignatures"));var c=a.length,d=0;c!==0?_.each(a,function(f){d+=1;if(f.hasFileName())f.readFromFile(function(e){e&&e!==""&&DigiWebApp.BookingController.propagateBookingWithSignature(a,f.m_id,e);d===c&&b()},function(){d===c&&b()});else d===c&&b()}):b()}},propagateBookingWithSignature:function(a,b,c){_.each(a,function(d){if(d.m_id===b)d.signature=c})},sendBookings:function(a,b){var c=DigiWebApp.Booking.find();DigiWebApp.BookingController.loadSignatures(c,
function(){DigiWebApp.BookingController.sendSignatures(c,a,b)})},sendSignatures:function(a,b,c){var d=this,f=[];_.each(a,function(e){if(e.signature){var g=e.record;g.unterschrift=JSON.parse(e.signature);f.push(g)}});if(f.length!==0){a=function(){d.sendBookingsWithoutSignatures(DigiWebApp.Booking.find(),b,c)};DigiWebApp.JSONDatenuebertragungController.sendData({unterschriften:f},"medien/unterschrift",M.I18N.l("sendSignatures"),a,a)}else d.sendBookingsWithoutSignatures(DigiWebApp.Booking.find(),b,c)},
sendBookingsWithoutSignatures:function(a,b,c){var d=false;if(typeof c!=="undefined")d=c;a.length>0&&DigiWebApp.JSONDatenuebertragungController.sendeZeitdaten(a,function(){var f=DigiWebApp.BookingController,e=false;_.each(DigiWebApp.Booking.find(),function(i){if(i.get("isCurrent"))e=true});DigiWebApp.SettingsController.getSetting("debug")&&console.log("CurrentAvailable: ",e);e||DigiWebApp.SentBooking.deleteAll();if(DigiWebApp.SettingsController.featureAvailable("411"))try{_.each(DigiWebApp.Booking.find(),
function(i){if(!i.get("isCurrent")){f.sentBookingArchived(i).save();var j=NO,l=D8.create(i.get("timeStampStart")).format("dd.mm.yyyy");_.each(DigiWebApp.SentTimeDataDays.find(),function(m){if(m.get("tagLabel")===l)j=YES});j===NO&&DigiWebApp.SentTimeDataDays.createRecord({tagLabel:l}).save()}});DigiWebApp.SentBookingArchived.deleteOld();DigiWebApp.SentTimeDataDays.deleteOld()}catch(g){DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("error"),message:M.I18N.l("errorWhileArchivingBookings")})}var h=
[];_.each(DigiWebApp.Booking.find(),function(i){if(!i.get("isCurrent")){if(e)try{f.sentBooking(i).save()}catch(j){DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("error"),message:M.I18N.l("errorWhileBackingUpBookings")})}h.push(i.m_id);i.del()}});DigiWebApp.SettingsController.featureAvailable("417")&&DigiWebApp.ServiceAppController.deleteBookings(h,function(){DigiWebApp.SettingsController.getSetting("debug")&&console.log("Buchungen wurden in der ServiceApp gel\u00f6scht.")},
function(){DigiWebApp.SettingsController.getSetting("debug")&&console.log("Buchungen konnten nicht in der ServiceApp gel\u00f6scht werden.")});DigiWebApp.SelectionController.resetSelection();e?DigiWebApp.SelectionController.setSelectionByCurrentBooking():DigiWebApp.SelectionController.initSelection();if(b){f.set("currentBookingStr","");DigiWebApp.EmployeeController.getEmployeeState()==2&&DigiWebApp.EmployeeController.setEmployeeState(1);localStorage.removeItem(DigiWebApp.EmployeeController.empSelectionKey);
localStorage.removeItem(DigiWebApp.EmployeeController.empSelectionKeyTmp)}DigiWebApp.ApplicationController.DigiLoaderView.hide();if(DigiWebApp.SettingsController.getSetting("autoSyncAfterBookTime")||d===true)DigiWebApp.ApplicationController.startsync(YES)},function(){DigiWebApp.ApplicationController.DigiLoaderView.hide();DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("sendDataFail"),message:M.I18N.l("sendDataFailMsg")})},b,d)},buildBookingStr:function(){var a="";a=typeof this.currentBooking.get("timezoneOffset")===
"undefined"?(new Date(this.currentBooking.get("timeStampStart"))).getTime():(new Date(this.currentBooking.get("timeStampStart")-6E4*(this.currentBooking.get("timezoneOffset")-(new Date).getTimezoneOffset()))).getTime();return a=M.Date.create(a).format("dd.mm.yy HH:MM")},spesenOptionen:null,uebernachtungOptionen:null});
DigiWebApp.MediaListController=M.Controller.extend({items:null,actions:null,latestId:null,lastTimestampDatatransfer:null,init:function(){var a=DigiWebApp.MediaListController,b=[];b=_.sortBy(DigiWebApp.MediaFile.find(),function(e){return parseInt(e.get("timeStamp"))});a.set("items",b.reverse());if(DigiWebApp.MediaListPage.needsUpdate){b=[];b.push({label:M.I18N.l("uploadMediaFiles"),icon:"icon_dataTransfer.png",id:"uploadMediaFiles"});a.set("actions",b);DigiWebApp.MediaListPage.needsUpdate=false}var c;
try{(c=M.ViewManager.getView("mediaListPage","mediafileslist"))&&$("#"+c.id).find("li").each(function(){$(this).removeClass("selected")})}catch(d){console.error(d)}try{(c=M.ViewManager.getView("mediaListPage","actionslist"))&&$("#"+c.id).find("li").each(function(){$(this).removeClass("selected")})}catch(f){console.error(f)}},itemSelected:function(a,b){try{DigiWebApp.ApplicationController.vibrate()}catch(c){}this.latestId&&$("#"+this.latestId).removeClass("selected");$("#"+a).addClass("selected");
this.latestId=a;b&&typeof this[b]==="function"&&this[b]()},neu:function(){var a=DigiWebApp.MediaListController;M.DialogView.actionSheet({title:M.I18N.l("newMedia"),cancelButtonValue:M.I18N.l("cancel"),otherButtonValues:[M.I18N.l("photo")],otherButtonTags:["photo"],callbacks:{other:{action:function(b){switch(b){case "audio":DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("notImplemented"),message:M.I18N.l("notImplementedMsg")});break;case "photo":DigiWebApp.SettingsController.featureAvailable("400")?
a.foto():DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("notActivated"),message:M.I18N.l("notActivatedMsg")});break;case "video":DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("notImplemented"),message:M.I18N.l("notImplementedMsg")});break;case "other":DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("notImplemented"),message:M.I18N.l("notImplementedMsg")});break;default:console.log("unknonw ButtonTag")}}},cancel:{action:function(){}}}})},
foto:function(){M.DialogView.actionSheet({title:M.I18N.l("takePicture"),cancelButtonValue:M.I18N.l("cancel"),otherButtonValues:[M.I18N.l("library"),M.I18N.l("camera")],otherButtonTags:["library","camera"],callbacks:{other:{action:function(a){switch(a){case "library":if(typeof navigator.camera!=="undefined"&&typeof navigator.camera.getPicture!=="undefined")navigator.camera.getPicture(function(b){b.indexOf("data:")===0?DigiWebApp.CameraController.set("loadedPicture",b):DigiWebApp.CameraController.set("loadedPicture",
"data:"+DigiWebApp.ApplicationController.CONSTImageFiletype+","+b);DigiWebApp.CameraController.set("fileType",DigiWebApp.ApplicationController.CONSTImageFiletype);DigiWebApp.NavigationController.toCameraPageTransition()},function(b){DigiWebApp.CameraController.set("loadedPicture",null);DigiWebApp.CameraController.set("fileType",null);DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("error"),message:M.I18N.l("noPicLoaded")+": "+b})},{quality:40,allowEdit:true,destinationType:navigator.camera.DestinationType.DATA_URL,
encodingType:navigator.camera.EncodingType.JPEG,sourceType:navigator.camera.PictureSourceType.PHOTOLIBRARY,mediaType:navigator.camera.MediaType.PICTURE,saveToPhotoAlbum:false});else{DigiWebApp.FileChooserPage.set("successCallback",function(b,c){if(b!==null){DigiWebApp.CameraController.set("loadedFileName",c);for(var d="",f=c,e=0;e!==-1;){f=f.substr(e+1);e=f.indexOf(".")}f=f.toLowerCase();switch(f){case "jpg":d="image/jpeg";break;case "jpeg":d="image/"+f;break;case "png":d="image/"+f;break;case "bmp":d=
"image/"+f}switch(d){case "":DigiWebApp.CameraController.set("loadedPicture",null);DigiWebApp.CameraController.set("fileType",null);DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("error"),message:M.I18N.l("noPicLoaded")});break;default:DigiWebApp.CameraController.set("fileType",d);b.indexOf("data:")===0?DigiWebApp.CameraController.set("loadedPicture",b):DigiWebApp.CameraController.set("loadedPicture","data:"+d+","+b);DigiWebApp.NavigationController.toCameraPageTransition()}}else{DigiWebApp.CameraController.set("loadedPicture",
null);DigiWebApp.CameraController.set("fileType",null);DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("error"),message:M.I18N.l("noPicLoaded")})}});DigiWebApp.NavigationController.toFileChooserPageTransition()}break;case "camera":if(typeof navigator.camera!=="undefined"&&typeof navigator.camera.getPicture!=="undefined"){DigiWebApp.CameraController.set("loadedPicture",null);DigiWebApp.NavigationController.toCameraPageTransition()}else DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("error"),
message:M.I18N.l("noCamera")});break;default:console.log("unknonw ButtonTag")}}},cancel:{action:function(){}}}})},audio:function(){},uploadMediaFiles:function(){var a=DigiWebApp.MediaListController,b=NO;if(a.lastTimestampDatatransfer!==null)if(D8.now().getTimestamp()-a.lastTimestampDatatransfer>parseInt(DigiWebApp.SettingsController.getSetting("datatransfer_min_delay")))b=YES;if(b===YES||a.lastTimestampDatatransfer===null)a.doUploadMediaFiles()},doUploadMediaFiles:function(){DigiWebApp.MediaListController.set("lastTimestampDatatransfer",
D8.now().getTimestamp());DigiWebApp.ApplicationController.DigiLoaderView.show(M.I18N.l("loadMediaFiles"));var a=function(g){console.error(g);DigiWebApp.MediaListController.init()},b=function(g){if(g.length!==0){var h=[];_.each(g,function(i){i=JSON.parse(JSON.stringify(i));if(i.record.handOrderId!==null&&i.record.handOrderId!=="0")i.record.orderId=null;h.push(i.record)});DigiWebApp.JSONDatenuebertragungController.sendData({medien:h},"medien",M.I18N.l("sendeMedien"),function(i,j,l){console.log("sendeMedien Status: "+
l.status);DigiWebApp.MediaFile.deleteAll(DigiWebApp.MediaListController.init)},a)}else DigiWebApp.MediaFile.deleteAll(DigiWebApp.MediaListController.init)},c=DigiWebApp.MediaFile.find(),d=c.length,f=0,e=false;if(d!==0)_.each(c,function(g){console.log("loading mediaFile for mediaFilesIndex "+f);if(g.hasFileName()){console.log("fileName: "+g.get("fileName"));g.readFromFile(function(h){h&&h!==""&&_.each(c,function(i){if(i.m_id===g.m_id){i.set("data",h);f+=1}});if(f===d&&e===false){console.log("last mediaFile done (with file)");
DigiWebApp.ApplicationController.DigiLoaderView.hide();e=true;b(c)}},function(){if(f===d&&e===false){console.log("last mediaFile done (last file load failed)");DigiWebApp.ApplicationController.DigiLoaderView.hide();e=true;b(c)}})}else if(f===d&&e===false){console.log("last mediaFile done (no file)");DigiWebApp.ApplicationController.DigiLoaderView.hide();e=true;b(c)}});else{DigiWebApp.ApplicationController.DigiLoaderView.hide();b(c)}}});
DigiWebApp.EmployeeController=M.Controller.extend({empSelectionKey:M.LOCAL_STORAGE_PREFIX+M.Application.name+M.LOCAL_STORAGE_SUFFIX+"employeeSelection",empSelectionKeyTmp:M.LOCAL_STORAGE_PREFIX+M.Application.name+M.LOCAL_STORAGE_SUFFIX+"employeeSelectionTmp",employeeState:0,employees:null,init:function(){this.setEmployeesForList()},setEmployeesForList:function(){if(this.getEmployeeState()==1){var a=DigiWebApp.Employee.findSorted();if(a.length>0){a=_.map(a,function(b){if(b)return{label:b.get("name"),
value:b.get("id")}});this.set("employees",a)}}},saveEmployeeSelection:function(){var a=DigiWebApp.Employee.find();_.each(a,function(b){b.set("isSelected",NO);b.save()});a=M.ViewManager.getView("employeePage","employeeSelection").getSelection();if(a.length>0){_.each(a,function(b){var c=_.select(DigiWebApp.Employee.find(),function(d){if(d)return d.get("id")===b});if(c=_.isArray(c)?c[0]:c){c.set("isSelected",YES);c.save()}});DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("employeeSelectionSuccess"),
message:M.I18N.l("employeeSelectionSuccessMsg"),callbacks:{confirm:{target:this,action:"callbackEmployeesSave"}}})}else DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("employeeSelection"),message:M.I18N.l("employeeSelectionMsg")})},callbackEmployeesSave:function(){var a=DigiWebApp.EmployeeController;DigiWebApp.BookingController.set("isBackFromEmployeePage",YES);DigiWebApp.NavigationController.backToBookTimePagePOP();localStorage.setItem(DigiWebApp.EmployeeController.empSelectionKey,
a.getSelectedEmployeesAsString());a.setEmployeeState(2);DigiWebApp.BookingController.book()},getSelectedEmployees:function(){var a=DigiWebApp.Employee.find();if(a.length>0)return _.select(a,function(b){if(b)return b.get("isSelected")===true});return[]},getSelectedEmployeesAsString:function(){if(this.getEmployeeState===0)return"0";if(this.getEmployeeState===1)return"";var a=[],b=this.getSelectedEmployees();_.each(b,function(c){a.push(c.get("id"))});return a.join(",")},setEmployeeState:function(a){a==
0&&this.saveUniversalEmployeeToLocalStorage();this.set("employeeState",a);localStorage.setItem(M.LOCAL_STORAGE_PREFIX+M.Application.name+M.LOCAL_STORAGE_SUFFIX+"employeeState",this.employeeState)},saveUniversalEmployeeToLocalStorage:function(){localStorage.setItem(this.empSelectionKey,"0")},getEmployeeState:function(){this.set("employeeState",localStorage.getItem(M.LOCAL_STORAGE_PREFIX+M.Application.name+M.LOCAL_STORAGE_SUFFIX+"employeeState"));return this.employeeState}});
DigiWebApp.BautagebuchBautageberichteListeController=M.Controller.extend({items:null,init:function(a){DigiWebApp.BautagebuchMainController.init(a);this.set("items",DigiWebApp.BautagebuchBautagesbericht.findSorted())},neu:function(){DigiWebApp.BautagebuchBautageberichtDetailsController.init(YES);DigiWebApp.SettingsController.getSetting("bautagebuchLimit_autoStartUhrzeit")?DigiWebApp.BautagebuchBautageberichtDetailsController.set("startUhrzeit",D8.now().format("HH:MM")):DigiWebApp.BautagebuchBautageberichtDetailsController.set("startUhrzeit",
DigiWebApp.BautagebuchEinstellungenController.settings.startUhrzeit);DigiWebApp.BautagebuchBautageberichtDetailsController.set("datum",D8.now().format("dd.mm.yyyy"));DigiWebApp.BautagebuchBautageberichtDetailsController.set("projektleiterId",null);DigiWebApp.BautagebuchBautageberichtDetailsController.set("auftragsId",null);DigiWebApp.BautagebuchBautageberichtDetailsController.set("auftragsName",null);DigiWebApp.BautagebuchBautageberichtDetailsController.set("mitarbeiterIds",null);DigiWebApp.BautagebuchBautageberichtDetailsController.setWetter(DigiWebApp.BautagebuchMainController.wetterDefaults);
DigiWebApp.BautagebuchBautageberichtDetailsController.set("item",DigiWebApp.BautagebuchBautagesbericht.createRecord({datum:DigiWebApp.BautagebuchBautageberichtDetailsController.datum,startUhrzeit:DigiWebApp.BautagebuchBautageberichtDetailsController.startUhrzeit}));DigiWebApp.NavigationController.toBautagebuchBautageberichtDetailsPageTransition()}});
DigiWebApp.ZeitbuchungenController=M.Controller.extend({items:null,itemForDetails:null,datum:null,mitarbeiterID:null,mitarbeiterNameVorname:null,init:function(a){DigiWebApp.VorZurueckTabBar.setActiveTab(DigiWebApp.VorZurueckTabBar.tabItemDayToShow);DigiWebApp.ZeitbuchungenController.items===null?DigiWebApp.RequestController.getDatabaseServer(DigiWebApp.ZeitbuchungenController.initWithServer,a):DigiWebApp.ZeitbuchungenController.initWithServer(a)},initWithServer:function(){if(DigiWebApp.ZeitbuchungenController.items===
null){DigiWebApp.ApplicationController.DigiLoaderView.show(M.I18N.l("ZeitbuchungenLaden"));DigiWebApp.Zeitbuchungen.find({urlParams:{datum:DigiWebApp.ZeitbuchungenController.datum,mitarbeiterID:DigiWebApp.ZeitbuchungenController.mitarbeiterID},callbacks:{success:{action:function(c){DigiWebApp.ApplicationController.DigiLoaderView.hide();try{!c||c&&c.length===0||c&&c.length===1&&(typeof c[0].get("mitarbeiterId")==="undefined"||c[0].get("mitarbeiterId")===null)?DigiWebApp.ZeitbuchungenController.set("items",
[]):DigiWebApp.ZeitbuchungenController.set("items",c)}catch(d){DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("error"),message:M.I18N.l("ZeitbuchungenKonntenNichtGeladenWerden"),callbacks:{confirm:{target:this,action:function(){DigiWebApp.NavigationController.backToAnwesenheitslistePageTransition()}}}})}}},error:{action:function(){DigiWebApp.ApplicationController.DigiLoaderView.hide();DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("error"),message:M.I18N.l("ZeitbuchungenKonntenNichtGeladenWerden"),
callbacks:{confirm:{target:this,action:function(){DigiWebApp.NavigationController.backToAnwesenheitslistePageTransition()}}}})}}}})}if(DigiWebApp.ZeitbuchungenController.mitarbeiterNameVorname!==null){var a="";try{a=M.I18N.l(D8.create(DigiWebApp.ZeitbuchungenController.datum).format("dddd")).substring(0,2)+", "}catch(b){a=""}DigiWebApp.ZeitbuchungenPage.header.title.set("value",DigiWebApp.ZeitbuchungenController.mitarbeiterNameVorname+"<br />"+a+DigiWebApp.ZeitbuchungenController.datum);DigiWebApp.ZeitbuchungenPage.header.title.renderUpdate()}}});
DigiWebApp.BautagebuchZeitenDetailsController=M.Controller.extend({item:null,positionId:null,positionName:null,positionenList:null,activityId:null,activityName:null,activityList:null,mitarbeiterIds:null,mitarbeiterList:null,von:"",timeStampStart:"",bis:"",timeStampEnd:"",dauer:"00:00",verbuchen:YES,latitude:"",longitude:"",latitude_bis:"",longitude_bis:"",init:function(){},load:function(a){this.set("item",a);this.set("positionId",a.get("positionId"));this.set("positionName",a.get("positionName"));
this.set("activityId",a.get("activityId"));this.set("activityName",a.get("activityName"));this.set("mitarbeiterIds",JSON.parse(a.get("mitarbeiterIds")));this.set("verbuchen",a.get("verbuchen"));this.set("von",a.get("von"));this.set("timeStampStart",a.get("timeStampStart"));this.set("bis",a.get("bis"));this.set("timeStampEnd",a.get("timeStampEnd"));this.set("dauer",a.get("dauer"))},save:function(){var a=M.ViewManager.getView("bautagebuchZeitenDetailsPage","positionComboBox").getSelection()!=="0",b=
M.ViewManager.getView("bautagebuchZeitenDetailsPage","activityComboBox").getSelection()!=="0",c=!(DigiWebApp.BautagebuchZeitenDetailsController.mitarbeiterIds===null||DigiWebApp.BautagebuchZeitenDetailsController.mitarbeiterIds.length===0);if(!a){DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("noPosSelected"),message:M.I18N.l("noPosSelectedMsg")});return false}if(!b){DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("noActSelected"),message:M.I18N.l("noActSelectedMsg")});
return false}if(!c){DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("noMitarbeiterSelected"),message:M.I18N.l("noMitarbeiterSelectedMsg")});return false}if(!DigiWebApp.BautagebuchEinstellungen.find()[0].get("inStundenBuchen")&&!DigiWebApp.BautagebuchEinstellungen.find()[0].get("falscheZeitenIgnorieren")){a=D8.create("01.01.1993 "+DigiWebApp.BautagebuchZeitenDetailsController.get("von"));b=D8.create("01.01.1993 "+DigiWebApp.BautagebuchZeitenDetailsController.get("bis"));if(a.getTimestamp()>
b.getTimestamp()){DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("wrongTimes"),message:M.I18N.l("wrongTimesMsg")});return false}}this.item.set("positionId",this.positionId);this.item.set("positionName",this.positionName);this.item.set("activityId",this.activityId);this.item.set("activityName",this.activityName);this.item.set("mitarbeiterIds",JSON.stringify(this.mitarbeiterIds));this.item.set("verbuchen",this.verbuchen);this.item.set("von",this.von);this.item.set("timeStampStart",
this.timeStampStart);this.item.set("bis",this.bis);this.item.set("timeStampEnd",this.timeStampEnd);this.item.set("dauer",this.dauer);if(this.item.saveSorted()){DigiWebApp.BautagebuchZeitenListeController.set("items",DigiWebApp.BautagebuchZeitbuchung.findSorted(DigiWebApp.BautagebuchBautageberichtDetailsController.item.m_id));DigiWebApp.NavigationController.backToBautagebuchZeitenListePageTransition();return true}else return false},deleteZeitbuchung:function(){if(this.item.deleteSorted()){DigiWebApp.BautagebuchZeitenListeController.set("items",
DigiWebApp.BautagebuchZeitbuchung.findSorted(DigiWebApp.BautagebuchBautageberichtDetailsController.item.m_id));DigiWebApp.NavigationController.backToBautagebuchZeitenListePageTransition();return true}else return false},setTaetigkeiten:function(a){var b=this;if(typeof a!=="undefined"){var c=_.select(DigiWebApp.WorkPlan.find(),function(f){if(f)return f.get("id")==a}),d=NO;c=c.length>0?DigiWebApp.SelectionController.getActivitiesFromWorkplan(c[0]):DigiWebApp.SelectionController.getActivities();c=_.map(c,
function(f){if(typeof f==="undefined")console.log("UNDEFINED activity");else{f={label:f.get("name"),value:f.get("id"),isSelected:NO};if(b.activityId===f.value)d=f.isSelected=YES;return f}});c=_.compact(c);c.push({label:M.I18N.l("selectSomething"),value:"0",isSelected:!d});b.set("activityList",c)}}});
DigiWebApp.BautagebuchNotizenListeController=M.Controller.extend({items:null,init:function(){this.set("items",DigiWebApp.BautagebuchNotiz.findSorted(DigiWebApp.BautagebuchBautageberichtDetailsController.item.m_id))},neu:function(){DigiWebApp.BautagebuchNotizenDetailsController.set("item",DigiWebApp.BautagebuchNotiz.createRecord({bautagesberichtId:DigiWebApp.BautagebuchBautageberichtDetailsController.item.m_id}));DigiWebApp.BautagebuchNotizenDetailsController.set("positionId",null);DigiWebApp.BautagebuchNotizenDetailsController.set("positionName",
null);DigiWebApp.BautagebuchNotizenDetailsController.set("activityId",null);DigiWebApp.BautagebuchNotizenDetailsController.set("activityName",null);DigiWebApp.BautagebuchNotizenDetailsController.set("data",null);DigiWebApp.NavigationController.toBautagebuchNotizenDetailsPageTransition()}});
DigiWebApp.ScholppBookingController=M.Controller.extend({resetButtons:function(){var a=$("#"+DigiWebApp.BookingPageWithIconsScholpp.content.fahrzeit_arbeitszeit_spezial_ButtonGrid.fahrzeitButtonGrid.button.id)[0],b=$("#"+DigiWebApp.BookingPageWithIconsScholpp.content.fahrzeit_arbeitszeit_spezial_ButtonGrid.arbeitszeitButtonGrid.button.id)[0],c=$("#"+DigiWebApp.BookingPageWithIconsScholpp.content.fahrzeit_arbeitszeit_spezial_ButtonGrid.spezialButtonGrid.button.id)[0],d=$("#"+DigiWebApp.BookingPageWithIconsScholpp.content.unterbrechung_pause_arbeitsende_ButtonGrid.unterbrechungButtonGrid.button.id)[0],
f=$("#"+DigiWebApp.BookingPageWithIconsScholpp.content.unterbrechung_pause_arbeitsende_ButtonGrid.pauseButtonGrid.button.id)[0],e=$("#"+DigiWebApp.BookingPageWithIconsScholpp.content.unterbrechung_pause_arbeitsende_ButtonGrid.arbeitsendeButtonGrid.button.id)[0];a.classList.remove("buttonSelected");b.classList.remove("buttonSelected");c.classList.remove("buttonSelected");d.classList.remove("buttonSelected");f.classList.remove("buttonSelected");e.classList.remove("buttonSelected")},sleepFor:500,bucheFahrzeitTimeoutvar:null,
bucheFahrzeit:function(){var a=DigiWebApp.SelectionController.getActivities();a=_.map(a,function(b){if(typeof b==="undefined"){console.log("UNDEFINED ACTIVITY");return null}else{var c=null;return c=b.get("name").indexOf("Reisezeit")>=0||b.get("name").indexOf("Fahrzeit")>=0?{label:b.get("name"),value:b.get("id"),isSelected:YES}:{label:b.get("name"),value:b.get("id")}}});DigiWebApp.SelectionController.set("activities",a);if(DigiWebApp.BookingController.checkBooking(YES)){DigiWebApp.ScholppBookingController.selectFahrzeit();
DigiWebApp.ScholppBookingController.bucheFahrzeitTimeoutvar=setTimeout("DigiWebApp.ScholppBookingController.doBucheFahrzeit()",this.sleepFor)}},doBucheFahrzeit:function(){DigiWebApp.ScholppBookingController.bucheFahrzeitTimeoutvar!==null&&clearTimeout(DigiWebApp.ScholppBookingController.bucheFahrzeitTimeoutvar);DigiWebApp.BookingController.book();DigiWebApp.SelectionController.saveSelection()},bucheArbeitszeitTimeoutvar:null,bucheArbeitszeit:function(){var a=DigiWebApp.SelectionController.getActivities();
a=_.map(a,function(b){if(typeof b==="undefined"){console.log("UNDEFINED ACTIVITY");return null}else{var c=null;return c=b.get("name").indexOf("Arbeitszeit")>=0?{label:b.get("name"),value:b.get("id"),isSelected:YES}:{label:b.get("name"),value:b.get("id")}}});DigiWebApp.SelectionController.set("activities",a);if(DigiWebApp.BookingController.checkBooking(YES)){DigiWebApp.ScholppBookingController.selectArbeitszeit();DigiWebApp.ScholppBookingController.bucheArbeitszeitTimeoutvar=setTimeout("DigiWebApp.ScholppBookingController.doBucheArbeitszeit()",
this.sleepFor)}},doBucheArbeitszeit:function(){DigiWebApp.ScholppBookingController.bucheArbeitszeitTimeoutvar!==null&&clearTimeout(DigiWebApp.ScholppBookingController.bucheArbeitszeitTimeoutvar);DigiWebApp.BookingController.book();DigiWebApp.SelectionController.saveSelection()},bucheUnterbrechungTimeoutvar:null,bucheUnterbrechung:function(){var a=DigiWebApp.SelectionController.getActivities();a=_.map(a,function(b){if(typeof b==="undefined"){console.log("UNDEFINED ACTIVITY");return null}else{var c=
null;return c=b.get("name").indexOf("Unterbrechung")>=0?{label:b.get("name"),value:b.get("id"),isSelected:YES}:{label:b.get("name"),value:b.get("id")}}});DigiWebApp.SelectionController.set("activities",a);if(DigiWebApp.BookingController.checkBooking(YES)){DigiWebApp.ScholppBookingController.selectUnterbrechung();DigiWebApp.ScholppBookingController.bucheUnterbrechungTimeoutvar=setTimeout("DigiWebApp.ScholppBookingController.doBucheUnterbrechung()",this.sleepFor)}},doBucheUnterbrechung:function(){DigiWebApp.ScholppBookingController.bucheUnterbrechungTimeoutvar!==
null&&clearTimeout(DigiWebApp.ScholppBookingController.bucheUnterbrechungTimeoutvar);DigiWebApp.BookingController.book();DigiWebApp.SelectionController.saveSelection()},buchePauseTimeoutvar:null,buchePause:function(){var a=DigiWebApp.SelectionController.getActivities();a=_.map(a,function(b){if(typeof b==="undefined"){console.log("UNDEFINED ACTIVITY");return null}else{var c=null;return c=b.get("name").indexOf("Pause")>=0?{label:b.get("name"),value:b.get("id"),isSelected:YES}:{label:b.get("name"),value:b.get("id")}}});
DigiWebApp.SelectionController.set("activities",a);if(DigiWebApp.BookingController.checkBooking(YES)){DigiWebApp.ScholppBookingController.selectPause();DigiWebApp.ScholppBookingController.buchePauseTimeoutvar=setTimeout("DigiWebApp.ScholppBookingController.doBuchePause()",this.sleepFor)}},doBuchePause:function(){DigiWebApp.ScholppBookingController.buchePauseTimeoutvar!==null&&clearTimeout(DigiWebApp.ScholppBookingController.buchePauseTimeoutvar);DigiWebApp.BookingController.book();DigiWebApp.SelectionController.saveSelection()},
bucheArbeitsendeTimeoutvar:null,bucheArbeitsende:function(){DigiWebApp.ScholppBookingController.selectArbeitsende();DigiWebApp.ScholppBookingController.bucheArbeitsendeTimeoutvar=setTimeout("DigiWebApp.ScholppBookingController.doBucheArbeitsende()",this.sleepFor)},doBucheArbeitsende:function(){DigiWebApp.ScholppBookingController.bucheArbeitsendeTimeoutvar!==null&&clearTimeout(DigiWebApp.ScholppBookingController.bucheArbeitsendeTimeoutvar);DigiWebApp.BookingController.closeDay();DigiWebApp.SelectionController.resetSelection()},
selectFahrzeit:function(){DigiWebApp.ScholppBookingController.resetButtons();$("#"+DigiWebApp.BookingPageWithIconsScholpp.content.fahrzeit_arbeitszeit_spezial_ButtonGrid.fahrzeitButtonGrid.button.id)[0].classList.add("buttonSelected")},selectArbeitszeit:function(){DigiWebApp.ScholppBookingController.resetButtons();$("#"+DigiWebApp.BookingPageWithIconsScholpp.content.fahrzeit_arbeitszeit_spezial_ButtonGrid.arbeitszeitButtonGrid.button.id)[0].classList.add("buttonSelected")},selectUnterbrechung:function(){DigiWebApp.ScholppBookingController.resetButtons();
$("#"+DigiWebApp.BookingPageWithIconsScholpp.content.unterbrechung_pause_arbeitsende_ButtonGrid.unterbrechungButtonGrid.button.id)[0].classList.add("buttonSelected")},selectPause:function(){DigiWebApp.ScholppBookingController.resetButtons();$("#"+DigiWebApp.BookingPageWithIconsScholpp.content.unterbrechung_pause_arbeitsende_ButtonGrid.pauseButtonGrid.button.id)[0].classList.add("buttonSelected")},selectArbeitsende:function(){DigiWebApp.ScholppBookingController.resetButtons();$("#"+DigiWebApp.BookingPageWithIconsScholpp.content.unterbrechung_pause_arbeitsende_ButtonGrid.arbeitsendeButtonGrid.button.id)[0].classList.add("buttonSelected")}});
DigiWebApp.BautagebuchNotizenDetailsController=M.Controller.extend({item:null,positionId:null,positionName:null,positionenList:null,activityId:null,activityName:null,activityList:null,data:null,init:function(){},load:function(a){this.set("item",a);this.set("positionId",a.get("positionId"));this.set("positionName",a.get("positionName"));this.set("activityId",a.get("activityId"));this.set("activityName",a.get("activityName"));this.set("data",a.get("data"));this.setTaetigkeiten(a.get("positionId"))},
save:function(){if(M.ViewManager.getView("bautagebuchNotizenDetailsPage","positionComboBox").getSelection()==="0"){DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("noPosSelected"),message:M.I18N.l("noPosSelectedMsg")});return false}this.item.set("positionId",this.positionId);this.item.set("positionName",this.positionName);this.item.set("activityId",this.activityId);this.item.set("activityName",this.activityName);this.data!==DigiWebApp.BautagebuchNotizenDetailsPage.content.dataInput.initialText?
this.item.set("data",this.data):this.item.set("data",null);if(this.item.saveSorted()){DigiWebApp.BautagebuchNotizenListeController.set("items",DigiWebApp.BautagebuchNotiz.findSorted(DigiWebApp.BautagebuchBautageberichtDetailsController.item.m_id));DigiWebApp.NavigationController.backToBautagebuchNotizenListePageTransition();return true}else return false},deleteNotiz:function(){if(this.item.deleteSorted()){DigiWebApp.BautagebuchNotizenListeController.set("items",DigiWebApp.BautagebuchNotiz.findSorted(DigiWebApp.BautagebuchBautageberichtDetailsController.item.m_id));
DigiWebApp.NavigationController.backToBautagebuchNotizenListePageTransition();return true}else return false},setTaetigkeiten:function(a){var b=this;if(typeof a!=="undefined"){var c=_.select(DigiWebApp.WorkPlan.find(),function(e){if(e)return e.get("id")==a}),d=NO,f=null;f=c.length>0?DigiWebApp.SelectionController.getActivitiesFromWorkplan(c[0]):DigiWebApp.SelectionController.getActivities();c=_.map(f,function(e){if(typeof e==="undefined")console.log("UNDEFINED activity");else{e={label:e.get("name"),
value:e.get("id"),isSelected:NO};if(b.activityId===e.value)d=e.isSelected=YES;return e}});c=_.compact(c);c.push({label:M.I18N.l("selectSomethingOptional"),value:"0",isSelected:!d});b.set("activityList",c)}}});
DigiWebApp.BautagebuchMainController=M.Controller.extend({projektleiter:null,mitarbeiter:null,auftraege:null,materialien:null,mengeneinheiten:null,wetterDefaults:{temperatur:0,luftfeuchtigkeit:0,bewoelkung:0,niederschlag:0,wind:0,wechselhaft:NO,wechselhaftItem:[{value:"wechselhaft",label:M.I18N.l("BautagebuchWechselhaft"),isSelected:NO}]},init:function(){DigiWebApp.BautagebuchEinstellungenController.load();if(DigiWebApp.BautagebuchMengeneinheit.findSorted().length===0){var a=1;DigiWebApp.BautagebuchMengeneinheit.createRecord({id:a,
bezeichnung:"St\u00fcck",kuerzel:"Stk"}).saveSorted();a+=1;DigiWebApp.BautagebuchMengeneinheit.createRecord({id:a,bezeichnung:"Packung",kuerzel:"Pkg"}).saveSorted();a+=1;DigiWebApp.BautagebuchMengeneinheit.createRecord({id:a,bezeichnung:"Karton",kuerzel:"Ktn"}).saveSorted();a+=1;DigiWebApp.BautagebuchMengeneinheit.createRecord({id:a,bezeichnung:"Palette",kuerzel:"Pal"}).saveSorted();a+=1;DigiWebApp.BautagebuchMengeneinheit.createRecord({id:a,bezeichnung:"Gramm",kuerzel:"g"}).saveSorted();a+=1;DigiWebApp.BautagebuchMengeneinheit.createRecord({id:a,
bezeichnung:"Kilogramm",kuerzel:"kg"}).saveSorted();a+=1;DigiWebApp.BautagebuchMengeneinheit.createRecord({id:a,bezeichnung:"Zentner",kuerzel:"Ztr"}).saveSorted();a+=1;DigiWebApp.BautagebuchMengeneinheit.createRecord({id:a,bezeichnung:"Tonne",kuerzel:"t"}).saveSorted();a+=1;DigiWebApp.BautagebuchMengeneinheit.createRecord({id:a,bezeichnung:"Millimeter",kuerzel:"mm"}).saveSorted();a+=1;DigiWebApp.BautagebuchMengeneinheit.createRecord({id:a,bezeichnung:"Zentimeter",kuerzel:"cm"}).saveSorted();a+=1;
DigiWebApp.BautagebuchMengeneinheit.createRecord({id:a,bezeichnung:"Meter",kuerzel:"m"}).saveSorted();a+=1;DigiWebApp.BautagebuchMengeneinheit.createRecord({id:a,bezeichnung:"Laufmeter",kuerzel:"lfm"}).saveSorted();a+=1;DigiWebApp.BautagebuchMengeneinheit.createRecord({id:a,bezeichnung:"Kilometer",kuerzel:"km"}).saveSorted();a+=1;DigiWebApp.BautagebuchMengeneinheit.createRecord({id:a,bezeichnung:"Quadratmeter",kuerzel:"qm"}).saveSorted();a+=1;DigiWebApp.BautagebuchMengeneinheit.createRecord({id:a,
bezeichnung:"Milliliter",kuerzel:"ml"}).saveSorted();a+=1;DigiWebApp.BautagebuchMengeneinheit.createRecord({id:a,bezeichnung:"Deziliter",kuerzel:"dl"}).saveSorted();a+=1;DigiWebApp.BautagebuchMengeneinheit.createRecord({id:a,bezeichnung:"Liter",kuerzel:"l"}).saveSorted();a+=1;DigiWebApp.BautagebuchMengeneinheit.createRecord({id:a,bezeichnung:"Hektoliter",kuerzel:"hl"}).saveSorted();a+=1;DigiWebApp.BautagebuchMengeneinheit.createRecord({id:a,bezeichnung:"Kubikmeter",kuerzel:"kbm"}).saveSorted();a+=
1}a=NO;if(DigiWebApp.BautagebuchProjektleiter.findSorted().length!==0){a=NO;var b=DigiWebApp.BautagebuchProjektleiter.findSorted();b=_.map(b,function(c){if(typeof c==="undefined")console.log("UNDEFINED PROJEKTLEADER");else return{label:c.vollername(),value:c.get("id")}});b=_.compact(b);b.push({label:M.I18N.l("selectSomething"),value:"0",isSelected:!a});this.set("projektleiter",b)}if(DigiWebApp.BautagebuchMitarbeiter.findSorted().length!==0){a=NO;a=DigiWebApp.BautagebuchMitarbeiter.findSorted();a=
_.map(a,function(c){if(typeof c==="undefined")console.log("UNDEFINED WORKER");else return{label:c.vollername(),value:c.get("id")}});a=_.compact(a);this.set("mitarbeiter",a)}a=NO;b=DigiWebApp.HandOrder.findSorted().concat(DigiWebApp.Order.findSorted());b=_.map(b,function(c){if(typeof c==="undefined")console.log("UNDEFINED ORDER");else return{label:c.get("name"),value:c.get("id")}});b=_.compact(b);b.push({label:M.I18N.l("selectSomething"),value:"0",isSelected:!a});this.set("auftraege",b);b=[];if(DigiWebApp.BautagebuchMaterial.findSorted().length!==
0){a=NO;b=DigiWebApp.BautagebuchMaterial.findSorted();b=_.map(b,function(c){if(typeof c==="undefined")console.log("UNDEFINED MATERIAL");else return{label:c.get("bezeichnung"),value:c.get("id")}});b=_.compact(b)}b.push({label:M.I18N.l("BautagebuchManuelleEingabe"),value:"0",isSelected:!a});this.set("materialien",b);b=[];if(DigiWebApp.BautagebuchMengeneinheit.findSorted().length!==0){a=NO;b=DigiWebApp.BautagebuchMengeneinheit.findSorted();b=_.map(b,function(c){if(typeof c==="undefined")console.log("UNDEFINED MATERIAL");
else return{label:c.get("bezeichnung")+" ("+c.get("kuerzel")+")",value:c.get("id")}});b=_.compact(b)}b.push({label:M.I18N.l("BautagebuchManuelleEingabe"),value:"0",isSelected:!a});this.set("mengeneinheiten",b)}});
DigiWebApp.BautagebuchMedienDetailsController=M.Controller.extend({item:null,positionId:null,positionName:null,positionenList:null,activityId:null,activityName:null,activityList:null,data:null,remark:null,fileType:null,loadedFileName:null,init:function(){},load:function(a){var b=this;b.set("item",a);b.set("positionId",a.get("positionId"));b.set("positionName",a.get("positionName"));b.set("activityId",a.get("activityId"));b.set("activityName",a.get("activityName"));document.getElementById(DigiWebApp.BautagebuchMedienDetailsPage.content.image.id).src=
"";a.readFromFile(function(c){DigiWebApp.ApplicationController.DigiLoaderView.hide();if(c&&c!==""){b.set("data",c);document.getElementById(DigiWebApp.BautagebuchMedienDetailsPage.content.image.id).src=c}},function(){b.set("data",null);document.getElementById(DigiWebApp.BautagebuchMedienDetailsPage.content.image.id).src=""});b.set("remark",a.get("remark"))},save:function(){if(M.ViewManager.getView("bautagebuchMedienDetailsPage","positionComboBox").getSelection()==="0"){DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("noPosSelected"),
message:M.I18N.l("noPosSelectedMsg")});return false}this.item.set("positionId",this.positionId);this.item.set("positionName",this.positionName);if(parseInt(this.activityId)!==0){this.item.set("activityId",this.activityId);this.item.set("activityName",this.activityName)}else{this.item.set("activityId",null);this.item.set("activityName",null)}this.remark!==DigiWebApp.BautagebuchMedienDetailsPage.content.remarkInput.initialText?this.item.set("remark",this.remark):this.item.set("remark",null);if(this.item.saveSorted()){this.item.saveToFile(document.getElementById(DigiWebApp.BautagebuchMedienDetailsPage.content.image.id).src,
function(){DigiWebApp.ApplicationController.DigiLoaderView.hide();DigiWebApp.BautagebuchMedienListeController.set("items",DigiWebApp.BautagebuchMediaFile.findSorted(DigiWebApp.BautagebuchBautageberichtDetailsController.item.m_id));DigiWebApp.NavigationController.backToBautagebuchMedienListePageTransition()});return true}else return false},deleteMedienBuchung:function(){if(this.item.deleteSorted()!==false){DigiWebApp.BautagebuchMedienListeController.set("items",DigiWebApp.BautagebuchMediaFile.findSorted(DigiWebApp.BautagebuchBautageberichtDetailsController.item.m_id));
DigiWebApp.NavigationController.backToBautagebuchMedienListePageTransition();return true}else return false},setTaetigkeiten:function(a){var b=this;if(typeof a!=="undefined"){var c=_.select(DigiWebApp.WorkPlan.find(),function(e){if(e)return e.get("id")==a}),d=NO,f=null;f=c.length>0?DigiWebApp.SelectionController.getActivitiesFromWorkplan(c[0]):DigiWebApp.SelectionController.getActivities();c=_.map(f,function(e){if(typeof e==="undefined")console.log("UNDEFINED activity");else{e={label:e.get("name"),
value:e.get("id"),isSelected:NO};if(b.activityId===e.value)d=e.isSelected=YES;return e}});c=_.compact(c);c.push({label:M.I18N.l("selectSomethingOptional"),value:"0",isSelected:!d});b.set("activityList",c)}},takePicture:function(){navigator.camera.getPicture(this.cameraSuccessBase64,this.cameraError,{quality:40,destinationType:navigator.camera.DestinationType.DATA_URL})},cameraSuccessBase64:function(a){var b=DigiWebApp.BautagebuchMedienDetailsController;b.set("data",a);b.set("fileType",DigiWebApp.ApplicationController.CONSTImageFiletype);
document.getElementById(DigiWebApp.BautagebuchMedienDetailsPage.content.image.id).src="data:"+DigiWebApp.ApplicationController.CONSTImageFiletype+","+a;DigiWebApp.NavigationController.toBautagebuchMedienDetailsPageTransition()},cameraError:function(a){DigiWebApp.ApplicationController.nativeAlertDialogView({title:"ERROR",message:a,callbacks:{confirm:{target:this,action:function(){DigiWebApp.NavigationController.backToBautagebuchMedienListePageTransition()}}}})}});
DigiWebApp.RequestController=M.Controller.extend({GatewayServer:"www.digi-gps.de",DatabaseServer:null,DatabaseServerTimestamp:null,handy2WebServicesUrl:"/Handy2WebServices/services/DatenTransfer",successCallback:{},errorCallback:{},softwareVersion:4702,makeRequest:function(a){var b=this;M.Request.init({url:"http://"+DigiWebApp.RequestController.DatabaseServer+DigiWebApp.RequestController.handy2WebServicesUrl+"/"+a.url+(a.urlParams?"?"+a.urlParams:""),method:"GET",beforeSend:function(c){a.loaderText?
DigiWebApp.ApplicationController.DigiLoaderView.show(a.loaderText):DigiWebApp.ApplicationController.DigiLoaderView.show("Lade Daten");c.setRequestHeader("Cache-Control","no-cache")},onSuccess:function(c,d,f){var e=NO;if(typeof a.leaveLoaderOpen!=="undefined")e=a.leaveLoaderOpen;e||DigiWebApp.ApplicationController.DigiLoaderView.hide();this.bindToCaller(b,b.handleSuccessCallback,[c,d,f,a.isWorkPlanRequest,a.isKolonnenRequest,a.source])()},onError:function(c,d){console.error("Error in makeRequest: "+
d);DigiWebApp.ApplicationController.DigiLoaderView.hide();this.bindToCaller(b,b.handleErrorCallback,[c,d,a.source])()}}).send()},getUrl:function(){try{if(device&&device.uuid)return"http://"+DigiWebApp.RequestController.DatabaseServer+DigiWebApp.RequestController.handy2WebServicesUrl+"/"}catch(a){return"/Handy2WebServices/services/DatenTransfer/"}},getDatabaseServer:function(a,b){if(location.host==="localhost:8080"||DigiWebApp.SettingsController.getSetting("debugDatabaseServer")){DigiWebApp.RequestController.DatabaseServer=
location.host==="localhost:8080"?"localhost:8080":DigiWebApp.SettingsController.getSetting("debugDatabaseServer");return a(b)}if(!DigiWebApp.RequestController.DatabaseServer||DigiWebApp.RequestController.DatabaseServerTimestamp&&DigiWebApp.RequestController.DatabaseServerTimestamp-(new Date).getTime()>6E4)console.log("getDatabaseServer");else return a(b);DigiWebApp.RequestController.DatabaseServer="";var c=DigiWebApp.SettingsController.getSetting("company"),d=DigiWebApp.RequestController.GatewayServer;
if(typeof device==="undefined")d=location.host;M.Request.init({url:"http://"+d+DigiWebApp.RequestController.handy2WebServicesUrl+"/empfangeUrl?firmenId="+c+"&modus=0&requestTimestamp="+M.Date.now().date.valueOf(),method:"GET",beforeSend:function(f){DigiWebApp.ApplicationController.DigiLoaderView.show(M.I18N.l("empfangeUrlLoader"));f.setRequestHeader("Cache-Control","no-cache")},onSuccess:function(f){DigiWebApp.ApplicationController.DigiLoaderView.hide();f=DigiWebApp.RequestController.transformResultToJson(f);
if(typeof f["return"]==="undefined"&&typeof f["ns:return"]!=="undefined")f["return"]=f["ns:return"];if(f["return"]!=="")DigiWebApp.RequestController.DatabaseServer=f["return"];else{console.log("FALLBACK: empty DatabaseServer --\> falling back to GatewayServer");DigiWebApp.RequestController.DatabaseServer=DigiWebApp.RequestController.GatewayServer}DigiWebApp.RequestController.DatabaseServerTimestamp=(new Date).getTime();if(typeof device==="undefined")location.host!==DigiWebApp.RequestController.DatabaseServer?
DigiWebApp.ApplicationController.nativeConfirmDialogView({title:M.I18N.l("wrongServer"),message:M.I18N.l("wrongServerMessage"),confirmButtonValue:M.I18N.l("yes"),cancelButtonValue:M.I18N.l("appZuruecksetzen"),callbacks:{confirm:{target:this,action:function(){location.href="http://"+DigiWebApp.RequestController.DatabaseServer+location.pathname}},cancel:{target:this,action:function(){DigiWebApp.ApplicationController.deleteAllData();if(typeof navigator.app!=="undefined")typeof location.origin!=="undefined"?
navigator.app.loadUrl(location.origin+location.pathname):navigator.app.loadUrl(location.protocol+"//"+location.pathname);else window.location.reload()}}}}):a(b);else a(b)},onError:function(f,e){trackError("Error in getDatabaseServer: "+e+"\nXHR: "+JSON.stringify(f));DigiWebApp.ApplicationController.DigiLoaderView.hide();DigiWebApp.ApplicationController.proceedWithLocalData("getDatabaseServer")}}).send()},myRequest:null,authenticate:function(a){DigiWebApp.RequestController.getDatabaseServer(DigiWebApp.RequestController.authenticateWithDatabaseServer,
a)},authenticateWithDatabaseServer:function(a){DigiWebApp.RequestController.saveCallbacks(a.success,a.error,"authenticate");var b=DigiWebApp.SettingsController.getSetting("company"),c=DigiWebApp.SettingsController.getSetting("password"),d=DigiWebApp.SettingsController.getSetting("workerId");b={url:"authentifizieren",urlParams:"firmenId="+b+"&kennwort="+c+"&geraeteId="+d+"&geraeteTyp=2&softwareVersion="+DigiWebApp.RequestController.softwareVersion+"&requestTimestamp="+M.Date.now().date.valueOf(),loaderText:M.I18N.l("authenticateLoader"),
source:"authenticate"};DigiWebApp.RequestController.makeRequest(_.extend(a,b))},endSession:function(a){this.saveCallbacks(a.success,a.error,"endSession");this.makeRequest(_.extend(a,{url:"beendeSession",urlParams:"modus=0&requestTimestamp="+M.Date.now().date.valueOf(),loaderText:M.I18N.l("logout"),source:"endSession"}))},getActivities:function(a){this.saveCallbacks(a.success,a.error,"getActivities");this.makeRequest(_.extend(a,{url:"empfangeTaetigkeiten",urlParams:"modus=1&requestTimestamp="+M.Date.now().date.valueOf(),
loaderText:M.I18N.l("getActivitiesLoader"),source:"getActivities",leaveLoaderOpen:YES}))},getOrders:function(a){this.saveCallbacks(a.success,a.error,"getOrders");this.makeRequest(_.extend(a,{url:"empfangeAuftraege",urlParams:"modus=0&requestTimestamp="+M.Date.now().date.valueOf(),loaderText:M.I18N.l("getOrdersLoader"),source:"getOrders",leaveLoaderOpen:YES}))},getFeatures:function(a){this.saveCallbacks(a.success,a.error,"getFeatures");this.makeRequest(_.extend(a,{url:"empfangeKonfiguration",urlParams:"modus=0&requestTimestamp="+
M.Date.now().date.valueOf(),loaderText:M.I18N.l("getFeaturesLoader"),source:"getFeatures",leaveLoaderOpen:YES}))},getPositions:function(a){this.saveCallbacks(a.success,a.error,"getPositions");this.makeRequest(_.extend(a,{url:"empfangePositionenInfo",urlParams:"modus=0&requestTimestamp="+M.Date.now().date.valueOf(),loaderText:M.I18N.l("getPositionsLoader"),source:"getPositions",leaveLoaderOpen:YES}))},getWorkPlans:function(a){this.saveCallbacks(a.success,a.error,"getWorkPlans");this.makeRequest(_.extend(a,
{isWorkPlanRequest:YES,url:"empfangeArbeitsplanNeu",urlParams:"modus=0&requestTimestamp="+M.Date.now().date.valueOf(),loaderText:M.I18N.l("getWorkPlansLoader"),source:"getWorkPlans",leaveLoaderOpen:YES}))},getHandOrders:function(a){this.saveCallbacks(a.success,a.error,"getHandOrders");this.makeRequest(_.extend(a,{url:"empfangeHandauftraege",urlParams:"modus=0&requestTimestamp="+M.Date.now().date.valueOf(),loaderText:M.I18N.l("getHandOrdersLoader"),source:"getHandOrders",leaveLoaderOpen:YES}))},getKolonne:function(a){this.saveCallbacks(a.success,
a.error,"getKolonne");this.makeRequest(_.extend(a,{isKolonnenRequest:YES,url:"empfangeKolonne",urlParams:"modus=0&requestTimestamp="+M.Date.now().date.valueOf(),loaderText:M.I18N.l("getKolonne"),source:"getKolonne",leaveLoaderOpen:YES}))},buildDataBodyConfiguration:function(a){var b="";a=typeof a==="object"&&!_.isArray(a)?[a]:a;var c=+new Date;if(_.isArray(a))for(var d in a){var f=a[d],e;for(e in f.record){var g="   <tran:konfigurationHandy>\n       <xsd:keyId><keyId></xsd:keyId>\n       <xsd:value><value></xsd:value>\n       <xsd:valueType><valueType></xsd:valueType>\n       <xsd:mitarbeiter><mitarbeiter></xsd:mitarbeiter>\n       <xsd:timestamp><timestamp></xsd:timestamp>\n   </tran:konfigurationHandy>\n";
if(!(e==="_createdAt"||e==="_updatedAt")){g=g.replace(/<keyId>/,e);g=g.replace(/<value>/,f.get(e));g=g.replace(/<valueType>/,"SettingRemote_WebApp");g=g.replace(/<mitarbeiter>/,DigiWebApp.SettingsController.getSetting("workerId"));g=g.replace(/<timestamp>/,c);b+=g}}}for(;b.match(/><.*<\/xsd:/)!==null;)b=b.replace(/><.*<\/xsd:/,"></xsd:");return b},sendConfiguration:function(a){this.authenticate({success:{target:this,action:function(){var b=this;this.saveCallbacks(a.success,a.error,"sendConfiguration");
var c='<soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/" xmlns:tran="http://transfer.webservice.handy2.digi.de" xmlns:xsd="http://transferClasses.data.handy2.digi.de/xsd"><soapenv:Header/><soapenv:Body><tran:sendeKonfiguration>';c+=this.buildDataBodyConfiguration(a.settings);c+="   <tran:modus>0</tran:modus></tran:sendeKonfiguration></soapenv:Body></soapenv:Envelope>";M.Request.init({url:"http://"+DigiWebApp.RequestController.DatabaseServer+DigiWebApp.RequestController.handy2WebServicesUrl+
".DatenTransferHttpSoap11Endpoint/",method:"POST",data:c,timeout:15E3,contentType:"text/xml; charset=UTF-8",dataType:"xml",beforeSend:function(d){a.loaderText?DigiWebApp.ApplicationController.DigiLoaderView.show(a.loaderText):DigiWebApp.ApplicationController.DigiLoaderView.show(M.I18N.l("sendConfigurationMsg"));d.setRequestHeader("SOAPAction","urn:sendeKonfiguration");d.setRequestHeader("Content-Type","text/xml;charset=UTF-8")},onSuccess:function(d,f,e){b.endSession({success:{target:b,action:function(){DigiWebApp.ApplicationController.DigiLoaderView.hide();
this.bindToCaller(this,this.handleSuccessCallback,[d,f,e,null,null,"sendConfiguration"])();DigiWebApp.ApplicationController.authenticate()}},error:{target:b,action:function(){DigiWebApp.ApplicationController.DigiLoaderView.hide();this.bindToCaller(this,this.handleSuccessCallback,[d,f,e,null,null,"sendConfiguration"])();DigiWebApp.ApplicationController.authenticate()}}})},onError:function(d,f){b.endSession({success:{target:b,action:function(){DigiWebApp.ApplicationController.DigiLoaderView.hide();
b.bindToCaller(b,b.handleErrorCallback,[d,f,"sendConfiguration"])();DigiWebApp.ApplicationController.authenticate()}},error:{target:b,action:function(){DigiWebApp.ApplicationController.DigiLoaderView.hide();b.bindToCaller(b,b.handleErrorCallback,[d,f,"sendConfiguration"])();DigiWebApp.ApplicationController.authenticate()}}})}}).send()}},error:{target:this,action:function(){DigiWebApp.ApplicationController.authenticate();console.error("ConnectionError while sendConfiguration")}}})},handleSuccessCallback:function(a,
b,c,d,f,e){var g=null;if(!d&&!f)g=this.transformResultToJson(a);else if(d)g=this.transformWorkPlanXmlToJson(a);else if(f)g=this.transformKolonneXmlToJson(a);M.EventDispatcher.checkHandler(this.successCallback[e]);this.successCallback[e].target=this.successCallback[e].target||this;this.bindToCaller(this.successCallback[e].target,this.successCallback[e].action,[g,b,c])()},handleErrorCallback:function(a,b,c){M.EventDispatcher.checkHandler(this.errorCallback[c]);this.errorCallback[c].target=this.errorCallback[c].target||
this;this.bindToCaller(this.errorCallback[c].target,this.errorCallback[c].action,[a,b])()},saveCallbacks:function(a,b,c){if(a)this.successCallback[c]=a;if(b)this.errorCallback[c]=b},transformResultToJson:function(a){return $.xml2json(a)},transformWorkPlanXmlToJson:function(a){var b={};b["return"]=[];a=$.parseXML(a);YES||$(a).find("return").length!==a.documentElement.childNodes.length?_.forEach(a.documentElement.childNodes,function(c){var d={};d.positionen=[];d.taetigkeitsIds=[];for(var f=(c.childNodes.length-
2)/2,e=c.childNodes[0].childNodes[0].nodeValue,g=c.childNodes[1].childNodes[0].nodeValue,h=2;h<f+2;h++){var i=c.childNodes[h].childNodes[0].nodeValue,j=c.childNodes[h+f].childNodes[0].nodeValue;d.arbeitsplanId=e;d.arbeitsplanTyp=g;d.positionen.push(i);d.taetigkeitsIds.push(j)}b["return"].push(d)}):$(a).find("return").each(function(c,d){var f={};$(d).find('[localName$="arbeitsplanId"]').each(function(e,g){f.arbeitsplanId=$(g).text()});$(d).find('[localName$="arbeitsplanTyp"]').each(function(e,g){f.arbeitsplanTyp=
$(g).text()});f.positionen=[];$(d).find('[localName$="positionTaetigkeit"]').each(function(e,g){f.positionen.push($(g).text())});f.taetigkeitsIds=[];$(d).find('[localName$="tateigkeitId"]').each(function(e,g){f.taetigkeitsIds.push($(g).text())});b["return"].push(f)});return b},transformKolonneXmlToJson:function(a){var b={};b["return"]=[];a=$.parseXML(a);YES||$(a).find("return").length!==a.documentElement.childNodes.length?_.forEach(a.documentElement.childNodes,function(d){var f={};f.mitarbeiterIds=
[];f.mitarbeiterName=[];for(var e=(d.childNodes.length-1)/2,g=d.childNodes[0].childNodes[0].nodeValue,h=1;h<=e;h++){var i=d.childNodes[h].childNodes[0].nodeValue,j=d.childNodes[h+e].childNodes[0].nodeValue;f.kolonnenId=g;f.mitarbeiterIds.push(i);f.mitarbeiterName.push(j)}b["return"]=f}):$(a).find("return").each(function(d,f){var e={};$(f).find('[nodeName$="kolonnenId"]').each(function(g,h){e.kolonnenId=$(h).text()});e.mitarbeiterIds=[];$(f).find('[nodeName$="mitarbeiterId"]').each(function(g,h){e.mitarbeiterIds.push($(h).text())});
e.mitarbeiterName=[];$(f).find('[nodeName$="mitarbeiterName"]').each(function(g,h){e.mitarbeiterName.push($(h).text())});b["return"]=e});if(b["return"]&&b["return"].mitarbeiterIds){a=[];for(var c in b["return"].mitarbeiterIds)a.push({kolonnenId:b["return"].kolonnenId,id:b["return"].mitarbeiterIds[c],name:b["return"].mitarbeiterName[c]});b["return"]=a;return b}else return null},connectionError:function(){DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("connectionError"),message:M.I18N.l("connectionErrorMsg")})}});
DigiWebApp.ApplicationController=M.Controller.extend({CONSTImageFiletype:"image/jpeg;base64",CONSTAudioFiletype:"audio/wav;base64",CONSTVideoFiletype:"video/mp4;base64",CONSTTextFiletype:"text/plain",CONSTApplicationQuota:10485760,CONSTVibrateDuration:100,myns:"ax21",dayNamesShort:[M.I18N.l("Monday").substr(0,3),M.I18N.l("Tuesday").substr(0,3),M.I18N.l("Wednesday").substr(0,3),M.I18N.l("Thursday").substr(0,3),M.I18N.l("Friday").substr(0,3),M.I18N.l("Saturday").substr(0,3),M.I18N.l("Sunday").substr(0,
3)],dayNames:[M.I18N.l("Monday"),M.I18N.l("Tuesday"),M.I18N.l("Wednesday"),M.I18N.l("Thursday"),M.I18N.l("Friday"),M.I18N.l("Saturday"),M.I18N.l("Sunday")],monthNamesShort:[M.I18N.l("january").substr(0,3),M.I18N.l("february").substr(0,3),M.I18N.l("march").substr(0,3),M.I18N.l("april").substr(0,3),M.I18N.l("may").substr(0,3),M.I18N.l("june").substr(0,3),M.I18N.l("july").substr(0,3),M.I18N.l("august").substr(0,3),M.I18N.l("september").substr(0,3),M.I18N.l("october").substr(0,3),M.I18N.l("november").substr(0,
3),M.I18N.l("december").substr(0,3)],monthNames:[M.I18N.l("january"),M.I18N.l("february"),M.I18N.l("march"),M.I18N.l("april"),M.I18N.l("may"),M.I18N.l("june"),M.I18N.l("july"),M.I18N.l("august"),M.I18N.l("september"),M.I18N.l("october"),M.I18N.l("november"),M.I18N.l("december")],restartApp:NO,activeFeaturesBeforeTransfer:[],syncStartTimestamp:null,syncStopTimestamp:null,syncLastDuration:null,syncRunning:NO,savedUseTransitions:NO,triggerUpdate:NO,useSplashJustForFade:NO,makeUnselectable:function(){return null},
blackBerryRestart_var:null,blackBerryRestart:function(){DigiWebApp.ApplicationController.blackBerryRestart_var!==null&&clearTimeout(DigiWebApp.ApplicationController.blackBerryRestart_var);DigiWebApp.app=M.Application.design(DigiWebAppOrdinaryDesign);DigiWebApp.app.main();DigiWebApp.ApplicationController.regSecEv(YES)},nativeAlertDialogView:function(a){M.Environment.getPlatform().substr(0,10);if(typeof a.confirmButtonValue==="undefined")a.confirmButtonValue="Ok";if(typeof a.title==="undefined")a.title=
"Alert";if(typeof a.message==="undefined")a.message="";var b=function(){};if(typeof a.callbacks!=="undefined")if(typeof a.callbacks.confirm.target===undefined)if(typeof a.callbacks.confirm.action==="function")b=a.callbacks.confirm.action;else console.error("ERROR: callback without target given but action is not a function!");else if(typeof a.callbacks.confirm.target==="function")b=a.callbacks.confirm.target;else if(typeof a.callbacks.confirm.action==="string")b=a.callbacks.confirm.target[a.callbacks.confirm.action];
else if(typeof a.callbacks.confirm.action==="function")b=a.callbacks.confirm.action;else console.error("ERROR: action is neither a string nor a function!");typeof navigator.notification==="undefined"?M.DialogView.alert(a):navigator.notification.alert(a.message,function(c){switch(c){case 0:b();break;case "0":b();break;case 1:b();break;case "1":b();break;case a.confirmButtonValue:b();break;case "OK":b();break;default:alert('ERROR: yet unknown button "'+c+'" pressed.')}},a.title,a.confirmButtonValue)},
nativeConfirmDialogView:function(a){M.Environment.getPlatform().substr(0,10);if(typeof a.confirmButtonValue==="undefined")a.confirmButtonValue="Ok";if(typeof a.cancelButtonValue==="undefined")a.cancelButtonValue="Cancel";if(typeof a.title==="undefined")a.title="Confirm";if(typeof a.message==="undefined")a.message="";typeof navigator.notification==="undefined"?M.DialogView.confirm(a):navigator.notification.confirm(a.message,function(b){switch(b){case 0:a.callbacks.confirm.action();break;case 1:a.callbacks.confirm.action();
break;case 2:a.callbacks.cancel.action();break;case "0":a.callbacks.confirm.action();break;case "1":a.callbacks.confirm.action();break;case "2":a.callbacks.cancel.action();break;case a.confirmButtonValue:a.callbacks.confirm.action();break;case a.cancelButtonValue:a.callbacks.cancel.action();break;case "OK":a.callbacks.confirm.action();break;case "CANCEL":a.callbacks.cancel.action();break;default:alert('ERROR: yet unknown button "'+b+'" pressed.')}},a.title,[a.confirmButtonValue,a.cancelButtonValue])},
DigiLoaderView:{loaderMessage:" ",isVisible:function(){return M.LoaderView.refCount!==0},hide:function(){this.loaderMessage=" ";return M.LoaderView.hide(true)},show:function(a){this.isVisible()&&this.hide();if(DigiWebApp.SettingsController.getSetting("silentLoader")!==YES)this.loaderMessage=a;return M.LoaderView.show(this.loaderMessage)},getTitle:function(){return this.loaderMessage},setTitle:function(a){return this.show(a)},changeTitle:function(a){return this.setTitle(a)}},infoMsg:"",callbackStatus:null,
storagePrefix:M.LOCAL_STORAGE_PREFIX+M.Application.name+M.LOCAL_STORAGE_SUFFIX,clickCounter:0,clickLimit:9,skipEvents:false,regSecEv:function(a){var b=this;setTimeout(function(){b.realregSecEv(a)},100)},realregSecEv:function(a){console.log("in regSecEv");DigiWebApp.ApplicationController.setImageClass();M.I18N.defaultLanguage="de_de";if(a){var b=this;a=M.ViewManager.getView("infoPage","logo");b.clickCounter=0;$("#"+a.id).bind("touchstart",function(){if(DigiWebApp.InfoPage.lastTimePageWasLoaded<+new Date-
1E3){b.clickCounter++;if(b.clickCounter>b.clickLimit){b.clickCounter=0;b.showConfirmDialog()}}});$("#"+a.id).bind("mousedown",function(){if(DigiWebApp.InfoPage.lastTimePageWasLoaded<+new Date-1E3){b.clickCounter++;if(b.clickCounter>b.clickLimit){b.clickCounter=0;b.showConfirmDialog()}}});if(M.Environment.getPlatform().substr(0,10)==="BlackBerry"){console.log("registering emergencyhandler");$(document).bind("keydown",DigiWebApp.ApplicationController.keydownHandler)}}_.each(DigiWebApp.app.pages,function(c){typeof c.header!==
"undefined"&&$("#"+c.header.id).removeClass("fade")});$("[id="+DigiWebApp.TabBar.id+"]").each(function(){$(this).removeClass("fade")});this.setSkipEvents();if(this.skipEvents)this.devicereadyhandler();else{$(document).bind("deviceready",DigiWebApp.ApplicationController.devicereadyhandler);DigiWebApp.ApplicationController.timeoutdeviceready_var=setTimeout("DigiWebApp.ApplicationController.timeoutdevicereadyhandler()",1E3)}},setSkipEvents:function(){var a=M.Environment.getPlatform();this.skipEvents=
a.substr(-2)==="86"||a.substr(-5)==="Win32"||a.substr(-5)==="Win64"||a.substr(0,3)==="Mac"||a.substr(0,10)==="BlackBerry"?true:false;this.skipEvents=false},sizeMode:null,checkSizeModeChange:function(){if(this.sizeMode===null||this.timeouthappened)switch(true){case $(window).width()<320:if(this.sizeMode!=="w320"){this.sizeMode="w320";return true}else return false;case $(window).width()>=320&&$(window).width()<480:if(this.sizeMode!=="w480"){this.sizeMode="w480";return true}else return false;case $(window).width()>=
480&&$(window).width()<640:if(this.sizeMode!=="w640"){this.sizeMode="w640";return true}else return false;case $(window).width()>=640&&$(window).width()<800:if(this.sizeMode!=="w800"){this.sizeMode="w800";return true}else return false;case $(window).width()>=800&&$(window).width()<1024:if(this.sizeMode!=="w1024"){this.sizeMode="w1024";return true}else return false;case $(window).width()>=1024&&$(window).width()<1080:if(this.sizeMode!=="w1080"){this.sizeMode="w1080";return true}else return false;case $(window).width()>=
1080&&$(window).width()<1536:if(this.sizeMode!=="w1536"){this.sizeMode="w1536";return true}else return false;default:if(this.sizeMode!=="w5000"){this.sizeMode="w5000";return true}else return false}else return false},setImageClass:function(){if(M.Environment.getPlatform().substr(0,10)==="BlackBerry")console.log("We are on BlackBerry, so we skip dynamic Background!");else this.checkSizeModeChange()&&_.each(DigiWebApp.app.pages,function(a){if($("#"+a.id).get("0").classList&&!$("#"+a.id).get("0").classList.contains(DigiWebApp.ApplicationController.sizeMode)||
$("#"+a.id).get("0").className.split(" ").indexOf(DigiWebApp.ApplicationController.sizeMode)===-1)if(typeof DigiWebApp!="undefined")if(typeof DigiWebApp.SettingsController!="undefined")if(typeof DigiWebApp.SettingsController.getSetting("branding")!="undefined"&&DigiWebApp.SettingsController.getSetting("branding")!=""){var b=DigiWebApp.SettingsController.getSetting("branding").toUpperCase();$("body").classes(function(c){c.substring(c.length-8)==="branding"&&$("body").removeClass(c)});$("body").addClass(b+
"branding");$("#"+a.id).removeClass("w320").removeClass("w480").removeClass("w640").removeClass("w800").removeClass("w1024").removeClass("w1080").removeClass("w1536").removeClass("w5000");$("#"+a.id).removeClass(b+"_w320").removeClass(b+"_w480").removeClass(b+"_w640").removeClass(b+"_w800").removeClass(b+"_w1024").removeClass(b+"_w1080").removeClass(b+"_w1536").removeClass(b+"_w5000");$("#"+a.id).addClass(b+"_"+DigiWebApp.ApplicationController.sizeMode)}else{$("#"+a.id).removeClass("w320").removeClass("w480").removeClass("w640").removeClass("w800").removeClass("w1024").removeClass("w1080").removeClass("w1536").removeClass("w5000");
$("#"+a.id).addClass(DigiWebApp.ApplicationController.sizeMode)}else{$("#"+a.id).removeClass("w320").removeClass("w480").removeClass("w640").removeClass("w800").removeClass("w1024").removeClass("w1080").removeClass("w1536").removeClass("w5000");$("#"+a.id).addClass(DigiWebApp.ApplicationController.sizeMode)}else{$("#"+a.id).removeClass("w320").removeClass("w480").removeClass("w640").removeClass("w800").removeClass("w1024").removeClass("w1080").removeClass("w1536").removeClass("w5000");$("#"+a.id).addClass(DigiWebApp.ApplicationController.sizeMode)}})},
timeoutdeviceready_var:null,timeouthappened:false,timeoutdevicereadyhandler:function(){DigiWebApp.ApplicationController.timeoutdeviceready_var!==null&&clearTimeout(DigiWebApp.ApplicationController.timeoutdeviceready_var);DigiWebApp.ApplicationController.timeouthappened=true;var a='DIGI-WebApp hat Plattform "'+M.Environment.getPlatform()+'" ('+navigator.userAgent+") erkannt. Es werden keine Eventhandler registriert! (Version "+M.Application.getConfig("version")+")";console.log(a);if(typeof navigator.webkitPersistentStorage!==
"undefined")window.requestFileSystem=window.requestFileSystem||window.webkitRequestFileSystem;this.devicereadyhandler()},emergencyCode:"007RESET007",emergencyStartedTimestamp:null,emergencyStringEntered:"",keydownHandler:function(a){if(a.timeStamp-DigiWebApp.ApplicationController.emergencyStartedTimestamp>2E4){console.log("timeout: reset emergency-mechanism");DigiWebApp.ApplicationController.emergencyStartedTimestamp=a.timeStamp;DigiWebApp.ApplicationController.emergencyStringEntered=""}var b=DigiWebApp.ApplicationController.emergencyStringEntered.length,
c=String.fromCharCode(a.which).toUpperCase();if(c===DigiWebApp.ApplicationController.emergencyCode.substr(b,1))DigiWebApp.ApplicationController.emergencyStringEntered+=c;else{DigiWebApp.ApplicationController.emergencyStartedTimestamp=a.timeStamp;DigiWebApp.ApplicationController.emergencyStringEntered="";return true}if(DigiWebApp.ApplicationController.emergencyStringEntered===DigiWebApp.ApplicationController.emergencyCode){DigiWebApp.ApplicationController.emergencyStartedTimestamp=a.timeStamp;DigiWebApp.ApplicationController.emergencyStringEntered=
"";DigiWebApp.ApplicationController.showConfirmDialog()}return true},fixToobarsIntervalVar:null,devicereadyhandler:function(){DigiWebApp.NavigationController.toBookTimePage();DigiWebApp.TabBar.tabItem1.switchPage();try{navigator.splashscreen.hide()}catch(a){console.log("unable to hide splashscreen")}DigiWebApp.SettingsController.init(YES,YES);DigiWebApp.SettingsController.globalDebugMode=DigiWebApp.SettingsController.getSetting("debug")?YES:NO;try{if(DigiWebApp.SettingsController.featureAvailable("417")){var b=
[];DigiWebApp.ServiceAppController.listDirectory(function(d){b=[];_.each(d,function(f){if(f.search("DigiWebAppServiceApp.*.response.json")===0){DigiWebApp.SettingsController.getSetting("debug")&&console.log("delete "+f);b.push(f)}});DigiWebApp.ServiceAppController.deleteFilesInServiceApp(b,function(){DigiWebApp.ApplicationController.realDeviceReadyHandler()},function(){DigiWebApp.ApplicationController.realDeviceReadyHandler()})})}else DigiWebApp.ApplicationController.realDeviceReadyHandler()}catch(c){DigiWebApp.ApplicationController.realDeviceReadyHandler()}},
backButtonHandlerRegistered:null,menuButtonHandlerRegistered:null,realDeviceReadyHandler:function(){writeToLog("DIGI-WebApp deviceReady "+(new Date).toString());DigiWebApp.ApplicationController.DigiLoaderView.hide();DigiWebApp.NavigationController.toBookTimePage();DigiWebApp.TabBar.tabItem1.switchPage();try{navigator.splashscreen.hide()}catch(a){console.log("unable to hide splashscreen")}if(M.Environment.getPlatform().substr(0,10)==="BlackBerry"){_.each(DigiWebApp.app.pages,function(b){typeof b.header!==
"undefined"&&$("#"+b.header.id).removeClass("ui-header-fixed")});$("[id="+DigiWebApp.TabBar.id+"]").each(function(){$(this).removeClass("ui-footer-fixed")})}DigiWebApp.ApplicationController.timeoutdeviceready_var!==null&&clearTimeout(DigiWebApp.ApplicationController.timeoutdeviceready_var);DigiWebApp.ApplicationController.setImageClass();$(window).resize(function(){DigiWebApp.ApplicationController.setImageClass()});DigiWebApp.ApplicationController.init(true);if(this.skipEvents!==true||M.Environment.getPlatform().substr(0,
10)==="BlackBerry"&&DigiWebApp.ApplicationController.timeouthappened!==true){if(backButtonHandlerRegistered===null){$(document).bind("backbutton",DigiWebApp.ApplicationController.backbuttonhandler);backButtonHandlerRegistered=YES}if(menuButtonHandlerRegistered===null){$(document).bind("menubutton",DigiWebApp.ApplicationController.menubuttonhandler);menuButtonHandlerRegistered=YES}}},inAppBrowser_var:null,closeChildbrowser:function(){try{plugins.childBrowser.close()}catch(a){}try{DigiWebApp.ApplicationController.inAppBrowser_var.close()}catch(b){}},
backButtonTimeoutVar:null,backbuttonhandler:function(){var a=DigiWebApp.SettingsController.featureAvailable("409");if(!DigiWebApp.SettingsController.showCredentialsAlert)if(DigiWebApp.TabBar.tabItem1.isActive||a&&M.ViewManager.getCurrentPage().get("id")===DigiWebApp.DashboardPage.get("id"))typeof navigator.app!=="undefined"&&DigiWebApp.ApplicationController.nativeConfirmDialogView({title:M.I18N.l("quitQuestion"),message:M.I18N.l("quitQuestionMsg"),confirmButtonValue:M.I18N.l("yes"),cancelButtonValue:M.I18N.l("no"),
callbacks:{confirm:{target:this,action:function(){navigator.app.exitApp()}},cancel:{target:this,action:function(){}}}});else DigiWebApp.ApplicationController.backButtonToBookTimePage()},registerButtonHandlerByTimeoutVar:null,registerButtonHandlerByTimeout:function(){if(M.Environment.getPlatform().substr(0,10)==="BlackBerry"&&DigiWebApp.ApplicationController.timeouthappened!==true){console.log("registering buttonhandler again on blackberry");$(document).bind("backbutton",DigiWebApp.ApplicationController.backbuttonhandler);
$(document).bind("menubutton",DigiWebApp.ApplicationController.menubuttonhandler)}clearTimeout(DigiWebApp.ApplicationController.registerButtonHandlerByTimeoutVar)},backButtonToBookTimePage:function(){clearTimeout(DigiWebApp.ApplicationController.backButtonTimeoutVar);if(DigiWebApp.SettingsController.featureAvailable("409"))DigiWebApp.SettingsController.featureAvailable("404")?DigiWebApp.NavigationController.toButtonDashboardPageFlipTransition():DigiWebApp.NavigationController.toDashboardPageFlipTransition();
else DigiWebApp.NavigationController.toBookTimePageFlipTransition()},menubuttonhandler:function(){DigiWebApp.SettingsController.showCredentialsAlert||(DigiWebApp.SettingsController.featureAvailable("404")?DigiWebApp.NavigationController.backToButtonDashboardPageFlipTransition():DigiWebApp.NavigationController.backToDashboardPageFlipTransition())},showConfirmDialog:function(){var a=this;DigiWebApp.ApplicationController.nativeConfirmDialogView({title:M.I18N.l("secretQuestion"),message:M.I18N.l("secretQuestionMsg"),
confirmButtonValue:M.I18N.l("yes"),cancelButtonValue:M.I18N.l("no"),callbacks:{confirm:{target:this,action:function(){var b=function(c,d,f,e){writeToLog("DIGI-WebApp wird zur\u00fcckgesetzt");DigiWebApp.SettingsController.credentialsAlertShown=false;DigiWebApp.ApplicationController.deleteAllData();DigiWebApp.BookingController.currentBooking=null;typeof DigiWebAppOrdinaryDesign.bookingPageWithIconsScholpp!=="undefined"?$("#"+DigiWebApp.BookingPageWithIconsScholpp.content.currentBookingLabel.id).html(""):
$("#"+DigiWebApp.BookingPage.content.currentBookingLabel.id).html("");DigiWebApp.SettingsController.showIOSMessage=false;if(c!==null&&d!==null&&f!==null&&e!==null){writeToLog("Zugangsdaten blieben erhalten");DigiWebApp.SettingsController.init(YES);DigiWebApp.SettingsController.setSetting("company",c);DigiWebApp.SettingsController.setSetting("password",d);DigiWebApp.SettingsController.setSetting("connectionCode",f);DigiWebApp.SettingsController.setSetting("workerId",e)}DigiWebApp.ApplicationController.init(true)};
DigiWebApp.ApplicationController.nativeConfirmDialogView({title:M.I18N.l("keepCredentials"),message:M.I18N.l("keepCredentialsMsg"),confirmButtonValue:M.I18N.l("yes"),cancelButtonValue:M.I18N.l("no"),callbacks:{confirm:{target:this,action:function(){var c=DigiWebApp.SettingsController.getSetting("company"),d=DigiWebApp.SettingsController.getSetting("password"),f=DigiWebApp.SettingsController.getSetting("connectionCode"),e=DigiWebApp.SettingsController.getSetting("workerId");b(c,d,f,e)}},cancel:{target:this,
action:function(){b(null,null,null,null)}}}})}},cancel:{target:this,action:function(){a.clickCounter=0}}}})},setTransitionsSetting:function(){var a="0";if(typeof device!=="undefined")a=new String(device.version);var b="";if(typeof device!=="undefined")b=new String(device.platform);var c=M.Environment.getPlatform();M.Application.config.useTransitions=c.substr(-2)==="86"||c.substr(-5)==="Win32"||c.substr(-5)==="Win64"||c.substr(0,3)==="Mac"||c.substr(0,6)==="iPhone"||c.substr(0,4)==="iPad"||a.substr(0,
1)>=4&&b.substr(0,7)>="Android"?DigiWebApp.SettingsController.getSetting("useTransitionsSetting")&&!DigiWebApp.SettingsController.featureAvailable("404"):NO},init:function(){DigiWebApp.TabBar.tabItem1.internalEvents.tap.action=function(){this.page?M.Controller.switchToTab(this,YES):this.parentView.setActiveTab(this)};DigiWebApp.TabBar.tabItem2.internalEvents.tap.action=function(){this.page?M.Controller.switchToTab(this,NO):this.parentView.setActiveTab(this)};DigiWebApp.ApplicationController.callbackStatus=
{position:{remote:NO,local:NO},activity:{remote:NO,local:NO},order:{remote:NO,local:NO},workPlan:{remote:NO,local:NO},handOrder:{remote:NO,local:NO},kolonne:{remote:NO,local:NO},features:{remote:NO,local:NO}};DigiWebApp.SettingsController.init(YES,YES);DigiWebApp.SettingsController.globalDebugMode=DigiWebApp.SettingsController.getSetting("debug")?YES:NO;DigiWebApp.ApplicationController.setTransitionsSetting();var a=function(){var d=DigiWebApp.Booking.find();if(d.length>0){for(var f=NO,e=0;e<d.length;e++)if(d[e].get("isCurrent")===
YES){f=YES;break}if(f===YES)DigiWebApp.NavigationController.toBookTimePage();else{DigiWebApp.NavigationController.toBookTimePage();DigiWebApp.BookingController.sendBookings(NO,YES)}}else{DigiWebApp.NavigationController.toBookTimePage();DigiWebApp.ApplicationController.startsync()}},b=DigiWebApp.SettingsController.getSetting("company"),c=DigiWebApp.SettingsController.getSetting("password");if(!b||!c){DigiWebApp.NavigationController.toBookTimePage(YES);DigiWebApp.SettingsController.showCredentialsAlert=
YES;DigiWebApp.NavigationController.toSettingsPage(YES)}else DigiWebApp.ApplicationController.updateModels(a)},enforceChefToolOnly:function(){var a=DigiWebApp.SettingsController.showCredentialsAlert,b=DigiWebApp.SettingsController.featureAvailable("409");if(DigiWebApp.SettingsController.featureAvailable("417")){try{$("[id="+DigiWebApp.SettingsPage.content.ServiceApp_ermittleGeokoordinate.id+"]").each(function(){$(this).show()})}catch(c){}try{$("[id="+DigiWebApp.SettingsPage.content.ServiceApp_datenUebertragen.id+
"]").each(function(){$(this).show()})}catch(d){}try{$("[id="+DigiWebApp.SettingsPage.content.ServiceApp_engeKopplung.id+"]").each(function(){$(this).show()})}catch(f){}try{$("[id="+DigiWebApp.SettingsPage.content.ServiceApp_PORTGrid.id+"]").each(function(){$(this).show()})}catch(e){}try{$("[id="+DigiWebApp.SettingsPage.content.ServiceApp_FallBack.id+"]").each(function(){$(this).show()})}catch(g){}}else{try{$("[id="+DigiWebApp.SettingsPage.content.ServiceApp_ermittleGeokoordinate.id+"]").each(function(){$(this).hide()})}catch(h){}try{$("[id="+
DigiWebApp.SettingsPage.content.ServiceApp_datenUebertragen.id+"]").each(function(){$(this).hide()})}catch(i){}try{$("[id="+DigiWebApp.SettingsPage.content.ServiceApp_engeKopplung.id+"]").each(function(){$(this).hide()})}catch(j){}try{$("[id="+DigiWebApp.SettingsPage.content.ServiceApp_PORTGrid.id+"]").each(function(){$(this).hide()})}catch(l){}try{$("[id="+DigiWebApp.SettingsPage.content.ServiceApp_FallBack.id+"]").each(function(){$(this).hide()})}catch(m){}}if(b||a){try{$("[id="+DigiWebApp.TabBar.id+
"]").each(function(){$(this).hide()})}catch(n){}try{$("[id="+DigiWebApp.SettingsPage.content.autoTransferAfterBookTimeCheck.id+"]").each(function(){$(this).hide()})}catch(o){}try{$("[id="+DigiWebApp.SettingsPage.content.autoTransferAfterClosingDayCheck.id+"]").each(function(){$(this).hide()})}catch(p){}try{$("[id="+DigiWebApp.SettingsPage.content.autoSyncAfterBookTimeCheck.id+"]").each(function(){$(this).hide()})}catch(q){}try{$("[id="+DigiWebApp.SettingsPage.content.remarkIsMandatory.id+"]").each(function(){$(this).hide()})}catch(r){}try{$("[id="+
DigiWebApp.SettingsPage.content.autoSaveGPSData.id+"]").each(function(){$(this).hide()})}catch(s){}try{$("[id="+DigiWebApp.SettingsPage.content.daysToHoldBookingsOnDeviceSliderContainer.id+"]").each(function(){$(this).hide()})}catch(t){}try{$("[id="+DigiWebApp.SettingsPage.content.auftragsDetailsKoppeln.id+"]").each(function(){$(this).hide()})}catch(u){}try{$("[id="+DigiWebApp.SettingsPage.content.detailierteZeitdaten.id+"]").each(function(){$(this).hide()})}catch(v){}try{$("[id="+DigiWebApp.SettingsPage.content.vibrationsDauerSliderContainer.id+
"]").each(function(){$(this).hide()})}catch(w){}}else{try{$("[id="+DigiWebApp.TabBar.id+"]").each(function(){$(this).show()})}catch(x){}try{$("[id="+DigiWebApp.SettingsPage.content.detailierteZeitdaten.id+"]").each(function(){$(this).show()})}catch(y){}try{$("[id="+DigiWebApp.SettingsPage.content.autoTransferAfterBookTimeCheck.id+"]").each(function(){$(this).show()})}catch(B){}try{$("[id="+DigiWebApp.SettingsPage.content.autoTransferAfterClosingDayCheck.id+"]").each(function(){$(this).show()})}catch(C){}try{$("[id="+
DigiWebApp.SettingsPage.content.autoSyncAfterBookTimeCheck.id+"]").each(function(){$(this).show()})}catch(D){}if(DigiWebApp.SettingsController.featureAvailable("403"))try{$("[id="+DigiWebApp.SettingsPage.content.remarkIsMandatory.id+"]").each(function(){$(this).show()})}catch(E){}try{$("[id="+DigiWebApp.SettingsPage.content.autoSaveGPSData.id+"]").each(function(){$(this).show()})}catch(F){}if(DigiWebApp.SettingsController.featureAvailable("411"))try{$("[id="+DigiWebApp.SettingsPage.content.daysToHoldBookingsOnDeviceSliderContainer.id+
"]").each(function(){$(this).show()})}catch(G){}if(DigiWebApp.SettingsController.featureAvailable("406"))try{$("[id="+DigiWebApp.SettingsPage.content.auftragsDetailsKoppeln.id+"]").each(function(){$(this).show()})}catch(z){}try{$("[id="+DigiWebApp.SettingsPage.content.vibrationsDauerSliderContainer.id+"]").each(function(){$(this).show()})}catch(A){}}},startsync:function(){DigiWebApp.ApplicationController.syncStartTimestamp=D8.now().getTimestamp();var a=DigiWebApp.SettingsController.getSetting("company"),
b=DigiWebApp.SettingsController.getSetting("password");if(!a||!b){DigiWebApp.NavigationController.toBookTimePage(YES);DigiWebApp.SettingsController.showCredentialsAlert=YES;DigiWebApp.NavigationController.toSettingsPage(YES)}else{M.Application.config.useTransitions=NO;DigiWebApp.ApplicationController.syncRunning=YES;DigiWebApp.SettingsController.sendConfiguration()}},connectionError:function(){DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("connectionError"),message:M.I18N.l("connectionErrorMsg"),
callbacks:{confirm:{target:this,action:"proceedWithLocalData"}}})},proceedWithLocalData:function(a){var b=DigiWebApp.ApplicationController;b.enforceChefToolOnly();if(DigiWebApp.SettingsController.featureAvailable("409"))DigiWebApp.SettingsController.featureAvailable("404")?DigiWebApp.NavigationController.toButtonDashboardPage():DigiWebApp.NavigationController.toDashboardPage();else{DigiWebApp.Order.findSorted().length>0&&b.setCallbackStatus("order","local",YES);DigiWebApp.Position.findSorted().length>
0&&b.setCallbackStatus("position","local",YES);DigiWebApp.Activity.findSorted().length>0&&b.setCallbackStatus("activity","local",YES);DigiWebApp.Features.find().length>0&&b.setCallbackStatus("features","local",YES);DigiWebApp.SettingsController.globalDebugMode&&DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("offlineWork"),message:a});if(b.isReadyToProceed()){DigiWebApp.NavigationController.toBookTimePage(YES);DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("offlineWork"),
message:M.I18N.l("offlineWorkMsg")})}else{DigiWebApp.SettingsController.featureAvailable("404")?DigiWebApp.NavigationController.toButtonDashboardPage():DigiWebApp.NavigationController.toDashboardPage();DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("offlineWorkNotPossible"),message:M.I18N.l("offlineWorkNotPossibleMsg")})}}},authenticate:function(){DigiWebApp.RequestController.authenticate({success:{target:this,action:"authenticateSuccess"},error:{target:this,action:function(){console.error("authenticate-error");
this.proceedWithLocalData("authenticate")}}})},timestampMitarbeiterZuletztGeladen:null,authenticateSuccess:function(a){if(typeof a["return"]==="undefined"&&typeof a["ns:return"]!=="undefined")a["return"]=a["ns:return"];switch(a["return"]){case "1":DigiWebApp.ApplicationController.activeFeaturesBeforeTransfer=[];_.each(DigiWebApp.Features.find(),function(b){b.get("isAvailable")==="true"&&DigiWebApp.ApplicationController.activeFeaturesBeforeTransfer.push(b.get("id"))});DigiWebApp.Features.deleteAll();
this.setCallbackStatus("features","local",NO);DigiWebApp.ApplicationController.triggerUpdate=YES;DigiWebApp.DashboardController.init(YES);DigiWebApp.MediaListController.init(YES);a=D8.now().getTimestamp();if(DigiWebApp.ApplicationController.timestampMitarbeiterZuletztGeladen===null||a-DigiWebApp.ApplicationController.timestampMitarbeiterZuletztGeladen>6E4){writeToLog("aktualisiere Mitarbeiter des Benutzers nach authenticate");DigiWebApp.JSONDatenuebertragungController.recieveData("mitarbeiter",M.I18N.l("BautagebuchLadeMitarbeiter"),
function(b){if(b&&b.mitarbeiter&&b.mitarbeiter.length>0){DigiWebApp.SettingsController.setSetting("mitarbeiterVorname",b.mitarbeiter[0].vorname);DigiWebApp.SettingsController.setSetting("mitarbeiterNachname",b.mitarbeiter[0].nachname);DigiWebApp.SettingsController.setSetting("mitarbeiterId",b.mitarbeiter[0].mitarbeiterId)}DigiWebApp.ApplicationController.timestampMitarbeiterZuletztGeladen=D8.now().getTimestamp();DigiWebApp.ApplicationController.getFeaturesFromRemote()},function(){DigiWebApp.ApplicationController.DigiLoaderView.hide();
DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("offlineWorkNotPossible"),message:M.I18N.l("offlineWorkNotPossibleMsg")})},"getAll=true&webAppId="+DigiWebApp.SettingsController.getSetting("workerId"),true)}else DigiWebApp.ApplicationController.getFeaturesFromRemote();DigiWebApp.ApplicationController.enforceChefToolOnly();break;case "2":DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("authenticationError2"),message:M.I18N.l("authenticationErrorMsg2")});
DigiWebApp.NavigationController.toSettingsPage(YES);break;case "3":DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("authenticationError3"),message:M.I18N.l("authenticationErrorMsg3")});DigiWebApp.NavigationController.toSettingsPage(YES);break;default:DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("authenticationError"),message:M.I18N.l("authenticationErrorMsg")});DigiWebApp.NavigationController.toSettingsPage(YES)}},getOrdersFromRemote:function(){DigiWebApp.RequestController.getOrders({success:{target:this,
action:function(a,b,c){this.getOrdersFromRemoteSuccess(a,b,c)===true?this.getPositionsFromRemote():DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("noOrdersAvailable"),message:M.I18N.l("noOrdersAvailableMsg")})}},error:{target:this,action:function(){console.error("getOrdersFromRemote-error");this.proceedWithLocalData("getOrdersFromRemote")}}})},getOrdersFromRemoteSuccess:function(a){if(typeof a["return"]==="undefined"&&typeof a["ns:return"]!=="undefined"){a["return"]=a["ns:return"];
try{var b=this.myns=a["return"][0]["xsi:type"].split(":")[0];_.each(a["return"],function(e){e.auftragsId=e[b+":auftragsId"];e.auftragsBezeichnung=e[b+":auftragsBezeichnung"]})}catch(c){}}if(a["return"]){this.setCallbackStatus("order","remote",YES);DigiWebApp.Order.deleteAll();this.setCallbackStatus("order","local",NO);var d=[],f=null;if(_.isObject(a["return"])&&!_.isArray(a["return"]))a["return"]=[a["return"]];_.each(a["return"],function(e){f=DigiWebApp.Order.createRecord({id:e.auftragsId,name:e.auftragsBezeichnung});
try{f.save();d.push(f.m_id)}catch(g){console.error("ERROR in getOrdersFromRemoteSuccess: "+g)}});localStorage.setItem(this.storagePrefix+"_orderKeys",JSON.stringify(d));this.setCallbackStatus("order","local",YES);return true}else return false},getPositionsFromRemote:function(){DigiWebApp.RequestController.getPositions({success:{target:this,action:function(a,b,c){this.getPositionsFromRemoteSuccess(a,b,c);this.getActivitiesFromRemote()}},error:{target:this,action:function(){console.error("getPositionsFromRemote-error");
this.proceedWithLocalData("getPositionsFromRemote")}}})},getPositionsFromRemoteSuccess:function(a){if(typeof a["return"]==="undefined"&&typeof a["ns:return"]!=="undefined"){a["return"]=a["ns:return"];try{var b=this.myns;_.each(a["return"],function(e){e.positionsId=e[b+":positionsId"];e.positionsBezeichnung=e[b+":positionsBezeichnung"];e.auftragsId=e[b+":auftragsId"];e.positionHausnummer=e[b+":positionHausnummer"];e.positionPlz=e[b+":positionPlz"];e.positionOrt=e[b+":positionOrt"];e.positionLand=e[b+
":positionZusatz"];e.positionLongitude=e[b+":positionLongitude"];e.positionLatitude=e[b+":positionLatitude"];e.positionBeschreibung=e[b+":positionBeschreibung"];e.positionTelefon=e[b+":positionTelefon"]})}catch(c){}}if(a["return"]){this.setCallbackStatus("position","remote",YES);DigiWebApp.Position.deleteAll();this.setCallbackStatus("position","local",NO);var d=[],f=null;if(_.isObject(a["return"])&&!_.isArray(a["return"]))a["return"]=[a["return"]];_.each(a["return"],function(e){var g=e.positionsId,
h=e.positionsBezeichnung,i=e.positionStrasse,j=e.positionHausnummer,l=e.positionPlz,m=e.positionOrt,n=e.positionZusatz,o=e.positionLand,p=e.positionTelefon,q=e.positionFax,r=e.positionEmail,s=e.positionAnsprechpartner,t=e.positionKundenname,u=e.positionLongitude,v=e.positionLatitude,w=e.positionBeschreibung;e=e.auftragsId;if(typeof g==="object")g="";if(typeof h==="object")h="";if(typeof i==="object")i="";if(typeof j==="object")j="";if(typeof l==="object")l="";if(typeof m==="object")m="";if(typeof n===
"object")n="";if(typeof o==="object")o="";if(typeof p==="object")p="";if(typeof q==="object")q="";if(typeof r==="object")r="";if(typeof s==="object")s="";if(typeof t==="object")t="";if(typeof u==="object")u="";if(typeof v==="object")v="";if(typeof w==="object")w="";if(typeof e==="object")e="";f=DigiWebApp.Position.createRecord({id:g,name:h,strasse:i,hausnummer:j,plz:l,ort:m,land:n,countrycode:o,telefon:p,fax:q,email:r,ansprechpartner:s,kundenname:t,longitude:u,latitude:v,description:w,orderId:e});
try{f.save();d.push(f.m_id)}catch(x){console.error("ERROR in getPositionsFromRemoteSuccess: "+x)}});localStorage.setItem(this.storagePrefix+"_positionKeys",JSON.stringify(d));this.setCallbackStatus("position","local",YES)}},getActivitiesFromRemote:function(){var a=this;a.setCallbackStatus("activity","local",NO);DigiWebApp.JSONDatenuebertragungController.empfangeTaetigkeiten(function(){a.setCallbackStatus("activity","remote",YES);a.setCallbackStatus("activity","local",DigiWebApp.Activity.find().length>
0);a.getWorkPlansFromRemote()},function(){a.setCallbackStatus("activity","remote",NO);a.proceedWithLocalData("getActivitiesFromRemote")})},getWorkPlansFromRemote:function(){var a=DigiWebApp.ApplicationController;DigiWebApp.RequestController.getWorkPlans({success:{target:a,action:function(b,c,d){a.getWorkPlansFromRemoteSuccess(b,c,d);a.getHandOrdersFromRemote()}},error:{target:a,action:function(){console.error("getWorkPlansFromRemote-error");a.proceedWithLocalData("getWorkPlansFromRemote")}}})},getWorkPlansFromRemoteSuccess:function(a){if(typeof a["return"]===
"undefined"&&typeof a["ns:return"]!=="undefined"){a["return"]=a["ns:return"];try{var b=this.myns;_.each(a["return"],function(d){d.arbeitsplanId=d[b+":arbeitsplanId"];d.positionen=d[b+":positionen"];d.taetigkeitsIds=d[b+":taetigkeitsIds"];d.arbeitsplanTyp=d[b+":arbeitsplanTyp"]})}catch(c){}}if(a["return"]){this.setCallbackStatus("workPlan","remote",YES);DigiWebApp.WorkPlan.deleteAll();this.setCallbackStatus("workPlan","local",NO);_.each(a["return"],function(d){DigiWebApp.WorkPlan.createRecord({id:d.arbeitsplanId,
workplanType:d.arbeitsplanTyp,activityPositions:d.positionen.join(","),activityIds:d.taetigkeitsIds.join(",")}).save()});this.setCallbackStatus("workPlan","local",YES)}},getHandOrdersFromRemote:function(){DigiWebApp.RequestController.getHandOrders({success:{target:this,action:function(a,b,c){this.getHandOrdersFromRemoteSuccess(a,b,c);this.getKolonneFromRemote()}},error:{target:this,action:function(){console.error("getHandOrdersFromRemote-error");this.proceedWithLocalData("getHandOrdersFromRemote")}}})},
getHandOrdersFromRemoteSuccess:function(a){if(typeof a["return"]==="undefined"&&typeof a["ns:return"]!=="undefined"){a["return"]=a["ns:return"];try{var b=this.myns;_.each(a["return"],function(e){e.handauftragsId=e[b+":handauftragsId"];e.handauftragsBezeichnung=e[b+":handauftragsBezeichnung"]})}catch(c){}}if(a["return"]){this.setCallbackStatus("handOrder","remote",YES);DigiWebApp.HandOrder.deleteAll();this.setCallbackStatus("handOrder","local",NO);if(typeof a["return"]==="object"&&!_.isArray(a["return"]))a["return"]=
[a["return"]];var d=[],f=null;if(_.isObject(a["return"])&&!_.isArray(a["return"]))a["return"]=[a["return"]];_.each(a["return"],function(e){if(DigiWebApp.HandOrder.find({query:{identifier:"id",operator:"=",value:e.handauftragsId}}).length===0&&DigiWebApp.HandOrder.find({query:{identifier:"name",operator:"=",value:e.handauftragsBezeichnung}}).length===0)f=DigiWebApp.HandOrder.createRecord({id:e.handauftragsId,name:e.handauftragsBezeichnung,isLocalOnly:NO});else if(DigiWebApp.HandOrder.find({query:{identifier:"id",
operator:"=",value:e.handauftragsId}}).length!==0){f=DigiWebApp.HandOrder.find({query:{identifier:"id",operator:"=",value:e.handauftragsId}})[0];f.set("id",e.handauftragsId);f.set("name",e.handauftragsBezeichnung);f.set("isLocalOnly",NO)}else if(DigiWebApp.HandOrder.find({query:{identifier:"name",operator:"=",value:e.handauftragsBezeichnung}}).length!==0){f=DigiWebApp.HandOrder.find({query:{identifier:"name",operator:"=",value:e.handauftragsBezeichnung}})[0];f.set("id",e.handauftragsId);f.set("name",
e.handauftragsBezeichnung);f.set("isLocalOnly",NO)}try{f.save();d.push(f.m_id);_.each(DigiWebApp.Booking.find(),function(h){if(h.get("handOrderId")!==null&&h.get("handOrderId")===e.handauftragsBezeichnung){h.set("handOrderId",e.handauftragsId);h.save()}})}catch(g){console.error("ERROR in getHandOrdersFromRemoteSuccess: "+g)}});a=_.select(DigiWebApp.HandOrder.findSorted(),function(e){if(e)return e.get("isLocalOnly")===YES});_.each(a,function(e){d.push(e.m_id)});localStorage.setItem(this.storagePrefix+
"_handorderKeys",JSON.stringify(d));this.setCallbackStatus("handOrder","local",YES)}else{this.setCallbackStatus("handOrder","remote",NO);DigiWebApp.HandOrder.deleteAll();this.setCallbackStatus("handOrder","local",NO)}},getFeaturesFromRemote:function(){DigiWebApp.RequestController.getFeatures({success:{target:this,action:function(a,b,c){this.getFeaturesFromRemoteSuccess(a,b,c);DigiWebApp.SettingsController.featureAvailable("409")?this.endSession():this.getOrdersFromRemote()}},error:{target:this,action:function(){console.error("getFeaturesFromRemote-error");
this.getOrdersFromRemote()}}})},getFeaturesFromRemoteSuccess:function(a){if(a)if(typeof a["return"]==="undefined"&&typeof a["ns:return"]!=="undefined"){a["return"]=a["ns:return"];try{var b=this.myns;_.each(a["return"],function(f){f.keyId=f[b+":keyId"];f.value=f[b+":value"]})}catch(c){}}if(a&&a["return"]){this.setCallbackStatus("features","remote",YES);if(_.isObject(a["return"])&&!_.isArray(a["return"]))a["return"]=[a["return"]];DigiWebApp.SettingsController.setSetting("treatAllAsTablet",DigiWebApp.SettingsController.defaultsettings.get("treatAllAsTablet"));
DigiWebApp.SettingsController.setSetting("treatAllAsPhone",DigiWebApp.SettingsController.defaultsettings.get("treatAllAsPhone"));DigiWebApp.SettingsController.setSetting("settingsPassword",DigiWebApp.SettingsController.defaultsettings.get("settingsPassword"));var d=DigiWebApp.SettingsController.getSetting("branding");DigiWebApp.SettingsController.setSetting("branding",DigiWebApp.SettingsController.defaultsettings.get("branding"));DigiWebApp.SettingsController.setSetting("silentLoader",DigiWebApp.SettingsController.defaultsettings.get("silentLoader"));
DigiWebApp.SettingsController.setSetting("mapType",DigiWebApp.SettingsController.defaultsettings.get("mapType"));DigiWebApp.SettingsController.setSetting("datatransfer_min_delay",DigiWebApp.SettingsController.defaultsettings.get("datatransfer_min_delay"));DigiWebApp.SettingsController.setSetting("GPSTimeOut",DigiWebApp.SettingsController.defaultsettings.get("GPSTimeOut"));DigiWebApp.SettingsController.setSetting("debugDatabaseServer",DigiWebApp.SettingsController.defaultsettings.get("debugDatabaseServer"));
DigiWebApp.ApplicationController.triggerUpdate=NO;_.each(a["return"],function(f){var e="";if(typeof f.valueType==="undefined")e=DigiWebApp.ApplicationController.myns+":";if(f[e+"valueType"]==="Setting_WebApp"){var g=f[e+"value"];if(g==="false"||g==="true")g=g==="true";DigiWebApp.SettingsController.setSetting(f[e+"keyId"],g)}else if(f[e+"valueType"]==="Feature"){DigiWebApp.Features.createRecord({id:f[e+"keyId"],name:f[e+"keyId"],isAvailable:f[e+"value"]}).save();var h=NO;_.each(DigiWebApp.ApplicationController.activeFeaturesBeforeTransfer,
function(i){if(f[e+"keyId"]===i)h=YES});if(f[e+"value"]==="true"&&!h||f[e+"value"]==="false"&&h){if(f[e+"keyId"]==="400")DigiWebApp.ApplicationController.restartApp=YES;if(f[e+"keyId"]==="401")DigiWebApp.ApplicationController.restartApp=YES;if(f[e+"keyId"]==="403")DigiWebApp.ApplicationController.restartApp=YES;if(f[e+"keyId"]==="404")DigiWebApp.ApplicationController.restartApp=YES;if(f[e+"keyId"]==="405")DigiWebApp.ApplicationController.restartApp=YES;if(f[e+"keyId"]==="406")DigiWebApp.ApplicationController.restartApp=
YES;if(f[e+"keyId"]==="408")DigiWebApp.ApplicationController.restartApp=YES;if(f[e+"keyId"]==="409")DigiWebApp.ApplicationController.restartApp=YES;if(f[e+"keyId"]==="410")DigiWebApp.ApplicationController.restartApp=YES;if(f[e+"keyId"]==="411")DigiWebApp.ApplicationController.restartApp=YES;if(f[e+"keyId"]==="412")DigiWebApp.ApplicationController.restartApp=YES;if(f[e+"keyId"]==="413")DigiWebApp.ApplicationController.restartApp=YES;if(f[e+"keyId"]==="414")DigiWebApp.ApplicationController.restartApp=
YES;if(f[e+"keyId"]==="416")DigiWebApp.ApplicationController.restartApp=YES;if(f[e+"keyId"]==="417")DigiWebApp.ApplicationController.restartApp=YES;if(f[e+"keyId"]==="418")DigiWebApp.ApplicationController.restartApp=YES;if(f[e+"keyId"]==="419")DigiWebApp.ApplicationController.restartApp=YES;if(f[e+"keyId"]==="422")DigiWebApp.ApplicationController.restartApp=YES}if(f[e+"keyId"]==="branding"&&f[e+"value"]!==d)DigiWebApp.ApplicationController.restartApp=YES}DigiWebApp.ApplicationController.triggerUpdate=
YES});DigiWebApp.SettingsController.getSetting("remarkIsOptional")&&DigiWebApp.SettingsController.setSetting("remarkIsMandatory",false);if(DigiWebApp.ApplicationController.triggerUpdate){DigiWebApp.DashboardPage.needsUpdate=true;DigiWebApp.MediaListPage.needsUpdate=true;DigiWebApp.DashboardController.init(YES);DigiWebApp.MediaListController.init(YES)}DigiWebApp.ApplicationController.triggerUpdate=NO}else{this.setCallbackStatus("features","remote",YES);DigiWebApp.Features.deleteAll();this.setCallbackStatus("features",
"local",NO)}this.setCallbackStatus("features","local",YES);DigiWebApp.SettingsController.globalDebugMode=DigiWebApp.SettingsController.getSetting("debug")?YES:NO;if(DigiWebApp.SettingsController.featureAvailable("409")&&DigiWebApp.ApplicationController.profilingIntervalVar===null){DigiWebApp.SettingsController.featureAvailable("404")?DigiWebApp.NavigationController.toButtonDashboardPage(YES):DigiWebApp.NavigationController.toDashboardPage(YES);DigiWebApp.ApplicationController.restartApp===YES&&DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("newFeatureActive"),
message:M.I18N.l("newFeatureActiveMsg"),callbacks:{confirm:{action:function(){if(typeof navigator.app!=="undefined")typeof location.origin!=="undefined"?navigator.app.loadUrl(location.origin+location.pathname):navigator.app.loadUrl(location.protocol+"//"+location.pathname);else window.location.reload()}}}})}},getKolonneFromRemote:function(){DigiWebApp.RequestController.getKolonne({success:{target:this,action:function(a,b,c){this.getKolonneFromRemoteSuccess(a,b,c)}},error:{target:this,action:function(){console.error("getKolonneFromRemote-error");
this.proceedWithLocalData("getKolonneFromRemote")}}})},getKolonneFromRemoteSuccess:function(a){if(a)if(typeof a["return"]==="undefined")a["return"]=a["ns:return"];var b=[],c=null;if(a&&a["return"]){this.setCallbackStatus("kolonne","remote",YES);DigiWebApp.Employee.deleteAll();this.setCallbackStatus("kolonne","local",NO);if(_.isObject(a["return"])&&!_.isArray(a["return"]))a["return"]=[a["return"]];_.each(a["return"],function(d){c=DigiWebApp.Employee.createRecord({id:d.id,name:d.name,kolonnenId:d.kolonnenId,
isSelected:NO});try{c.save();b.push(c.m_id)}catch(f){console.error("ERROR in getKolonneFromRemoteSuccess: "+f)}});localStorage.setItem(this.storagePrefix+"_employeeKeys",JSON.stringify(b));this.setCallbackStatus("kolonne","local",YES);localStorage.getItem(DigiWebApp.EmployeeController.empSelectionKey)==0&&localStorage.removeItem(DigiWebApp.EmployeeController.empSelectionKey);DigiWebApp.EmployeeController.getEmployeeState()!=2&&DigiWebApp.EmployeeController.setEmployeeState(1)}else{this.setCallbackStatus("kolonne",
"remote",YES);DigiWebApp.Employee.deleteAll();this.setCallbackStatus("kolonne","local",NO);c=DigiWebApp.Employee.createRecord({id:"0",name:"Standardmitarbeiter",kolonnenId:"",isSelected:YES}).save();b.push(c.m_id);localStorage.setItem(this.storagePrefix+"_employeeKeys",JSON.stringify(b));this.setCallbackStatus("kolonne","local",YES);DigiWebApp.EmployeeController.setEmployeeState(0)}this.endSession();DigiWebApp.SettingsController.featureAvailable("412")?DigiWebApp.BautagebuchDatenuebertragungController.empfangen(function(){DigiWebApp.ApplicationController.afterTransfer()},
function(){DigiWebApp.ApplicationController.afterTransfer()}):this.afterTransfer()},afterTransfer:function(){this.syncStopTimestamp=D8.now().getTimestamp();this.syncLastDuration=this.syncStopTimestamp-this.syncStartTimestamp;this.profilingIntervalVar!==null&&console.log("DIGI-WebApp-Profiling "+D8.now().format("yyyymmdd-HHMMss")+" "+this.syncLastDuration+"ms");this.profilingShowAlert&&alert("DIGI-WebApp-Profiling: "+M.I18N.l("profilingTook")+" "+this.syncLastDuration+"ms");DigiWebApp.ApplicationController.syncRunning=
NO;if(this.isReadyToProceed()){if(DigiWebApp.ApplicationController.profilingIntervalVar===null){if(DigiWebApp.SettingsController.featureAvailable("409"))DigiWebApp.SettingsController.featureAvailable("404")?DigiWebApp.NavigationController.toButtonDashboardPage(YES):DigiWebApp.NavigationController.toDashboardPage(YES);else{DigiWebApp.NavigationController.toBookTimePage(YES);DigiWebApp.BookingController.init()}DigiWebApp.ApplicationController.restartApp===YES&&DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("newFeatureActive"),
message:M.I18N.l("newFeatureActiveMsg"),callbacks:{confirm:{action:function(){if(typeof navigator.app!=="undefined")typeof location.origin!=="undefined"?navigator.app.loadUrl(location.origin+location.pathname):navigator.app.loadUrl(location.protocol+"//"+location.pathname);else window.location.reload()}}}})}DigiWebApp.ApplicationController.setTransitionsSetting()}else{DigiWebApp.ApplicationController.setTransitionsSetting();DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("offlineWorkNotPossible"),
message:M.I18N.l("offlineWorkNotPossibleMsg")})}if(this.profilingSingleRun)this.profilingIntervalVar=null},endSession:function(){DigiWebApp.ApplicationController.enforceChefToolOnly();DigiWebApp.RequestController.endSession({success:{target:this,action:function(){}},error:{target:this,action:function(){console.error("endSession-error")}}})},setCallbackStatus:function(a,b,c){this.callbackStatus[a][b]=c},isReadyToProceed:function(){var a=this.callbackStatus.position,b=this.callbackStatus.activity,c=
this.callbackStatus.order;return(a.remote||a.local)&&(b.remote||b.local)&&(c.remote||c.local)},profilingIntervalVar:null,profilingSingleRun:NO,profilingShowAlert:NO,startProfiling:function(a){if(DigiWebApp.ApplicationController.profilingIntervalVar===null)if(typeof a==="undefined")DigiWebApp.ApplicationController.profilingIntervalVar=null;else if(a!==0)if(a>1E4){DigiWebApp.ApplicationController.profilingSingleRun=NO;DigiWebApp.ApplicationController.profilingIntervalVar=setInterval(function(){DigiWebApp.ApplicationController.startsync()},
a)}else console.error("Profiling-Interval too low!");else{DigiWebApp.ApplicationController.profilingSingleRun=YES;DigiWebApp.ApplicationController.profilingIntervalVar=setTimeout(function(){clearTimeout(DigiWebApp.ApplicationController.profilingIntervalVar);DigiWebApp.ApplicationController.startsync()},10)}else console.error("Profiling already running!")},stopProfiling:function(){clearInterval(DigiWebApp.ApplicationController.profilingIntervalVar);DigiWebApp.ApplicationController.profilingIntervalVar=
null},deleteAllData:function(){try{DigiWebApp.Booking.deleteAll()}catch(a){console.error(a)}try{DigiWebApp.MediaFile.deleteAll()}catch(b){console.error(b)}try{localStorage.clear("f")}catch(c){console.error(c)}},updateModels:function(a){var b=function(){var c=DigiWebApp.Booking.find(),d=D8.create("11/01/"+(new Date).getFullYear()+" 02:00:00").addDays(-D8.create("11/01/"+(new Date).getFullYear()+" 02:00:00").date.getDay()),f=D8.create("04/01/"+(new Date).getFullYear()+" 02:00:00").addDays(-D8.create("04/01/"+
(new Date).getFullYear()+" 02:00:00").date.getDay()),e=new D8;f.timeBetween(e)>=0&&d.timeBetween(e);if(typeof DigiWebApp.SettingsController.getSetting("currentTimezone")==="undefined"||DigiWebApp.SettingsController.getSetting("currentTimezone")===""||typeof DigiWebApp.SettingsController.getSetting("currentTimezoneOffset")==="undefined"||DigiWebApp.SettingsController.getSetting("currentTimezoneOffset")===""){DigiWebApp.SettingsController.setSetting("currentTimezoneOffset",(new Date).getTimezoneOffset());
DigiWebApp.SettingsController.setSetting("currentTimezone",jstz.determine().name())}_.each(c,function(g){if(typeof g.get("modelVersion")==="undefined"||g.get("modelVersion")===""){g.set("mitarbeiterId",DigiWebApp.SettingsController.getSetting("mitarbeiterId"));if(typeof g.get("timezoneOffset")==="undefined"||g.get("timezoneOffset")===""||typeof g.get("timezone")==="undefined"||g.get("timezone")===""){g.set("timezoneOffset",(new Date(Number(g.get("timeStampStart")))).getTimezoneOffset());g.set("timezone",
jstz.determine().name())}var h=g.get("startDateString"),i=g.get("startTimeString");if(typeof h==="undefined"||!h||h===""||typeof i==="undefined"||!i||i===""){i=D8.create(new Date(Number(g.get("timeStampStart"))+6E4*((new Date(Number(g.get("timeStampStart")))).getTimezoneOffset()-g.get("timezoneOffset"))));h=i.format("dd.mm.yyyy");i=i.format("HH:MM");g.set("startDateString",h);g.set("startTimeString",i)}h=g.get("endeDateString");i=g.get("endeTimeString");if(typeof h==="undefined"||!h||h===""||typeof i===
"undefined"||!i||i===""){i=D8.create(new Date(Number(g.get("timeStampEnd"))+6E4*((new Date(Number(g.get("timeStampEnd")))).getTimezoneOffset()-g.get("timezoneOffset"))));h=i.format("dd.mm.yyyy");i=i.format("HH:MM");g.set("endeDateString",h);g.set("endeTimeString",i)}g.set("modelVersion","1");g.save();writeToLog("Buchung auf modelVersion 1 aktualisiert: "+JSON.stringify(g))}parseInt(g.get("modelVersion"))});a()};if(typeof DigiWebApp.SettingsController.getSetting("mitarbeiterId")==="undefined"||DigiWebApp.SettingsController.getSetting("mitarbeiterId")===
""||parseInt(DigiWebApp.SettingsController.getSetting("mitarbeiterId"))===0){writeToLog("aktualisiere Mitarbeiter des Benutzers in updateModels ("+DigiWebApp.SettingsController.getSetting("mitarbeiterId")+")");DigiWebApp.JSONDatenuebertragungController.recieveData("mitarbeiter",M.I18N.l("BautagebuchLadeMitarbeiter"),function(c){DigiWebApp.ApplicationController.DigiLoaderView.hide();if(c&&c.mitarbeiter&&c.mitarbeiter.length>0){DigiWebApp.SettingsController.setSetting("mitarbeiterVorname",c.mitarbeiter[0].vorname);
DigiWebApp.SettingsController.setSetting("mitarbeiterNachname",c.mitarbeiter[0].nachname);DigiWebApp.SettingsController.setSetting("mitarbeiterId",c.mitarbeiter[0].mitarbeiterId);b()}else DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("offlineWorkNotPossible"),message:M.I18N.l("offlineWorkNotPossibleMsg")})},function(){DigiWebApp.ApplicationController.DigiLoaderView.hide();DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("offlineWorkNotPossible"),message:M.I18N.l("offlineWorkNotPossibleMsg")})},
"getAll=true&webAppId="+DigiWebApp.SettingsController.getSetting("workerId"),true)}else b()},sonderzeichenCheck:function(a){return/[^\w\s\u00e4\u00f6\u00fc\u00c4\u00d6\u00dc\u00df \x40"(){}*%\$\u00a7\u20ac=/\\!?.,;:+-]+/.test(a)},vibrate:function(){try{var a=DigiWebApp.ApplicationController.CONSTVibrateDuration;if(typeof DigiWebApp.SettingsController.getSetting("vibrationsDauer")!=="undefined")a=DigiWebApp.SettingsController.getSetting("vibrationsDauer");a>0&&navigator.notification.vibrate(a)}catch(b){}}});
DigiWebApp.OrderInfoController=M.Controller.extend({orders:null,positions:null,activeOrder:null,activePosition:null,items:[],init:function(){DigiWebApp.OrderInfoController.set("activeOrder",null);DigiWebApp.OrderInfoController.set("activePosition",null);DigiWebApp.OrderInfoController.set("items",[]);var a=DigiWebApp.HandOrder.findSorted().concat(DigiWebApp.Order.findSorted()),b=DigiWebApp.Position.findSorted(),c=NO;if(DigiWebApp.SettingsController.getSetting("auftragsDetailsKoppeln")){a=_.map(a,function(d){if(d){var f=
{label:d.get("name"),value:d.get("id")};if(f.value===M.ViewManager.getView("bookingPage","order").getSelection()){c=f.isSelected=YES;DigiWebApp.OrderInfoController.set("activeOrder",[d])}return f}});a=_.compact(a);c===NO&&a.push({label:M.I18N.l("selectSomething"),value:"0",isSelected:!c});c=NO;b=_.map(b,function(d){if(d){if(DigiWebApp.OrderInfoController.activeOrder!==null){if(d.get("orderId")!==DigiWebApp.OrderInfoController.activeOrder[0].get("id"))return null}else return null;var f={label:d.get("name"),
value:d.get("id")};if(f.value===M.ViewManager.getView("bookingPage","position").getSelection()){c=f.isSelected=YES;DigiWebApp.OrderInfoController.set("activePosition",[d])}return f}})}else{a=_.map(a,function(d){if(d){var f={label:d.get("name"),value:d.get("id")};if(DigiWebApp.BookingController.currentBooking!==null)if(f.value===DigiWebApp.BookingController.currentBooking.get("orderId")||f.value===DigiWebApp.BookingController.currentBooking.get("handOrderId")){c=f.isSelected=YES;DigiWebApp.OrderInfoController.set("activeOrder",
[d])}return f}});a=_.compact(a);c===NO&&a.push({label:M.I18N.l("selectSomething"),value:"0",isSelected:!c});c=NO;b=_.map(b,function(d){if(d){if(DigiWebApp.OrderInfoController.activeOrder!==null){if(d.get("orderId")!==DigiWebApp.OrderInfoController.activeOrder[0].get("id"))return null}else return null;var f={label:d.get("name"),value:d.get("id")};if(DigiWebApp.BookingController.currentBooking!==null)if(f.value===DigiWebApp.BookingController.currentBooking.get("positionId")){c=f.isSelected=YES;DigiWebApp.OrderInfoController.set("activePosition",
[d])}return f}})}b=_.compact(b);c===NO&&b.push({label:M.I18N.l("selectSomething"),value:"0",isSelected:!c});this.set("orders",a);this.set("positions",b);this.setItem()},setItem:function(){var a={orderName:"",positionName:"",positionStrasse:"",positionHausnummer:"",positionPLZ:"",positionOrt:"",positionLand:"",positionStrasseUndHausnummer:"",positionPLZundOrt:"",positionCountryCode:"",positionTelefon:"",positionFax:"",positionEmail:"",positionAnsprechpartner:"",positionKundenname:"",positionLongitude:"",
positionLatitude:"",positionBeschreibung:""};if(DigiWebApp.OrderInfoController.activeOrder!==null)a.orderName=DigiWebApp.OrderInfoController.activeOrder[0].get("name");if(DigiWebApp.OrderInfoController.activePosition!==null){a.positionName=DigiWebApp.OrderInfoController.activePosition[0].get("name");a.positionStrasse=DigiWebApp.OrderInfoController.activePosition[0].get("strasse");a.positionHausnummer=DigiWebApp.OrderInfoController.activePosition[0].get("hausnummer");a.positionPLZ=DigiWebApp.OrderInfoController.activePosition[0].get("plz");
a.positionOrt=DigiWebApp.OrderInfoController.activePosition[0].get("ort");a.positionLand=DigiWebApp.OrderInfoController.activePosition[0].get("land");a.positionTelefon=DigiWebApp.OrderInfoController.activePosition[0].get("telefon");a.positionFax=DigiWebApp.OrderInfoController.activePosition[0].get("fax");a.positionEmail=DigiWebApp.OrderInfoController.activePosition[0].get("email");a.positionAnsprechpartner=DigiWebApp.OrderInfoController.activePosition[0].get("ansprechpartner");a.positionKundenname=
DigiWebApp.OrderInfoController.activePosition[0].get("kundenname");a.positionLongitude=DigiWebApp.OrderInfoController.activePosition[0].get("longitude");a.positionLatitude=DigiWebApp.OrderInfoController.activePosition[0].get("latitude");a.positionBeschreibung=DigiWebApp.OrderInfoController.activePosition[0].get("description");a.positionCountryCode=DigiWebApp.OrderInfoController.activePosition[0].get("countrycode");a.positionPLZundOrt=a.positionPLZ+" "+a.positionOrt;a.positionStrasseUndHausnummer=
a.positionStrasse+" "+a.positionHausnummer}a.orderName===""&&a.positionName===""?DigiWebApp.OrderInfoController.set("items",[]):DigiWebApp.OrderInfoController.set("items",[a])},setPositions:function(){var a=M.ViewManager.getView("orderInfoPage","order").getSelection(YES).value;if(a){var b=DigiWebApp.Position.findSorted(),c=0;b=_.map(b,function(d){if(d){if(d.get("orderId")===a){var f={label:d.get("name"),value:d.get("id")};if(c===0){f.isSelected=YES;DigiWebApp.OrderInfoController.set("activePosition",
[d])}c+=1;return f}return null}});b=_.compact(b);if(b.length<1){b.push({label:M.I18N.l("noData"),value:"0"});DigiWebApp.OrderInfoController.set("activePosition",null)}M.ViewManager.getView("orderInfoPage","position").resetSelection();this.set("positions",b);this.setItem()}},saveAsContact:function(){if(typeof navigator.contacts==="undefined")DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("saveAsContact"),message:M.I18N.l("noContactsAvailable")});else{var a=DigiWebApp.OrderInfoController.items[0],
b=new ContactFindOptions;b.filter=a.orderName+", "+a.positionName;DigiWebApp.ApplicationController.DigiLoaderView.show(M.I18N.l("saveAsContact"));navigator.contacts.find(["displayName","name","givenName","familyName"],DigiWebApp.OrderInfoController.saveAsContactFound,DigiWebApp.OrderInfoController.saveAsContactFoundError,b)}},saveAsContactFound:function(a){var b=DigiWebApp.OrderInfoController.items[0];DigiWebApp.ApplicationController.DigiLoaderView.hide();if(typeof a==="undefined"){b=navigator.contacts.create({displayName:M.I18N.l("orderInfo")+
" "+b.orderName});return DigiWebApp.OrderInfoController.saveAsContactSave(b)}else if(a.length===0){b=navigator.contacts.create({displayName:M.I18N.l("orderInfo")+" "+b.orderName+", "+b.positionName});return DigiWebApp.OrderInfoController.saveAsContactSave(b)}else if(a.length>1)DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("saveAsContact"),message:M.I18N.l("contactExistsMultiple")});else{b=M.I18N.l("saveAsContactChangeQuestionMsg");DigiWebApp.ApplicationController.nativeConfirmDialogView({title:M.I18N.l("saveAsContactChangeQuestionTitle"),
message:b,confirmButtonValue:M.I18N.l("yes"),cancelButtonValue:M.I18N.l("no"),callbacks:{confirm:{target:this,action:function(){a[0].remove(DigiWebApp.OrderInfoController.contactRemoveSuccess,DigiWebApp.OrderInfoController.contactRemoveError)}},cancel:{target:this,action:function(){}}}})}},contactRemoveSuccess:function(){var a=DigiWebApp.OrderInfoController.items[0];a=navigator.contacts.create({displayName:M.I18N.l("orderInfo")+" "+a.orderName});return DigiWebApp.OrderInfoController.saveAsContactSave(a)},
contactRemoveError:function(){DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("saveAsContact"),message:M.I18N.l("saveAsContactChangeErrorMsg")})},saveAsContactFoundError:function(){DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("saveAsContact"),message:M.I18N.l("error")})},saveAsContactSave:function(a){var b=DigiWebApp.OrderInfoController.items[0],c=new ContactName;c.givenName=M.I18N.l("orderInfo");c.familyName=b.orderName+", "+b.positionName;c.honorificPrefix=
"DIGI-WebApp";a.name=c;c=[];var d="",f="";try{d=b.positionTelefon}catch(e){console.error(e)}try{f=b.positionFax}catch(g){console.error(g)}c[0]=new ContactField("work",d,true);c[1]=new ContactField("fax",f,false);a.phoneNumbers=c;c=[];d="";try{d=b.positionEmail}catch(h){console.error(h)}c[0]=new ContactField("work",d,true);a.emails=c;c=new ContactAddress;c.type="Work";c.streetAddress=b.positionStrasseUndHausnummer;c.locality=b.positionOrt;c.postalCode=b.positionPLZ;c.country=b.positionLand;if(a.addresses===
null)a.addresses=[c];else a.addresses[0]=c;c=new Date;a.note=b.positionBeschreibung+" ("+M.I18N.l("contactLastChange")+": "+c.toString()+")";DigiWebApp.ApplicationController.DigiLoaderView.show(M.I18N.l("saveAsContact"));a.save(DigiWebApp.OrderInfoController.saveAsContactSuccess,DigiWebApp.OrderInfoController.saveAsContactError)},saveAsContactSuccess:function(){DigiWebApp.ApplicationController.DigiLoaderView.hide()},saveAsContactError:function(){DigiWebApp.ApplicationController.DigiLoaderView.hide()}});
DigiWebApp.HandOrderController=M.Controller.extend({currentHandOrderName:"",save:function(){var a=M.ViewManager.getView("handOrderPage","orderName").value;if(a=$.trim(a)){var b=_.select(DigiWebApp.HandOrder.findSorted(),function(h){if(h)return h.get("name")===a});if(DigiWebApp.ApplicationController.sonderzeichenCheck(a))DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("specialCharProblem"),message:M.I18N.l("specialCharProblemMsg")});else if(b.length>0)DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("handOrderExists"),
message:M.I18N.l("handOrderExistsMsg")});else if(a.length>16)DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("handOrderTooLong"),message:M.I18N.l("handOrderTooLongMsg")});else{b=DigiWebApp.HandOrder.createRecord({name:a,id:a,isLocalOnly:YES});var c=DigiWebApp.ApplicationController.storagePrefix+"_handorderKeys",d=localStorage.getItem(c),f=[];if(typeof d==="string")try{f=JSON.parse(d)}catch(e){console.error(e)}try{f.push(b.m_id)}catch(g){console.error("ERROR in save: "+g)}localStorage.setItem(c,
JSON.stringify(f));b.save();if(b){M.ViewManager.getView("handOrderPage","orderName").setValue("");DigiWebApp.SelectionController.useSelections=NO;DigiWebApp.SelectionController.showHandOrderFirst=YES;this.currentHandOrderName=a;DigiWebApp.NavigationController.toBookTimePage(YES)}else DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("handOrderSaveError"),message:M.I18N.l("handOrderSaveErrorMsg")})}}else DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("noHandOrderNameEntered"),
message:M.I18N.l("noHandOrderNameEnteredMsg")})}});
DigiWebApp.BautagebuchMaterialienListeController=M.Controller.extend({items:null,init:function(){this.set("items",DigiWebApp.BautagebuchMaterialBuchung.findSorted(DigiWebApp.BautagebuchBautageberichtDetailsController.item.m_id))},neu:function(){DigiWebApp.BautagebuchMaterialienDetailsController.set("item",DigiWebApp.BautagebuchMaterialBuchung.createRecord({bautagesberichtId:DigiWebApp.BautagebuchBautageberichtDetailsController.item.m_id}));DigiWebApp.BautagebuchMaterialienDetailsController.set("positionId",null);
DigiWebApp.BautagebuchMaterialienDetailsController.set("positionName",null);DigiWebApp.BautagebuchMaterialienDetailsController.set("activityId",null);DigiWebApp.BautagebuchMaterialienDetailsController.set("activityName",null);DigiWebApp.BautagebuchMaterialienDetailsController.set("artikel",null);DigiWebApp.BautagebuchMaterialienDetailsController.set("einheit",null);DigiWebApp.BautagebuchMaterialienDetailsController.set("menge",null);DigiWebApp.BautagebuchMaterialienDetailsController.set("materialId",
null);DigiWebApp.BautagebuchMaterialienDetailsController.set("mengeneinheitId",null);DigiWebApp.NavigationController.toBautagebuchMaterialienDetailsPageTransition()}});
DigiWebApp.StudieChecklisteController=M.Controller.extend({listData:null,t1:null,t2:null,comboBoxData:null,init:function(){this.set("listData",[{label:"Test 1",comboBox:[{label:"eintrag 1",value:"1"},{label:"eintrag 2",value:"2"}]},{label:"Test 2",comboBox:[{label:"eintrag 3",value:"3"},{label:"eintrag 4",value:"4"}]},{label:"Test 3",comboBox:[{label:"eintrag 5",value:"5"},{label:"eintrag 6",value:"6"}]}])}});
DigiWebApp.EditPicturePageController=M.Controller.extend({myMediaFile:null,orders:null,positions:null,activities:null,selections:{order:null,position:null,activity:null},deleteMediaFileFromLocalStorage:function(){var a=DigiWebApp.EditPicturePageController.myMediaFile;try{a.del()}catch(b){console.error(b)}DigiWebApp.ApplicationController.DigiLoaderView.hide();DigiWebApp.NavigationController.backToMediaListPageTransition()},init:function(){$("#"+DigiWebApp.EditPicturePage.content.remarkInput.id).val("");
M.ViewManager.getView("editPicturePage","remarkInput").value="";$("#"+DigiWebApp.EditPicturePage.content.remarkInput.id).val(this.myMediaFile.get("remark"));M.ViewManager.getView("editPicturePage","remarkInput").value=this.myMediaFile.get("remark");document.getElementById(DigiWebApp.EditPicturePage.content.image.id).src="";DigiWebApp.EditPicturePageController.myImageObj=new Image;this.myMediaFile.readFromFile(function(a){if(a&&a!=="")document.getElementById(DigiWebApp.EditPicturePage.content.image.id).src=
a},function(){document.getElementById(DigiWebApp.EditPicturePage.content.image.id).src=""});$("#"+DigiWebApp.EditPicturePage.content.savePictureGrid.id).show();DigiWebApp.EditPicturePageController.setSelectionByMediaFile();DigiWebApp.ApplicationController.DigiLoaderView.hide()},setSelectionByMediaFile:function(){var a=DigiWebApp.HandOrder.findSorted().concat(DigiWebApp.Order.findSorted()),b=DigiWebApp.Position.findSorted(),c=DigiWebApp.EditPicturePageController.getActivities(),d=this.myMediaFile.get("orderId"),
f=this.myMediaFile.get("positionId"),e=this.myMediaFile.get("activityId"),g=NO,h=null;h=_.map(a,function(j){var l=null;if(j)if(j.get("id")==d){l={label:j.get("name"),value:j.get("id"),isSelected:YES};g=YES}else l={label:j.get("name"),value:j.get("id")};return l});h=_.compact(h);h.push({label:M.I18N.l("selectSomething"),value:"0"});h=g===NO?_.map(h,function(j){var l=null;if(j)l=j.value==d?{label:j.label,value:j.value,isSelected:YES}:{label:j.label,value:j.value};return l}):h;h=_.compact(h);b=_.map(b,
function(j){if(j){if(j.get("orderId")===d){var l=null;return l=j.get("id")===f?{label:j.get("name"),value:j.get("id"),isSelected:YES}:{label:j.get("name"),value:j.get("id")}}return null}});b=_.compact(b);b.push({label:M.I18N.l("selectSomething"),value:"0"});c=_.select(DigiWebApp.WorkPlan.find(),function(j){if(j)return j.get("id")==f});var i=NO;c=c.length>0?this.getActivitiesFromWorkplan(c[0]):DigiWebApp.EditPicturePageController.getActivities();c=_.map(c,function(j){if(typeof j==="undefined"){console.log("UNDEFINED ACTIVITY");
return null}else{var l=null;if(j.get("id")==e){l={label:j.get("name"),value:j.get("id"),isSelected:YES};i=YES}else l={label:j.get("name"),value:j.get("id")};return l}});c=_.compact(c);c.push({label:M.I18N.l("selectSomething"),value:"0",isSelected:!i});this.resetSelection();this.set("orders",h);this.set("positions",b);this.set("activities",c)},setPositions:function(){var a=M.ViewManager.getView("editPicturePage","order").getSelection(YES).value;if(a){var b=DigiWebApp.Position.findSorted(),c=0;b=_.map(b,
function(d){if(d){if(d.get("orderId")===a){d={label:d.get("name"),value:d.get("id")};if(c===0)d.isSelected=YES;c+=1;return d}return null}});b=_.compact(b);b.length<1&&b.push({label:M.I18N.l("noData"),value:"0"});M.ViewManager.getView("editPicturePage","position").resetSelection();this.set("positions",b);this.setActivities(YES);this.saveSelection()}},setActivities:function(a){var b=null;if(a)if(a=M.ViewManager.getView("editPicturePage","position").getSelection(YES))b=a.value;a=[];var c=[];_.each(DigiWebApp.WorkPlan.find(),
function(e){parseInt(e.get("id"))===parseInt(b)&&c.push(e)});var d=0;a=c.length===1?this.getActivitiesFromWorkplan(c[0]):DigiWebApp.EditPicturePageController.getActivities();var f=false;_.each(a,function(e){if(typeof e==="undefined"){console.log("UNDEFINED ACTIVITY");return null}else if(e.get("id")===-1)f=true});a=_.map(a,function(e){if(typeof e==="undefined"){console.log("UNDEFINED ACTIVITY");return null}else{var g=null;g=f?{label:e.get("name"),value:e.get("id"),isSelected:e.get("id")===-1?YES:NO}:
{label:e.get("name"),value:e.get("id"),isSelected:d===0?YES:NO};d+=1;return g}});a=_.compact(a);a.length>0?a.push({label:M.I18N.l("selectSomething"),value:"0",isSelected:NO}):a.push({label:M.I18N.l("noData"),value:"0"});M.ViewManager.getView("editPicturePage","activity").resetSelection();this.set("activities",a);this.saveSelection()},initSelection:function(){var a=DigiWebApp.HandOrder.findSorted().concat(DigiWebApp.Order.findSorted()),b=DigiWebApp.Position.findSorted(),c=DigiWebApp.EditPicturePageController.getActivities(),
d=[];if(a)d=_.map(a,function(f){if(f)return{label:f.get("name"),value:f.get("id")}});d.push({label:M.I18N.l("selectSomething"),value:"0",isSelected:YES});a=[];if(b)a=_.map(b,function(f){if(f)return{label:f.get("name"),value:f.get("id")}});a.push({label:M.I18N.l("selectSomething"),value:"0",isSelected:YES});b=[];if(c)b=_.map(c,function(f){if(typeof f==="undefined"){console.log("UNDEFINED ACTIVITY");return null}else return{label:f.get("name"),value:f.get("id")}});b.push({label:M.I18N.l("selectSomething"),
value:"0",isSelected:YES});this.resetSelection();this.set("orders",d);this.set("positions",a);this.set("activities",b);M.ViewManager.getView("editPicturePage","order").setSelection("0");M.ViewManager.getView("editPicturePage","position").setSelection("0");M.ViewManager.getView("editPicturePage","activity").setSelection("0")},resetSelection:function(){M.ViewManager.getView("editPicturePage","order").resetSelection();M.ViewManager.getView("editPicturePage","position").resetSelection();M.ViewManager.getView("editPicturePage",
"activity").resetSelection()},isPositionSelected:function(){var a=M.ViewManager.getView("editPicturePage","position").getSelection(YES);return a&&a.value!="0"?YES:NO},isActivitySelected:function(){var a=M.ViewManager.getView("editPicturePage","activity").getSelection(YES);return a&&a.value!="0"?YES:NO},saveSelection:function(){var a=M.ViewManager.getView("editPicturePage","order").getSelection(),b=M.ViewManager.getView("editPicturePage","position").getSelection(),c=M.ViewManager.getView("editPicturePage",
"activity").getSelection();this.selections.order=a;this.selections.position=b;this.selections.activity=c;this.useSelections=YES},getActivities:function(a){a=a?DigiWebApp.Activity.find(a):DigiWebApp.Activity.findSorted();a=_.map(a,function(b){return parseInt(b.get("positionId"))===1?b:null});return a=_.compact(a)},getActivitiesFromWorkplan:function(a){var b=a.get("activityIds").split(","),c=[];if(b&&b.length>0)for(var d=0;d<b.length;d++)c.push(_.first(DigiWebApp.Activity.find({query:{identifier:"id",
operator:"=",value:b[d]}})));if(parseInt(a.get("workplanType"))===1)c=_.map(c,function(f){if(typeof f==="undefined"){console.log("UNDEFINED ACTIVITY");return null}else{var e=NO,g=DigiWebApp.Activity.findSorted();_.each(g,function(h){if(parseInt(h.get("positionId"))===1)e=YES});return e?f:null}});return c=_.compact(c)},savePicture:function(){this.saveSelection();var a=M.ViewManager.getView("editPicturePage","order").getSelection(),b=M.ViewManager.getView("editPicturePage","position").getSelection(YES);
b=b?b.value:null;var c=M.ViewManager.getView("editPicturePage","activity").getSelection(YES),d=c?c.value:null,f=null,e=null;if(DigiWebApp.BookingController.isHandOrder(a)){f=a;e=_.select(DigiWebApp.HandOrder.findSorted(),function(g){if(g)return g.get("id")===a||g.get("name")===a})[0].get("name");a=f;b=null}c=this.myMediaFile;c.set("orderId",a);c.set("handOrderId",f);c.set("handOrderName",e);c.set("positionId",b);c.set("activityId",d);c.set("remark",M.ViewManager.getView("editPicturePage","remarkInput").value);
b=document.getElementById(DigiWebApp.EditPicturePage.content.image.id);c.set("fileType",DigiWebApp.ApplicationController.CONSTImageFiletype);c.save();c.saveToFile(b.src,function(){DigiWebApp.ApplicationController.DigiLoaderView.hide();DigiWebApp.NavigationController.backToMediaListPageTransition()})}});
DigiWebApp.SettingsController=M.Controller.extend({showCredentialsAlert:NO,credentialsAlertShown:false,showIOSMessage:true,settings:null,mitarbeiterNameVorname:"",globalDebugMode:NO,defaultsettings_object:{debug:false,treatAllAsTablet:false,treatAllAsPhone:false,company:"",password:"",connectionCode:"",settingsPassword:"digi$",workerId:"",platform:"",userAgent:"",skipEvents:"",timeouthappened:"",mapType:"Google",autoSyncAfterBookTime:false,autoTransferAfterBookTime:true,autoTransferAfterClosingDay:true,
autoSaveGPSData:false,GPSDataIsMandatory:false,remarkIsMandatory:false,remarkIsOptional:false,useTransitionsSetting:true,daysToHoldBookingsOnDevice:"10",bautagebuchLimit_autoStartUhrzeit:false,datatransfer_min_delay:3E4,branding:"",GPSTimeOut:24E4,silentLoader:false,currentTimezoneOffset:null,currentTimezone:null,ServiceApp_ermittleGeokoordinate:false,ServiceApp_datenUebertragen:false,ServiceApp_engeKopplung:false,ServiceApp_PORT:"60000",ServiceApp_FallBack:true,debugDatabaseServer:null,mitarbeiterVorname:"",
mitarbeiterNachname:"",mitarbeiterId:"0",auftragsDetailsKoppeln:false,detailierteZeitdaten:true,vibrationsDauer:100},defaultsettings:null,init:function(a,b){var c=DigiWebApp.SettingsController,d=b&&DigiWebApp.SettingsController.featureAvailable("417");M.I18N.defaultLanguage="de_de";DigiWebApp.TabBar.setActiveTab(DigiWebApp.TabBar.tabItem2);if(c.showCredentialsAlert&&!c.credentialsAlertShown){if((M.Environment.getPlatform().substr(0,4)==="iPad"||M.Environment.getPlatform().substr(0,6)==="iPhone")&&
typeof device!=="undefined"){DigiWebApp.ApplicationController.enforceChefToolOnly();console.log("device.version: "+device.version)}else DigiWebApp.ApplicationController.enforceChefToolOnly();DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("noCredentials"),message:M.I18N.l("noCredentialsMsg")});c.credentialsAlertShown=true}c.defaultsettings=DigiWebApp.Settings.createRecord(DigiWebApp.SettingsController.defaultsettings_object);DigiWebApp.Settings.find();if(DigiWebApp.SettingsController.featureAvailable("403")){$("#"+
DigiWebApp.SettingsPage.content.remarkIsMandatory.id).show();$("#"+DigiWebApp.SettingsPage.content.remarkIsOptional.id).show()}else{$("#"+DigiWebApp.SettingsPage.content.remarkIsMandatory.id).hide();$("#"+DigiWebApp.SettingsPage.content.remarkIsOptional.id).hide()}DigiWebApp.SettingsController.featureAvailable("406")?$("#"+DigiWebApp.SettingsPage.content.auftragsDetailsKoppeln.id).show():$("#"+DigiWebApp.SettingsPage.content.auftragsDetailsKoppeln.id).hide();DigiWebApp.SettingsController.featureAvailable("411")?
$("#"+DigiWebApp.SettingsPage.content.daysToHoldBookingsOnDeviceSliderContainer.id).show():$("#"+DigiWebApp.SettingsPage.content.daysToHoldBookingsOnDeviceSliderContainer.id).hide();DigiWebApp.SettingsController.featureAvailable("412")?$("#"+DigiWebApp.SettingsPage.content.bautagebuchLimit_autoStartUhrzeit.id).show():$("#"+DigiWebApp.SettingsPage.content.bautagebuchLimit_autoStartUhrzeit.id).hide();DigiWebApp.ApplicationController.enforceChefToolOnly();$("#"+DigiWebApp.SettingsPage.content.useTransitionsSetting.id).hide();
var f=null;if(DigiWebApp.Settings.records().length>0){var e=DigiWebApp.Settings.records()[0];(f=e.get("daysToHoldBookingsOnDevice"))||(f=DigiWebApp.SettingsController.defaultsettings.get("daysToHoldBookingsOnDevice"));var g=e.get("vibrationsDauer");if(!g){g="";try{g=device.platform.substr(0,3)}catch(h){}g=g==="iOS"?0:DigiWebApp.SettingsController.defaultsettings.get("vibrationsDauer")}var i=e.get("GPSDataIsMandatory");i||(i=DigiWebApp.SettingsController.defaultsettings.get("GPSDataIsMandatory"));
var j=e.get("bautagebuchLimit_autoStartUhrzeit");j||(j=DigiWebApp.SettingsController.defaultsettings.get("bautagebuchLimit_autoStartUhrzeit"));f={debug:[{value:e.get("debug"),label:"debug",isSelected:e.get("debug")}],treatAllAsTablet:[{value:e.get("treatAllAsTablet"),label:"treatAllAsTablet",isSelected:e.get("treatAllAsTablet")}],treatAllAsPhone:[{value:e.get("treatAllAsPhone"),label:"treatAllAsPhone",isSelected:e.get("treatAllAsPhone")}],daysToHoldBookingsOnDevice:f,company:e.get("company"),password:e.get("password"),
connectionCode:e.get("connectionCode"),settingsPassword:e.get("settingsPassword"),workerId:e.get("workerId"),timeouthappened:DigiWebApp.ApplicationController.timeouthappened,skipEvents:DigiWebApp.ApplicationController.skipEvents,platform:M.Environment.getPlatform(),userAgent:navigator.userAgent,mapType:e.get("mapType"),autoSyncAfterBookTime:[{value:e.get("autoSyncAfterBookTime"),label:M.I18N.l("autoSyncAfterBookTimeCheck"),isSelected:e.get("autoSyncAfterBookTime")}],autoTransferAfterBookTime:[{value:e.get("autoTransferAfterBookTime"),
label:M.I18N.l("autoTransferAfterBookTimeCheck"),isSelected:e.get("autoTransferAfterBookTime")}],autoTransferAfterClosingDay:[{value:e.get("autoTransferAfterClosingDay"),label:M.I18N.l("autoTransferAfterClosingDayCheck"),isSelected:e.get("autoTransferAfterClosingDay")}],autoSaveGPSData:[{value:e.get("autoSaveGPSData"),label:M.I18N.l("autoSaveGPSData"),isSelected:e.get("autoSaveGPSData")}],bautagebuchLimit_autoStartUhrzeit:[{value:j,label:M.I18N.l("bautagebuchLimit_autoStartUhrzeit"),isSelected:j}],
GPSDataIsMandatory:[{value:i,label:M.I18N.l("GPSDataIsMandatory"),isSelected:i}],remarkIsMandatory:[{value:e.get("remarkIsMandatory"),label:M.I18N.l("remarkIsMandatory"),isSelected:e.get("remarkIsMandatory")}],remarkIsOptional:[{value:e.get("remarkIsOptional"),label:M.I18N.l("remarkIsOptional"),isSelected:e.get("remarkIsOptional")}],detailierteZeitdaten:[{value:e.get("detailierteZeitdaten"),label:M.I18N.l("detailierteZeitdaten"),isSelected:e.get("detailierteZeitdaten")}],useTransitionsSetting:[{value:e.get("useTransitionsSetting"),
label:M.I18N.l("useTransitionsSetting"),isSelected:e.get("useTransitionsSetting")}],datatransfer_min_delay:e.get("datatransfer_min_delay"),branding:e.get("branding"),GPSTimeOut:e.get("GPSTimeOut"),silentLoader:e.get("silentLoader"),currentTimezoneOffset:e.get("currentTimezoneOffset"),currentTimezone:e.get("currentTimezone"),ServiceApp_ermittleGeokoordinate:[{value:e.get("ServiceApp_ermittleGeokoordinate"),label:M.I18N.l("ServiceApp_ermittleGeokoordinate"),isSelected:e.get("ServiceApp_ermittleGeokoordinate")}],
ServiceApp_datenUebertragen:[{value:e.get("ServiceApp_datenUebertragen"),label:M.I18N.l("ServiceApp_datenUebertragen"),isSelected:e.get("ServiceApp_datenUebertragen")}],ServiceApp_engeKopplung:[{value:e.get("ServiceApp_engeKopplung"),label:M.I18N.l("ServiceApp_engeKopplung"),isSelected:e.get("ServiceApp_engeKopplung")}],ServiceApp_FallBack:[{value:e.get("ServiceApp_FallBack"),label:M.I18N.l("ServiceApp_FallBack"),isSelected:e.get("ServiceApp_FallBack")}],ServiceApp_PORT:e.get("ServiceApp_PORT"),debugDatabaseServer:e.get("debugDatabaseServer"),
mitarbeiterVorname:e.get("mitarbeiterVorname"),mitarbeiterNachname:e.get("mitarbeiterNachname"),mitarbeiterId:e.get("mitarbeiterId"),auftragsDetailsKoppeln:[{value:e.get("auftragsDetailsKoppeln"),label:M.I18N.l("auftragsDetailsKoppeln"),isSelected:e.get("auftragsDetailsKoppeln")}],vibrationsDauer:g}}else{f={debug:[{value:DigiWebApp.SettingsController.defaultsettings.get("debug"),label:"debug"}],treatAllAsTablet:[{value:DigiWebApp.SettingsController.defaultsettings.get("treatAllAsTablet"),label:"treatAllAsTablet"}],
treatAllAsPhone:[{value:DigiWebApp.SettingsController.defaultsettings.get("treatAllAsPhone"),label:"treatAllAsPhone"}],daysToHoldBookingsOnDevice:DigiWebApp.SettingsController.defaultsettings.get("daysToHoldBookingsOnDevice"),company:DigiWebApp.SettingsController.defaultsettings.get("company"),password:DigiWebApp.SettingsController.defaultsettings.get("password"),connectionCode:DigiWebApp.SettingsController.defaultsettings.get("connectionCode"),settingsPassword:DigiWebApp.SettingsController.defaultsettings.get("settingsPassword"),
workerId:DigiWebApp.SettingsController.defaultsettings.get("workerId"),timeouthappened:DigiWebApp.ApplicationController.timeouthappened,skipEvents:DigiWebApp.ApplicationController.skipEvents,platform:M.Environment.getPlatform(),userAgent:navigator.userAgent,mapType:DigiWebApp.SettingsController.defaultsettings.get("mapType"),autoSyncAfterBookTime:[{value:DigiWebApp.SettingsController.defaultsettings.get("autoSyncAfterBookTime"),label:M.I18N.l("autoSyncAfterBookTimeCheck")}],autoTransferAfterBookTime:[{value:DigiWebApp.SettingsController.defaultsettings.get("autoTransferAfterBookTime"),
label:M.I18N.l("autoTransferAfterBookTimeCheck")}],autoTransferAfterClosingDay:[{value:DigiWebApp.SettingsController.defaultsettings.get("autoTransferAfterClosingDay"),label:M.I18N.l("autoTransferAfterClosingDayCheck")}],autoSaveGPSData:[{value:DigiWebApp.SettingsController.defaultsettings.get("autoSaveGPSData"),label:M.I18N.l("autoSaveGPSData")}],bautagebuchLimit_autoStartUhrzeit:[{value:DigiWebApp.SettingsController.defaultsettings.get("bautagebuchLimit_autoStartUhrzeit"),label:M.I18N.l("bautagebuchLimit_autoStartUhrzeit")}],
GPSDataIsMandatory:[{value:DigiWebApp.SettingsController.defaultsettings.get("GPSDataIsMandatory"),label:M.I18N.l("GPSDataIsMandatory")}],remarkIsMandatory:[{value:DigiWebApp.SettingsController.defaultsettings.get("remarkIsMandatory"),label:M.I18N.l("remarkIsMandatory")}],remarkIsOptional:[{value:DigiWebApp.SettingsController.defaultsettings.get("remarkIsOptional"),label:M.I18N.l("remarkIsOptional")}],detailierteZeitdaten:[{value:DigiWebApp.SettingsController.defaultsettings.get("detailierteZeitdaten"),
label:M.I18N.l("detailierteZeitdaten")}],useTransitionsSetting:[{value:DigiWebApp.SettingsController.defaultsettings.get("useTransitionsSetting"),label:M.I18N.l("useTransitionsSetting")}],datatransfer_min_delay:DigiWebApp.SettingsController.defaultsettings.get("datatransfer_min_delay"),branding:DigiWebApp.SettingsController.defaultsettings.get("branding"),GPSTimeOut:DigiWebApp.SettingsController.defaultsettings.get("GPSTimeOut"),silentLoader:DigiWebApp.SettingsController.defaultsettings.get("silentLoader"),
currentTimezoneOffset:DigiWebApp.SettingsController.defaultsettings.get("currentTimezoneOffset"),currentTimezone:DigiWebApp.SettingsController.defaultsettings.get("currentTimezone"),ServiceApp_ermittleGeokoordinate:[{value:DigiWebApp.SettingsController.defaultsettings.get("ServiceApp_ermittleGeokoordinate"),label:M.I18N.l("ServiceApp_ermittleGeokoordinate")}],ServiceApp_datenUebertragen:[{value:DigiWebApp.SettingsController.defaultsettings.get("ServiceApp_datenUebertragen"),label:M.I18N.l("ServiceApp_datenUebertragen")}],
ServiceApp_engeKopplung:[{value:DigiWebApp.SettingsController.defaultsettings.get("ServiceApp_engeKopplung"),label:M.I18N.l("ServiceApp_engeKopplung")}],ServiceApp_FallBack:[{value:DigiWebApp.SettingsController.defaultsettings.get("ServiceApp_FallBack"),label:M.I18N.l("ServiceApp_FallBack")}],ServiceApp_PORT:DigiWebApp.SettingsController.defaultsettings.get("ServiceApp_PORT"),debugDatabaseServer:DigiWebApp.SettingsController.defaultsettings.get("debugDatabaseServer"),mitarbeiterVorname:DigiWebApp.SettingsController.defaultsettings.get("mitarbeiterVorname"),
mitarbeiterNachname:DigiWebApp.SettingsController.defaultsettings.get("mitarbeiterNachname"),mitarbeiterId:DigiWebApp.SettingsController.defaultsettings.get("mitarbeiterId"),auftragsDetailsKoppeln:[{value:DigiWebApp.SettingsController.defaultsettings.get("auftragsDetailsKoppeln"),label:M.I18N.l("auftragsDetailsKoppeln")}],vibrationsDauer:DigiWebApp.SettingsController.defaultsettings.get("vibrationsDauer")};e=DigiWebApp.Settings.createRecord(DigiWebApp.SettingsController.defaultsettings_object).save()}c.set("settings",
f);var l=[],m=function(){(function(){DigiWebApp.ServiceAppController.refreshWAITBookings(function(){DigiWebApp.BookingController.init(YES)},function(n){console.error(n)},l)})()};d&&DigiWebApp.SettingsController.featureAvailable("417")&&m();(function(){$("#"+DigiWebApp.SettingsPage.content.ServiceApp_datenUebertragen.id).hide();if(DigiWebApp.SettingsController.featureAvailable("417")){$("#"+DigiWebApp.SettingsPage.content.ServiceApp_PORTGrid.id).show();$("#"+DigiWebApp.SettingsPage.content.ServiceApp_datenUebertragen.id).hide();
$("#"+DigiWebApp.SettingsPage.content.ServiceApp_ermittleGeokoordinate.id).show();$("#"+DigiWebApp.SettingsPage.content.ServiceApp_engeKopplung.id).show();$("#"+DigiWebApp.SettingsPage.content.ServiceApp_FallBack.id).show();DigiWebApp.ServiceAppController.knockknock(function(n){DigiWebApp.SettingsController.getSetting("debug")&&console.log("ServiceApp is available");if(JSON.parse(n)!==null)try{var o=[],p=DigiWebApp.Booking.find();_.each(JSON.parse(n).GET.buchungen,function(r){var s=false,t=r.datensatz;
_.each(p,function(u){if(u.m_id===t.m_id)s=true});s||o.push(t.m_id)});DigiWebApp.ServiceAppController.deleteBookings(o,m,m)}catch(q){d&&m()}else d&&m()},function(){DigiWebApp.SettingsController.getSetting("debug")&&console.log("ServiceApp is NOT available");d&&m()})}})()},saveDone:YES,save:function(){if(DigiWebApp.SettingsController.saveDone===YES){DigiWebApp.SettingsController.saveDone=NO;var a=DigiWebApp.SettingsController.globalDebugMode,b=DigiWebApp.SettingsController.getSetting("treatAllAsTablet"),
c=DigiWebApp.SettingsController.getSetting("treatAllAsPhone"),d=DigiWebApp.SettingsController.getSetting("settingsPassword"),f=$("#"+M.ViewManager.getView("settingsPage","daysToHoldBookingsOnDeviceSlider").id).val(),e=$("#"+M.ViewManager.getView("settingsPage","companyInput").id).val(),g=$("#"+M.ViewManager.getView("settingsPage","passwordInput").id).val(),h=$("#"+M.ViewManager.getView("settingsPage","connectionCodeInput").id).val(),i=$("#"+M.ViewManager.getView("settingsPage","workerIdInput").id).val(),
j=DigiWebApp.ApplicationController.timeouthappened,l=DigiWebApp.ApplicationController.skipEvents,m=M.Environment.getPlatform(),n=navigator.userAgent,o=DigiWebApp.SettingsController.getSetting("mapType"),p=$("#"+M.ViewManager.getView("settingsPage","autoSyncAfterBookTimeCheck").id+" label.ui-checkbox-on").length>0?YES:NO,q=$("#"+M.ViewManager.getView("settingsPage","autoTransferAfterBookTimeCheck").id+" label.ui-checkbox-on").length>0?YES:NO,r=$("#"+M.ViewManager.getView("settingsPage","autoTransferAfterClosingDayCheck").id+
" label.ui-checkbox-on").length>0?YES:NO,s=$("#"+M.ViewManager.getView("settingsPage","autoSaveGPSData").id+" label.ui-checkbox-on").length>0?YES:NO,t=$("#"+M.ViewManager.getView("settingsPage","useTransitionsSetting").id+" label.ui-checkbox-on").length>0?YES:NO,u=NO;if(M.ViewManager.getView("settingsPage","remarkIsMandatory")!==null)u=$("#"+M.ViewManager.getView("settingsPage","remarkIsMandatory").id+" label.ui-checkbox-on").length>0?YES:NO;var v=NO;if(M.ViewManager.getView("settingsPage","remarkIsOptional")!==
null){v=$("#"+M.ViewManager.getView("settingsPage","remarkIsOptional").id+" label.ui-checkbox-on").length>0?YES:NO;if(v===YES)u=NO}var w=$("#"+M.ViewManager.getView("settingsPage","detailierteZeitdaten").id+" label.ui-checkbox-on").length>0?YES:NO,x=NO;if(M.ViewManager.getView("settingsPage","GPSDataIsMandatory")!==null)x=$("#"+M.ViewManager.getView("settingsPage","GPSDataIsMandatory").id+" label.ui-checkbox-on").length>0?YES:NO;var y=NO;if(M.ViewManager.getView("settingsPage","bautagebuchLimit_autoStartUhrzeit")!==
null)y=$("#"+M.ViewManager.getView("settingsPage","bautagebuchLimit_autoStartUhrzeit").id+" label.ui-checkbox-on").length>0?YES:NO;var B=DigiWebApp.SettingsController.getSetting("datatransfer_min_delay"),C=DigiWebApp.SettingsController.getSetting("branding"),D=DigiWebApp.SettingsController.getSetting("GPSTimeOut"),E=DigiWebApp.SettingsController.getSetting("silentLoader"),F=DigiWebApp.SettingsController.getSetting("currentTimezoneOffset"),G=DigiWebApp.SettingsController.getSetting("currentTimezone"),
z=DigiWebApp.SettingsController.getSetting("ServiceApp_ermittleGeokoordinate");if(M.ViewManager.getView("settingsPage","ServiceApp_ermittleGeokoordinate")!==null)z=$("#"+M.ViewManager.getView("settingsPage","ServiceApp_ermittleGeokoordinate").id+" label.ui-checkbox-on").length>0?YES:NO;var A=DigiWebApp.SettingsController.getSetting("ServiceApp_datenUebertragen");if(M.ViewManager.getView("settingsPage","ServiceApp_datenUebertragen")!==null)A=$("#"+M.ViewManager.getView("settingsPage","ServiceApp_datenUebertragen").id+
" label.ui-checkbox-on").length>0?YES:NO;var H=DigiWebApp.SettingsController.getSetting("ServiceApp_engeKopplung");if(M.ViewManager.getView("settingsPage","ServiceApp_engeKopplung")!==null)H=$("#"+M.ViewManager.getView("settingsPage","ServiceApp_engeKopplung").id+" label.ui-checkbox-on").length>0?YES:NO;var I=DigiWebApp.SettingsController.getSetting("ServiceApp_FallBack");if(M.ViewManager.getView("settingsPage","ServiceApp_FallBack")!==null)I=$("#"+M.ViewManager.getView("settingsPage","ServiceApp_FallBack").id+
" label.ui-checkbox-on").length>0?YES:NO;var J=DigiWebApp.SettingsController.getSetting("ServiceApp_PORT");if(M.ViewManager.getView("settingsPage","ServiceApp_PORTInput")!==null)J=$("#"+M.ViewManager.getView("settingsPage","ServiceApp_PORTInput").id).val();var K=DigiWebApp.SettingsController.getSetting("debugDatabaseServer"),L=DigiWebApp.SettingsController.getSetting("mitarbeiterVorname"),N=DigiWebApp.SettingsController.getSetting("mitarbeiterNachname"),O=DigiWebApp.SettingsController.getSetting("mitarbeiterId"),
P=$("#"+M.ViewManager.getView("settingsPage","auftragsDetailsKoppeln").id+" label.ui-checkbox-on").length>0?YES:NO,Q=$("#"+M.ViewManager.getView("settingsPage","vibrationsDauerSlider").id).val(),R=/^[0-9]+$/;if(e)if(!R.test(e)){DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("inputError"),message:M.I18N.l("inputErrorOnlyNumbers")+":<br />"+M.I18N.l("company")});DigiWebApp.SettingsController.saveDone=YES;return}if(i)if(!R.test(i)){DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("inputError"),
message:M.I18N.l("inputErrorOnlyNumbers")+":<br />"+M.I18N.l("workerId")});DigiWebApp.SettingsController.saveDone=YES;return}if(f)if(!R.test(f)){DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("inputError"),message:M.I18N.l("inputErrorOnlyNumbers")+":<br />"+M.I18N.l("daysToHoldBookingsOnDeviceLabel")});DigiWebApp.SettingsController.saveDone=YES;return}DigiWebApp.ApplicationController.nativeConfirmDialogView({title:M.I18N.l("hint"),message:M.I18N.l("confirmSaveOfSettings"),
callbacks:{confirm:{action:function(){var k=DigiWebApp.Settings.find()[0];if(k){var S=k.get("company")==""&&k.get("password")==""&&k.get("connectionCode")==""&&k.get("workerId")=="";if(!S&&(k.get("company")!=e||k.get("password")!=g||k.get("connectionCode")!=h||k.get("workerId")!=i)){DigiWebApp.RequestController.DatabaseServer=null;if(DigiWebApp.Booking.find().length>0)DigiWebApp.ApplicationController.nativeConfirmDialogView({title:M.I18N.l("hint"),message:M.I18N.l("openBookingsOverwriteBySettingsUpdate"),
callbacks:{confirm:{action:function(){DigiWebApp.ApplicationController.restartApp=YES;k.set("debug",a);k.set("treatAllAsTablet",b);k.set("treatAllAsPhone",c);k.set("daysToHoldBookingsOnDevice",f);k.set("company",e);k.set("password",g);k.set("connectionCode",h);k.set("settingsPassword",d);k.set("workerId",i);k.set("timeouthappened",j);k.set("skipEvents",l);k.set("platform",m);k.set("userAgent",n);k.set("mapType",o);k.set("autoSyncAfterBookTime",p);k.set("autoTransferAfterBookTime",q);k.set("autoTransferAfterClosingDay",
r);k.set("autoSaveGPSData",s);k.set("bautagebuchLimit_autoStartUhrzeit",y);k.set("GPSDataIsMandatory",x);k.set("remarkIsMandatory",u);k.set("remarkIsOptional",v);k.set("detailierteZeitdaten",w);k.set("useTransitionsSetting",t);k.set("datatransfer_min_delay",B);k.set("branding",C);k.set("GPSTimeOut",D);k.set("silentLoader",E);k.set("currentTimezoneOffset",F);k.set("currentTimezone",G);k.set("ServiceApp_ermittleGeokoordinate",z);k.set("ServiceApp_datenUebertragen",A);k.set("ServiceApp_engeKopplung",
H);k.set("ServiceApp_PORT",J);k.set("ServiceApp_FallBack",I);k.set("debugDatabaseServer",K);k.set("mitarbeiterVorname",L);k.set("mitarbeiterNachname",N);k.set("mitarbeiterId",O);k.set("auftragsDetailsKoppeln",P);k.set("vibrationsDauer",Q);DigiWebApp.SettingsController.saveSettings(k,YES);DigiWebApp.SettingsController.saveDone=YES}},cancel:{action:function(){DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("hint"),message:M.I18N.l("settingsUpdateCanceled"),callbacks:{confirm:{action:function(){DigiWebApp.SettingsController.featureAvailable("404")?
DigiWebApp.NavigationController.backToButtonDashboardPage():DigiWebApp.NavigationController.backToDashboardPage();DigiWebApp.SettingsController.saveDone=YES}}}})}}}});else{DigiWebApp.ApplicationController.restartApp=YES;k.set("debug",a);k.set("treatAllAsTablet",b);k.set("treatAllAsPhone",c);k.set("daysToHoldBookingsOnDevice",f);k.set("company",e);k.set("password",g);k.set("connectionCode",h);k.set("settingsPassword",d);k.set("workerId",i);k.set("timeouthappened",j);k.set("skipEvents",l);k.set("platform",
m);k.set("userAgent",n);k.set("mapType",o);k.set("autoSyncAfterBookTime",p);k.set("autoTransferAfterBookTime",q);k.set("autoTransferAfterClosingDay",r);k.set("autoSaveGPSData",s);k.set("bautagebuchLimit_autoStartUhrzeit",y);k.set("GPSDataIsMandatory",x);k.set("remarkIsMandatory",u);k.set("remarkIsOptional",v);k.set("detailierteZeitdaten",w);k.set("useTransitionsSetting",t);k.set("datatransfer_min_delay",B);k.set("branding",C);k.set("GPSTimeOut",D);k.set("silentLoader",E);k.set("currentTimezoneOffset",
F);k.set("currentTimezone",G);k.set("ServiceApp_ermittleGeokoordinate",z);k.set("ServiceApp_datenUebertragen",A);k.set("ServiceApp_engeKopplung",H);k.set("ServiceApp_PORT",J);k.set("ServiceApp_FallBack",I);k.set("debugDatabaseServer",K);k.set("mitarbeiterVorname",L);k.set("mitarbeiterNachname",N);k.set("mitarbeiterId",O);k.set("auftragsDetailsKoppeln",P);k.set("vibrationsDauer",Q);DigiWebApp.SettingsController.saveSettings(k,YES);DigiWebApp.SettingsController.saveDone=YES}}else{if(S){k.set("debug",
a);k.set("treatAllAsTablet",b);k.set("treatAllAsPhone",c);k.set("daysToHoldBookingsOnDevice",f);k.set("company",e);k.set("password",g);k.set("connectionCode",h);k.set("settingsPassword",d);k.set("workerId",i);k.set("timeouthappened",j);k.set("skipEvents",l);k.set("platform",m);k.set("userAgent",n);k.set("mapType",o);k.set("autoSyncAfterBookTime",p);k.set("autoTransferAfterBookTime",q);k.set("autoTransferAfterClosingDay",r);k.set("autoSaveGPSData",s);k.set("bautagebuchLimit_autoStartUhrzeit",y);k.set("GPSDataIsMandatory",
x);k.set("remarkIsMandatory",u);k.set("remarkIsOptional",v);k.set("detailierteZeitdaten",w);k.set("useTransitionsSetting",t);k.set("datatransfer_min_delay",B);k.set("branding",C);k.set("GPSTimeOut",D);k.set("silentLoader",E);k.set("currentTimezoneOffset",F);k.set("currentTimezone",G);k.set("ServiceApp_ermittleGeokoordinate",z);k.set("ServiceApp_datenUebertragen",A);k.set("ServiceApp_engeKopplung",H);k.set("ServiceApp_PORT",J);k.set("ServiceApp_FallBack",I);k.set("debugDatabaseServer",K);k.set("mitarbeiterVorname",
L);k.set("mitarbeiterNachname",N);k.set("mitarbeiterId",O);k.set("auftragsDetailsKoppeln",P);k.set("vibrationsDauer",Q);DigiWebApp.SettingsController.saveSettings(k,YES)}else{k.set("debug",a);k.set("treatAllAsTablet",b);k.set("treatAllAsPhone",c);k.set("daysToHoldBookingsOnDevice",f);k.set("company",e);k.set("password",g);k.set("connectionCode",h);k.set("settingsPassword",d);k.set("workerId",i);k.set("timeouthappened",j);k.set("skipEvents",l);k.set("platform",m);k.set("userAgent",n);k.set("mapType",
o);k.set("autoSyncAfterBookTime",p);k.set("autoTransferAfterBookTime",q);k.set("autoTransferAfterClosingDay",r);k.set("autoSaveGPSData",s);k.set("bautagebuchLimit_autoStartUhrzeit",y);k.set("GPSDataIsMandatory",x);k.set("remarkIsMandatory",u);k.set("remarkIsOptional",v);k.set("detailierteZeitdaten",w);k.set("useTransitionsSetting",t);k.set("datatransfer_min_delay",B);k.set("branding",C);k.set("GPSTimeOut",D);k.set("silentLoader",E);k.set("currentTimezoneOffset",F);k.set("currentTimezone",G);k.set("ServiceApp_ermittleGeokoordinate",
z);k.set("ServiceApp_datenUebertragen",A);k.set("ServiceApp_engeKopplung",H);k.set("ServiceApp_PORT",J);k.set("ServiceApp_FallBack",I);k.set("debugDatabaseServer",K);k.set("mitarbeiterVorname",L);k.set("mitarbeiterNachname",N);k.set("mitarbeiterId",O);k.set("auftragsDetailsKoppeln",P);k.set("vibrationsDauer",Q);DigiWebApp.SettingsController.saveSettings(k)}DigiWebApp.SettingsController.saveDone=YES}}else{k=DigiWebApp.Settings.createRecord({debug:a,treatAllAsTablet:b,treatAllAsPhone:c,daysToHoldBookingsOnDevice:f,
company:e,password:g,connectionCode:h,settingsPassword:d,workerId:i,timeouthappened:j,skipEvents:l,platform:m,userAgent:n,mapType:o,autoSyncAfterBookTime:p,autoTransferAfterBookTime:q,autoTransferAfterClosingDay:r,autoSaveGPSData:s,GPSDataIsMandatory:x,bautagebuchLimit_autoStartUhrzeit:y,remarkIsMandatory:u,remarkIsOptional:v,detailierteZeitdaten:w,useTransitionsSetting:t,datatransfer_min_delay:B,branding:C,GPSTimeOut:D,silentLoader:E,currentTimezoneOffset:F,currentTimezone:G,ServiceApp_ermittleGeokoordinate:z,
ServiceApp_datenUebertragen:A,ServiceApp_engeKopplung:H,ServiceApp_PORT:J,ServiceApp_FallBack:I,debugDatabaseServer:K,mitarbeiterVorname:L,mitarbeiterNachname:N,mitarbeiterId:O,auftragsDetailsKoppeln:P,vibrationsDauer:Q});DigiWebApp.SettingsController.saveSettings(k);DigiWebApp.SettingsController.saveDone=YES}}},cancel:{action:function(){DigiWebApp.SettingsController.saveDone=YES}}}})}},saveSettings:function(a,b,c,d){if(b){DigiWebApp.ApplicationController.deleteAllData();DigiWebApp.BookingController.currentBooking=
null;typeof DigiWebAppOrdinaryDesign.bookingPageWithIconsScholpp!=="undefined"?$("#"+DigiWebApp.BookingPageWithIconsScholpp.content.currentBookingLabel.id).html(""):$("#"+DigiWebApp.BookingPage.content.currentBookingLabel.id).html("")}if(a.save()){DigiWebApp.SettingsController.mitarbeiterNameVorname="";if(!d)if(b)DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("hint"),message:M.I18N.l("settingsSaveDoneReloadApp"),callbacks:{confirm:{action:function(){DigiWebApp.SettingsController.showCredentialsAlert=
NO;DigiWebApp.ApplicationController.init(true)}}}});else if(c){if(DigiWebApp.ApplicationController.profilingIntervalVar===null)if(DigiWebApp.ApplicationController.syncRunning!==YES)DigiWebApp.SettingsController.featureAvailable("404")?DigiWebApp.NavigationController.backToButtonDashboardPage():DigiWebApp.NavigationController.backToDashboardPage()}else DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("hint"),message:M.I18N.l("settingsSaveDone"),callbacks:{confirm:{action:function(){DigiWebApp.SettingsController.featureAvailable("404")?
DigiWebApp.NavigationController.backToButtonDashboardPage():DigiWebApp.NavigationController.backToDashboardPage()}}}})}else DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("error"),message:M.I18N.l("settingsSaveError")})},getSetting:function(a){var b=DigiWebApp.Settings.find()[0];if(typeof b!=="undefined"){var c=b.get(a);if(typeof c==="undefined"||c!==null&&typeof c["xsi:nil"]!=="undefined"&&(c["xsi:nil"]==="true"||c["xsi:nil"]===true))try{c=DigiWebApp.SettingsController.defaultsettings_object[a];
b.set(a,c)}catch(d){console.error("ERROR: setting.get for prop="+a)}return c}},setSetting:function(a,b){var c=DigiWebApp.Settings.find()[0];if(typeof c!=="undefined"){try{c.set(a,b)}catch(d){console.error("ERROR: setting.set for prop="+a)}a==="currentTimezoneOffset"||a==="currentTimezone"?DigiWebApp.SettingsController.saveSettings(c,NO,YES,YES):DigiWebApp.SettingsController.saveSettings(c,NO,YES)}},featureAvailable:function(a){if(typeof a!=="string")return false;if(a.length===0)return false;var b=
_.select(DigiWebApp.Features.find(),function(c){if(c)return c.get("id")===a})[0];return typeof b==="undefined"?false:b.get("isAvailable")==="true"},refreshMitarbeiterNameVorname:function(a,b){try{DigiWebApp.Anwesenheitsliste.find({urlParams:{},callbacks:{success:{action:function(d){try{_.each(d,function(e){try{if(e.get("geraeteId")===a)DigiWebApp.SettingsController.mitarbeiterNameVorname=e.get("nameVorname")}catch(g){console.error(g)}});b&&b()}catch(f){console.error(f)}}},error:{action:function(){}}}})}catch(c){console.error(c)}},
sendConfiguration:function(){var a=DigiWebApp.Settings.find();DigiWebApp.RequestController.sendConfiguration({settings:a,success:{target:this,action:function(){DigiWebApp.ApplicationController.profilingIntervalVar===null&&DigiWebApp.NavigationController.toBookTimePageTransition()}},error:{target:this,action:function(){}}})}});
DigiWebApp.BautagebuchBautageberichtDetailsController=M.Controller.extend({item:null,projektleiterId:null,projektleiterList:[{label:"",value:0}],mitarbeiterIds:null,mitarbeiterList:[{label:"",value:0}],mitarbeiterListSelected:null,datum:null,auftragsId:null,auftragsName:null,auftraegeList:[{label:"",value:0}],positionenList:null,latitude:null,longitude:null,wetter:null,setWetter:function(a){if(typeof a==="undefined")return NO;else{this.set("wetter",JSON.parse(JSON.stringify(a)));return YES}},startUhrzeit:null,
init:function(a){a&&this.setWetter(DigiWebApp.BautagebuchMainController.wetterDefaults)},load:function(a){this.set("item",a);this.set("datum",a.get("datum"));this.set("projektleiterId",a.get("projektleiterId"));this.set("auftragsId",a.get("orderId"));this.set("auftragsName",a.get("orderName"));this.set("mitarbeiterIds",a.get("selektierteMitarbeiter"));this.set("startUhrzeit",a.get("startUhrzeit"));this.setWetter(DigiWebApp.BautagebuchMainController.wetterDefaults);this.set("wetter.temperatur",a.get("temperatur"));
this.set("wetter.luftfeuchtigkeit",a.get("luftfeuchtigkeit"));this.set("wetter.bewoelkung",a.get("bewoelkung"));this.set("wetter.niederschlag",a.get("niederschlag"));this.set("wetter.wind",a.get("wind"));this.set("wetter.wechselhaft",a.get("wechselhaft"));this.set("wetter.wechselhaftItem",[{value:"wechselhaft",label:M.I18N.l("BautagebuchWechselhaft"),isSelected:a.get("wechselhaft")}]);this.setPositionen(a.get("orderId"))},save:function(a,b){var c=M.ViewManager.getView("bautagebuchBautageberichtDetailsPage",
"auftragComboBox").getSelection()!=="0",d=M.ViewManager.getView("bautagebuchBautageberichtDetailsPage","projektleiterComboBox").getSelection()!=="0",f=!(DigiWebApp.BautagebuchBautageberichtDetailsController.mitarbeiterIds===null||DigiWebApp.BautagebuchBautageberichtDetailsController.mitarbeiterIds.length===0);if(!d){DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("noProjektleiterSelected"),message:M.I18N.l("noProjektleiterSelectedMsg")});return false}if(!c){DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("noOrderSelected"),
message:M.I18N.l("noOrderSelectedMsg")});return false}if(!f){DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("noMitarbeiterSelected"),message:M.I18N.l("noMitarbeiterSelectedMsg")});return false}this.item.set("datum",this.datum);this.item.set("startUhrzeit",this.startUhrzeit);this.item.set("projektleiterId",this.projektleiterId);this.item.set("orderId",this.auftragsId);this.item.set("orderName",this.auftragsName);this.item.set("selektierteMitarbeiter",this.mitarbeiterIds);this.item.set("temperatur",
this.wetter.temperatur);this.item.set("luftfeuchtigkeit",this.wetter.luftfeuchtigkeit);this.item.set("bewoelkung",this.wetter.bewoelkung);this.item.set("niederschlag",this.wetter.niederschlag);this.item.set("wind",this.wetter.wind);this.item.set("wechselhaft",this.wetter.wechselhaft);if(this.item.saveSorted()){DigiWebApp.BautagebuchBautageberichteListeController.set("items",DigiWebApp.BautagebuchBautagesbericht.findSorted());typeof a==="function"&&a();return true}else{typeof b==="function"&&b();return false}},
deleteBautagesbericht:function(a){this.item.deleteSorted(function(){DigiWebApp.BautagebuchBautageberichteListeController.set("items",DigiWebApp.BautagebuchBautagesbericht.findSorted());typeof a==="function"&&a()})},finish:function(a,b){if(this.save()){DigiWebApp.BautagebuchZusammenfassungController.load(this.item);DigiWebApp.NavigationController.toBautagebuchZusammenfassungPageTransition();typeof a==="function"&&a();return true}else{typeof b==="function"&&b();return false}},setPositionen:function(a){if(typeof a===
"undefined")return false;else{var b=_.map(DigiWebApp.Position.find(),function(c){if(typeof c==="undefined")console.log("UNDEFINED Position");else if(c.get("orderId")===a)return{label:c.get("name"),value:c.get("id"),isSelected:NO}});b=_.compact(b);this.set("positionenList",b)}}});
DigiWebApp.CameraController=M.Controller.extend({orders:null,positions:null,activities:null,selections:{order:null,position:null,activity:null},loadedPicture:null,loadedFileName:null,fileType:null,init:function(){$("#"+DigiWebApp.CameraPage.content.remarkInput.id).val("");if(DigiWebApp.CameraController.loadedPicture===null){document.getElementById(DigiWebApp.CameraPage.content.image.id).src="";DigiWebApp.CameraController.myImageObj=new Image}typeof navigator.camera!=="undefined"&&typeof navigator.camera.getPicture!==
"undefined"&&DigiWebApp.CameraController.loadedPicture===null?DigiWebApp.CameraController.takePicture():DigiWebApp.CameraController.useLoadedPicture();DigiWebApp.BookingController.currentBooking?DigiWebApp.CameraController.setSelectionByCurrentBooking():DigiWebApp.CameraController.initSelection();this.saveSelection()},setSelectionByCurrentBooking:function(){var a=DigiWebApp.BookingController.currentBooking,b=DigiWebApp.HandOrder.findSorted().concat(DigiWebApp.Order.findSorted()),c=DigiWebApp.Position.findSorted(),
d=DigiWebApp.CameraController.getActivities(),f=(a.get("orderId")=="0"?0:a.get("orderId"))||a.get("handOrderId"),e=a.get("positionId"),g=a.get("activityId");a=_.map(b,function(i){return i.get("id")==f?{label:i.get("name"),value:i.get("id"),isSelected:YES}:{label:i.get("name"),value:i.get("id")}});a=_.compact(a);a.push({label:M.I18N.l("selectSomething"),value:"0"});c=_.map(c,function(i){if(i.get("orderId")===f){var j=null;return j=i.get("id")===e?{label:i.get("name"),value:i.get("id"),isSelected:YES}:
{label:i.get("name"),value:i.get("id")}}return null});c=_.compact(c);c.push({label:M.I18N.l("selectSomething"),value:"0"});d=_.select(DigiWebApp.WorkPlan.find(),function(i){if(i)return i.get("id")==e});var h=NO;d=d.length>0?this.getActivitiesFromWorkplan(d[0]):DigiWebApp.CameraController.getActivities();d=_.map(d,function(i){if(typeof i==="undefined"){console.log("UNDEFINED ACTIVITY");return null}else{var j=null;if(i.get("id")==g){j={label:i.get("name"),value:i.get("id"),isSelected:YES};h=YES}else j=
{label:i.get("name"),value:i.get("id")};return j}});d=_.compact(d);d.push({label:M.I18N.l("selectSomething"),value:"0",isSelected:!h});this.resetSelection();this.set("orders",a);this.set("positions",c);this.set("activities",d)},setPositions:function(){var a=M.ViewManager.getView("cameraPage","order").getSelection(YES).value;if(a){var b=DigiWebApp.Position.findSorted(),c=0;b=_.map(b,function(d){if(d.get("orderId")===a){d={label:d.get("name"),value:d.get("id")};if(c===0)d.isSelected=YES;c+=1;return d}return null});
b=_.compact(b);b.length<1&&b.push({label:M.I18N.l("noData"),value:"0"});M.ViewManager.getView("cameraPage","position").resetSelection();this.set("positions",b);this.setActivities(YES);this.saveSelection()}},setActivities:function(a){var b=null;if(a)if(a=M.ViewManager.getView("cameraPage","position").getSelection(YES))b=a.value;a=[];var c=[];_.each(DigiWebApp.WorkPlan.find(),function(g){parseInt(g.get("id"))===parseInt(b)&&c.push(g)});var d=0;a=c.length===1?this.getActivitiesFromWorkplan(c[0]):DigiWebApp.CameraController.getActivities();
var f=-1;if(typeof DigiWebApp.BookingController.currentBooking!=="undefined"&&DigiWebApp.BookingController.currentBooking!==null)f=DigiWebApp.BookingController.currentBooking.get("activityId");var e=false;_.each(a,function(g){if(typeof g==="undefined"){console.log("UNDEFINED ACTIVITY");return null}else if(g.get("id")===f)e=true});a=_.map(a,function(g){if(typeof g==="undefined"){console.log("UNDEFINED ACTIVITY");return null}else{var h=null;h=e?{label:g.get("name"),value:g.get("id"),isSelected:g.get("id")===
f?YES:NO}:{label:g.get("name"),value:g.get("id"),isSelected:d===0?YES:NO};d+=1;return h}});a=_.compact(a);a.length>0?a.push({label:M.I18N.l("selectSomething"),value:"0",isSelected:NO}):a.push({label:M.I18N.l("noData"),value:"0"});M.ViewManager.getView("cameraPage","activity").resetSelection();this.set("activities",a);this.saveSelection()},initSelection:function(){var a=DigiWebApp.HandOrder.findSorted().concat(DigiWebApp.Order.findSorted()),b=DigiWebApp.Position.findSorted(),c=DigiWebApp.CameraController.getActivities(),
d=[];if(a)d=_.map(a,function(f){if(f)return{label:f.get("name"),value:f.get("id")}});d.push({label:M.I18N.l("selectSomething"),value:"0",isSelected:YES});a=[];if(b)a=_.map(b,function(f){if(f)return{label:f.get("name"),value:f.get("id")}});a.push({label:M.I18N.l("selectSomething"),value:"0",isSelected:YES});b=[];if(c)b=_.map(c,function(f){if(typeof f==="undefined"){console.log("UNDEFINED ACTIVITY");return null}else return{label:f.get("name"),value:f.get("id")}});b.push({label:M.I18N.l("selectSomething"),
value:"0",isSelected:YES});this.resetSelection();this.set("orders",d);this.set("positions",a);this.set("activities",b);M.ViewManager.getView("cameraPage","order").setSelection("0");M.ViewManager.getView("cameraPage","position").setSelection("0");M.ViewManager.getView("cameraPage","activity").setSelection("0")},resetSelection:function(){M.ViewManager.getView("cameraPage","order").resetSelection();M.ViewManager.getView("cameraPage","position").resetSelection();M.ViewManager.getView("cameraPage","activity").resetSelection()},
isPositionSelected:function(){var a=M.ViewManager.getView("cameraPage","position").getSelection(YES);return a&&a.value!="0"?YES:NO},isActivitySelected:function(){var a=M.ViewManager.getView("cameraPage","activity").getSelection(YES);return a&&a.value!="0"?YES:NO},saveSelection:function(){var a=M.ViewManager.getView("cameraPage","order").getSelection(),b=M.ViewManager.getView("cameraPage","position").getSelection(),c=M.ViewManager.getView("cameraPage","activity").getSelection();this.selections.order=
a;this.selections.position=b;this.selections.activity=c;this.useSelections=YES},getActivities:function(a){a=a?DigiWebApp.Activity.find(a):DigiWebApp.Activity.findSorted();a=_.map(a,function(b){return parseInt(b.get("positionId"))===1?b:null});return a=_.compact(a)},getActivitiesFromWorkplan:function(a){var b=a.get("activityIds").split(","),c=[];if(b&&b.length>0)for(var d=0;d<b.length;d++)c.push(_.first(DigiWebApp.Activity.find({query:{identifier:"id",operator:"=",value:b[d]}})));if(parseInt(a.get("workplanType"))===
1)c=_.map(c,function(f){if(typeof f==="undefined"){console.log("UNDEFINED ACTIVITY");return null}else{var e=NO,g=DigiWebApp.Activity.findSorted();_.each(g,function(h){if(parseInt(h.get("positionId"))===1)e=YES});return e?f:null}});return c=_.compact(c)},takePicture:function(){navigator.camera.getPicture(DigiWebApp.CameraController.cameraSuccessBase64,DigiWebApp.CameraController.cameraError,{quality:40,allowEdit:true,destinationType:navigator.camera.DestinationType.DATA_URL,encodingType:navigator.camera.EncodingType.JPEG,
sourceType:navigator.camera.PictureSourceType.CAMERA,mediaType:navigator.camera.MediaType.PICTURE,saveToPhotoAlbum:false})},useLoadedPicture:function(){document.getElementById(DigiWebApp.CameraPage.content.image.id).src=DigiWebApp.CameraController.loadedPicture;DigiWebApp.CameraController.myImageObj=new Image;DigiWebApp.CameraController.myImageObj.src=DigiWebApp.CameraController.loadedPicture},savePicture:function(){this.savePictureWithLocation(null)},savePictureWithLocation:function(a){this.saveSelection();
var b=M.ViewManager.getView("cameraPage","order").getSelection(),c=M.ViewManager.getView("cameraPage","position").getSelection(YES);c=c?c.value:null;var d=M.ViewManager.getView("cameraPage","activity").getSelection(YES);d=d?d.value:null;var f=null,e=null;if(DigiWebApp.BookingController.isHandOrder(b)){f=b;e=_.select(DigiWebApp.HandOrder.findSorted(),function(q){if(q)return q.get("id")===b||q.get("name")===b})[0].get("name");b=f;c=null}var g="0",h="0";if(a){if(a.latitude)g=a.latitude;if(a.longitude)h=
a.longitude}var i=this.newMediaFile({oId:b,hoId:f,hoName:e,lat:g,lon:h,pId:c,aId:d,mId:DigiWebApp.SettingsController.getSetting("mitarbeiterId")});i.setRemark(M.ViewManager.getView("cameraPage","remarkInput").value);a=document.getElementById(DigiWebApp.CameraPage.content.image.id);i.set("fileType",DigiWebApp.CameraController.get("fileType"));c=M.I18N.l("notDefined");d=M.I18N.l("notDefined");f=M.I18N.l("notDefined");try{var j=i.get("orderId"),l=i.get("handOrderId");if(j!==null||l!=null){var m=_.select(DigiWebApp.Order.findSorted().concat(DigiWebApp.HandOrder.findSorted()),
function(q){if(q){q=q.get("id");return j==q||l==q}});if(m&&m.length>0){m=m[0];c=m.get("name")}}}catch(n){console.error(n)}try{if(parseInt(i.get("positionId"))!==0)d=_.find(DigiWebApp.Position.find(),function(q){return parseInt(q.get("id"))===parseInt(i.get("positionId"))}).get("name")}catch(o){console.error(o)}try{if(parseInt(i.get("activityId"))!==0)f=_.find(DigiWebApp.Activity.find(),function(q){return parseInt(q.get("id"))===parseInt(i.get("activityId"))}).get("name")}catch(p){console.error(p)}i.set("orderName",
c);i.set("positionName",d);i.set("activityName",f);i.save();i.saveToFile(a.src,DigiWebApp.NavigationController.backToMediaListPageTransition)},newMediaFile:function(a){return DigiWebApp.MediaFile.createRecord({orderId:a.oId?a.oId:"0",handOrderId:a.hoId?a.hoId:"0",handOrderName:a.hoName?a.hoName:"0",latitude:a.lat?a.lat:"0",longitude:a.lon?a.lon:"0",positionId:a.pId?a.pId:"0",activityId:a.aId?a.aId:"0",mitarbeiterId:a.mId?a.mId:"0",icon:"icon_takePicture.png",timeStamp:+new Date})},myImageData:null,
myImageObj:null,cameraSuccessBase64:function(a){DigiWebApp.CameraController.myImageData=a;document.getElementById(DigiWebApp.CameraPage.content.image.id).src="data:"+DigiWebApp.ApplicationController.CONSTImageFiletype+","+a;DigiWebApp.CameraController.myImageObj=new Image;DigiWebApp.CameraController.myImageObj.src="data:"+DigiWebApp.ApplicationController.CONSTImageFiletype+","+a;DigiWebApp.CameraController.set("fileType",DigiWebApp.ApplicationController.CONSTImageFiletype)},myImageURI:null,cameraSuccessURI:function(a){DigiWebApp.CameraController.myImageURI=
a;document.getElementById(DigiWebApp.CameraPage.content.image.id).src=a},cameraError:function(){DigiWebApp.NavigationController.backToMediaListPageTransition()}});
DigiWebApp.BautagebuchMedienListeController=M.Controller.extend({items:null,init:function(){this.set("items",DigiWebApp.BautagebuchMediaFile.findSorted(DigiWebApp.BautagebuchBautageberichtDetailsController.item.m_id))},neu:function(){var a=this;M.DialogView.actionSheet({title:M.I18N.l("newMedia"),cancelButtonValue:M.I18N.l("cancel"),otherButtonValues:[M.I18N.l("photo")],otherButtonTags:["photo"],callbacks:{other:{action:function(b){switch(b){case "audio":DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("notImplemented"),
message:M.I18N.l("notImplementedMsg")});break;case "photo":DigiWebApp.BautagebuchMedienDetailsController.set("item",DigiWebApp.BautagebuchMediaFile.createRecord({bautagesberichtId:DigiWebApp.BautagebuchBautageberichtDetailsController.item.m_id,fileType:DigiWebApp.ApplicationController.CONSTImageFiletype}));DigiWebApp.BautagebuchMedienDetailsController.set("positionId",null);DigiWebApp.BautagebuchMedienDetailsController.set("positionName",null);DigiWebApp.BautagebuchMedienDetailsController.set("activityId",
null);DigiWebApp.BautagebuchMedienDetailsController.set("activityName",null);DigiWebApp.BautagebuchMedienDetailsController.set("data",null);DigiWebApp.BautagebuchMedienDetailsController.set("remark",null);DigiWebApp.BautagebuchMedienDetailsController.set("fileType",DigiWebApp.ApplicationController.CONSTImageFiletype);M.DialogView.actionSheet({title:M.I18N.l("takePicture"),cancelButtonValue:M.I18N.l("cancel"),otherButtonValues:[M.I18N.l("library"),M.I18N.l("camera")],otherButtonTags:["library","camera"],
callbacks:{other:{action:function(c){switch(c){case "library":if(typeof navigator.camera!=="undefined"&&typeof navigator.camera.getPicture!=="undefined")navigator.camera.getPicture(function(d){var f=DigiWebApp.BautagebuchMedienDetailsController,e=document.getElementById(DigiWebApp.BautagebuchMedienDetailsPage.content.image.id);e.src=d.indexOf("data:")===0?d:"data:"+DigiWebApp.ApplicationController.CONSTImageFiletype+","+d;f.set("data",e.src);f.set("fileType",DigiWebApp.ApplicationController.CONSTImageFiletype);
DigiWebApp.NavigationController.toBautagebuchMedienDetailsPageTransition()},function(d){DigiWebApp.BautagebuchMedienDetailsController.set("data",null);DigiWebApp.BautagebuchMedienDetailsController.set("fileType",null);DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("error"),message:M.I18N.l("noPicLoaded")+": "+d})},{quality:40,allowEdit:true,destinationType:navigator.camera.DestinationType.DATA_URL,encodingType:navigator.camera.EncodingType.JPEG,sourceType:navigator.camera.PictureSourceType.PHOTOLIBRARY,
mediaType:navigator.camera.MediaType.PICTURE,saveToPhotoAlbum:false});else{DigiWebApp.FileChooserPage.set("successCallback",function(d,f){if(d!==null){var e=document.getElementById(DigiWebApp.BautagebuchMedienDetailsPage.content.image.id);DigiWebApp.BautagebuchMedienDetailsController.set("loadedFileName",f);for(var g="",h=f,i=0;i!==-1;){h=h.substr(i+1);i=h.indexOf(".")}h=h.toLowerCase();switch(h){case "jpg":g="image/jpeg";break;case "jpeg":g="image/"+h;break;case "png":g="image/"+h;break;case "bmp":g=
"image/"+h}switch(g){case "":a.set("loadedPicture",null);a.set("fileType",null);DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("error"),message:M.I18N.l("noPicLoaded")});break;default:a.set("fileType",g);e.src=d.indexOf("data:")===0?d:"data:"+g+","+d;a.set("data",e.src);DigiWebApp.NavigationController.toBautagebuchMedienDetailsPageTransition()}}else{a.set("data",null);a.set("loadedFileName",null);a.set("fileType",null);DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("error"),
message:M.I18N.l("noPicLoaded")})}});DigiWebApp.NavigationController.toFileChooserPageTransition()}break;case "camera":DigiWebApp.BautagebuchMedienDetailsController.takePicture();break;default:console.log("unknonw ButtonTag")}}},cancel:{action:function(){}}}});break;case "video":DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("notImplemented"),message:M.I18N.l("notImplementedMsg")});break;case "other":DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("notImplemented"),
message:M.I18N.l("notImplementedMsg")});break;default:console.log("unknonw ButtonTag")}}},cancel:{action:function(){}}}})}});
DigiWebApp.BautagebuchMaterialienDetailsPage=M.PageView.design({events:{pagebeforeshow:{action:function(){var a=NO,b=JSON.parse(JSON.stringify(DigiWebApp.BautagebuchBautageberichtDetailsController.positionenList));_.each(b,function(c){c.isSelected=parseInt(c.value)!==0?NO:YES});b=_.map(b,function(c){if(typeof c==="undefined")console.log("UNDEFINED position");else{if(DigiWebApp.BautagebuchMaterialienDetailsController.positionId){c.isSelected=c.value===DigiWebApp.BautagebuchMaterialienDetailsController.positionId;
if(c.isSelected)a=YES}return c}});b=_.compact(b);if(b.length!==1)b.push({label:M.I18N.l("selectSomething"),value:"0",isSelected:!a});else{DigiWebApp.BautagebuchMaterialienDetailsController.set("positionId",b[0].value);DigiWebApp.BautagebuchMaterialienDetailsController.set("positionName",b[0].label)}DigiWebApp.BautagebuchMaterialienDetailsController.set("positionenList",b);DigiWebApp.BautagebuchMaterialienDetailsController.setTaetigkeiten(DigiWebApp.BautagebuchMaterialienDetailsController.positionId);
b=JSON.parse(JSON.stringify(DigiWebApp.BautagebuchMainController.materialien));_.each(b,function(c){c.isSelected=parseInt(c.value)!==0?NO:YES});b=_.map(b,function(c){if(typeof c==="undefined")console.log("UNDEFINED material");else{if(DigiWebApp.BautagebuchMaterialienDetailsController.materialId&&DigiWebApp.BautagebuchMaterialienDetailsController.materialId!=="0"&&DigiWebApp.BautagebuchMaterialienDetailsController.materialId!==null&&DigiWebApp.BautagebuchMaterialienDetailsController.materialId!==""){c.isSelected=
c.value===DigiWebApp.BautagebuchMaterialienDetailsController.materialId;$("#"+DigiWebApp.BautagebuchMaterialienDetailsPage.content.materialInput.id).hide();$("#"+DigiWebApp.BautagebuchMaterialienDetailsPage.content.materialInput.id).parent().addClass("transparent")}else{$("#"+DigiWebApp.BautagebuchMaterialienDetailsPage.content.materialInput.id).show();$("#"+DigiWebApp.BautagebuchMaterialienDetailsPage.content.materialInput.id).parent().removeClass("transparent");M.ViewManager.getView("bautagebuchMaterialienDetailsPage",
"materialInput").setValue(DigiWebApp.BautagebuchMaterialienDetailsController.artikel)}return c}});b=_.compact(b);DigiWebApp.BautagebuchMaterialienDetailsController.set("materialienList",b);b=JSON.parse(JSON.stringify(DigiWebApp.BautagebuchMainController.mengeneinheiten));_.each(b,function(c){c.isSelected=parseInt(c.value)!==0?NO:YES});b=_.map(b,function(c){if(typeof c==="undefined")console.log("UNDEFINED mengeneinheit");else{if(DigiWebApp.BautagebuchMaterialienDetailsController.mengeneinheitId&&DigiWebApp.BautagebuchMaterialienDetailsController.mengeneinheitId!==
"0"&&DigiWebApp.BautagebuchMaterialienDetailsController.mengeneinheitId!==null){c.isSelected=c.value===DigiWebApp.BautagebuchMaterialienDetailsController.mengeneinheitId;$("#"+DigiWebApp.BautagebuchMaterialienDetailsPage.content.mengeneinheitInput.id).hide();$("#"+DigiWebApp.BautagebuchMaterialienDetailsPage.content.mengeneinheitInput.id).parent().addClass("transparent")}else{$("#"+DigiWebApp.BautagebuchMaterialienDetailsPage.content.mengeneinheitInput.id).show();$("#"+DigiWebApp.BautagebuchMaterialienDetailsPage.content.mengeneinheitInput.id).parent().removeClass("transparent");
M.ViewManager.getView("bautagebuchMaterialienDetailsPage","mengeneinheitInput").setValue(DigiWebApp.BautagebuchMaterialienDetailsController.einheit)}return c}});b=_.compact(b);DigiWebApp.BautagebuchMaterialienDetailsController.set("mengeneinheitenList",b);M.ViewManager.getView("bautagebuchMaterialienDetailsPage","mengenInput").setValue(DigiWebApp.BautagebuchMaterialienDetailsController.menge);if(DigiWebApp.BautagebuchBautageberichtDetailsController.item.get("abgeschlossen")){$("#"+DigiWebApp.BautagebuchMaterialienDetailsPage.content.speichernButton.id).hide();
$("#"+DigiWebApp.BautagebuchMaterialienDetailsPage.header.delButton.id).hide()}else{$("#"+DigiWebApp.BautagebuchMaterialienDetailsPage.content.speichernButton.id).show();$("#"+DigiWebApp.BautagebuchMaterialienDetailsPage.header.delButton.id).show()}}},pagehide:{action:function(){}}},cssClass:"bautagebuchMaterialienDetailsPage",childViews:"header content",header:M.ToolbarView.design({childViews:"backButton title delButton",cssClass:"header unselectable",isFixed:YES,backButton:M.ButtonView.design({value:M.I18N.l("back"),
icon:"arrow-l",anchorLocation:M.LEFT,events:{tap:{action:function(){try{DigiWebApp.ApplicationController.vibrate()}catch(a){}history.back()}}}}),title:M.LabelView.design({value:M.I18N.l("BautagebuchMaterial"),anchorLocation:M.CENTER}),delButton:M.ButtonView.design({value:M.I18N.l("BautagebuchDelete"),icon:"delete",anchorLocation:M.RIGHT,events:{tap:{target:DigiWebApp.BautagebuchMaterialienDetailsController,action:function(){try{DigiWebApp.ApplicationController.vibrate()}catch(a){}this.deleteMaterialbuchung()}}}}),
anchorLocation:M.TOP}),content:M.ScrollView.design({childViews:"positionComboBox activityComboBox materialComboBox materialInput spacer1 mengeneinheitComboBox mengeneinheitInput spacer2 mengenInput spacer3 speichernButton",cssClass:"content",spacer1:M.LabelView.design({value:"&nbsp;<br>"}),spacer2:M.LabelView.design({value:"&nbsp;<br>"}),spacer3:M.LabelView.design({value:"&nbsp;<br>"}),positionComboBox:M.SelectionListView.design({selectionMode:M.SINGLE_SELECTION_DIALOG,initialText:M.I18N.l("noData"),
label:M.I18N.l("position"),applyTheme:NO,contentBinding:{target:DigiWebApp.BautagebuchMaterialienDetailsController,property:"positionenList"},events:{change:{action:function(){DigiWebApp.BautagebuchMaterialienDetailsController.set("positionId",M.ViewManager.getView("bautagebuchMaterialienDetailsPage","positionComboBox").getSelection(YES).value);DigiWebApp.BautagebuchMaterialienDetailsController.set("positionName",M.ViewManager.getView("bautagebuchMaterialienDetailsPage","positionComboBox").getSelection(YES).label);
DigiWebApp.BautagebuchMaterialienDetailsController.setTaetigkeiten(M.ViewManager.getView("bautagebuchMaterialienDetailsPage","positionComboBox").getSelection(YES).value)}}}}),activityComboBox:M.SelectionListView.design({selectionMode:M.SINGLE_SELECTION_DIALOG,initialText:M.I18N.l("noData"),label:M.I18N.l("activity"),applyTheme:NO,contentBinding:{target:DigiWebApp.BautagebuchMaterialienDetailsController,property:"activityList"},events:{change:{action:function(){DigiWebApp.BautagebuchMaterialienDetailsController.set("activityId",
M.ViewManager.getView("bautagebuchMaterialienDetailsPage","activityComboBox").getSelection(YES).value);DigiWebApp.BautagebuchMaterialienDetailsController.set("activityName",M.ViewManager.getView("bautagebuchMaterialienDetailsPage","activityComboBox").getSelection(YES).label)}}}}),materialComboBox:M.SelectionListView.design({selectionMode:M.SINGLE_SELECTION_DIALOG,initialText:M.I18N.l("noData"),label:M.I18N.l("BautagebuchMaterial"),applyTheme:NO,contentBinding:{target:DigiWebApp.BautagebuchMaterialienDetailsController,
property:"materialienList"},events:{change:{action:function(a){DigiWebApp.BautagebuchMaterialienDetailsController.set("materialId",M.ViewManager.getView("bautagebuchMaterialienDetailsPage","materialComboBox").getSelection(YES).value);if(a===0||parseInt(a)===0){$("#"+DigiWebApp.BautagebuchMaterialienDetailsPage.content.materialInput.id).show();$("#"+DigiWebApp.BautagebuchMaterialienDetailsPage.content.materialInput.id).parent().removeClass("transparent")}else{$("#"+DigiWebApp.BautagebuchMaterialienDetailsPage.content.materialInput.id).hide();
$("#"+DigiWebApp.BautagebuchMaterialienDetailsPage.content.materialInput.id).parent().addClass("transparent");DigiWebApp.BautagebuchMaterialienDetailsController.set("artikel",M.ViewManager.getView("bautagebuchMaterialienDetailsPage","materialComboBox").getSelection(YES).label)}}}}}),materialInput:M.TextFieldView.design({events:{keyup:{action:function(){DigiWebApp.BautagebuchMaterialienDetailsController.set("artikel",M.ViewManager.getView("bautagebuchMaterialienDetailsPage","materialInput").getValue())}}}}),
mengeneinheitComboBox:M.SelectionListView.design({selectionMode:M.SINGLE_SELECTION_DIALOG,initialText:M.I18N.l("noData"),label:M.I18N.l("BautagebuchMengeneinheit"),applyTheme:NO,contentBinding:{target:DigiWebApp.BautagebuchMaterialienDetailsController,property:"mengeneinheitenList"},events:{change:{action:function(a){DigiWebApp.BautagebuchMaterialienDetailsController.set("mengeneinheitId",M.ViewManager.getView("bautagebuchMaterialienDetailsPage","mengeneinheitComboBox").getSelection(YES).value);if(a===
0||parseInt(a)===0){$("#"+DigiWebApp.BautagebuchMaterialienDetailsPage.content.mengeneinheitInput.id).show();$("#"+DigiWebApp.BautagebuchMaterialienDetailsPage.content.mengeneinheitInput.id).parent().removeClass("transparent")}else{$("#"+DigiWebApp.BautagebuchMaterialienDetailsPage.content.mengeneinheitInput.id).hide();$("#"+DigiWebApp.BautagebuchMaterialienDetailsPage.content.mengeneinheitInput.id).parent().addClass("transparent");a=M.ViewManager.getView("bautagebuchMaterialienDetailsPage","mengeneinheitComboBox").getSelection(YES).value;
a=DigiWebApp.BautagebuchMengeneinheit.findSorted(a)[0].get("kuerzel");DigiWebApp.BautagebuchMaterialienDetailsController.set("einheit",a)}}}}}),mengeneinheitInput:M.TextFieldView.design({events:{keyup:{action:function(){DigiWebApp.BautagebuchMaterialienDetailsController.set("einheit",M.ViewManager.getView("bautagebuchMaterialienDetailsPage","mengeneinheitInput").getValue())}}}}),mengenInput:M.TextFieldView.design({inputType:M.INPUT_NUMBER,label:M.I18N.l("BautagebuchMenge"),events:{keyup:{action:function(){DigiWebApp.BautagebuchMaterialienDetailsController.set("menge",
M.ViewManager.getView("bautagebuchMaterialienDetailsPage","mengenInput").getValue())}}}}),speichernButton:M.ButtonView.design({value:M.I18N.l("save"),events:{tap:{target:DigiWebApp.BautagebuchMaterialienDetailsController,action:"save"}}})})});
DigiWebApp.AnwesenheitslisteTemplateView=M.ListItemView.design({isSelectable:YES,childViews:"farbeAnwesenheit nameVorname spacer1 datumLabel datum uhrzeit spacer2 fehlzeitBezeichnung auftragsBezeichnung positionsBezeichnung handauftragsBezeichnung taetigkeit gpsBreite gpsLaenge spacer3 gpsBreitePosition gpsLaengePosition",events:{tap:{action:function(a){var b=M.ViewManager.getViewById(a).modelId,c=NO;_.each(DigiWebApp.AnwesenheitslisteController.items,function(d){if(d.m_id===b)if(d.get("datum")!==
"-"){DigiWebApp.ZeitbuchungenController.set("datum",d.get("datum"));DigiWebApp.ZeitbuchungenController.set("mitarbeiterID",d.get("mitarbeiterId"));DigiWebApp.ZeitbuchungenController.set("mitarbeiterNameVorname",d.get("nameVorname"));c=YES}});c===YES&&DigiWebApp.NavigationController.toZeitbuchungenPageTransition()}}},spacer1:M.LabelView.design({cssClass:"unselectable marginBottom12",value:" "}),spacer2:M.LabelView.design({cssClass:"unselectable marginBottom12",value:" "}),spacer3:M.LabelView.design({cssClass:"unselectable",
value:" "}),datumLabel:M.LabelView.design({cssClass:"normal unselectable",isInline:YES,computedValue:{valuePattern:"<%= datumLabel %>",operation:function(a){return a}}}),datum:M.LabelView.design({cssClass:"normal unselectable",isInline:YES,computedValue:{valuePattern:"<%= datum %>",operation:function(a){return a!=="-"?a:""}}}),farbeAmpel:M.LabelView.design({cssClass:"unselectable",computedValue:{valuePattern:"<%= farbeAmpel %>",operation:function(a){return a}}}),farbeAnwesenheit:M.LabelView.design({cssClass:"unselectable",
isInline:YES,computedValue:{valuePattern:"<%= farbeAnwesenheit %>",operation:function(a){return'<span style="box-shadow: 2px 2px 6px rgba(0,0,0,0.6);background:'+a+";color:"+a+';margin-right: 5px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>&nbsp;&nbsp;'}}}),fehlzeitBezeichnung:M.LabelView.design({cssClass:"normal unselectable",computedValue:{valuePattern:"<%= fehlzeitBezeichnung %>",operation:function(a){return a!==""&&typeof a!=="undefined"&&a!=="undefined"&&a!=="-"&&a!=="null"&&a!==null?M.I18N.l("fehlzeit")+
": "+a:""}}}),gpsBreite:M.LabelView.design({cssClass:"normal unselectable",isInline:YES,computedValue:{valuePattern:"<%= gpsBreite %>",operation:function(a){if(a!="0.0"&&a!=="null"&&a!==null){a=new Number(a);return M.I18N.l("buchungskoordinaten")+": "+a.toFixed(4)}else return""}}}),gpsBreitePosition:M.LabelView.design({cssClass:"normal unselectable",isInline:YES,computedValue:{valuePattern:"<%= gpsBreitePosition %>",operation:function(a){if(a!="0.0"&&a!=="null"&&a!==null){a=new Number(a);return M.I18N.l("auftragskoordinaten")+
": "+a.toFixed(4)}else return""}}}),gpsLaenge:M.LabelView.design({cssClass:"normal unselectable",isInline:YES,computedValue:{valuePattern:"<%= gpsLaenge %>",operation:function(a){return a!="0.0"&&a!=="null"&&a!==null?", "+(new Number(a)).toFixed(4):""}}}),gpsLaengePosition:M.LabelView.design({cssClass:"normal unselectable",isInline:YES,computedValue:{valuePattern:"<%= gpsLaengePosition %>",operation:function(a){return a!="0.0"&&a!=="null"&&a!==null?", "+(new Number(a)).toFixed(4):""}}}),handauftragsBezeichnung:M.LabelView.design({cssClass:"normal unselectable",
computedValue:{valuePattern:"<%= handauftragsBezeichnung %>",operation:function(a){return a!==""&&typeof a!=="undefined"&&a!=="undefined"&&a!=="-"&&a!=="null"&&a!==null?M.I18N.l("handApplications")+": "+a:""}}}),handauftragsId:M.LabelView.design({cssClass:"unselectable",computedValue:{valuePattern:"<%= handauftragsId %>",operation:function(a){return a}}}),mitarbeiterId:M.LabelView.design({cssClass:"unselectable",computedValue:{valuePattern:"<%= mitarbeiterId %>",operation:function(a){return a}}}),
name:M.LabelView.design({cssClass:"bold unselectable",computedValue:{valuePattern:"<%= name %>",operation:function(a){return a}}}),nameVorname:M.LabelView.design({cssClass:"bold unselectable",isInline:YES,computedValue:{valuePattern:"<%= nameVorname %>",operation:function(a){return a}}}),auftragsBezeichnung:M.LabelView.design({cssClass:"normal unselectable",computedValue:{valuePattern:"<%= auftragsBezeichnung %>",operation:function(a){return a!==""&&typeof a!=="undefined"&&a!=="undefined"&&a!=="-"&&
a!=="null"&&a!==null?M.I18N.l("order")+": "+a:""}}}),positionsBezeichnung:M.LabelView.design({cssClass:"normal unselectable",computedValue:{valuePattern:"<%= positionsBezeichnung %>",operation:function(a){return a!==""&&typeof a!=="undefined"&&a!=="undefined"&&a!=="-"&&a!=="null"&&a!==null?M.I18N.l("position")+": "+a:""}}}),positionsId:M.LabelView.design({cssClass:"unselectable",computedValue:{valuePattern:"<%= positionsId %>",operation:function(a){return a}}}),taetigkeit:M.LabelView.design({cssClass:"normal unselectable",
computedValue:{valuePattern:"<%= taetigkeit %>",operation:function(a){return a!==""&&typeof a!=="undefined"&&a!=="undefined"&&a!=="-"&&a!=="null"&&a!==null?M.I18N.l("activity")+": "+a:""}}}),taetigkeitsId:M.LabelView.design({cssClass:"unselectable",computedValue:{valuePattern:"<%= taetigkeitsId %>",operation:function(a){return a}}}),taetigkeitsart:M.LabelView.design({cssClass:"unselectable",computedValue:{valuePattern:"<%= taetigkeitsart %>",operation:function(a){return a}}}),uhrzeit:M.LabelView.design({cssClass:"normal unselectable",
isInline:YES,computedValue:{valuePattern:"<%= uhrzeit %>",operation:function(a){return a!==""&&typeof a!=="undefined"&&a!=="undefined"&&a!=="-"&&a!=="null"&&a!==null?" "+a:""}}}),vorname:M.LabelView.design({cssClass:"bold unselectable",computedValue:{valuePattern:"<%= vorname %>",operation:function(a){return a}}})});m_require("app/views/AnwesenheitslisteTemplateView");
DigiWebApp.AnwesenheitslistePage=M.PageView.design({events:{pagebeforeshow:{target:DigiWebApp.AnwesenheitslisteController,action:"init"}},childViews:"header content",cssClass:"anwesenheitslistePage unselectable",header:M.ToolbarView.design({childViews:"backButton title refreshButton",cssClass:"header unselectable",isFixed:YES,backButton:M.ButtonView.design({value:M.I18N.l("back"),icon:"arrow-l",anchorLocation:M.LEFT,events:{tap:{target:DigiWebApp.NavigationController,action:function(){try{DigiWebApp.ApplicationController.vibrate()}catch(a){}this.backToDashboardPage()}}}}),
title:M.LabelView.design({value:M.I18N.l("Anwesenheitsliste"),anchorLocation:M.CENTER}),refreshButton:M.ButtonView.design({value:M.I18N.l("refresh"),icon:"refresh",anchorLocation:M.RIGHT,events:{tap:{action:function(){try{DigiWebApp.ApplicationController.vibrate()}catch(a){}DigiWebApp.AnwesenheitslisteController.set("items",{});DigiWebApp.AnwesenheitslisteController.items=null;DigiWebApp.AnwesenheitslisteController.init()}}}}),anchorLocation:M.TOP}),content:M.ScrollView.design({childViews:"list",
list:M.ListView.design({contentBinding:{target:DigiWebApp.AnwesenheitslisteController,property:"items"},listItemTemplateView:DigiWebApp.AnwesenheitslisteTemplateView})})});
DigiWebApp.BautagebuchWetterPage=M.PageView.design({events:{pagebeforeshow:{action:function(){}},pagehide:{action:function(){}}},cssClass:"bautagebuchWetterPage",childViews:"header content",header:M.ToolbarView.design({childViews:"backButton title",cssClass:"header unselectable",isFixed:YES,backButton:M.ButtonView.design({value:M.I18N.l("back"),icon:"arrow-l",anchorLocation:M.LEFT,events:{tap:{target:DigiWebApp.NavigationController,action:function(){try{DigiWebApp.ApplicationController.vibrate()}catch(a){}this.backToBautagebuchBautageberichtDetailsPageTransition()}}}}),
title:M.LabelView.design({value:M.I18N.l("BautagebuchWetter"),anchorLocation:M.CENTER}),delButton:M.ButtonView.design({value:M.I18N.l("BautagebuchDelete"),icon:"delete",anchorLocation:M.RIGHT,events:{tap:{}}}),anchorLocation:M.TOP}),content:M.ScrollView.design({childViews:"temperaturView luftfeuchteView bewoelkungView niederschlagView windView wechselhaftCheckbox speichernButton",cssClass:"content",spacer1:M.LabelView.design({value:"&nbsp;"}),wechselhaftCheckbox:M.SelectionListView.design({selectionMode:M.MULTIPLE_SELECTION,
contentBinding:{target:DigiWebApp.BautagebuchBautageberichtDetailsController,property:"wetter.wechselhaftItem"},events:{change:{target:DigiWebApp.BautagebuchBautageberichtDetailsController,action:function(a){this.wetter.wechselhaft=a.length===1;this.wetter.wechselhaftItem.isSelected=a.length===1}}}}),temperaturView:M.ContainerView.design({childViews:"myLabel mySliderGrid",cssClass:"temperaturView",myLabel:M.LabelView.design({cssClass:"whiteText marginBottom5px",value:M.I18N.l("BautagebuchTemperatur")}),
mySliderGrid:M.GridView.design({childViews:"mySlider TextValue",layout:M.TWO_COLUMNS,mySlider:M.SliderView.design({min:-50,max:50,isSliderOnly:YES,highlightLeftPart:NO,contentBinding:{target:DigiWebApp.BautagebuchBautageberichtDetailsController,property:"wetter.temperatur"},events:{change:{action:function(a,b){var c=DigiWebApp.BautagebuchWetterPage.content.temperaturView.mySliderGrid;if(c.mySlider.id!==b)return true;else{c.TextValue.computedValue.value=parseInt(a);c.TextValue.computeValue();c.TextValue.renderUpdate();
DigiWebApp.BautagebuchBautageberichtDetailsController.wetter.temperatur=parseInt(a)}}}}}),TextValue:M.LabelView.design({cssClass:"whiteText centerText",computedValue:{contentBinding:{target:DigiWebApp.BautagebuchBautageberichtDetailsController,property:"wetter.temperatur"},value:0,operation:function(a){return a+"\u00b0C"}}})})}),luftfeuchteView:M.ContainerView.design({childViews:"myLabel mySliderGrid",cssClass:"luftfeuchteView",myLabel:M.LabelView.design({cssClass:"whiteText marginBottom5px",value:M.I18N.l("BautagebuchLuftfeuchtigkeit")}),
mySliderGrid:M.GridView.design({childViews:"mySlider TextValue",layout:M.TWO_COLUMNS,mySlider:M.SliderView.design({min:0,max:100,isSliderOnly:YES,highlightLeftPart:NO,contentBinding:{target:DigiWebApp.BautagebuchBautageberichtDetailsController,property:"wetter.luftfeuchtigkeit"},events:{change:{action:function(a,b){var c=DigiWebApp.BautagebuchWetterPage.content.luftfeuchteView.mySliderGrid;if(c.mySlider.id!==b)return true;else{c.TextValue.computedValue.value=parseInt(a);c.TextValue.computeValue();
c.TextValue.renderUpdate();DigiWebApp.BautagebuchBautageberichtDetailsController.wetter.luftfeuchtigkeit=parseInt(a)}}}}}),TextValue:M.LabelView.design({cssClass:"whiteText centerText",computedValue:{contentBinding:{target:DigiWebApp.BautagebuchBautageberichtDetailsController,property:"wetter.luftfeuchtigkeit"},value:0,operation:function(a){return a+"%"}}})})}),bewoelkungView:M.ContainerView.design({childViews:"myLabel mySliderGrid",cssClass:"bewoelkungView",myLabel:M.LabelView.design({cssClass:"whiteText marginBottom5px",
value:M.I18N.l("BautagebuchBewoelkung")}),mySliderGrid:M.GridView.design({childViews:"mySlider TextValue",layout:M.TWO_COLUMNS,mySlider:M.SliderView.design({min:0,max:3,isSliderOnly:YES,highlightLeftPart:NO,contentBinding:{target:DigiWebApp.BautagebuchBautageberichtDetailsController,property:"wetter.bewoelkung"},events:{change:{action:function(a,b){var c=DigiWebApp.BautagebuchWetterPage.content.bewoelkungView.mySliderGrid;if(c.mySlider.id!==b)return true;else{c.TextValue.computedValue.value=parseInt(a);
c.TextValue.computeValue();c.TextValue.renderUpdate();DigiWebApp.BautagebuchBautageberichtDetailsController.wetter.bewoelkung=parseInt(a)}}}}}),TextValue:M.LabelView.design({cssClass:"whiteText centerText",computedValue:{contentBinding:{target:DigiWebApp.BautagebuchBautageberichtDetailsController,property:"wetter.bewoelkung"},value:0,operation:function(a){switch(a){case 0:return M.I18N.l("BautagebuchBewoelkungKlar");case 1:return M.I18N.l("BautagebuchBewoelkungMaessig");case 2:return M.I18N.l("BautagebuchBewoelkungBedeckt");
case 3:return M.I18N.l("BautagebuchBewoelkungNeblig");default:return""}}}})})}),niederschlagView:M.ContainerView.design({childViews:"myLabel mySliderGrid",cssClass:"niederschlagView",myLabel:M.LabelView.design({cssClass:"whiteText marginBottom5px",value:M.I18N.l("BautagebuchNiederschlag")}),mySliderGrid:M.GridView.design({childViews:"mySlider TextValue",layout:M.TWO_COLUMNS,mySlider:M.SliderView.design({min:0,max:5,isSliderOnly:YES,highlightLeftPart:NO,contentBinding:{target:DigiWebApp.BautagebuchBautageberichtDetailsController,
property:"wetter.niederschlag"},events:{change:{action:function(a,b){var c=DigiWebApp.BautagebuchWetterPage.content.niederschlagView.mySliderGrid;if(c.mySlider.id!==b)return true;else{c.TextValue.computedValue.value=parseInt(a);c.TextValue.computeValue();c.TextValue.renderUpdate();DigiWebApp.BautagebuchBautageberichtDetailsController.wetter.niederschlag=parseInt(a)}}}}}),TextValue:M.LabelView.design({cssClass:"whiteText centerText",computedValue:{contentBinding:{target:DigiWebApp.BautagebuchBautageberichtDetailsController,
property:"wetter.niederschlag"},value:0,operation:function(a){switch(a){case 0:return M.I18N.l("BautagebuchNiederschlagKein");case 1:return M.I18N.l("BautagebuchNiederschlagNiesel");case 2:return M.I18N.l("BautagebuchNiederschlagRegen");case 3:return M.I18N.l("BautagebuchNiederschlagGraupel");case 4:return M.I18N.l("BautagebuchNiederschlagSchnee");case 5:return M.I18N.l("BautagebuchNiederschlagHagel");default:return""}}}})})}),windView:M.ContainerView.design({childViews:"myLabel mySliderGrid",cssClass:"windView",
myLabel:M.LabelView.design({cssClass:"whiteText marginBottom5px",value:M.I18N.l("BautagebuchWind")}),mySliderGrid:M.GridView.design({childViews:"mySlider TextValue",layout:M.TWO_COLUMNS,mySlider:M.SliderView.design({min:0,max:3,isSliderOnly:YES,highlightLeftPart:NO,contentBinding:{target:DigiWebApp.BautagebuchBautageberichtDetailsController,property:"wetter.wind"},events:{change:{action:function(a,b){var c=DigiWebApp.BautagebuchWetterPage.content.windView.mySliderGrid;if(c.mySlider.id!==b)return true;
else{c.TextValue.computedValue.value=parseInt(a);c.TextValue.computeValue();c.TextValue.renderUpdate();DigiWebApp.BautagebuchBautageberichtDetailsController.wetter.wind=parseInt(a)}}}}}),TextValue:M.LabelView.design({cssClass:"whiteText centerText",computedValue:{contentBinding:{target:DigiWebApp.BautagebuchBautageberichtDetailsController,property:"wetter.wind"},value:0,operation:function(a){switch(a){case 0:return M.I18N.l("BautagebuchWindStill");case 1:return M.I18N.l("BautagebuchWindMaessig");
case 2:return M.I18N.l("BautagebuchWindBoeig");case 3:return M.I18N.l("BautagebuchWindStuermisch");default:return""}}}})})}),speichernButton:M.ButtonView.design({value:M.I18N.l("save"),cssClass:"marginTop25",events:{tap:{target:DigiWebApp.NavigationController,action:"backToBautagebuchMaterialienDetailsPageTransition"}}})})});
DigiWebApp.ZeitbuchungenTemplateView=M.ListItemView.design({isSelectable:YES,childViews:"datum von bis dauer spacer2 auftragsBezeichnung positionsBezeichnung handauftragsBezeichnung taetigkeit gpsBreite gpsLaenge gpsBreitePosition gpsLaengePosition",events:{tap:{action:function(a){var b=NO,c=M.ViewManager.getViewById(a).modelId;_.each(DigiWebApp.ZeitbuchungenController.items,function(d){if(d.m_id===c){b=YES;DigiWebApp.ZeitbuchungenController.set("itemForDetails",d);DigiWebApp.ZeitbuchungDetailsPage.updateContent()}});
b===YES&&DigiWebApp.NavigationController.toZeitbuchungDetailsPageTransition()}}},spacer1:M.LabelView.design({value:" "}),spacer2:M.LabelView.design({value:" "}),auftragsBezeichnung:M.LabelView.design({cssClass:"normal unselectable",computedValue:{valuePattern:"<%= auftragsBezeichnung %>",operation:function(a){return a!==""&&typeof a!=="undefined"&&a!=="undefined"&&a!=="null"&&a!==null?M.I18N.l("order")+": "+a:""}}}),auftragsId:M.LabelView.design({cssClass:"normal unselectable",computedValue:{valuePattern:"<%= auftragsId %>",
operation:function(a){return a}}}),bis:M.LabelView.design({cssClass:"bold unselectable",isInline:YES,computedValue:{valuePattern:"<%= bis %>",operation:function(a){return a!=="-"?a:M.I18N.l("now")}}}),datum:M.LabelView.design({cssClass:"bold unselectable",isInline:YES,computedValue:{valuePattern:"<%= datum %>",operation:function(a){return a!=="-"?a:""}}}),dauer:M.LabelView.design({cssClass:"normal unselectable",isInline:YES,computedValue:{valuePattern:"<%= dauer %>",operation:function(a){return a!==
"00:00"&&a!=="-"&&a!=="null"&&a!==null?" ("+a+")":""}}}),farbeAmpel:M.LabelView.design({cssClass:"normal unselectable",computedValue:{valuePattern:"<%= farbeAmpel %>",operation:function(a){return a}}}),gpsBreite:M.LabelView.design({cssClass:"normal unselectable",computedValue:{valuePattern:"<%= gpsBreite %>",operation:function(a){if(a!="0.0"&&a!=="null"&&a!==null){a=new Number(a);return M.I18N.l("latitude")+": "+a.toFixed(6)}else return""}}}),gpsBreitePosition:M.LabelView.design({cssClass:"normal unselectable",
computedValue:{valuePattern:"<%= gpsBreitePosition %>",operation:function(a){if(a!="0.0"&&a!=="null"&&a!==null){a=new Number(a);return M.I18N.l("position")+"-"+M.I18N.l("latitude")+": "+a.toFixed(6)}else return""}}}),gpsLaenge:M.LabelView.design({cssClass:"normal unselectable",computedValue:{valuePattern:"<%= gpsLaenge %>",operation:function(a){if(a!="0.0"&&a!=="null"&&a!==null){a=new Number(a);return M.I18N.l("longitude")+": "+a.toFixed(6)}else return""}}}),gpsLaengePosition:M.LabelView.design({cssClass:"normal unselectable",
computedValue:{valuePattern:"<%= gpsLaengePosition %>",operation:function(a){if(a!="0.0"&&a!=="null"&&a!==null){a=new Number(a);return M.I18N.l("position")+"-"+M.I18N.l("longitude")+": "+a.toFixed(6)}else return""}}}),handauftragsBezeichnung:M.LabelView.design({cssClass:"normal unselectable",computedValue:{valuePattern:"<%= handauftragsBezeichnung %>",operation:function(a){return a!==""&&typeof a!=="undefined"&&a!=="undefined"&&a!=="null"&&a!==null?M.I18N.l("handApplications")+": "+a:""}}}),handauftragsId:M.LabelView.design({cssClass:"normal unselectable",
computedValue:{valuePattern:"<%= handauftragsId %>",operation:function(a){return a}}}),mitarbeiterId:M.LabelView.design({cssClass:"normal unselectable",computedValue:{valuePattern:"<%= mitarbeiterId %>",operation:function(a){return a}}}),name:M.LabelView.design({cssClass:"normal unselectable",computedValue:{valuePattern:"<%= name %>",operation:function(a){return a}}}),nameVorname:M.LabelView.design({cssClass:"normal unselectable",computedValue:{valuePattern:"<%= nameVorname %>",operation:function(a){return a}}}),
positionsBezeichnung:M.LabelView.design({cssClass:"normal unselectable",computedValue:{valuePattern:"<%= positionsBezeichnung %>",operation:function(a){return a!==""&&typeof a!=="undefined"&&a!=="undefined"&&a!=="null"&&a!==null?M.I18N.l("position")+": "+a:""}}}),positionsId:M.LabelView.design({cssClass:"normal unselectable",computedValue:{valuePattern:"<%= positionsId %>",operation:function(a){return a}}}),taetigkeit:M.LabelView.design({cssClass:"normal unselectable",computedValue:{valuePattern:"<%= taetigkeit %>",
operation:function(a){return a!==""&&typeof a!=="undefined"&&a!=="undefined"&&a!=="null"&&a!==null?M.I18N.l("activity")+": "+a:""}}}),taetigkeitsId:M.LabelView.design({cssClass:"normal unselectable",computedValue:{valuePattern:"<%= taetigkeitsId %>",operation:function(a){return a}}}),taetigkeitsart:M.LabelView.design({cssClass:"normal unselectable",computedValue:{valuePattern:"<%= taetigkeitsart %>",operation:function(a){return a}}}),von:M.LabelView.design({cssClass:"bold unselectable",isInline:YES,
computedValue:{valuePattern:"<%= von %>",operation:function(a){return" "+a+" - "}}}),vorname:M.LabelView.design({cssClass:"normal unselectable",computedValue:{valuePattern:"<%= vorname %>",operation:function(a){return a}}})});
DigiWebApp.BautagebuchZusammenfassungMitarbeiterSummeTemplateView=M.ListItemView.design({isSelectable:NO,childViews:"position activity vonbisdauer mitarbeiterId",events:{tap:{action:function(a){a=M.ViewManager.getViewById(a).mitarbeiterId.value;DigiWebApp.BautagebuchZeitenListeController.neu(a)}}},mitarbeiterId:M.LabelView.design({cssClass:"hiddenLabel",isInline:YES,computedValue:{valuePattern:"<%= mitarbeiterId %>",operation:function(a){return a}}}),position:M.LabelView.design({cssClass:"normal unselectable normalLabel",
isInline:YES,computedValue:{valuePattern:"<%= positionName %>",operation:function(a){return a}}}),activity:M.LabelView.design({cssClass:"normal unselectable normalLabel",isInline:YES,computedValue:{valuePattern:"<%= activityName %>",operation:function(a){return", "+a}}}),vonbisdauer:M.LabelView.design({cssClass:"normal unselectable normalLabel right",isInline:YES,computedValue:{valuePattern:"<%= vonbisdauer %>",operation:function(a){return a}}})});
DigiWebApp.BautagebuchBautageberichtDetailsPage=M.PageView.design({events:{pagebeforeshow:{action:function(){var a=_.map(DigiWebApp.BautagebuchMainController.projektleiter,function(d){if(typeof d==="undefined")console.log("UNDEFINED PROJEKTLEADER");else{if(DigiWebApp.BautagebuchBautageberichtDetailsController.projektleiterId)d.isSelected=d.value===DigiWebApp.BautagebuchBautageberichtDetailsController.projektleiterId;return d}});a=_.compact(a);DigiWebApp.BautagebuchBautageberichtDetailsController.set("projektleiterList",
a);a=_.map(DigiWebApp.BautagebuchMainController.auftraege,function(d){if(typeof d==="undefined")console.log("UNDEFINED ORDER");else{if(DigiWebApp.BautagebuchBautageberichtDetailsController.auftragsId)d.isSelected=d.value===DigiWebApp.BautagebuchBautageberichtDetailsController.auftragsId;return d}});a=_.compact(a);DigiWebApp.BautagebuchBautageberichtDetailsController.set("auftraegeList",a);var b=DigiWebApp.BautagebuchBautageberichtDetailsController.mitarbeiterIds;a=JSON.parse(JSON.stringify(DigiWebApp.BautagebuchMainController.mitarbeiter));
var c=[];c=b&&b.length!==0?_.map(a,function(d){var f=NO;_.each(b,function(e){if(e===d.value)f=YES});d.isSelected=f===YES;return d}):DigiWebApp.BautagebuchMainController.mitarbeiter;c=_.compact(c);DigiWebApp.BautagebuchBautageberichtDetailsController.set("mitarbeiterList",c);c=[];a=JSON.parse(JSON.stringify(DigiWebApp.BautagebuchMainController.mitarbeiter));if(b&&b.length!==0)c=_.map(a,function(d){var f=NO;_.each(b,function(e){if(e===d.value)f=YES});if(f){d.isSelected=YES;return d}});c=_.compact(c);
DigiWebApp.BautagebuchBautageberichtDetailsController.set("mitarbeiterListSelected",c);DigiWebApp.SettingsController.getSetting("bautagebuchLimit_autoStartUhrzeit")?$(DigiWebApp.BautagebuchBautageberichtDetailsPage.content.startUhrzeit)[0].disable():$(DigiWebApp.BautagebuchBautageberichtDetailsPage.content.startUhrzeit)[0].enable();$("#"+DigiWebApp.BautagebuchBautageberichtDetailsPage.content.zeiten_material_ButtonGrid.zeitenButton.id).addClass("bigButton");$("#"+DigiWebApp.BautagebuchBautageberichtDetailsPage.content.zeiten_material_ButtonGrid.materialienButton.id).addClass("bigButton");
$("#"+DigiWebApp.BautagebuchBautageberichtDetailsPage.content.notizen_medien_ButtonGrid.notizenButton.id).addClass("bigButton");$("#"+DigiWebApp.BautagebuchBautageberichtDetailsPage.content.notizen_medien_ButtonGrid.medienButton.id).addClass("bigButton");$("#"+DigiWebApp.BautagebuchBautageberichtDetailsPage.content.wetterButton.id).addClass("bigButton")}},pagehide:{action:function(){}}},cssClass:"bautagebuchBautageberichtDetailsPage",childViews:"header content",header:M.ToolbarView.design({childViews:"backButton title delButton",
cssClass:"header unselectable",isFixed:YES,backButton:M.ButtonView.design({value:M.I18N.l("back"),icon:"arrow-l",anchorLocation:M.LEFT,events:{tap:{target:DigiWebApp.NavigationController,action:function(){try{DigiWebApp.ApplicationController.vibrate()}catch(a){}this.backToBautagebuchBautageberichteListePageTransition()}}}}),title:M.LabelView.design({value:"",anchorLocation:M.CENTER,contentBinding:{target:DigiWebApp.BautagebuchBautageberichtDetailsController,property:"datum"},events:{tap:{action:function(){try{DigiWebApp.ApplicationController.vibrate()}catch(a){}DigiWebApp.SettingsController.getSetting("bautagebuchLimit_autoStartUhrzeit")||
M.DatePickerView.show({source:M.ViewManager.getView("bautagebuchBautageberichtDetailsPage","title"),initialDate:D8.create(DigiWebApp.BautagebuchBautageberichtDetailsController.datum),showTimePicker:NO,showDatePicker:YES,dateOrder:"ddMMyy",dateFormat:"dd.mm.yy",timeFormat:"HH:ii",minutesLabel:M.I18N.l("minute"),hoursLabel:M.I18N.l("hour"),dayLabel:M.I18N.l("day"),monthLabel:M.I18N.l("month"),yearLabel:M.I18N.l("year"),dayNamesShort:DigiWebApp.ApplicationController.dayNamesShort,dayNames:DigiWebApp.ApplicationController.dayNames,
monthNamesShort:DigiWebApp.ApplicationController.monthNamesShort,monthNames:DigiWebApp.ApplicationController.monthNames,callbacks:{confirm:{target:this,action:function(b){DigiWebApp.BautagebuchBautageberichtDetailsController.set("datum",b)}},before:{action:function(){}},cancel:{action:function(){}}}})}}}}),delButton:M.ButtonView.design({value:M.I18N.l("BautagebuchDelete"),icon:"delete",anchorLocation:M.RIGHT,events:{tap:{action:function(){try{DigiWebApp.ApplicationController.vibrate()}catch(a){}DigiWebApp.BautagebuchBautageberichtDetailsController.deleteBautagesbericht(DigiWebApp.NavigationController.backToBautagebuchBautageberichteListePageTransition)}}}}),
anchorLocation:M.TOP}),content:M.ScrollView.design({childViews:"auftragComboBox projektleiterComboBox mitarbeiterGroup startUhrzeit spacer2 zeiten_material_ButtonGrid notizen_medien_ButtonGrid wetterButton spacer1 grid",cssClass:"content",spacer1:M.LabelView.design({value:"&nbsp;<br>"}),spacer2:M.LabelView.design({value:"&nbsp;<br>"}),startUhrzeit:M.TextFieldView.design({label:M.I18N.l("BautagebuchStartUhrzeit"),cssClass:"startUhrzeit",contentBindingReverse:{target:DigiWebApp.BautagebuchBautageberichtDetailsController,
property:"startUhrzeit"},contentBinding:{target:DigiWebApp.BautagebuchBautageberichtDetailsController,property:"startUhrzeit"},events:{tap:{action:function(){if(!DigiWebApp.SettingsController.getSetting("bautagebuchLimit_autoStartUhrzeit")){$(DigiWebApp.BautagebuchBautageberichtDetailsPage.content.startUhrzeit).blur();M.DatePickerView.show({source:M.ViewManager.getView("bautagebuchBautageberichtDetailsPage","startUhrzeit"),initialDate:D8.create("01.01.1993 "+DigiWebApp.BautagebuchBautageberichtDetailsController.startUhrzeit),
showTimePicker:YES,showDatePicker:NO,showAmPm:NO,dateOrder:"ddmmyy",dateFormat:"dd.mm.yy",timeFormat:"HH:ii",minutesLabel:M.I18N.l("minute"),hoursLabel:M.I18N.l("hour"),dayLabel:M.I18N.l("day"),monthLabel:M.I18N.l("month"),yearLabel:M.I18N.l("year"),dayNamesShort:DigiWebApp.ApplicationController.dayNamesShort,dayNames:DigiWebApp.ApplicationController.dayNames,monthNamesShort:DigiWebApp.ApplicationController.monthNamesShort,monthNames:DigiWebApp.ApplicationController.monthNames,callbacks:{confirm:{target:this,
action:function(a){DigiWebApp.BautagebuchBautageberichtDetailsController.set("startUhrzeit",a)}},before:{action:function(){}},cancel:{action:function(){}}}})}}}}}),startUhrzeitOld:M.GridView.design({childViews:"startUhrzeitLabel startUhrzeitInput",layout:M.TWO_COLUMNS,startUhrzeitLabel:M.LabelView.design({cssClass:"whiteText",value:M.I18N.l("BautagebuchStartUhrzeit")}),startUhrzeitInput:M.TextFieldView.design({contentBindingReverse:{target:DigiWebApp.BautagebuchBautageberichtDetailsController,property:"startUhrzeit"},
contentBinding:{target:DigiWebApp.BautagebuchBautageberichtDetailsController,property:"startUhrzeit"},events:{tap:{action:function(){if(!DigiWebApp.SettingsController.getSetting("bautagebuchLimit_autoStartUhrzeit")){$(DigiWebApp.BautagebuchBautageberichtDetailsPage.content.startUhrzeit.startUhrzeitInput).blur();M.DatePickerView.show({source:M.ViewManager.getView("bautagebuchBautageberichtDetailsPage","startUhrzeitInput"),initialDate:D8.create("01.01.1993 "+DigiWebApp.BautagebuchBautageberichtDetailsController.startUhrzeit),
showTimePicker:YES,showDatePicker:NO,showAmPm:NO,dateOrder:"ddmmyy",dateFormat:"dd.mm.yy",timeFormat:"HH:ii",minutesLabel:M.I18N.l("minute"),hoursLabel:M.I18N.l("hour"),dayLabel:M.I18N.l("day"),monthLabel:M.I18N.l("month"),yearLabel:M.I18N.l("year"),dayNamesShort:DigiWebApp.ApplicationController.dayNamesShort,dayNames:DigiWebApp.ApplicationController.dayNames,monthNamesShort:DigiWebApp.ApplicationController.monthNamesShort,monthNames:DigiWebApp.ApplicationController.monthNames,callbacks:{confirm:{target:this,
action:function(a){DigiWebApp.BautagebuchBautageberichtDetailsController.set("startUhrzeit",a)}},before:{action:function(){}},cancel:{action:function(){}}}})}}}}})}),projektleiterComboBox:M.SelectionListView.design({selectionMode:M.SINGLE_SELECTION_DIALOG,initialText:M.I18N.l("noData"),label:M.I18N.l("BautagebuchProjektleiter"),applyTheme:NO,contentBinding:{target:DigiWebApp.BautagebuchBautageberichtDetailsController,property:"projektleiterList"},events:{change:{action:function(){DigiWebApp.BautagebuchBautageberichtDetailsController.set("projektleiterId",
M.ViewManager.getView("bautagebuchBautageberichtDetailsPage","projektleiterComboBox").getSelection(YES).value)}}}}),auftragComboBox:M.SelectionListView.design({selectionMode:M.SINGLE_SELECTION_DIALOG,initialText:M.I18N.l("noData"),label:M.I18N.l("order"),applyTheme:NO,contentBinding:{target:DigiWebApp.BautagebuchBautageberichtDetailsController,property:"auftraegeList"},events:{change:{action:function(){DigiWebApp.BautagebuchBautageberichtDetailsController.set("auftragsId",M.ViewManager.getView("bautagebuchBautageberichtDetailsPage",
"auftragComboBox").getSelection(YES).value);DigiWebApp.BautagebuchBautageberichtDetailsController.set("auftragsName",M.ViewManager.getView("bautagebuchBautageberichtDetailsPage","auftragComboBox").getSelection(YES).label);DigiWebApp.BautagebuchBautageberichtDetailsController.setPositionen(M.ViewManager.getView("bautagebuchBautageberichtDetailsPage","auftragComboBox").getSelection(YES).value)}}}}),mitarbeiterGroup:M.SelectionListView.design({selectionMode:M.MULTIPLE_SELECTION,initialText:M.I18N.l("noData"),
label:M.I18N.l("employees"),applyTheme:NO,contentBinding:{target:DigiWebApp.BautagebuchBautageberichtDetailsController,property:"mitarbeiterList"},events:{change:{action:function(a){for(var b=[],c=0;c<a.length;c++)b.push(a[c]);DigiWebApp.BautagebuchBautageberichtDetailsController.set("mitarbeiterIds",b);a=[];if(b&&b.length!==0)a=_.map(DigiWebApp.BautagebuchMainController.mitarbeiter,function(d){var f=NO;_.each(b,function(e){if(e===d.value)f=YES});if(f){d.isSelected=YES;return d}});a=_.compact(a);
DigiWebApp.BautagebuchBautageberichtDetailsController.set("mitarbeiterListSelected",a)}}}}),zeiten_material_ButtonGrid:M.GridView.design({childViews:"materialienButton zeitenButton",layout:M.TWO_COLUMNS,materialienButton:M.ButtonView.design({value:M.I18N.l("BautagebuchMaterialien"),events:{tap:{action:function(){DigiWebApp.BautagebuchBautageberichtDetailsController.save(DigiWebApp.NavigationController.toBautagebuchMaterialienListePageTransition)}}}}),zeitenButton:M.ButtonView.design({value:M.I18N.l("BautagebuchZeiten"),
events:{tap:{action:function(){DigiWebApp.BautagebuchBautageberichtDetailsController.save(DigiWebApp.NavigationController.toBautagebuchZeitenListePageTransition)}}}})}),materialienButton:M.ButtonView.design({value:M.I18N.l("BautagebuchMaterialien"),events:{tap:{action:function(){DigiWebApp.BautagebuchBautageberichtDetailsController.save(DigiWebApp.NavigationController.toBautagebuchMaterialienListePageTransition)}}}}),zeitenButton:M.ButtonView.design({value:M.I18N.l("BautagebuchZeiten"),events:{tap:{action:function(){DigiWebApp.BautagebuchBautageberichtDetailsController.save(DigiWebApp.NavigationController.toBautagebuchZeitenListePageTransition)}}}}),
notizen_medien_ButtonGrid:M.GridView.design({childViews:"notizenButton medienButton",layout:M.TWO_COLUMNS,notizenButton:M.ButtonView.design({value:M.I18N.l("BautagebuchNotizen"),events:{tap:{action:function(){DigiWebApp.BautagebuchBautageberichtDetailsController.save(DigiWebApp.NavigationController.toBautagebuchNotizenListePageTransition)}}}}),medienButton:M.ButtonView.design({value:M.I18N.l("BautagebuchMedien"),events:{tap:{action:function(){DigiWebApp.BautagebuchBautageberichtDetailsController.save(DigiWebApp.NavigationController.toBautagebuchMedienListePageTransition)}}}})}),
notizenButton:M.ButtonView.design({value:M.I18N.l("BautagebuchNotizen"),events:{tap:{action:function(){DigiWebApp.BautagebuchBautageberichtDetailsController.save(DigiWebApp.NavigationController.toBautagebuchNotizenListePageTransition)}}}}),medienButton:M.ButtonView.design({value:M.I18N.l("BautagebuchMedien"),events:{tap:{action:function(){DigiWebApp.BautagebuchBautageberichtDetailsController.save(DigiWebApp.NavigationController.toBautagebuchMedienListePageTransition)}}}}),wetterButton:M.ButtonView.design({value:M.I18N.l("BautagebuchWetter"),
events:{tap:{action:function(){DigiWebApp.BautagebuchBautageberichtDetailsController.save(DigiWebApp.NavigationController.toBautagebuchWetterPageTransition)}}}}),grid:M.GridView.design({childViews:"button icon",layout:{cssClass:"digiButton",columns:{0:"button",1:"icon"}},button:M.ButtonView.design({value:M.I18N.l("BautagebuchSpeichernAbschliessen"),cssClass:"digiButton",anchorLocation:M.RIGHT,events:{tap:{action:function(){M.DialogView.actionSheet({title:M.I18N.l("BautagebuchSaveOrClose"),cancelButtonValue:M.I18N.l("cancel"),
otherButtonValues:[M.I18N.l("save"),M.I18N.l("BautagebuchBautageberichtAbschliessen")],otherButtonTags:["save","finish"],callbacks:{other:{action:function(a){switch(a){case "save":DigiWebApp.BautagebuchBautageberichtDetailsController.save(DigiWebApp.NavigationController.backToBautagebuchBautageberichteListePageTransition);break;case "finish":DigiWebApp.BautagebuchBautageberichtDetailsController.finish();break;default:console.log("unknonw ButtonTag")}}},cancel:{action:function(){}}}})}}}}),icon:M.ImageView.design({value:"theme/images/icon_bookTime.png"})})})});
DigiWebApp.SpesenPage=M.PageView.design({events:{pagebeforeshow:{action:function(){var a;if(DigiWebApp.SpesenAuswahlOption.find().length===0){a=1;DigiWebApp.SpesenAuswahlOption.createRecord({id:a,beschreibung:"keine Spesen"}).saveSorted();a+=1;DigiWebApp.SpesenAuswahlOption.createRecord({id:a,beschreibung:"Tagesspesen"}).saveSorted();a+=1;DigiWebApp.SpesenAuswahlOption.createRecord({id:a,beschreibung:"mehrt\u00e4gige Spesen"}).saveSorted();a+=1}if(DigiWebApp.UebernachtungAuswahlOption.find().length===
0){a=1;DigiWebApp.UebernachtungAuswahlOption.createRecord({id:a,beschreibung:"keine \u00dcbernachtung"}).saveSorted();a+=1;DigiWebApp.UebernachtungAuswahlOption.createRecord({id:a,beschreibung:"\u00dcbernachtung mit Pauschale"}).saveSorted();a+=1;DigiWebApp.UebernachtungAuswahlOption.createRecord({id:a,beschreibung:"\u00dcbernachtung mit Beleg"}).saveSorted();a+=1}a=DigiWebApp.SpesenAuswahlOption.findSorted();a=_.map(a,function(b){if(b){var c={label:b.get("beschreibung"),value:b.get("id")};if(b.get("id")===
1)c.isSelected=YES;return c}});a=_.compact(a);DigiWebApp.BookingController.set("spesenOptionen",a);a=DigiWebApp.UebernachtungAuswahlOption.findSorted();a=_.map(a,function(b){if(b){var c={label:b.get("beschreibung"),value:b.get("id")};if(b.get("id")===1)c.isSelected=YES;return c}});a=_.compact(a);DigiWebApp.BookingController.set("uebernachtungOptionen",a)}}},myCallback:function(){},tab_action_timeoutvar:null,tab_action:function(){clearTimeout(DigiWebApp.SpesenPage.tab_action_timeoutvar);DigiWebApp.BookingController.currentBooking.set("spesenAuswahl",
M.ViewManager.getView("spesenPage","spesenAuswahl").getSelection(YES).value);DigiWebApp.BookingController.currentBooking.set("uebernachtungAuswahl",M.ViewManager.getView("spesenPage","uebernachtungAuswahl").getSelection(YES).value);DigiWebApp.BookingController.currentBooking.save();DigiWebApp.SpesenPage.myCallback()},childViews:"header content",cssClass:"remarkPage",header:M.ToolbarView.design({childViews:"backButton title",cssClass:"header",isFixed:YES,backButton:M.ButtonView.design({value:M.I18N.l("back"),
icon:"arrow-l",anchorLocation:M.LEFT,events:{tap:{target:DigiWebApp.NavigationController,action:function(){try{DigiWebApp.ApplicationController.vibrate()}catch(a){}this.backToBookTimePagePOP()}}}}),title:M.LabelView.design({value:M.I18N.l("Spesen_Ausloese"),anchorLocation:M.CENTER}),anchorLocation:M.TOP}),content:M.ScrollView.design({childViews:"spesenAuswahl uebernachtungAuswahl spacer grid",spacer:M.LabelView.design({value:"&nbsp;<br />"}),spesenAuswahl:M.SelectionListView.design({selectionMode:M.SINGLE_SELECTION_DIALOG,
initialText:M.I18N.l("noData"),label:M.I18N.l("Spesen"),applyTheme:NO,contentBinding:{target:DigiWebApp.BookingController,property:"spesenOptionen"},events:{change:{target:DigiWebApp.BookingController,action:function(){}}}}),uebernachtungAuswahl:M.SelectionListView.design({selectionMode:M.SINGLE_SELECTION_DIALOG,label:M.I18N.l("Uebernachtung"),initialText:M.I18N.l("noData"),applyTheme:NO,contentBinding:{target:DigiWebApp.BookingController,property:"uebernachtungOptionen"},events:{change:{target:DigiWebApp.BookingController,
action:function(){}}}}),grid:M.GridView.design({childViews:"button icon",layout:{cssClass:"digiButton",columns:{0:"button",1:"icon"}},button:M.ButtonView.design({value:M.I18N.l("SpeichernUndBuchen"),cssClass:"digiButton",anchorLocation:M.RIGHT,events:{tap:{action:function(){DigiWebApp.ApplicationController.DigiLoaderView.show(M.I18N.l("Save"));DigiWebApp.SpesenPage.tab_action_timeoutvar=setTimeout("DigiWebApp.SpesenPage.tab_action();",50)}}}}),icon:M.ImageView.design({value:"theme/images/icon_bookTime.png"})})})});
DigiWebApp.BautagebuchMaterialienTemplateView=M.ListItemView.design({isSelectable:YES,childViews:"positionName activityName spacer menge einheit artikel",events:{tap:{action:function(a){var b=M.ViewManager.getViewById(a).modelId;_.each(DigiWebApp.BautagebuchMaterialienListeController.items,function(c){c.m_id===b&&DigiWebApp.BautagebuchMaterialienDetailsController.load(c)});DigiWebApp.NavigationController.toBautagebuchMaterialienDetailsPageTransition()}}},spacer:M.LabelView.design({value:""}),positionName:M.LabelView.design({cssClass:"normal unselectable",
isInline:YES,computedValue:{valuePattern:"<%= positionName %>",operation:function(a){return a!==""&&a!==null?a:""}}}),activityName:M.LabelView.design({cssClass:"normal unselectable",isInline:YES,computedValue:{valuePattern:"<%= activityName %>",operation:function(a){return a!==""&&a!==null?", "+a+":":":"}}}),menge:M.LabelView.design({cssClass:"normal unselectable",isInline:YES,computedValue:{valuePattern:"<%= menge %>",operation:function(a){return a!==""&&a!==null?a:""}}}),einheit:M.LabelView.design({cssClass:"normal unselectable",
isInline:YES,computedValue:{valuePattern:"<%= einheit %>",operation:function(a){return a!==""&&a!==null?" "+a:""}}}),artikel:M.LabelView.design({cssClass:"normal unselectable",isInline:YES,computedValue:{valuePattern:"<%= artikel %>",operation:function(a){return a!==""&&a!==null?' "'+a+'"':""}}})});m_require("app/views/BautagebuchMaterialienTemplateView");
DigiWebApp.BautagebuchMaterialienListePage=M.PageView.design({events:{pagebeforeshow:{target:DigiWebApp.BautagebuchMaterialienListeController,action:"init"}},childViews:"header content",cssClass:"bautagebuchListePage unselectable",header:M.ToolbarView.design({childViews:"backButton title newButton",cssClass:"header unselectable",isFixed:YES,backButton:M.ButtonView.design({value:M.I18N.l("back"),icon:"arrow-l",anchorLocation:M.LEFT,events:{tap:{target:DigiWebApp.NavigationController,action:function(){try{DigiWebApp.ApplicationController.vibrate()}catch(a){}this.backToBautagebuchBautageberichtDetailsPageTransition()}}}}),
title:M.LabelView.design({value:M.I18N.l("BautagebuchMaterialien"),anchorLocation:M.CENTER}),newButton:M.ButtonView.design({value:M.I18N.l("BautagebuchAdd"),icon:"new",anchorLocation:M.RIGHT,events:{tap:{action:function(){try{DigiWebApp.ApplicationController.vibrate()}catch(a){}DigiWebApp.BautagebuchMaterialienListeController.neu()}}}}),anchorLocation:M.TOP}),content:M.ScrollView.design({childViews:"list",list:M.ListView.design({contentBinding:{target:DigiWebApp.BautagebuchMaterialienListeController,
property:"items"},listItemTemplateView:DigiWebApp.BautagebuchMaterialienTemplateView})})});
DigiWebApp.BautagebuchZeitenTemplateView=M.ListItemView.design({isSelectable:YES,childViews:"positionName activityName spacer von bis dauer latitude longitude latitude_bis longitude_bis mitarbeiterIds",events:{tap:{action:function(a){var b=M.ViewManager.getViewById(a).modelId;_.each(DigiWebApp.BautagebuchZeitenListeController.items,function(c){c.m_id===b&&DigiWebApp.BautagebuchZeitenDetailsController.load(c)});DigiWebApp.NavigationController.toBautagebuchZeitenDetailsPageTransition()}}},spacer:M.LabelView.design({value:""}),
mitarbeiterIds:M.LabelView.design({cssClass:"small unselectable",computedValue:{valuePattern:"<%= mitarbeiterIds %>",operation:function(a){if(a!==""&&a!==null){var b="",c=JSON.parse(a);a=DigiWebApp.BautagebuchMitarbeiter.findSorted();_.each(a,function(d){if(c.indexOf(d.get("id"))!==-1){if(b!=="")b+=", ";b+="<nobr>"+d.vollername()+"</nobr>"}});return b}else return""}}}),positionName:M.LabelView.design({cssClass:"normal unselectable",isInline:YES,computedValue:{valuePattern:"<%= positionName %>",operation:function(a){return a!==
""&&a!==null?a:""}}}),activityName:M.LabelView.design({cssClass:"normal unselectable",isInline:YES,computedValue:{valuePattern:"<%= activityName %>",operation:function(a){return a!==""&&a!==null?", "+a+":":":"}}}),von:M.LabelView.design({cssClass:"normal unselectable",isInline:YES,computedValue:{valuePattern:"<%= von %>",operation:function(a){return a!==""&&a!==null&&!DigiWebApp.BautagebuchEinstellungen.find()[0].get("inStundenBuchen")?a:""}}}),bis:M.LabelView.design({cssClass:"normal unselectable",
isInline:YES,computedValue:{valuePattern:"<%= bis %>",operation:function(a){return a!==""&&a!==null&&!DigiWebApp.BautagebuchEinstellungen.find()[0].get("inStundenBuchen")?" - "+a:""}}}),dauer:M.LabelView.design({cssClass:"normal unselectable",isInline:YES,computedValue:{valuePattern:"<%= dauer %>",operation:function(a){return a!==""&&a!==null&&DigiWebApp.BautagebuchEinstellungen.find()[0].get("inStundenBuchen")?M.I18N.l("bookingDuration")+": "+a+" h":""}}}),latitude:M.LabelView.design({cssClass:"location unselectable",
computedValue:{valuePattern:"<%= latitude %>",operation:function(a){if(a>0){a=new Number(a);return M.I18N.l("latitude")+" Von: "+a.toFixed(6)}else return""}}}),longitude:M.LabelView.design({cssClass:"location unselectable",computedValue:{valuePattern:"<%= longitude %>",operation:function(a){if(a>0){a=new Number(a);return M.I18N.l("longitude")+" Von: "+a.toFixed(6)}else return""}}}),latitude_bis:M.LabelView.design({cssClass:"location unselectable",computedValue:{valuePattern:"<%= latitude_bis %>",
operation:function(a){if(a>0){a=new Number(a);return M.I18N.l("latitude")+" Bis: "+a.toFixed(6)}else return""}}}),longitude_bis:M.LabelView.design({cssClass:"location unselectable",computedValue:{valuePattern:"<%= longitude_bis %>",operation:function(a){if(a>0){a=new Number(a);return M.I18N.l("longitude")+" Bis: "+a.toFixed(6)}else return""}}})});m_require("app/views/BautagebuchZeitenTemplateView");
DigiWebApp.BautagebuchZeitenListePage=M.PageView.design({events:{pagebeforeshow:{target:DigiWebApp.BautagebuchZeitenListeController,action:"init"}},controller:DigiWebApp.BautagebuchZeitenListeController,navigationController:DigiWebApp.NavigationController,childViews:"header content",cssClass:"bautagebuchListePage unselectable",header:M.ToolbarView.design({childViews:"backButton title newButton",cssClass:"header unselectable",isFixed:YES,backButton:M.ButtonView.design({value:M.I18N.l("back"),icon:"arrow-l",
anchorLocation:M.LEFT,events:{tap:{target:DigiWebApp.NavigationController,action:function(){try{DigiWebApp.ApplicationController.vibrate()}catch(a){}this.backToBautagebuchBautageberichtDetailsPageTransition()}}}}),title:M.LabelView.design({value:M.I18N.l("BautagebuchZeiten"),anchorLocation:M.CENTER}),newButton:M.ButtonView.design({value:M.I18N.l("BautagebuchAdd"),icon:"new",anchorLocation:M.RIGHT,events:{tap:{action:function(){try{DigiWebApp.ApplicationController.vibrate()}catch(a){}DigiWebApp.BautagebuchZeitenListeController.neu()}}}}),
anchorLocation:M.TOP}),content:M.ScrollView.design({childViews:"list",list:M.ListView.design({contentBinding:{target:DigiWebApp.BautagebuchZeitenListeController,property:"items"},listItemTemplateView:DigiWebApp.BautagebuchZeitenTemplateView})})});
DigiWebApp.TimeDataSentDaysTemplateView=M.ListItemView.design({isSelectable:YES,childViews:"tagLabel",events:{tap:{action:function(a,b){_.each(DigiWebApp.SentTimeDataDays.find(),function(c){if(c.m_id===b)DigiWebApp.BookingController.dayToDisplay=c});DigiWebApp.NavigationController.toTimeDataArchivePageTransition()}}},tagLabel:M.LabelView.design({cssClass:"tagLabel unselectable",computedValue:{valuePattern:"<%= tagLabel %>",operation:function(a){return M.I18N.l("archivedTimeDataOf")+" "+a}}})});
DigiWebApp.BautagebuchZeitenDetailsPage=M.PageView.design({events:{pagebeforeshow:{action:function(){var a=NO,b=JSON.parse(JSON.stringify(DigiWebApp.BautagebuchBautageberichtDetailsController.positionenList));_.each(b,function(j){j.isSelected=parseInt(j.value)!==0?NO:YES});b=_.map(b,function(j){if(typeof j==="undefined")console.log("UNDEFINED position");else{if(DigiWebApp.BautagebuchZeitenDetailsController.positionId){j.isSelected=j.value===DigiWebApp.BautagebuchZeitenDetailsController.positionId;
if(j.isSelected)a=YES}return j}});b=_.compact(b);if(b.length!==1)b.push({label:M.I18N.l("selectSomething"),value:"0",isSelected:!a});else{DigiWebApp.BautagebuchZeitenDetailsController.set("positionId",b[0].value);DigiWebApp.BautagebuchZeitenDetailsController.set("positionName",b[0].label)}DigiWebApp.BautagebuchZeitenDetailsController.set("positionenList",b);DigiWebApp.BautagebuchZeitenDetailsController.setTaetigkeiten(DigiWebApp.BautagebuchZeitenDetailsController.positionId);var c=DigiWebApp.BautagebuchZeitenDetailsController.mitarbeiterIds;
b=[];b=_.map(JSON.parse(JSON.stringify(DigiWebApp.BautagebuchBautageberichtDetailsController.mitarbeiterListSelected)),function(j){var l=NO;_.each(c,function(m){if(parseInt(m)===parseInt(j.value))l=YES});j.isSelected=l===YES;return j});b=_.compact(b);DigiWebApp.BautagebuchZeitenDetailsController.set("mitarbeiterList",b);if(DigiWebApp.BautagebuchEinstellungen.find()[0].get("inStundenBuchen")){try{$("[id="+DigiWebApp.BautagebuchZeitenDetailsPage.content.GridVonBis.id+"]").each(function(){$(this).hide()})}catch(d){}try{$("label[for="+
DigiWebApp.BautagebuchZeitenDetailsPage.content.dauerInput.id+"]").each(function(){$(this).show();$(this).parent().removeClass("transparent")})}catch(f){}try{$("[id="+DigiWebApp.BautagebuchZeitenDetailsPage.content.dauerInput.id+"]").each(function(){$(this).show();$(this).parent().removeClass("transparent")})}catch(e){}}else{try{$("[id="+DigiWebApp.BautagebuchZeitenDetailsPage.content.GridVonBis.id+"]").each(function(){$(this).show()})}catch(g){}try{$("label[for="+DigiWebApp.BautagebuchZeitenDetailsPage.content.dauerInput.id+
"]").each(function(){$(this).hide();$(this).parent().addClass("transparent")})}catch(h){}try{$("[id="+DigiWebApp.BautagebuchZeitenDetailsPage.content.dauerInput.id+"]").each(function(){$(this).hide();$(this).parent().addClass("transparent")})}catch(i){}}if(DigiWebApp.BautagebuchBautageberichtDetailsController.item.get("abgeschlossen")){$("#"+DigiWebApp.BautagebuchZeitenDetailsPage.content.grid.id).hide();$("#"+DigiWebApp.BautagebuchZeitenDetailsPage.header.delButton.id).hide()}else{$("#"+DigiWebApp.BautagebuchZeitenDetailsPage.content.grid.id).show();
$("#"+DigiWebApp.BautagebuchZeitenDetailsPage.header.delButton.id).show()}}},pagehide:{action:function(){}}},cssClass:"bautagebuchZeitenDetailsPage",childViews:"header content",header:M.ToolbarView.design({childViews:"backButton title delButton",cssClass:"header unselectable",isFixed:YES,backButton:M.ButtonView.design({value:M.I18N.l("back"),icon:"arrow-l",anchorLocation:M.LEFT,events:{tap:{action:function(){try{DigiWebApp.ApplicationController.vibrate()}catch(a){}history.back()}}}}),title:M.LabelView.design({value:M.I18N.l("Zeitbuchung"),
anchorLocation:M.CENTER}),delButton:M.ButtonView.design({value:M.I18N.l("BautagebuchDelete"),icon:"delete",anchorLocation:M.RIGHT,events:{tap:{target:DigiWebApp.BautagebuchZeitenDetailsController,action:function(){try{DigiWebApp.ApplicationController.vibrate()}catch(a){}this.deleteZeitbuchung()}}}}),anchorLocation:M.TOP}),content:M.ScrollView.design({childViews:"positionComboBox activityComboBox mitarbeiterGroup GridVonBis dauerInput grid",cssClass:"content",positionComboBox:M.SelectionListView.design({selectionMode:M.SINGLE_SELECTION_DIALOG,
initialText:M.I18N.l("noData"),label:M.I18N.l("position"),applyTheme:NO,contentBinding:{target:DigiWebApp.BautagebuchZeitenDetailsController,property:"positionenList"},events:{change:{action:function(){DigiWebApp.BautagebuchZeitenDetailsController.set("positionId",M.ViewManager.getView("bautagebuchZeitenDetailsPage","positionComboBox").getSelection(YES).value);DigiWebApp.BautagebuchZeitenDetailsController.set("positionName",M.ViewManager.getView("bautagebuchZeitenDetailsPage","positionComboBox").getSelection(YES).label);
DigiWebApp.BautagebuchZeitenDetailsController.setTaetigkeiten(M.ViewManager.getView("bautagebuchZeitenDetailsPage","positionComboBox").getSelection(YES).value)}}}}),activityComboBox:M.SelectionListView.design({selectionMode:M.SINGLE_SELECTION_DIALOG,initialText:M.I18N.l("noData"),label:M.I18N.l("activity"),applyTheme:NO,contentBinding:{target:DigiWebApp.BautagebuchZeitenDetailsController,property:"activityList"},events:{change:{action:function(){DigiWebApp.BautagebuchZeitenDetailsController.set("activityId",
M.ViewManager.getView("bautagebuchZeitenDetailsPage","activityComboBox").getSelection(YES).value);DigiWebApp.BautagebuchZeitenDetailsController.set("activityName",M.ViewManager.getView("bautagebuchZeitenDetailsPage","activityComboBox").getSelection(YES).label)}}}}),mitarbeiterGroup:M.SelectionListView.design({selectionMode:M.MULTIPLE_SELECTION,initialText:M.I18N.l("noData"),label:M.I18N.l("employees"),applyTheme:NO,contentBinding:{target:DigiWebApp.BautagebuchZeitenDetailsController,property:"mitarbeiterList"},
events:{change:{action:function(a){for(var b=[],c=0;c<a.length;c++)b.push(a[c]);DigiWebApp.BautagebuchZeitenDetailsController.set("mitarbeiterIds",b);a=[];if(b&&b.length!==0)a=_.map(DigiWebApp.BautagebuchMainController.mitarbeiter,function(d){var f=NO;_.each(b,function(e){if(e===d.value)f=YES});if(f){d.isSelected=YES;return d}});a=_.compact(a);DigiWebApp.BautagebuchZeitenDetailsController.set("mitarbeiterListSelected",a)}}}}),GridVonBis:M.GridView.design({childViews:"vonInput bisInput",layout:M.TWO_COLUMNS,
vonInput:M.TextFieldView.design({label:M.I18N.l("bookingFrom"),contentBindingReverse:{target:DigiWebApp.BautagebuchZeitenDetailsController,property:"von"},contentBinding:{target:DigiWebApp.BautagebuchZeitenDetailsController,property:"von"},events:{tap:{action:function(){$(DigiWebApp.BautagebuchZeitenDetailsPage.content.vonInput).blur();M.DatePickerView.show({source:M.ViewManager.getView("bautagebuchZeitenDetailsPage","vonInput"),initialDate:D8.create(DigiWebApp.BautagebuchBautageberichtDetailsController.item.get("datum")+
" "+DigiWebApp.BautagebuchBautageberichtDetailsController.startUhrzeit),showTimePicker:YES,showDatePicker:NO,showAmPm:NO,dateOrder:"ddmmyy",dateFormat:"dd.mm.yy",timeFormat:"HH:ii",minutesLabel:M.I18N.l("minute"),hoursLabel:M.I18N.l("hour"),dayLabel:M.I18N.l("day"),monthLabel:M.I18N.l("month"),yearLabel:M.I18N.l("year"),dayNamesShort:DigiWebApp.ApplicationController.dayNamesShort,dayNames:DigiWebApp.ApplicationController.dayNames,monthNamesShort:DigiWebApp.ApplicationController.monthNamesShort,monthNames:DigiWebApp.ApplicationController.monthNames,
callbacks:{confirm:{target:this,action:function(a){DigiWebApp.BautagebuchZeitenDetailsController.set("von",a);DigiWebApp.BautagebuchZeitenDetailsController.set("timeStampStart",D8.create(DigiWebApp.BautagebuchBautageberichtDetailsController.item.get("datum")+" "+a).getTimestamp());if(DigiWebApp.BautagebuchZeitenDetailsController.get("von")!==null&&DigiWebApp.BautagebuchZeitenDetailsController.get("bis")!==null)try{var b=D8.create(DigiWebApp.BautagebuchBautageberichtDetailsController.item.get("datum")+
" "+DigiWebApp.BautagebuchZeitenDetailsController.get("von")),c=D8.create(DigiWebApp.BautagebuchBautageberichtDetailsController.item.get("datum")+" "+DigiWebApp.BautagebuchZeitenDetailsController.get("bis"));if(b.getTimestamp()<=c.getTimestamp()||DigiWebApp.BautagebuchEinstellungen.find()[0].get("falscheZeitenIgnorieren")){var d=b.timeBetween(c)/6E4,f=parseInt(d/60),e=parseInt(d%60),g=D8.create(DigiWebApp.BautagebuchBautageberichtDetailsController.item.get("datum")+" "+f+":"+e).format("HH:MM");DigiWebApp.BautagebuchZeitenDetailsController.set("dauer",
g)}}catch(h){}}},before:{action:function(){}},cancel:{action:function(){}}}})}}}}),bisInput:M.TextFieldView.design({label:M.I18N.l("bookingTo"),contentBindingReverse:{target:DigiWebApp.BautagebuchZeitenDetailsController,property:"bis"},contentBinding:{target:DigiWebApp.BautagebuchZeitenDetailsController,property:"bis"},events:{tap:{action:function(){$(DigiWebApp.BautagebuchZeitenDetailsPage.content.bisInput).blur();M.DatePickerView.show({source:M.ViewManager.getView("bautagebuchZeitenDetailsPage",
"bisInput"),initialDate:D8.create(DigiWebApp.BautagebuchBautageberichtDetailsController.item.get("datum")+" "+DigiWebApp.BautagebuchBautageberichtDetailsController.startUhrzeit),showTimePicker:YES,showDatePicker:NO,showAmPm:NO,dateOrder:"ddmmyy",dateFormat:"dd.mm.yy",timeFormat:"HH:ii",minutesLabel:M.I18N.l("minute"),hoursLabel:M.I18N.l("hour"),dayLabel:M.I18N.l("day"),monthLabel:M.I18N.l("month"),yearLabel:M.I18N.l("year"),dayNamesShort:DigiWebApp.ApplicationController.dayNamesShort,dayNames:DigiWebApp.ApplicationController.dayNames,
monthNamesShort:DigiWebApp.ApplicationController.monthNamesShort,monthNames:DigiWebApp.ApplicationController.monthNames,callbacks:{confirm:{target:this,action:function(a){DigiWebApp.BautagebuchZeitenDetailsController.set("bis",a);DigiWebApp.BautagebuchZeitenDetailsController.set("timeStampEnd",D8.create(DigiWebApp.BautagebuchBautageberichtDetailsController.item.get("datum")+" "+a).getTimestamp());if(DigiWebApp.BautagebuchZeitenDetailsController.get("von")!==null&&DigiWebApp.BautagebuchZeitenDetailsController.get("bis")!==
null)try{var b=D8.create(DigiWebApp.BautagebuchBautageberichtDetailsController.item.get("datum")+" "+DigiWebApp.BautagebuchZeitenDetailsController.get("von")),c=D8.create(DigiWebApp.BautagebuchBautageberichtDetailsController.item.get("datum")+" "+DigiWebApp.BautagebuchZeitenDetailsController.get("bis"));if(b.getTimestamp()<=c.getTimestamp()||DigiWebApp.BautagebuchEinstellungen.find()[0].get("falscheZeitenIgnorieren")){var d=b.timeBetween(c)/6E4,f=parseInt(d/60),e=parseInt(d%60),g=D8.create(DigiWebApp.BautagebuchBautageberichtDetailsController.item.get("datum")+
" "+f+":"+e).format("HH:MM");DigiWebApp.BautagebuchZeitenDetailsController.set("dauer",g)}}catch(h){}}},before:{action:function(){}},cancel:{action:function(){}}}})}}}})}),dauerInput:M.TextFieldView.design({label:M.I18N.l("bookingDuration"),cssClass:"dauerInput",contentBindingReverse:{target:DigiWebApp.BautagebuchZeitenDetailsController,property:"dauer"},contentBinding:{target:DigiWebApp.BautagebuchZeitenDetailsController,property:"dauer"},events:{tap:{action:function(){$(DigiWebApp.BautagebuchZeitenDetailsPage.content.dauerInput).blur();
M.DatePickerView.show({source:M.ViewManager.getView("bautagebuchZeitenDetailsPage","dauerInput"),initialDate:D8.create(DigiWebApp.BautagebuchBautageberichtDetailsController.item.get("datum")+" 00:00:00"),showTimePicker:YES,showDatePicker:NO,showAmPm:NO,dateOrder:"ddmmyy",dateFormat:"dd.mm.yy",timeFormat:"HH:ii",minutesLabel:M.I18N.l("minutes"),hoursLabel:M.I18N.l("hours"),dayLabel:M.I18N.l("day"),monthLabel:M.I18N.l("month"),yearLabel:M.I18N.l("year"),dayNamesShort:DigiWebApp.ApplicationController.dayNamesShort,
dayNames:DigiWebApp.ApplicationController.dayNames,monthNamesShort:DigiWebApp.ApplicationController.monthNamesShort,monthNames:DigiWebApp.ApplicationController.monthNames,callbacks:{confirm:{target:this,action:function(a){DigiWebApp.BautagebuchZeitenDetailsController.set("dauer",a)}},before:{action:function(){}},cancel:{action:function(){}}}})}}}}),grid:M.GridView.design({childViews:"button icon",layout:{cssClass:"digiButton",columns:{0:"button",1:"icon"}},button:M.ButtonView.design({value:M.I18N.l("assume"),
cssClass:"digiButton",anchorLocation:M.RIGHT,events:{tap:{target:DigiWebApp.BautagebuchZeitenDetailsController,action:"save"}}}),icon:M.ImageView.design({value:"theme/images/icon_bookTime.png"})})})});
DigiWebApp.TimeDataSentTemplateView=M.ListItemView.design({isSelectable:NO,childViews:"date order position activity latitude longitude genauigkeit_von eolVon erfassungsverfahren_von gpszeitstempel_von latitude_bis longitude_bis genauigkeit_bis eolBis erfassungsverfahren_bis gpszeitstempel_bis ServiceApp_Status remark gefahreneKilometer",events:{tap:{action:function(){}}},date:M.LabelView.design({cssClass:"date unselectable",computedValue:{valuePattern:"<%= date %>",operation:function(a){a=a.split(",");
var b,c,d;if(typeof a[2]==="undefined"){b=new Date(Number(a[0]));b=M.Date.create(b.getTime());c=null;if(a[1]!=="0"){d=new Date(Number(a[1]));c=M.Date.create(d.getTime())}}else{b=new Date(Number(a[0])+6E4*((new Date).getTimezoneOffset()-Number(a[2])));b=M.Date.create(b.getTime());c=null;if(a[1]!=="0"){d=new Date(Number(a[1])+6E4*((new Date).getTimezoneOffset()-Number(a[2])));c=M.Date.create(d.getTime())}}if(c){b=M.Date.create(b.format("mm/dd/yyyy HH:MM"));c=M.Date.create(c.format("mm/dd/yyyy HH:MM"));
if(b.format("mm/dd/yyyy HH:MM")===c.format("mm/dd/yyyy HH:MM"))return a[3]+", "+a[4]+" - "+a[6]+" "+M.I18N.l("oclock")+", 00:01 h";else{d=b.timeBetween(c,M.MINUTES);d=d<1?M.Math.round(d,M.CEIL):M.Math.round(b.timeBetween(c,M.MINUTES),M.FLOOR);if(d>59){b=M.Math.round(d/60,M.FLOOR);b=b<10?"0"+b:b;d=d%60;d=d<10?"0"+d:d;d=b+":"+d}else d="00:"+(d<10?"0":"")+d;return a[3]+", "+a[4]+" - "+a[6]+" "+M.I18N.l("oclock")+", "+d+" h"}}else return a[3]+", "+a[4]+" - "+M.I18N.l("open")}}}),order:M.LabelView.design({cssClass:"application unselectable",
computedValue:{valuePattern:"<%= orderName %>",operation:function(a){return a!==""?M.I18N.l("order")+": "+a:M.I18N.l("order")+": "+M.I18N.l("notDefined")}}}),position:M.LabelView.design({cssClass:"position unselectable",computedValue:{valuePattern:"<%= positionName %>",operation:function(a){return a!==""?M.I18N.l("position")+": "+a:M.I18N.l("position")+": "+M.I18N.l("notDefined")}}}),activity:M.LabelView.design({cssClass:"activity unselectable",computedValue:{valuePattern:"<%= activityName %>",operation:function(a){return a!==
""?M.I18N.l("activity")+": "+a:M.I18N.l("activity")+": "+M.I18N.l("notDefined")}}}),latitude:M.LabelView.design({cssClass:"location unselectable",isInline:YES,computedValue:{valuePattern:"<%= latitude %>",operation:function(a){if(a>0&&DigiWebApp.SettingsController.getSetting("detailierteZeitdaten")){a=new Number(a);return M.I18N.l("vonKoordinate")+": "+a.toFixed(4)}else return""}}}),longitude:M.LabelView.design({cssClass:"location unselectable",isInline:YES,computedValue:{valuePattern:"<%= longitude %>",
operation:function(a){return a>0&&DigiWebApp.SettingsController.getSetting("detailierteZeitdaten")?", "+(new Number(a)).toFixed(4):""}}}),genauigkeit_von:M.LabelView.design({cssClass:"location unselectable",isInline:YES,computedValue:{valuePattern:"<%= genauigkeitVon %>",operation:function(a){return a>0&&DigiWebApp.SettingsController.getSetting("detailierteZeitdaten")?" ("+M.I18N.l("genauigkeit")+": "+a+" m)":""}}}),eolVon:M.LabelView.design({cssClass:"location unselectable",value:""}),latitude_bis:M.LabelView.design({cssClass:"location unselectable",
isInline:YES,computedValue:{valuePattern:"<%= latitude_bis %>",operation:function(a){if(a>0&&DigiWebApp.SettingsController.getSetting("detailierteZeitdaten")){a=new Number(a);return M.I18N.l("bisKoordinate")+": "+a.toFixed(4)}else return""}}}),longitude_bis:M.LabelView.design({cssClass:"location unselectable",isInline:YES,computedValue:{valuePattern:"<%= longitude_bis %>",operation:function(a){return a>0&&DigiWebApp.SettingsController.getSetting("detailierteZeitdaten")?", "+(new Number(a)).toFixed(4):
""}}}),genauigkeit_bis:M.LabelView.design({cssClass:"location unselectable",isInline:YES,computedValue:{valuePattern:"<%= genauigkeitBis %>",operation:function(a){return a>0&&DigiWebApp.SettingsController.getSetting("detailierteZeitdaten")?" ("+M.I18N.l("genauigkeit")+": "+a+" m)":""}}}),eolBis:M.LabelView.design({cssClass:"location unselectable",value:""}),erfassungsverfahren_von:M.LabelView.design({cssClass:"location unselectable",computedValue:{valuePattern:"<%= ermittlungsverfahrenVon %>",operation:function(a){return a!==
null&&typeof a!=="undefined"&&a!=="undefined"&&DigiWebApp.SettingsController.getSetting("detailierteZeitdaten")?M.I18N.l("erfassungsverfahren_von")+": "+a.substring(0,16)+"...":""}}}),erfassungsverfahren_bis:M.LabelView.design({cssClass:"location unselectable",computedValue:{valuePattern:"<%= ermittlungsverfahrenBis %>",operation:function(a){return a!==null&&typeof a!=="undefined"&&a!=="undefined"&&DigiWebApp.SettingsController.getSetting("detailierteZeitdaten")?M.I18N.l("erfassungsverfahren_bis")+
": "+a.substring(0,16)+"...":""}}}),gpszeitstempel_von:M.LabelView.design({cssClass:"location unselectable",computedValue:{valuePattern:"<%= gps_zeitstempelVon %>",operation:function(a){if(a>0&&DigiWebApp.SettingsController.getSetting("detailierteZeitdaten"))try{var b=M.Date.create(parseInt(a));return M.I18N.l("gpszeitstempel_von")+": "+b.format("dd.mm.yyyy HH:MM")}catch(c){return""}else return""}}}),gpszeitstempel_bis:M.LabelView.design({cssClass:"location unselectable",computedValue:{valuePattern:"<%= gps_zeitstempelBis %>",
operation:function(a){if(a>0&&DigiWebApp.SettingsController.getSetting("detailierteZeitdaten"))try{var b=M.Date.create(parseInt(a));return M.I18N.l("gpszeitstempel_bis")+": "+b.format("dd.mm.yyyy HH:MM")}catch(c){return""}else return""}}}),ServiceApp_Status:M.LabelView.design({cssClass:"location unselectable",computedValue:{valuePattern:"<%= ServiceApp_Status %>",operation:function(a){return a!==null&&DigiWebApp.SettingsController.getSetting("detailierteZeitdaten")&&DigiWebApp.SettingsController.getSetting("debug")?
"Status: "+a:""}}}),remark:M.LabelView.design({cssClass:"remark unselectable",computedValue:{valuePattern:"<%= remark %>",operation:function(a){return a?M.I18N.l("remark")+": "+a:""}}}),gefahreneKilometer:M.LabelView.design({cssClass:"remark",computedValue:{valuePattern:"<%= gefahreneKilometer %>",operation:function(a){return a&&a>0?M.I18N.l("gefahreneKilometer")+": "+a:""}}})});m_require("app/views/TimeDataSentTemplateView");
DigiWebApp.TimeDataArchivePage=M.PageView.design({events:{pagebeforeshow:{target:DigiWebApp.BookingController,action:"setArchivedBookings"}},childViews:"header contentSent",cssClass:"timeDataPage unselectable",header:M.ToolbarView.design({childViews:"backButton title",cssClass:"header unselectable",isFixed:YES,backButton:M.ButtonView.design({value:M.I18N.l("back"),icon:"arrow-l",anchorLocation:M.LEFT,events:{tap:{target:DigiWebApp.NavigationController,action:function(){try{DigiWebApp.ApplicationController.vibrate()}catch(a){}this.backToTimeDataPage()}}}}),
title:M.LabelView.design({value:M.I18N.l("archivedTimeData"),anchorLocation:M.CENTER}),anchorLocation:M.TOP}),contentSent:M.ScrollView.design({childViews:"list",cssClass:"sentBookings",list:M.ListView.design({contentBinding:{target:DigiWebApp.BookingController,property:"timeDataSentArchived"},listItemTemplateView:DigiWebApp.TimeDataSentTemplateView})})});
DigiWebApp.MediaActionTemplateView=M.ListItemView.design({isSelectable:NO,childViews:"icon label",events:{tap:{target:DigiWebApp.MediaListController,action:"itemSelected"}},icon:M.ImageView.design({computedValue:{valuePattern:"<%= icon %>",operation:function(a){return"theme/images/"+a}}}),label:M.LabelView.design({valuePattern:"<%= label %>"})});
DigiWebApp.TimeDataForEditTemplateView=M.ListItemView.design({isSelectable:NO,childViews:"date order position activity latitude longitude",events:{tap:{action:function(){}}},date:M.LabelView.design({cssClass:"date",computedValue:{valuePattern:"<%= date %>",operation:function(a){var b=a.split(","),c;if(typeof b[2]==="undefined"){a=new Date(Number(b[0]));a=M.Date.create(a.getTime());c=null;if(b[1]!=="0"){c=new Date(Number(b[1]));c=M.Date.create(c.getTime())}}else{a=new Date(Number(b[0])+6E4*((new Date).getTimezoneOffset()-
Number(b[2])));a=M.Date.create(a.getTime());c=null;if(b[1]!=="0"){c=new Date(Number(b[1])+6E4*((new Date).getTimezoneOffset()-Number(b[2])));c=M.Date.create(c.getTime())}}if(c){a=M.Date.create(a.format("mm/dd/yyyy HH:MM"));c=M.Date.create(c.format("mm/dd/yyyy HH:MM"));if(a.format("mm/dd/yyyy HH:MM")===c.format("mm/dd/yyyy HH:MM"))return a.format("dd.mm.yyyy")+", "+a.format("HH:MM")+" - "+c.format("HH:MM")+" "+M.I18N.l("oclock")+", 00:01 h";else{var d=a.timeBetween(c,M.MINUTES);d=d<1?M.Math.round(d,
M.CEIL):M.Math.round(a.timeBetween(c,M.MINUTES),M.FLOOR);if(d>59){b=M.Math.round(d/60,M.FLOOR);b=b<10?"0"+b:b;d=d%60;d=d<10?"0"+d:d;d=b+":"+d}else d="00:"+(d<10?"0":"")+d;return a.format("dd.mm.yyyy")+", "+a.format("HH:MM")+" - "+c.format("HH:MM")+" "+M.I18N.l("oclock")+", "+d+" h"}}else return a.format("dd.mm.yyyy")+", "+a.format("HH:MM")+" - "+M.I18N.l("now")+" ("+M.Date.create().format("HH:MM")+")"}}}),order:M.LabelView.design({cssClass:"application",computedValue:{valuePattern:"<%= orderId %>",
operation:function(a){var b=_.select(DigiWebApp.Order.findSorted().concat(DigiWebApp.HandOrder.findSorted()),function(c){if(c)return a==c.get("id")||a==c.get("name")});if(b&&b.length>0){b=b[0];return DigiWebApp.SettingsController.globalDebugMode?M.I18N.l("order")+": "+b.get("name")+" ("+b.get("id")+")":M.I18N.l("order")+": "+b.get("name")}else return M.I18N.l("order")+": "+M.I18N.l("notDefined")}}}),position:M.LabelView.design({cssClass:"position",computedValue:{valuePattern:"<%= positionId %>",operation:function(a){if(a){var b=
_.select(DigiWebApp.Position.findSorted(),function(c){if(c)return a==c.get("id")});if(b&&b.length>0){b=b[0];return M.I18N.l("position")+": "+b.get("name")}else return M.I18N.l("position")+": "+M.I18N.l("notDefined")}else return M.I18N.l("position")+": "+M.I18N.l("unknown")}}}),activity:M.LabelView.design({cssClass:"activity",computedValue:{valuePattern:"<%= activityId %>",operation:function(a){if(a){var b=null;if(parseInt(a)!==0)b=_.select(DigiWebApp.Activity.findSorted(),function(c){if(c)return a==
c.get("id")});if(b&&b.length>0){b=b[0];return M.I18N.l("activity")+": "+b.get("name")}else return M.I18N.l("activity")+": "+M.I18N.l("notDefined")}else return M.I18N.l("activity")+": "+M.I18N.l("unknown")}}}),latitude:M.LabelView.design({cssClass:"location",computedValue:{valuePattern:"<%= latitude %>",operation:function(a){if(a>0){a=new Number(a);return M.I18N.l("latitude")+": "+a.toFixed(6)}else return""}}}),longitude:M.LabelView.design({cssClass:"location",computedValue:{valuePattern:"<%= longitude %>",
operation:function(a){if(a>0){a=new Number(a);return M.I18N.l("longitude")+": "+a.toFixed(6)}else return""}}}),remark:M.LabelView.design({cssClass:"remark",computedValue:{valuePattern:"<%= remark %>",operation:function(a){return a?M.I18N.l("remark")+": "+a:""}}})});m_require("app/views/TimeDataForEditTemplateView");
DigiWebApp.EditTimeDataPage=M.PageView.design({bookingToEdit:null,signaturePadAPI:null,events:{pagebeforeshow:{action:function(){DigiWebApp.BookingController.setTimeDataForEdit();if(DigiWebApp.SettingsController.featureAvailable("405")&&typeof window.requestFileSystem!=="undefined"){$("#"+DigiWebApp.EditTimeDataPage.content.signature.id).show();var a={bgColour:"#fff",lineTop:130,drawOnly:true};if(DigiWebApp.EditTimeDataPage.signaturePadAPI===null)DigiWebApp.EditTimeDataPage.signaturePadAPI=$(".sigPad").signaturePad(a)}else $("#"+
DigiWebApp.EditTimeDataPage.content.signature.id).hide();if(typeof DigiWebApp.EditTimeDataPage.bookingToEdit!=="undefined"&&DigiWebApp.EditTimeDataPage.bookingToEdit!==null)if(typeof DigiWebApp.EditTimeDataPage.bookingToEdit.get("remark")!=="undefined"&&DigiWebApp.EditTimeDataPage.bookingToEdit.get("remark")!==null){$("#"+DigiWebApp.EditTimeDataPage.content.remarkInput.id).val(DigiWebApp.EditTimeDataPage.bookingToEdit.get("remark"));M.ViewManager.getView("editTimeDataPage","remarkInput").value=DigiWebApp.EditTimeDataPage.bookingToEdit.get("remark")}else{$("#"+
DigiWebApp.EditTimeDataPage.content.remarkInput.id).val("");M.ViewManager.getView("editTimeDataPage","remarkInput").value=""}else{$("#"+DigiWebApp.EditTimeDataPage.content.remarkInput.id).val("");M.ViewManager.getView("editTimeDataPage","remarkInput").value=""}if(typeof DigiWebApp.EditTimeDataPage.bookingToEdit!=="undefined"&&DigiWebApp.EditTimeDataPage.bookingToEdit!==null)if(typeof DigiWebApp.EditTimeDataPage.bookingToEdit.get("gefahreneKilometer")!=="undefined"&&DigiWebApp.EditTimeDataPage.bookingToEdit.get("gefahreneKilometer")!==
null){$("#"+DigiWebApp.EditTimeDataPage.content.gefahreneKilometerInput.id).val(DigiWebApp.EditTimeDataPage.bookingToEdit.get("gefahreneKilometer"));M.ViewManager.getView("editTimeDataPage","gefahreneKilometerInput").value=DigiWebApp.EditTimeDataPage.bookingToEdit.get("gefahreneKilometer")}else{$("#"+DigiWebApp.EditTimeDataPage.content.gefahreneKilometerInput.id).val("0");M.ViewManager.getView("editTimeDataPage","gefahreneKilometerInput").value="0"}else{$("#"+DigiWebApp.EditTimeDataPage.content.gefahreneKilometerInput.id).val("0");
M.ViewManager.getView("editTimeDataPage","gefahreneKilometerInput").value="0"}if(DigiWebApp.SettingsController.featureAvailable("403")){$("[for="+DigiWebApp.EditTimeDataPage.content.remarkInput.id+"]").each(function(){$(this).show()});$("[id="+DigiWebApp.EditTimeDataPage.content.remarkInput.id+"]").each(function(){$(this).show()})}else{$("[for="+DigiWebApp.EditTimeDataPage.content.remarkInput.id+"]").each(function(){$(this).hide()});$("[id="+DigiWebApp.EditTimeDataPage.content.remarkInput.id+"]").each(function(){$(this).hide()})}if(DigiWebApp.SettingsController.featureAvailable("422"))if(typeof DigiWebApp.BookingController.currentBooking!==
"undefined"&&DigiWebApp.BookingController.currentBooking!==null){var b=null;_.each(DigiWebApp.Activity.find(),function(c){if(c.get("id")===parseInt(DigiWebApp.BookingController.currentBooking.get("activityId")))b=c});if(b!==null&&b.get("istFahrzeitRelevant")){$("[for="+DigiWebApp.EditTimeDataPage.content.gefahreneKilometerInput.id+"]").each(function(){$(this).show()});$("[id="+DigiWebApp.EditTimeDataPage.content.gefahreneKilometerInput.id+"]").each(function(){$(this).show()})}else{$("[for="+DigiWebApp.EditTimeDataPage.content.gefahreneKilometerInput.id+
"]").each(function(){$(this).hide()});$("[id="+DigiWebApp.EditTimeDataPage.content.gefahreneKilometerInput.id+"]").each(function(){$(this).hide()})}}else{$("[for="+DigiWebApp.EditTimeDataPage.content.gefahreneKilometerInput.id+"]").each(function(){$(this).hide()});$("[id="+DigiWebApp.EditTimeDataPage.content.gefahreneKilometerInput.id+"]").each(function(){$(this).hide()})}else{$("[for="+DigiWebApp.EditTimeDataPage.content.gefahreneKilometerInput.id+"]").each(function(){$(this).hide()});$("[id="+DigiWebApp.EditTimeDataPage.content.gefahreneKilometerInput.id+
"]").each(function(){$(this).hide()})}DigiWebApp.SettingsController.featureAvailable("405")&&typeof window.requestFileSystem!=="undefined"&&DigiWebApp.EditTimeDataPage.bookingToEdit.readFromFile(function(c){c&&c!==""?DigiWebApp.EditTimeDataPage.signaturePadAPI.regenerate(c):DigiWebApp.EditTimeDataPage.signaturePadAPI.clearCanvas()},function(){DigiWebApp.EditTimeDataPage.signaturePadAPI.clearCanvas()})}}},myCallback:function(){},tab_action_timeoutvar:null,tab_action:function(){clearTimeout(DigiWebApp.EditTimeDataPage.tab_action_timeoutvar);
var a="";if(DigiWebApp.SettingsController.featureAvailable("405")&&typeof window.requestFileSystem!=="undefined")a=DigiWebApp.EditTimeDataPage.signaturePadAPI.getSignatureString();if(M.ViewManager.getView("editTimeDataPage","remarkInput").value.length>255){DigiWebApp.ApplicationController.DigiLoaderView.hide();DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("remarkTooLong"),message:M.I18N.l("remarkTooLongMessage")})}else if(DigiWebApp.SettingsController.getSetting("remarkIsMandatory")&&
M.ViewManager.getView("editTimeDataPage","remarkInput").value===""){DigiWebApp.ApplicationController.DigiLoaderView.hide();DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("remarkIsMandatory"),message:M.I18N.l("remarkIsMandatoryMessage")})}else if(DigiWebApp.ApplicationController.sonderzeichenCheck(M.ViewManager.getView("editTimeDataPage","remarkInput").value)){DigiWebApp.ApplicationController.DigiLoaderView.hide();DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("specialCharProblem"),
message:M.I18N.l("specialCharProblemMsg")})}else{DigiWebApp.EditTimeDataPage.bookingToEdit.set("remark",M.ViewManager.getView("editTimeDataPage","remarkInput").value);DigiWebApp.EditTimeDataPage.bookingToEdit.set("gefahreneKilometer",M.ViewManager.getView("editTimeDataPage","gefahreneKilometerInput").value);DigiWebApp.EditTimeDataPage.bookingToEdit.save();if(a!==""){DigiWebApp.EditTimeDataPage.bookingToEdit.set("fileType",DigiWebApp.ApplicationController.CONSTTextFiletype);DigiWebApp.EditTimeDataPage.bookingToEdit.set("unterschrift_breite",
DigiWebApp.EditTimeDataPage.content.signature.signatureform.signaturecanvas.canvasWidth);DigiWebApp.EditTimeDataPage.bookingToEdit.set("unterschrift_hoehe",DigiWebApp.EditTimeDataPage.content.signature.signatureform.signaturecanvas.canvasHeight);DigiWebApp.EditTimeDataPage.bookingToEdit.save();DigiWebApp.EditTimeDataPage.bookingToEdit.saveToFile(a,DigiWebApp.EditTimeDataPage.myCallback)}else DigiWebApp.EditTimeDataPage.myCallback()}},childViews:"header content",cssClass:"remarkPage",header:M.ToolbarView.design({childViews:"backButton title",
cssClass:"header",isFixed:YES,backButton:M.ButtonView.design({value:M.I18N.l("back"),icon:"arrow-l",anchorLocation:M.LEFT,events:{tap:{target:DigiWebApp.NavigationController,action:function(){try{DigiWebApp.ApplicationController.vibrate()}catch(a){}this.backToTimeDataPage()}}}}),title:M.LabelView.design({value:M.I18N.l("EditTimeDataPageTitle"),anchorLocation:M.CENTER}),anchorLocation:M.TOP}),content:M.ScrollView.design({childViews:"orderbox remarkInput gefahreneKilometerInput signature saveGrid",
orderbox:M.ListView.design({contentBinding:{target:DigiWebApp.BookingController,property:"timeDataForEdit"},listItemTemplateView:DigiWebApp.TimeDataForEditTemplateView}),remarkInput:M.TextFieldView.design({label:M.I18N.l("remark"),cssClass:"remarkInput",hasMultipleLines:YES,initialText:"max. 255 "+M.I18N.l("characters"),numberOfChars:255}),gefahreneKilometerInput:M.TextFieldView.design({label:M.I18N.l("gefahreneKilometer"),cssClass:"remarkInput",hasMultipleLines:NO,inputType:M.INPUT_NUMBER}),signature:M.ContainerView.design({childViews:"signatureform",
cssClass:"signaturecanvas marginTop20 marginBottom20",signatureform:M.FormView.design({childViews:"signaturecanvas",signaturecanvas:M.CanvasView.design({label:M.I18N.l("signature"),canvasWidth:300,canvasHeight:150,render:function(){if(this.label)this.html+='<label for="'+this.id+'" class="signaturecanvaslabel">'+this.label+"</label>";this.html+='  <div id="'+this.id+'_container" class="sig sigWrapper">';this.html+='    <canvas id="'+this.id+'_canvas" class="pad" width="'+this.canvasWidth+'px" height="'+
this.canvasHeight+'px"></canvas>';this.html+='    <input id="'+this.id+'" type="hidden" name="output" class="output">';this.html+="  </div>";return this.html}}),render:function(){this.html+='<form method="post" action="" class="sigPad">';this.renderChildViews();this.html+="</form>";return this.html}})}),saveGrid:M.GridView.design({childViews:"saveButton icon",layout:{cssClass:"digiButton marginTop25",columns:{0:"saveRemarkButton",1:"icon"}},saveButton:M.ButtonView.design({value:M.I18N.l("assume"),
cssClass:"digiButton",anchorLocation:M.RIGHT,events:{tap:{action:function(){try{DigiWebApp.ApplicationController.vibrate()}catch(a){}DigiWebApp.ApplicationController.DigiLoaderView.show(M.I18N.l("Save"));DigiWebApp.EditTimeDataPage.tab_action_timeoutvar=setTimeout("DigiWebApp.EditTimeDataPage.tab_action();",50)}}}}),icon:M.ImageView.design({value:"theme/images/icon_bookTime.png"})})})});m_require("app/views/TimeDataForEditTemplateView");
DigiWebApp.RemarkPage=M.PageView.design({events:{pagebeforeshow:{action:function(){DigiWebApp.BookingController.setTimeDataForRemark();if(DigiWebApp.SettingsController.featureAvailable("403")){$("[for="+DigiWebApp.RemarkPage.content.remarkInput.id+"]").each(function(){$(this).show()});$("[id="+DigiWebApp.RemarkPage.content.remarkInput.id+"]").each(function(){$(this).show()})}else{$("[for="+DigiWebApp.RemarkPage.content.remarkInput.id+"]").each(function(){$(this).hide()});$("[id="+DigiWebApp.RemarkPage.content.remarkInput.id+
"]").each(function(){$(this).hide()})}if(DigiWebApp.SettingsController.featureAvailable("422"))if(typeof DigiWebApp.BookingController.currentBooking!=="undefined"&&DigiWebApp.BookingController.currentBooking!==null){var a=null;_.each(DigiWebApp.Activity.find(),function(b){if(b.get("id")===parseInt(DigiWebApp.BookingController.currentBooking.get("activityId")))a=b});if(a!==null&&a.get("istFahrzeitRelevant")){$("[for="+DigiWebApp.RemarkPage.content.gefahreneKilometerInput.id+"]").each(function(){$(this).show()});
$("[id="+DigiWebApp.RemarkPage.content.gefahreneKilometerInput.id+"]").each(function(){$(this).show()})}else{$("[for="+DigiWebApp.RemarkPage.content.gefahreneKilometerInput.id+"]").each(function(){$(this).hide()});$("[id="+DigiWebApp.RemarkPage.content.gefahreneKilometerInput.id+"]").each(function(){$(this).hide()})}}else{$("[for="+DigiWebApp.RemarkPage.content.gefahreneKilometerInput.id+"]").each(function(){$(this).hide()});$("[id="+DigiWebApp.RemarkPage.content.gefahreneKilometerInput.id+"]").each(function(){$(this).hide()})}else{$("[for="+
DigiWebApp.RemarkPage.content.gefahreneKilometerInput.id+"]").each(function(){$(this).hide()});$("[id="+DigiWebApp.RemarkPage.content.gefahreneKilometerInput.id+"]").each(function(){$(this).hide()})}if(typeof DigiWebApp.BookingController.currentBooking!=="undefined"&&DigiWebApp.BookingController.currentBooking!==null)if(typeof DigiWebApp.BookingController.currentBooking.get("remark")!=="undefined"&&DigiWebApp.BookingController.currentBooking.get("remark")!==null){$("#"+DigiWebApp.RemarkPage.content.remarkInput.id).val(DigiWebApp.BookingController.currentBooking.get("remark"));
M.ViewManager.getView("remarkPage","remarkInput").value=DigiWebApp.BookingController.currentBooking.get("remark")}else{$("#"+DigiWebApp.RemarkPage.content.remarkInput.id).val("");M.ViewManager.getView("remarkPage","remarkInput").value=""}else{$("#"+DigiWebApp.RemarkPage.content.remarkInput.id).val("");M.ViewManager.getView("remarkPage","remarkInput").value=""}$("#"+DigiWebApp.RemarkPage.content.remarkInput.id)[0].focus();$("#"+DigiWebApp.RemarkPage.content.remarkInput.id)[0].blur();if(typeof DigiWebApp.BookingController.currentBooking!==
"undefined"&&DigiWebApp.BookingController.currentBooking!==null)if(typeof DigiWebApp.BookingController.currentBooking.get("gefahreneKilometer")!=="undefined"&&DigiWebApp.BookingController.currentBooking.get("gefahreneKilometer")!==null){$("#"+DigiWebApp.RemarkPage.content.gefahreneKilometerInput.id).val(DigiWebApp.BookingController.currentBooking.get("gefahreneKilometer"));M.ViewManager.getView("remarkPage","gefahreneKilometerInput").value=DigiWebApp.BookingController.currentBooking.get("gefahreneKilometer")}else{$("#"+
DigiWebApp.RemarkPage.content.gefahreneKilometerInput.id).val("0");M.ViewManager.getView("remarkPage","gefahreneKilometerInput").value="0"}else{$("#"+DigiWebApp.RemarkPage.content.gefahreneKilometerInput.id).val("0");M.ViewManager.getView("remarkPage","gefahreneKilometerInput").value="0"}}}},myCallback:function(){},tab_action_timeoutvar:null,tab_action:function(){clearTimeout(DigiWebApp.RemarkPage.tab_action_timeoutvar);if(M.ViewManager.getView("remarkPage","remarkInput").value.length>255){DigiWebApp.ApplicationController.DigiLoaderView.hide();
DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("remarkTooLong"),message:M.I18N.l("remarkTooLongMessage")})}else if(DigiWebApp.SettingsController.getSetting("remarkIsMandatory")&&M.ViewManager.getView("remarkPage","remarkInput").value===""){DigiWebApp.ApplicationController.DigiLoaderView.hide();DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("remarkIsMandatory"),message:M.I18N.l("remarkIsMandatoryMessage")})}else if(DigiWebApp.ApplicationController.sonderzeichenCheck(M.ViewManager.getView("remarkPage",
"remarkInput").value)){DigiWebApp.ApplicationController.DigiLoaderView.hide();DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("specialCharProblem"),message:M.I18N.l("specialCharProblemMsg")})}else{DigiWebApp.BookingController.currentBooking.set("remark",M.ViewManager.getView("remarkPage","remarkInput").value);DigiWebApp.BookingController.currentBooking.set("gefahreneKilometer",parseInt(M.ViewManager.getView("remarkPage","gefahreneKilometerInput").value));DigiWebApp.BookingController.currentBooking.save();
DigiWebApp.RemarkPage.myCallback()}},childViews:"header content",cssClass:"remarkPage",header:M.ToolbarView.design({childViews:"backButton title",cssClass:"header",isFixed:YES,backButton:M.ButtonView.design({value:M.I18N.l("back"),icon:"arrow-l",anchorLocation:M.LEFT,events:{tap:{target:DigiWebApp.NavigationController,action:function(){try{DigiWebApp.ApplicationController.vibrate()}catch(a){}this.backToBookTimePagePOP()}}}}),title:M.LabelView.design({value:M.I18N.l("remark"),anchorLocation:M.CENTER}),
anchorLocation:M.TOP}),content:M.ScrollView.design({childViews:"orderbox remarkInput gefahreneKilometerInput grid",orderbox:M.ListView.design({contentBinding:{target:DigiWebApp.BookingController,property:"timeDataForEdit"},listItemTemplateView:DigiWebApp.TimeDataForEditTemplateView}),remarkInput:M.TextFieldView.design({label:M.I18N.l("remark"),cssClass:"remarkInput",hasMultipleLines:YES,initialText:"max. 255 "+M.I18N.l("characters"),numberOfChars:255}),gefahreneKilometerInput:M.TextFieldView.design({label:M.I18N.l("gefahreneKilometer"),
cssClass:"remarkInput",hasMultipleLines:NO,inputType:M.INPUT_NUMBER}),grid:M.GridView.design({childViews:"button icon",layout:{cssClass:"digiButton marginTop25",columns:{0:"button",1:"icon"}},button:M.ButtonView.design({value:M.I18N.l("closeBooking"),cssClass:"digiButton",anchorLocation:M.RIGHT,events:{tap:{action:function(){DigiWebApp.ApplicationController.DigiLoaderView.show(M.I18N.l("Save"));DigiWebApp.RemarkPage.tab_action_timeoutvar=setTimeout("DigiWebApp.RemarkPage.tab_action();",50)}}}}),icon:M.ImageView.design({value:"theme/images/icon_bookTime.png"})})})});
DigiWebApp.BautagebuchZusammenfassungMitarbeiterZeitenTemplateView=M.ListItemView.design({isSelectable:NO,childViews:"name summe",events:{tap:{action:function(){}}},name:M.LabelView.design({cssClass:"normal unselectable bigLabel",isInline:YES,computedValue:{valuePattern:"<%= id %>",operation:function(a){var b=_.find(DigiWebApp.BautagebuchMitarbeiter.find(),function(c){return parseInt(c.get("id"))===a});return typeof b!=="undefined"?b.vollername():a}}}),summe:M.LabelView.design({cssClass:"normal unselectable bigLabel right",
isInline:YES,computedValue:{valuePattern:"<%= id %>",operation:function(a){return a}}})});DigiWebApp.DashboardTemplateView=M.ListItemView.design({isSelectable:NO,childViews:"icon label",events:{tap:{target:DigiWebApp.DashboardController,action:"itemSelected"}},icon:M.ImageView.design({cssClass:"unselectable",computedValue:{valuePattern:"<%= icon %>",operation:function(a){return"theme/images/"+a}}}),label:M.LabelView.design({cssClass:"unselectable",valuePattern:"<%= label %>"})});
DigiWebApp.ZeitbuchungDetailsPage=M.PageView.design({updateContent:function(){_.each(DigiWebApp.ZeitbuchungDetailsPage.content,function(a){try{a.id!==DigiWebApp.ZeitbuchungDetailsPage.content.infoButton.id&&a.id!==DigiWebApp.ZeitbuchungDetailsPage.content.showBookingCoordinatesInMapButton.id&&a.id!==DigiWebApp.ZeitbuchungDetailsPage.content.showPositionCoordinatesInMapButton.id&&a.renderUpdate()}catch(b){}})},cssClass:"zeitbuchungDetailsPage",childViews:"header content",header:M.ToolbarView.design({childViews:"backButton title",
cssClass:"header unselectable",isFixed:YES,backButton:M.ButtonView.design({value:M.I18N.l("back"),icon:"arrow-l",anchorLocation:M.LEFT,events:{tap:{target:DigiWebApp.NavigationController,action:"backToZeitbuchungenPageTransition"}}}),title:M.LabelView.design({value:M.I18N.l("Zeitbuchung"),anchorLocation:M.CENTER}),anchorLocation:M.TOP}),content:M.ScrollView.design({childViews:"datum von bis spacerNachBis dauer infoButton spacerNachButton order position handApplications activity activityPositionInWorkplan spacerNachActivityPositionInWorkplan remark farbeAmpel gpsBreite gpsLaenge showBookingCoordinatesInMapButton gpsBreitePosition gpsLaengePosition showPositionCoordinatesInMapButton",
cssClass:"content",datum:M.LabelView.design({computedValue:{value:"",operation:function(){if(DigiWebApp.ZeitbuchungenController.itemForDetails!==null)return DigiWebApp.ZeitbuchungenController.itemForDetails.get("datum")+", "}},isInline:YES,cssClass:"datum unselectable"}),von:M.LabelView.design({computedValue:{value:"",operation:function(){return DigiWebApp.ZeitbuchungenController.itemForDetails!==null?DigiWebApp.ZeitbuchungenController.itemForDetails.get("bis")===""||DigiWebApp.ZeitbuchungenController.itemForDetails.get("bis")===
"-"?M.I18N.l("since")+" "+DigiWebApp.ZeitbuchungenController.itemForDetails.get("von"):DigiWebApp.ZeitbuchungenController.itemForDetails.get("von"):""}},isInline:YES,cssClass:"von marginBottom20 unselectable"}),bis:M.LabelView.design({computedValue:{value:"",operation:function(){return DigiWebApp.ZeitbuchungenController.itemForDetails!==null?DigiWebApp.ZeitbuchungenController.itemForDetails.get("bis")!==""&&DigiWebApp.ZeitbuchungenController.itemForDetails.get("bis")!=="-"?" - "+DigiWebApp.ZeitbuchungenController.itemForDetails.get("bis"):
"":""}},isInline:YES,cssClass:"bis marginBottom20 unselectable"}),spacerNachBis:M.LabelView.design({value:" "}),dauer:M.LabelView.design({computedValue:{value:"",operation:function(){return DigiWebApp.ZeitbuchungenController.itemForDetails!==null?DigiWebApp.ZeitbuchungenController.itemForDetails.get("dauer")!==""&&DigiWebApp.ZeitbuchungenController.itemForDetails.get("dauer")!=="-"&&typeof DigiWebApp.ZeitbuchungenController.itemForDetails.get("dauer")!=="undefined"&&DigiWebApp.ZeitbuchungenController.itemForDetails.get("bis")!==
""&&DigiWebApp.ZeitbuchungenController.itemForDetails.get("bis")!=="-"?M.I18N.l("dauer")+": "+DigiWebApp.ZeitbuchungenController.itemForDetails.get("dauer"):"":""}},cssClass:"dauer unselectable"}),order:M.LabelView.design({computedValue:{value:"",operation:function(){return DigiWebApp.ZeitbuchungenController.itemForDetails!==null?DigiWebApp.ZeitbuchungenController.itemForDetails.get("auftragsBezeichnung")!==""&&typeof DigiWebApp.ZeitbuchungenController.itemForDetails.get("auftragsBezeichnung")!==
"undefined"&&DigiWebApp.ZeitbuchungenController.itemForDetails.get("auftragsBezeichnung")!=="null"&&DigiWebApp.ZeitbuchungenController.itemForDetails.get("auftragsBezeichnung")!==null?M.I18N.l("order")+": "+DigiWebApp.ZeitbuchungenController.itemForDetails.get("auftragsBezeichnung"):M.I18N.l("order")+": -":M.I18N.l("order")+": -"}},cssClass:"normalDetail marginLeft35 moveUp38 unselectable"}),position:M.LabelView.design({computedValue:{value:"",operation:function(){return DigiWebApp.ZeitbuchungenController.itemForDetails!==
null?DigiWebApp.ZeitbuchungenController.itemForDetails.get("positionsBezeichnung")!==""&&typeof DigiWebApp.ZeitbuchungenController.itemForDetails.get("positionsBezeichnung")!=="undefined"&&DigiWebApp.ZeitbuchungenController.itemForDetails.get("positionsBezeichnung")!=="null"&&DigiWebApp.ZeitbuchungenController.itemForDetails.get("positionsBezeichnung")!==null?M.I18N.l("position")+": "+DigiWebApp.ZeitbuchungenController.itemForDetails.get("positionsBezeichnung"):M.I18N.l("position")+": -":M.I18N.l("position")+
": -"}},cssClass:"normalDetail marginLeft35 marginTop0 marginBottom10 unselectable"}),infoButton:M.ButtonView.design({computedValue:{value:"",operation:function(){return"?"}},anchorLocation:M.LEFT,cssClass:"posInfoButton",events:{tap:{target:DigiWebApp.NavigationController,action:"toOrderDetailsPageTransition"}},isInline:YES}),spacerNachButton:M.LabelView.design({value:" ",isInline:YES}),handApplications:M.LabelView.design({computedValue:{value:"",operation:function(){return DigiWebApp.ZeitbuchungenController.itemForDetails!==
null?DigiWebApp.ZeitbuchungenController.itemForDetails.get("handauftragsBezeichnung")!==""&&typeof DigiWebApp.ZeitbuchungenController.itemForDetails.get("handauftragsBezeichnung")!=="undefined"&&DigiWebApp.ZeitbuchungenController.itemForDetails.get("handauftragsBezeichnung")!=="null"&&DigiWebApp.ZeitbuchungenController.itemForDetails.get("handauftragsBezeichnung")!==null?M.I18N.l("handApplications")+": "+DigiWebApp.ZeitbuchungenController.itemForDetails.get("handauftragsBezeichnung"):"":""}},cssClass:"normalDetail unselectable"}),
activity:M.LabelView.design({computedValue:{value:"",operation:function(){return DigiWebApp.ZeitbuchungenController.itemForDetails!==null?DigiWebApp.ZeitbuchungenController.itemForDetails.get("taetigkeit")!==""&&typeof DigiWebApp.ZeitbuchungenController.itemForDetails.get("taetigkeit")!=="undefined"&&DigiWebApp.ZeitbuchungenController.itemForDetails.get("taetigkeit")!=="null"&&DigiWebApp.ZeitbuchungenController.itemForDetails.get("taetigkeit")!==null?M.I18N.l("activity")+": "+DigiWebApp.ZeitbuchungenController.itemForDetails.get("taetigkeit"):
"":""}},isInline:YES,cssClass:"normalDetail unselectable"}),activityPositionInWorkplan:M.LabelView.design({computedValue:{value:"",operation:function(){return DigiWebApp.ZeitbuchungenController.itemForDetails!==null?DigiWebApp.ZeitbuchungenController.itemForDetails.get("taetigkeitreihenfolge")!==""&&typeof DigiWebApp.ZeitbuchungenController.itemForDetails.get("taetigkeitreihenfolge")!=="undefined"&&DigiWebApp.ZeitbuchungenController.itemForDetails.get("taetigkeitreihenfolge")!=="null"&&DigiWebApp.ZeitbuchungenController.itemForDetails.get("taetigkeitreihenfolge")!==
null?" ("+DigiWebApp.ZeitbuchungenController.itemForDetails.get("taetigkeitreihenfolge")+")":"":""}},isInline:YES,cssClass:"normalDetail unselectable"}),spacerNachActivityPositionInWorkplan:M.LabelView.design({value:" "}),remark:M.LabelView.design({computedValue:{value:"",operation:function(){return DigiWebApp.ZeitbuchungenController.itemForDetails!==null?DigiWebApp.ZeitbuchungenController.itemForDetails.get("remark")!==""&&typeof DigiWebApp.ZeitbuchungenController.itemForDetails.get("remark")!==
"undefined"&&DigiWebApp.ZeitbuchungenController.itemForDetails.get("remark")!=="null"&&DigiWebApp.ZeitbuchungenController.itemForDetails.get("remark")!==null?M.I18N.l("remark")+": "+DigiWebApp.ZeitbuchungenController.itemForDetails.get("remark"):"":""}},cssClass:"normalDetail unselectable"}),gpsBreite:M.LabelView.design({computedValue:{value:"",operation:function(){if(DigiWebApp.ZeitbuchungenController.itemForDetails!==null)if(DigiWebApp.ZeitbuchungenController.itemForDetails.get("gpsBreite")!==""&&
typeof DigiWebApp.ZeitbuchungenController.itemForDetails.get("gpsBreite")!=="undefined"&&DigiWebApp.ZeitbuchungenController.itemForDetails.get("gpsBreite")!=="0.0"&&DigiWebApp.ZeitbuchungenController.itemForDetails.get("gpsBreite")!==0&&DigiWebApp.ZeitbuchungenController.itemForDetails.get("gpsBreite")!==null){$("#"+DigiWebApp.ZeitbuchungDetailsPage.content.showBookingCoordinatesInMapButton.id).show();var a=new Number(DigiWebApp.ZeitbuchungenController.itemForDetails.get("gpsBreite"));return M.I18N.l("booking")+
"-"+M.I18N.l("latitude")+": "+a.toFixed(6)}else{$("#"+DigiWebApp.ZeitbuchungDetailsPage.content.showBookingCoordinatesInMapButton.id).hide();return""}else{$("#"+DigiWebApp.ZeitbuchungDetailsPage.content.showBookingCoordinatesInMapButton.id).hide();return""}}},cssClass:"smallDetail marginTop12 unselectable"}),gpsLaenge:M.LabelView.design({computedValue:{value:"",operation:function(){if(DigiWebApp.ZeitbuchungenController.itemForDetails!==null)if(DigiWebApp.ZeitbuchungenController.itemForDetails.get("gpsLaenge")!==
""&&typeof DigiWebApp.ZeitbuchungenController.itemForDetails.get("gpsLaenge")!=="undefined"&&DigiWebApp.ZeitbuchungenController.itemForDetails.get("gpsLaenge")!=="0.0"&&DigiWebApp.ZeitbuchungenController.itemForDetails.get("gpsLaenge")!==0&&DigiWebApp.ZeitbuchungenController.itemForDetails.get("gpsLaenge")!==null){$("#"+DigiWebApp.ZeitbuchungDetailsPage.content.showBookingCoordinatesInMapButton.id).show();var a=new Number(DigiWebApp.ZeitbuchungenController.itemForDetails.get("gpsLaenge"));return M.I18N.l("booking")+
"-"+M.I18N.l("longitude")+": "+a.toFixed(6)}else{$("#"+DigiWebApp.ZeitbuchungDetailsPage.content.showBookingCoordinatesInMapButton.id).hide();return""}else{$("#"+DigiWebApp.ZeitbuchungDetailsPage.content.showBookingCoordinatesInMapButton.id).hide();return""}}},cssClass:"smallDetail unselectable"}),gpsBreitePosition:M.LabelView.design({computedValue:{value:"",operation:function(){if(DigiWebApp.ZeitbuchungenController.itemForDetails!==null)if(DigiWebApp.ZeitbuchungenController.itemForDetails.get("gpsBreitePosition")!==
""&&typeof DigiWebApp.ZeitbuchungenController.itemForDetails.get("gpsBreitePosition")!=="undefined"&&DigiWebApp.ZeitbuchungenController.itemForDetails.get("gpsBreitePosition")!=="0.0"&&DigiWebApp.ZeitbuchungenController.itemForDetails.get("gpsBreitePosition")!==0&&DigiWebApp.ZeitbuchungenController.itemForDetails.get("gpsBreitePosition")!==null){$("#"+DigiWebApp.ZeitbuchungDetailsPage.content.showPositionCoordinatesInMapButton.id).show();var a=new Number(DigiWebApp.ZeitbuchungenController.itemForDetails.get("gpsBreitePosition"));
return M.I18N.l("order")+"-"+M.I18N.l("latitude")+": "+a.toFixed(6)}else{$("#"+DigiWebApp.ZeitbuchungDetailsPage.content.showPositionCoordinatesInMapButton.id).hide();return""}else{$("#"+DigiWebApp.ZeitbuchungDetailsPage.content.showPositionCoordinatesInMapButton.id).hide();return""}}},cssClass:"smallDetail marginTop12 unselectable"}),gpsLaengePosition:M.LabelView.design({computedValue:{value:"",operation:function(){if(DigiWebApp.ZeitbuchungenController.itemForDetails!==null)if(DigiWebApp.ZeitbuchungenController.itemForDetails.get("gpsLaengePosition")!==
""&&typeof DigiWebApp.ZeitbuchungenController.itemForDetails.get("gpsLaengePosition")!=="undefined"&&DigiWebApp.ZeitbuchungenController.itemForDetails.get("gpsLaengePosition")!=="0.0"&&DigiWebApp.ZeitbuchungenController.itemForDetails.get("gpsLaengePosition")!==0&&DigiWebApp.ZeitbuchungenController.itemForDetails.get("gpsLaengePosition")!==null){$("#"+DigiWebApp.ZeitbuchungDetailsPage.content.showPositionCoordinatesInMapButton.id).show();var a=new Number(DigiWebApp.ZeitbuchungenController.itemForDetails.get("gpsLaengePosition"));
return M.I18N.l("order")+"-"+M.I18N.l("longitude")+": "+a.toFixed(6)}else{$("#"+DigiWebApp.ZeitbuchungDetailsPage.content.showPositionCoordinatesInMapButton.id).hide();return""}else{$("#"+DigiWebApp.ZeitbuchungDetailsPage.content.showPositionCoordinatesInMapButton.id).hide();return""}}},cssClass:"smallDetail unselectable"}),farbeAmpel:M.LabelView.design({computedValue:{value:"",operation:function(){if(DigiWebApp.ZeitbuchungenController.itemForDetails!==null)if(DigiWebApp.ZeitbuchungenController.itemForDetails.get("farbeAmpel")!==
""&&typeof DigiWebApp.ZeitbuchungenController.itemForDetails.get("farbeAmpel")!=="undefined"){var a=DigiWebApp.ZeitbuchungenController.itemForDetails.get("farbeAmpel");return M.I18N.l("geozoneTrafficlight")+': <span style="box-shadow: 2px 2px 6px rgba(0,0,0,0.6);background:'+a+";color:"+a+';margin-right: 5px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>'}else return"";else return""}},cssClass:"normalDetail unselectable"}),showBookingCoordinatesInMapButton:M.ButtonView.design({computedValue:{value:"",operation:function(){return M.I18N.l("showBookingCoordinatesInMap")}},
events:{tap:{action:function(){var a=DigiWebApp.ZeitbuchungenController.itemForDetails.get("gpsLaenge"),b=DigiWebApp.ZeitbuchungenController.itemForDetails.get("gpsBreite"),c="";if(!(a==="0.0"&&b==="0.0"||a===0&&b===0)){switch(DigiWebApp.SettingsController.getSetting("mapType")){case "OSM":DigiWebApp.SettingsController.featureAvailable("419")?alert(M.I18N.l("showInMapScholpp")):alert(M.I18N.l("showInMapOSMAlert"));c="http://www.openstreetmap.org/index.html?mlat="+b+"&mlon="+a+"&zoom=15&layers=M";
break;case "Bing":DigiWebApp.SettingsController.featureAvailable("419")?alert(M.I18N.l("showInMapScholpp")):alert(M.I18N.l("showInMapBingAlert"));c="http://www.bing.com/maps/default.aspx?rtp=adr.~pos."+b+"_"+a+"_&lvl=151";break;case "Google":DigiWebApp.SettingsController.featureAvailable("419")?alert(M.I18N.l("showInMapScholpp")):alert(M.I18N.l("showInMapGoogleAlert"));c="http://maps.google.com/maps?q="+b+"+"+a+"&hl=de";break;default:c="disabled"}if(c!=="disabled")if(typeof plugins!=="undefined")if(typeof plugins.childBrowser!==
"undefined"){try{plugins.childBrowser.close()}catch(d){alert("Error: "+d.message)}try{plugins.childBrowser.showWebPage(encodeURI(c),{showNavigationBar:true})}catch(f){alert("Error: "+f.message)}}else DigiWebApp.ApplicationController.inAppBrowser_var=window.open(c,"childBrowser","width=800,height=600,menubar=no,status=no,location=yes,copyhistory=no,directories=no");else DigiWebApp.ApplicationController.inAppBrowser_var=window.open(c,"childBrowser","width=800,height=600,menubar=no,status=no,location=yes,copyhistory=no,directories=no")}}}}}),
showPositionCoordinatesInMapButton:M.ButtonView.design({computedValue:{value:"",operation:function(){return M.I18N.l("showPositionCoordinatesInMap")}},events:{tap:{action:function(){var a=DigiWebApp.ZeitbuchungenController.itemForDetails.get("gpsLaengePosition"),b=DigiWebApp.ZeitbuchungenController.itemForDetails.get("gpsBreitePosition"),c="";if(!(a==="0.0"&&b==="0.0"||a===0&&b===0)){switch(DigiWebApp.SettingsController.getSetting("mapType")){case "OSM":DigiWebApp.SettingsController.featureAvailable("419")?
alert(M.I18N.l("showInMapScholpp")):alert(M.I18N.l("showInMapOSMAlert"));c="http://www.openstreetmap.org/index.html?mlat="+b+"&mlon="+a+"&zoom=15&layers=M";break;case "Bing":DigiWebApp.SettingsController.featureAvailable("419")?alert(M.I18N.l("showInMapScholpp")):alert(M.I18N.l("showInMapBingAlert"));c="http://www.bing.com/maps/default.aspx?rtp=adr.~pos."+b+"_"+a+"_&lvl=151";break;case "Google":DigiWebApp.SettingsController.featureAvailable("419")?alert(M.I18N.l("showInMapScholpp")):alert(M.I18N.l("showInMapGoogleAlert"));
c="http://maps.google.com/maps?q="+b+"+"+a+"&hl=de";break;default:c="disabled"}if(c!=="disabled")if(typeof plugins!=="undefined")if(typeof plugins.childBrowser!=="undefined"){try{plugins.childBrowser.close()}catch(d){alert("Error: "+d.message)}try{plugins.childBrowser.showWebPage(encodeURI(c),{showNavigationBar:true})}catch(f){alert("Error: "+f.message)}}else DigiWebApp.ApplicationController.inAppBrowser_var=window.open(c,"childBrowser","width=800,height=600,menubar=no,status=no,location=yes,copyhistory=no,directories=no");
else DigiWebApp.ApplicationController.inAppBrowser_var=window.open(c,"childBrowser","width=800,height=600,menubar=no,status=no,location=yes,copyhistory=no,directories=no")}}}}})})});
DigiWebApp.SettingsPasswordPage=M.PageView.design({events:{pagebeforeshow:{action:function(){$("#"+DigiWebApp.SettingsPasswordPage.content.passwordGrid.passwordInput.id).val("")}}},childViews:"header content",cssClass:"settingsPasswordPage",header:M.ToolbarView.design({childViews:"backButton title",cssClass:"header",isFixed:YES,backButton:M.ButtonView.design({value:M.I18N.l("back"),icon:"arrow-l",anchorLocation:M.LEFT,events:{tap:{action:function(){try{DigiWebApp.ApplicationController.vibrate()}catch(a){}DigiWebApp.SettingsController.featureAvailable("404")?
DigiWebApp.NavigationController.backToButtonDashboardPagePOP():DigiWebApp.NavigationController.backToDashboardPagePOP()}}}}),title:M.LabelView.design({value:M.I18N.l("password"),anchorLocation:M.CENTER}),anchorLocation:M.TOP}),content:M.ScrollView.design({childViews:"passwordGrid grid",passwordGrid:M.GridView.design({childViews:"passwordLabel passwordInput",layout:M.TWO_COLUMNS,passwordLabel:M.LabelView.design({value:M.I18N.l("password")}),passwordInput:M.TextFieldView.design({inputType:M.INPUT_PASSWORD})}),
grid:M.GridView.design({childViews:"button icon",layout:{cssClass:"digiButton",columns:{0:"button",1:"icon"}},button:M.ButtonView.design({value:M.I18N.l("assume"),cssClass:"digiButton",anchorLocation:M.RIGHT,events:{tap:{action:function(){try{DigiWebApp.ApplicationController.vibrate()}catch(a){}$("#"+DigiWebApp.SettingsPasswordPage.content.passwordGrid.passwordInput.id).val()===DigiWebApp.SettingsController.getSetting("settingsPassword")?DigiWebApp.NavigationController.toSettingsPage():DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("wrongPasswordTitle"),
message:M.I18N.l("wrongPasswordMsg")})}}}}),icon:M.ImageView.design({value:"theme/images/icon_bookTime.png"})})})});
DigiWebApp.BautagebuchMedienDetailsPage=M.PageView.design({events:{pagebeforeshow:{action:function(){var a=NO,b=JSON.parse(JSON.stringify(DigiWebApp.BautagebuchBautageberichtDetailsController.positionenList));_.each(b,function(c){c.isSelected=parseInt(c.value)!==0?NO:YES});b=_.map(b,function(c){if(typeof c==="undefined")console.log("UNDEFINED position");else{if(DigiWebApp.BautagebuchMedienDetailsController.positionId){c.isSelected=c.value===DigiWebApp.BautagebuchMedienDetailsController.positionId;
if(c.isSelected)a=YES}return c}});b=_.compact(b);if(b.length!==1)b.push({label:M.I18N.l("selectSomething"),value:"0",isSelected:!a});else{DigiWebApp.BautagebuchMedienDetailsController.set("positionId",b[0].value);DigiWebApp.BautagebuchMedienDetailsController.set("positionName",b[0].label)}DigiWebApp.BautagebuchMedienDetailsController.set("positionenList",b);DigiWebApp.BautagebuchMedienDetailsController.setTaetigkeiten(DigiWebApp.BautagebuchMedienDetailsController.positionId);M.ViewManager.getView("bautagebuchMedienDetailsPage",
"remarkInput").setValue(DigiWebApp.BautagebuchMedienDetailsController.remark);$("#"+DigiWebApp.BautagebuchMedienDetailsPage.content.remarkInput.id)[0].focus();$("#"+DigiWebApp.BautagebuchMedienDetailsPage.content.remarkInput.id)[0].blur();if(DigiWebApp.BautagebuchBautageberichtDetailsController.item.get("abgeschlossen")){$("#"+DigiWebApp.BautagebuchMedienDetailsPage.content.grid.id).hide();$("#"+DigiWebApp.BautagebuchMedienDetailsPage.header.delButton.id).hide()}else{$("#"+DigiWebApp.BautagebuchMedienDetailsPage.content.grid.id).show();
$("#"+DigiWebApp.BautagebuchMedienDetailsPage.header.delButton.id).show()}}},pageshow:{action:function(){$("#"+DigiWebApp.BautagebuchMedienDetailsPage.content.remarkInput.id)[0].focus();$("#"+DigiWebApp.BautagebuchMedienDetailsPage.content.remarkInput.id)[0].blur()}},pagehide:{action:function(){M.ViewManager.getView("bautagebuchMedienDetailsPage","remarkInput").setCssProperty("height","50px")}}},cssClass:"bautagebuchMedienDetailsPage",childViews:"header content",header:M.ToolbarView.design({childViews:"backButton title delButton",
cssClass:"header unselectable",isFixed:YES,backButton:M.ButtonView.design({value:M.I18N.l("back"),icon:"arrow-l",anchorLocation:M.LEFT,events:{tap:{action:function(){try{DigiWebApp.ApplicationController.vibrate()}catch(a){}history.back()}}}}),title:M.LabelView.design({value:M.I18N.l("BautagebuchMedium"),anchorLocation:M.CENTER}),delButton:M.ButtonView.design({value:M.I18N.l("BautagebuchDelete"),icon:"delete",anchorLocation:M.RIGHT,events:{tap:{target:DigiWebApp.BautagebuchMedienDetailsController,
action:function(){try{DigiWebApp.ApplicationController.vibrate()}catch(a){}this.deleteMedienBuchung()}}}}),anchorLocation:M.TOP}),content:M.ScrollView.design({childViews:"positionComboBox activityComboBox image remarkInput grid",cssClass:"content",image:M.ImageView.design({value:"",cssClass:"photo"}),remarkInput:M.TextFieldView.design({label:M.I18N.l("remark"),cssClass:"remarkInput",cssClassOnInit:"remarkInputInitial",initialText:"max. 255 "+M.I18N.l("characters"),hasMultipleLines:YES,events:{keyup:{action:function(){if(M.ViewManager.getView("bautagebuchMedienDetailsPage",
"remarkInput").getValue().length<=255)DigiWebApp.BautagebuchMedienDetailsController.set("remark",M.ViewManager.getView("bautagebuchMedienDetailsPage","remarkInput").getValue());else{M.ViewManager.getView("bautagebuchMedienDetailsPage","remarkInput").setValue(DigiWebApp.BautagebuchMedienDetailsController.remark);DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("maximaleFeldlaengeErreicht"),message:M.I18N.l("maximaleFeldlaengeErreichtMsg")})}}}}}),positionComboBox:M.SelectionListView.design({selectionMode:M.SINGLE_SELECTION_DIALOG,
initialText:M.I18N.l("noData"),label:M.I18N.l("position"),applyTheme:NO,contentBinding:{target:DigiWebApp.BautagebuchMedienDetailsController,property:"positionenList"},events:{change:{action:function(){DigiWebApp.BautagebuchMedienDetailsController.set("positionId",M.ViewManager.getView("bautagebuchMedienDetailsPage","positionComboBox").getSelection(YES).value);DigiWebApp.BautagebuchMedienDetailsController.set("positionName",M.ViewManager.getView("bautagebuchMedienDetailsPage","positionComboBox").getSelection(YES).label);
DigiWebApp.BautagebuchMedienDetailsController.setTaetigkeiten(M.ViewManager.getView("bautagebuchMedienDetailsPage","positionComboBox").getSelection(YES).value)}}}}),activityComboBox:M.SelectionListView.design({selectionMode:M.SINGLE_SELECTION_DIALOG,initialText:M.I18N.l("noData"),label:M.I18N.l("activity"),applyTheme:NO,contentBinding:{target:DigiWebApp.BautagebuchMedienDetailsController,property:"activityList"},events:{change:{action:function(){DigiWebApp.BautagebuchMedienDetailsController.set("activityId",
M.ViewManager.getView("bautagebuchMedienDetailsPage","activityComboBox").getSelection(YES).value);DigiWebApp.BautagebuchMedienDetailsController.set("activityName",M.ViewManager.getView("bautagebuchMedienDetailsPage","activityComboBox").getSelection(YES).label)}}}}),grid:M.GridView.design({childViews:"button icon",layout:{cssClass:"digiButton",columns:{0:"button",1:"icon"}},button:M.ButtonView.design({value:M.I18N.l("assume"),cssClass:"digiButton",anchorLocation:M.RIGHT,events:{tap:{target:DigiWebApp.BautagebuchMedienDetailsController,
action:"save"}}}),icon:M.ImageView.design({value:"theme/images/icon_bookTime.png"})})})});
DigiWebApp.TimeDataTemplateView=M.ListItemView.design({isSelectable:YES,childViews:"date order position activity latitude longitude genauigkeit_von eolVon erfassungsverfahren_von gpszeitstempel_von latitude_bis longitude_bis genauigkeit_bis eolBis erfassungsverfahren_bis gpszeitstempel_bis ServiceApp_Status remark gefahreneKilometer",events:{tap:{action:function(a,b){if(DigiWebApp.SettingsController.featureAvailable("403")||DigiWebApp.SettingsController.featureAvailable("405")&&typeof window.requestFileSystem!==
"undefined"){_.each(DigiWebApp.Booking.find(),function(c){if(c.m_id===b)DigiWebApp.EditTimeDataPage.bookingToEdit=c});DigiWebApp.NavigationController.toEditTimeDataPage()}}}},date:M.LabelView.design({cssClass:"date unselectable",computedValue:{valuePattern:"<%= date %>",operation:function(a){a=a.split(",");var b,c,d;if(typeof a[2]==="undefined"){b=new Date(Number(a[0]));b=M.Date.create(b.getTime());c=null;if(a[1]!=="0"){d=new Date(Number(a[1]));c=M.Date.create(d.getTime())}}else{b=new Date(Number(a[0])+
6E4*((new Date).getTimezoneOffset()-Number(a[2])));b=M.Date.create(b.getTime());c=null;if(a[1]!=="0"){d=new Date(Number(a[1])+6E4*((new Date).getTimezoneOffset()-Number(a[2])));c=M.Date.create(d.getTime())}}if(c){b=M.Date.create(b.format("mm/dd/yyyy HH:MM"));c=M.Date.create(c.format("mm/dd/yyyy HH:MM"));if(b.format("mm/dd/yyyy HH:MM")===c.format("mm/dd/yyyy HH:MM"))return a[3]+", "+a[4]+" - "+a[6]+" "+M.I18N.l("oclock")+", 00:01 h";else{d=b.timeBetween(c,M.MINUTES);d=d<1?M.Math.round(d,M.CEIL):M.Math.round(b.timeBetween(c,
M.MINUTES),M.FLOOR);if(d>59){b=M.Math.round(d/60,M.FLOOR);b=b<10?"0"+b:b;d=d%60;d=d<10?"0"+d:d;d=b+":"+d}else d="00:"+(d<10?"0":"")+d;return a[3]+", "+a[4]+" - "+a[6]+" "+M.I18N.l("oclock")+", "+d+" h"}}else return a[3]+", "+a[4]+" - "+M.I18N.l("open")}}}),order:M.LabelView.design({cssClass:"application unselectable",computedValue:{valuePattern:"<%= orderName %>",operation:function(a){var b=_.select(DigiWebApp.Order.findSorted().concat(DigiWebApp.HandOrder.findSorted()),function(c){if(c)return a==
c.get("id")||a==c.get("name")});if(b&&b.length>0){b=b[0];return DigiWebApp.SettingsController.globalDebugMode?M.I18N.l("order")+": "+b.get("name")+" ("+b.get("id")+")":M.I18N.l("order")+": "+b.get("name")}else return M.I18N.l("order")+": "+M.I18N.l("notDefined")}}}),position:M.LabelView.design({cssClass:"position unselectable",computedValue:{valuePattern:"<%= positionId %>",operation:function(a){if(a){var b=_.select(DigiWebApp.Position.findSorted(),function(c){if(c)return a==c.get("id")});if(b&&b.length>
0){b=b[0];return M.I18N.l("position")+": "+b.get("name")}else return M.I18N.l("position")+": "+M.I18N.l("notDefined")}else return M.I18N.l("position")+": "+M.I18N.l("unknown")}}}),activity:M.LabelView.design({cssClass:"activity unselectable",computedValue:{valuePattern:"<%= activityId %>",operation:function(a){if(a){var b=null;if(parseInt(a)!==0)b=_.select(DigiWebApp.Activity.findSorted(),function(c){if(c)return a==c.get("id")});if(b&&b.length>0){b=b[0];return M.I18N.l("activity")+": "+b.get("name")}else return M.I18N.l("activity")+
": "+M.I18N.l("notDefined")}else return M.I18N.l("activity")+": "+M.I18N.l("unknown")}}}),latitude:M.LabelView.design({cssClass:"location unselectable",isInline:YES,computedValue:{valuePattern:"<%= latitude %>",operation:function(a){if(a>0&&DigiWebApp.SettingsController.getSetting("detailierteZeitdaten")){a=new Number(a);return M.I18N.l("vonKoordinate")+": "+a.toFixed(4)}else return""}}}),longitude:M.LabelView.design({cssClass:"location unselectable",isInline:YES,computedValue:{valuePattern:"<%= longitude %>",
operation:function(a){return a>0&&DigiWebApp.SettingsController.getSetting("detailierteZeitdaten")?", "+(new Number(a)).toFixed(4):""}}}),genauigkeit_von:M.LabelView.design({cssClass:"location unselectable",isInline:YES,computedValue:{valuePattern:"<%= genauigkeitVon %>",operation:function(a){return a>0&&DigiWebApp.SettingsController.getSetting("detailierteZeitdaten")?" ("+M.I18N.l("genauigkeit")+": "+a+" m)":""}}}),eolVon:M.LabelView.design({cssClass:"location unselectable",value:""}),latitude_bis:M.LabelView.design({cssClass:"location unselectable",
isInline:YES,computedValue:{valuePattern:"<%= latitude_bis %>",operation:function(a){if(a>0&&DigiWebApp.SettingsController.getSetting("detailierteZeitdaten")){a=new Number(a);return M.I18N.l("bisKoordinate")+": "+a.toFixed(4)}else return""}}}),longitude_bis:M.LabelView.design({cssClass:"location unselectable",isInline:YES,computedValue:{valuePattern:"<%= longitude_bis %>",operation:function(a){return a>0&&DigiWebApp.SettingsController.getSetting("detailierteZeitdaten")?", "+(new Number(a)).toFixed(4):
""}}}),genauigkeit_bis:M.LabelView.design({cssClass:"location unselectable",isInline:YES,computedValue:{valuePattern:"<%= genauigkeitBis %>",operation:function(a){return a>0&&DigiWebApp.SettingsController.getSetting("detailierteZeitdaten")?" ("+M.I18N.l("genauigkeit")+": "+a+" m)":""}}}),eolBis:M.LabelView.design({cssClass:"location unselectable",value:""}),erfassungsverfahren_von:M.LabelView.design({cssClass:"location unselectable",computedValue:{valuePattern:"<%= ermittlungsverfahrenVon %>",operation:function(a){return a!==
null&&typeof a!=="undefined"&&a!=="undefined"&&DigiWebApp.SettingsController.getSetting("detailierteZeitdaten")?M.I18N.l("erfassungsverfahren_von")+": "+a.substring(0,16)+"...":""}}}),erfassungsverfahren_bis:M.LabelView.design({cssClass:"location unselectable",computedValue:{valuePattern:"<%= ermittlungsverfahrenBis %>",operation:function(a){return a!==null&&typeof a!=="undefined"&&a!=="undefined"&&DigiWebApp.SettingsController.getSetting("detailierteZeitdaten")?M.I18N.l("erfassungsverfahren_bis")+
": "+a.substring(0,16)+"...":""}}}),gpszeitstempel_von:M.LabelView.design({cssClass:"location unselectable",computedValue:{valuePattern:"<%= gps_zeitstempelVon %>",operation:function(a){if(a>0&&DigiWebApp.SettingsController.getSetting("detailierteZeitdaten"))try{var b=M.Date.create(parseInt(a));return M.I18N.l("gpszeitstempel_von")+": "+b.format("dd.mm.yyyy HH:MM")}catch(c){return""}else return""}}}),gpszeitstempel_bis:M.LabelView.design({cssClass:"location unselectable",computedValue:{valuePattern:"<%= gps_zeitstempelBis %>",
operation:function(a){if(a>0&&DigiWebApp.SettingsController.getSetting("detailierteZeitdaten"))try{var b=M.Date.create(parseInt(a));return M.I18N.l("gpszeitstempel_bis")+": "+b.format("dd.mm.yyyy HH:MM")}catch(c){return""}else return""}}}),ServiceApp_Status:M.LabelView.design({cssClass:"location unselectable",computedValue:{valuePattern:"<%= ServiceApp_Status %>",operation:function(a){return a!==null&&DigiWebApp.SettingsController.getSetting("detailierteZeitdaten")&&DigiWebApp.SettingsController.getSetting("debug")?
"Status: "+a:""}}}),remark:M.LabelView.design({cssClass:"remark unselectable",computedValue:{valuePattern:"<%= remark %>",operation:function(a){return a?M.I18N.l("remark")+": "+a:""}}}),gefahreneKilometer:M.LabelView.design({cssClass:"remark",computedValue:{valuePattern:"<%= gefahreneKilometer %>",operation:function(a){return a&&a>0?M.I18N.l("gefahreneKilometer")+": "+a:""}}})});m_require("app/views/TimeDataTemplateView");m_require("app/views/TimeDataSentTemplateView");m_require("app/views/TimeDataSentDaysTemplateView");
DigiWebApp.TimeDataPage=M.PageView.design({events:{pagebeforeshow:{target:DigiWebApp.BookingController,action:"setNotBookedBookings"},pageshow:{action:function(){if(DigiWebApp.BookingController.timeData)DigiWebApp.BookingController.timeData.length!==0?$("#"+DigiWebApp.TimeDataPage.contentNotSent.id).show():$("#"+DigiWebApp.TimeDataPage.contentNotSent.id).hide();else $("#"+DigiWebApp.TimeDataPage.contentNotSent.id).hide();if(DigiWebApp.BookingController.timeDataSent)DigiWebApp.BookingController.timeDataSent.length!==
0?$("#"+DigiWebApp.TimeDataPage.contentSent.id).show():$("#"+DigiWebApp.TimeDataPage.contentSent.id).hide();else $("#"+DigiWebApp.TimeDataPage.contentSent.id).hide();if(DigiWebApp.BookingController.timeDataSentDays)DigiWebApp.BookingController.timeDataSentDays.length!==0?$("#"+DigiWebApp.TimeDataPage.contentDays.id).show():$("#"+DigiWebApp.TimeDataPage.contentDays.id).hide();else $("#"+DigiWebApp.TimeDataPage.contentDays.id).hide()}}},childViews:"header contentNotSent contentSent contentDays",cssClass:"timeDataPage unselectable",
header:M.ToolbarView.design({childViews:"backButton title",cssClass:"header unselectable",isFixed:YES,backButton:M.ButtonView.design({value:M.I18N.l("back"),icon:"arrow-l",anchorLocation:M.LEFT,events:{tap:{target:DigiWebApp.NavigationController,action:function(){try{DigiWebApp.ApplicationController.vibrate()}catch(a){}this.backToDashboardPage()}}}}),title:M.LabelView.design({value:M.I18N.l("timeData"),anchorLocation:M.CENTER}),anchorLocation:M.TOP}),contentNotSent:M.ScrollView.design({childViews:"list",
list:M.ListView.design({contentBinding:{target:DigiWebApp.BookingController,property:"timeData"},listItemTemplateView:DigiWebApp.TimeDataTemplateView})}),contentSent:M.ScrollView.design({childViews:"list",cssClass:"sentBookings",list:M.ListView.design({contentBinding:{target:DigiWebApp.BookingController,property:"timeDataSent"},listItemTemplateView:DigiWebApp.TimeDataSentTemplateView})}),contentDays:M.ScrollView.design({childViews:"list",cssClass:"sentBookings",list:M.ListView.design({contentBinding:{target:DigiWebApp.BookingController,
property:"timeDataSentDays"},listItemTemplateView:DigiWebApp.TimeDataSentDaysTemplateView})})});
DigiWebApp.FileChooserPage=M.PageView.design({childViews:"header content",cssClass:"fileChooserPage",successCallback:function(){},events:{pagebeforeshow:{action:function(){$("#"+DigiWebApp.FileChooserPage.content.inputfile.id).val("");$("#"+DigiWebApp.FileChooserPage.content.inputfile.id).unbind("change");$("#"+DigiWebApp.FileChooserPage.content.inputfile.id).bind("change",function(a){var b=a.target.files[0];a=new FileReader;a.onload=function(){DigiWebApp.FileChooserPage.successCallback(this.result,
b.name)};a.onerror=function(){DigiWebApp.FileChooserPage.successCallback(null)};a.readAsDataURL(b)})}}},header:M.ToolbarView.design({childViews:"backButton title",cssClass:"header",isFixed:YES,backButton:M.ButtonView.design({value:M.I18N.l("back"),icon:"arrow-l",anchorLocation:M.LEFT,events:{tap:{action:function(){try{DigiWebApp.ApplicationController.vibrate()}catch(a){}history.back()}}}}),title:M.LabelView.design({value:M.I18N.l("editPicture"),anchorLocation:M.CENTER}),anchorLocation:M.TOP}),content:M.ScrollView.design({childViews:"inputfile",
cssClass:"inputfile",inputfile:M.FormView.design({childViews:"",render:function(){this.html+='<form method="post" action="" class="">';this.html+='<input type="file" id="'+this.id+'" enctype="multipart/form-data" />';this.html+="</form>";return this.html}})})});
DigiWebApp.BautagebuchEinstellungenPage=M.PageView.design({events:{pagebeforeshow:{action:function(){DigiWebApp.BautagebuchEinstellungenController.load();DigiWebApp.BautagebuchEinstellungenPage.content.startUhrzeit.startUhrzeitInput.setValue(DigiWebApp.BautagebuchEinstellungenController.settings.startUhrzeit)}},pagebeforehide:{action:function(){DigiWebApp.BautagebuchEinstellungenController.save()}}},controller:DigiWebApp.BautagebuchEinstellungenController,navigationController:DigiWebApp.NavigationController,
cssClass:"settingsPage",childViews:"header content",header:M.ToolbarView.design({childViews:"backButton title",cssClass:"header unselectable",isFixed:YES,backButton:M.ButtonView.design({value:M.I18N.l("back"),icon:"arrow-l",anchorLocation:M.LEFT,events:{tap:{target:DigiWebApp.NavigationController,action:function(){try{DigiWebApp.ApplicationController.vibrate()}catch(a){}this.backToBautagebuchBautageberichteListePageTransition()}}}}),title:M.LabelView.design({value:M.I18N.l("BautagebuchBautagebericht"),
anchorLocation:M.CENTER}),anchorLocation:M.TOP}),content:M.ScrollView.design({childViews:"startUhrzeit inStundenBuchenCheckbox falscheZeitenIgnorierenCheckbox",startUhrzeit:M.GridView.design({childViews:"startUhrzeitLabel startUhrzeitInput",layout:M.TWO_COLUMNS,startUhrzeitLabel:M.LabelView.design({value:M.I18N.l("BautagebuchTaeglicheStartUhrzeit")}),startUhrzeitInput:M.TextFieldView.design({contentBindingReverse:{target:DigiWebApp.BautagebuchEinstellungenController,property:"settings.startUhrzeit"},
contentBinding:{target:DigiWebApp.BautagebuchEinstellungenController,property:"settings.startUhrzeit"},events:{tap:{action:function(){$(DigiWebApp.BautagebuchEinstellungenPage.content.startUhrzeit.startUhrzeitInput).blur();M.DatePickerView.show({source:M.ViewManager.getView("bautagebuchEinstellungenPage","startUhrzeitInput"),initialDate:D8.create("01.01.1993 "+DigiWebApp.BautagebuchEinstellungenController.settings.startUhrzeit),showTimePicker:YES,showDatePicker:NO,showAmPm:NO,dateOrder:"ddmmyy",dateFormat:"dd.mm.yy",
timeFormat:"HH:ii",minutesLabel:M.I18N.l("minute"),hoursLabel:M.I18N.l("hour"),dayLabel:M.I18N.l("day"),monthLabel:M.I18N.l("month"),yearLabel:M.I18N.l("year"),dayNamesShort:DigiWebApp.ApplicationController.dayNamesShort,dayNames:DigiWebApp.ApplicationController.dayNames,monthNamesShort:DigiWebApp.ApplicationController.monthNamesShort,monthNames:DigiWebApp.ApplicationController.monthNames,callbacks:{confirm:{target:this,action:function(a){DigiWebApp.BautagebuchEinstellungenController.set("settings.startUhrzeit",
a)}},before:{action:function(){}},cancel:{action:function(){}}}})}}}})}),inStundenBuchenCheckbox:M.SelectionListView.design({selectionMode:M.MULTIPLE_SELECTION,contentBinding:{target:DigiWebApp.BautagebuchEinstellungenController,property:"settings.inStundenBuchenItem"},events:{change:{target:DigiWebApp.BautagebuchEinstellungenController,action:function(a){this.settings.inStundenBuchen=a.length===1;this.settings.inStundenBuchenItem.isSelected=a.length===1}}}}),falscheZeitenIgnorierenCheckbox:M.SelectionListView.design({selectionMode:M.MULTIPLE_SELECTION,
contentBinding:{target:DigiWebApp.BautagebuchEinstellungenController,property:"settings.falscheZeitenIgnorierenItem"},events:{change:{target:DigiWebApp.BautagebuchEinstellungenController,action:function(a){this.settings.falscheZeitenIgnorieren=a.length===1;this.settings.falscheZeitenIgnorierenItem.isSelected=a.length===1}}}})})});
DigiWebApp.TabBar=M.TabBarView.design({childViews:"tabItem1 tabItem2",anchorLocation:M.BOTTOM,isFixed:YES,transition:M.TRANSITION.FADE,name:"tabbar1",tabItem1:M.TabBarItemView.design({value:M.I18N.l("book"),page:"bookingPage",icon:"book"}),tabItem2:M.TabBarItemView.design({value:M.I18N.l("menu"),page:"dashboard",icon:"menu"})});m_require("app/views/TabBar.js");
DigiWebApp.InfoPage=M.PageView.design({lastTimePageWasLoaded:null,events:{pagebeforeshow:{action:function(){DigiWebApp.InfoPage.pagebeforeshowFunction()}},pagehide:{action:function(){DigiWebApp.ApplicationController.clickCounter=0}}},pagebeforeshowFunction:function(){DigiWebApp.ApplicationController.clickCounter=0;M.ViewManager.getView("infoPage","languageSelection").setSelection(M.I18N.getLanguage());DigiWebApp.InfoPage.lastTimePageWasLoaded=+new Date;DigiWebApp.InfoPage.content.cordovaVersionLabel.renderUpdate();
DigiWebApp.InfoPage.content.deviceinfo.renderUpdate();DigiWebApp.InfoPage.content.connectioninfo.renderUpdate();DigiWebApp.InfoPage.content.localStorageUsage.renderUpdate();DigiWebApp.InfoPage.content.mitarbeiterNameVornameLabel.renderUpdate()},cssClass:"infoPage",childViews:"header content",header:M.ToolbarView.design({childViews:"backButton title refreshButton",cssClass:"header unselectable",isFixed:YES,backButton:M.ButtonView.design({value:M.I18N.l("back"),icon:"arrow-l",anchorLocation:M.LEFT,
events:{tap:{target:DigiWebApp.NavigationController,action:function(){try{DigiWebApp.ApplicationController.vibrate()}catch(a){}this.backToDashboardPage()}}}}),title:M.LabelView.design({value:M.I18N.l("info"),anchorLocation:M.CENTER}),refreshButton:M.ButtonView.design({value:M.I18N.l("refresh"),icon:"refresh",anchorLocation:M.RIGHT,events:{tap:{action:function(){try{DigiWebApp.ApplicationController.vibrate()}catch(a){}DigiWebApp.SettingsController.mitarbeiterNameVorname="";var b=DigiWebApp.Settings.find(),
c="0";try{c=b[0].get("workerId")}catch(d){console.error(d)}DigiWebApp.SettingsController.refreshMitarbeiterNameVorname(c,DigiWebApp.InfoPage.pagebeforeshowFunction)}}}}),anchorLocation:M.TOP}),content:M.ScrollView.design({childViews:"logo languageSelection spacer8 companyIdLabel mitarbeiterNameVornameLabel spacer9 versionLabel cordovaVersionLabel companyLabel streetLabel cityLabel emailLabel1 spacer1 emailLabel2 spacer2 spacer3 TMPVersionLabel spacer4 deviceinfo spacer5 connectioninfo spacer6 environmentinfo spacer7 localStorageUsage",
logo:M.ImageView.design({value:"theme/images/NeuesLogo2013.png",cssClass:"logoInfoPage marginBottom25 unselectable"}),languageSelection:M.SelectionListView.design({selectionMode:M.SINGLE_SELECTION_DIALOG,label:M.I18N.l("applicationLanguage"),applyTheme:NO,childViews:"languageDeDe languageEnUs",languageDeDe:M.SelectionListItemView.design({value:"de_de",label:M.I18N.l("language_de_de")}),languageEnUs:M.SelectionListItemView.design({value:"en_us",label:M.I18N.l("language_en_us")}),languageFrFr:M.SelectionListItemView.design({value:"fr_fr",
label:M.I18N.l("language_fr_fr")}),languageEsEs:M.SelectionListItemView.design({value:"es_es",label:M.I18N.l("language_es_es")}),languageNlNl:M.SelectionListItemView.design({value:"nl_nl",label:M.I18N.l("language_nl_nl")}),events:{change:{action:function(){var a=M.ViewManager.getView("infoPage","languageSelection").getSelection(YES).value;M.I18N.setLanguage(a)}}}}),companyIdLabel:M.LabelView.design({computedValue:{value:"",operation:function(){var a="";try{a=DigiWebApp.Settings.find()[0].get("company")}catch(b){}return M.I18N.l("company")+
": "+a}},cssClass:"infoLabel unselectable"}),mitarbeiterNameVornameLabel:M.LabelView.design({computedValue:{value:"",operation:function(){var a="";try{a=DigiWebApp.Settings.find()[0].get("workerId")}catch(b){}a=M.I18N.l("configuredUser")+": "+a;if(DigiWebApp.SettingsController.getSetting("mitarbeiterVorname")!==""||DigiWebApp.SettingsController.getSetting("mitarbeiterNachname")!=="")a=a+" ("+DigiWebApp.SettingsController.getSetting("mitarbeiterVorname")+" "+DigiWebApp.SettingsController.getSetting("mitarbeiterNachname")+
")";return a}},cssClass:"infoLabel unselectable"}),versionLabel:M.LabelView.design({computedValue:{value:"",operation:function(){return"Version: "+M.Application.getConfig("version")}},cssClass:"infoLabel unselectable"}),cordovaVersionLabel:M.LabelView.design({computedValue:{value:"",operation:function(){var a="";if(typeof device!=="undefined"){if(typeof device.cordova!=="undefined")a=a+"Cordova: "+device.cordova;if(typeof device.phonegap!=="undefined"){if(a!=="")a+="<br/>";a=a+"PhoneGap: "+device.phonegap}}return a}},
cssClass:"infoLabel marginBottom25 unselectable"}),TMPVersionLabel:M.LabelView.design({computedValue:{value:"",operation:function(){return"The-M-Project: "+M.Version}},cssClass:"infoLabel marginBottom25 unselectable"}),buildLabel:M.LabelView.design({value:"Build: 4702",cssClass:"infoLabel marginBottom25 unselectable"}),companyLabel:M.LabelView.design({value:"DIGI-Zeiterfassung GmbH",cssClass:"infoLabel unselectable"}),streetLabel:M.LabelView.design({value:"Raiffeisenstr. 30",cssClass:"infoLabel unselectable"}),
cityLabel:M.LabelView.design({value:"D-70794 Filderstadt",cssClass:"infoLabel marginBottom25 unselectable"}),emailLabel1:M.LabelView.design({value:"eMail: ",cssClass:"infoLabel unselectable",isInline:YES}),emailLabel2:M.LabelView.design({value:"support@digi-zeiterfassung.de",hyperlinkTarget:'support@digi-zeiterfassung.de" onclick="return DigiWebApp.InfoPage.lastTimePageWasLoaded < (+new Date() - 1000);"',hyperlinkType:M.HYPERLINK_EMAIL,cssClass:"infoLabel unselectable",isInline:YES}),spacer1:M.LabelView.design({value:" "}),
spacer2:M.LabelView.design({value:" "}),spacer3:M.LabelView.design({value:"&nbsp;"}),spacer4:M.LabelView.design({value:" "}),spacer5:M.LabelView.design({value:" "}),spacer6:M.LabelView.design({value:" "}),spacer7:M.LabelView.design({value:" "}),spacer8:M.LabelView.design({value:"<br /><br />",cssClass:"infoLabel unselectable"}),spacer9:M.LabelView.design({value:"<br />",cssClass:"infoLabel unselectable"}),webLabel1:M.LabelView.design({value:"Web: ",cssClass:"infoLabel unselectable",isInline:YES}),
webLabel2:M.LabelView.design({value:"www.digi-zeiterfassung.de",hyperlinkTarget:'http://www.digi-zeiterfassung.de" onclick="return DigiWebApp.InfoPage.lastTimePageWasLoaded < (+new Date() - 1000);"',hyperlinkType:M.HYPERLINK_WEBSITE,cssClass:"infoLabel unselectable",isInline:YES}),localStorageUsage:M.LabelView.design({computedValue:{value:"",operation:function(){var a="",b=(new Number(JSON.stringify(localStorage).length/1048576)).toFixed(2);if(typeof localStorage!=="undefined")a="LocalStorage-Usage: "+
b+" MB<br />";return a}},cssClass:"infoLabel marginTop25 unselectable"}),environmentinfo:M.LabelView.design({computedValue:{value:"",operation:function(){var a="";if(typeof M.Environment!=="undefined")a="Environment Platform: "+M.Environment.getPlatform()+"<br />";return a}},cssClass:"infoLabel marginTop25 unselectable"}),deviceinfo:M.LabelView.design({computedValue:{value:"",operation:function(){var a="";if(typeof device!=="undefined")a="Device Name: "+device.name+"<br />Device Platform: "+device.platform+
"<br />Device UUID: "+device.uuid+"<br />Device Version: "+device.version+"<br />";return a}},cssClass:"infoLabel marginTop25 unselectable"}),connectioninfo:M.LabelView.design({computedValue:{value:"",operation:function(){if(typeof navigator.connection!=="undefined"&&typeof Connection!=="undefined"){var a=navigator.connection.type,b={};b[Connection.UNKNOWN]="Unknown connection";b[Connection.ETHERNET]="Ethernet connection";b[Connection.WIFI]="WiFi connection";b[Connection.CELL_2G]="Cell 2G connection";
b[Connection.CELL_3G]="Cell 3G connection";b[Connection.CELL_4G]="Cell 4G connection";b[Connection.CELL]="Cellular connection";b[Connection.NONE]="No network connection";return"Connection type: "+b[a]}else return""}},cssClass:"infoLabel marginBottom25 unselectable"})}),tabBar:DigiWebApp.TabBar});m_require("app/views/TabBar.js");
DigiWebApp.BookingPage=M.PageView.design({childViews:"header content tabBar",events:{pagebeforeshow:{action:function(){DigiWebApp.SettingsController.featureAvailable("416")?DigiWebApp.NavigationController.toBookTimePage():DigiWebApp.BookingController.init()}},pageshow:{action:function(){DigiWebApp.TabBar.setActiveTab(DigiWebApp.TabBar.tabItem1);DigiWebApp.SettingsController.featureAvailable("415")?$("#"+DigiWebApp.BookingPage.header.feierabendButton.id).show():$("#"+DigiWebApp.BookingPage.header.feierabendButton.id).hide()}}},
cssClass:"bookTimePage",header:M.ToolbarView.design({childViews:"title feierabendButton",cssClass:"header unselectable",isFixed:YES,pauseButton:M.ButtonView.design({value:M.I18N.l("back"),icon:"arrow-l",anchorLocation:M.LEFT,events:{tap:{action:function(){}}}}),title:M.LabelView.design({value:M.I18N.l("timeRegistration"),anchorLocation:M.CENTER}),feierabendButton:M.ButtonView.design({value:"&nbsp;&nbsp;&nbsp;",icon:"home",anchorLocation:M.RIGHT,events:{tap:{action:function(){DigiWebApp.BookingController.closeDay()}}}}),
anchorLocation:M.TOP}),content:M.ScrollView.design({childViews:"order position activity grid currentBookingLabel",cssClass:"unselectable",order:M.SelectionListView.design({selectionMode:M.SINGLE_SELECTION_DIALOG,initialText:M.I18N.l("noData"),label:M.I18N.l("order"),applyTheme:NO,contentBinding:{target:DigiWebApp.SelectionController,property:"orders"},events:{change:{target:DigiWebApp.SelectionController,action:function(){this.setPositions()}}}}),position:M.SelectionListView.design({selectionMode:M.SINGLE_SELECTION_DIALOG,
label:M.I18N.l("position"),initialText:M.I18N.l("noData"),applyTheme:NO,contentBinding:{target:DigiWebApp.SelectionController,property:"positions"},events:{change:{target:DigiWebApp.SelectionController,action:function(){this.setActivities(YES)}}}}),activity:M.SelectionListView.design({selectionMode:M.SINGLE_SELECTION_DIALOG,label:M.I18N.l("activity"),initialText:M.I18N.l("noData"),applyTheme:NO,contentBinding:{target:DigiWebApp.SelectionController,property:"activities"},events:{change:{target:DigiWebApp.SelectionController,
action:function(){this.saveSelection()}}}}),grid:M.GridView.design({childViews:"button icon",layout:{cssClass:"marginTop40 digiButton",columns:{0:"button",1:"icon"}},button:M.ButtonView.design({value:M.I18N.l("book2"),cssClass:"digiButton",anchorLocation:M.RIGHT,events:{tap:{target:DigiWebApp.BookingController,action:"book"}}}),icon:M.ImageView.design({value:"theme/images/icon_bookTime.png"})}),currentBookingLabel:M.LabelView.design({cssClass:"marginTop25 whiteLabel unselectable",computedValue:{contentBinding:{target:DigiWebApp.BookingController,
property:"currentBookingStr"},value:"",operation:function(a){return a!==""?M.I18N.l("bookingRunningSince")+" &nbsp;"+a:""}}})}),tabBar:DigiWebApp.TabBar});m_require("app/views/TabBar.js");
DigiWebApp.SettingsPage=M.PageView.design({childViews:"header content",events:{pagebeforeshow:{target:DigiWebApp.SettingsController,action:"init"}},cssClass:"settingsPage",header:M.ToolbarView.design({childViews:"backButton title",cssClass:"header unselectable",isFixed:YES,backButton:M.ButtonView.design({value:M.I18N.l("back"),icon:"arrow-l",anchorLocation:M.LEFT,events:{tap:{action:function(){try{DigiWebApp.ApplicationController.vibrate()}catch(a){}DigiWebApp.SettingsController.showCredentialsAlert||
DigiWebApp.NavigationController.backToDashboardPage()}}}}),title:M.LabelView.design({value:M.I18N.l("settings"),anchorLocation:M.CENTER}),anchorLocation:M.TOP}),content:M.ScrollView.design({childViews:"companyGrid passwordGrid connectionCodeGrid workerIdGrid autoTransferAfterBookTimeCheck autoTransferAfterClosingDayCheck autoSyncAfterBookTimeCheck remarkIsMandatory remarkIsOptional autoSaveGPSData detailierteZeitdaten useTransitionsSetting daysToHoldBookingsOnDeviceSliderContainer bautagebuchLimit_autoStartUhrzeit ServiceApp_ermittleGeokoordinate ServiceApp_datenUebertragen ServiceApp_engeKopplung ServiceApp_PORTGrid ServiceApp_FallBack auftragsDetailsKoppeln vibrationsDauerSliderContainer grid",
daysToHoldBookingsOnDeviceSliderContainer:M.ContainerView.design({childViews:"daysToHoldBookingsOnDeviceSlider",daysToHoldBookingsOnDeviceSlider:M.SliderView.design({label:M.I18N.l("daysToHoldBookingsOnDeviceLabel"),min:1,max:40,highlightLeftPart:YES,cssClass:"daysToHoldBookingsOnDeviceSlider",contentBinding:{target:DigiWebApp.SettingsController,property:"settings.daysToHoldBookingsOnDevice"}})}),vibrationsDauerSliderContainer:M.ContainerView.design({childViews:"vibrationsDauerSlider",vibrationsDauerSlider:M.SliderView.design({label:M.I18N.l("vibrationsDauerLabel"),
min:0,max:200,highlightLeftPart:YES,cssClass:"vibrationsDauerSlider",contentBinding:{target:DigiWebApp.SettingsController,property:"settings.vibrationsDauer"}})}),companyGrid:M.GridView.design({childViews:"companyLabel companyInput",layout:M.TWO_COLUMNS,companyLabel:M.LabelView.design({value:M.I18N.l("company")}),companyInput:M.TextFieldView.design({inputType:M.INPUT_NUMBER,contentBinding:{target:DigiWebApp.SettingsController,property:"settings.company"}})}),passwordGrid:M.GridView.design({childViews:"passwordLabel passwordInput",
layout:M.TWO_COLUMNS,passwordLabel:M.LabelView.design({value:M.I18N.l("password")}),passwordInput:M.TextFieldView.design({inputType:M.INPUT_PASSWORD,contentBinding:{target:DigiWebApp.SettingsController,property:"settings.password"}})}),connectionCodeGrid:M.GridView.design({childViews:"connectionCodeLabel connectionCodeInput",layout:M.TWO_COLUMNS,connectionCodeLabel:M.LabelView.design({value:M.I18N.l("connectionCode")}),connectionCodeInput:M.TextFieldView.design({inputType:M.INPUT_PASSWORD,contentBinding:{target:DigiWebApp.SettingsController,
property:"settings.connectionCode"}})}),workerIdGrid:M.GridView.design({childViews:"workerIdLabel workerIdInput",layout:M.TWO_COLUMNS,workerIdLabel:M.LabelView.design({value:M.I18N.l("workerId")}),workerIdInput:M.TextFieldView.design({inputType:M.INPUT_NUMBER,contentBinding:{target:DigiWebApp.SettingsController,property:"settings.workerId"}})}),autoSyncAfterBookTimeCheck:M.SelectionListView.design({selectionMode:M.MULTIPLE_SELECTION,contentBinding:{target:DigiWebApp.SettingsController,property:"settings.autoSyncAfterBookTime"}}),
autoTransferAfterBookTimeCheck:M.SelectionListView.design({selectionMode:M.MULTIPLE_SELECTION,contentBinding:{target:DigiWebApp.SettingsController,property:"settings.autoTransferAfterBookTime"}}),autoTransferAfterClosingDayCheck:M.SelectionListView.design({selectionMode:M.MULTIPLE_SELECTION,contentBinding:{target:DigiWebApp.SettingsController,property:"settings.autoTransferAfterClosingDay"}}),remarkIsMandatory:M.SelectionListView.design({selectionMode:M.MULTIPLE_SELECTION,contentBinding:{target:DigiWebApp.SettingsController,
property:"settings.remarkIsMandatory"}}),remarkIsOptional:M.SelectionListView.design({selectionMode:M.MULTIPLE_SELECTION,contentBinding:{target:DigiWebApp.SettingsController,property:"settings.remarkIsOptional"}}),detailierteZeitdaten:M.SelectionListView.design({selectionMode:M.MULTIPLE_SELECTION,contentBinding:{target:DigiWebApp.SettingsController,property:"settings.detailierteZeitdaten"}}),useTransitionsSetting:M.SelectionListView.design({selectionMode:M.MULTIPLE_SELECTION,contentBinding:{target:DigiWebApp.SettingsController,
property:"settings.useTransitionsSetting"}}),autoSaveGPSData:M.SelectionListView.design({selectionMode:M.MULTIPLE_SELECTION,contentBinding:{target:DigiWebApp.SettingsController,property:"settings.autoSaveGPSData"}}),bautagebuchLimit_autoStartUhrzeit:M.SelectionListView.design({selectionMode:M.MULTIPLE_SELECTION,contentBinding:{target:DigiWebApp.SettingsController,property:"settings.bautagebuchLimit_autoStartUhrzeit"}}),GPSDataIsMandatory:M.SelectionListView.design({selectionMode:M.MULTIPLE_SELECTION,
cssClass:"lastSelectBox",contentBinding:{target:DigiWebApp.SettingsController,property:"settings.GPSDataIsMandatory"}}),ServiceApp_ermittleGeokoordinate:M.SelectionListView.design({selectionMode:M.MULTIPLE_SELECTION,contentBinding:{target:DigiWebApp.SettingsController,property:"settings.ServiceApp_ermittleGeokoordinate"}}),ServiceApp_datenUebertragen:M.SelectionListView.design({selectionMode:M.MULTIPLE_SELECTION,contentBinding:{target:DigiWebApp.SettingsController,property:"settings.ServiceApp_datenUebertragen"}}),
ServiceApp_engeKopplung:M.SelectionListView.design({selectionMode:M.MULTIPLE_SELECTION,contentBinding:{target:DigiWebApp.SettingsController,property:"settings.ServiceApp_engeKopplung"}}),ServiceApp_FallBack:M.SelectionListView.design({selectionMode:M.MULTIPLE_SELECTION,contentBinding:{target:DigiWebApp.SettingsController,property:"settings.ServiceApp_FallBack"}}),ServiceApp_PORTGrid:M.GridView.design({childViews:"ServiceApp_PORTLabel ServiceApp_PORTInput",layout:M.TWO_COLUMNS,ServiceApp_PORTLabel:M.LabelView.design({value:M.I18N.l("ServiceApp_PORT")}),
ServiceApp_PORTInput:M.TextFieldView.design({contentBinding:{target:DigiWebApp.SettingsController,property:"settings.ServiceApp_PORT"}})}),auftragsDetailsKoppeln:M.SelectionListView.design({selectionMode:M.MULTIPLE_SELECTION,contentBinding:{target:DigiWebApp.SettingsController,property:"settings.auftragsDetailsKoppeln"}}),grid:M.GridView.design({childViews:"button icon",layout:{cssClass:"digiButton",columns:{0:"button",1:"icon"}},button:M.ButtonView.design({value:M.I18N.l("assume"),cssClass:"digiButton",
anchorLocation:M.RIGHT,events:{tap:{target:DigiWebApp.SettingsController,action:function(){try{DigiWebApp.ApplicationController.vibrate()}catch(a){}this.save()}}}}),icon:M.ImageView.design({value:"theme/images/icon_bookTime.png"})})}),tabBar:DigiWebApp.TabBar});m_require("app/views/TabBar.js");
DigiWebApp.HandOrderPage=M.PageView.design({childViews:"header content",cssClass:"handApplicationPage",events:{pageshow:{action:function(){$("#"+DigiWebApp.HandOrderPage.content.orderName.id)[0].focus()}}},header:M.ToolbarView.design({childViews:"backButton title",cssClass:"header",isFixed:YES,backButton:M.ButtonView.design({value:M.I18N.l("back"),icon:"arrow-l",anchorLocation:M.LEFT,events:{tap:{target:DigiWebApp.NavigationController,action:function(){try{DigiWebApp.ApplicationController.vibrate()}catch(a){}this.backToDashboardPage()}}}}),
title:M.LabelView.design({value:M.I18N.l("handApplications"),anchorLocation:M.CENTER}),anchorLocation:M.TOP}),content:M.ScrollView.design({childViews:"orderName grid",orderName:M.TextFieldView.design({label:M.I18N.l("orderName")}),grid:M.GridView.design({childViews:"button icon",layout:{cssClass:"digiButton hack",columns:{0:"button",1:"icon"}},button:M.ButtonView.design({value:M.I18N.l("assume"),cssClass:"digiButton",anchorLocation:M.RIGHT,events:{tap:{target:DigiWebApp.HandOrderController,action:function(){try{DigiWebApp.ApplicationController.vibrate()}catch(a){}this.save()}}}}),
icon:M.ImageView.design({value:"theme/images/icon_bookTime.png"})})}),tabBar:DigiWebApp.TabBar});m_require("app/views/TabBar.js");m_require("app/views/DashboardTemplateView.js");
DigiWebApp.DashboardPage=M.PageView.design({childViews:"header content tabBar",cssClass:"dashboardPage unselectable",events:{pagebeforeshow:{action:function(){DigiWebApp.SettingsController.featureAvailable("404")?DigiWebApp.NavigationController.toButtonDashboardPage():DigiWebApp.DashboardController.init()}},pageshow:{action:function(){DigiWebApp.TabBar.setActiveTab(DigiWebApp.TabBar.tabItem2)}}},needsUpdate:true,header:M.ToolbarView.design({value:M.I18N.l("menu"),cssClass:"header unselectable",isFixed:YES,
anchorLocation:M.TOP}),content:M.ScrollView.design({childViews:"list",list:M.ListView.design({contentBinding:{target:DigiWebApp.DashboardController,property:"items"},listItemTemplateView:DigiWebApp.DashboardTemplateView})}),tabBar:DigiWebApp.TabBar});m_require("app/views/TabBar.js");
DigiWebApp.BookingPageWithIconsScholpp=M.PageView.design({childViews:"header content tabBar",events:{pagebeforeshow:{target:DigiWebApp.BookingController,action:"init"},pageshow:{action:function(){DigiWebApp.TabBar.setActiveTab(DigiWebApp.TabBar.tabItem1);$("#"+DigiWebApp.BookingPageWithIconsScholpp.header.feierabendButton.id).hide();$("#"+DigiWebApp.BookingPageWithIconsScholpp.content.activity.id+"_container").hide();$("#"+DigiWebApp.BookingPageWithIconsScholpp.content.spesenkennzeichen.id).attr("disabled",
"disabled")}}},cssClass:"bookTimePageWithIcons",header:M.ToolbarView.design({childViews:"title feierabendButton",cssClass:"header unselectable",isFixed:YES,pauseButton:M.ButtonView.design({value:M.I18N.l("back"),icon:"arrow-l",anchorLocation:M.LEFT,events:{tap:{action:function(){}}}}),title:M.LabelView.design({value:M.I18N.l("timeRegistration"),anchorLocation:M.CENTER}),feierabendButton:M.ButtonView.design({value:"&nbsp;&nbsp;&nbsp;",icon:"home",anchorLocation:M.RIGHT,events:{tap:{action:function(){DigiWebApp.BookingController.closeDay()}}}}),
anchorLocation:M.TOP}),content:M.ScrollView.design({childViews:"order position activity uebernachtungskennzeichen spesenkennzeichen fahrzeit_arbeitszeit_spezial_ButtonGrid unterbrechung_pause_arbeitsende_ButtonGrid currentBookingLabel",cssClass:"unselectable",activityLabel:M.LabelView.design({value:M.I18N.l("activity"),cssClass:"whiteLabel16px"}),unterbrechung_pause_arbeitsende_ButtonGrid:M.GridView.design({childViews:"unterbrechungButtonGrid pauseButtonGrid arbeitsendeButtonGrid",layout:M.THREE_COLUMNS,
arbeitsendeButtonGrid:M.GridView.design({childViews:"button icon",layout:{cssClass:"scholppButton",columns:{0:"button",1:"icon"}},button:M.ButtonView.design({value:"Ende",cssClass:"scholppButton",anchorLocation:M.RIGHT,events:{tap:{action:function(){try{DigiWebApp.ApplicationController.vibrate()}catch(a){}M.ViewManager.getView("bookingPageWithIconsScholpp","uebernachtungskennzeichen").setSelection("6");DigiWebApp.ScholppBookingController.bucheArbeitsende()}}}}),icon:M.ImageView.design({value:"theme/images/48x48_plain_home.png",
events:{tap:{action:function(){try{DigiWebApp.ApplicationController.vibrate()}catch(a){}M.ViewManager.getView("bookingPageWithIconsScholpp","uebernachtungskennzeichen").setSelection("6");DigiWebApp.ScholppBookingController.bucheArbeitsende()}}}})}),unterbrechungButtonGrid:M.GridView.design({childViews:"button icon",layout:{cssClass:"scholppButton",columns:{0:"button",1:"icon"}},button:M.ButtonView.design({value:"Unterbrechung",cssClass:"scholppButton",anchorLocation:M.RIGHT,events:{tap:{action:function(){try{DigiWebApp.ApplicationController.vibrate()}catch(a){}M.ViewManager.getView("bookingPageWithIconsScholpp",
"uebernachtungskennzeichen").setSelection("6");DigiWebApp.ScholppBookingController.bucheUnterbrechung()}}}}),icon:M.ImageView.design({value:"theme/images/48x48_plain_clock_pause.png",events:{tap:{action:function(){try{DigiWebApp.ApplicationController.vibrate()}catch(a){}M.ViewManager.getView("bookingPageWithIconsScholpp","uebernachtungskennzeichen").setSelection("6");DigiWebApp.ScholppBookingController.bucheUnterbrechung()}}}})}),pauseButtonGrid:M.GridView.design({childViews:"button icon",layout:{cssClass:"scholppButton",
columns:{0:"button",1:"icon"}},button:M.ButtonView.design({value:" ",cssClass:"scholppButton",anchorLocation:M.RIGHT,events:{tap:{action:function(){try{DigiWebApp.ApplicationController.vibrate()}catch(a){}}}}}),icon:M.ImageView.design({value:"",events:{tap:{action:function(){try{DigiWebApp.ApplicationController.vibrate()}catch(a){}}}}})})}),fahrzeit_arbeitszeit_spezial_ButtonGrid:M.GridView.design({childViews:"fahrzeitButtonGrid arbeitszeitButtonGrid spezialButtonGrid",layout:M.THREE_COLUMNS,fahrzeitButtonGrid:M.GridView.design({childViews:"button icon",
layout:{cssClass:"scholppButton",columns:{0:"button",1:"icon"}},button:M.ButtonView.design({value:"Reisezeit",cssClass:"scholppButton",anchorLocation:M.RIGHT,events:{tap:{action:function(){try{DigiWebApp.ApplicationController.vibrate()}catch(a){}DigiWebApp.ScholppBookingController.bucheFahrzeit()}}}}),icon:M.ImageView.design({value:"theme/images/48x48_plain_car_compact_grey.png",events:{tap:{action:function(){try{DigiWebApp.ApplicationController.vibrate()}catch(a){}DigiWebApp.ScholppBookingController.bucheFahrzeit()}}}})}),
arbeitszeitButtonGrid:M.GridView.design({childViews:"button icon",layout:{cssClass:"scholppButton",columns:{0:"button",1:"icon"}},button:M.ButtonView.design({value:"Arbeitszeit",cssClass:"scholppButton",anchorLocation:M.RIGHT,events:{tap:{action:function(){try{DigiWebApp.ApplicationController.vibrate()}catch(a){}M.ViewManager.getView("bookingPageWithIconsScholpp","uebernachtungskennzeichen").setSelection("6");DigiWebApp.ScholppBookingController.bucheArbeitszeit()}}}}),icon:M.ImageView.design({value:"theme/images/48x48_plain_wrench.png",
events:{tap:{action:function(){try{DigiWebApp.ApplicationController.vibrate()}catch(a){}M.ViewManager.getView("bookingPageWithIconsScholpp","uebernachtungskennzeichen").setSelection("6");DigiWebApp.ScholppBookingController.bucheArbeitszeit()}}}})}),spezialButtonGrid:M.GridView.design({childViews:"button icon",layout:{cssClass:"scholppButton",columns:{0:"button",1:"icon"}},button:M.ButtonView.design({value:"&nbsp;",cssClass:"scholppButton",anchorLocation:M.RIGHT,events:{tap:{action:function(){try{DigiWebApp.ApplicationController.vibrate()}catch(a){}}}}}),
icon:M.ImageView.design({value:"",events:{tap:{action:function(){try{DigiWebApp.ApplicationController.vibrate()}catch(a){}}}}})})}),order:M.SelectionListView.design({selectionMode:M.SINGLE_SELECTION_DIALOG,initialText:M.I18N.l("order"),label:"",applyTheme:NO,contentBinding:{target:DigiWebApp.SelectionController,property:"orders"},events:{change:{target:DigiWebApp.SelectionController,action:function(){this.setPositions()}}}}),position:M.SelectionListView.design({selectionMode:M.SINGLE_SELECTION_DIALOG,
label:"",initialText:M.I18N.l("position"),applyTheme:NO,contentBinding:{target:DigiWebApp.SelectionController,property:"positions"},events:{change:{target:DigiWebApp.SelectionController,action:function(){this.setActivities(YES)}}}}),activity:M.SelectionListView.design({selectionMode:M.SINGLE_SELECTION_DIALOG,label:"",initialText:M.I18N.l("activity"),applyTheme:NO,contentBinding:{target:DigiWebApp.SelectionController,property:"activities"},events:{change:{target:DigiWebApp.SelectionController,action:function(){this.saveSelection()}}}}),
uebernachtungskennzeichen:M.SelectionListView.design({selectionMode:M.SINGLE_SELECTION_DIALOG,applyTheme:NO,contentBinding:{target:DigiWebApp.SelectionController,property:"uebernachtungskennzeichenScholpp"},events:{change:{target:DigiWebApp.SelectionController,action:function(){this.saveSelection()}}}}),spesenkennzeichen:M.SelectionListView.design({selectionMode:M.SINGLE_SELECTION_DIALOG,applyTheme:NO,contentBinding:{target:DigiWebApp.SelectionController,property:"spesenkennzeichenScholpp"},events:{change:{target:DigiWebApp.SelectionController,
action:function(){}}}}),grid:M.GridView.design({childViews:"button icon",layout:{cssClass:"marginTop40 digiButton",columns:{0:"button",1:"icon"}},button:M.ButtonView.design({value:M.I18N.l("book2"),cssClass:"digiButton",anchorLocation:M.RIGHT,events:{tap:{target:DigiWebApp.BookingController,action:"book"}}}),icon:M.ImageView.design({value:"theme/images/icon_bookTime.png"})}),currentBookingLabel:M.LabelView.design({cssClass:"marginTop15 whiteLabel unselectable",computedValue:{contentBinding:{target:DigiWebApp.BookingController,
property:"currentBookingStr"},value:"",operation:function(a){return a!==""?M.I18N.l("bookingRunningSince")+" &nbsp;"+a:""}}})}),tabBar:DigiWebApp.TabBar});
DigiWebApp.BautagebuchNotizenDetailsPage=M.PageView.design({events:{pagebeforeshow:{action:function(){var a=NO,b=JSON.parse(JSON.stringify(DigiWebApp.BautagebuchBautageberichtDetailsController.positionenList));_.each(b,function(d){d.isSelected=parseInt(d.value)!==0?NO:YES});var c=_.map(b,function(d){if(typeof d==="undefined")console.log("UNDEFINED position");else{if(DigiWebApp.BautagebuchNotizenDetailsController.positionId){d.isSelected=d.value===DigiWebApp.BautagebuchNotizenDetailsController.positionId;
if(d.isSelected)a=YES}return d}});c=_.compact(c);if(b.length!==1)c.push({label:M.I18N.l("selectSomething"),value:"0",isSelected:!a});else{DigiWebApp.BautagebuchNotizenDetailsController.set("positionId",c[0].value);DigiWebApp.BautagebuchNotizenDetailsController.set("positionName",c[0].label)}DigiWebApp.BautagebuchNotizenDetailsController.set("positionenList",c);DigiWebApp.BautagebuchNotizenDetailsController.setTaetigkeiten(DigiWebApp.BautagebuchNotizenDetailsController.positionId);M.ViewManager.getView("bautagebuchNotizenDetailsPage",
"dataInput").setValue(DigiWebApp.BautagebuchNotizenDetailsController.data);$("#"+DigiWebApp.BautagebuchNotizenDetailsPage.content.dataInput.id)[0].focus();$("#"+DigiWebApp.BautagebuchNotizenDetailsPage.content.dataInput.id)[0].blur();if(DigiWebApp.BautagebuchBautageberichtDetailsController.item.get("abgeschlossen")){$("#"+DigiWebApp.BautagebuchNotizenDetailsPage.content.grid.id).hide();$("#"+DigiWebApp.BautagebuchNotizenDetailsPage.header.delButton.id).hide()}else{$("#"+DigiWebApp.BautagebuchNotizenDetailsPage.content.grid.id).show();
$("#"+DigiWebApp.BautagebuchNotizenDetailsPage.header.delButton.id).show()}}},pageshow:{action:function(){$("#"+DigiWebApp.BautagebuchNotizenDetailsPage.content.dataInput.id)[0].focus();$("#"+DigiWebApp.BautagebuchNotizenDetailsPage.content.dataInput.id)[0].blur()}},pagehide:{action:function(){M.ViewManager.getView("bautagebuchNotizenDetailsPage","dataInput").setCssProperty("height","400px")}}},cssClass:"bautagebuchNotizenDetailsPage",childViews:"header content",header:M.ToolbarView.design({childViews:"backButton title delButton",
cssClass:"header unselectable",isFixed:YES,backButton:M.ButtonView.design({value:M.I18N.l("back"),icon:"arrow-l",anchorLocation:M.LEFT,events:{tap:{action:function(){try{DigiWebApp.ApplicationController.vibrate()}catch(a){}history.back()}}}}),title:M.LabelView.design({value:M.I18N.l("BautagebuchNotiz"),anchorLocation:M.CENTER}),delButton:M.ButtonView.design({value:M.I18N.l("BautagebuchDelete"),icon:"delete",anchorLocation:M.RIGHT,events:{tap:{target:DigiWebApp.BautagebuchNotizenDetailsController,
action:function(){try{DigiWebApp.ApplicationController.vibrate()}catch(a){}this.deleteNotiz()}}}}),anchorLocation:M.TOP}),content:M.ScrollView.design({childViews:"positionComboBox activityComboBox dataInput grid",cssClass:"content",positionComboBox:M.SelectionListView.design({selectionMode:M.SINGLE_SELECTION_DIALOG,initialText:M.I18N.l("noData"),label:M.I18N.l("position"),applyTheme:NO,contentBinding:{target:DigiWebApp.BautagebuchNotizenDetailsController,property:"positionenList"},events:{change:{action:function(){DigiWebApp.BautagebuchNotizenDetailsController.set("positionId",
M.ViewManager.getView("bautagebuchNotizenDetailsPage","positionComboBox").getSelection(YES).value);DigiWebApp.BautagebuchNotizenDetailsController.set("positionName",M.ViewManager.getView("bautagebuchNotizenDetailsPage","positionComboBox").getSelection(YES).label);DigiWebApp.BautagebuchNotizenDetailsController.setTaetigkeiten(M.ViewManager.getView("bautagebuchNotizenDetailsPage","positionComboBox").getSelection(YES).value)}}}}),activityComboBox:M.SelectionListView.design({selectionMode:M.SINGLE_SELECTION_DIALOG,
initialText:M.I18N.l("noData"),label:M.I18N.l("activity"),applyTheme:NO,contentBinding:{target:DigiWebApp.BautagebuchNotizenDetailsController,property:"activityList"},events:{change:{action:function(){DigiWebApp.BautagebuchNotizenDetailsController.set("activityId",M.ViewManager.getView("bautagebuchNotizenDetailsPage","activityComboBox").getSelection(YES).value);DigiWebApp.BautagebuchNotizenDetailsController.set("activityName",M.ViewManager.getView("bautagebuchNotizenDetailsPage","activityComboBox").getSelection(YES).label)}}}}),
dataInput:M.TextFieldView.design({label:M.I18N.l("BautagebuchNotiz"),cssClass:"dataInput",cssClassOnInit:"dataInputInitial",hasMultipleLines:YES,initialText:"max. 4000 "+M.I18N.l("characters"),numberOfChars:4E3,events:{keyup:{action:function(){if(M.ViewManager.getView("bautagebuchNotizenDetailsPage","dataInput").getValue().length<=4E3)DigiWebApp.BautagebuchNotizenDetailsController.set("data",M.ViewManager.getView("bautagebuchNotizenDetailsPage","dataInput").getValue());else{M.ViewManager.getView("bautagebuchNotizenDetailsPage",
"dataInput").setValue(DigiWebApp.BautagebuchNotizenDetailsController.data);DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("maximaleFeldlaengeErreicht"),message:M.I18N.l("maximaleFeldlaengeErreichtMsg")})}}}}}),grid:M.GridView.design({childViews:"button icon",layout:{cssClass:"digiButton",columns:{0:"button",1:"icon"}},button:M.ButtonView.design({value:M.I18N.l("assume"),cssClass:"digiButton",anchorLocation:M.RIGHT,events:{tap:{target:DigiWebApp.BautagebuchNotizenDetailsController,
action:"save"}}}),icon:M.ImageView.design({value:"theme/images/icon_bookTime.png"})})})});
DigiWebApp.CameraPage=M.PageView.design({events:{pagebeforeshow:{target:DigiWebApp.CameraController,action:"init"}},cssClass:"cameraPage",childViews:"header content",savePicture:function(){var a="";if(M.ViewManager.getView("cameraPage","remarkInput").value!==null&&typeof M.ViewManager.getView("cameraPage","remarkInput").value!=="undefined")a=M.ViewManager.getView("cameraPage","remarkInput").value;if(a.length>255){DigiWebApp.ApplicationController.DigiLoaderView.hide();DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("remarkTooLong"),
message:M.I18N.l("remarkTooLongMessage")})}else if(DigiWebApp.ApplicationController.sonderzeichenCheck(a)){DigiWebApp.ApplicationController.DigiLoaderView.hide();DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("specialCharProblem"),message:M.I18N.l("specialCharProblemMsg")})}else DigiWebApp.CameraController.savePicture()},header:M.ToolbarView.design({childViews:"backButton title",cssClass:"header",isFixed:YES,backButton:M.ButtonView.design({value:M.I18N.l("back"),icon:"arrow-l",
anchorLocation:M.LEFT,events:{tap:{target:DigiWebApp.NavigationController,action:"backToMediaListPageTransition"}}}),title:M.LabelView.design({value:M.I18N.l("takePicture"),anchorLocation:M.CENTER}),anchorLocation:M.TOP}),content:M.ScrollView.design({childViews:"image spacer order position activity remarkInput savePictureGrid",image:M.ImageView.design({value:"",cssClass:"photo"}),spacer:M.LabelView.design({value:" "}),order:M.SelectionListView.design({selectionMode:M.SINGLE_SELECTION_DIALOG,initialText:M.I18N.l("noData"),
label:M.I18N.l("order"),applyTheme:NO,contentBinding:{target:DigiWebApp.CameraController,property:"orders"},events:{change:{target:DigiWebApp.CameraController,action:function(){this.setPositions()}}}}),position:M.SelectionListView.design({selectionMode:M.SINGLE_SELECTION_DIALOG,label:M.I18N.l("position"),initialText:M.I18N.l("noData"),applyTheme:NO,contentBinding:{target:DigiWebApp.CameraController,property:"positions"},events:{change:{target:DigiWebApp.CameraController,action:function(){this.setActivities(YES)}}}}),
activity:M.SelectionListView.design({selectionMode:M.SINGLE_SELECTION_DIALOG,label:M.I18N.l("activity"),initialText:M.I18N.l("noData"),applyTheme:NO,contentBinding:{target:DigiWebApp.CameraController,property:"activities"},events:{change:{target:DigiWebApp.CameraController,action:function(){}}}}),remarkInput:M.TextFieldView.design({label:M.I18N.l("remark"),cssClass:"remarkInput",hasMultipleLines:YES,numberOfChars:255}),savePictureGrid:M.GridView.design({childViews:"button icon",layout:{cssClass:"marginTop40 digiButton",
columns:{0:"button",1:"icon"}},button:M.ButtonView.design({value:M.I18N.l("assume"),cssClass:"digiButton",anchorLocation:M.RIGHT,events:{tap:{action:function(){DigiWebApp.CameraPage.savePicture()}}}}),icon:M.ImageView.design({value:"theme/images/icon_bookTime.png"})})})});
DigiWebApp.BautagebuchBautageberichtTemplateView=M.ListItemView.design({isSelectable:YES,childViews:"abgeschlossen datum startUhrzeit orderName",events:{tap:{action:function(a){var b=M.ViewManager.getViewById(a).modelId;_.each(DigiWebApp.BautagebuchBautageberichteListeController.items,function(c){if(c.m_id===b){DigiWebApp.BautagebuchBautageberichtDetailsController.load(c);if(c.get("abgeschlossen")===YES){DigiWebApp.BautagebuchZusammenfassungController.load(c);DigiWebApp.NavigationController.toBautagebuchZusammenfassungPageTransition()}else DigiWebApp.NavigationController.toBautagebuchBautageberichtDetailsPageTransition()}})}}},
spacer:M.LabelView.design({cssClass:"unselectable marginBottom12",value:" "}),abgeschlossen:M.LabelView.design({cssClass:"bigLabel unselectable",isInline:NO,computedValue:{valuePattern:"<%= abgeschlossen %>",operation:function(a){return parseBool(a)?M.I18N.l("BautagebuchAbgeschlossen"):""}}}),datum:M.LabelView.design({cssClass:"normal unselectable",isInline:YES,computedValue:{valuePattern:"<%= datum %>",operation:function(a){return a!==""?a:""}}}),startUhrzeit:M.LabelView.design({cssClass:"normal unselectable",
isInline:YES,computedValue:{valuePattern:"<%= startUhrzeit %>",operation:function(a){return a!==""?", "+M.I18N.l("BautagebuchStartingFrom")+" "+a:""}}}),orderName:M.LabelView.design({cssClass:"normal unselectable",computedValue:{valuePattern:"<%= orderName %>",operation:function(a){return a!==""?a:""}}})});
DigiWebApp.MediaListTemplateView=M.ListItemView.design({isSelectable:YES,childViews:"icon timeStamp order position activity latitude longitude remark",events:{tap:{action:function(a){DigiWebApp.ApplicationController.DigiLoaderView.show(M.I18N.l("loadMediaFile"));var b=NO,c=M.ViewManager.getViewById(a).modelId;_.each(DigiWebApp.MediaListController.items,function(d){if(d.m_id===c){DigiWebApp.EditPicturePageController.set("myMediaFile",d);b=YES}});b===YES?DigiWebApp.NavigationController.toEditPicturePageTransition():
DigiWebApp.ApplicationController.DigiLoaderView.hide()}}},icon:M.ImageView.design({cssClass:"icon",computedValue:{valuePattern:"<%= icon %>",operation:function(a){return a?"theme/images/"+a:""}}}),timeStamp:M.LabelView.design({cssClass:"date",computedValue:{valuePattern:"<%= timeStamp %>",operation:function(a){a=M.Date.create(Number(a));return a.format("dd.mm.yyyy")+", "+a.format("HH:MM:ss")}}}),order:M.LabelView.design({cssClass:"application",computedValue:{valuePattern:"<%= orderId %>",operation:function(a){var b=
_.select(DigiWebApp.Order.findSorted().concat(DigiWebApp.HandOrder.findSorted()),function(c){if(c)return a==c.get("id")||a==c.get("name")});if(b&&b.length>0){b=b[0];return DigiWebApp.SettingsController.globalDebugMode?M.I18N.l("order")+": "+b.get("name")+" ("+b.get("id")+")":M.I18N.l("order")+": "+b.get("name")}else return M.I18N.l("order")+": "+M.I18N.l("notDefined")}}}),position:M.LabelView.design({cssClass:"position",computedValue:{valuePattern:"<%= positionId %>",operation:function(a){if(a){var b=
_.select(DigiWebApp.Position.findSorted(),function(c){if(c)return a==c.get("id")});if(b&&b.length>0){b=b[0];return M.I18N.l("position")+": "+b.get("name")}else return M.I18N.l("position")+": "+M.I18N.l("notDefined")}else return M.I18N.l("position")+": "+M.I18N.l("unknown")}}}),activity:M.LabelView.design({cssClass:"activity",computedValue:{valuePattern:"<%= activityId %>",operation:function(a){if(a){var b=null;if(parseInt(a)!==0)b=_.select(DigiWebApp.Activity.findSorted(),function(c){if(c)return a==
c.get("id")});if(b&&b.length>0){b=b[0];return M.I18N.l("activity")+": "+b.get("name")}else return M.I18N.l("activity")+": "+M.I18N.l("notDefined")}else return M.I18N.l("activity")+": "+M.I18N.l("unknown")}}}),latitude:M.LabelView.design({cssClass:"location",computedValue:{valuePattern:"<%= latitude %>",operation:function(a){return a>0?M.I18N.l("latitude")+": "+a.toFixed(6):""}}}),longitude:M.LabelView.design({cssClass:"location",computedValue:{valuePattern:"<%= longitude %>",operation:function(a){return a>
0?M.I18N.l("longitude")+": "+a.toFixed(6):""}}}),remark:M.LabelView.design({cssClass:"remark unselectable",computedValue:{valuePattern:"<%= remark %>",operation:function(a){return a?M.I18N.l("remark")+": "+a:""}}})});m_require("app/views/MediaListTemplateView.js");m_require("app/views/MediaActionTemplateView.js");
DigiWebApp.MediaListPage=M.PageView.design({events:{pagebeforeshow:{target:DigiWebApp.MediaListController,action:"init"}},needsUpdate:true,childViews:"header actions mediafiles",cssClass:"mediaListPage unselectable",header:M.ToolbarView.design({childViews:"backButton title newButton",cssClass:"header",isFixed:YES,backButton:M.ButtonView.design({value:M.I18N.l("back"),icon:"arrow-l",anchorLocation:M.LEFT,events:{tap:{target:DigiWebApp.NavigationController,action:function(){try{DigiWebApp.ApplicationController.vibrate()}catch(a){}this.backToDashboardPage()}}}}),
title:M.LabelView.design({value:M.I18N.l("mediaList"),anchorLocation:M.CENTER}),newButton:M.ButtonView.design({value:M.I18N.l("BautagebuchAdd"),icon:"new",anchorLocation:M.RIGHT,events:{tap:{action:function(){DigiWebApp.MediaListController.neu()}}}}),anchorLocation:M.TOP}),mediafiles:M.ScrollView.design({childViews:"mediafileslist",cssClass:"mediafilesList",mediafileslist:M.ListView.design({contentBinding:{target:DigiWebApp.MediaListController,property:"items"},listItemTemplateView:DigiWebApp.MediaListTemplateView})}),
actions:M.ScrollView.design({childViews:"actionslist",cssClass:"actionsList",actionslist:M.ListView.design({contentBinding:{target:DigiWebApp.MediaListController,property:"actions"},listItemTemplateView:DigiWebApp.MediaActionTemplateView})})});
DigiWebApp.ButtonDashboardTemplateView=M.ListItemView.design({isSelectable:NO,childViews:"button icon",events:{tap:{target:DigiWebApp.DashboardController,action:"itemSelected"}},button:M.ButtonView.design({cssClass:"scholppButton",computedValue:{valuePattern:"<%= label %>",operation:function(a){return a===null||typeof a==="undefined"?null:a}},events:{tap:{target:DigiWebApp.DashboardController,action:"itemSelected"}}}),icon:M.ImageView.design({cssClass:"scholppButtonMenuIcon",computedValue:{valuePattern:"<%= icon %>",
operation:function(a){return a===null||typeof a==="undefined"?null:"theme/images/"+a}}})});m_require("app/views/TabBar.js");m_require("app/views/ButtonDashboardTemplateView.js");
DigiWebApp.ButtonDashboardPage=M.PageView.design({childViews:"header content tabBar",cssClass:"buttonDashboardPage unselectable",events:{pagebeforeshow:{target:DigiWebApp.DashboardController,action:"initButtons"},pageshow:{action:function(){DigiWebApp.TabBar.setActiveTab(DigiWebApp.TabBar.tabItem2)}}},needsUpdate:true,header:M.ToolbarView.design({value:M.I18N.l("menu"),cssClass:"header unselectable",isFixed:YES,anchorLocation:M.TOP}),content:M.ScrollView.design({childViews:"list",list:M.ListView.design({contentBinding:{target:DigiWebApp.DashboardController,
property:"itemsButtons"},listItemTemplateView:DigiWebApp.ButtonDashboardTemplateView})}),tabBar:DigiWebApp.TabBar});
DigiWebApp.EmployeePage=M.PageView.design({childViews:"header content",events:{pagebeforeshow:{target:DigiWebApp.EmployeeController,action:"init"}},cssClass:"employeePage",header:M.ToolbarView.design({cssClass:"header",isFixed:YES,value:M.I18N.l("selectEmployee"),anchorLocation:M.TOP}),content:M.ScrollView.design({childViews:"employeeSelection buttonGrid",employeeSelection:M.SelectionListView.design({selectionMode:M.MULTIPLE_SELECTION,label:M.I18N.l("employees"),cssClass:"infoLabel",contentBinding:{target:DigiWebApp.EmployeeController,
property:"employees"}}),buttonGrid:M.GridView.design({childViews:"button icon",layout:{cssClass:"digiButton",columns:{0:"button",1:"icon"}},button:M.ButtonView.design({value:M.I18N.l("apply"),cssClass:"digiButton",anchorLocation:M.RIGHT,events:{tap:{target:DigiWebApp.EmployeeController,action:function(){try{DigiWebApp.ApplicationController.vibrate()}catch(a){}this.saveEmployeeSelection()}}}}),icon:M.ImageView.design({value:"theme/images/icon_bookTime.png"})})})});
DigiWebApp.BautagebuchNotizenTemplateView=M.ListItemView.design({isSelectable:YES,childViews:"positionName activityName spacer data",events:{tap:{action:function(a){var b=M.ViewManager.getViewById(a).modelId;_.each(DigiWebApp.BautagebuchNotizenListeController.items,function(c){c.m_id===b&&DigiWebApp.BautagebuchNotizenDetailsController.load(c)});DigiWebApp.NavigationController.toBautagebuchNotizenDetailsPageTransition()}}},spacer:M.LabelView.design({value:""}),positionName:M.LabelView.design({cssClass:"normal unselectable",
isInline:YES,computedValue:{valuePattern:"<%= positionName %>",operation:function(a){return a!==""&&a!==null?a:""}}}),activityName:M.LabelView.design({cssClass:"normal unselectable",isInline:YES,computedValue:{valuePattern:"<%= activityName %>",operation:function(a){return a!==""&&a!==null?", "+a+":":":"}}}),data:M.LabelView.design({cssClass:"small unselectable",computedValue:{valuePattern:"<%= data %>",operation:function(a){return a!==""&&a!==null?a.length>50?a.substring(0,50)+"...":a.substring(0,
50):""}}})});m_require("app/views/BautagebuchNotizenTemplateView");
DigiWebApp.BautagebuchNotizenListePage=M.PageView.design({events:{pagebeforeshow:{target:DigiWebApp.BautagebuchNotizenListeController,action:"init"}},controller:DigiWebApp.BautagebuchNotizenListeController,navigationController:DigiWebApp.NavigationController,childViews:"header content",cssClass:"bautagebuchListePage unselectable",header:M.ToolbarView.design({childViews:"backButton title newButton",cssClass:"header unselectable",isFixed:YES,backButton:M.ButtonView.design({value:M.I18N.l("back"),icon:"arrow-l",
anchorLocation:M.LEFT,events:{tap:{target:DigiWebApp.NavigationController,action:function(){try{DigiWebApp.ApplicationController.vibrate()}catch(a){}this.backToBautagebuchBautageberichtDetailsPageTransition()}}}}),title:M.LabelView.design({value:M.I18N.l("BautagebuchNotizen"),anchorLocation:M.CENTER}),newButton:M.ButtonView.design({value:M.I18N.l("BautagebuchAdd"),icon:"new",anchorLocation:M.RIGHT,events:{tap:{action:function(){try{DigiWebApp.ApplicationController.vibrate()}catch(a){}DigiWebApp.BautagebuchNotizenListeController.neu()}}}}),
anchorLocation:M.TOP}),content:M.ScrollView.design({childViews:"list",list:M.ListView.design({contentBinding:{target:DigiWebApp.BautagebuchNotizenListeController,property:"items"},listItemTemplateView:DigiWebApp.BautagebuchNotizenTemplateView})})});
DigiWebApp.SplashViewPage=M.PageView.design({events:{pagebeforeshow:{action:function(){if(!(window.newAppVersionAvailable||DigiWebApp.ApplicationController.useSplashJustForFade))if(navigator.platform==="BlackBerry"&&restartOnBlackBerry)DigiWebApp.ApplicationController.blackBerryRestart_var=setTimeout("DigiWebApp.ApplicationController.blackBerryRestart()",3E3);else DigiWebApp.ApplicationController.regSecEv(YES)}},pageshow:{action:function(){window.newAppVersionAvailable||DigiWebApp.ApplicationController.useSplashJustForFade||
DigiWebApp.ApplicationController.DigiLoaderView.show(M.I18N.l("waitingForDevice"))}}},childViews:"content",cssClass:"splashViewPage",logo:M.ImageView.design({value:"theme/images/logo.png",cssClass:"logoSplashPage"}),content:M.ScrollView.design({cssClass:"infoBox",childViews:"title info",title:M.LabelView.design({value:"",cssClass:"appTitle"}),info:M.LabelView.design({value:"",cssClass:"infoMsg",contentBinding:{target:DigiWebApp.ApplicationController,property:"infoMsg"}})})});
DigiWebApp.BautagebuchTabBar=M.TabBarView.design({childViews:"tabItemMitte",anchorLocation:M.BOTTOM,isFixed:YES,transition:M.TRANSITION.FADE,name:"bautagebuchtabbar",tabItemLinks:M.TabBarItemView.design({value:M.I18N.l("backward"),page:"zeitbuchungenPage",icon:"arrow-l",switchPage:function(){try{DigiWebApp.ApplicationController.vibrate()}catch(a){}that.backwardHandler()}}),tabItemMitte:M.TabBarItemView.design({value:M.I18N.l("Bautagebuch")+" "+M.I18N.l("settings"),page:"bautagebuchEinstellungenPage",
icon:"gear",switchPage:function(){DigiWebApp.BautagebuchEinstellungenController.lastPage=M.ViewManager.getCurrentPage();DigiWebApp.NavigationController.toBautagebuchEinstellungenPageTransition()}}),tabItemRechts:M.TabBarItemView.design({value:M.I18N.l("forward"),page:"zeitbuchungenPage",icon:"arrow-r",switchPage:function(){try{DigiWebApp.ApplicationController.vibrate()}catch(a){}that.forwardHandler()}}),backwardHandler:function(){},forwardHandler:function(){}});m_require("app/views/BautagebuchTabBar.js");
m_require("app/views/BautagebuchBautageberichtTemplateView");
DigiWebApp.BautagebuchBautageberichteListePage=M.PageView.design({events:{pagebeforeshow:{target:DigiWebApp.BautagebuchBautageberichteListeController,action:"init"}},childViews:"header content tabBar",cssClass:"bautagebuchListePage unselectable",header:M.ToolbarView.design({childViews:"backButton title newButton",cssClass:"header unselectable",isFixed:YES,backButton:M.ButtonView.design({value:M.I18N.l("back"),icon:"arrow-l",anchorLocation:M.LEFT,events:{tap:{target:DigiWebApp.NavigationController,
action:function(){try{DigiWebApp.ApplicationController.vibrate()}catch(a){}this.backToDashboardPage()}}}}),title:M.LabelView.design({value:M.I18N.l("BautagebuchBautageberichte"),anchorLocation:M.CENTER}),newButton:M.ButtonView.design({value:M.I18N.l("BautagebuchAdd"),icon:"new",anchorLocation:M.RIGHT,events:{tap:{action:function(){try{DigiWebApp.ApplicationController.vibrate()}catch(a){}DigiWebApp.BautagebuchBautageberichteListeController.neu()}}}}),anchorLocation:M.TOP}),content:M.ScrollView.design({childViews:"list",
list:M.ListView.design({contentBinding:{target:DigiWebApp.BautagebuchBautageberichteListeController,property:"items"},listItemTemplateView:DigiWebApp.BautagebuchBautageberichtTemplateView})}),tabBar:DigiWebApp.BautagebuchTabBar});
DigiWebApp.BautagebuchNotizenZusammenfassungTemplateView=M.ListItemView.design({isSelectable:YES,childViews:"positionName activityName spacer data",events:{tap:{action:function(a){var b=M.ViewManager.getViewById(a).modelId;_.each(DigiWebApp.BautagebuchNotizenListeController.items,function(c){c.m_id===b&&DigiWebApp.BautagebuchNotizenDetailsController.load(c)});DigiWebApp.NavigationController.toBautagebuchNotizenDetailsPageTransition()}}},spacer:M.LabelView.design({value:""}),positionName:M.LabelView.design({cssClass:"normal unselectable",
isInline:YES,computedValue:{valuePattern:"<%= positionName %>",operation:function(a){return a!==""&&a!==null?a:""}}}),activityName:M.LabelView.design({cssClass:"normal unselectable",isInline:YES,computedValue:{valuePattern:"<%= activityName %>",operation:function(a){return a!==""&&a!==null?", "+a+":":":"}}}),data:M.LabelView.design({cssClass:"small unselectable marginRight40",computedValue:{valuePattern:"<%= data %>",operation:function(a){return a!==""&&a!==null?a:""}}})});
DigiWebApp.OrderInfoTemplateView=M.ListItemView.design({isSelectable:NO,hasSingleAction:NO,childViews:"orderName positionName spacer1 positionStrasseUndHausnummer positionPLZundORT positionLand positionTelefon positionFax positionEmail spacerNachEmail positionAnsprechpartner positionKundenname spacer3 positionBeschreibung spacer4 positionLongitude positionLatitude spacer5 showCoordinatesInMapButton saveAsContactButton showAddressInMapButton",orderName:M.LabelView.design({cssClass:"orderName",computedValue:{valuePattern:"<%= orderName %>",
operation:function(a){return a}}}),positionName:M.LabelView.design({cssClass:"positionName",computedValue:{valuePattern:"<%= positionName %>",operation:function(a){return a===""||a===null?M.I18N.l("position")+": "+M.I18N.l("noData"):M.I18N.l("position")+": "+a}}}),positionStrasseUndHausnummer:M.LabelView.design({cssClass:"positionName",computedValue:{valuePattern:"<%= positionStrasseUndHausnummer %>",operation:function(a){return a}}}),positionPLZundORT:M.LabelView.design({cssClass:"positionName",
computedValue:{valuePattern:"<%= positionPLZundOrt %>",operation:function(a){return a}}}),positionLand:M.LabelView.design({cssClass:"positionName",computedValue:{valuePattern:"<%= positionLand %>",operation:function(a){return a}}}),positionTelefon:M.LabelView.design({cssClass:"positionName",computedValue:{valuePattern:"<%= positionTelefon %>",operation:function(a){return a===""||a===null||a==="undefined"||typeof a==="undefined"?"":M.I18N.l("phone")+": "+a}}}),positionFax:M.LabelView.design({cssClass:"positionName",
computedValue:{valuePattern:"<%= positionFax %>",operation:function(a){return a===""||a===null||a==="undefined"||typeof a==="undefined"?"":M.I18N.l("fax")+": "+a}}}),positionEmail:M.LabelView.design({cssClass:"positionName",computedValue:{valuePattern:"<%= positionEmail %>",operation:function(a){return a===""||a===null||a==="undefined"||typeof a==="undefined"?"":M.I18N.l("email")+": "+a}}}),spacerNachEmail:M.LabelView.design({value:" ",cssClass:"marginBottom12"}),positionAnsprechpartner:M.LabelView.design({cssClass:"positionName",
computedValue:{valuePattern:"<%= positionAnsprechpartner %>",operation:function(a){return a===""||a===null||a==="undefined"||typeof a==="undefined"?"":M.I18N.l("ansprechpartner")+": "+a}}}),positionKundenname:M.LabelView.design({cssClass:"positionName",computedValue:{valuePattern:"<%= positionKundenname %>",operation:function(a){return a===""||a===null||a==="undefined"||typeof a==="undefined"?"":M.I18N.l("kundenname")+": "+a}}}),positionLongitude:M.LabelView.design({cssClass:"positionName",computedValue:{valuePattern:"<%= positionLongitude %>",
operation:function(a){return a==="0.0"||a===0||a===null||a==="undefined"||typeof a==="undefined"?"":M.I18N.l("longitude")+": "+a}}}),positionLatitude:M.LabelView.design({cssClass:"positionName",computedValue:{valuePattern:"<%= positionLatitude %>",operation:function(a){return a==="0.0"||a===0||a===null||a==="undefined"||typeof a==="undefined"?"":M.I18N.l("latitude")+": "+a}}}),positionBeschreibung:M.LabelView.design({cssClass:"positionName",computedValue:{valuePattern:"<%= positionBeschreibung %>",
operation:function(a){return a===""||a===null||a==="undefined"||typeof a==="undefined"?"":M.I18N.l("positionDescription")+":<br />"+a}}}),spacer1:M.LabelView.design({value:" ",cssClass:"marginBottom12"}),spacer2:M.LabelView.design({value:" ",cssClass:"marginBottom12"}),spacer3:M.LabelView.design({value:" ",cssClass:"marginBottom12"}),spacer4:M.LabelView.design({value:" ",cssClass:"marginBottom12"}),spacer5:M.LabelView.design({value:" ",cssClass:"marginBottom12"}),saveAsContactButton:M.ButtonView.design({value:M.I18N.l("saveAsContact"),
events:{tap:{target:DigiWebApp.OrderInfoController,action:function(){try{DigiWebApp.ApplicationController.vibrate()}catch(a){}this.saveAsContact()}}}}),showAddressInMapButton:M.ButtonView.design({value:M.I18N.l("showAddressInMap"),events:{tap:{action:function(a,b){try{DigiWebApp.ApplicationController.vibrate()}catch(c){}DigiWebApp.OrderInfoController.items.length===0&&DigiWebApp.OrderInfoController.set("items",DigiWebApp.OrderDetailsController.positionForDetails);try{b.preventDefault()}catch(d){console.error(d)}var f=
DigiWebApp.OrderInfoController.items[0].positionCountryCode,e=DigiWebApp.OrderInfoController.items[0].positionPLZ,g=DigiWebApp.OrderInfoController.items[0].positionOrt,h=DigiWebApp.OrderInfoController.items[0].positionStrasse,i=DigiWebApp.OrderInfoController.items[0].positionHausnummer,j="";switch(DigiWebApp.SettingsController.getSetting("mapType")){case "OSM":DigiWebApp.SettingsController.featureAvailable("419")?alert(M.I18N.l("showInMapScholpp")):alert(M.I18N.l("showInMapOSMAlert"));j="http://nominatim.openstreetmap.org/search/"+
f+"/"+g+"/"+h+"/"+i+"?format=html&polygon=1&addressdetails=0";break;case "Bing":DigiWebApp.SettingsController.featureAvailable("419")?alert(M.I18N.l("showInMapScholpp")):alert(M.I18N.l("showInMapBingAlert"));j="http://www.bing.com/maps/default.aspx?rtp=~adr."+h+" "+i+" "+e+" "+g+" "+f;break;case "Google":DigiWebApp.SettingsController.featureAvailable("419")?alert(M.I18N.l("showInMapScholpp")):alert(M.I18N.l("showInMapGoogleAlert"));j="http://maps.google.com/maps?q="+h+" "+i+" "+e+" "+g+" "+f+"&hl=de";
break;default:j="disabled"}if(j!=="disabled")if(typeof plugins!=="undefined")if(typeof plugins.childBrowser!=="undefined"){try{plugins.childBrowser.close()}catch(l){alert("Error: "+l.message)}try{plugins.childBrowser.showWebPage(encodeURI(j),{showNavigationBar:true})}catch(m){alert("Error: "+m.message)}}else DigiWebApp.ApplicationController.inAppBrowser_var=window.open(j,"childBrowser","width=800,height=600,menubar=no,status=no,location=yes,copyhistory=no,directories=no");else DigiWebApp.ApplicationController.inAppBrowser_var=
window.open(j,"childBrowser","width=800,height=600,menubar=no,status=no,location=yes,copyhistory=no,directories=no");return false}}}}),showCoordinatesInMapButton:M.ButtonView.design({value:M.I18N.l("showCoordinatesInMap"),events:{tap:{action:function(){try{DigiWebApp.ApplicationController.vibrate()}catch(a){}DigiWebApp.OrderInfoController.items.length===0&&DigiWebApp.OrderInfoController.set("items",DigiWebApp.OrderDetailsController.positionForDetails);var b=DigiWebApp.OrderInfoController.items[0].positionLongitude,
c=DigiWebApp.OrderInfoController.items[0].positionLatitude,d="";switch(DigiWebApp.SettingsController.getSetting("mapType")){case "OSM":DigiWebApp.SettingsController.featureAvailable("419")?alert(M.I18N.l("showInMapScholpp")):alert(M.I18N.l("showInMapOSMAlert"));d="http://www.openstreetmap.org/index.html?mlat="+c+"&mlon="+b+"&zoom=15&layers=M";break;case "Bing":DigiWebApp.SettingsController.featureAvailable("419")?alert(M.I18N.l("showInMapScholpp")):alert(M.I18N.l("showInMapBingAlert"));d="http://www.bing.com/maps/default.aspx?rtp=adr.~pos."+
c+"_"+b+"_&lvl=151";break;case "Google":DigiWebApp.SettingsController.featureAvailable("419")?alert(M.I18N.l("showInMapScholpp")):alert(M.I18N.l("showInMapGoogleAlert"));d="http://maps.google.com/maps?q="+c+"+"+b+"&hl=de";break;default:d="disabled"}if(d!=="disabled")if(typeof plugins!=="undefined")if(typeof plugins.childBrowser!=="undefined"){try{plugins.childBrowser.close()}catch(f){alert("Error: "+f.message)}try{plugins.childBrowser.showWebPage(encodeURI(d),{showNavigationBar:true})}catch(e){alert("Error: "+
e.message)}}else DigiWebApp.ApplicationController.inAppBrowser_var=window.open(d,"childBrowser","width=800,height=600,menubar=no,status=no,location=yes,copyhistory=no,directories=no");else DigiWebApp.ApplicationController.inAppBrowser_var=window.open(d,"childBrowser","width=800,height=600,menubar=no,status=no,location=yes,copyhistory=no,directories=no")}}}})});m_require("app/views/OrderInfoTemplateView");
DigiWebApp.OrderDetailsPage=M.PageView.design({events:{pageshow:{target:DigiWebApp.OrderDetailsController,action:"init"}},childViews:"header spacer list",cssClass:"orderInfoPage",header:M.ToolbarView.design({childViews:"backButton title",cssClass:"header",isFixed:YES,backButton:M.ButtonView.design({value:M.I18N.l("back"),icon:"arrow-l",anchorLocation:M.LEFT,events:{tap:{target:DigiWebApp.NavigationController,action:function(){try{DigiWebApp.ApplicationController.vibrate()}catch(a){}this.backToZeitbuchungDetailsPageTransition()}}}}),
title:M.LabelView.design({value:M.I18N.l("orderInfo"),anchorLocation:M.CENTER}),anchorLocation:M.TOP}),spacer:M.LabelView.design({value:" ",cssClass:"marginBottom12"}),list:M.ListView.design({contentBinding:{target:DigiWebApp.OrderDetailsController,property:"positionForDetails"},listItemTemplateView:DigiWebApp.OrderInfoTemplateView})});m_require("app/views/OrderInfoTemplateView");
DigiWebApp.OrderInfoPage=M.PageView.design({events:{pagebeforeshow:{target:DigiWebApp.OrderInfoController,action:"init"}},childViews:"header selectionContent list",cssClass:"orderInfoPage",header:M.ToolbarView.design({childViews:"backButton title",cssClass:"header",isFixed:YES,backButton:M.ButtonView.design({value:M.I18N.l("back"),icon:"arrow-l",anchorLocation:M.LEFT,events:{tap:{target:DigiWebApp.NavigationController,action:function(){try{DigiWebApp.ApplicationController.vibrate()}catch(a){}this.backToDashboardPage()}}}}),
title:M.LabelView.design({value:M.I18N.l("orderInfo"),anchorLocation:M.CENTER}),anchorLocation:M.TOP}),selectionContent:M.ScrollView.design({childViews:"order position",order:M.SelectionListView.design({selectionMode:M.SINGLE_SELECTION_DIALOG,initialText:M.I18N.l("noData"),label:M.I18N.l("order"),applyTheme:NO,contentBinding:{target:DigiWebApp.OrderInfoController,property:"orders"},events:{change:{target:DigiWebApp.OrderInfoController,action:function(){var a=M.ViewManager.getView("orderInfoPage",
"order").getSelection(YES).value;if(a){var b=DigiWebApp.HandOrder.findSorted().concat(DigiWebApp.Order.findSorted());_.each(b,function(c){if(c.get("id")===a){DigiWebApp.OrderInfoController.set("activeOrder",[c]);if(DigiWebApp.SettingsController.getSetting("auftragsDetailsKoppeln")){c=DigiWebApp.SelectionController.selections;c.order=M.ViewManager.getView("orderInfoPage","order").getSelection();DigiWebApp.SelectionController.set("selections",c);M.ViewManager.getView("bookingPage","order").setSelection(M.ViewManager.getView("orderInfoPage",
"order").getSelection());DigiWebApp.SelectionController.setPositions()}}});DigiWebApp.OrderInfoController.setPositions()}DigiWebApp.OrderInfoController.setItem()}}}}),position:M.SelectionListView.design({selectionMode:M.SINGLE_SELECTION_DIALOG,initialText:M.I18N.l("noData"),label:M.I18N.l("position"),applyTheme:NO,contentBinding:{target:DigiWebApp.OrderInfoController,property:"positions"},events:{change:{target:DigiWebApp.OrderInfoController,action:function(){var a=M.ViewManager.getView("orderInfoPage",
"position").getSelection(YES).value;if(a){var b=DigiWebApp.Position.findSorted();_.each(b,function(c){if(c.get("id")===a){DigiWebApp.OrderInfoController.set("activePosition",[c]);if(DigiWebApp.SettingsController.getSetting("auftragsDetailsKoppeln")){c=DigiWebApp.SelectionController.selections;c.position=M.ViewManager.getView("orderInfoPage","position").getSelection();DigiWebApp.SelectionController.set("selections",c);M.ViewManager.getView("bookingPage","position").setSelection(M.ViewManager.getView("orderInfoPage",
"position").getSelection());DigiWebApp.SelectionController.setActivities(YES)}}})}DigiWebApp.OrderInfoController.setItem()}}}})}),list:M.ListView.design({contentBinding:{target:DigiWebApp.OrderInfoController,property:"items"},listItemTemplateView:DigiWebApp.OrderInfoTemplateView})});
DigiWebApp.VorZurueckTabBar=M.TabBarView.design({childViews:"tabItemZurueck tabItemDayToShow tabItemVor",anchorLocation:M.BOTTOM,isFixed:YES,transition:M.TRANSITION.FADE,name:"vorzuruecktabbar",tabItemZurueck:M.TabBarItemView.design({value:M.I18N.l("backward"),page:"zeitbuchungenPage",icon:"arrow-l",switchPage:function(){try{DigiWebApp.ApplicationController.vibrate()}catch(a){}DigiWebApp.VorZurueckTabBar.backwardHandler()}}),tabItemDayToShow:M.TabBarItemView.design({value:"",page:"zeitbuchungenPage",
icon:""}),tabItemVor:M.TabBarItemView.design({value:M.I18N.l("forward"),page:"zeitbuchungenPage",icon:"arrow-r",switchPage:function(){try{DigiWebApp.ApplicationController.vibrate()}catch(a){}DigiWebApp.VorZurueckTabBar.forwardHandler()}}),backwardHandler:function(){DigiWebApp.ZeitbuchungenController.set("items",null);DigiWebApp.ZeitbuchungenController.items=null;DigiWebApp.ZeitbuchungenController.set("datum",D8.create(DigiWebApp.ZeitbuchungenController.datum).addDays(-1).format("dd.mm.yyyy"));DigiWebApp.ZeitbuchungenController.init(YES)},
forwardHandler:function(){DigiWebApp.ZeitbuchungenController.set("items",null);DigiWebApp.ZeitbuchungenController.items=null;DigiWebApp.ZeitbuchungenController.set("datum",D8.create(DigiWebApp.ZeitbuchungenController.datum).addHours(25).format("dd.mm.yyyy"));DigiWebApp.ZeitbuchungenController.init(YES)}});m_require("app/views/ZeitbuchungenTemplateView");m_require("app/views/VorZurueckTabBar.js");
DigiWebApp.ZeitbuchungenPage=M.PageView.design({events:{pageshow:{target:DigiWebApp.ZeitbuchungenController,action:"init"}},childViews:"header content tabBar",cssClass:"zeitbuchungenPage unselectable",header:M.ToolbarView.design({childViews:"backButton title",cssClass:"header unselectable",isFixed:YES,backButton:M.ButtonView.design({value:M.I18N.l("back"),icon:"arrow-l",anchorLocation:M.LEFT,events:{tap:{target:DigiWebApp.NavigationController,action:function(){try{DigiWebApp.ApplicationController.vibrate()}catch(a){}this.backToAnwesenheitslistePageTransition()}}}}),
title:M.LabelView.design({value:M.I18N.l("Zeitbuchungen"),anchorLocation:M.CENTER}),anchorLocation:M.TOP}),content:M.ScrollView.design({childViews:"list",list:M.ListView.design({contentBinding:{target:DigiWebApp.ZeitbuchungenController,property:"items"},listItemTemplateView:DigiWebApp.ZeitbuchungenTemplateView})}),tabBar:DigiWebApp.VorZurueckTabBar});
DigiWebApp.BautagebuchMedienTemplateView=M.ListItemView.design({isSelectable:YES,childViews:"positionName activityName spacer remark",events:{tap:{action:function(a){var b=M.ViewManager.getViewById(a).modelId;_.each(DigiWebApp.BautagebuchMedienListeController.items,function(c){c.m_id===b&&DigiWebApp.BautagebuchMedienDetailsController.load(c)});DigiWebApp.NavigationController.toBautagebuchMedienDetailsPageTransition()}}},spacer:M.LabelView.design({value:""}),positionName:M.LabelView.design({cssClass:"normal unselectable",
isInline:YES,computedValue:{valuePattern:"<%= positionName %>",operation:function(a){return a!==""&&a!==null?a:""}}}),activityName:M.LabelView.design({cssClass:"normal unselectable",isInline:YES,computedValue:{valuePattern:"<%= activityName %>",operation:function(a){return a!==""&&a!==null?", "+a+":":":"}}}),remark:M.LabelView.design({cssClass:"small unselectable",computedValue:{valuePattern:"<%= remark %>",operation:function(a){return a!==""&&a!==null?a.length>50?a.substring(0,50)+"...":a.substring(0,
50):""}}})});m_require("app/views/BautagebuchMedienTemplateView");
DigiWebApp.BautagebuchMedienListePage=M.PageView.design({events:{pagebeforeshow:{target:DigiWebApp.BautagebuchMedienListeController,action:"init"}},controller:DigiWebApp.BautagebuchMedienListeController,navigationController:DigiWebApp.NavigationController,childViews:"header content",cssClass:"bautagebuchListePage unselectable",header:M.ToolbarView.design({childViews:"backButton title newButton",cssClass:"header unselectable",isFixed:YES,backButton:M.ButtonView.design({value:M.I18N.l("back"),icon:"arrow-l",
anchorLocation:M.LEFT,events:{tap:{target:DigiWebApp.NavigationController,action:function(){try{DigiWebApp.ApplicationController.vibrate()}catch(a){}this.backToBautagebuchBautageberichtDetailsPageTransition()}}}}),title:M.LabelView.design({value:M.I18N.l("BautagebuchMedien"),anchorLocation:M.CENTER}),newButton:M.ButtonView.design({value:M.I18N.l("BautagebuchAdd"),icon:"new",anchorLocation:M.RIGHT,events:{tap:{action:function(){try{DigiWebApp.ApplicationController.vibrate()}catch(a){}DigiWebApp.BautagebuchMedienListeController.neu()}}}}),
anchorLocation:M.TOP}),content:M.ScrollView.design({childViews:"list",list:M.ListView.design({contentBinding:{target:DigiWebApp.BautagebuchMedienListeController,property:"items"},listItemTemplateView:DigiWebApp.BautagebuchMedienTemplateView})})});m_require("app/views/BautagebuchZusammenfassungMitarbeiterSummeTemplateView");m_require("app/views/BautagebuchMaterialienTemplateView");m_require("app/views/BautagebuchNotizenZusammenfassungTemplateView");m_require("app/views/BautagebuchMedienTemplateView");
DigiWebApp.BautagebuchZusammenfassungPage=M.PageView.design({events:{pagebeforeshow:{action:function(){DigiWebApp.BautagebuchZusammenfassungController.init(YES);$("#"+DigiWebApp.BautagebuchZusammenfassungPage.content.container.detailsGrid.id).addClass("marginBottom20");$("#"+DigiWebApp.BautagebuchZusammenfassungPage.content.container.detailsGrid.id).addClass("detailsGrid");DigiWebApp.BautagebuchMaterialienListeController.init(YES);DigiWebApp.BautagebuchNotizenListeController.init(YES);DigiWebApp.BautagebuchMedienListeController.init(YES);
if(parseBool(DigiWebApp.BautagebuchZusammenfassungController.item.get("abgeschlossen"))){$("#"+DigiWebApp.BautagebuchZusammenfassungPage.content.grid.id).hide();$("#"+DigiWebApp.BautagebuchZusammenfassungPage.header.delButton.id).show();$("#"+DigiWebApp.BautagebuchZusammenfassungPage.content.transferGrid.id).show();$("#"+DigiWebApp.BautagebuchZusammenfassungPage.content.container.leistungsnachweisList.zeitenAendernButton.id).hide()}else{$("#"+DigiWebApp.BautagebuchZusammenfassungPage.content.grid.id).show();
$("#"+DigiWebApp.BautagebuchZusammenfassungPage.header.delButton.id).show();$("#"+DigiWebApp.BautagebuchZusammenfassungPage.content.transferGrid.id).hide();$("#"+DigiWebApp.BautagebuchZusammenfassungPage.content.container.leistungsnachweisList.zeitenAendernButton.id).show()}$("#"+DigiWebApp.BautagebuchZusammenfassungPage.content.container.leistungsnachweisList.zeitenAendernButton.id).addClass("zeitenAendernButton");if(DigiWebApp.SettingsController.featureAvailable("405")&&typeof window.requestFileSystem!==
"undefined"){$("#"+DigiWebApp.BautagebuchZusammenfassungPage.content.container.signature.id).show();var a={bgColour:"#aaa",lineTop:300,drawOnly:true};if(DigiWebApp.BautagebuchZusammenfassungPage.signaturePadAPI===null)DigiWebApp.BautagebuchZusammenfassungPage.signaturePadAPI=$(".sigPad2").signaturePad(a)}else $("#"+DigiWebApp.BautagebuchZusammenfassungPage.content.container.signature.id).hide();if(DigiWebApp.SettingsController.featureAvailable("405")&&typeof window.requestFileSystem!=="undefined")DigiWebApp.BautagebuchZusammenfassungController.item.hasFileName()===
YES?DigiWebApp.BautagebuchZusammenfassungController.item.readFromFile(function(b){b&&b!==""&&DigiWebApp.BautagebuchZusammenfassungPage.signaturePadAPI.regenerate(b)},function(){DigiWebApp.BautagebuchZusammenfassungPage.signaturePadAPI.clearCanvas()}):DigiWebApp.BautagebuchZusammenfassungPage.signaturePadAPI.clearCanvas()}}},signaturePadAPI:null,childViews:"header content",cssClass:"bautagebuchListePage unselectable",header:M.ToolbarView.design({childViews:"backButton title delButton",cssClass:"header unselectable",
isFixed:YES,backButton:M.ButtonView.design({value:M.I18N.l("back"),icon:"arrow-l",anchorLocation:M.LEFT,events:{tap:{action:function(){try{DigiWebApp.ApplicationController.vibrate()}catch(a){}history.back()}}}}),title:M.LabelView.design({value:M.I18N.l("BautagebuchZusammenfassung"),anchorLocation:M.CENTER}),delButton:M.ButtonView.design({value:M.I18N.l("BautagebuchDelete"),icon:"delete",anchorLocation:M.RIGHT,events:{tap:{action:function(){try{DigiWebApp.ApplicationController.vibrate()}catch(a){}DigiWebApp.BautagebuchBautageberichtDetailsController.deleteBautagesbericht(DigiWebApp.NavigationController.backToBautagebuchBautageberichteListePageTransition)}}}}),
anchorLocation:M.TOP}),content:M.ScrollView.design({childViews:"container grid transferGrid",container:M.ContainerView.design({childViews:"detailsGrid leistungsnachweisList materialienList notizenList medienList signature spacer",cssClass:"bautagebuchZusammenfassungScrollView",spacer:M.LabelView.design({value:"&nbsp;"}),detailsGrid:M.GridView.design({childViews:"details wetter",cssClass:"marginBottom20 detailsGrid",layout:M.TWO_COLUMNS,details:M.ContainerView.design({childViews:"auftrag datum spacer1 projektleiter spacer2 startUhrzeit",
spacer1:M.LabelView.design({value:"&nbsp;"}),spacer2:M.LabelView.design({value:"&nbsp;"}),auftrag:M.LabelView.design({value:"",cssClass:"bigLabel bold underline",isInline:YES,computedValue:{contentBinding:{target:DigiWebApp.BautagebuchZusammenfassungController,property:"auftragsName"},value:"",operation:function(a){return a+": "}}}),datum:M.LabelView.design({value:"",cssClass:"bigLabel bold underline",isInline:YES,contentBinding:{target:DigiWebApp.BautagebuchZusammenfassungController,property:"datum"}}),
projektleiter:M.LabelView.design({value:"",cssClass:"bigLabel",computedValue:{contentBinding:{target:DigiWebApp.BautagebuchZusammenfassungController,property:"projektleiterId"},value:"",operation:function(a){var b=_.find(DigiWebApp.BautagebuchProjektleiter.find(),function(c){return parseInt(c.get("id"))===a});return typeof b!=="undefined"?M.I18N.l("BautagebuchProjektleiter")+": "+b.vollername():""}}}),startUhrzeit:M.LabelView.design({value:"",cssClass:"bigLabel",computedValue:{contentBinding:{target:DigiWebApp.BautagebuchZusammenfassungController,
property:"startUhrzeit"},value:"",operation:function(a){return M.I18N.l("BautagebuchStartingFrom")+" "+a+" "+M.I18N.l("oclock")}}})}),wetter:M.ContainerView.design({childViews:"temperatur luftfeuchte bewoelkung niederschlag wind wechselhaft",cssClass:"wetterBlock",temperatur:M.GridView.design({layout:M.TWO_COLUMNS,childViews:"myLabel myValue",myLabel:M.LabelView.design({value:M.I18N.l("BautagebuchTemperatur")}),myValue:M.LabelView.design({value:"",cssClass:"right",computedValue:{contentBinding:{target:DigiWebApp.BautagebuchZusammenfassungController,
property:"wetter.temperatur"},value:"",operation:function(a){return a+"\u00b0C"}}})}),luftfeuchte:M.GridView.design({layout:M.TWO_COLUMNS,childViews:"myLabel myValue",myLabel:M.LabelView.design({value:M.I18N.l("BautagebuchLuftfeuchtigkeit")}),myValue:M.LabelView.design({value:"",cssClass:"right",computedValue:{contentBinding:{target:DigiWebApp.BautagebuchZusammenfassungController,property:"wetter.luftfeuchtigkeit"},value:"",operation:function(a){return a+"%"}}})}),bewoelkung:M.GridView.design({layout:M.TWO_COLUMNS,
childViews:"myLabel myValue",myLabel:M.LabelView.design({value:M.I18N.l("BautagebuchBewoelkung")}),myValue:M.LabelView.design({value:"",cssClass:"right",computedValue:{contentBinding:{target:DigiWebApp.BautagebuchZusammenfassungController,property:"wetter.bewoelkung"},value:0,operation:function(a){switch(a){case 0:return M.I18N.l("BautagebuchBewoelkungKlar");case 1:return M.I18N.l("BautagebuchBewoelkungMaessig");case 2:return M.I18N.l("BautagebuchBewoelkungBedeckt");case 3:return M.I18N.l("BautagebuchBewoelkungNeblig");
default:return""}}}})}),niederschlag:M.GridView.design({layout:M.TWO_COLUMNS,childViews:"myLabel myValue",myLabel:M.LabelView.design({value:M.I18N.l("BautagebuchNiederschlag")}),myValue:M.LabelView.design({value:"",cssClass:"right",computedValue:{contentBinding:{target:DigiWebApp.BautagebuchZusammenfassungController,property:"wetter.niederschlag"},value:0,operation:function(a){switch(a){case 0:return M.I18N.l("BautagebuchNiederschlagKein");case 1:return M.I18N.l("BautagebuchNiederschlagNiesel");case 2:return M.I18N.l("BautagebuchNiederschlagRegen");
case 3:return M.I18N.l("BautagebuchNiederschlagGraupel");case 4:return M.I18N.l("BautagebuchNiederschlagSchnee");case 5:return M.I18N.l("BautagebuchNiederschlagHagel");default:return""}}}})}),wind:M.GridView.design({layout:M.TWO_COLUMNS,childViews:"myLabel myValue",myLabel:M.LabelView.design({value:M.I18N.l("BautagebuchWind")}),myValue:M.LabelView.design({value:"",cssClass:"right",computedValue:{contentBinding:{target:DigiWebApp.BautagebuchZusammenfassungController,property:"wetter.wind"},value:0,
operation:function(a){switch(a){case 0:return M.I18N.l("BautagebuchWindStill");case 1:return M.I18N.l("BautagebuchWindMaessig");case 2:return M.I18N.l("BautagebuchWindBoeig");case 3:return M.I18N.l("BautagebuchWindStuermisch");default:return""}}}})}),wechselhaft:M.GridView.design({layout:M.TWO_COLUMNS,childViews:"myLabel myValue",myLabel:M.LabelView.design({value:M.I18N.l("BautagebuchWechselhaft")}),myValue:M.LabelView.design({value:"",cssClass:"right",computedValue:{contentBinding:{target:DigiWebApp.BautagebuchZusammenfassungController,
property:"wetter.wechselhaft"},value:0,operation:function(a){switch(a){case false:return M.I18N.l("no");case true:return M.I18N.l("yes");default:return""}}}})})})}),leistungsnachweisList:M.ContainerView.design({childViews:"myLabel zeitenAendernButton list",cssClass:"marginBottom20 leistungsnachweisList",doNotOverlapAtTop:YES,doNotOverlapAtBottom:YES,myLabel:M.LabelView.design({cssClass:"bigLabel bold",isInline:YES,value:M.I18N.l("BautagebuchLeistungsnachweis")+":"}),zeitenAendernButton:M.ButtonView.design({value:M.I18N.l("BautagebuchZeitenAendern"),
anchorLocation:M.RIGHT,isInline:YES,events:{tap:{target:DigiWebApp.NavigationController,action:"backToBautagebuchZeitenListePageTransition"}}}),list:M.ListView.design({cssClass:"marginTop25important",isDividedList:YES,contentBinding:{target:DigiWebApp.BautagebuchZusammenfassungController,property:"ZeitbuchungenPerMitarbeiterList"},listItemTemplateView:DigiWebApp.BautagebuchZusammenfassungMitarbeiterSummeTemplateView})}),materialienList:M.ContainerView.design({childViews:"myLabel list",cssClass:"marginBottom20 materialienList",
doNotOverlapAtTop:YES,doNotOverlapAtBottom:YES,myLabel:M.LabelView.design({cssClass:"bigLabel bold",value:M.I18N.l("BautagebuchMaterialien")+":"}),list:M.ListView.design({cssClass:"marginTop20",contentBinding:{target:DigiWebApp.BautagebuchMaterialienListeController,property:"items"},listItemTemplateView:DigiWebApp.BautagebuchMaterialienTemplateView})}),notizenList:M.ContainerView.design({childViews:"myLabel list",cssClass:"marginBottom20 notizenList",doNotOverlapAtTop:YES,doNotOverlapAtBottom:YES,
myLabel:M.LabelView.design({cssClass:"bigLabel bold",value:M.I18N.l("BautagebuchNotizen")+":"}),list:M.ListView.design({cssClass:"marginTop20",contentBinding:{target:DigiWebApp.BautagebuchNotizenListeController,property:"items"},listItemTemplateView:DigiWebApp.BautagebuchNotizenZusammenfassungTemplateView})}),medienList:M.ContainerView.design({childViews:"myLabel list",cssClass:"marginBottom20 medienList borderBottom",doNotOverlapAtTop:YES,doNotOverlapAtBottom:YES,myLabel:M.LabelView.design({cssClass:"bigLabel bold",
value:M.I18N.l("BautagebuchMedien")+":"}),list:M.ListView.design({cssClass:"marginTop20",contentBinding:{target:DigiWebApp.BautagebuchMedienListeController,property:"items"},listItemTemplateView:DigiWebApp.BautagebuchMedienTemplateView})}),signature:M.ContainerView.design({childViews:"signatureform",cssClass:"signaturecanvas2 marginTop20 marginBottom20",signatureform:M.FormView.design({childViews:"signaturecanvas",signaturecanvas:M.CanvasView.design({label:M.I18N.l("signature")+":",canvasWidth:550,
canvasHeight:320,render:function(){if(this.label)this.html+='<label for="'+this.id+'" class="signaturecanvaslabel">'+this.label+"</label>";this.html+='  <div id="'+this.id+'_container" class="sig sigWrapper2">';this.html+='    <canvas id="'+this.id+'_canvas" class="pad" width="'+this.canvasWidth+'px" height="'+this.canvasHeight+'px" style="border-color: #000; border: 1px solid #ccc;"></canvas>';this.html+='    <input id="'+this.id+'" type="hidden" name="output" class="output">';this.html+="  </div>";
return this.html}}),render:function(){this.html+='<form method="post" action="" class="sigPad2">';this.renderChildViews();this.html+="</form>";return this.html}})})}),grid:M.GridView.design({childViews:"button icon",layout:{cssClass:"digiButton marginTop20",columns:{0:"button",1:"icon"}},button:M.ButtonView.design({value:M.I18N.l("BautagebuchBautageberichtAbschliessen"),cssClass:"digiButton",anchorLocation:M.RIGHT,events:{tap:{action:function(){DigiWebApp.BautagebuchZusammenfassungController.finish(DigiWebApp.NavigationController.backToBautagebuchBautageberichteListePageTransition);
DigiWebApp.BautagebuchZusammenfassungController.load(DigiWebApp.BautagebuchZusammenfassungController.item);DigiWebApp.NavigationController.toBautagebuchZusammenfassungPageTransition()}}}}),icon:M.ImageView.design({value:"theme/images/icon_bookTime.png"})}),transferGrid:M.GridView.design({childViews:"button icon",layout:{cssClass:"digiButton marginTop20",columns:{0:"button",1:"icon"}},button:M.ButtonView.design({value:M.I18N.l("BautagebuchUebertragen"),cssClass:"digiButton",anchorLocation:M.RIGHT,
events:{tap:{action:function(){var a=DigiWebApp.BautagebuchZusammenfassungController,b=NO;if(a.lastTimestampDatatransfer!==null)if(D8.now().getTimestamp()-a.lastTimestampDatatransfer>parseInt(DigiWebApp.SettingsController.getSetting("datatransfer_min_delay")))b=YES;if(b===YES||a.lastTimestampDatatransfer===null){a.set("lastTimestampDatatransfer",D8.now().getTimestamp());DigiWebApp.BautagebuchDatenuebertragungController.senden(DigiWebApp.BautagebuchZusammenfassungController.item,function(){DigiWebApp.BautagebuchZusammenfassungController.set("item",
null);DigiWebApp.NavigationController.backToBautagebuchBautageberichteListePageTransition()},function(c,d){console.error(c,d);DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("BautagebuchUebertragungsfehler"),message:M.I18N.l("BautagebuchUebertragungsfehlerMsg")})})}}}}}),icon:M.ImageView.design({value:"theme/images/icon_bookTime.png"})})})});
DigiWebApp.EditPicturePage=M.PageView.design({childViews:"header content",cssClass:"editPicturePage",events:{pagebeforeshow:{target:DigiWebApp.EditPicturePageController,action:"init"}},savePicture:function(){var a="";if(M.ViewManager.getView("editPicturePage","remarkInput").value!==null&&typeof M.ViewManager.getView("editPicturePage","remarkInput").value!=="undefined")a=M.ViewManager.getView("editPicturePage","remarkInput").value;if(a.length>255){DigiWebApp.ApplicationController.DigiLoaderView.hide();
DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("remarkTooLong"),message:M.I18N.l("remarkTooLongMessage")})}else if(DigiWebApp.ApplicationController.sonderzeichenCheck(a)){DigiWebApp.ApplicationController.DigiLoaderView.hide();DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("specialCharProblem"),message:M.I18N.l("specialCharProblemMsg")})}else DigiWebApp.EditPicturePageController.savePicture()},header:M.ToolbarView.design({childViews:"backButton title deleteButton",
cssClass:"header",isFixed:YES,backButton:M.ButtonView.design({value:M.I18N.l("back"),icon:"arrow-l",anchorLocation:M.LEFT,events:{tap:{target:DigiWebApp.NavigationController,action:function(){try{DigiWebApp.ApplicationController.vibrate()}catch(a){}this.backToMediaListPageTransition()}}}}),deleteButton:M.ButtonView.design({value:M.I18N.l("deleteLabel"),icon:"delete",anchorLocation:M.RIGHT,events:{tap:{action:function(){try{DigiWebApp.ApplicationController.vibrate()}catch(a){}DigiWebApp.ApplicationController.DigiLoaderView.show(M.I18N.l("deleteMediaFile"));
DigiWebApp.EditPicturePageController.myMediaFile.deleteFile(DigiWebApp.EditPicturePageController.deleteMediaFileFromLocalStorage,function(){DigiWebApp.EditPicturePageController.deleteMediaFileFromLocalStorage()})}}}}),title:M.LabelView.design({value:M.I18N.l("editPicture"),anchorLocation:M.CENTER}),anchorLocation:M.TOP}),content:M.ScrollView.design({childViews:"image spacer order position activity remarkInput savePictureGrid",image:M.ImageView.design({value:"",cssClass:"photo"}),spacer:M.LabelView.design({value:" "}),
order:M.SelectionListView.design({selectionMode:M.SINGLE_SELECTION_DIALOG,initialText:M.I18N.l("noData"),label:M.I18N.l("order"),applyTheme:NO,contentBinding:{target:DigiWebApp.EditPicturePageController,property:"orders"},events:{change:{target:DigiWebApp.EditPicturePageController,action:function(){this.setPositions()}}}}),position:M.SelectionListView.design({selectionMode:M.SINGLE_SELECTION_DIALOG,label:M.I18N.l("position"),initialText:M.I18N.l("noData"),applyTheme:NO,contentBinding:{target:DigiWebApp.EditPicturePageController,
property:"positions"},events:{change:{target:DigiWebApp.EditPicturePageController,action:function(){this.setActivities(YES)}}}}),activity:M.SelectionListView.design({selectionMode:M.SINGLE_SELECTION_DIALOG,label:M.I18N.l("activity"),initialText:M.I18N.l("noData"),applyTheme:NO,contentBinding:{target:DigiWebApp.EditPicturePageController,property:"activities"},events:{change:{target:DigiWebApp.EditPicturePageController,action:function(){}}}}),remarkInput:M.TextFieldView.design({label:M.I18N.l("remark"),
cssClass:"remarkInput",hasMultipleLines:YES,numberOfChars:255}),savePictureGrid:M.GridView.design({childViews:"button icon",layout:{cssClass:"marginTop40 digiButton",columns:{0:"button",1:"icon"}},button:M.ButtonView.design({value:M.I18N.l("assume"),cssClass:"digiButton",anchorLocation:M.RIGHT,events:{tap:{action:function(){try{DigiWebApp.ApplicationController.vibrate()}catch(a){}DigiWebApp.ApplicationController.DigiLoaderView.show(M.I18N.l("saveMediaFile"));DigiWebApp.EditPicturePage.savePicture()}}}}),
icon:M.ImageView.design({value:"theme/images/icon_bookTime.png"})})})});function parseBool(a){if(a==="YES")return YES;else if(a===YES)return YES;else if(a==="true")return YES;else if(a===true)return YES;else if(a==="NO")return NO;else if(a===NO)return NO;else if(a==="false")return NO;else if(a===false)return NO}if(window.console){if(window.console.logLevel)window.console.logLevel=3}else window.console={log:function(){}};var newAppVersionAvailable=NO;M.Application.useTransitions=NO;
var DigiWebApp=DigiWebApp||{app:null};
function writeToLog(a,b,c){var d;d=typeof b!=="function"?function(){}:b;var f;f=typeof c!=="function"?function(){}:c;b=new Date;var e="";e=typeof a==="string"?a:JSON.stringify(a);e=new String("\n----------------------------------------------------------\n"+b.getFullYear()+"-"+("0"+(b.getMonth()+1)).slice(-2)+"-"+("0"+b.getDate()).slice(-2)+" "+("0"+b.getHours()).slice(-2)+":"+("0"+b.getMinutes()).slice(-2)+":"+("0"+b.getSeconds()).slice(-2)+"."+("0"+b.getMilliseconds()).slice(-2)+" "+e+"\n");var g=
b.getFullYear()+"-"+("0"+(b.getMonth()+1)).slice(-2)+"-"+("0"+b.getDate()).slice(-2)+"_DIGI-WebApp.log.txt";if(typeof window.requestFileSystem==="undefined"){d("");return true}try{console.log(e.toString());var h=DigiWebApp.ApplicationController.CONSTApplicationQuota;typeof navigator.webkitPersistentStorage!=="undefined"?navigator.webkitPersistentStorage.requestQuota(h,function(j){window.requestFileSystem(PERSISTENT,j,function(l){l.root.getDirectory("DIGIWebAppLogs",{create:true,exclusive:false},function(m){m.getFile(g,
{create:true,exclusive:false},function(n){n.createWriter(function(o){o.onerror=function(q){f(q)};o.onwriteend=function(q){d(q)};var p=new Blob([e],{type:"text/plain"});o.seek(o.length);o.write(p)},f)},f)},f)},f)},function(j){console.error("Error while requesting Quota",j);DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("error"),message:M.I18N.l("errorWhileRequestingQuota")+": "+err})}):window.requestFileSystem(LocalFileSystem.PERSISTENT,0,function(j){j.root.getDirectory("DIGIWebAppLogs",
{create:true,exclusive:false},function(l){l.getFile(g,{create:true,exclusive:false},function(m){m.createWriter(function(n){n.onerror=function(o){f(o)};n.onwriteend=function(o){d(o)};n.seek(n.length);n.write(e.toString())},f)},f)},f)},f)}catch(i){f(i)}}function trackError(a){try{writeToLog(typeof a==="string"?"Exception "+a:"Exception "+a.name+": "+a.message+"\nStack: "+a.stack);console.log(a);typeof a.stack!=="undefined"&&console.log(a.stack)}catch(b){}return true}
window.onerror=function(a,b,c){writeToLog("window.onerror: "+a+"\nURL: "+b+"\nLine Number: "+c);return true};var jQueryBind=jQuery.fn.bind;jQuery.fn.bind=function(a,b,c){c=c;b=b;if(!c&&b&&typeof b=="function"){c=b;b=null}if(c){var d=c;c=function(){try{d.apply(this,arguments)}catch(f){trackError(f)}}}return jQueryBind.call(this,a,b,c)};
(function(a){a.fn.classes=function(b){var c=[];a.each(this,function(f,e){var g=e.className.split(/\s+/),h;for(h in g){var i=g[h];-1===c.indexOf(i)&&c.push(i)}});if("function"===typeof b)for(var d in c)b(c[d]);return c}})(jQuery);
if(typeof localStorage!=="undefined"){var reloadAppOneMoreTime=localStorage.getItem("reloadAppOneMoreTime");if(reloadAppOneMoreTime!==null){localStorage.removeItem("reloadAppOneMoreTime");window.applicationCache&&window.applicationCache.status==window.applicationCache.UPDATEREADY&&window.applicationCache.swapCache();if(typeof navigator.app!=="undefined")typeof location.origin!=="undefined"?navigator.app.loadUrl(location.origin+location.pathname):navigator.app.loadUrl(location.protocol+"//"+location.pathname);
else window.location.reload()}}
$(window).bind("load",function(){window.applicationCache&&$(window.applicationCache).bind("updateready",function(){if(window.applicationCache.status==window.applicationCache.UPDATEREADY){console.log("Browser downloaded a new app cache");window.newAppVersionAvailable=YES;if(confirm(M.I18N.l("applicationUpdateAvailableMsg")))try{window.applicationCache.swapCache();typeof localStorage!=="undefined"&&localStorage.setItem("reloadAppOneMoreTime","true");if(typeof navigator.app!=="undefined")typeof location.origin!==
"undefined"?navigator.app.loadUrl(location.origin+location.pathname):navigator.app.loadUrl(location.protocol+"//"+location.pathname);else window.location.reload()}catch(a){console.log(a)}else{DigiWebApp.NavigationController.toSplashViewPageTransition();DigiWebApp.NavigationController.toDashboardPage()}}})});
function searchForFeature(a){for(var b=0;b<localStorage.length;b++){var c=localStorage.key(b);if(RegExp("^"+M.LOCAL_STORAGE_PREFIX+M.Application.name+M.LOCAL_STORAGE_SUFFIX+"Features_").exec(c)){c=JSON.parse(localStorage.getItem(c));if(a.toString()===c.id.toString())return c.isAvailable.toString()==="true"}}return false}
if(localStorage){var language=null;language=localStorage.getItem(M.LOCAL_STORAGE_PREFIX+M.Application.name+M.LOCAL_STORAGE_SUFFIX+"lang");language===null&&localStorage.setItem(M.LOCAL_STORAGE_PREFIX+M.Application.name+M.LOCAL_STORAGE_SUFFIX+"lang","de_de")}
var DigiWebAppBlackBerryDesign={entryPage:"splashView",splashView:DigiWebApp.SplashViewPage},DigiWebAppOrdinaryDesign={entryPage:"splashView",splashView:DigiWebApp.SplashViewPage,dashboard:DigiWebApp.DashboardPage,bookingPage:DigiWebApp.BookingPage,settingsPage:DigiWebApp.SettingsPage,settingsPasswordPage:DigiWebApp.SettingsPasswordPage,timeDataPage:DigiWebApp.TimeDataPage,employeePage:DigiWebApp.EmployeePage,infoPage:DigiWebApp.InfoPage};
if(searchForFeature(400)){DigiWebAppOrdinaryDesign.mediaListPage=DigiWebApp.MediaListPage;DigiWebAppOrdinaryDesign.cameraPage=DigiWebApp.CameraPage;DigiWebAppOrdinaryDesign.editPicturePage=DigiWebApp.EditPicturePage;DigiWebAppOrdinaryDesign.fileChooserPage=DigiWebApp.FileChooserPage}searchForFeature(402);if(searchForFeature(403)&&!searchForFeature(409)){DigiWebAppOrdinaryDesign.editTimeDataPage=DigiWebApp.EditTimeDataPage;DigiWebAppOrdinaryDesign.remarkPage=DigiWebApp.RemarkPage}
if(searchForFeature(404))DigiWebAppOrdinaryDesign.buttonsDashboard=DigiWebApp.ButtonDashboardPage;if(searchForFeature(405)&&!searchForFeature(409))DigiWebAppOrdinaryDesign.editTimeDataPage=DigiWebApp.EditTimeDataPage;if(searchForFeature(406)&&!searchForFeature(409))DigiWebAppOrdinaryDesign.orderInfoPage=DigiWebApp.OrderInfoPage;
if(searchForFeature(408)){DigiWebAppOrdinaryDesign.anwesenheitslistePage=DigiWebApp.AnwesenheitslistePage;DigiWebAppOrdinaryDesign.zeitbuchungenPage=DigiWebApp.ZeitbuchungenPage;DigiWebAppOrdinaryDesign.zeitbuchungDetailsPage=DigiWebApp.ZeitbuchungDetailsPage;DigiWebAppOrdinaryDesign.orderDetailsPage=DigiWebApp.OrderDetailsPage}if(searchForFeature(409)){try{delete DigiWebAppOrdinaryDesign.bookingPage}catch(e2$$76){}try{delete DigiWebAppOrdinaryDesign.timeDataPage}catch(e3$$46){}try{delete DigiWebAppOrdinaryDesign.employeePage}catch(e4$$27){}try{delete DigiWebAppOrdinaryDesign.handOrderPage}catch(e5$$12){}}
if(!searchForFeature(410)&&!searchForFeature(409))DigiWebAppOrdinaryDesign.handOrderPage=DigiWebApp.HandOrderPage;if(searchForFeature(411)&&!searchForFeature(409))DigiWebAppOrdinaryDesign.timeDataArchivePage=DigiWebApp.TimeDataArchivePage;
if(searchForFeature(412)&&!searchForFeature(409)){DigiWebAppOrdinaryDesign.bautagebuchBautageberichteListePage=DigiWebApp.BautagebuchBautageberichteListePage;DigiWebAppOrdinaryDesign.bautagebuchBautageberichtDetailsPage=DigiWebApp.BautagebuchBautageberichtDetailsPage;DigiWebAppOrdinaryDesign.bautagebuchMaterialienListePage=DigiWebApp.BautagebuchMaterialienListePage;DigiWebAppOrdinaryDesign.bautagebuchMaterialienDetailsPage=DigiWebApp.BautagebuchMaterialienDetailsPage;DigiWebAppOrdinaryDesign.bautagebuchMedienListePage=
DigiWebApp.BautagebuchMedienListePage;DigiWebAppOrdinaryDesign.bautagebuchMedienDetailsPage=DigiWebApp.BautagebuchMedienDetailsPage;DigiWebAppOrdinaryDesign.bautagebuchNotizenListePage=DigiWebApp.BautagebuchNotizenListePage;DigiWebAppOrdinaryDesign.bautagebuchNotizenDetailsPage=DigiWebApp.BautagebuchNotizenDetailsPage;DigiWebAppOrdinaryDesign.bautagebuchZeitenListePage=DigiWebApp.BautagebuchZeitenListePage;DigiWebAppOrdinaryDesign.bautagebuchZeitenDetailsPage=DigiWebApp.BautagebuchZeitenDetailsPage;
DigiWebAppOrdinaryDesign.bautagebuchEinstellungenPage=DigiWebApp.BautagebuchEinstellungenPage;DigiWebAppOrdinaryDesign.bautagebuchWetterPage=DigiWebApp.BautagebuchWetterPage;DigiWebAppOrdinaryDesign.bautagebuchZusammenfassungPage=DigiWebApp.BautagebuchZusammenfassungPage;DigiWebAppOrdinaryDesign.fileChooserPage=DigiWebApp.FileChooserPage}if(searchForFeature(416)&&!searchForFeature(409))DigiWebAppOrdinaryDesign.bookingPageWithIconsScholpp=DigiWebApp.BookingPageWithIconsScholpp;
if(searchForFeature(418))DigiWebAppOrdinaryDesign.spesenPage=DigiWebApp.SpesenPage;if(searchForFeature(422)){DigiWebAppOrdinaryDesign.editTimeDataPage=DigiWebApp.EditTimeDataPage;DigiWebAppOrdinaryDesign.remarkPage=DigiWebApp.RemarkPage}var restartOnBlackBerry=true;
if(navigator.platform==="BlackBerry"&&restartOnBlackBerry)if(navigator.appVersion.indexOf("Version/")!==-1){var bb_version=Number(navigator.appVersion.substr(navigator.appVersion.indexOf("Version/")+8,1));if(bb_version>6)restartOnBlackBerry=false}DigiWebApp.app=navigator.platform==="BlackBerry"&&restartOnBlackBerry?M.Application.design(DigiWebAppBlackBerryDesign):M.Application.design(DigiWebAppOrdinaryDesign);

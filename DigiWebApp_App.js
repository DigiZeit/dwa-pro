DigiWebApp.Activity=M.Model.create({__name__:"Activity",id:M.Model.attr("String",{isRequired:NO}),name:M.Model.attr("String",{isRequired:NO}),istStandardPause:M.Model.attr("Boolean",{isRequired:NO}),istUnterschriftsAbnahme:M.Model.attr("Boolean",{isRequired:NO}),istFahrzeitRelevant:M.Model.attr("Boolean",{isRequired:NO}),positionId:M.Model.attr("String",{isRequired:NO}),getById:function(a){return _.find(DigiWebApp[this.name].find(),function(b){return b.get("id")==a})},getList:function(a){a||(a={});
var b=[],c=null;if(a.parentId)c=_.find(DigiWebApp.Position.find(),function(f){return f.get("id")==a.parentId});var d=null;d=c?c.getTaetigkeiten():_.filter(DigiWebApp.Activity.findSorted(),function(f){return f.get("positionId")==1});var e=NO;_.each(d,function(f){var g={label:f.get("name"),value:f.get("id")};if(a.selectedId&&f.get("id")==a.selectedId||d.length==1)e=g.isSelected=YES;b.push(g)});if(!e&&b.length>0)b.push({label:M.I18N.l("selectSomething"),value:"0",isSelected:YES});else b.length==0&&b.push({label:M.I18N.l("noData"),
value:"0",isSelected:YES});return b},deleteAll:function(){_.each(this.find(),function(a){a.del()});localStorage.removeItem(DigiWebApp.ApplicationController.storagePrefix+"_"+this.name.toLowerCase()+"Keys")},findById:function(a){var b=null;$.each(this.find(),function(c,d){if(parseIntRadixTen(a)===parseIntRadixTen(d.get("id"))){b=d;return false}return true});return b},findSorted:function(){var a=this,b=[];try{b=JSON.parse(localStorage.getItem(DigiWebApp.ApplicationController.storagePrefix+"_"+this.name.toLowerCase()+
"Keys"))}catch(c){trackError(c)}var d=[];b&&_.each(b,function(e){(e=a.find({key:DigiWebApp.ApplicationController.storagePrefix+a.name+"_"+e}))&&d.push(e)});return d},saveSorted:function(){var a=this;if(!a.save())return false;var b=[];try{var c=localStorage.getItem(DigiWebApp.ApplicationController.storagePrefix+"_"+a.name.toLowerCase()+"Keys");if(c!==null)b=JSON.parse(c)}catch(d){trackError(d)}var e=NO;_.each(b,function(f){if(a.m_id===f)e=YES});e===NO&&b.push(a.m_id);localStorage.setItem(DigiWebApp.ApplicationController.storagePrefix+
"_"+a.name.toLowerCase()+"Keys",JSON.stringify(b));return true}},M.DataProviderLocalStorage);
DigiWebApp.Anwesenheitsliste=M.Model.create({__name__:"Anwesenheitsliste",auftragsBezeichnung:M.Model.attr("String",{}),auftragsId:M.Model.attr("String",{}),bis:M.Model.attr("String",{}),datum:M.Model.attr("String",{}),datumLabel:M.Model.attr("String",{}),farbeAmpel:M.Model.attr("String",{}),farbeAnwesenheit:M.Model.attr("String",{}),fehlzeitBezeichnung:M.Model.attr("String",{}),gpsBreite:M.Model.attr("String",{}),gpsBreitePosition:M.Model.attr("String",{}),gpsLaenge:M.Model.attr("String",{}),gpsLaengePosition:M.Model.attr("String",
{}),handauftragsBezeichnung:M.Model.attr("String",{}),handauftragsId:M.Model.attr("String",{}),mitarbeiterId:M.Model.attr("String",{}),name:M.Model.attr("String",{}),nameVorname:M.Model.attr("String",{}),positionsBezeichnung:M.Model.attr("String",{}),positionsId:M.Model.attr("String",{}),taetigkeit:M.Model.attr("String",{}),taetigkeitsId:M.Model.attr("String",{}),taetigkeitsart:M.Model.attr("String",{}),uhrzeit:M.Model.attr("String",{}),vorname:M.Model.attr("String",{})},M.DataConsumer.configure({appendRecords:NO,
responsePath:"anwesenheitsliste",url:function(){var a="http://"+DigiWebApp.RequestController.DatabaseServer+"/WebAppServices/anwesenheitsliste?modus=0&firmenId="+DigiWebApp.SettingsController.getSetting("company")+"&kennwort="+DigiWebApp.SettingsController.getSetting("password")+"&geraeteId="+DigiWebApp.SettingsController.getSetting("workerId")+"&geraeteTyp=2&softwareVersion="+DigiWebApp.RequestController.softwareVersion+"&requestTimestamp="+M.Date.now().date.valueOf();DigiWebApp.ApplicationController.profilingIntervalVar===
null&&console.log("Anwesenheitsliste: using "+a);return a},map:function(a){a={auftragsBezeichnung:a.auftragsBezeichnung,auftragsId:a.auftragsId,bis:a.bis,datum:a.datum,datumLabel:"",farbeAmpel:a.farbeAmpel,farbeAnwesenheit:a.farbeAnwesenheit,fehlzeitBezeichnung:a.fehlzeitBezeichnung,gpsBreite:a.gpsBreite,gpsBreitePosition:a.gpsBreitePosition,gpsLaenge:a.gpsLaenge,gpsLaengePosition:a.gpsLaengePosition,handauftragsBezeichnung:a.handauftragsBezeichnung,handauftragsId:a.handauftragsId,mitarbeiterId:a.mitarbeiterId,
name:a.name,nameVorname:a.nameVorname,positionsBezeichnung:a.positionsBezeichnung,positionsId:a.positionsId,taetigkeit:a.taetigkeit,taetigkeitsId:a.taetigkeitsId,taetigkeitsart:a.taetigkeitsart,uhrzeit:a.uhrzeit,vorname:a.vorname};if(a.datum!=="-")if(a.bis==="-")a.datumLabel=M.I18N.l("bookingSince")+": ";else{a.datumLabel=M.I18N.l("lastWorkday")+": ";a.uhrzeit="-"}else{a.datumLabel=M.I18N.l("noData");a.uhrzeit="-";a.bis="-"}return a}}));
DigiWebApp.BautagebuchBautagesbericht=M.Model.create({__name__:"BautagebuchBautagesbericht",id:M.Model.attr("String",{isRequired:YES}),datum:M.Model.attr("String",{isRequired:YES}),startUhrzeit:M.Model.attr("String",{isRequired:YES}),bautagesberichtId:M.Model.attr("String",{isRequired:NO}),bautagesberichtTyp:M.Model.attr("String",{isRequired:NO}),transferCompleted:M.Model.attr("Boolean",{isRequired:NO}),projektleiterId:M.Model.attr("String",{isRequired:NO}),selektierteMitarbeiter:M.Model.attr("String",
{isRequired:NO}),orderId:M.Model.attr("String",{isRequired:NO}),orderName:M.Model.attr("String",{isRequired:NO}),handOrderId:M.Model.attr("String",{isRequired:NO}),handOrderName:M.Model.attr("String",{isRequired:NO}),positionId:M.Model.attr("String",{isRequired:NO}),positionName:M.Model.attr("String",{isRequired:NO}),temperatur:M.Model.attr("String",{isRequired:NO}),luftfeuchtigkeit:M.Model.attr("String",{isRequired:NO}),bewoelkung:M.Model.attr("String",{isRequired:NO}),niederschlag:M.Model.attr("String",
{isRequired:NO}),wind:M.Model.attr("String",{isRequired:NO}),wechselhaft:M.Model.attr("String",{isRequired:NO}),latitude:M.Model.attr("String",{isRequired:NO}),longitude:M.Model.attr("String",{isRequired:NO}),abgeschlossen:M.Model.attr("String",{isRequired:NO}),unterschrift:M.Model.attr("String",{isRequired:NO}),unterschrift_hoehe:M.Model.attr("String",{isRequired:NO}),unterschrift_breite:M.Model.attr("String",{isRequired:NO}),fileName:M.Model.attr("String",{isRequired:NO}),fileType:M.Model.attr("String",
{isRequired:NO}),hasFileName:function(){return!this.get("fileName")||this.get("fileName")&&this.get("fileName").length===0?NO:YES},saveToFile:function(a,b,c){var d=this,e=new String(a);if(!d.hasFileName()){d.set("fileName",d.__proto__.name+"_Signature_"+D8.now().getTimestamp());d.save()}if(typeof b!=="function"){trackError("saveToFileError: successCallback is not a function");return false}var f;f=!c||typeof c!=="function"?function(){trackError("saveToFileError")}:c;if(typeof window.requestFileSystem===
"undefined"){trackError("saveToFileError: no LocalFileSystem available");b("");return true}try{var g=DigiWebApp.ApplicationController.CONSTApplicationQuota;typeof navigator.webkitPersistentStorage!=="undefined"?navigator.webkitPersistentStorage.requestQuota(g,function(h){window.requestFileSystem(PERSISTENT,h,function(j){j.root.getDirectory("DIGIWebAppData",{create:true,exclusive:false},function(l){l.getFile(d.get("fileName"),{create:true,exclusive:false},function(n){n.createWriter(function(m){m.onerror=
function(p){trackError("writeError");f(p)};m.onwriteend=function(){m.onwriteend=function(p){b(p)};m.truncate(e.length)};var o=new Blob([e],{type:"text/plain"});m.write(o)},f)},f)},f)},f)},function(){trackError("Error while requesting Quota");DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("error"),message:M.I18N.l("errorWhileRequestingQuota")+": "+err})}):window.requestFileSystem(LocalFileSystem.PERSISTENT,0,function(h){h.root.getDirectory("DIGIWebAppData",{create:true,exclusive:false},
function(j){j.getFile(d.get("fileName"),{create:true,exclusive:false},function(l){l.createWriter(function(n){n.onerror=function(m){trackError("writeError");f(m)};n.onwriteend=function(){n.onwriteend=function(m){b(m)};n.truncate(e.length)};n.write(e.toString())},f)},f)},f)},f)}catch(i){f(i)}},readFromFile:function(a,b){var c=this;if(!c.hasFileName()){trackError("readFromFileError: no fileName given");return false}if(typeof a!=="function"){trackError("readFromFileError: successCallback is not a function");
return false}var d;d=!b||typeof b!=="function"?function(){trackError("readFromFileError")}:b;if(typeof window.requestFileSystem==="undefined"){trackError("readFromFileError: no LocalFileSystem available");a("");return true}try{var e=DigiWebApp.ApplicationController.CONSTApplicationQuota;typeof navigator.webkitPersistentStorage!=="undefined"?navigator.webkitPersistentStorage.requestQuota(e,function(g){window.requestFileSystem(PERSISTENT,g,function(i){i.root.getDirectory("DIGIWebAppData",{create:true,
exclusive:false},function(h){h.getFile(c.get("fileName"),null,function(j){j.file(function(l){var n=new FileReader;n.onloadend=function(){a(this.result)};n.readAsText(l)},d)},d)},d)},d)},function(){trackError("Error while requesting Quota");DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("error"),message:M.I18N.l("errorWhileRequestingQuota")+": "+err})}):window.requestFileSystem(LocalFileSystem.PERSISTENT,0,function(g){g.root.getDirectory("DIGIWebAppData",{create:true,exclusive:false},
function(i){i.getFile(c.get("fileName"),null,function(h){h.file(function(j){var l=new FileReader;l.onloadend=function(n){a(n.target.result)};l.readAsText(j)},d)},d)},d)},d)}catch(f){d(f)}},deleteFile:function(a,b){var c=this;if(!c.hasFileName()){trackError("deleteFileError: no fileName given");return false}if(typeof a!=="function"){trackError("deleteFileError: successCallback is not a function");return false}var d;d=!b||typeof b!=="function"?function(){trackError("deleteFileError")}:b;if(typeof window.requestFileSystem===
"undefined"){trackError("deleteFileError: no LocalFileSystem available");a("");return true}try{var e=DigiWebApp.ApplicationController.CONSTApplicationQuota;typeof navigator.webkitPersistentStorage!=="undefined"?navigator.webkitPersistentStorage.requestQuota(e,function(g){window.requestFileSystem(PERSISTENT,g,function(i){i.root.getDirectory("DIGIWebAppData",{create:true,exclusive:false},function(h){h.getFile(c.get("fileName"),null,function(j){j.remove(a,d)},d)},d)},d)},function(){trackError("Error while requesting Quota");
DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("error"),message:M.I18N.l("errorWhileRequestingQuota")+": "+err})}):window.requestFileSystem(LocalFileSystem.PERSISTENT,0,function(g){g.root.getDirectory("DIGIWebAppData",{create:true,exclusive:false},function(i){i.getFile(c.get("fileName"),null,function(h){h.remove(a,d)},d)},d)},d)}catch(f){d(f)}},deleteAll:function(){_.each(this.find(),function(a){a.deleteSorted()})},deleteSorted:function(a){var b=this,c=b.get("id");_.each(DigiWebApp.BautagebuchZeitbuchung.find({query:{identifier:"bautagesberichtId",
operator:"=",value:c}}),function(i){i.deleteSorted()});var d=DigiWebApp.BautagebuchMaterialBuchung.find({query:{identifier:"bautagesberichtId",operator:"=",value:c}});_.each(d,function(i){i.deleteSorted()});d=DigiWebApp.BautagebuchNotiz.find({query:{identifier:"bautagesberichtId",operator:"=",value:c}});_.each(d,function(i){i.deleteSorted()});_.each(DigiWebApp.BautagebuchMediaFile.find({query:{identifier:"bautagesberichtId",operator:"=",value:c}}),function(i){i.deleteSorted()});c=[];var e=[];try{var f=
localStorage.getItem(DigiWebApp.ApplicationController.storagePrefix+"_"+b.name.toLowerCase()+"Keys");if(f!==null)c=JSON.parse(f)}catch(g){trackError(g)}if(c){_.each(c,function(i){i!==b.m_id&&e.push(i)});localStorage.setItem(DigiWebApp.ApplicationController.storagePrefix+"_"+b.name.toLowerCase()+"Keys",JSON.stringify(e))}if(b.hasFileName())b.deleteFile(function(){b.del();typeof a==="function"&&a()},function(){b.del();typeof a==="function"&&a()});else{b.del();typeof a==="function"&&a()}},saveSorted:function(){var a=
this;if(!a.save())return false;var b=[];try{var c=localStorage.getItem(DigiWebApp.ApplicationController.storagePrefix+"_"+a.name.toLowerCase()+"Keys");if(c!==null)b=JSON.parse(c)}catch(d){trackError(d)}var e=NO;_.each(b,function(f){if(a.m_id===f)e=YES});e===NO&&b.push(a.m_id);localStorage.setItem(DigiWebApp.ApplicationController.storagePrefix+"_"+a.name.toLowerCase()+"Keys",JSON.stringify(b));return true},findSorted:function(){var a=this,b=[];try{var c=localStorage.getItem(DigiWebApp.ApplicationController.storagePrefix+
"_"+a.name.toLowerCase()+"Keys");if(c!==null)b=JSON.parse(c)}catch(d){trackError(d)}var e=[];b&&_.each(b,function(f){(f=a.find({key:DigiWebApp.ApplicationController.storagePrefix+a.name+"_"+f}))&&e.push(f)});return e}},M.DataProviderLocalStorage);
DigiWebApp.BautagebuchEinstellungen=M.Model.create({__name__:"BautagebuchEinstellungen",startUhrzeit:M.Model.attr("String",{isRequired:NO}),inStundenBuchen:M.Model.attr("String",{isRequired:NO}),falscheZeitenIgnorieren:M.Model.attr("String",{isRequired:NO}),positionVorselektieren:M.Model.attr("String",{isRequired:NO}),minutenSchritte:M.Model.attr("String",{isRequired:NO}),alleMitarbeiterVorselektiert:M.Model.attr("String",{isRequired:NO}),deleteAll:function(){_.each(this.find(),function(a){a.deleteSorted()})},
deleteSorted:function(){var a=this,b=[],c=[];try{var d=localStorage.getItem(DigiWebApp.ApplicationController.storagePrefix+"_"+a.name.toLowerCase()+"Keys");if(d!==null)b=JSON.parse(d)}catch(e){trackError(e)}if(b){_.each(b,function(f){f!==a.m_id&&c.push(f)});localStorage.setItem(DigiWebApp.ApplicationController.storagePrefix+"_"+a.name.toLowerCase()+"Keys",JSON.stringify(c))}a.del()},saveSorted:function(){var a=this;a.save();var b=[];try{var c=localStorage.getItem(DigiWebApp.ApplicationController.storagePrefix+
"_"+a.name.toLowerCase()+"Keys");if(c!==null)b=JSON.parse(c)}catch(d){trackError(d)}var e=NO;_.each(b,function(f){if(a.m_id===f)e=YES});e===NO&&b.push(a.m_id);localStorage.setItem(DigiWebApp.ApplicationController.storagePrefix+"_"+a.name.toLowerCase()+"Keys",JSON.stringify(b))},findSorted:function(){var a=this,b=[];try{var c=localStorage.getItem(DigiWebApp.ApplicationController.storagePrefix+"_"+a.name.toLowerCase()+"Keys");if(c!==null)b=JSON.parse(c)}catch(d){trackError(d)}var e=[];b&&_.each(b,function(f){(f=
a.find({key:DigiWebApp.ApplicationController.storagePrefix+a.name+"_"+f}))&&e.push(f)});return e}},M.DataProviderLocalStorage);
DigiWebApp.BautagebuchHersteller=M.Model.create({__name__:"BautagebuchHersteller",id:M.Model.attr("String",{isRequired:NO}),bezeichnung:M.Model.attr("String",{isRequired:NO}),getMaterialien:function(){var a=this;return _.filter(DigiWebApp.BautagebuchMaterial.findSorted(),function(b){return _.find([JSON.parse(b.get("herstellerId"))],function(c){return a.get("id")==c})})},getList:function(a){a||(a={});var b=[];a=DigiWebApp[this.name].findSorted();var c=NO;_.each(a,function(d){d={label:d.get("bezeichnung"),
value:d.get("id")};b.push(d)});b.push({label:M.I18N.l("alle"),value:"0",isSelected:!c});return b},deleteAll:function(){_.each(this.find(),function(a){a.deleteSorted()})},deleteSorted:function(){var a=this,b=[],c=[];try{var d=localStorage.getItem(DigiWebApp.ApplicationController.storagePrefix+"_"+a.name.toLowerCase()+"Keys");if(d!==null)b=JSON.parse(d)}catch(e){trackError(e)}if(b){_.each(b,function(f){f!==a.m_id&&c.push(f)});localStorage.setItem(DigiWebApp.ApplicationController.storagePrefix+"_"+a.name.toLowerCase()+
"Keys",JSON.stringify(c))}return a.del()},saveSorted:function(){var a=this;if(!a.save())return false;var b=[];try{var c=localStorage.getItem(DigiWebApp.ApplicationController.storagePrefix+"_"+a.name.toLowerCase()+"Keys");if(c!==null)b=JSON.parse(c)}catch(d){trackError(d)}var e=NO;_.each(b,function(f){if(a.m_id===f)e=YES});e===NO&&b.push(a.m_id);localStorage.setItem(DigiWebApp.ApplicationController.storagePrefix+"_"+a.name.toLowerCase()+"Keys",JSON.stringify(b));return true},findSorted:function(){var a=
this,b=[];try{var c=localStorage.getItem(DigiWebApp.ApplicationController.storagePrefix+"_"+a.name.toLowerCase()+"Keys");if(c!==null)b=JSON.parse(c)}catch(d){trackError(d)}var e=[];b&&_.each(b,function(f){(f=a.find({key:DigiWebApp.ApplicationController.storagePrefix+a.name+"_"+f}))&&e.push(f)});return e=_.sortBy(e,function(f){return f.get("bezeichnung")})}},M.DataProviderLocalStorage);
DigiWebApp.BautagebuchLieferant=M.Model.create({__name__:"BautagebuchLieferant",id:M.Model.attr("String",{isRequired:NO}),bezeichnung:M.Model.attr("String",{isRequired:NO}),nummer:M.Model.attr("String",{isRequired:NO}),getMaterialien:function(){var a=this;return _.filter(DigiWebApp.BautagebuchMaterial.findSorted(),function(b){return _.find(JSON.parse(b.get("lieferantenIds")),function(c){return a.get("id")==c})})},getList:function(a){a||(a={});var b=[];a=DigiWebApp[this.name].findSorted();var c=NO;
_.each(a,function(d){d={label:d.get("bezeichnung"),value:d.get("id")};b.push(d)});b.push({label:M.I18N.l("alle"),value:"0",isSelected:!c});return b},deleteAll:function(){_.each(this.find(),function(a){a.deleteSorted()})},deleteSorted:function(){var a=this,b=[],c=[];try{var d=localStorage.getItem(DigiWebApp.ApplicationController.storagePrefix+"_"+a.name.toLowerCase()+"Keys");if(d!==null)b=JSON.parse(d)}catch(e){trackError(e)}if(b){_.each(b,function(f){f!==a.m_id&&c.push(f)});localStorage.setItem(DigiWebApp.ApplicationController.storagePrefix+
"_"+a.name.toLowerCase()+"Keys",JSON.stringify(c))}return a.del()},saveSorted:function(){var a=this;if(!a.save())return false;var b=[];try{var c=localStorage.getItem(DigiWebApp.ApplicationController.storagePrefix+"_"+a.name.toLowerCase()+"Keys");if(c!==null)b=JSON.parse(c)}catch(d){trackError(d)}var e=NO;_.each(b,function(f){if(a.m_id===f)e=YES});e===NO&&b.push(a.m_id);localStorage.setItem(DigiWebApp.ApplicationController.storagePrefix+"_"+a.name.toLowerCase()+"Keys",JSON.stringify(b));return true},
findSorted:function(){var a=this,b=[];try{var c=localStorage.getItem(DigiWebApp.ApplicationController.storagePrefix+"_"+a.name.toLowerCase()+"Keys");if(c!==null)b=JSON.parse(c)}catch(d){trackError(d)}var e=[];b&&_.each(b,function(f){(f=a.find({key:DigiWebApp.ApplicationController.storagePrefix+a.name+"_"+f}))&&e.push(f)});return e=_.sortBy(e,function(f){return f.get("bezeichnung")})}},M.DataProviderLocalStorage);
DigiWebApp.BautagebuchMaterial=M.Model.create({__name__:"BautagebuchMaterial",id:M.Model.attr("String",{isRequired:NO}),bezeichnung:M.Model.attr("String",{isRequired:NO}),nummer:M.Model.attr("String",{isRequired:NO}),standardEinheitId:M.Model.attr("String",{isRequired:NO}),einheitenIds:M.Model.attr("String",{isRequired:NO}),lieferantenIds:M.Model.attr("String",{isRequired:NO}),herstellerId:M.Model.attr("String",{isRequired:NO}),materialgruppenIds:M.Model.attr("String",{isRequired:NO}),einzelpreis:M.Model.attr("String",
{isRequired:NO}),materialtypId:M.Model.attr("String",{isRequired:NO}),getHersteller:function(){return DigiWebApp.BautagebuchHersteller.find({query:{identifier:"id",operator:"=",value:""+this.get("herstellerId")}})[0]},getMaterialtyp:function(){return DigiWebApp.BautagebuchMaterialtyp.find({query:{identifier:"id",operator:"=",value:""+this.get("materialtypId")}})[0]},getLieferanten:function(){var a=[];_.each(JSON.parse(this.get("lieferantenIds")),function(b){(b=DigiWebApp.BautagebuchLieferant.find({query:{identifier:"id",
operator:"=",value:""+b}})[0])&&a.push(b)});return a},getMaterialgruppen:function(){var a=[];_.each(JSON.parse(this.get("materialgruppenIds")),function(b){(b=DigiWebApp.BautagebuchMaterialgruppe.find({query:{identifier:"id",operator:"=",value:""+b}})[0])&&a.push(b)});return a},getMaterialbuchungen:function(){return DigiWebApp.BautagebuchMaterialbuchung.find({query:{identifier:"materialId",operator:"=",value:""+this.get("id")}})},getStandardEinheit:function(){return DigiWebApp.BautagebuchMengeneinheit.find({query:{identifier:"standardEinheitId",
operator:"=",value:""+this.get("id")}})},getMengeneinheiten:function(){var a=[];_.each(JSON.parse(this.get("einheitenIds")),function(b){(b=DigiWebApp.BautagebuchMengeneinheit.find({query:{identifier:"id",operator:"=",value:""+b}})[0])&&a.push(b)});return a},getList:function(a){a||(a={});var b=[],c=DigiWebApp[this.name].findSorted(),d=NO;if(a.lieferantId&&parseIntRadixTen(a.lieferantId)!=0)c=_.filter(c,function(e){return _.contains(JSON.parse(e.get("lieferantenIds")),""+a.lieferantId)});if(a.herstellerId&&
parseIntRadixTen(a.herstellerId)!=0)c=_.filter(c,function(e){return _.contains([e.get("herstellerId")],""+a.herstellerId)});if(a.materialgruppeId&&parseIntRadixTen(a.materialgruppeId)!=0)c=_.filter(c,function(e){return _.contains(JSON.parse(e.get("materialgruppenIds")),""+a.materialgruppeId)});if(a.materialtypId&&parseIntRadixTen(a.materialtypId)!=0)c=_.filter(c,function(e){return _.contains([e.get("materialtypId")],""+a.materialtypId)});_.each(c,function(e){var f={label:e.get("bezeichnung"),value:e.get("id")};
if(a.selectedId&&e.get("id")==a.selectedId||c.length==1)d=f.isSelected=YES;b.push(f)});d?b.push({label:M.I18N.l("BautagebuchManuelleEingabe"),value:"0"}):b.push({label:M.I18N.l("BautagebuchManuelleEingabe"),value:"0",isSelected:YES});return b},getById:function(a){return _.find(DigiWebApp[this.name].find(),function(b){return b.get("id")==a})},deleteAll:function(){_.each(this.find(),function(a){a.deleteSorted()})},deleteSorted:function(){var a=this,b=[],c=[];try{var d=localStorage.getItem(DigiWebApp.ApplicationController.storagePrefix+
"_"+a.name.toLowerCase()+"Keys");if(d!==null)b=JSON.parse(d)}catch(e){trackError(e)}if(b){_.each(b,function(f){f!==a.m_id&&c.push(f)});localStorage.setItem(DigiWebApp.ApplicationController.storagePrefix+"_"+a.name.toLowerCase()+"Keys",JSON.stringify(c))}return a.del()},saveSorted:function(){var a=this;if(!a.save())return false;var b=[];try{var c=localStorage.getItem(DigiWebApp.ApplicationController.storagePrefix+"_"+a.name.toLowerCase()+"Keys");if(c!==null)b=JSON.parse(c)}catch(d){trackError(d)}var e=
NO;_.each(b,function(f){if(a.m_id===f)e=YES});e===NO&&b.push(a.m_id);localStorage.setItem(DigiWebApp.ApplicationController.storagePrefix+"_"+a.name.toLowerCase()+"Keys",JSON.stringify(b));return true},findSorted:function(){var a=this,b=[];try{var c=localStorage.getItem(DigiWebApp.ApplicationController.storagePrefix+"_"+a.name.toLowerCase()+"Keys");if(c!==null)b=JSON.parse(c)}catch(d){trackError(d)}var e=[];b&&_.each(b,function(f){(f=a.find({key:DigiWebApp.ApplicationController.storagePrefix+a.name+
"_"+f}))&&e.push(f)});return e}},M.DataProviderLocalStorage);
DigiWebApp.BautagebuchMaterialBuchung=M.Model.create({__name__:"BautagebuchMaterialBuchung",id:M.Model.attr("Number",{isRequired:NO}),bautagesberichtId:M.Model.attr("String",{isRequired:YES}),artikel:M.Model.attr("String",{isRequired:NO}),menge:M.Model.attr("String",{isRequired:NO}),einheit:M.Model.attr("String",{isRequired:NO}),materialId:M.Model.attr("String",{isRequired:NO}),mengeneinheitId:M.Model.attr("String",{isRequired:NO}),orderId:M.Model.attr("String",{isRequired:NO}),orderName:M.Model.attr("String",
{isRequired:NO}),positionId:M.Model.attr("String",{isRequired:NO}),positionName:M.Model.attr("String",{isRequired:NO}),handOrderId:M.Model.attr("String",{isRequired:NO}),handOrderName:M.Model.attr("String",{isRequired:NO}),activityId:M.Model.attr("String",{isRequired:NO}),activityName:M.Model.attr("String",{isRequired:NO}),materialgruppeId:M.Model.attr("String",{isRequired:NO}),materialtypId:M.Model.attr("String",{isRequired:NO}),lieferantId:M.Model.attr("String",{isRequired:NO}),herstellerId:M.Model.attr("String",
{isRequired:NO}),deleteAll:function(){_.each(this.find(),function(a){a.deleteSorted()})},deleteSorted:function(){var a=this,b=[],c=[];try{var d=localStorage.getItem(DigiWebApp.ApplicationController.storagePrefix+"_"+a.name.toLowerCase()+"Keys");if(d!==null)b=JSON.parse(d)}catch(e){trackError(e)}if(b){_.each(b,function(f){f!==a.m_id&&c.push(f)});localStorage.setItem(DigiWebApp.ApplicationController.storagePrefix+"_"+a.name.toLowerCase()+"Keys",JSON.stringify(c))}return a.del()},saveSorted:function(){var a=
this;if(!a.save())return false;var b=[];try{var c=localStorage.getItem(DigiWebApp.ApplicationController.storagePrefix+"_"+a.name.toLowerCase()+"Keys");if(c!==null)b=JSON.parse(c)}catch(d){trackError(d)}var e=NO;_.each(b,function(f){if(a.m_id===f)e=YES});e===NO&&b.push(a.m_id);localStorage.setItem(DigiWebApp.ApplicationController.storagePrefix+"_"+a.name.toLowerCase()+"Keys",JSON.stringify(b));return true},findSorted:function(a){var b=this,c=[];try{var d=localStorage.getItem(DigiWebApp.ApplicationController.storagePrefix+
"_"+b.name.toLowerCase()+"Keys");if(d!==null)c=JSON.parse(d)}catch(e){trackError(e)}var f=[];c&&_.each(c,function(g){if((g=b.find({key:DigiWebApp.ApplicationController.storagePrefix+b.name+"_"+g}))&&(a&&g.get("bautagesberichtId")===a||typeof a==="undefined"))f.push(g)});return f}},M.DataProviderLocalStorage);
DigiWebApp.BautagebuchMaterialgruppe=M.Model.create({__name__:"BautagebuchMaterialgruppe",id:M.Model.attr("String",{isRequired:NO}),vaterId:M.Model.attr("String",{isRequired:NO}),bezeichnung:M.Model.attr("String",{isRequired:NO}),getMaterialien:function(){var a=this;return _.filter(DigiWebApp.BautagebuchMaterial.findSorted(),function(b){return _.find(JSON.parse(b.get("materialgruppenIds")),function(c){return a.get("id")==c})})},getList:function(a){a||(a={});var b=[];a=DigiWebApp[this.name].findSorted();
var c=NO;_.each(a,function(d){d={label:d.get("bezeichnung"),value:d.get("id")};b.push(d)});b.push({label:M.I18N.l("alle"),value:"0",isSelected:!c});return b},deleteAll:function(){_.each(this.find(),function(a){a.deleteSorted()})},deleteSorted:function(){var a=this,b=[],c=[];try{var d=localStorage.getItem(DigiWebApp.ApplicationController.storagePrefix+"_"+a.name.toLowerCase()+"Keys");if(d!==null)b=JSON.parse(d)}catch(e){trackError(e)}if(b){_.each(b,function(f){f!==a.m_id&&c.push(f)});localStorage.setItem(DigiWebApp.ApplicationController.storagePrefix+
"_"+a.name.toLowerCase()+"Keys",JSON.stringify(c))}return a.del()},saveSorted:function(){var a=this;if(!a.save())return false;var b=[];try{var c=localStorage.getItem(DigiWebApp.ApplicationController.storagePrefix+"_"+a.name.toLowerCase()+"Keys");if(c!==null)b=JSON.parse(c)}catch(d){trackError(d)}var e=NO;_.each(b,function(f){if(a.m_id===f)e=YES});e===NO&&b.push(a.m_id);localStorage.setItem(DigiWebApp.ApplicationController.storagePrefix+"_"+a.name.toLowerCase()+"Keys",JSON.stringify(b));return true},
findSorted:function(){var a=this,b=[];try{var c=localStorage.getItem(DigiWebApp.ApplicationController.storagePrefix+"_"+a.name.toLowerCase()+"Keys");if(c!==null)b=JSON.parse(c)}catch(d){trackError(d)}var e=[];b&&_.each(b,function(f){(f=a.find({key:DigiWebApp.ApplicationController.storagePrefix+a.name+"_"+f}))&&e.push(f)});return e=_.sortBy(e,function(f){return f.get("bezeichnung")})}},M.DataProviderLocalStorage);
DigiWebApp.BautagebuchMaterialtyp=M.Model.create({__name__:"BautagebuchMaterialtyp",id:M.Model.attr("String",{isRequired:NO}),bezeichnung:M.Model.attr("String",{isRequired:NO}),getMaterialien:function(){var a=this;return _.filter(DigiWebApp.BautagebuchMaterial.findSorted(),function(b){return _.find([JSON.parse(b.get("materialtypId"))],function(c){return a.get("id")==c})})},getList:function(a){a||(a={});var b=[];a=DigiWebApp[this.name].findSorted();var c=NO;_.each(a,function(d){d={label:d.get("bezeichnung"),
value:d.get("id")};b.push(d)});b.push({label:M.I18N.l("alle"),value:"0",isSelected:!c});return b},deleteAll:function(){_.each(this.find(),function(a){a.deleteSorted()})},deleteSorted:function(){var a=this,b=[],c=[];try{var d=localStorage.getItem(DigiWebApp.ApplicationController.storagePrefix+"_"+a.name.toLowerCase()+"Keys");if(d!==null)b=JSON.parse(d)}catch(e){trackError(e)}if(b){_.each(b,function(f){f!==a.m_id&&c.push(f)});localStorage.setItem(DigiWebApp.ApplicationController.storagePrefix+"_"+a.name.toLowerCase()+
"Keys",JSON.stringify(c))}return a.del()},saveSorted:function(){var a=this;if(!a.save())return false;var b=[];try{var c=localStorage.getItem(DigiWebApp.ApplicationController.storagePrefix+"_"+a.name.toLowerCase()+"Keys");if(c!==null)b=JSON.parse(c)}catch(d){trackError(d)}var e=NO;_.each(b,function(f){if(a.m_id===f)e=YES});e===NO&&b.push(a.m_id);localStorage.setItem(DigiWebApp.ApplicationController.storagePrefix+"_"+a.name.toLowerCase()+"Keys",JSON.stringify(b));return true},findSorted:function(){var a=
this,b=[];try{var c=localStorage.getItem(DigiWebApp.ApplicationController.storagePrefix+"_"+a.name.toLowerCase()+"Keys");if(c!==null)b=JSON.parse(c)}catch(d){trackError(d)}var e=[];b&&_.each(b,function(f){(f=a.find({key:DigiWebApp.ApplicationController.storagePrefix+a.name+"_"+f}))&&e.push(f)});return e}},M.DataProviderLocalStorage);
DigiWebApp.BautagebuchMediaFile=M.Model.create({__name__:"BautagebuchMediaFile",name:M.Model.attr("String",{isRequired:NO}),bautagesberichtId:M.Model.attr("String",{isRequired:NO}),positionId:M.Model.attr("String",{isRequired:NO}),positionName:M.Model.attr("String",{isRequired:NO}),handOrderId:M.Model.attr("String",{isRequired:NO}),handOrderName:M.Model.attr("String",{isRequired:NO}),activityId:M.Model.attr("String",{isRequired:NO}),activityName:M.Model.attr("String",{isRequired:NO}),fileName:M.Model.attr("String",
{isRequired:NO}),fileType:M.Model.attr("String",{isRequired:YES}),timeStamp:M.Model.attr("String",{isRequired:NO}),date:M.Model.attr("String",{}),icon:M.Model.attr("String",{isRequired:NO}),latitude:M.Model.attr("String",{isRequired:NO}),longitude:M.Model.attr("String",{isRequired:NO}),mitarbeiterId:M.Model.attr("String",{isRequired:NO}),remark:M.Model.attr("String",{isRequired:NO}),data:M.Model.attr("String",{isRequired:NO}),setRemark:function(a){this.set("remark",a)},writeError:M.Model.attr("Boolean",
{isRequired:NO}),deleteAll:function(){_.each(this.find(),function(a){a.deleteSorted()})},hasFileName:function(){return!this.get("fileName")||this.get("fileName")&&this.get("fileName").length===0?NO:YES},saveToFile:function(a,b,c){var d=this,e=new String(a);if(!d.hasFileName()){d.set("fileName",d.__proto__.name+"_"+D8.now().getTimestamp());d.save()}if(typeof b!=="function"){trackError("saveToFileError: successCallback is not a function");return false}var f;f=!c||typeof c!=="function"?function(){trackError("saveToFileError")}:
c;if(typeof window.requestFileSystem==="undefined"){trackError("saveToFileError: no LocalFileSystem available");b("");return true}try{var g=DigiWebApp.ApplicationController.CONSTApplicationQuota;typeof navigator.webkitPersistentStorage!=="undefined"?navigator.webkitPersistentStorage.requestQuota(g,function(h){window.requestFileSystem(PERSISTENT,h,function(j){j.root.getDirectory("DIGIWebAppData",{create:true,exclusive:false},function(l){l.getFile(d.get("fileName"),{create:true,exclusive:false},function(n){n.createWriter(function(m){m.onerror=
function(p){trackError("writeError");f(p)};m.onwriteend=function(){m.onwriteend=function(p){b(p)};m.truncate(e.length)};var o=new Blob([e],{type:"text/plain"});m.write(o)},f)},f)},f)},f)},function(){trackError("Error while requesting Quota");DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("error"),message:M.I18N.l("errorWhileRequestingQuota")+": "+err})}):window.requestFileSystem(LocalFileSystem.PERSISTENT,0,function(h){h.root.getDirectory("DIGIWebAppData",{create:true,exclusive:false},
function(j){j.getFile(d.get("fileName"),{create:true,exclusive:false},function(l){l.createWriter(function(n){n.onerror=function(m){trackError("writeError");f(m)};n.onwriteend=function(){n.onwriteend=function(m){b(m)};n.truncate(e.length)};n.write(e.toString())},f)},f)},f)},f)}catch(i){f(i)}},readFromFile:function(a,b){var c=this,d;d=!b||typeof b!=="function"?function(){trackError("readFromFileError")}:b;if(typeof a!=="function"){trackError("readFromFileError: successCallback is not a function");return false}if(!c.hasFileName()){trackError("readFromFileError: no fileName given");
d();return false}if(typeof window.requestFileSystem==="undefined"){trackError("readFromFileError: no LocalFileSystem available");a("");return true}try{var e=DigiWebApp.ApplicationController.CONSTApplicationQuota;typeof navigator.webkitPersistentStorage!=="undefined"?navigator.webkitPersistentStorage.requestQuota(e,function(g){window.requestFileSystem(PERSISTENT,g,function(i){i.root.getDirectory("DIGIWebAppData",{create:true,exclusive:false},function(h){h.getFile(c.get("fileName"),null,function(j){j.file(function(l){var n=
new FileReader;n.onloadend=function(){a(this.result)};n.readAsText(l)},d)},d)},d)},d)},function(){trackError("Error while requesting Quota");DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("error"),message:M.I18N.l("errorWhileRequestingQuota")+": "+err})}):window.requestFileSystem(LocalFileSystem.PERSISTENT,0,function(g){g.root.getDirectory("DIGIWebAppData",{create:true,exclusive:false},function(i){i.getFile(c.get("fileName"),null,function(h){h.file(function(j){var l=new FileReader;
l.onloadend=function(n){a(n.target.result)};l.readAsText(j)},d)},d)},d)},d)}catch(f){d(f)}},deleteFile:function(a,b){var c=this;if(!c.hasFileName()){trackError("deleteFileError: no fileName given");return false}if(typeof a!=="function"){trackError("deleteFileError: successCallback is not a function");return false}var d;d=!b||typeof b!=="function"?function(){trackError("deleteFileError")}:b;if(typeof window.requestFileSystem==="undefined"){trackError("deleteFileError: no LocalFileSystem available");
a("");return true}try{var e=DigiWebApp.ApplicationController.CONSTApplicationQuota;typeof navigator.webkitPersistentStorage!=="undefined"?navigator.webkitPersistentStorage.requestQuota(e,function(g){window.requestFileSystem(PERSISTENT,g,function(i){i.root.getDirectory("DIGIWebAppData",{create:true,exclusive:false},function(h){h.getFile(c.get("fileName"),null,function(j){j.remove(a,d)},d)},d)},d)},function(){trackError("Error while requesting Quota");DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("error"),
message:M.I18N.l("errorWhileRequestingQuota")+": "+err})}):window.requestFileSystem(LocalFileSystem.PERSISTENT,0,function(g){g.root.getDirectory("DIGIWebAppData",{create:true,exclusive:false},function(i){i.getFile(c.get("fileName"),null,function(h){h.remove(a,d)},d)},d)},d)}catch(f){d(f)}},deleteSorted:function(){var a=this,b=[],c=[];try{var d=localStorage.getItem(DigiWebApp.ApplicationController.storagePrefix+"_"+a.name.toLowerCase()+"Keys");if(d!==null)b=JSON.parse(d)}catch(e){trackError(e)}if(b){_.each(b,
function(f){f!==a.m_id&&c.push(f)});localStorage.setItem(DigiWebApp.ApplicationController.storagePrefix+"_"+a.name.toLowerCase()+"Keys",JSON.stringify(c))}if(a.hasFileName())a.deleteFile(function(){return a.del()});else return a.del()},saveSorted:function(){var a=this;if(!a.save())return false;var b=[];try{var c=localStorage.getItem(DigiWebApp.ApplicationController.storagePrefix+"_"+a.name.toLowerCase()+"Keys");if(c!==null)b=JSON.parse(c)}catch(d){trackError(d)}var e=NO;_.each(b,function(f){if(a.m_id===
f)e=YES});e===NO&&b.push(a.m_id);localStorage.setItem(DigiWebApp.ApplicationController.storagePrefix+"_"+a.name.toLowerCase()+"Keys",JSON.stringify(b));return true},findSorted:function(a){var b=this,c=[];try{var d=localStorage.getItem(DigiWebApp.ApplicationController.storagePrefix+"_"+b.name.toLowerCase()+"Keys");if(d!==null)c=JSON.parse(d)}catch(e){trackError(e)}var f=[];c&&_.each(c,function(g){if((g=b.find({key:DigiWebApp.ApplicationController.storagePrefix+b.name+"_"+g}))&&(a&&g.get("bautagesberichtId")===
a||typeof a==="undefined"))f.push(g)});return f}},M.DataProviderLocalStorage);
DigiWebApp.BautagebuchMengeneinheit=M.Model.create({__name__:"BautagebuchMengeneinheit",id:M.Model.attr("String",{isRequired:NO}),kuerzel:M.Model.attr("String",{isRequired:NO}),getMaterialien:function(){var a=this;return _.filter(DigiWebApp.BautagebuchMaterial.findSorted(),function(b){return _.find(JSON.parse(b.get("einheitenIds")),function(c){return a.get("id")==c})})},getList:function(a){a||(a={});var b=[],c=null;c=a.items?a.items:DigiWebApp[this.name].findSorted();var d=NO;_.each(c,function(e){var f=
{label:e.get("kuerzel"),value:e.get("id")};if(a.selectedId&&e.get("id")==a.selectedId||c.length==1)d=f.isSelected=YES;b.push(f)});if(!d&&b.length>0)b.push({label:M.I18N.l("selectSomething"),value:"0",isSelected:YES});else b.length==0&&b.push({label:M.I18N.l("noData"),value:"0",isSelected:YES});return b},getById:function(a){return _.find(DigiWebApp[this.name].find(),function(b){return b.get("id")==a})},deleteAll:function(){_.each(this.find(),function(a){a.deleteSorted()})},deleteSorted:function(){var a=
this,b=[],c=[];try{var d=localStorage.getItem(DigiWebApp.ApplicationController.storagePrefix+"_"+a.name.toLowerCase()+"Keys");if(d!==null)b=JSON.parse(d)}catch(e){trackError(e)}if(b){_.each(b,function(f){f!==a.m_id&&c.push(f)});localStorage.setItem(DigiWebApp.ApplicationController.storagePrefix+"_"+a.name.toLowerCase()+"Keys",JSON.stringify(c))}return a.del()},saveSorted:function(){var a=this;if(!a.save())return false;var b=[];try{var c=localStorage.getItem(DigiWebApp.ApplicationController.storagePrefix+
"_"+a.name.toLowerCase()+"Keys");if(c!==null)b=JSON.parse(c)}catch(d){trackError(d)}var e=NO;_.each(b,function(f){if(a.m_id===f)e=YES});e===NO&&b.push(a.m_id);localStorage.setItem(DigiWebApp.ApplicationController.storagePrefix+"_"+a.name.toLowerCase()+"Keys",JSON.stringify(b));return true},findSorted:function(a){var b=this,c=[];try{var d=localStorage.getItem(DigiWebApp.ApplicationController.storagePrefix+"_"+b.name.toLowerCase()+"Keys");if(d!==null)c=JSON.parse(d)}catch(e){trackError(e)}var f=[];
c&&_.each(c,function(g){if((g=b.find({key:DigiWebApp.ApplicationController.storagePrefix+b.name+"_"+g}))&&(a&&g.get("id")===a||typeof a==="undefined"))f.push(g)});return f}},M.DataProviderLocalStorage);
DigiWebApp.BautagebuchMitarbeiter=M.Model.create({__name__:"BautagebuchMitarbeiter",id:M.Model.attr("Number",{isRequired:NO}),vorname:M.Model.attr("String",{isRequired:NO}),nachname:M.Model.attr("String",{isRequired:NO}),webAppId:M.Model.attr("String",{isRequired:NO}),webAppPin:M.Model.attr("String",{isRequired:NO}),projektleiterId:M.Model.attr("Number",{isRequired:NO}),vollername:function(){return this.get("vorname")+" "+this.get("nachname")},deleteAll:function(){_.each(this.find(),function(a){a.deleteSorted()})},
deleteSorted:function(){var a=this,b=[],c=[];try{var d=localStorage.getItem(DigiWebApp.ApplicationController.storagePrefix+"_"+a.name.toLowerCase()+"Keys");if(d!==null)b=JSON.parse(d)}catch(e){trackError(e)}if(b){_.each(b,function(f){f!==a.m_id&&c.push(f)});localStorage.setItem(DigiWebApp.ApplicationController.storagePrefix+"_"+a.name.toLowerCase()+"Keys",JSON.stringify(c))}return a.del()},saveSorted:function(){var a=this;if(!a.save())return false;var b=[];try{var c=localStorage.getItem(DigiWebApp.ApplicationController.storagePrefix+
"_"+a.name.toLowerCase()+"Keys");if(c!==null)b=JSON.parse(c)}catch(d){trackError(d)}var e=NO;_.each(b,function(f){if(a.m_id===f)e=YES});e===NO&&b.push(a.m_id);localStorage.setItem(DigiWebApp.ApplicationController.storagePrefix+"_"+a.name.toLowerCase()+"Keys",JSON.stringify(b));return true},findSorted:function(){var a=this,b=[];try{var c=localStorage.getItem(DigiWebApp.ApplicationController.storagePrefix+"_"+a.name.toLowerCase()+"Keys");if(c!==null)b=JSON.parse(c)}catch(d){trackError(d)}var e=[];b&&
_.each(b,function(f){(f=a.find({key:DigiWebApp.ApplicationController.storagePrefix+a.name+"_"+f}))&&e.push(f)});return e}},M.DataProviderLocalStorage);
DigiWebApp.BautagebuchNotiz=M.Model.create({__name__:"BautagebuchNotiz",bautagesberichtId:M.Model.attr("String",{isRequired:NO}),data:M.Model.attr("String",{isRequired:NO}),orderId:M.Model.attr("String",{isRequired:NO}),orderName:M.Model.attr("String",{isRequired:NO}),positionId:M.Model.attr("String",{isRequired:NO}),positionName:M.Model.attr("String",{isRequired:NO}),activityId:M.Model.attr("String",{isRequired:NO}),activityName:M.Model.attr("String",{isRequired:NO}),handOrderId:M.Model.attr("String",
{isRequired:NO}),handOrderName:M.Model.attr("String",{isRequired:NO}),deleteAll:function(){_.each(this.find(),function(a){a.deleteSorted()})},deleteSorted:function(){var a=this,b=[],c=[];try{var d=localStorage.getItem(DigiWebApp.ApplicationController.storagePrefix+"_"+a.name.toLowerCase()+"Keys");if(d!==null)b=JSON.parse(d)}catch(e){trackError(e)}if(b){_.each(b,function(f){f!==a.m_id&&c.push(f)});localStorage.setItem(DigiWebApp.ApplicationController.storagePrefix+"_"+a.name.toLowerCase()+"Keys",JSON.stringify(c))}return a.del()},
saveSorted:function(){var a=this;if(!a.save())return false;var b=[];try{var c=localStorage.getItem(DigiWebApp.ApplicationController.storagePrefix+"_"+a.name.toLowerCase()+"Keys");if(c!==null)b=JSON.parse(c)}catch(d){trackError(d)}var e=NO;_.each(b,function(f){if(a.m_id===f)e=YES});e===NO&&b.push(a.m_id);localStorage.setItem(DigiWebApp.ApplicationController.storagePrefix+"_"+a.name.toLowerCase()+"Keys",JSON.stringify(b));return true},findSorted:function(a){var b=this,c=[];try{var d=localStorage.getItem(DigiWebApp.ApplicationController.storagePrefix+
"_"+b.name.toLowerCase()+"Keys");if(d!==null)c=JSON.parse(d)}catch(e){trackError(e)}var f=[];c&&_.each(c,function(g){if((g=b.find({key:DigiWebApp.ApplicationController.storagePrefix+b.name+"_"+g}))&&(a&&g.get("bautagesberichtId")===a||typeof a==="undefined"))f.push(g)});return f}},M.DataProviderLocalStorage);
DigiWebApp.BautagebuchProjektleiter=M.Model.create({__name__:"BautagebuchProjektleiter",id:M.Model.attr("Number",{isRequired:NO}),vorname:M.Model.attr("String",{isRequired:NO}),nachname:M.Model.attr("String",{isRequired:NO}),vollername:function(){return this.get("vorname")+" "+this.get("nachname")},getList:function(a){a||(a={});var b=[],c=DigiWebApp[this.name].findSorted(),d=NO;_.each(c,function(e){var f={label:e.get("vollername"),value:e.get("id")};if(a.selectedId&&e.get("id")==a.selectedId||c.length==
1)d=f.isSelected=YES;b.push(f)});if(!d&&b.length>0)b.push({label:M.I18N.l("selectSomething"),value:"0",isSelected:YES});else b.length==0&&b.push({label:M.I18N.l("noData"),value:"0",isSelected:YES});return b},deleteAll:function(){_.each(this.find(),function(a){a.deleteSorted()})},deleteSorted:function(){var a=this,b=[],c=[];try{var d=localStorage.getItem(DigiWebApp.ApplicationController.storagePrefix+"_"+a.name.toLowerCase()+"Keys");if(d!==null)b=JSON.parse(d)}catch(e){trackError(e)}if(b){_.each(b,
function(f){f!==a.m_id&&c.push(f)});localStorage.setItem(DigiWebApp.ApplicationController.storagePrefix+"_"+a.name.toLowerCase()+"Keys",JSON.stringify(c))}return a.del()},saveSorted:function(){var a=this;if(!a.save())return false;var b=[];try{var c=localStorage.getItem(DigiWebApp.ApplicationController.storagePrefix+"_"+a.name.toLowerCase()+"Keys");if(c!==null)b=JSON.parse(c)}catch(d){trackError(d)}var e=NO;_.each(b,function(f){if(a.m_id===f)e=YES});e===NO&&b.push(a.m_id);localStorage.setItem(DigiWebApp.ApplicationController.storagePrefix+
"_"+a.name.toLowerCase()+"Keys",JSON.stringify(b));return true},findSorted:function(){var a=this,b=[];try{var c=localStorage.getItem(DigiWebApp.ApplicationController.storagePrefix+"_"+a.name.toLowerCase()+"Keys");if(c!==null)b=JSON.parse(c)}catch(d){trackError(d)}var e=[];b&&_.each(b,function(f){(f=a.find({key:DigiWebApp.ApplicationController.storagePrefix+a.name+"_"+f}))&&e.push(f)});return e}},M.DataProviderLocalStorage);
DigiWebApp.BautagebuchZeitbuchung=M.Model.create({__name__:"BautagebuchZeitbuchung",id:M.Model.attr("Number",{isRequired:NO}),bautagesberichtId:M.Model.attr("String",{isRequired:NO}),mitarbeiterIds:M.Model.attr("String",{isRequired:NO}),mitarbeiterId:M.Model.attr("Number",{isRequired:NO}),von:M.Model.attr("String",{isRequired:NO}),bis:M.Model.attr("String",{isRequired:NO}),dauer:M.Model.attr("String",{isRequired:NO}),remark:M.Model.attr("String",{isRequired:NO}),timeStampStart:M.Model.attr("String",
{isRequired:NO}),timeStampEnd:M.Model.attr("String",{isRequired:NO}),verbuchen:M.Model.attr("String",{isRequired:NO}),latitude:M.Model.attr("String",{isRequired:NO}),longitude:M.Model.attr("String",{isRequired:NO}),latitude_bis:M.Model.attr("String",{isRequired:NO}),longitude_bis:M.Model.attr("String",{isRequired:NO}),positionId:M.Model.attr("String",{isRequired:NO}),positionName:M.Model.attr("String",{isRequired:NO}),handOrderId:M.Model.attr("String",{isRequired:NO}),handOrderName:M.Model.attr("String",
{isRequired:NO}),activityId:M.Model.attr("String",{isRequired:NO}),activityName:M.Model.attr("String",{isRequired:NO}),deleteAll:function(){_.each(this.find(),function(a){a.deleteSorted()})},deleteSorted:function(){var a=this,b=[],c=[];try{var d=localStorage.getItem(DigiWebApp.ApplicationController.storagePrefix+"_"+a.name.toLowerCase()+"Keys");if(d!==null)b=JSON.parse(d)}catch(e){trackError(e)}if(b){_.each(b,function(f){f!==a.m_id&&c.push(f)});localStorage.setItem(DigiWebApp.ApplicationController.storagePrefix+
"_"+a.name.toLowerCase()+"Keys",JSON.stringify(c))}return a.del()},saveSorted:function(){var a=this;if(a.get("von")==a.get("bis"))return true;if(!a.save())return false;var b=[];try{var c=localStorage.getItem(DigiWebApp.ApplicationController.storagePrefix+"_"+a.name.toLowerCase()+"Keys");if(c!==null)b=JSON.parse(c)}catch(d){trackError(d)}var e=NO;_.each(b,function(f){if(a.m_id===f)e=YES});e===NO&&b.push(a.m_id);localStorage.setItem(DigiWebApp.ApplicationController.storagePrefix+"_"+a.name.toLowerCase()+
"Keys",JSON.stringify(b));return true},findSorted:function(a){var b=this,c=[];try{var d=localStorage.getItem(DigiWebApp.ApplicationController.storagePrefix+"_"+b.name.toLowerCase()+"Keys");if(d!==null)c=JSON.parse(d)}catch(e){trackError(e)}var f=[];c&&_.each(c,function(g){if((g=b.find({key:DigiWebApp.ApplicationController.storagePrefix+b.name+"_"+g}))&&(a&&g.get("bautagesberichtId")===a||typeof a==="undefined"))f.push(g)});return f}},M.DataProviderLocalStorage);
DigiWebApp.Booking=M.Model.create({__name__:"Booking",modelVersion:M.Model.attr("String",{isRequired:NO}),fileName:M.Model.attr("String",{isRequired:NO}),fileType:M.Model.attr("String",{isRequired:NO}),orderId:M.Model.attr("String",{isRequired:NO}),orderName:M.Model.attr("String",{isRequired:NO}),timezoneOffset:M.Model.attr("String",{isRequired:NO}),timezone:M.Model.attr("String",{isRequired:NO}),timeStampStart:M.Model.attr("String",{isRequired:NO}),timeStampEnd:M.Model.attr("String",{isRequired:NO}),
date:M.Model.attr("String",{}),startTimeString:M.Model.attr("String",{isRequired:NO}),endeTimeString:M.Model.attr("String",{isRequired:NO}),startDateString:M.Model.attr("String",{isRequired:NO}),endeDateString:M.Model.attr("String",{isRequired:NO}),latitude:M.Model.attr("String",{isRequired:NO}),longitude:M.Model.attr("String",{isRequired:NO}),latitude_bis:M.Model.attr("String",{isRequired:NO}),longitude_bis:M.Model.attr("String",{isRequired:NO}),gpsLaengeVon:M.Model.attr("String",{isRequired:NO}),
gpsBreiteVon:M.Model.attr("String",{isRequired:NO}),gpsLaengeBis:M.Model.attr("String",{isRequired:NO}),gpsBreiteBis:M.Model.attr("String",{isRequired:NO}),handOrderId:M.Model.attr("String",{isRequired:NO}),handOrderName:M.Model.attr("String",{isRequired:NO}),handauftragsId:M.Model.attr("String",{isRequired:NO}),handauftragsBezeichnung:M.Model.attr("String",{isRequired:NO}),positionId:M.Model.attr("String",{isRequired:NO}),positionName:M.Model.attr("String",{isRequired:NO}),activityId:M.Model.attr("String",
{isRequired:NO}),activityName:M.Model.attr("String",{isRequired:NO}),isCurrent:M.Model.attr("Boolean",{isRequired:NO}),spesenAuswahl:M.Model.attr("String",{isRequired:NO}),uebernachtungAuswahl:M.Model.attr("String",{isRequired:NO}),gefahreneKilometer:M.Model.attr("Number",{isRequired:NO}),employees:M.Model.attr("String",{isRequired:NO}),mitarbeiterId:M.Model.attr("String",{isRequired:NO}),remark:M.Model.attr("String",{isRequired:NO}),unterschrift_hoehe:M.Model.attr("String",{isRequired:NO}),unterschrift_breite:M.Model.attr("String",
{isRequired:NO}),istFeierabend:M.Model.attr("Boolean",{isRequired:NO}),istKolonnenbuchung:M.Model.attr("Boolean",{isRequired:NO}),genauigkeitVon:M.Model.attr("String",{isRequired:NO}),gps_zeitstempelVon:M.Model.attr("String",{isRequired:NO}),ermittlungsverfahrenVon:M.Model.attr("String",{isRequired:NO}),genauigkeitBis:M.Model.attr("String",{isRequired:NO}),gps_zeitstempelBis:M.Model.attr("String",{isRequired:NO}),ermittlungsverfahrenBis:M.Model.attr("String",{isRequired:NO}),ServiceApp_Status:M.Model.attr("String",
{isRequired:NO}),closeBooking:function(a){var b=this,c=null;try{c=DigiWebApp.BookingController.currentBookingTimesStampBook.getTime()}catch(d){c=(new Date).getTime()}if(M.Date.create(b.get("timeStampStart")).format("HH:MM")==M.Date.create(c).format("HH:MM")&&(b.get("timeStampEnd")==null||b.get("timeStampEnd")==""||parseIntRadixTen(b.get("timeStampEnd"))==0))return false;else if(M.Date.create(b.get("timeStampStart")).format("HH:MM:ss")==M.Date.create(c).format("HH:MM:ss")){writeToLog("bereits abgeschlossene Buchung laden und aktualisieren, um erneut gesendet zu werden ("+
JSON.stringify(this));var e=_.find(DigiWebApp.Booking.find(),function(){return M.Date.create(b.get("timeStampEnd")).format("HH:MM:ss")==M.Date.create(c).format("HH:MM:ss")});if(e){writeToLog("gefunden in Bookings");e.get("latitude_bis")==null&&e.set("latitude_bis",a.latitude);e.get("longitude_bis")==null&&e.set("longitude_bis",a.longitude);e.get("genauigkeitBis")==null&&e.set("genauigkeitBis",a.accuracy);e.get("gps_zeitstempelBis")==null&&e.set("gps_zeitstempelBis",a.date.date.getTime());e.save()}else if(e=
_.find(DigiWebApp.SentBooking.find(),function(){return M.Date.create(b.get("timeStampEnd")).format("HH:MM:ss")==M.Date.create(c).format("HH:MM:ss")})){writeToLog("gefunden in SentBookings");var f=_.find(DigiWebApp.SentBookingArchived.find(),function(){return M.Date.create(b.get("timeStampEnd")).format("HH:MM:ss")==M.Date.create(c).format("HH:MM:ss")});f&&f.del();f=DigiWebApp.Booking.createRecord({});f.m_id=e.m_id;f.record=JSON.parse(JSON.stringify(e.record));f.get("latitude_bis")==null&&f.set("latitude_bis",
a.latitude);f.get("longitude_bis")==null&&f.set("longitude_bis",a.longitude);f.get("genauigkeitBis")==null&&f.set("genauigkeitBis",a.accuracy);f.get("gps_zeitstempelBis")==null&&f.set("gps_zeitstempelBis",a.date.date.getTime());f.save();e.del()}else{writeToLog("unexpectedErrorWhileHandlingBooking");writeToLog("all Bookings: "+JSON.stringify(DigiWebApp.Booking.find()));writeToLog("all SentBookings: "+JSON.stringify(DigiWebApp.SentBooking.find()));DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("error"),
message:M.I18N.l("unexpectedErrorWhileHandlingBooking")})}return false}else{if(a){b.set("latitude_bis",a.latitude);b.set("longitude_bis",a.longitude);b.set("genauigkeitBis",a.accuracy);b.set("gps_zeitstempelBis",a.date.date.getTime())}b.set("timeStampEnd",c);a=new Date(Number(b.get("timeStampEnd"))+6E4*((new Date).getTimezoneOffset()-b.get("timezoneOffset")));e=M.Date.create(a.getTime());a=e.format("dd.mm.yyyy");e=e.format("HH:MM");b.set("endeDateString",a);b.set("endeTimeString",e);return true}},
setRemark:function(a){this.set("remark",a)},setAsCurrent:function(){this.set("isCurrent",YES)},removeAsCurrent:function(){this.set("isCurrent",NO)},deleteAll:function(){try{_.each(this.find(),function(b){if(b.hasFileName())try{b.deleteFile(function(){b.del()})}catch(c){b.del()}else b.del()})}catch(a){trackError(a)}},hasFileName:function(){return!this.get("fileName")||this.get("fileName")&&this.get("fileName").length===0?NO:YES},saveToFile:function(a,b,c){var d=this,e=new String(a);if(!d.hasFileName()){d.set("fileName",
d.__proto__.name+"_Signature_"+D8.now().getTimestamp());d.save()}if(typeof b!=="function"){trackError("saveToFileError: successCallback is not a function");return false}var f;f=!c||typeof c!=="function"?function(){trackError("saveToFileError")}:c;if(typeof window.requestFileSystem==="undefined"){trackError("saveToFileError: no LocalFileSystem available");b("");return true}try{var g=DigiWebApp.ApplicationController.CONSTApplicationQuota;typeof navigator.webkitPersistentStorage!=="undefined"?navigator.webkitPersistentStorage.requestQuota(g,
function(h){window.requestFileSystem(PERSISTENT,h,function(j){j.root.getDirectory("DIGIWebAppData",{create:true,exclusive:false},function(l){l.getFile(d.get("fileName"),{create:true,exclusive:false},function(n){n.createWriter(function(m){m.onerror=function(p){trackError("writeError");f(p)};m.onwriteend=function(){m.onwriteend=function(p){b(p)};m.truncate(e.length)};var o=new Blob([e],{type:"text/plain"});m.write(o)},f)},f)},f)},f)},function(){trackError("Error while requesting Quota");DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("error"),
message:M.I18N.l("errorWhileRequestingQuota")+": "+err})}):window.requestFileSystem(LocalFileSystem.PERSISTENT,0,function(h){h.root.getDirectory("DIGIWebAppData",{create:true,exclusive:false},function(j){j.getFile(d.get("fileName"),{create:true,exclusive:false},function(l){l.createWriter(function(n){n.onerror=function(m){trackError("writeError");f(m)};n.onwriteend=function(){n.onwriteend=function(m){b(m)};n.truncate(e.length)};n.write(e.toString())},f)},f)},f)},f)}catch(i){f(i)}},readFromFile:function(a,
b){var c=this,d;d=!b||typeof b!=="function"?function(){trackError("readFromFileError")}:b;if(typeof a!=="function"){trackError("readFromFileError: successCallback is not a function");return false}if(!c.hasFileName()){trackError("readFromFileError: no fileName given");d();return false}if(typeof window.requestFileSystem==="undefined"){trackError("readFromFileError: no LocalFileSystem available");a("");return true}try{var e=DigiWebApp.ApplicationController.CONSTApplicationQuota;typeof navigator.webkitPersistentStorage!==
"undefined"?navigator.webkitPersistentStorage.requestQuota(e,function(g){window.requestFileSystem(PERSISTENT,g,function(i){i.root.getDirectory("DIGIWebAppData",{create:true,exclusive:false},function(h){h.getFile(c.get("fileName"),null,function(j){j.file(function(l){var n=new FileReader;n.onloadend=function(){a(this.result)};n.readAsText(l)},d)},d)},d)},d)},function(){trackError("Error while requesting Quota");DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("error"),message:M.I18N.l("errorWhileRequestingQuota")+
": "+err})}):window.requestFileSystem(LocalFileSystem.PERSISTENT,0,function(g){g.root.getDirectory("DIGIWebAppData",{create:true,exclusive:false},function(i){i.getFile(c.get("fileName"),null,function(h){h.file(function(j){var l=new FileReader;l.onloadend=function(n){a(n.target.result)};l.readAsText(j)},d)},d)},d)},d)}catch(f){d(f)}},deleteFile:function(a,b){var c=this;if(!c.hasFileName()){trackError("deleteFileError: no fileName given");return false}if(typeof a!=="function"){trackError("deleteFileError: successCallback is not a function");
return false}var d;d=!b||typeof b!=="function"?function(){trackError("deleteFileError")}:b;if(typeof window.requestFileSystem==="undefined"){trackError("deleteFileError: no LocalFileSystem available");a("");return true}try{var e=DigiWebApp.ApplicationController.CONSTApplicationQuota;typeof navigator.webkitPersistentStorage!=="undefined"?navigator.webkitPersistentStorage.requestQuota(e,function(g){window.requestFileSystem(PERSISTENT,g,function(i){i.root.getDirectory("DIGIWebAppData",{create:true,exclusive:false},
function(h){h.getFile(c.get("fileName"),null,function(j){j.remove(a,d)},d)},d)},d)},function(){trackError("Error while requesting Quota");DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("error"),message:M.I18N.l("errorWhileRequestingQuota")+": "+err})}):window.requestFileSystem(LocalFileSystem.PERSISTENT,0,function(g){g.root.getDirectory("DIGIWebAppData",{create:true,exclusive:false},function(i){i.getFile(c.get("fileName"),null,function(h){h.remove(a,d)},d)},d)},d)}catch(f){d(f)}}},
M.DataProviderLocalStorage);
DigiWebApp.Employee=M.Model.create({__name__:"Employee",id:M.Model.attr("String",{isRequired:NO}),name:M.Model.attr("String",{isRequired:NO}),kolonnenId:M.Model.attr("String",{isRequired:NO}),isSelected:M.Model.attr("Boolean",{isRequired:NO}),deleteAll:function(){_.each(this.find(),function(a){a.del()})},findSorted:function(){var a=this,b=[];try{b=JSON.parse(localStorage.getItem(DigiWebApp.ApplicationController.storagePrefix+"_"+this.name.toLowerCase()+"Keys"))}catch(c){trackError(c)}var d=[];b&&
_.each(b,function(e){(e=a.find({key:DigiWebApp.ApplicationController.storagePrefix+a.name+"_"+e}))&&d.push(e)});return d},saveSorted:function(){var a=this;if(!a.save())return false;var b=[];try{var c=localStorage.getItem(DigiWebApp.ApplicationController.storagePrefix+"_"+a.name.toLowerCase()+"Keys");if(c!==null)b=JSON.parse(c)}catch(d){trackError(d)}var e=NO;_.each(b,function(f){if(a.m_id===f)e=YES});e===NO&&b.push(a.m_id);localStorage.setItem(DigiWebApp.ApplicationController.storagePrefix+"_"+a.name.toLowerCase()+
"Keys",JSON.stringify(b));return true}},M.DataProviderLocalStorage);DigiWebApp.Features=M.Model.create({__name__:"Features",id:M.Model.attr("String",{isRequired:NO}),name:M.Model.attr("String",{isRequired:NO}),isAvailable:M.Model.attr("Boolean",{isRequired:NO}),deleteAll:function(){_.each(this.find(),function(a){a.del()})}},M.DataProviderLocalStorage);
DigiWebApp.Festepausendefinition=M.Model.create({__name__:"Festepausendefinition",id:M.Model.attr("String",{isRequired:YES}),ressourceId:M.Model.attr("String",{isRequired:NO}),wochentagId:M.Model.attr("String",{isRequired:YES}),von:M.Model.attr("String",{isRequired:NO}),bis:M.Model.attr("String",{isRequired:NO}),deleteAll:function(){_.each(this.find(),function(a){a.del()});localStorage.removeItem(DigiWebApp.ApplicationController.storagePrefix+"_"+this.name.toLowerCase()+"Keys")},findById:function(a){var b=
null;$.each(this.find(),function(c,d){if(parseIntRadixTen(a)===parseIntRadixTen(d.get("id"))){b=d;return false}return true});return b},findSorted:function(){var a=this,b=[];try{b=JSON.parse(localStorage.getItem(DigiWebApp.ApplicationController.storagePrefix+"_"+this.name.toLowerCase()+"Keys"))}catch(c){trackError(c)}var d=[];b&&_.each(b,function(e){(e=a.find({key:DigiWebApp.ApplicationController.storagePrefix+a.name+"_"+e}))&&d.push(e)});return d},saveSorted:function(){var a=this;if(!a.save())return false;
var b=[];try{var c=localStorage.getItem(DigiWebApp.ApplicationController.storagePrefix+"_"+a.name.toLowerCase()+"Keys");if(c!==null)b=JSON.parse(c)}catch(d){trackError(d)}var e=NO;_.each(b,function(f){if(a.m_id===f)e=YES});e===NO&&b.push(a.m_id);localStorage.setItem(DigiWebApp.ApplicationController.storagePrefix+"_"+a.name.toLowerCase()+"Keys",JSON.stringify(b));return true}},M.DataProviderLocalStorage);
DigiWebApp.HandOrder=M.Model.create({__name__:"HandOrder",id:M.Model.attr("String",{isRequired:NO}),name:M.Model.attr("String",{isRequired:NO}),isLocalOnly:M.Model.attr("Boolean",{isRequired:NO}),deleteAll:function(){var a=DigiWebApp.Booking.find(),b=_.detect(a,function(c){return c.get("isCurrent")===true});_.each(this.find(),function(c){if(b)c.get("id")==b.get("handOrderId")||c.get("name")==b.get("handOrderName")||c.del();else c.del()})},findSorted:function(){return this.find()}},M.DataProviderLocalStorage);
DigiWebApp.MediaFile=M.Model.create({__name__:"MediaFile",name:M.Model.attr("String",{isRequired:NO}),fileName:M.Model.attr("String",{isRequired:NO}),fileType:M.Model.attr("String",{isRequired:YES}),timeStamp:M.Model.attr("String",{isRequired:NO}),date:M.Model.attr("String",{}),icon:M.Model.attr("String",{isRequired:NO}),orderId:M.Model.attr("String",{isRequired:NO}),orderName:M.Model.attr("String",{isRequired:NO}),positionId:M.Model.attr("String",{isRequired:NO}),positionName:M.Model.attr("String",
{isRequired:NO}),activityId:M.Model.attr("String",{isRequired:NO}),activityName:M.Model.attr("String",{isRequired:NO}),mitarbeiterId:M.Model.attr("String",{isRequired:NO}),handOrderName:M.Model.attr("String",{isRequired:NO}),handOrderId:M.Model.attr("String",{isRequired:NO}),latitude:M.Model.attr("String",{isRequired:NO}),longitude:M.Model.attr("String",{isRequired:NO}),remark:M.Model.attr("String",{isRequired:NO}),data:M.Model.attr("String",{isRequired:NO}),setRemark:function(a){this.set("remark",
a)},writeError:M.Model.attr("Boolean",{isRequired:NO}),deleteAll:function(a){var b=this.find().length,c=0,d=function(e){e.del();c+=1;c===b&&typeof a==="function"&&a()};_.each(this.find(),function(e){e.hasFileName()?e.deleteFile(function(){d(e)},function(){d(e)}):d(e)})},hasFileName:function(){return!this.get("fileName")||this.get("fileName")&&this.get("fileName").length===0?NO:YES},saveToFile:function(a,b,c){var d=this,e=new String(a);if(!d.hasFileName()){d.set("fileName",d.__proto__.name+"_"+D8.now().getTimestamp());
d.save()}if(typeof b!=="function"){trackError("saveToFileError: successCallback is not a function");return false}var f;f=!c||typeof c!=="function"?function(){trackError("saveToFileError")}:c;if(typeof window.requestFileSystem==="undefined"){trackError("saveToFileError: no LocalFileSystem available");b("");return true}try{var g=DigiWebApp.ApplicationController.CONSTApplicationQuota;typeof navigator.webkitPersistentStorage!=="undefined"?navigator.webkitPersistentStorage.requestQuota(g,function(h){window.requestFileSystem(PERSISTENT,
h,function(j){j.root.getDirectory("DIGIWebAppData",{create:true,exclusive:false},function(l){l.getFile(d.get("fileName"),{create:true,exclusive:false},function(n){n.createWriter(function(m){m.onerror=function(p){trackError("writeError");f(p)};m.onwriteend=function(){m.onwriteend=function(p){b(p)};m.truncate(e.length)};var o=new Blob([e],{type:"text/plain"});m.write(o)},f)},f)},f)},f)},function(){trackError("Error while requesting Quota");DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("error"),
message:M.I18N.l("errorWhileRequestingQuota")+": "+err})}):window.requestFileSystem(LocalFileSystem.PERSISTENT,0,function(h){h.root.getDirectory("DIGIWebAppData",{create:true,exclusive:false},function(j){j.getFile(d.get("fileName"),{create:true,exclusive:false},function(l){l.createWriter(function(n){n.onerror=function(m){trackError("writeError");f(m)};n.onwriteend=function(){n.onwriteend=function(m){b(m)};n.truncate(e.length)};n.write(e.toString())},f)},f)},f)},f)}catch(i){f(i)}},readFromFile:function(a,
b){var c=this;if(!c.hasFileName()){trackError("readFromFileError: no fileName given");return false}if(typeof a!=="function"){trackError("readFromFileError: successCallback is not a function");return false}var d;d=!b||typeof b!=="function"?function(){trackError("readFromFileError")}:b;if(typeof window.requestFileSystem==="undefined"){trackError("readFromFileError: no LocalFileSystem available");a("");return true}try{var e=DigiWebApp.ApplicationController.CONSTApplicationQuota;typeof navigator.webkitPersistentStorage!==
"undefined"?navigator.webkitPersistentStorage.requestQuota(e,function(g){window.requestFileSystem(PERSISTENT,g,function(i){i.root.getDirectory("DIGIWebAppData",{create:true,exclusive:false},function(h){h.getFile(c.get("fileName"),null,function(j){j.file(function(l){var n=new FileReader;n.onloadend=function(){a(this.result)};n.readAsText(l)},d)},d)},d)},d)},function(){trackError("Error while requesting Quota");DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("error"),message:M.I18N.l("errorWhileRequestingQuota")+
": "+err})}):window.requestFileSystem(LocalFileSystem.PERSISTENT,0,function(g){g.root.getDirectory("DIGIWebAppData",{create:true,exclusive:false},function(i){i.getFile(c.get("fileName"),null,function(h){h.file(function(j){var l=new FileReader;l.onloadend=function(n){a(n.target.result)};l.readAsText(j)},d)},d)},d)},d)}catch(f){d(f)}},deleteFile:function(a,b){var c=this;if(!c.hasFileName()){trackError("deleteFileError: no fileName given");return false}if(typeof a!=="function"){trackError("deleteFileError: successCallback is not a function");
return false}var d;d=!b||typeof b!=="function"?function(){trackError("deleteFileError")}:b;if(typeof window.requestFileSystem==="undefined"){trackError("deleteFileError: no LocalFileSystem available");a("");return true}try{var e=DigiWebApp.ApplicationController.CONSTApplicationQuota;typeof navigator.webkitPersistentStorage!=="undefined"?navigator.webkitPersistentStorage.requestQuota(e,function(g){window.requestFileSystem(PERSISTENT,g,function(i){i.root.getDirectory("DIGIWebAppData",{create:true,exclusive:false},
function(h){h.getFile(c.get("fileName"),null,function(j){j.remove(a,d)},d)},d)},d)},function(){trackError("Error while requesting Quota");DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("error"),message:M.I18N.l("errorWhileRequestingQuota")+": "+err})}):window.requestFileSystem(LocalFileSystem.PERSISTENT,0,function(g){g.root.getDirectory("DIGIWebAppData",{create:true,exclusive:false},function(i){i.getFile(c.get("fileName"),null,function(h){h.remove(a,d)},d)},d)},d)}catch(f){d(f)}}},
M.DataProviderLocalStorage);
DigiWebApp.OnlinePosition=M.Model.create({__name__:"OnlinePosition",positionsId:M.Model.attr("String",{isRequired:NO}),auftragsBezeichnung:M.Model.attr("String",{isRequired:NO}),auftragsBeginn:M.Model.attr("String",{isRequired:NO}),auftragsEnde:M.Model.attr("String",{isRequired:NO}),positionsBezeichnung:M.Model.attr("String",{isRequired:NO}),strasse:M.Model.attr("String",{isRequired:NO}),hausnummer:M.Model.attr("String",{isRequired:NO}),plz:M.Model.attr("String",{isRequired:NO}),ort:M.Model.attr("String",
{isRequired:NO}),land:M.Model.attr("String",{isRequired:NO}),countrycode:M.Model.attr("String",{isRequired:NO}),telefon:M.Model.attr("String",{isRequired:NO}),fax:M.Model.attr("String",{isRequired:NO}),email:M.Model.attr("String",{isRequired:NO}),ansprechpartner:M.Model.attr("String",{isRequired:NO}),kundenname:M.Model.attr("String",{isRequired:NO}),longitude:M.Model.attr("String",{isRequired:NO}),latitude:M.Model.attr("String",{isRequired:NO}),positionsBeschreibung:M.Model.attr("String",{isRequired:NO}),
orderId:M.Model.attr("String",{isRequired:NO}),arbeitsbeginn:M.Model.attr("String",{isRequired:NO}),arbeitsende:M.Model.attr("String",{isRequired:NO}),deleteAll:function(){_.each(this.find(),function(a){a.del()})}},M.DataConsumer.configure({appendRecords:NO,responsePath:"positionen",url:function(){var a=DigiWebApp.ZeitbuchungenController.itemForDetails.get("positionsId");a="http://"+DigiWebApp.RequestController.DatabaseServer+"/WebAppServices/positionen?modus=0&firmenId="+DigiWebApp.SettingsController.getSetting("company")+
"&kennwort="+DigiWebApp.SettingsController.getSetting("password")+"&geraeteId="+DigiWebApp.SettingsController.getSetting("workerId")+"&geraeteTyp=2&softwareVersion="+DigiWebApp.RequestController.softwareVersion+"&positionsId="+a+"&requestTimestamp="+M.Date.now().date.valueOf();DigiWebApp.ApplicationController.profilingIntervalVar===null&&console.log("Positionen: using "+a);return a},map:function(a){if(a===null)return{positionsId:null,positionsBezeichnung:null,strasse:null,hausnummer:null,plz:null,
ort:null,land:null,countrycode:null,telefon:null,fax:null,email:null,ansprechpartner:null,kundenname:null,longitude:null,latitude:null,positionsBeschreibung:null,orderId:null,auftragsBezeichnung:null,arbeitsbeginn:null,arbeitsende:null};return{positionsId:a.positionsId,positionsBezeichnung:a.positionsBezeichnung,strasse:a.strasse,hausnummer:a.hausnummer,plz:a.plz,ort:a.ort,land:a.land,countrycode:a.countrycode,telefon:a.telefon,fax:a.fax,email:a.email,ansprechpartner:a.ansprechpartner,kundenname:a.kundenname,
longitude:a.longitude,latitude:a.latitude,positionsBeschreibung:a.positionsBeschreibung,orderId:a.orderId,auftragsBezeichnung:a.auftragsBezeichnung,arbeitsbeginn:a.arbeitsbeginn,arbeitsende:a.arbeitsende}}}));
DigiWebApp.Order=M.Model.create({__name__:"Order",id:M.Model.attr("String",{isRequired:NO}),name:M.Model.attr("String",{isRequired:NO}),getById:function(a){return _.find(DigiWebApp[this.name].find(),function(b){return b.get("id")==a})},getList:function(a){a||(a={});var b=[],c=DigiWebApp.Order.findSorted(),d=DigiWebApp.HandOrder.findSorted().concat(c),e=NO;_.each(d,function(f){var g={label:f.get("name"),value:f.get("id")};if(a.selectedId&&f.get("id")==a.selectedId||d.length==1)e=g.isSelected=YES;b.push(g)});
if(!e&&b.length>0)b.push({label:M.I18N.l("selectSomething"),value:"0",isSelected:YES});else b.length==0&&b.push({label:M.I18N.l("noData"),value:"0",isSelected:YES});return b},getPositionen:function(){var a=this;return _.compact(_.filter(DigiWebApp.Position.findSorted(),function(b){return _.find([b.get("orderId")],function(c){return a.get("id")==c})}))},deleteAll:function(){_.each(this.find(),function(a){a.del()});localStorage.removeItem(DigiWebApp.ApplicationController.storagePrefix+"_"+this.name.toLowerCase()+
"Keys")},findSorted:function(){var a=this,b=[];try{b=JSON.parse(localStorage.getItem(DigiWebApp.ApplicationController.storagePrefix+"_"+this.name.toLowerCase()+"Keys"))}catch(c){trackError(c)}var d=[];b&&_.each(b,function(e){(e=a.find({key:DigiWebApp.ApplicationController.storagePrefix+a.name+"_"+e}))&&d.push(e)});return d},saveSorted:function(){var a=this;if(!a.save())return false;var b=[];try{var c=localStorage.getItem(DigiWebApp.ApplicationController.storagePrefix+"_"+a.name.toLowerCase()+"Keys");
if(c!==null)b=JSON.parse(c)}catch(d){trackError(d)}var e=NO;_.each(b,function(f){if(a.m_id===f)e=YES});e===NO&&b.push(a.m_id);localStorage.setItem(DigiWebApp.ApplicationController.storagePrefix+"_"+a.name.toLowerCase()+"Keys",JSON.stringify(b));return true}},M.DataProviderLocalStorage);
DigiWebApp.SentBooking=M.Model.create({__name__:"SentBooking",fileName:M.Model.attr("String",{isRequired:NO}),fileType:M.Model.attr("String",{isRequired:NO}),orderId:M.Model.attr("String",{isRequired:NO}),orderName:M.Model.attr("String",{isRequired:NO}),timezoneOffset:M.Model.attr("String",{isRequired:NO}),timezone:M.Model.attr("String",{isRequired:NO}),timeStampStart:M.Model.attr("String",{isRequired:NO}),timeStampEnd:M.Model.attr("String",{isRequired:NO}),date:M.Model.attr("String",{}),startTimeString:M.Model.attr("String",
{isRequired:NO}),endeTimeString:M.Model.attr("String",{isRequired:NO}),startDateString:M.Model.attr("String",{isRequired:NO}),endeDateString:M.Model.attr("String",{isRequired:NO}),latitude:M.Model.attr("String",{isRequired:NO}),longitude:M.Model.attr("String",{isRequired:NO}),latitude_bis:M.Model.attr("String",{isRequired:NO}),longitude_bis:M.Model.attr("String",{isRequired:NO}),gpsLaengeVon:M.Model.attr("String",{isRequired:NO}),gpsBreiteVon:M.Model.attr("String",{isRequired:NO}),gpsLaengeBis:M.Model.attr("String",
{isRequired:NO}),gpsBreiteBis:M.Model.attr("String",{isRequired:NO}),handOrderName:M.Model.attr("String",{isRequired:NO}),handOrderId:M.Model.attr("String",{isRequired:NO}),positionId:M.Model.attr("String",{isRequired:NO}),positionName:M.Model.attr("String",{isRequired:NO}),activityId:M.Model.attr("String",{isRequired:NO}),activityName:M.Model.attr("String",{isRequired:NO}),isCurrent:M.Model.attr("Boolean",{isRequired:NO}),spesenAuswahl:M.Model.attr("String",{isRequired:NO}),uebernachtungAuswahl:M.Model.attr("String",
{isRequired:NO}),gefahreneKilometer:M.Model.attr("Number",{isRequired:NO}),employees:M.Model.attr("String",{isRequired:NO}),mitarbeiterId:M.Model.attr("String",{isRequired:NO}),remark:M.Model.attr("String",{isRequired:NO}),istFeierabend:M.Model.attr("Boolean",{isRequired:NO}),istKolonnenbuchung:M.Model.attr("Boolean",{isRequired:NO}),genauigkeitVon:M.Model.attr("String",{isRequired:NO}),gps_zeitstempelVon:M.Model.attr("String",{isRequired:NO}),ermittlungsverfahrenVon:M.Model.attr("String",{isRequired:NO}),
genauigkeitBis:M.Model.attr("String",{isRequired:NO}),gps_zeitstempelBis:M.Model.attr("String",{isRequired:NO}),ermittlungsverfahrenBis:M.Model.attr("String",{isRequired:NO}),ServiceApp_Status:M.Model.attr("String",{isRequired:NO}),closeBooking:function(){this.set("timeStampEnd",+new Date)},setRemark:function(a){this.set("remark",a)},setAsCurrent:function(){this.set("isCurrent",YES)},removeAsCurrent:function(){this.set("isCurrent",NO)},deleteAll:function(){_.each(this.find(),function(a){a.del()})}},
M.DataProviderLocalStorage);
DigiWebApp.Position=M.Model.create({__name__:"Position",id:M.Model.attr("String",{isRequired:NO}),name:M.Model.attr("String",{isRequired:NO}),strasse:M.Model.attr("String",{isRequired:NO}),hausnummer:M.Model.attr("String",{isRequired:NO}),plz:M.Model.attr("String",{isRequired:NO}),ort:M.Model.attr("String",{isRequired:NO}),land:M.Model.attr("String",{isRequired:NO}),countrycode:M.Model.attr("String",{isRequired:NO}),telefon:M.Model.attr("String",{isRequired:NO}),fax:M.Model.attr("String",{isRequired:NO}),
email:M.Model.attr("String",{isRequired:NO}),ansprechpartner:M.Model.attr("String",{isRequired:NO}),kundenname:M.Model.attr("String",{isRequired:NO}),longitude:M.Model.attr("String",{isRequired:NO}),latitude:M.Model.attr("String",{isRequired:NO}),description:M.Model.attr("String",{isRequired:NO}),orderId:M.Model.attr("String",{isRequired:NO}),positionBegin:M.Model.attr("String",{isRequired:NO}),positionEnd:M.Model.attr("String",{isRequired:NO}),appointments:M.Model.attr("String",{isRequired:NO}),
arbeitsbeginn:M.Model.attr("String",{isRequired:NO}),arbeitsende:M.Model.attr("String",{isRequired:NO}),getById:function(a){return _.find(DigiWebApp[this.name].find(),function(b){return b.get("id")==a})},getAuftrag:function(){return DigiWebApp.Order.getById(this.get("orderId"))},getTaetigkeiten:function(){var a=this,b=_.select(DigiWebApp.WorkPlan.find(),function(c){if(c)return c.get("id")==a.get("id")});b=b.length>0?a.getActivitiesFromWorkplan(b[0]):_.filter(DigiWebApp.Activity.findSorted(),function(c){return c.get("positionId")==
1});return _.compact(b)},getActivitiesFromWorkplan:function(a){var b=a.get("activityIds").split(","),c=[];if(b&&b.length>0)for(var d=DigiWebApp.Activity.find(),e=0;e<b.length;e++){var f=_.find(d,function(g){return parseIntRadixTen(g.get("id"))===parseIntRadixTen(b[e])});f&&c.push(f)}if(parseIntRadixTen(a.get("workplanType"))===1)c=_.map(c,function(g){if(typeof g==="undefined"){console.log("UNDEFINED ACTIVITY");return null}else{var i=NO,h=DigiWebApp.Activity.findSorted();_.each(h,function(j){if(g.get("id")===
j.get("id")&&parseIntRadixTen(j.get("positionId"))===1)i=YES});return i?g:null}});return c=_.compact(c)},getList:function(a){a||(a={});var b=[],c=DigiWebApp.Position.findSorted();if(a.parentId)c=_.filter(c,function(e){return e.get("orderId")==a.parentId});var d=NO;_.each(c,function(e){var f={label:e.get("name"),value:e.get("id")};if(a.selectedId&&e.get("id")==a.selectedId||c.length==1)d=f.isSelected=YES;b.push(f)});if(!d&&b.length>0)b.push({label:M.I18N.l("selectSomething"),value:"0",isSelected:YES});
else b.length==0&&b.push({label:M.I18N.l("noData"),value:"0",isSelected:YES});return b},deleteAll:function(){_.each(this.find(),function(a){a.del()});localStorage.removeItem(DigiWebApp.ApplicationController.storagePrefix+"_"+this.name.toLowerCase()+"Keys")},findSorted:function(){var a=this,b=[];try{b=JSON.parse(localStorage.getItem(DigiWebApp.ApplicationController.storagePrefix+"_"+this.name.toLowerCase()+"Keys"))}catch(c){trackError(c)}var d=[];b&&_.each(b,function(e){(e=a.find({key:DigiWebApp.ApplicationController.storagePrefix+
a.name+"_"+e}))&&d.push(e)});return d},saveSorted:function(){var a=this;if(!a.save())return false;var b=[];try{var c=localStorage.getItem(DigiWebApp.ApplicationController.storagePrefix+"_"+a.name.toLowerCase()+"Keys");if(c!==null)b=JSON.parse(c)}catch(d){trackError(d)}var e=NO;_.each(b,function(f){if(a.m_id===f)e=YES});e===NO&&b.push(a.m_id);localStorage.setItem(DigiWebApp.ApplicationController.storagePrefix+"_"+a.name.toLowerCase()+"Keys",JSON.stringify(b));return true}},M.DataProviderLocalStorage);
DigiWebApp.SentBookingArchived=M.Model.create({__name__:"SentBookingArchived",fileName:M.Model.attr("String",{isRequired:NO}),fileType:M.Model.attr("String",{isRequired:NO}),orderId:M.Model.attr("String",{isRequired:NO}),orderName:M.Model.attr("String",{isRequired:NO}),timezoneOffset:M.Model.attr("String",{isRequired:NO}),timezone:M.Model.attr("String",{isRequired:NO}),timeStampStart:M.Model.attr("String",{isRequired:NO}),timeStampEnd:M.Model.attr("String",{isRequired:NO}),tagLabel:M.Model.attr("String",
{isRequired:NO}),date:M.Model.attr("String",{}),startTimeString:M.Model.attr("String",{isRequired:NO}),endeTimeString:M.Model.attr("String",{isRequired:NO}),startDateString:M.Model.attr("String",{isRequired:NO}),endeDateString:M.Model.attr("String",{isRequired:NO}),latitude:M.Model.attr("String",{isRequired:NO}),longitude:M.Model.attr("String",{isRequired:NO}),latitude_bis:M.Model.attr("String",{isRequired:NO}),longitude_bis:M.Model.attr("String",{isRequired:NO}),gpsLaengeVon:M.Model.attr("String",
{isRequired:NO}),gpsBreiteVon:M.Model.attr("String",{isRequired:NO}),gpsLaengeBis:M.Model.attr("String",{isRequired:NO}),gpsBreiteBis:M.Model.attr("String",{isRequired:NO}),handOrderName:M.Model.attr("String",{isRequired:NO}),handOrderId:M.Model.attr("String",{isRequired:NO}),positionId:M.Model.attr("String",{isRequired:NO}),positionName:M.Model.attr("String",{isRequired:NO}),activityId:M.Model.attr("String",{isRequired:NO}),activityName:M.Model.attr("String",{isRequired:NO}),isCurrent:M.Model.attr("Boolean",
{isRequired:NO}),spesenAuswahl:M.Model.attr("String",{isRequired:NO}),uebernachtungAuswahl:M.Model.attr("String",{isRequired:NO}),gefahreneKilometer:M.Model.attr("Number",{isRequired:NO}),employees:M.Model.attr("String",{isRequired:NO}),mitarbeiterId:M.Model.attr("String",{isRequired:NO}),remark:M.Model.attr("String",{isRequired:NO}),istFeierabend:M.Model.attr("Boolean",{isRequired:NO}),istKolonnenbuchung:M.Model.attr("Boolean",{isRequired:NO}),genauigkeitVon:M.Model.attr("String",{isRequired:NO}),
gps_zeitstempelVon:M.Model.attr("String",{isRequired:NO}),ermittlungsverfahrenVon:M.Model.attr("String",{isRequired:NO}),genauigkeitBis:M.Model.attr("String",{isRequired:NO}),gps_zeitstempelBis:M.Model.attr("String",{isRequired:NO}),ermittlungsverfahrenBis:M.Model.attr("String",{isRequired:NO}),ServiceApp_Status:M.Model.attr("String",{isRequired:NO}),closeBooking:function(){this.set("timeStampEnd",+new Date)},setRemark:function(a){this.set("remark",a)},setAsCurrent:function(){this.set("isCurrent",
YES)},removeAsCurrent:function(){this.set("isCurrent",NO)},deleteAll:function(){_.each(this.find(),function(a){a.del()})},deleteOld:function(){var a=0;try{a=0+new Number(DigiWebApp.SettingsController.getSetting("daysToHoldBookingsOnDevice"))}catch(b){a=DigiWebApp.SettingsController.defaultsettings.get("daysToHoldBookingsOnDevice")}var c=D8.create(D8.now().format("dd.mm.yyyy")).addDays(-a).getTimestamp();_.each(this.find(),function(d){D8.create(d.get("timeStampStart")).getTimestamp()<c&&d.del()})}},
M.DataProviderLocalStorage);
DigiWebApp.SentTimeDataDays=M.Model.create({__name__:"SentTimeDataDays",tagLabel:M.Model.attr("String",{isRequired:NO}),deleteAll:function(){_.each(this.find(),function(a){a.del()})},deleteOld:function(){var a=0;try{a=0+new Number(DigiWebApp.SettingsController.getSetting("daysToHoldBookingsOnDevice"))}catch(b){a=DigiWebApp.SettingsController.defaultsettings.get("daysToHoldBookingsOnDevice")}var c=D8.create(D8.now().format("dd.mm.yyyy")).addDays(-a).getTimestamp();_.each(this.find(),function(d){D8.create(d.get("tagLabel")).getTimestamp()<
c&&d.del()})}},M.DataProviderLocalStorage);
DigiWebApp.Settings=M.Model.create({__name__:"Settings",debug:M.Model.attr("Boolean"),settingsPassword:M.Model.attr("String"),treatAllAsTablet:M.Model.attr("Boolean"),treatAllAsPhone:M.Model.attr("Boolean"),company:M.Model.attr("String"),password:M.Model.attr("String"),connectionCode:M.Model.attr("String"),workerId:M.Model.attr("String"),timeouthappened:M.Model.attr("String"),skipEvents:M.Model.attr("String"),platform:M.Model.attr("String"),userAgent:M.Model.attr("String"),mapType:M.Model.attr("String"),
autoTransferAfterBookTime:M.Model.attr("Boolean"),autoTransferAfterClosingDay:M.Model.attr("Boolean"),autoSyncAfterBookTime:M.Model.attr("Boolean"),stammdatenabgleichBeimAppStart:M.Model.attr("Boolean"),autoSaveGPSData:M.Model.attr("Boolean"),GPSDataIsMandatory:M.Model.attr("Boolean"),remarkIsMandatory:M.Model.attr("Boolean"),remarkIsOptional:M.Model.attr("Boolean"),useTransitionsSetting:M.Model.attr("Boolean"),daysToHoldBookingsOnDevice:M.Model.attr("String"),bautagebuchLimit_autoStartUhrzeit:M.Model.attr("Boolean"),
datatransfer_min_delay:M.Model.attr("String"),branding:M.Model.attr("String"),GPSTimeOut:M.Model.attr("Integer"),WebserviceTimeOut:M.Model.attr("Integer"),LoaderTimeOut:M.Model.attr("Integer"),silentLoader:M.Model.attr("Boolean"),ServiceApp_ermittleGeokoordinate:M.Model.attr("Boolean"),ServiceApp_datenUebertragen:M.Model.attr("Boolean"),ServiceApp_engeKopplung:M.Model.attr("Boolean"),ServiceApp_PORT:M.Model.attr("String"),ServiceApp_FallBack:M.Model.attr("Boolean"),currentTimezoneOffset:M.Model.attr("String"),
currentTimezone:M.Model.attr("String"),debugDatabaseServer:M.Model.attr("String"),mitarbeiterVorname:M.Model.attr("String"),mitarbeiterNachname:M.Model.attr("String"),mitarbeiterId:M.Model.attr("String"),auftragsDetailsKoppeln:M.Model.attr("Boolean"),detailierteZeitdaten:M.Model.attr("Boolean"),vibrationsDauer:M.Model.attr("String"),terminliste_keineKuenstlichenTermine:M.Model.attr("Boolean"),terminliste_ignoriereAuftragszeitraum:M.Model.attr("Boolean"),festePauseStornieren_nurAktuellerTag:M.Model.attr("Boolean"),
startTimeout:M.Model.attr("String"),GPSenableHighAccuracy:M.Model.attr("Boolean"),GPSenableHighAccuracyFallback:M.Model.attr("Boolean"),GPSmaximumAgeMinutes:M.Model.attr("Integer"),GPSBackgroundService:M.Model.attr("Boolean"),BookingReminderHours:M.Model.attr("Integer"),closeAppAfterCloseDay:M.Model.attr("Boolean"),DTC6aktiv:M.Model.attr("Boolean"),useNativeLoader:M.Model.attr("Boolean"),pictureEncodingType:M.Model.attr("String"),pictureEncodingQuality:M.Model.attr("Integer"),pictureAllowEdit:M.Model.attr("Boolean"),
mengeneingabeMitTelKeyboard:M.Model.attr("Boolean"),scrId:M.Model.attr("String"),overrideApplicationQuota:M.Model.attr("String"),logWriterInterval:M.Model.attr("Integer"),progressViewVerwendenAb:M.Model.attr("Integer"),logDelete:M.Model.attr("Boolean"),logSave:M.Model.attr("Boolean")},M.DataProviderLocalStorage);
DigiWebApp.Sonderbuchung=M.Model.create({__name__:"Sonderbuchung",id:M.Model.attr("String",{isRequired:NO}),ressourceId:M.Model.attr("String",{isRequired:NO}),sonderbuchungstyp:M.Model.attr("String",{isRequired:NO}),sonderbuchungseigenschaften:M.Model.attr("String",{isRequired:NO}),uebertragen:M.Model.attr("String",{isRequired:NO}),status:M.Model.attr("String",{isRequired:NO}),festepausendefinitionId:M.Model.attr("String",{isRequired:NO}),datum:M.Model.attr("String",{isRequired:NO}),deleteAll:function(){_.each(this.find(),
function(a){a.del()});localStorage.removeItem(DigiWebApp.ApplicationController.storagePrefix+"_"+this.name.toLowerCase()+"Keys")},findById:function(a){var b=null;$.each(this.find(),function(c,d){if(parseIntRadixTen(a)===parseIntRadixTen(d.get("id"))){b=d;return false}return true});return b},findSorted:function(){var a=this,b=[];try{b=JSON.parse(localStorage.getItem(DigiWebApp.ApplicationController.storagePrefix+"_"+this.name.toLowerCase()+"Keys"))}catch(c){trackError(c)}var d=[];b&&_.each(b,function(e){(e=
a.find({key:DigiWebApp.ApplicationController.storagePrefix+a.name+"_"+e}))&&d.push(e)});return d},saveSorted:function(){var a=this;if(!a.save())return false;var b=[];try{var c=localStorage.getItem(DigiWebApp.ApplicationController.storagePrefix+"_"+a.name.toLowerCase()+"Keys");if(c!==null)b=JSON.parse(c)}catch(d){trackError(d)}var e=NO;_.each(b,function(f){if(a.m_id===f)e=YES});e===NO&&b.push(a.m_id);localStorage.setItem(DigiWebApp.ApplicationController.storagePrefix+"_"+a.name.toLowerCase()+"Keys",
JSON.stringify(b));return true}},M.DataProviderLocalStorage);
DigiWebApp.SpesenAuswahlOption=M.Model.create({__name__:"SpesenAuswahlOption",id:M.Model.attr("String",{isRequired:NO}),beschreibung:M.Model.attr("String",{isRequired:NO}),deleteAll:function(){_.each(this.find(),function(a){a.deleteSorted()})},deleteSorted:function(){var a=this,b=[],c=[];try{var d=localStorage.getItem(DigiWebApp.ApplicationController.storagePrefix+"_"+a.name.toLowerCase()+"Keys");if(d!==null)b=JSON.parse(d)}catch(e){trackError(e)}if(b){_.each(b,function(f){f!==a.m_id&&c.push(f)});
localStorage.setItem(DigiWebApp.ApplicationController.storagePrefix+"_"+a.name.toLowerCase()+"Keys",JSON.stringify(c))}return a.del()},saveSorted:function(){var a=this;if(!a.save())return false;var b=[];try{var c=localStorage.getItem(DigiWebApp.ApplicationController.storagePrefix+"_"+a.name.toLowerCase()+"Keys");if(c!==null)b=JSON.parse(c)}catch(d){trackError(d)}var e=NO;_.each(b,function(f){if(a.m_id===f)e=YES});e===NO&&b.push(a.m_id);localStorage.setItem(DigiWebApp.ApplicationController.storagePrefix+
"_"+a.name.toLowerCase()+"Keys",JSON.stringify(b));return true},findSorted:function(){var a=this,b=[];try{var c=localStorage.getItem(DigiWebApp.ApplicationController.storagePrefix+"_"+a.name.toLowerCase()+"Keys");if(c!==null)b=JSON.parse(c)}catch(d){trackError(d)}var e=[];b&&_.each(b,function(f){(f=a.find({key:DigiWebApp.ApplicationController.storagePrefix+a.name+"_"+f}))&&e.push(f)});return e}},M.DataProviderLocalStorage);
DigiWebApp.UebernachtungAuswahlOption=M.Model.create({__name__:"UebernachtungAuswahlOption",id:M.Model.attr("String",{isRequired:NO}),beschreibung:M.Model.attr("String",{isRequired:NO}),deleteAll:function(){_.each(this.find(),function(a){a.deleteSorted()})},deleteSorted:function(){var a=this,b=[],c=[];try{var d=localStorage.getItem(DigiWebApp.ApplicationController.storagePrefix+"_"+a.name.toLowerCase()+"Keys");if(d!==null)b=JSON.parse(d)}catch(e){trackError(e)}if(b){_.each(b,function(f){f!==a.m_id&&
c.push(f)});localStorage.setItem(DigiWebApp.ApplicationController.storagePrefix+"_"+a.name.toLowerCase()+"Keys",JSON.stringify(c))}return a.del()},saveSorted:function(){var a=this;if(!a.save())return false;var b=[];try{var c=localStorage.getItem(DigiWebApp.ApplicationController.storagePrefix+"_"+a.name.toLowerCase()+"Keys");if(c!==null)b=JSON.parse(c)}catch(d){trackError(d)}var e=NO;_.each(b,function(f){if(a.m_id===f)e=YES});e===NO&&b.push(a.m_id);localStorage.setItem(DigiWebApp.ApplicationController.storagePrefix+
"_"+a.name.toLowerCase()+"Keys",JSON.stringify(b));return true},findSorted:function(){var a=this,b=[];try{var c=localStorage.getItem(DigiWebApp.ApplicationController.storagePrefix+"_"+a.name.toLowerCase()+"Keys");if(c!==null)b=JSON.parse(c)}catch(d){trackError(d)}var e=[];b&&_.each(b,function(f){(f=a.find({key:DigiWebApp.ApplicationController.storagePrefix+a.name+"_"+f}))&&e.push(f)});return e}},M.DataProviderLocalStorage);
DigiWebApp.WorkPlan=M.Model.create({__name__:"WorkPlan",id:M.Model.attr("String",{isRequired:NO}),workplanType:M.Model.attr("String",{isRequired:NO}),activityIds:M.Model.attr("String",{isRequired:NO}),activityPositions:M.Model.attr("String",{isRequired:NO}),deleteAll:function(){_.each(this.find(),function(a){a.del()})}},M.DataProviderLocalStorage);
DigiWebApp.Zeitbuchungen=M.Model.create({__name__:"Zeitbuchungen",auftragsBezeichnung:M.Model.attr("String",{}),auftragsId:M.Model.attr("String",{}),bis:M.Model.attr("String",{}),datum:M.Model.attr("String",{}),dauer:M.Model.attr("String",{}),farbeAmpel:M.Model.attr("String",{}),gpsBreite:M.Model.attr("String",{}),gpsBreitePosition:M.Model.attr("String",{}),gpsLaenge:M.Model.attr("String",{}),gpsLaengePosition:M.Model.attr("String",{}),handauftragsBezeichnung:M.Model.attr("String",{}),handauftragsId:M.Model.attr("String",
{}),mitarbeiterId:M.Model.attr("String",{}),name:M.Model.attr("String",{}),nameVorname:M.Model.attr("String",{}),positionsBezeichnung:M.Model.attr("String",{}),positionsId:M.Model.attr("String",{}),taetigkeit:M.Model.attr("String",{}),taetigkeitsId:M.Model.attr("String",{}),taetigkeitsart:M.Model.attr("String",{}),von:M.Model.attr("String",{}),vorname:M.Model.attr("String",{}),remark:M.Model.attr("String",{})},M.DataConsumer.configure({appendRecords:NO,responsePath:"zeitbuchungen",url:function(a,
b){var c="http://"+DigiWebApp.RequestController.DatabaseServer+"/WebAppServices/zeitdaten?modus=0&firmenId="+DigiWebApp.SettingsController.getSetting("company")+"&kennwort="+DigiWebApp.SettingsController.getSetting("password")+"&geraeteId="+DigiWebApp.SettingsController.getSetting("workerId")+"&geraeteTyp=2&softwareVersion="+DigiWebApp.RequestController.softwareVersion+"&mitarbeiterId="+b+"&datum="+a+"&requestTimestamp="+M.Date.now().date.valueOf();DigiWebApp.ApplicationController.profilingIntervalVar===
null&&console.log("Zeitbuchungen: using "+c);return c},map:function(a){if(a===null)return{auftragsBezeichnung:null,auftragsId:null,bis:null,datum:null,dauer:null,farbeAmpel:null,gpsBreite:null,gpsBreitePosition:null,gpsLaenge:null,gpsLaengePosition:null,handauftragsBezeichnung:null,handauftragsId:null,mitarbeiterId:null,name:null,nameVorname:null,positionsBezeichnung:null,positionsId:null,taetigkeit:null,taetigkeitsId:null,taetigkeitsart:null,von:null,vorname:null,remark:null};return{auftragsBezeichnung:a.auftragsBezeichnung,
auftragsId:a.auftragsId,bis:a.bis,datum:a.datum,dauer:a.dauer,farbeAmpel:a.farbeAmpel,gpsBreite:a.gpsBreite,gpsBreitePosition:a.gpsBreitePosition,gpsLaenge:a.gpsLaenge,gpsLaengePosition:a.gpsLaengePosition,handauftragsBezeichnung:a.handauftragsBezeichnung,handauftragsId:a.handauftragsId,mitarbeiterId:a.mitarbeiterId,name:a.name,nameVorname:a.nameVorname,positionsBezeichnung:a.positionsBezeichnung,positionsId:a.positionsId,taetigkeit:a.taetigkeit,taetigkeitsId:a.taetigkeitsId,taetigkeitsart:a.taetigkeitsart,
von:a.von,vorname:a.vorname,remark:a.bemerkung}}}));
DigiWebApp.ActivityListController=M.Controller.extend({items:null,itemsToUse:null,comboBoxToUpdate:null,latestId:null,init:function(){var a=this;a.items=[];_.each(a.itemsToUse,function(b){b.label!=M.I18N.l("selectSomething")&&a.items.push(b)});a.set("items",a.items)},itemSelected:function(a,b){try{DigiWebApp.ApplicationController.vibrate()}catch(c){}this.latestId&&$("#"+this.latestId).removeClass("selected");$("#"+a).addClass("selected");this.latestId=a;this.comboBoxToUpdate.setSelection(this.items[b].value);
DigiWebApp.BautagebuchZeitenDetailsPage.content.activityComboBox.events.change.action();history.back()}});
DigiWebApp.ApplicationController=M.Controller.extend({CONSTAudioFiletype:"audio/wav;base64",CONSTVideoFiletype:"video/mp4;base64",CONSTTextFiletype:"text/plain",getImageFiletype:function(){return"image/"+DigiWebApp.SettingsController.getSetting("pictureEncodingType").toLowerCase()+";base64"},CONSTApplicationQuota:20971520,CONSTVibrateDuration:100,myns:"ax21",dayNamesShort:[M.I18N.l("Sunday").substr(0,3),M.I18N.l("Monday").substr(0,3),M.I18N.l("Tuesday").substr(0,3),M.I18N.l("Wednesday").substr(0,
3),M.I18N.l("Thursday").substr(0,3),M.I18N.l("Friday").substr(0,3),M.I18N.l("Saturday").substr(0,3)],dayNames:[M.I18N.l("Sunday"),M.I18N.l("Monday"),M.I18N.l("Tuesday"),M.I18N.l("Wednesday"),M.I18N.l("Thursday"),M.I18N.l("Friday"),M.I18N.l("Saturday")],monthNamesShort:[M.I18N.l("january").substr(0,3),M.I18N.l("february").substr(0,3),M.I18N.l("march").substr(0,3),M.I18N.l("april").substr(0,3),M.I18N.l("may").substr(0,3),M.I18N.l("june").substr(0,3),M.I18N.l("july").substr(0,3),M.I18N.l("august").substr(0,
3),M.I18N.l("september").substr(0,3),M.I18N.l("october").substr(0,3),M.I18N.l("november").substr(0,3),M.I18N.l("december").substr(0,3)],monthNames:[M.I18N.l("january"),M.I18N.l("february"),M.I18N.l("march"),M.I18N.l("april"),M.I18N.l("may"),M.I18N.l("june"),M.I18N.l("july"),M.I18N.l("august"),M.I18N.l("september"),M.I18N.l("october"),M.I18N.l("november"),M.I18N.l("december")],closeAppAfterCloseDay:NO,bgGeo:null,restartApp:NO,activeFeaturesBeforeTransfer:[],syncStartTimestamp:null,syncStopTimestamp:null,
syncLastDuration:null,syncRunning:NO,savedUseTransitions:NO,triggerUpdate:NO,useSplashJustForFade:NO,makeUnselectable:function(){return null},blackBerryRestart_var:null,blackBerryRestart:function(){DigiWebApp.ApplicationController.blackBerryRestart_var!==null&&clearTimeout(DigiWebApp.ApplicationController.blackBerryRestart_var);DigiWebApp.app=M.Application.design(DigiWebAppOrdinaryDesign);DigiWebApp.app.main();DigiWebApp.ApplicationController.regSecEv(YES)},nativeAlertDialogView:function(a){DigiWebApp.ApplicationController.DigiLoaderView.hide();
M.Environment.getPlatform().substr(0,10);if(typeof a.confirmButtonValue==="undefined")a.confirmButtonValue="Ok";if(typeof a.title==="undefined")a.title="Alert";if(typeof a.message==="undefined")a.message="";var b=function(){};if(typeof a.callbacks!=="undefined")if(typeof a.callbacks.confirm.target===undefined)if(typeof a.callbacks.confirm.action==="function")b=a.callbacks.confirm.action;else trackError("ERROR: callback without target given but action is not a function!");else if(typeof a.callbacks.confirm.target===
"function")b=a.callbacks.confirm.target;else if(typeof a.callbacks.confirm.action==="string")b=a.callbacks.confirm.target[a.callbacks.confirm.action];else if(typeof a.callbacks.confirm.action==="function")b=a.callbacks.confirm.action;else trackError("ERROR: action is neither a string nor a function!");typeof navigator.notification==="undefined"?M.DialogView.alert(a):navigator.notification.alert(a.message,function(c){switch(c){case 0:b();break;case "0":b();break;case 1:b();break;case "1":b();break;
case 2:b();break;case "2":b();break;case a.confirmButtonValue:b();break;case "OK":b();break;default:alert('ERROR: yet unknown button "'+c+'" pressed.')}},a.title,a.confirmButtonValue)},nativeConfirmDialogView:function(a){DigiWebApp.ApplicationController.DigiLoaderView.hide();M.Environment.getPlatform().substr(0,10);if(typeof a.confirmButtonValue==="undefined")a.confirmButtonValue="Ok";if(typeof a.cancelButtonValue==="undefined")a.cancelButtonValue="Cancel";if(typeof a.title==="undefined")a.title=
"Confirm";if(typeof a.message==="undefined")a.message="";typeof navigator.notification==="undefined"?M.DialogView.confirm(a):navigator.notification.confirm(a.message,function(b){switch(b){case 0:a.callbacks.confirm.action();break;case 1:a.callbacks.confirm.action();break;case 2:a.callbacks.cancel.action();break;case "0":a.callbacks.confirm.action();break;case "1":a.callbacks.confirm.action();break;case "2":a.callbacks.cancel.action();break;case a.confirmButtonValue:a.callbacks.confirm.action();break;
case a.cancelButtonValue:a.callbacks.cancel.action();break;case "OK":a.callbacks.confirm.action();break;case "CANCEL":a.callbacks.cancel.action();break;default:alert('ERROR: yet unknown button "'+b+'" pressed.')}},a.title,[a.confirmButtonValue,a.cancelButtonValue])},DigiLoaderView:{loaderMessage:" ",loaderTitle:"",timeoutId:null,isVisible:function(){return M.LoaderView.refCount!==0},hide:function(){this.loaderMessage=" ";this.loaderTitle="";window.clearTimeout(this.timeoutId);this.timeoutId=null;
if(this.nativeLoaderAvailable()){navigator.notification.activityStop();return true}else return M.LoaderView.hide(true)},show:function(a,b,c){var d="";if(typeof c!="undefined")d=c;this.hide();if(DigiWebApp.SettingsController.getSetting("silentLoader")!==YES){this.loaderMessage=a;this.loaderTitle=d}else if(this.nativeLoaderAvailable())if(this.loaderMessage==" ")this.loaderMessage="";(a=b)||(a=DigiWebApp.SettingsController.getSetting("LoaderTimeOut"));window.clearTimeout(this.timeoutId);this.timeoutId=
window.setTimeout(a,this.hide);if(this.nativeLoaderAvailable())navigator.notification.activityStart(this.loaderTitle,this.loaderMessage);else return M.LoaderView.show(this.loaderMessage)},getTitle:function(){return this.nativeLoaderAvailable()?this.loaderTitle:this.loaderMessage},getMessage:function(){this.nativeLoaderAvailable();return this.loaderMessage},setTitle:function(a){return this.nativeLoaderAvailable()?this.show(this.loaderMessage,a):this.show(a)},setMessage:function(a){return this.nativeLoaderAvailable()?
this.show(a,this.loaderTitle):this.show(a)},changeTitle:function(a){return this.setTitle(a)},changeMessage:function(a){return this.setMessage(a)},nativeLoaderAvailable:function(){if(DigiWebApp.SettingsController.getSetting("useNativeLoader")==NO)return false;return typeof navigator=="undefined"||typeof navigator.notification=="undefined"||typeof navigator.notification.activityStart=="undefined"||typeof navigator.notification.activityStop=="undefined"?false:true}},DigiProgressView:{maxValue:100,currentValue:0,
shown:NO,minMaxVal:300,increase:function(a){if(!this.nativeProgressAvailable())return false;if(!this.shown)return false;this.currentValue+=typeof a!="undefined"?parseIntRadixTen(a):1;if(this.currentValue>this.maxValue)this.currentValue=this.maxValue;navigator.notification.progressValue(this.currentValue/this.maxValue*100)},decrease:function(a){if(!this.nativeProgressAvailable())return false;if(!this.shown)return false;this.currentValue-=typeof a!="undefined"?parseIntRadixTen(a):1;if(this.currentValue<
0)this.currentValue=0;navigator.notification.progressValue(this.currentValue/this.maxValue*100)},show:function(a,b,c,d){if(!this.nativeProgressAvailable())return false;if(typeof c!="undefined")this.maxValue=parseIntRadixTen(c);this.minMaxVal=parseIntRadixTen(DigiWebApp.SettingsController.getSetting("progressViewVerwendenAb"));if(c<this.minMaxVal)return true;if(this.maxValue<1)this.maxValue=1;this.shown=YES;navigator.notification.progressStart(a,b);if(typeof d!="undefined"){this.currentValue=parseIntRadixTen(d);
if(this.currentValue<0)this.currentValue=0;if(this.currentValue>this.maxValue)this.currentValue=this.maxValue;navigator.notification.progressValue(this.currentValue/this.maxValue*100)}},hide:function(){if(!this.nativeProgressAvailable())return false;this.maxV=100;this.currentV=0;this.shown=NO;navigator.notification.progressStop()},nativeProgressAvailable:function(){if(DigiWebApp.SettingsController.getSetting("silentLoader")==YES)return false;if(DigiWebApp.SettingsController.getSetting("useNativeLoader")==
NO)return false;return typeof navigator=="undefined"||typeof navigator.notification=="undefined"||typeof navigator.notification.progressStart=="undefined"||typeof navigator.notification.progressStop=="undefined"?false:true}},infoMsg:"",callbackStatus:null,storagePrefix:M.LOCAL_STORAGE_PREFIX+M.Application.name+M.LOCAL_STORAGE_SUFFIX,clickCounter:0,clickLimit:9,skipEvents:false,regSecEv:function(a){console.log(DigiWebApp.app.config.version);var b=this;setTimeout(function(){b.realregSecEv(a)},100)},
realregSecEv:function(a){DigiWebApp.ApplicationController.setImageClass();M.I18N.defaultLanguage="de_de";if(a){var b=this;a=M.ViewManager.getView("infoPage","logo");b.clickCounter=0;$("#"+a.id).bind("touchstart",function(){if(DigiWebApp.InfoPage.lastTimePageWasLoaded<+new Date-1E3){b.clickCounter++;if(b.clickCounter>b.clickLimit){b.clickCounter=0;b.showConfirmDialog()}}});$("#"+a.id).bind("mousedown",function(){if(DigiWebApp.InfoPage.lastTimePageWasLoaded<+new Date-1E3){b.clickCounter++;if(b.clickCounter>
b.clickLimit){b.clickCounter=0;b.showConfirmDialog()}}});if(M.Environment.getPlatform().substr(0,10)==="BlackBerry"){console.log("registering emergencyhandler");$(document).bind("keydown",DigiWebApp.ApplicationController.keydownHandler)}}_.each(DigiWebApp.app.pages,function(c){typeof c.header!=="undefined"&&$("#"+c.header.id).removeClass("fade")});$("[id="+DigiWebApp.TabBar.id+"]").each(function(){$(this).removeClass("fade")});this.setSkipEvents();if(this.skipEvents)this.devicereadyhandler();else if(typeof device===
"undefined"){DigiWebApp.ApplicationController.timeoutdeviceready_var=setTimeout("DigiWebApp.ApplicationController.timeoutdevicereadyhandler()",DigiWebApp.SettingsController.getSetting("startTimeout"));$(document).bind("deviceready",DigiWebApp.ApplicationController.devicereadyhandler)}else DigiWebApp.ApplicationController.devicereadyhandler()},setSkipEvents:function(){this.skipEvents=false},sizeMode:null,checkSizeModeChange:function(){if(this.sizeMode===null||this.timeouthappened)switch(true){case $(window).width()<
320:if(this.sizeMode!=="w320"){this.sizeMode="w320";return true}else return false;case $(window).width()>=320&&$(window).width()<480:if(this.sizeMode!=="w480"){this.sizeMode="w480";return true}else return false;case $(window).width()>=480&&$(window).width()<640:if(this.sizeMode!=="w640"){this.sizeMode="w640";return true}else return false;case $(window).width()>=640&&$(window).width()<800:if(this.sizeMode!=="w800"){this.sizeMode="w800";return true}else return false;case $(window).width()>=800&&$(window).width()<
1024:if(this.sizeMode!=="w1024"){this.sizeMode="w1024";return true}else return false;case $(window).width()>=1024&&$(window).width()<1080:if(this.sizeMode!=="w1080"){this.sizeMode="w1080";return true}else return false;case $(window).width()>=1080&&$(window).width()<1536:if(this.sizeMode!=="w1536"){this.sizeMode="w1536";return true}else return false;default:if(this.sizeMode!=="w5000"){this.sizeMode="w5000";return true}else return false}else return false},setImageClass:function(){if(M.Environment.getPlatform().substr(0,
10)==="BlackBerry")console.log("We are on BlackBerry, so we skip dynamic Background!");else this.checkSizeModeChange()&&_.each(DigiWebApp.app.pages,function(a){if($("#"+a.id).get("0").classList&&!$("#"+a.id).get("0").classList.contains(DigiWebApp.ApplicationController.sizeMode)||$("#"+a.id).get("0").className.split(" ").indexOf(DigiWebApp.ApplicationController.sizeMode)===-1)if(typeof DigiWebApp!="undefined")if(typeof DigiWebApp.SettingsController!="undefined")if(typeof DigiWebApp.SettingsController.getSetting("branding")!=
"undefined"&&DigiWebApp.SettingsController.getSetting("branding")!=""){var b=DigiWebApp.SettingsController.getSetting("branding").toUpperCase();$("body").classes(function(c){c.substring(c.length-8)==="branding"&&$("body").removeClass(c)});$("body").addClass(b+"branding");$("#"+a.id).removeClass("w320").removeClass("w480").removeClass("w640").removeClass("w800").removeClass("w1024").removeClass("w1080").removeClass("w1536").removeClass("w5000");$("#"+a.id).removeClass(b+"_w320").removeClass(b+"_w480").removeClass(b+
"_w640").removeClass(b+"_w800").removeClass(b+"_w1024").removeClass(b+"_w1080").removeClass(b+"_w1536").removeClass(b+"_w5000");$("#"+a.id).addClass(b+"_"+DigiWebApp.ApplicationController.sizeMode)}else{$("#"+a.id).removeClass("w320").removeClass("w480").removeClass("w640").removeClass("w800").removeClass("w1024").removeClass("w1080").removeClass("w1536").removeClass("w5000");$("#"+a.id).addClass(DigiWebApp.ApplicationController.sizeMode)}else{$("#"+a.id).removeClass("w320").removeClass("w480").removeClass("w640").removeClass("w800").removeClass("w1024").removeClass("w1080").removeClass("w1536").removeClass("w5000");
$("#"+a.id).addClass(DigiWebApp.ApplicationController.sizeMode)}else{$("#"+a.id).removeClass("w320").removeClass("w480").removeClass("w640").removeClass("w800").removeClass("w1024").removeClass("w1080").removeClass("w1536").removeClass("w5000");$("#"+a.id).addClass(DigiWebApp.ApplicationController.sizeMode)}})},timeoutdeviceready_var:null,timeouthappened:false,timeoutdevicereadyhandler:function(){DigiWebApp.ApplicationController.timeoutdeviceready_var!==null&&clearTimeout(DigiWebApp.ApplicationController.timeoutdeviceready_var);
DigiWebApp.ApplicationController.timeouthappened=true;var a='DIGI-WebApp hat Plattform "'+M.Environment.getPlatform()+'" ('+navigator.userAgent+") erkannt. Es werden keine Eventhandler registriert! (Version "+M.Application.getConfig("version")+")";console.log(a);if(typeof navigator.webkitPersistentStorage!=="undefined")window.requestFileSystem=window.requestFileSystem||window.webkitRequestFileSystem;this.devicereadyhandler()},emergencyCode:"007RESET007",emergencyStartedTimestamp:null,emergencyStringEntered:"",
keydownHandler:function(a){if(a.timeStamp-DigiWebApp.ApplicationController.emergencyStartedTimestamp>2E4){console.log("timeout: reset emergency-mechanism");DigiWebApp.ApplicationController.emergencyStartedTimestamp=a.timeStamp;DigiWebApp.ApplicationController.emergencyStringEntered=""}var b=DigiWebApp.ApplicationController.emergencyStringEntered.length,c=String.fromCharCode(a.which).toUpperCase();if(c===DigiWebApp.ApplicationController.emergencyCode.substr(b,1))DigiWebApp.ApplicationController.emergencyStringEntered+=
c;else{DigiWebApp.ApplicationController.emergencyStartedTimestamp=a.timeStamp;DigiWebApp.ApplicationController.emergencyStringEntered="";return true}if(DigiWebApp.ApplicationController.emergencyStringEntered===DigiWebApp.ApplicationController.emergencyCode){DigiWebApp.ApplicationController.emergencyStartedTimestamp=a.timeStamp;DigiWebApp.ApplicationController.emergencyStringEntered="";DigiWebApp.ApplicationController.showConfirmDialog()}return true},fixToobarsIntervalVar:null,notificationMessage:M.I18N.l("abwesend"),
notificationInitiated:NO,startNotification:function(){if(!onIOS&&!onAndroid23){this.notificationMessage=localStorage.getItem(DigiWebApp.ApplicationController.storagePrefix+"_notificationMessage");if(this.notificationMessage==null)this.notificationMessage=M.I18N.l("abwesend");var a=window.plugin;if(typeof a=="undefined")a=window.plugins;if(!this.notificationInitiated&&this.notificationMessage!=M.I18N.l("abwesend")){this.notificationInitiated=YES;try{a.notification.local.cancel("4711")}catch(b){}try{a.notification.local.cancel("4712")}catch(c){}DigiWebApp.BookingController.startBookingNotification()}if(typeof a==
"undefined"||typeof a.notification=="undefined"||typeof a.notification.local=="undefined")return false;try{a.notification.local.hasPermission(function(){});a.notification.local.promptForPermission()}catch(d){}try{try{window.plugin.notification.local.cancel("4711")}catch(e){}a.notification.local.add({id:"4711",message:this.notificationMessage,title:"DIGI-WebApp",sound:null,autoCancel:false,ongoing:true})}catch(f){trackError(f)}}},startBgGeo:function(){if(!onIOS&&!onAndroid23)try{var a=window.plugins;
if(typeof a=="undefined")a=window.plugin;if(typeof a=="undefined"||typeof a.backgroundGeoLocation=="undefined")return false;try{DigiWebApp.ApplicationController.bgGeo!=null&&DigiWebApp.ApplicationController.bgGeo.stop()}catch(b){}DigiWebApp.ApplicationController.bgGeo=a.backgroundGeoLocation;if(!DigiWebApp.SettingsController.getSetting("GPSBackgroundService"))return false;var c=parseIntRadixTen(DigiWebApp.SettingsController.getSetting("GPSmaximumAgeMinutes")*60);if(c==0)c=10;DigiWebApp.ApplicationController.bgGeo.configure(function(){bgGeo.finish()},
function(){},{desiredAccuracy:100,stationaryRadius:20,distanceFilter:30,locationTimeout:c,notificationTitle:M.I18N.l("GPSBackgroundServiceNotificationTitle"),notificationText:M.I18N.l("GPSBackgroundServiceNotificationMessage"),activityType:"AutomotiveNavigation",debug:false});DigiWebApp.ApplicationController.bgGeo.start()}catch(d){console.log("unable to enable backgroundGeoLocation")}},devicereadyhandler:function(){window.navigator.geolocation.getCurrentPosition(function(){});$(window).bind("resize",
function(){DigiWebApp.ApplicationController.setImageClass()});try{navigator.splashscreen.hide()}catch(a){console.log("unable to hide splashscreen")}try{StatusBar.show();StatusBar.overlaysWebView(false);StatusBar.styleLightContent()}catch(b){console.log("unable to modify StatusBar")}DigiWebApp.SettingsController.init(YES,YES);if(onIOS){try{$("[id="+DigiWebApp.SettingsPage.content.closeAppAfterCloseDay.id+"]").each(function(){$(this).hide()})}catch(c){}DigiWebApp.SettingsController.setSetting("closeAppAfterCloseDay",
NO)}if(onIOS||onAndroid23){try{$("[id="+DigiWebApp.SettingsPage.content.GPSBackgroundService.id+"]").each(function(){$(this).hide()})}catch(d){}DigiWebApp.SettingsController.setSetting("GPSBackgroundService",NO);try{$("[id="+DigiWebApp.SettingsPage.content.BookingReminderHoursGrid.id+"]").each(function(){$(this).hide()})}catch(e){}DigiWebApp.SettingsController.setSetting("BookingReminderHours",0)}else{DigiWebApp.ApplicationController.startBgGeo();DigiWebApp.ApplicationController.startNotification()}DigiWebApp.SettingsController.globalDebugMode=
DigiWebApp.SettingsController.getSetting("debug")?YES:NO;try{if(DigiWebApp.SettingsController.featureAvailable("417")){var f=[];DigiWebApp.ServiceAppController.listDirectory(function(i){f=[];_.each(i,function(h){if(h.search("DigiWebAppServiceApp.*.response.json")===0){DigiWebApp.SettingsController.getSetting("debug")&&console.log("delete "+h);f.push(h)}});DigiWebApp.ServiceAppController.deleteFilesInServiceApp(f,function(){DigiWebApp.ApplicationController.realDeviceReadyHandler()},function(){DigiWebApp.ApplicationController.realDeviceReadyHandler()})})}else DigiWebApp.ApplicationController.realDeviceReadyHandler()}catch(g){DigiWebApp.ApplicationController.realDeviceReadyHandler()}},
realDeviceReadyHandler:function(){writeToLog("DIGI-WebApp deviceReady "+(new Date).toString());DigiWebApp.ApplicationController.DigiLoaderView.hide();try{navigator.splashscreen.hide()}catch(a){console.log("unable to hide splashscreen")}if(M.Environment.getPlatform().substr(0,10)==="BlackBerry"){_.each(DigiWebApp.app.pages,function(b){typeof b.header!=="undefined"&&$("#"+b.header.id).removeClass("ui-header-fixed")});$("[id="+DigiWebApp.TabBar.id+"]").each(function(){$(this).removeClass("ui-footer-fixed")})}DigiWebApp.ApplicationController.timeoutdeviceready_var!==
null&&clearTimeout(DigiWebApp.ApplicationController.timeoutdeviceready_var);DigiWebApp.ApplicationController.setImageClass();DigiWebApp.ApplicationController.init(true);if(this.skipEvents!==true||M.Environment.getPlatform().substr(0,10)==="BlackBerry"&&DigiWebApp.ApplicationController.timeouthappened!==true){$(document).bind("backbutton",DigiWebApp.ApplicationController.backbuttonhandler);$(document).bind("menubutton",DigiWebApp.ApplicationController.menubuttonhandler)}},inAppBrowser_var:null,closeChildbrowser:function(){try{plugins.childBrowser.close()}catch(a){}try{DigiWebApp.ApplicationController.inAppBrowser_var.close()}catch(b){}},
backButtonTimeoutVar:null,backbuttonhandler:function(){var a=DigiWebApp.SettingsController.featureAvailable("409");if(!DigiWebApp.SettingsController.showCredentialsAlert)if(DigiWebApp.TabBar.tabItem1.isActive||a&&M.ViewManager.getCurrentPage().get("id")===DigiWebApp.DashboardPage.get("id"))typeof navigator.app!=="undefined"&&DigiWebApp.ApplicationController.nativeConfirmDialogView({title:M.I18N.l("quitQuestion"),message:M.I18N.l("quitQuestionMsg"),confirmButtonValue:M.I18N.l("yes"),cancelButtonValue:M.I18N.l("no"),
callbacks:{confirm:{target:this,action:function(){DigiWebApp.ApplicationController.exitApp()}},cancel:{target:this,action:function(){}}}});else DigiWebApp.ApplicationController.backButtonTimeoutVar=setTimeout("DigiWebApp.ApplicationController.backButtonToBookTimePage()",500)},registerButtonHandlerByTimeoutVar:null,registerButtonHandlerByTimeout:function(){if(M.Environment.getPlatform().substr(0,10)==="BlackBerry"&&DigiWebApp.ApplicationController.timeouthappened!==true){console.log("registering buttonhandler again on blackberry");
$(document).bind("backbutton",DigiWebApp.ApplicationController.backbuttonhandler);$(document).bind("menubutton",DigiWebApp.ApplicationController.menubuttonhandler)}clearTimeout(DigiWebApp.ApplicationController.registerButtonHandlerByTimeoutVar)},backButtonToBookTimePage:function(){clearTimeout(DigiWebApp.ApplicationController.backButtonTimeoutVar);if(DigiWebApp.SettingsController.featureAvailable("409"))DigiWebApp.SettingsController.featureAvailable("404")?DigiWebApp.NavigationController.toButtonDashboardPageFlipTransition():
DigiWebApp.NavigationController.toDashboardPageFlipTransition();else DigiWebApp.NavigationController.toBookTimePageFlipTransition()},menubuttonhandler:function(){DigiWebApp.SettingsController.showCredentialsAlert||(DigiWebApp.SettingsController.featureAvailable("404")?DigiWebApp.NavigationController.backToButtonDashboardPageFlipTransition():DigiWebApp.NavigationController.backToDashboardPageFlipTransition())},showConfirmDialog:function(){var a=this;DigiWebApp.ApplicationController.nativeConfirmDialogView({title:M.I18N.l("secretQuestion"),
message:M.I18N.l("secretQuestionMsg"),confirmButtonValue:M.I18N.l("yes"),cancelButtonValue:M.I18N.l("no"),callbacks:{confirm:{target:this,action:function(){var b=function(c,d,e,f){writeToLog("DIGI-WebApp wird zur\u00fcckgesetzt");DigiWebApp.SettingsController.credentialsAlertShown=false;DigiWebApp.ApplicationController.deleteAllData();DigiWebApp.BookingController.currentBooking=null;typeof DigiWebAppOrdinaryDesign.bookingPageWithIconsScholpp!=="undefined"?$("#"+DigiWebApp.BookingPageWithIconsScholpp.content.currentBookingLabel.id).html(""):
$("#"+DigiWebApp.BookingPage.content.currentBookingLabel.id).html("");DigiWebApp.SettingsController.showIOSMessage=false;if(c!==null&&d!==null&&e!==null&&f!==null){writeToLog("Zugangsdaten blieben erhalten");DigiWebApp.SettingsController.init(YES);DigiWebApp.SettingsController.setSetting("company",c);DigiWebApp.SettingsController.setSetting("password",d);DigiWebApp.SettingsController.setSetting("connectionCode",e);DigiWebApp.SettingsController.setSetting("workerId",f)}DigiWebApp.ApplicationController.init(true)};
DigiWebApp.ApplicationController.nativeConfirmDialogView({title:M.I18N.l("keepCredentials"),message:M.I18N.l("keepCredentialsMsg"),confirmButtonValue:M.I18N.l("yes"),cancelButtonValue:M.I18N.l("no"),callbacks:{confirm:{target:this,action:function(){var c=DigiWebApp.SettingsController.getSetting("company"),d=DigiWebApp.SettingsController.getSetting("password"),e=DigiWebApp.SettingsController.getSetting("connectionCode"),f=DigiWebApp.SettingsController.getSetting("workerId");b(c,d,e,f)}},cancel:{target:this,
action:function(){b(null,null,null,null)}}}})}},cancel:{target:this,action:function(){a.clickCounter=0}}}})},setTransitionsSetting:function(){var a="0";if(typeof device!=="undefined")a=new String(device.version);var b="";if(typeof device!=="undefined")b=new String(device.platform);var c=M.Environment.getPlatform();M.Application.config.useTransitions=c.substr(-2)==="86"||c.substr(-3)==="_64"||c.substr(-5)==="Win32"||c.substr(-5)==="Win64"||c.substr(0,3)==="Mac"||c.substr(0,6)==="iPhone"||c.substr(0,
4)==="iPad"||a.substr(0,1)>=4&&b.substr(0,7)>="Android"?DigiWebApp.SettingsController.getSetting("useTransitionsSetting")&&!DigiWebApp.SettingsController.featureAvailable("404"):NO},init:function(){DigiWebApp.TabBar.tabItem1.internalEvents.tap.action=function(){this.page?M.Controller.switchToTab(this,YES):this.parentView.setActiveTab(this)};DigiWebApp.TabBar.tabItem2.internalEvents.tap.action=function(){this.page?M.Controller.switchToTab(this,NO):this.parentView.setActiveTab(this)};DigiWebApp.ApplicationController.callbackStatus=
{position:{remote:NO,local:NO},activity:{remote:NO,local:NO},order:{remote:NO,local:NO},workPlan:{remote:NO,local:NO},handOrder:{remote:NO,local:NO},kolonne:{remote:NO,local:NO},features:{remote:NO,local:NO}};DigiWebApp.SettingsController.init(YES,YES);DigiWebApp.SettingsController.globalDebugMode=DigiWebApp.SettingsController.getSetting("debug")?YES:NO;DigiWebApp.ApplicationController.setTransitionsSetting();var a=function(){var d=DigiWebApp.Booking.find();if(d.length>0){for(var e=NO,f=0;f<d.length;f++)if(d[f].get("isCurrent")===
YES){e=YES;break}if(e===YES){DigiWebApp.NavigationController.toBookTimePage();parseBool(DigiWebApp.SettingsController.getSetting("stammdatenabgleichBeimAppStart"))&&DigiWebApp.BookingController.sendBookings(NO,YES)}else{DigiWebApp.NavigationController.toBookTimePage();DigiWebApp.BookingController.sendBookings(NO,YES)}}else if(DigiWebApp.SettingsController.featureAvailable("402")&&!DigiWebApp.BookingController.currentBooking||DigiWebApp.SettingsController.featureAvailable("426")&&!DigiWebApp.BookingController.currentBooking)DigiWebApp.BautagebuchDatenuebertragungController.ausgekoppelteSenden(function(){DigiWebApp.NavigationController.toBookTimePage();
DigiWebApp.ApplicationController.startsync()});else{DigiWebApp.NavigationController.toBookTimePage();DigiWebApp.ApplicationController.startsync()}},b=DigiWebApp.SettingsController.getSetting("company"),c=DigiWebApp.SettingsController.getSetting("password");if(!b||!c){DigiWebApp.NavigationController.toBookTimePage(YES);DigiWebApp.SettingsController.showCredentialsAlert=YES;DigiWebApp.NavigationController.toSettingsPage(YES)}else DigiWebApp.ApplicationController.updateModels(a)},enforceChefToolOnly:function(){var a=
DigiWebApp.SettingsController.showCredentialsAlert,b=DigiWebApp.SettingsController.featureAvailable("409");if(DigiWebApp.SettingsController.featureAvailable("417")){try{$("[id="+DigiWebApp.SettingsPage.content.ServiceApp_ermittleGeokoordinate.id+"]").each(function(){$(this).show()})}catch(c){}try{$("[id="+DigiWebApp.SettingsPage.content.ServiceApp_datenUebertragen.id+"]").each(function(){$(this).show()})}catch(d){}try{$("[id="+DigiWebApp.SettingsPage.content.ServiceApp_engeKopplung.id+"]").each(function(){$(this).show()})}catch(e){}try{$("[id="+
DigiWebApp.SettingsPage.content.ServiceApp_PORTGrid.id+"]").each(function(){$(this).show()})}catch(f){}try{$("[id="+DigiWebApp.SettingsPage.content.ServiceApp_FallBack.id+"]").each(function(){$(this).show()})}catch(g){}}else{try{$("[id="+DigiWebApp.SettingsPage.content.ServiceApp_ermittleGeokoordinate.id+"]").each(function(){$(this).hide()})}catch(i){}try{$("[id="+DigiWebApp.SettingsPage.content.ServiceApp_datenUebertragen.id+"]").each(function(){$(this).hide()})}catch(h){}try{$("[id="+DigiWebApp.SettingsPage.content.ServiceApp_engeKopplung.id+
"]").each(function(){$(this).hide()})}catch(j){}try{$("[id="+DigiWebApp.SettingsPage.content.ServiceApp_PORTGrid.id+"]").each(function(){$(this).hide()})}catch(l){}try{$("[id="+DigiWebApp.SettingsPage.content.ServiceApp_FallBack.id+"]").each(function(){$(this).hide()})}catch(n){}}if(b||a){try{$("[id="+DigiWebApp.TabBar.id+"]").each(function(){$(this).hide()})}catch(m){}try{$("[id="+DigiWebApp.SettingsPage.content.autoTransferAfterBookTimeCheck.id+"]").each(function(){$(this).hide()})}catch(o){}try{$("[id="+
DigiWebApp.SettingsPage.content.autoTransferAfterClosingDayCheck.id+"]").each(function(){$(this).hide()})}catch(p){}try{$("[id="+DigiWebApp.SettingsPage.content.autoSyncAfterBookTimeCheck.id+"]").each(function(){$(this).hide()})}catch(q){}try{$("[id="+DigiWebApp.SettingsPage.content.stammdatenabgleichBeimAppStartCheck.id+"]").each(function(){$(this).hide()})}catch(r){}try{$("[id="+DigiWebApp.SettingsPage.content.remarkIsMandatory.id+"]").each(function(){$(this).hide()})}catch(s){}try{$("[id="+DigiWebApp.SettingsPage.content.autoSaveGPSData.id+
"]").each(function(){$(this).hide()})}catch(u){}try{$("[id="+DigiWebApp.SettingsPage.content.daysToHoldBookingsOnDeviceSliderContainer.id+"]").each(function(){$(this).hide()})}catch(t){}try{$("[id="+DigiWebApp.SettingsPage.content.auftragsDetailsKoppeln.id+"]").each(function(){$(this).hide()})}catch(v){}try{$("[id="+DigiWebApp.SettingsPage.content.detailierteZeitdaten.id+"]").each(function(){$(this).hide()})}catch(x){}try{$("[id="+DigiWebApp.SettingsPage.content.vibrationsDauerSliderContainer.id+
"]").each(function(){$(this).hide()})}catch(B){}try{$("[id="+DigiWebApp.SettingsPage.content.GPSenableHighAccuracy.id+"]").each(function(){$(this).hide()})}catch(z){}try{$("[id="+DigiWebApp.SettingsPage.content.GPSenableHighAccuracyFallback.id+"]").each(function(){$(this).hide()})}catch(D){}try{$("[id="+DigiWebApp.SettingsPage.content.GPSmaximumAgeMinutesGrid.id+"]").each(function(){$(this).hide()})}catch(y){}try{$("[id="+DigiWebApp.SettingsPage.content.GPSBackgroundService.id+"]").each(function(){$(this).hide()})}catch(E){}try{$("[id="+
DigiWebApp.SettingsPage.content.BookingReminderHoursGrid.id+"]").each(function(){$(this).hide()})}catch(A){}try{$("[id="+DigiWebApp.SettingsPage.content.closeAppAfterCloseDay.id+"]").each(function(){$(this).hide()})}catch(F){}}else{try{$("[id="+DigiWebApp.TabBar.id+"]").each(function(){$(this).show()})}catch(C){}try{$("[id="+DigiWebApp.SettingsPage.content.detailierteZeitdaten.id+"]").each(function(){$(this).show()})}catch(w){}try{$("[id="+DigiWebApp.SettingsPage.content.autoTransferAfterBookTimeCheck.id+
"]").each(function(){$(this).show()})}catch(G){}try{$("[id="+DigiWebApp.SettingsPage.content.autoTransferAfterClosingDayCheck.id+"]").each(function(){$(this).show()})}catch(K){}try{$("[id="+DigiWebApp.SettingsPage.content.autoSyncAfterBookTimeCheck.id+"]").each(function(){$(this).show()})}catch(W){}try{$("[id="+DigiWebApp.SettingsPage.content.stammdatenabgleichBeimAppStartCheck.id+"]").each(function(){$(this).show()})}catch(H){}if(DigiWebApp.SettingsController.featureAvailable("403"))try{$("[id="+
DigiWebApp.SettingsPage.content.remarkIsMandatory.id+"]").each(function(){$(this).show()})}catch(S){}try{$("[id="+DigiWebApp.SettingsPage.content.autoSaveGPSData.id+"]").each(function(){$(this).show()})}catch(I){}if(DigiWebApp.SettingsController.featureAvailable("411"))try{$("[id="+DigiWebApp.SettingsPage.content.daysToHoldBookingsOnDeviceSliderContainer.id+"]").each(function(){$(this).show()})}catch(T){}if(DigiWebApp.SettingsController.featureAvailable("406"))try{$("[id="+DigiWebApp.SettingsPage.content.auftragsDetailsKoppeln.id+
"]").each(function(){$(this).show()})}catch(J){}try{$("[id="+DigiWebApp.SettingsPage.content.vibrationsDauerSliderContainer.id+"]").each(function(){$(this).show()})}catch(X){}try{$("[id="+DigiWebApp.SettingsPage.content.GPSenableHighAccuracy.id+"]").each(function(){$(this).show()})}catch(L){}try{$("[id="+DigiWebApp.SettingsPage.content.GPSenableHighAccuracyFallback.id+"]").each(function(){$(this).show()})}catch(Y){}try{$("[id="+DigiWebApp.SettingsPage.content.GPSmaximumAgeMinutesGrid.id+"]").each(function(){$(this).show()})}catch(N){}try{$("[id="+
DigiWebApp.SettingsPage.content.GPSBackgroundService.id+"]").each(function(){$(this).show()})}catch(Z){}try{$("[id="+DigiWebApp.SettingsPage.content.BookingReminderHoursGrid.id+"]").each(function(){$(this).show()})}catch(O){}try{$("[id="+DigiWebApp.SettingsPage.content.closeAppAfterCloseDay.id+"]").each(function(){$(this).show()})}catch(aa){}}},startsync:function(){writeToLog("startsync");DigiWebApp.ApplicationController.syncStartTimestamp=D8.now().getTimestamp();var a=DigiWebApp.SettingsController.getSetting("company"),
b=DigiWebApp.SettingsController.getSetting("password");if(!a||!b){DigiWebApp.NavigationController.toBookTimePage(YES);DigiWebApp.SettingsController.showCredentialsAlert=YES;DigiWebApp.NavigationController.toSettingsPage(YES)}else{M.Application.config.useTransitions=NO;DigiWebApp.ApplicationController.syncRunning=YES;a=function(){DigiWebApp.SettingsController.sendConfiguration()};b=!DigiWebApp.BookingController.currentBooking;var c=_.filter(DigiWebApp.Sonderbuchung.find(),function(d){return!parseBool(d.get("uebertragen"))});
DigiWebApp.JSONDatenuebertragungController.sendeSonderbuchungen(c,a,a,b)}},connectionError:function(){DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("connectionError"),message:M.I18N.l("connectionErrorMsg"),callbacks:{confirm:{target:this,action:"proceedWithLocalData"}}})},proceedWithLocalData:function(a){var b=DigiWebApp.ApplicationController;b.enforceChefToolOnly();var c=DigiWebApp.SettingsController.featureAvailable("409");if(c){a=DigiWebApp.SettingsController.featureAvailable("412");
if((c=DigiWebApp.SettingsController.featureAvailable("409"))&&a)DigiWebApp.NavigationController.startBautagebuch();else DigiWebApp.SettingsController.featureAvailable("404")?DigiWebApp.NavigationController.toButtonDashboardPage():DigiWebApp.NavigationController.toDashboardPage()}else{DigiWebApp.Order.findSorted().length>0&&b.setCallbackStatus("order","local",YES);DigiWebApp.Position.findSorted().length>0&&b.setCallbackStatus("position","local",YES);DigiWebApp.Activity.findSorted().length>0&&b.setCallbackStatus("activity",
"local",YES);DigiWebApp.Features.find().length>0&&b.setCallbackStatus("features","local",YES);DigiWebApp.SettingsController.globalDebugMode&&DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("offlineWork"),message:a});if(b.isReadyToProceed()){DigiWebApp.NavigationController.toBookTimePage(YES);DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("offlineWork"),message:M.I18N.l("offlineWorkMsg")})}else{a=DigiWebApp.SettingsController.featureAvailable("412");if((c=
DigiWebApp.SettingsController.featureAvailable("409"))&&a)DigiWebApp.NavigationController.startBautagebuch();else DigiWebApp.SettingsController.featureAvailable("404")?DigiWebApp.NavigationController.toButtonDashboardPage():DigiWebApp.NavigationController.toDashboardPage();DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("offlineWorkNotPossible"),message:M.I18N.l("offlineWorkNotPossibleMsg")})}}},authenticate:function(){DigiWebApp.RequestController.authenticate({success:{target:this,
action:"authenticateSuccess"},error:{target:this,action:function(){trackError("authenticate-error");this.proceedWithLocalData("authenticate")}}})},timestampMitarbeiterZuletztGeladen:null,authenticateSuccess:function(a){if(typeof a["return"]==="undefined"&&typeof a["ns:return"]!=="undefined")a["return"]=a["ns:return"];switch(a["return"]){case "1":DigiWebApp.ApplicationController.activeFeaturesBeforeTransfer=[];_.each(DigiWebApp.Features.find(),function(b){b.get("isAvailable")==="true"&&DigiWebApp.ApplicationController.activeFeaturesBeforeTransfer.push(b.get("id"))});
DigiWebApp.Features.deleteAll();this.setCallbackStatus("features","local",NO);DigiWebApp.ApplicationController.triggerUpdate=YES;DigiWebApp.DashboardController.init(YES);DigiWebApp.MediaListController.init(YES);a=D8.now().getTimestamp();DigiWebApp.ApplicationController.timestampMitarbeiterZuletztGeladen===null||a-DigiWebApp.ApplicationController.timestampMitarbeiterZuletztGeladen>6E4?writeToLog("aktualisiere Mitarbeiter des Benutzers nach authenticate",function(){var b={webservice:"mitarbeiter",loaderText:M.I18N.l("BautagebuchLadeMitarbeiter"),
successCallback:function(c){if(c&&c.mitarbeiter&&c.mitarbeiter.length>0){DigiWebApp.SettingsController.setSetting("mitarbeiterVorname",c.mitarbeiter[0].vorname);DigiWebApp.SettingsController.setSetting("mitarbeiterNachname",c.mitarbeiter[0].nachname);DigiWebApp.SettingsController.setSetting("mitarbeiterId",c.mitarbeiter[0].mitarbeiterId)}DigiWebApp.ApplicationController.timestampMitarbeiterZuletztGeladen=D8.now().getTimestamp();DigiWebApp.ApplicationController.getFeaturesFromRemote()},errorCallback:function(){DigiWebApp.ApplicationController.DigiLoaderView.hide();
DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("offlineWorkNotPossible"),message:M.I18N.l("offlineWorkNotPossibleMsg")})},additionalQueryParameter:"getAll=true&webAppId="+DigiWebApp.SettingsController.getSetting("workerId"),geraeteIdOverride:true};DigiWebApp.JSONDatenuebertragungController.recieveData(b)}):DigiWebApp.ApplicationController.getFeaturesFromRemote();DigiWebApp.ApplicationController.enforceChefToolOnly();break;case "2":DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("authenticationError2"),
message:M.I18N.l("authenticationErrorMsg2")});DigiWebApp.NavigationController.toSettingsPage(YES);break;case "3":DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("authenticationError3"),message:M.I18N.l("authenticationErrorMsg3")});DigiWebApp.NavigationController.toSettingsPage(YES);break;default:DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("authenticationError"),message:M.I18N.l("authenticationErrorMsg")});DigiWebApp.NavigationController.toSettingsPage(YES)}},
getOrdersFromRemote:function(){DigiWebApp.RequestController.getOrders({success:{target:this,action:function(a,b,c){this.getOrdersFromRemoteSuccess(a,b,c)===true?this.getPositionsFromRemote():DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("noOrdersAvailable"),message:M.I18N.l("noOrdersAvailableMsg")})}},error:{target:this,action:function(){trackError("getOrdersFromRemote-error");this.proceedWithLocalData("getOrdersFromRemote")}}})},getOrdersFromRemoteSuccess:function(a){if(typeof a["return"]===
"undefined"&&typeof a["ns:return"]!=="undefined"){a["return"]=a["ns:return"];try{var b=this.myns=a["return"][0]["xsi:type"].split(":")[0];_.each(a["return"],function(f){f.auftragsId=f[b+":auftragsId"];f.auftragsBezeichnung=f[b+":auftragsBezeichnung"]})}catch(c){}}if(a["return"]){this.setCallbackStatus("order","remote",YES);DigiWebApp.Order.deleteAll();this.setCallbackStatus("order","local",NO);var d=[],e=null;if(_.isObject(a["return"])&&!_.isArray(a["return"]))a["return"]=[a["return"]];_.each(a["return"],
function(f){e=DigiWebApp.Order.createRecord({id:f.auftragsId,name:f.auftragsBezeichnung});try{e.save();d.push(e.m_id)}catch(g){trackError(g)}});localStorage.setItem(this.storagePrefix+"_orderKeys",JSON.stringify(d));this.setCallbackStatus("order","local",YES);return true}else return false},getPositionsFromRemote:function(){var a=this;a.setCallbackStatus("position","local",NO);DigiWebApp.JSONDatenuebertragungController.empfangePositionen(function(){a.setCallbackStatus("position","remote",YES);a.setCallbackStatus("position",
"local",DigiWebApp.Position.find().length>0);a.setCallbackStatus("order","remote",YES);a.setCallbackStatus("order","local",DigiWebApp.Order.find().length>0);a.getActivitiesFromRemote()},function(){a.setCallbackStatus("position","remote",NO);a.setCallbackStatus("order","remote",NO);a.proceedWithLocalData("getPositionsFromRemote")})},getActivitiesFromRemote:function(){var a=this;a.setCallbackStatus("activity","local",NO);DigiWebApp.JSONDatenuebertragungController.empfangeTaetigkeiten(function(){a.setCallbackStatus("activity",
"remote",YES);a.setCallbackStatus("activity","local",DigiWebApp.Activity.find().length>0);a.getWorkPlansFromRemote()},function(){a.setCallbackStatus("activity","remote",NO);a.proceedWithLocalData("getActivitiesFromRemote")})},getWorkPlansFromRemote:function(){var a=DigiWebApp.ApplicationController;DigiWebApp.RequestController.getWorkPlans({success:{target:a,action:function(b,c,d){a.getWorkPlansFromRemoteSuccess(b,c,d);a.getHandOrdersFromRemote()}},error:{target:a,action:function(){trackError("getWorkPlansFromRemote-error");
a.proceedWithLocalData("getWorkPlansFromRemote")}}})},getWorkPlansFromRemoteSuccess:function(a){if(typeof a["return"]==="undefined"&&typeof a["ns:return"]!=="undefined"){a["return"]=a["ns:return"];try{var b=this.myns;_.each(a["return"],function(d){d.arbeitsplanId=d[b+":arbeitsplanId"];d.positionen=d[b+":positionen"];d.taetigkeitsIds=d[b+":taetigkeitsIds"];d.arbeitsplanTyp=d[b+":arbeitsplanTyp"]})}catch(c){}}if(a["return"]){this.setCallbackStatus("workPlan","remote",YES);DigiWebApp.WorkPlan.deleteAll();
this.setCallbackStatus("workPlan","local",NO);DigiWebApp.ApplicationController.DigiProgressView.show(M.I18N.l("Save"),M.I18N.l("workplans"),a["return"].length,0);_.each(a["return"],function(d){DigiWebApp.WorkPlan.createRecord({id:d.arbeitsplanId,workplanType:d.arbeitsplanTyp,activityPositions:d.positionen.join(","),activityIds:d.taetigkeitsIds.join(",")}).save();DigiWebApp.ApplicationController.DigiProgressView.increase()});DigiWebApp.ApplicationController.DigiProgressView.hide();this.setCallbackStatus("workPlan",
"local",YES)}},getHandOrdersFromRemote:function(){DigiWebApp.RequestController.getHandOrders({success:{target:this,action:function(a,b,c){this.getHandOrdersFromRemoteSuccess(a,b,c);this.getKolonneFromRemote()}},error:{target:this,action:function(){trackError("getHandOrdersFromRemote-error");this.proceedWithLocalData("getHandOrdersFromRemote")}}})},getHandOrdersFromRemoteSuccess:function(a){if(typeof a["return"]==="undefined"&&typeof a["ns:return"]!=="undefined"){a["return"]=a["ns:return"];try{var b=
this.myns;_.each(a["return"],function(f){f.handauftragsId=f[b+":handauftragsId"];f.handauftragsBezeichnung=f[b+":handauftragsBezeichnung"]})}catch(c){}}if(a["return"]){this.setCallbackStatus("handOrder","remote",YES);DigiWebApp.HandOrder.deleteAll();this.setCallbackStatus("handOrder","local",NO);if(typeof a["return"]==="object"&&!_.isArray(a["return"]))a["return"]=[a["return"]];var d=[],e=null;if(_.isObject(a["return"])&&!_.isArray(a["return"]))a["return"]=[a["return"]];DigiWebApp.ApplicationController.DigiProgressView.show(M.I18N.l("Save"),
M.I18N.l("handorders"),a["return"].length,0);_.each(a["return"],function(f){if(DigiWebApp.HandOrder.find({query:{identifier:"id",operator:"=",value:f.handauftragsId}}).length===0&&DigiWebApp.HandOrder.find({query:{identifier:"name",operator:"=",value:f.handauftragsBezeichnung}}).length===0)e=DigiWebApp.HandOrder.createRecord({id:f.handauftragsId,name:f.handauftragsBezeichnung,isLocalOnly:NO});else if(DigiWebApp.HandOrder.find({query:{identifier:"id",operator:"=",value:f.handauftragsId}}).length!==
0){e=DigiWebApp.HandOrder.find({query:{identifier:"id",operator:"=",value:f.handauftragsId}})[0];e.set("id",f.handauftragsId);e.set("name",f.handauftragsBezeichnung);e.set("isLocalOnly",NO)}else if(DigiWebApp.HandOrder.find({query:{identifier:"name",operator:"=",value:f.handauftragsBezeichnung}}).length!==0){e=DigiWebApp.HandOrder.find({query:{identifier:"name",operator:"=",value:f.handauftragsBezeichnung}})[0];e.set("id",f.handauftragsId);e.set("name",f.handauftragsBezeichnung);e.set("isLocalOnly",
NO)}try{e.save();d.push(e.m_id);_.each(DigiWebApp.Booking.find(),function(i){if(i.get("handOrderId")!==null&&i.get("handOrderId")===f.handauftragsBezeichnung){i.set("handOrderId",f.handauftragsId);i.save()}})}catch(g){trackError(g)}DigiWebApp.ApplicationController.DigiProgressView.increase()});a=_.select(DigiWebApp.HandOrder.findSorted(),function(f){if(f)return f.get("isLocalOnly")===YES});_.each(a,function(f){d.push(f.m_id)});localStorage.setItem(this.storagePrefix+"_handorderKeys",JSON.stringify(d));
DigiWebApp.ApplicationController.DigiProgressView.hide();this.setCallbackStatus("handOrder","local",YES)}else{this.setCallbackStatus("handOrder","remote",NO);DigiWebApp.HandOrder.deleteAll();DigiWebApp.ApplicationController.DigiProgressView.hide();this.setCallbackStatus("handOrder","local",NO)}},getFeaturesFromRemote:function(){DigiWebApp.RequestController.getFeatures({success:{target:this,action:function(a,b,c){this.getFeaturesFromRemoteSuccess(a,b,c);a=DigiWebApp.SettingsController.featureAvailable("409");
b=DigiWebApp.SettingsController.featureAvailable("412");a&&!b?this.endSession():this.getPositionsFromRemote()}},error:{target:this,action:function(){trackError("getFeaturesFromRemote-error");this.getPositionsFromRemote()}}})},getFeaturesFromRemoteSuccess:function(a){if(a)if(typeof a["return"]==="undefined"&&typeof a["ns:return"]!=="undefined"){a["return"]=a["ns:return"];try{var b=this.myns;_.each(a["return"],function(e){e.keyId=e[b+":keyId"];e.value=e[b+":value"]})}catch(c){}}if(a&&a["return"]){this.setCallbackStatus("features",
"remote",YES);if(_.isObject(a["return"])&&!_.isArray(a["return"]))a["return"]=[a["return"]];DigiWebApp.ApplicationController.DigiProgressView.show(M.I18N.l("Save"),M.I18N.l("features"),a["return"].length,0);DigiWebApp.SettingsController.setSetting("treatAllAsTablet",DigiWebApp.SettingsController.defaultsettings.get("treatAllAsTablet"));DigiWebApp.SettingsController.setSetting("treatAllAsPhone",DigiWebApp.SettingsController.defaultsettings.get("treatAllAsPhone"));DigiWebApp.SettingsController.setSetting("settingsPassword",
DigiWebApp.SettingsController.defaultsettings.get("settingsPassword"));var d=DigiWebApp.SettingsController.getSetting("branding");DigiWebApp.SettingsController.setSetting("branding",DigiWebApp.SettingsController.defaultsettings.get("branding"));DigiWebApp.SettingsController.setSetting("silentLoader",DigiWebApp.SettingsController.defaultsettings.get("silentLoader"));DigiWebApp.SettingsController.setSetting("mapType",DigiWebApp.SettingsController.defaultsettings.get("mapType"));DigiWebApp.SettingsController.setSetting("datatransfer_min_delay",
DigiWebApp.SettingsController.defaultsettings.get("datatransfer_min_delay"));DigiWebApp.SettingsController.setSetting("GPSTimeOut",DigiWebApp.SettingsController.defaultsettings.get("GPSTimeOut"));DigiWebApp.SettingsController.setSetting("WebserviceTimeOut",DigiWebApp.SettingsController.defaultsettings.get("WebserviceTimeOut"));DigiWebApp.SettingsController.setSetting("LoaderTimeOut",DigiWebApp.SettingsController.defaultsettings.get("LoaderTimeOut"));DigiWebApp.SettingsController.setSetting("debugDatabaseServer",
DigiWebApp.SettingsController.defaultsettings.get("debugDatabaseServer"));DigiWebApp.ApplicationController.triggerUpdate=NO;_.each(a["return"],function(e){DigiWebApp.ApplicationController.DigiProgressView.increase();var f="";if(typeof e.valueType==="undefined")f=DigiWebApp.ApplicationController.myns+":";if(e[f+"valueType"]==="Setting_WebApp"){var g=e[f+"value"];if(g==="false"||g==="true")g=g==="true";DigiWebApp.SettingsController.setSetting(e[f+"keyId"],g)}else if(e[f+"valueType"]==="Feature"){DigiWebApp.Features.createRecord({id:e[f+
"keyId"],name:e[f+"keyId"],isAvailable:e[f+"value"]}).save();var i=NO;_.each(DigiWebApp.ApplicationController.activeFeaturesBeforeTransfer,function(h){if(e[f+"keyId"]===h)i=YES});if(e[f+"value"]==="true"&&!i||e[f+"value"]==="false"&&i){if(e[f+"keyId"]==="400")DigiWebApp.ApplicationController.restartApp=YES;if(e[f+"keyId"]==="401")DigiWebApp.ApplicationController.restartApp=YES;if(e[f+"keyId"]==="402")DigiWebApp.ApplicationController.restartApp=YES;if(e[f+"keyId"]==="403")DigiWebApp.ApplicationController.restartApp=
YES;if(e[f+"keyId"]==="404")DigiWebApp.ApplicationController.restartApp=YES;if(e[f+"keyId"]==="405")DigiWebApp.ApplicationController.restartApp=YES;if(e[f+"keyId"]==="406")DigiWebApp.ApplicationController.restartApp=YES;if(e[f+"keyId"]==="408")DigiWebApp.ApplicationController.restartApp=YES;if(e[f+"keyId"]==="409")DigiWebApp.ApplicationController.restartApp=YES;if(e[f+"keyId"]==="410")DigiWebApp.ApplicationController.restartApp=YES;if(e[f+"keyId"]==="411")DigiWebApp.ApplicationController.restartApp=
YES;if(e[f+"keyId"]==="412")DigiWebApp.ApplicationController.restartApp=YES;if(e[f+"keyId"]==="413")DigiWebApp.ApplicationController.restartApp=YES;if(e[f+"keyId"]==="414")DigiWebApp.ApplicationController.restartApp=YES;if(e[f+"keyId"]==="416")DigiWebApp.ApplicationController.restartApp=YES;if(e[f+"keyId"]==="417")DigiWebApp.ApplicationController.restartApp=YES;if(e[f+"keyId"]==="418")DigiWebApp.ApplicationController.restartApp=YES;if(e[f+"keyId"]==="419")DigiWebApp.ApplicationController.restartApp=
YES;if(e[f+"keyId"]==="422")DigiWebApp.ApplicationController.restartApp=YES;if(e[f+"keyId"]==="423")DigiWebApp.ApplicationController.restartApp=YES;if(e[f+"keyId"]==="424")DigiWebApp.ApplicationController.restartApp=YES;if(e[f+"keyId"]==="425")DigiWebApp.ApplicationController.restartApp=YES;if(e[f+"keyId"]==="426")DigiWebApp.ApplicationController.restartApp=YES;if(e[f+"keyId"]==="427")DigiWebApp.ApplicationController.restartApp=YES}if(e[f+"keyId"]==="branding"&&e[f+"value"]!==d)DigiWebApp.ApplicationController.restartApp=
YES}DigiWebApp.ApplicationController.triggerUpdate=YES});DigiWebApp.SettingsController.getSetting("remarkIsOptional")&&DigiWebApp.SettingsController.setSetting("remarkIsMandatory",false);if(DigiWebApp.ApplicationController.triggerUpdate){DigiWebApp.DashboardPage.needsUpdate=true;DigiWebApp.MediaListPage.needsUpdate=true;DigiWebApp.DashboardController.init(YES);DigiWebApp.MediaListController.init(YES)}DigiWebApp.ApplicationController.triggerUpdate=NO;DigiWebApp.ApplicationController.DigiProgressView.hide()}else{DigiWebApp.ApplicationController.DigiProgressView.hide();
this.setCallbackStatus("features","remote",YES);DigiWebApp.Features.deleteAll();this.setCallbackStatus("features","local",NO)}this.setCallbackStatus("features","local",YES);DigiWebApp.SettingsController.globalDebugMode=DigiWebApp.SettingsController.getSetting("debug")?YES:NO;if(DigiWebApp.SettingsController.featureAvailable("409")&&DigiWebApp.ApplicationController.profilingIntervalVar===null){if(DigiWebApp.SettingsController.featureAvailable("412"))DigiWebApp.NavigationController.startBautagebuch();
else DigiWebApp.SettingsController.featureAvailable("404")?DigiWebApp.NavigationController.toButtonDashboardPage(YES):DigiWebApp.NavigationController.toDashboardPage(YES);DigiWebApp.ApplicationController.restartApp===YES&&DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("newFeatureActive"),message:M.I18N.l("newFeatureActiveMsg"),callbacks:{confirm:{action:function(){if(typeof navigator.app!=="undefined")typeof location.origin!=="undefined"?navigator.app.loadUrl(location.origin+
location.pathname):navigator.app.loadUrl(location.protocol+"//"+location.pathname);else window.location.reload()}}}})}},getKolonneFromRemote:function(){DigiWebApp.JSONDatenuebertragungController.empfangeKolonne(function(){var a=DigiWebApp.ApplicationController;a.endSession();var b=function(){DigiWebApp.SettingsController.featureAvailable("412")||DigiWebApp.SettingsController.featureAvailable("402")?DigiWebApp.BautagebuchDatenuebertragungController.empfangen(a.afterTransfer,a.afterTransfer):a.afterTransfer()};
DigiWebApp.SettingsController.featureAvailable("425")?DigiWebApp.JSONDatenuebertragungController.empfangeFestepausendefinitionen(b,b):b()},function(){this.setCallbackStatus("kolonne","remote",NO);this.proceedWithLocalData("getKolonneFromRemote")})},getKolonneFromRemoteSuccess:function(a){if(a)if(typeof a["return"]==="undefined")a["return"]=a["ns:return"];var b=[],c=null;if(a&&a["return"]){this.setCallbackStatus("kolonne","remote",YES);DigiWebApp.Employee.deleteAll();this.setCallbackStatus("kolonne",
"local",NO);if(_.isObject(a["return"])&&!_.isArray(a["return"]))a["return"]=[a["return"]];DigiWebApp.ApplicationController.DigiProgressView.show(M.I18N.l("Save"),M.I18N.l("employees"),a["return"].length,0);_.each(a["return"],function(d){DigiWebApp.ApplicationController.DigiProgressView.increase();c=DigiWebApp.Employee.createRecord({id:d.id,name:d.name,kolonnenId:d.kolonnenId,isSelected:NO});try{c.save();b.push(c.m_id)}catch(e){trackError(e)}});localStorage.setItem(this.storagePrefix+"_employeeKeys",
JSON.stringify(b));DigiWebApp.ApplicationController.DigiProgressView.hide();this.setCallbackStatus("kolonne","local",YES);localStorage.getItem(DigiWebApp.EmployeeController.empSelectionKey)==0&&localStorage.removeItem(DigiWebApp.EmployeeController.empSelectionKey);DigiWebApp.EmployeeController.getEmployeeState()!=2&&DigiWebApp.EmployeeController.setEmployeeState(1)}else{DigiWebApp.ApplicationController.DigiProgressView.hide();this.setCallbackStatus("kolonne","remote",YES);DigiWebApp.Employee.deleteAll();
this.setCallbackStatus("kolonne","local",NO);c=DigiWebApp.Employee.createRecord({id:"0",name:"Standardmitarbeiter",kolonnenId:"",isSelected:YES}).save();b.push(c.m_id);localStorage.setItem(this.storagePrefix+"_employeeKeys",JSON.stringify(b));this.setCallbackStatus("kolonne","local",YES);DigiWebApp.EmployeeController.setEmployeeState(0)}this.endSession();a=function(){var d=DigiWebApp.ApplicationController;DigiWebApp.SettingsController.featureAvailable("412")||DigiWebApp.SettingsController.featureAvailable("402")?
DigiWebApp.BautagebuchDatenuebertragungController.empfangen(d.afterTransfer,d.afterTransfer):d.afterTransfer()};DigiWebApp.SettingsController.featureAvailable("425")?DigiWebApp.JSONDatenuebertragungController.empfangeFestepausendefinitionen(a,a):a()},afterTransfer:function(){DigiWebApp.ApplicationController.DigiProgressView.hide();var a=DigiWebApp.ApplicationController;a.syncStopTimestamp=D8.now().getTimestamp();a.syncLastDuration=a.syncStopTimestamp-a.syncStartTimestamp;a.profilingIntervalVar!==
null&&console.log("DIGI-WebApp-Profiling "+D8.now().format("yyyymmdd-HHMMss")+" "+a.syncLastDuration+"ms");a.profilingShowAlert&&alert("DIGI-WebApp-Profiling: "+M.I18N.l("profilingTook")+" "+a.syncLastDuration+"ms");DigiWebApp.ApplicationController.syncRunning=NO;if(a.isReadyToProceed()){if(DigiWebApp.ApplicationController.profilingIntervalVar===null){if(DigiWebApp.SettingsController.featureAvailable("409"))if(DigiWebApp.SettingsController.featureAvailable("412"))DigiWebApp.NavigationController.startBautagebuch();
else DigiWebApp.SettingsController.featureAvailable("404")?DigiWebApp.NavigationController.toButtonDashboardPage(YES):DigiWebApp.NavigationController.toDashboardPage(YES);else{DigiWebApp.NavigationController.toBookTimePage(YES);DigiWebApp.BookingController.init()}DigiWebApp.ApplicationController.restartApp===YES&&DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("newFeatureActive"),message:M.I18N.l("newFeatureActiveMsg"),callbacks:{confirm:{action:function(){if(typeof navigator.app!==
"undefined")typeof location.origin!=="undefined"?navigator.app.loadUrl(location.origin+location.pathname):navigator.app.loadUrl(location.protocol+"//"+location.pathname);else window.location.reload()}}}})}DigiWebApp.ApplicationController.setTransitionsSetting()}else{DigiWebApp.ApplicationController.setTransitionsSetting();DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("offlineWorkNotPossible"),message:M.I18N.l("offlineWorkNotPossibleMsg")})}if(a.profilingSingleRun)a.profilingIntervalVar=
null},endSession:function(){DigiWebApp.ApplicationController.enforceChefToolOnly();DigiWebApp.RequestController.endSession({success:{target:this,action:function(){}},error:{target:this,action:function(){trackError("endSession-error")}}})},setCallbackStatus:function(a,b,c){this.callbackStatus[a][b]=c},isReadyToProceed:function(){var a=this.callbackStatus.position,b=this.callbackStatus.activity,c=this.callbackStatus.order;return(a.remote||a.local)&&(b.remote||b.local)&&(c.remote||c.local)},profilingIntervalVar:null,
profilingSingleRun:NO,profilingShowAlert:NO,startProfiling:function(a){if(DigiWebApp.ApplicationController.profilingIntervalVar===null)if(typeof a==="undefined")DigiWebApp.ApplicationController.profilingIntervalVar=null;else if(a!==0)if(a>1E4){DigiWebApp.ApplicationController.profilingSingleRun=NO;DigiWebApp.ApplicationController.profilingIntervalVar=setInterval(function(){DigiWebApp.ApplicationController.startsync()},a)}else trackError("Profiling-Interval too low!");else{DigiWebApp.ApplicationController.profilingSingleRun=
YES;DigiWebApp.ApplicationController.profilingIntervalVar=setTimeout(function(){clearTimeout(DigiWebApp.ApplicationController.profilingIntervalVar);DigiWebApp.ApplicationController.startsync()},10)}else trackError("Profiling already running!")},stopProfiling:function(){clearInterval(DigiWebApp.ApplicationController.profilingIntervalVar);DigiWebApp.ApplicationController.profilingIntervalVar=null},deleteAllData:function(){try{DigiWebApp.Booking.deleteAll()}catch(a){trackError(a)}try{DigiWebApp.MediaFile.deleteAll()}catch(b){trackError(b)}try{localStorage.clear("f")}catch(c){trackError(c)}},
updateModels:function(a){if(typeof DigiWebApp.SettingsController.getSetting("currentTimezone")==="undefined"||DigiWebApp.SettingsController.getSetting("currentTimezone")===""||typeof DigiWebApp.SettingsController.getSetting("currentTimezoneOffset")==="undefined"||DigiWebApp.SettingsController.getSetting("currentTimezoneOffset")===""){DigiWebApp.SettingsController.setSetting("currentTimezoneOffset",(new Date).getTimezoneOffset());DigiWebApp.SettingsController.setSetting("currentTimezone",jstz.determine().name())}var b=
function(){var d=_.filter(DigiWebApp.Booking.find(),function(e){return typeof e.get("modelVersion")==="undefined"});d.length>0&&_.each(d,function(e){e.set("mitarbeiterId",DigiWebApp.SettingsController.getSetting("mitarbeiterId"));if(typeof e.get("timezoneOffset")==="undefined"||e.get("timezoneOffset")===""||typeof e.get("timezone")==="undefined"||e.get("timezone")===""){e.set("timezoneOffset",(new Date(Number(e.get("timeStampStart")))).getTimezoneOffset());e.set("timezone",jstz.determine().name())}var f=
e.get("startDateString"),g=e.get("startTimeString");if(typeof f==="undefined"||!f||f===""||typeof g==="undefined"||!g||g===""){g=D8.create(new Date(Number(e.get("timeStampStart"))+6E4*((new Date(Number(e.get("timeStampStart")))).getTimezoneOffset()-e.get("timezoneOffset"))));f=g.format("dd.mm.yyyy");g=g.format("HH:MM");e.set("startDateString",f);e.set("startTimeString",g)}f=e.get("endeDateString");g=e.get("endeTimeString");if(typeof f==="undefined"||!f||f===""||typeof g==="undefined"||!g||g===""){g=
D8.create(new Date(Number(e.get("timeStampEnd"))+6E4*((new Date(Number(e.get("timeStampEnd")))).getTimezoneOffset()-e.get("timezoneOffset"))));f=g.format("dd.mm.yyyy");g=g.format("HH:MM");e.set("endeDateString",f);e.set("endeTimeString",g)}e.set("modelVersion","1");e.save();writeToLog("Buchung auf modelVersion 1 aktualisiert: "+JSON.stringify(e))});a()};if(typeof DigiWebApp.SettingsController.getSetting("mitarbeiterId")==="undefined"||DigiWebApp.SettingsController.getSetting("mitarbeiterId")===""||
parseIntRadixTen(DigiWebApp.SettingsController.getSetting("mitarbeiterId"))===0){writeToLog("aktualisiere Mitarbeiter des Benutzers in updateModels ("+DigiWebApp.SettingsController.getSetting("mitarbeiterId")+")");var c={webservice:"mitarbeiter",loaderText:M.I18N.l("BautagebuchLadeMitarbeiter"),successCallback:function(d){DigiWebApp.ApplicationController.DigiLoaderView.hide();if(d&&d.mitarbeiter&&d.mitarbeiter.length>0){DigiWebApp.SettingsController.setSetting("mitarbeiterVorname",d.mitarbeiter[0].vorname);
DigiWebApp.SettingsController.setSetting("mitarbeiterNachname",d.mitarbeiter[0].nachname);DigiWebApp.SettingsController.setSetting("mitarbeiterId",d.mitarbeiter[0].mitarbeiterId);b()}else DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("offlineWorkNotPossible"),message:M.I18N.l("offlineWorkNotPossibleMsg")})},errorCallback:function(){DigiWebApp.ApplicationController.DigiLoaderView.hide();DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("offlineWorkNotPossible"),
message:M.I18N.l("offlineWorkNotPossibleMsg")})},additionalQueryParameter:"getAll=true&webAppId="+DigiWebApp.SettingsController.getSetting("workerId"),geraeteIdOverride:true};DigiWebApp.JSONDatenuebertragungController.recieveData(c)}else b()},sonderzeichenCheck:function(a){return/[^\w\s\u00e4\u00f6\u00fc\u00c4\u00d6\u00dc\u00df \x40(){}*%\$\u00a7\u20ac=/\\!?.,;:+-]+/.test(a)},vibrate:function(){var a=100;try{a=DigiWebApp.ApplicationController.CONSTVibrateDuration}catch(b){}try{if(typeof DigiWebApp.SettingsController.getSetting("vibrationsDauer")!==
"undefined")a=parseIntRadixTen(DigiWebApp.SettingsController.getSetting("vibrationsDauer"))}catch(c){}if(typeof navigator.vibrate!="undefined")try{a>0&&navigator.vibrate(a)}catch(d){}},afterVibrate:function(){DigiWebApp.ApplicationController.DigiLoaderView.hide()},exitApp:function(a){autoCleanLogs(function(){if(!onIOS){a?DigiWebApp.ApplicationController.DigiLoaderView.show(M.I18N.l("autoExitApp")):DigiWebApp.ApplicationController.DigiLoaderView.show(M.I18N.l("exitApp"));try{DigiWebApp.ApplicationController.bgGeo.stop()}catch(b){}try{window.plugin.notification.local.cancel("4711")}catch(c){}if(typeof navigator!=
"undefined"&&typeof navigator.app!="undefined"&&typeof navigator.app.exitApp!="undefined")if(a){DigiWebApp.ApplicationController.DigiLoaderView.show(M.I18N.l("autoExitApp"));window.setTimeout(flushLogQueueAndExit,2E3)}else flushLogQueueAndExit()}DigiWebApp.ApplicationController.DigiLoaderView.hide()})},dtc6AktivRenameHelper:function(a,b){if(typeof a!=="undefined")$("#"+a).parent().parent().parent()[0].firstChild.textContent=b}});
DigiWebApp.AudioController=M.Controller.extend({myAudioObject:{},myTimeStamp:null,myFilename:null,myState:null,init:function(){DigiWebApp.SettingsController.globalDebugMode&&console.log("init");DigiWebApp.SettingsController.globalDebugMode&&console.log("this.myState = "+this.myState);DigiWebApp.AudioPage.content.grid.button.events={tap:{action:DigiWebApp.AudioController.recordAudio}};DigiWebApp.AudioPage.content.grid.button.registerEvents();DigiWebApp.AudioPage.content.audioIcon.events={tap:{action:DigiWebApp.AudioController.recordAudio}};
DigiWebApp.AudioPage.content.audioIcon.registerEvents();document.getElementById(DigiWebApp.AudioPage.content.audioIcon.id).src="theme/images/icon_record.png";this.myTimeStamp=M.Date.create(new Date).format("yymmddHHMMss");this.myFilename="DIGI-WebApp-recording-"+this.myTimeStamp+".wav";this.myState=null;DigiWebApp.AudioController.myAudioObject=new Media(this.myFilename,this.onSuccess,this.onError,this.mediaStatus,this.mediaPosition);DigiWebApp.SettingsController.globalDebugMode&&console.log(this.myFilename);
DigiWebApp.SettingsController.globalDebugMode&&console.log(DigiWebApp.AudioController.myAudioObject)},mediaStatus:function(a){DigiWebApp.SettingsController.globalDebugMode&&console.log("mediaStatus: "+a)},mediaPosition:function(a){DigiWebApp.SettingsController.globalDebugMode&&console.log("mediaPosition: "+a)},onSuccess:function(){DigiWebApp.SettingsController.globalDebugMode&&console.log("onSuccess");DigiWebApp.SettingsController.globalDebugMode&&console.log("this.myState = "+this.myState);switch(this.myState){case "play":DigiWebApp.AudioPage.content.audioIcon.events=
{tap:{action:DigiWebApp.AudioController.stopPlayback}};DigiWebApp.AudioPage.content.audioIcon.registerEvents();document.getElementById(DigiWebApp.AudioPage.content.audioIcon.id).src="theme/images/icon_stop.png";break;case "record":DigiWebApp.AudioPage.content.audioIcon.events={tap:{action:DigiWebApp.AudioController.stopRecord}};DigiWebApp.AudioPage.content.audioIcon.registerEvents();document.getElementById(DigiWebApp.AudioPage.content.audioIcon.id).src="theme/images/icon_stop.png";DigiWebApp.AudioPage.content.grid.button.events=
{tap:{action:DigiWebApp.AudioController.init}};DigiWebApp.AudioPage.content.grid.button.registerEvents();break;case "stop":DigiWebApp.AudioPage.content.audioIcon.events={tap:{action:DigiWebApp.AudioController.playbackAudio}};DigiWebApp.AudioPage.content.audioIcon.registerEvents();document.getElementById(DigiWebApp.AudioPage.content.audioIcon.id).src="theme/images/icon_playbackAudio.png";break;default:DigiWebApp.AudioPage.content.audioIcon.events={tap:{action:DigiWebApp.AudioController.playbackAudio}};
DigiWebApp.AudioPage.content.audioIcon.registerEvents();document.getElementById(DigiWebApp.AudioPage.content.audioIcon.id).src="theme/images/icon_playbackAudio.png"}},onError:function(a){DigiWebApp.SettingsController.globalDebugMode&&console.log("onError");console.log("code: "+a.code+"\nmessage: "+a.message+"\n");console.log("Filename: "+this.myFilename);DigiWebApp.AudioPage.content.audioIcon.events={tap:{action:DigiWebApp.AudioController.playbackAudio}};DigiWebApp.AudioPage.content.audioIcon.registerEvents();
document.getElementById(DigiWebApp.AudioPage.content.audioIcon.id).src="theme/images/icon_playbackAudio.png";DigiWebApp.AudioPage.content.grid.button.events={tap:{action:DigiWebApp.AudioController.init}};DigiWebApp.AudioPage.content.grid.button.registerEvents()},recordAudio:function(){this.myState="record";DigiWebApp.AudioController.myAudioObject.startRecord();DigiWebApp.AudioPage.content.audioIcon.events={tap:{action:DigiWebApp.AudioController.stopRecord}};DigiWebApp.AudioPage.content.audioIcon.registerEvents();
document.getElementById(DigiWebApp.AudioPage.content.audioIcon.id).src="theme/images/icon_stop.png";DigiWebApp.AudioPage.content.grid.button.events={tap:{action:DigiWebApp.AudioController.init}};DigiWebApp.AudioPage.content.grid.button.registerEvents();DigiWebApp.SettingsController.globalDebugMode&&console.log("recordAudio");DigiWebApp.SettingsController.globalDebugMode&&console.log("this.myState = "+this.myState)},stopRecord:function(){this.myState="stop";DigiWebApp.AudioController.myAudioObject.stopRecord();
DigiWebApp.AudioPage.content.audioIcon.events={tap:{action:DigiWebApp.AudioController.playbackAudio}};DigiWebApp.AudioPage.content.audioIcon.registerEvents();document.getElementById(DigiWebApp.AudioPage.content.audioIcon.id).src="theme/images/icon_playbackAudio.png";DigiWebApp.SettingsController.globalDebugMode&&console.log("stopRecord");DigiWebApp.SettingsController.globalDebugMode&&console.log("this.myState = "+this.myState)},playbackAudio:function(){this.myState="play";DigiWebApp.AudioController.myAudioObject.play();
DigiWebApp.AudioPage.content.audioIcon.events={tap:{action:DigiWebApp.AudioController.stopPlayback}};DigiWebApp.AudioPage.content.audioIcon.registerEvents();document.getElementById(DigiWebApp.AudioPage.content.audioIcon.id).src="theme/images/icon_stop.png";DigiWebApp.SettingsController.globalDebugMode&&console.log("playbackAudio");DigiWebApp.SettingsController.globalDebugMode&&console.log("this.myState = "+this.myState)},stopPlayback:function(){this.myState="stop";DigiWebApp.AudioController.myAudioObject.stop();
DigiWebApp.AudioPage.content.audioIcon.events={tap:{action:DigiWebApp.AudioController.playbackAudio}};DigiWebApp.AudioPage.content.audioIcon.registerEvents();document.getElementById(DigiWebApp.AudioPage.content.audioIcon.id).src="theme/images/icon_playbackAudio.png";DigiWebApp.SettingsController.globalDebugMode&&console.log("stopPlayback");DigiWebApp.SettingsController.globalDebugMode&&console.log("this.myState = "+this.myState)}});
DigiWebApp.AnwesenheitslisteController=M.Controller.extend({items:null,init:function(a){DigiWebApp.ApplicationController.DigiLoaderView.show(M.I18N.l("AnwesenheitslisteLaden"));DigiWebApp.AnwesenheitslisteController.items===null?DigiWebApp.RequestController.getDatabaseServer(DigiWebApp.AnwesenheitslisteController.initWithServer,a):DigiWebApp.AnwesenheitslisteController.initWithServer(a)},initWithServer:function(){var a=DigiWebApp.AnwesenheitslisteController;a.items===null&&DigiWebApp.Anwesenheitsliste.find({urlParams:{},
callbacks:{success:{action:function(b){if(b&&b.length===0){DigiWebApp.ApplicationController.DigiLoaderView.hide();DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("error"),message:M.I18N.l("AnwesenheitslisteKonnteNichtGeladenWerden"),callbacks:{confirm:{target:a,action:function(){DigiWebApp.SettingsController.featureAvailable("404")?DigiWebApp.NavigationController.backToButtonDashboardPageFlipTransition():DigiWebApp.NavigationController.backToDashboardPageFlipTransition()}}}})}else{DigiWebApp.AnwesenheitslisteController.set("items",
b);DigiWebApp.ApplicationController.DigiLoaderView.hide()}}},error:{action:function(){DigiWebApp.ApplicationController.DigiLoaderView.hide();DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("error"),message:M.I18N.l("AnwesenheitslisteKonnteNichtGeladenWerden"),callbacks:{confirm:{target:a,action:function(){DigiWebApp.SettingsController.featureAvailable("404")?DigiWebApp.NavigationController.backToButtonDashboardPageFlipTransition():DigiWebApp.NavigationController.backToDashboardPageFlipTransition()}}}})}}}})}});
DigiWebApp.BautagebuchBautagesberichtDetailsController=M.Controller.extend({item:null,projektleiterId:null,projektleiterList:[{label:"",value:0}],mitarbeiterIds:null,mitarbeiterList:[{label:"",value:0}],mitarbeiterListSelected:null,datum:null,datumAsDate:null,handOrderId:null,handOrderName:null,auftragsId:null,auftragsName:null,auftraegeList:[{label:"",value:0}],positionId:null,positionName:null,positionenList:null,latitude:null,longitude:null,bautagesberichtTyp:null,wetter:null,wetterBackup:null,
setWetter:function(a){if(typeof a==="undefined")return NO;else{this.set("wetter",JSON.parse(JSON.stringify(a)));return YES}},startUhrzeit:null,init:function(a){if(a){this.setWetter(DigiWebApp.BautagebuchMainController.wetterDefaults);DigiWebApp.BautagebuchBautagesberichtDetailsController.set("mitarbeiterIds",_.map(DigiWebApp.BautagebuchMainController.mitarbeiter,function(b){return parseIntRadixTen(b.value)}))}},load:function(a){this.set("item",a);this.set("datum",a.get("datum"));this.set("projektleiterId",
a.get("projektleiterId"));this.set("auftragsId",a.get("orderId"));this.set("auftragsName",a.get("orderName"));this.set("handOrderId",a.get("handOrderId"));this.set("handOrderName",a.get("handOrderName"));this.set("positionId",a.get("positionId"));this.set("positionName",a.get("positionName"));this.set("mitarbeiterIds",a.get("selektierteMitarbeiter"));this.set("startUhrzeit",a.get("startUhrzeit"));this.set("bautagesberichtTyp",a.get("bautagesberichtTyp"));this.setWetter(DigiWebApp.BautagebuchMainController.wetterDefaults);
this.set("wetter.temperatur",a.get("temperatur"));this.set("wetter.luftfeuchtigkeit",a.get("luftfeuchtigkeit"));this.set("wetter.bewoelkung",a.get("bewoelkung"));this.set("wetter.niederschlag",a.get("niederschlag"));this.set("wetter.wind",a.get("wind"));this.set("wetter.wechselhaft",a.get("wechselhaft"));this.set("wetter.wechselhaftItem",[{value:"wechselhaft",label:M.I18N.l("BautagebuchWechselhaft"),isSelected:a.get("wechselhaft")}]);this.setPositionen(a.get("orderId"))},save:function(a,b,c){if(!c){c=
M.ViewManager.getView("bautagebuchBautagesberichtDetailsPage","auftragComboBox").getSelection()!=="0";var d=M.ViewManager.getView("bautagebuchBautagesberichtDetailsPage","projektleiterComboBox").getSelection()!=="0",e=!(DigiWebApp.BautagebuchBautagesberichtDetailsController.mitarbeiterIds===null||DigiWebApp.BautagebuchBautagesberichtDetailsController.mitarbeiterIds.length===0);if(!c){DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("noOrderSelected"),message:M.I18N.l("noOrderSelectedMsg")});
return false}if(!d){DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("noProjektleiterSelected"),message:M.I18N.l("noProjektleiterSelectedMsg")});return false}if(!e){DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("noMitarbeiterSelected"),message:M.I18N.l("noMitarbeiterSelectedMsg")});return false}}this.item.set("datum",this.datum);this.item.set("bautagesberichtTyp",this.bautagesberichtTyp);if(DigiWebApp.BautagebuchEinstellungenController.settings.inStundenBuchen)this.item.set("startUhrzeit",
this.startUhrzeit);else{c=DigiWebApp.BautagebuchZeitbuchung.find({query:{identifier:"bautagesberichtId",operator:"=",value:this.item.get("id")}});var f=null;_.each(c,function(g){g=D8.create(DigiWebApp.BautagebuchBautagesberichtDetailsController.datum+" "+g.get("von")).getTimestamp();if(!f||f>g)f=g});this.item.set("startUhrzeit",D8.create(f).format("HH:MM"))}this.item.set("projektleiterId",this.projektleiterId);this.item.set("orderId",this.auftragsId);this.item.set("orderName",this.auftragsName);this.item.set("handOrderId",
this.handOrderId);this.item.set("handOrderName",this.handOrderName);if(M.ViewManager.getView("bautagebuchBautagesberichtDetailsPage","positionComboBox").getSelection()!=="0"){this.item.set("positionId",this.positionId);this.item.set("positionName",this.positionName)}this.item.set("selektierteMitarbeiter",this.mitarbeiterIds);this.item.set("temperatur",this.wetter.temperatur);this.item.set("luftfeuchtigkeit",this.wetter.luftfeuchtigkeit);this.item.set("bewoelkung",this.wetter.bewoelkung);this.item.set("niederschlag",
this.wetter.niederschlag);this.item.set("wind",this.wetter.wind);this.item.set("wechselhaft",this.wetter.wechselhaft);if(this.item.saveSorted()){DigiWebApp.BautagebuchBautagesberichteListeController.set("items",DigiWebApp.BautagebuchBautagesbericht.findSorted());typeof a==="function"&&a();return true}else{typeof b==="function"&&b();return false}},deleteBautagesbericht:function(a,b,c){var d=this;c?d.item.deleteSorted(function(){DigiWebApp.BautagebuchBautagesberichteListeController.set("items",DigiWebApp.BautagebuchBautagesbericht.findSorted());
typeof a==="function"&&a()}):DigiWebApp.ApplicationController.nativeConfirmDialogView({title:M.I18N.l("deleteLabel"),message:M.I18N.l("wirklichLoeschenMsg"),confirmButtonValue:M.I18N.l("yes"),cancelButtonValue:M.I18N.l("no"),callbacks:{confirm:{target:this,action:function(){d.item.deleteSorted(function(){DigiWebApp.BautagebuchBautagesberichteListeController.set("items",DigiWebApp.BautagebuchBautagesbericht.findSorted());typeof a==="function"&&a()})}},cancel:{target:this,action:function(){return true}}}})},
finish:function(a,b){if(this.save()){DigiWebApp.BautagebuchZusammenfassungController.load(this.item);DigiWebApp.NavigationController.toBautagebuchZusammenfassungPageTransition();typeof a==="function"&&a();return true}else{typeof b==="function"&&b();return false}},setPositionen:function(a){var b=this;if(typeof a==="undefined")return false;else{var c=NO,d=_.map(DigiWebApp.Position.findSorted(),function(e){if(typeof e==="undefined")console.log("UNDEFINED Position");else if(parseIntRadixTen(e.get("orderId"))==
parseIntRadixTen(a)){var f={label:e.get("name"),value:e.get("id"),isSelected:NO};if(parseIntRadixTen(e.get("id"))==parseIntRadixTen(b.item.get("positionId"))){c=f.isSelected=YES;b.set("positionId",e.get("id"));b.set("positionName",e.get("name"))}return f}});d=_.compact(d);if(!c&&a&&d.length>0){d[0].isSelected=YES;b.set("positionId",d[0].value);b.set("positionName",d[0].label)}b.set("positionenList",d)}},setStartUhrzeit:function(){if(DigiWebApp.BautagebuchBautagesberichtDetailsController.startUhrzeit){$("#"+
DigiWebApp.BautagebuchBautagesberichtDetailsPage.content.startUhrzeitContainer.startUhrzeitGrid.stundeFeld.id)[0].value=parseIntRadixTen(DigiWebApp.BautagebuchBautagesberichtDetailsController.startUhrzeit.split(":")[0]).padLeft(2,"0");$("#"+DigiWebApp.BautagebuchBautagesberichtDetailsPage.content.startUhrzeitContainer.startUhrzeitGrid.minuteFeld.id)[0].value=parseIntRadixTen(DigiWebApp.BautagebuchBautagesberichtDetailsController.startUhrzeit.split(":")[1]).padLeft(2,"0")}}});
DigiWebApp.BautagebuchBautagesberichteListeController=M.Controller.extend({items:null,init:function(a){DigiWebApp.BautagebuchMainController.init(a);this.set("items",DigiWebApp.BautagebuchBautagesbericht.findSorted());DigiWebApp.SettingsController.featureAvailable("409")&&DigiWebApp.BautagebuchBautagesberichteListePage.header.backButton.setValue(M.I18N.l("mainMenu"));_.filter(DigiWebApp.BautagebuchBautagesbericht.find(),function(b){return parseBool(b.get("abgeschlossen"))}).length==0?$("#"+DigiWebApp.BautagebuchBautagesberichteListePage.uebertragenButton.id).hide():
$("#"+DigiWebApp.BautagebuchBautagesberichteListePage.uebertragenButton.id).show()},neu:function(a,b,c){a?DigiWebApp.BautagebuchBautagesberichtDetailsController.set("bautagesberichtTyp",a):DigiWebApp.BautagebuchBautagesberichtDetailsController.set("bautagesberichtTyp","<standard>");DigiWebApp.BautagebuchBautagesberichtDetailsController.init(YES);DigiWebApp.SettingsController.getSetting("bautagebuchLimit_autoStartUhrzeit")?DigiWebApp.BautagebuchBautagesberichtDetailsController.set("startUhrzeit",D8.now().format("HH:MM")):
DigiWebApp.BautagebuchBautagesberichtDetailsController.set("startUhrzeit",DigiWebApp.BautagebuchEinstellungenController.settings.startUhrzeit);DigiWebApp.BautagebuchBautagesberichtDetailsController.set("datum",D8.now().format("dd.mm.yyyy"));DigiWebApp.BautagebuchBautagesberichtDetailsController.set("projektleiterId",null);DigiWebApp.BautagebuchBautagesberichtDetailsController.set("auftragsId",null);c?DigiWebApp.BautagebuchBautagesberichtDetailsController.set("auftragsName",c):DigiWebApp.BautagebuchBautagesberichtDetailsController.set("auftragsName",
null);DigiWebApp.BautagebuchBautagesberichtDetailsController.set("handOrderId",null);DigiWebApp.BautagebuchBautagesberichtDetailsController.set("handOrderName",null);DigiWebApp.BautagebuchBautagesberichtDetailsController.set("positionId",null);DigiWebApp.BautagebuchBautagesberichtDetailsController.set("positionName",null);DigiWebApp.BautagebuchEinstellungenController.settings.alleMitarbeiterVorselektiert?DigiWebApp.BautagebuchBautagesberichtDetailsController.set("mitarbeiterIds",_.map(DigiWebApp.BautagebuchMainController.mitarbeiter,
function(d){return parseIntRadixTen(d.value)})):DigiWebApp.BautagebuchBautagesberichtDetailsController.set("mitarbeiterIds",null);DigiWebApp.BautagebuchBautagesberichtDetailsController.setWetter(DigiWebApp.BautagebuchMainController.wetterDefaults);DigiWebApp.BautagebuchBautagesberichtDetailsController.set("item",DigiWebApp.BautagebuchBautagesbericht.createRecord({id:Math.uuid(),datum:DigiWebApp.BautagebuchBautagesberichtDetailsController.datum,startUhrzeit:DigiWebApp.BautagebuchBautagesberichtDetailsController.startUhrzeit}));
b||DigiWebApp.NavigationController.toBautagebuchBautagesberichtDetailsPageTransition()}});
DigiWebApp.BautagebuchDatenuebertragungController=M.Controller.extend({successReturnCallback:function(){},errorReturnCallback:function(){},consoleLogOutput:NO,empfangen:function(a,b){var c=DigiWebApp.BautagebuchDatenuebertragungController;c.successReturnCallback=a;c.errorReturnCallback=function(){DigiWebApp.ApplicationController.DigiProgressView.hide();b()};DigiWebApp.RequestController.getDatabaseServer(function(){c.empfangeProjektleiter(function(){c.empfangeMitarbeiter(function(){c.empfangeMengeneinheiten(function(){c.empfangeMaterialien(c.successReturnCallback,c.successReturnCallback)},
c.errorReturnCallback)},c.errorReturnCallback)},c.errorReturnCallback)})},senden:function(a,b,c){var d=DigiWebApp.BautagebuchDatenuebertragungController;d.successReturnCallback=b;d.errorReturnCallback=function(){DigiWebApp.ApplicationController.DigiProgressView.hide();c()};DigiWebApp.RequestController.getDatabaseServer(function(){d.sendeBautagesbericht(a,function(){d.sendeZeitbuchungen(a,function(){d.sendeMaterialbuchungen(a,function(){d.sendeNotizen(a,function(){d.sendeMedien(a,function(){d.sendeBautagesberichtFertig(a,
d.successReturnCallback,d.errorReturnCallback)},d.errorReturnCallback)},d.errorReturnCallback)},d.errorReturnCallback)},d.errorReturnCallback)},d.errorReturnCallback)})},abgeschlosseneUebertragen:function(){var a=_.filter(DigiWebApp.BautagebuchBautagesbericht.find(),function(b){return parseBool(b.get("abgeschlossen"))});a.length>0&&function(b,c){DigiWebApp.BautagebuchDatenuebertragungController.senden(b,function(){DigiWebApp.BautagebuchBautagesberichteListeController.init();c()},function(d,e){trackError(e);
DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("BautagebuchUebertragungsfehler"),message:M.I18N.l("BautagebuchUebertragungsfehlerMsg")})})}(a[0],DigiWebApp.BautagebuchDatenuebertragungController.abgeschlosseneUebertragen)},empfangeMengeneinheiten:function(a,b){if(!(DigiWebApp.SettingsController.featureAvailable("412")||DigiWebApp.SettingsController.featureAvailable("402")))return a();a();var c={webservice:"mengeneinheiten",loaderText:M.I18N.l("BautagebuchLadeMengeneinheiten"),
successCallback:function(d,e,f){DigiWebApp.BautagebuchDatenuebertragungController.consoleLogOutput&&console.log("empfangeMengeneinheiten Status: "+f.status);if(typeof d.mengeneinheiten==="undefined"){trackError("missing mengeneinheiten");return b()}if(d.mengeneinheiten===null)return b();else{e=null;try{e=d.mengeneinheiten.length}catch(g){return b()}}DigiWebApp.ApplicationController.DigiProgressView.show(M.I18N.l("Save"),M.I18N.l("mengeneinheiten"),e,0);DigiWebApp.BautagebuchMengeneinheit.deleteAll();
_.each(d.mengeneinheiten,function(i){DigiWebApp.ApplicationController.DigiProgressView.increase();if(typeof i.id==="undefined"){trackError("missing mengeneinheit id");return b()}else if(typeof i.kuerzel==="undefined"){trackError("missing mengeneinheit kuerzel");return b()}else DigiWebApp.BautagebuchMengeneinheit.createRecord({id:""+i.id,kuerzel:""+i.kuerzel}).saveSorted()});DigiWebApp.ApplicationController.DigiProgressView.hide();a()},errorCallback:b};DigiWebApp.JSONDatenuebertragungController.recieveData(c)},
empfangeMaterialien:function(a,b){if(!(DigiWebApp.SettingsController.featureAvailable("412")||DigiWebApp.SettingsController.featureAvailable("402")))return a();var c=DigiWebApp.BautagebuchDatenuebertragungController,d={webservice:"materialliste",loaderText:M.I18N.l("BautagebuchLadeMaterialien"),successCallback:function(e,f,g){c.consoleLogOutput&&console.log("empfangeMaterialien Status: "+g.status);if(typeof e.materialliste==="undefined"){trackError("missing materialliste");return b()}if(e.materialliste!==
null){var i=null;try{i=e.materialliste.length}catch(h){trackError("data.materialliste hat L\u00e4nge "+i)}}DigiWebApp.ApplicationController.DigiProgressView.show(M.I18N.l("Save"),M.I18N.l("materialien"),i,0);DigiWebApp.BautagebuchMaterial.deleteAll();DigiWebApp.BautagebuchLieferant.deleteAll();DigiWebApp.BautagebuchHersteller.deleteAll();DigiWebApp.BautagebuchMaterialtyp.deleteAll();DigiWebApp.BautagebuchMaterialgruppe.deleteAll();_.each(e.materialliste,function(j){DigiWebApp.ApplicationController.DigiProgressView.increase();
if(typeof j.bezeichnung==="undefined"){trackError("missing bezeichnung");return b()}else{var l=[];_.each(j.lieferanten,function(q){l.push(""+q.id);DigiWebApp.BautagebuchLieferant.find({query:{identifier:"id",operator:"=",value:""+q.id}})[0]||DigiWebApp.BautagebuchLieferant.createRecord({id:""+q.id,bezeichnung:""+q.bezeichnung,nummer:""+q.nummer}).saveSorted()});DigiWebApp.BautagebuchHersteller.find({query:{identifier:"id",operator:"=",value:""+j.herstellerId}})[0]||DigiWebApp.BautagebuchHersteller.createRecord({id:""+
j.herstellerId,bezeichnung:""+j.hersteller}).saveSorted();var n=[];_.each(j.materialgruppen,function(q){n.push(""+q.id);DigiWebApp.BautagebuchMaterialgruppe.find({query:{identifier:"id",operator:"=",value:""+q.id}})[0]||DigiWebApp.BautagebuchMaterialgruppe.createRecord({id:""+q.id,bezeichnung:""+q.bezeichnung,vaterId:""+q.vaterId}).saveSorted()});var m=0;if(j.materialtyp){m=""+j.materialtyp.id;DigiWebApp.BautagebuchMaterialtyp.find({query:{identifier:"id",operator:"=",value:""+j.materialtyp.id}})[0]||
DigiWebApp.BautagebuchMaterialtyp.createRecord({id:""+j.materialtyp.id,bezeichnung:""+j.materialtyp.bezeichnung}).saveSorted()}var o=[];_.each(j.einheitenIds,function(q){o.push(""+q)});var p=null;if(j.nummer)p=""+j.nummer;DigiWebApp.BautagebuchMaterial.createRecord({id:""+j.id,bezeichnung:""+j.bezeichnung,nummer:p,standardEinheitId:""+j.standardEinheitId,herstellerId:""+j.herstellerId,einheitenIds:JSON.stringify(o),lieferantenIds:JSON.stringify(l),materialgruppenIds:JSON.stringify(n),materialtypId:""+
m,einzelpreis:j.einzelpreis}).saveSorted()}});DigiWebApp.ApplicationController.DigiProgressView.hide();a()},errorCallback:b};DigiWebApp.JSONDatenuebertragungController.recieveData(d)},empfangeProjektleiter:function(a,b){if(!DigiWebApp.SettingsController.featureAvailable("412"))return a();var c=DigiWebApp.BautagebuchDatenuebertragungController,d={webservice:"projektleiter",loaderText:M.I18N.l("BautagebuchLadeProjektleiter"),successCallback:function(e,f,g){c.consoleLogOutput&&console.log("empfangeProjektleiter Status: "+
g.status);if(typeof e.projektleiter==="undefined"){trackError("missing mitarbeiterliste");return b()}if(e.projektleiter===null)return b();else{f=null;try{f=e.projektleiter.length}catch(i){trackError("data.projektleiter hat L\u00e4nge "+f);return b()}}DigiWebApp.ApplicationController.DigiProgressView.show(M.I18N.l("Save"),M.I18N.l("projektleiter"),f,0);DigiWebApp.BautagebuchProjektleiter.deleteAll();_.each(e.projektleiter,function(h){DigiWebApp.ApplicationController.DigiProgressView.increase();if(typeof h.id===
"undefined"){trackError("missing id");return b()}else if(typeof h.vorname==="undefined"){trackError("missing projektleiter vorname");return b()}else if(typeof h.nachname==="undefined"){trackError("missing projektleiter nachname");return b()}else DigiWebApp.BautagebuchProjektleiter.find({query:{identifier:"id",operator:"=",value:h.id}}).length===0&&DigiWebApp.BautagebuchProjektleiter.createRecord({id:h.id,vorname:h.vorname,nachname:h.nachname}).saveSorted()});DigiWebApp.ApplicationController.DigiProgressView.hide();
a()},errorCallback:b};DigiWebApp.JSONDatenuebertragungController.recieveData(d)},empfangeMitarbeiter:function(a,b){if(!DigiWebApp.SettingsController.featureAvailable("412"))return a();var c=DigiWebApp.BautagebuchDatenuebertragungController,d={webservice:"mitarbeiter",loaderText:M.I18N.l("BautagebuchLadeMitarbeiter"),successCallback:function(e,f,g){c.consoleLogOutput&&console.log("empfangeMitarbeiter Status: "+g.status);if(typeof e.mitarbeiter==="undefined"){trackError("missing projektleiterliste");
return b()}if(e.mitarbeiter===null)return b();else{f=null;try{f=e.mitarbeiter.length}catch(i){trackError("data.mitarbeiter hat L\u00e4nge "+f);return b()}}DigiWebApp.ApplicationController.DigiProgressView.show(M.I18N.l("Save"),M.I18N.l("employees"),f,0);DigiWebApp.BautagebuchMitarbeiter.deleteAll();_.each(e.mitarbeiter,function(h){DigiWebApp.ApplicationController.DigiProgressView.increase();if(typeof h.id==="undefined"){trackError("missing mitarbeiter id");return b()}else if(typeof h.vorname==="undefined"){trackError("missing mitarbeiter vorname");
return b()}else if(typeof h.nachname==="undefined"){trackError("missing mitarbeiter nachname");return b()}else if(typeof h.projektleiterId==="undefined"){trackError("missing mitarbeiter projektleiterId");return b()}else DigiWebApp.BautagebuchMitarbeiter.find({query:{identifier:"id",operator:"=",value:h.id}}).length===0&&DigiWebApp.BautagebuchMitarbeiter.createRecord({id:h.id,vorname:h.vorname,nachname:h.nachname,projektleiterId:h.projektleiterId,webAppId:h.webAppId,webAppPin:h.webAppPin}).saveSorted()});
DigiWebApp.ApplicationController.DigiProgressView.hide();a()},errorCallback:b,additionalQueryParameter:"getAll=true&nurKolonne=true"};DigiWebApp.JSONDatenuebertragungController.recieveData(d)},sendeBautagesbericht:function(a,b,c){var d=DigiWebApp.BautagebuchDatenuebertragungController;a.get("id")&&a.set("bautagesberichtId",a.get("id"));a.set("transferCompleted",NO);var e={data:a.record,webservice:"bautagesbericht",loaderText:M.I18N.l("BautagebuchSendeBautagesbericht"),successCallback:function(f,g,
i){d.consoleLogOutput&&console.log("sendeBautagesbericht Status: "+i.status);b()},errorCallback:c};if(a.hasFileName())a.readFromFile(function(f){a.set("unterschrift",JSON.parse(f));e.data=a.record;DigiWebApp.JSONDatenuebertragungController.sendData(e)},function(){a.set("unterschrift",[{lx:1,ly:1,mx:1,my:1}]);e.data=a.record;DigiWebApp.JSONDatenuebertragungController.sendData(e)});else{a.set("unterschrift",[{lx:1,ly:1,mx:1,my:1}]);e.data=a.record;DigiWebApp.JSONDatenuebertragungController.sendData(e)}},
sendeZeitbuchungen:function(a,b,c){var d=[],e=DigiWebApp.BautagebuchZeitbuchung.find({query:{identifier:"bautagesberichtId",operator:"=",value:a.get("id")}});e=_.sortBy(e,function(f){return parseIntRadixTen(f.get("_createdAt"))});_.each(e,function(f){_.each(JSON.parse(f.get("mitarbeiterIds")),function(g){var i=DigiWebApp.BautagebuchZeitbuchung.createRecord({bautagesberichtId:a.get("id")}),h;for(h in f.record)try{typeof JSON.parse(f.get(h)).length!=="undefined"?i.set(h,JSON.parse(f.get(h))):i.set(h,
f.get(h))}catch(j){i.set(h,f.get(h))}i.set("mitarbeiterId",parseIntRadixTen(g));i.get("dauer")!="00:00"&&d.push(i.record)})});if(d.length!==0){c={data:{zeitdaten:d},webservice:"zeitdaten",loaderText:M.I18N.l("BautagebuchSendeZeitbuchungen"),successCallback:function(f,g,i){console.log("sendeZeitbuchungen Status: "+i.status);b()},errorCallback:c};DigiWebApp.JSONDatenuebertragungController.sendData(c)}else b()},sendeMaterialbuchungen:function(a,b,c){var d=[];_.each(DigiWebApp.BautagebuchMaterialBuchung.find({query:{identifier:"bautagesberichtId",
operator:"=",value:a.get("id")}}),function(e){e=e.record;e.menge=parseFloat(e.menge);d.push(e)});if(d.length!==0){a={data:{materialbuchungen:d},webservice:"bautagesbericht/materialbuchung",loaderText:M.I18N.l("BautagebuchSendeMaterialbuchungen"),successCallback:function(e,f,g){DigiWebApp.BautagebuchDatenuebertragungController.consoleLogOutput&&console.log("sendeMaterialbuchungen Status: "+g.status);b()},errorCallback:c};DigiWebApp.JSONDatenuebertragungController.sendData(a)}else b()},sendeNotizen:function(a,
b,c){var d=[];_.each(DigiWebApp.BautagebuchNotiz.find({query:{identifier:"bautagesberichtId",operator:"=",value:a.get("id")}}),function(i){d.push(i.record)});if(d.length!==0){var e={notizen:d},f=function(i,h,j){DigiWebApp.BautagebuchDatenuebertragungController.consoleLogOutput&&console.log("sendeNotizen Status: "+j.status);b()},g=DigiWebApp.SettingsController.getSetting("scrId");writeToLog(g,function(){writeToLog(escape(scrStr(JSON.stringify(e),g)),function(){var i="Sende "+d.length+" Notiz";if(d.length>
1)i+="en";writeToLog(i,function(){var h={data:e,webservice:"bautagesbericht/notiz",loaderText:M.I18N.l("BautagebuchSendeNotizen"),successCallback:f,errorCallback:c};DigiWebApp.JSONDatenuebertragungController.sendData(h)})})})}else b()},sendeMedien:function(a,b){DigiWebApp.ApplicationController.DigiLoaderView.show(M.I18N.l("loadMediaFiles"));var c=function(h){if(h.length!==0){var j=0,l=[];if(h.length>0){var n=h[0];l=[];var m=JSON.parse(JSON.stringify(n));if(m.record.handOrderId!==null&&m.record.handOrderId!==
"0")m.record.orderId=null;l.push(m.record);l={medien:l};writeToLog("sending BautagebuchMediaFile "+m.record.fileName);m=DigiWebApp.SettingsController.getSetting("WebserviceTimeOut");if(parseIntRadixTen(DigiWebApp.SettingsController.getSetting("WebserviceTimeOut"))<6E4)m=6E4;m={data:l,webservice:"medien",loaderText:M.I18N.l("BautagebuchSendeMedien"),successCallback:function(){var o=[];_.each(h,function(p){p.m_id==n.m_id?writeToLog("l\u00f6sche BautagebuchMediaFile "+p.record.fileName,function(){var q=
function(){p.del();_.sortBy(DigiWebApp.BautagebuchMediaFile.find(),function(r){return parseIntRadixTen(r.get("timeStamp"))})};p.deleteFile(q,q);j+=1}):o.push(p)});if(o.length>0)c(o);else{writeToLog("sending last mediaFile done (with file)");b()}},errorCallback:function(o,p){var q=[];_.each(h,function(r){r.m_id!=n.m_id&&q.push(r)});if(q.length>0)c(q);else{writeToLog("sending mediaFile failed: "+p);b()}},timeout:m,omitLoaderHide:true};DigiWebApp.JSONDatenuebertragungController.sendData(m)}}else b()},
d=DigiWebApp.BautagebuchMediaFile.find({query:{identifier:"bautagesberichtId",operator:"=",value:a.get("id")}}),e=[],f=d.length,g=0,i=false;f!==0?_.each(d,function(h){if(h.hasFileName()){writeToLog("loading BautagebuchMediaFile "+h.get("fileName"));h.readFromFile(function(j){j&&j!==""&&_.each(d,function(l){if(l.m_id===h.m_id){l.set("data",j);g+=1;e.push(l);writeToLog("BautagebuchMediaFile "+l.get("fileName")+" loaded ("+g+")")}});if(g===f&&i===false){console.log("last BautagebuchMediaFile done (with file)");
i=true;c(e)}},function(){var j=function(){if(g===f&&i===false){console.log("last BautagebuchMediaFile done (last file load failed)");i=true;c(e)}};trackError("loading BautagebuchMediaFile "+h.get("fileName")+" failed!");DigiWebApp.ApplicationController.nativeConfirmDialogView({title:M.I18N.l("error"),message:M.I18N.l("loadingFileFailed")+" (DIGIWebAppData/"+h.get("fileName")+")",callbacks:{confirm:{action:function(){writeToLog("l\u00f6sche BautagebuchMediaFile "+h.get("fileName"));h.del();j()}},cancel:{action:function(){j()}}}})})}else if(g===
f&&i===false){console.log("last mediaFile done (no file)");i=true;c(e)}}):c(e)},sendeBautagesberichtFertig:function(a,b,c){a.set("bautagesberichtId",a.get("id"));a.set("transferCompleted",YES);c={data:a.record,webservice:"bautagesbericht",loaderText:M.I18N.l("BautagebuchSendeBautagesbericht"),successCallback:function(d,e,f){f.status>199&&f.status<300?a.deleteSorted(function(){DigiWebApp.BautagebuchBautagesberichteListeController.set("items",DigiWebApp.BautagebuchBautagesbericht.findSorted());DigiWebApp.BautagebuchDatenuebertragungController.consoleLogOutput&&
console.log("sendeBautagesberichtFertig Status: "+f.status);typeof b==="function"&&b(d,e,f)}):trackError("Request ended with status: "+f.status)},errorCallback:c};DigiWebApp.JSONDatenuebertragungController.sendData(c)},sendBautagesberichtFunc:function(a){if(DigiWebApp.BautagebuchZusammenfassungController.item){DigiWebApp.BautagebuchZusammenfassungController.load(DigiWebApp.BautagebuchZusammenfassungController.item);this.senden(DigiWebApp.BautagebuchZusammenfassungController.item,function(){typeof a==
"function"&&a()},function(){typeof a=="function"&&a()})}else typeof a=="function"&&a()},ausgekoppelteNotizSenden:function(a){var b=this;(function(c){DigiWebApp.BautagebuchBautagesberichteListeController.init();var d=DigiWebApp.BautagebuchBautagesbericht.find(),e=null;_.each(d,function(f){if(f.get("bautagesberichtTyp")=="<notizen_only>")e=f});if(e){DigiWebApp.BautagebuchBautagesberichtDetailsController.load(e);DigiWebApp.BautagebuchZusammenfassungController.load(DigiWebApp.BautagebuchBautagesberichtDetailsController.item);
DigiWebApp.BautagebuchZusammenfassungController.finish(c)}else typeof c=="function"&&c()})(function(){b.sendBautagesberichtFunc(a)})},ausgekoppelteMaterialerfassungSenden:function(a){var b=this;(function(c){DigiWebApp.BautagebuchBautagesberichteListeController.init();var d=DigiWebApp.BautagebuchBautagesbericht.find(),e=null;_.each(d,function(f){if(f.get("bautagesberichtTyp")=="<materialerfassung_only>")e=f});if(e){DigiWebApp.BautagebuchBautagesberichtDetailsController.load(e);DigiWebApp.BautagebuchZusammenfassungController.load(DigiWebApp.BautagebuchBautagesberichtDetailsController.item);
DigiWebApp.BautagebuchZusammenfassungController.finish(c)}else typeof c=="function"&&c()})(function(){b.sendBautagesberichtFunc(a)})},ausgekoppelteSenden:function(a){var b=this;b.ausgekoppelteMaterialerfassungSenden(function(){b.ausgekoppelteNotizSenden(a)})}});
DigiWebApp.BautagebuchEinstellungenController=M.Controller.extend({settings:{startUhrzeit:"08:00",inStundenBuchen:NO,inStundenBuchenItem:[{value:"inStundenBuchen",label:M.I18N.l("BautagebuchInStundenBuchen"),isSelected:NO}],falscheZeitenIgnorieren:NO,falscheZeitenIgnorierenItem:[{value:"falscheZeitenIgnorieren",label:M.I18N.l("falscheZeitenIgnorieren"),isSelected:NO}],positionVorselektieren:NO,positionVorselektierenItem:[{value:"positionVorselektieren",label:M.I18N.l("positionVorselektieren"),isSelected:NO}],
alleMitarbeiterVorselektiert:NO,alleMitarbeiterVorselektiertItem:[{value:"alleMitarbeiterVorselektiert",label:M.I18N.l("alleMitarbeiterVorselektiert"),isSelected:NO}],minutenSchritte:5,minutenSchritteItem:[{value:"1",label:"1",isSelected:NO},{value:"5",label:"5",isSelected:YES},{value:"10",label:"10",isSelected:NO},{value:"15",label:"15",isSelected:NO},{value:"20",label:"20",isSelected:NO},{value:"30",label:"30",isSelected:NO}]},init:function(){this.load()},lastPage:null,load:function(){this.set("settings.startUhrzeit",
this.settings.startUhrzeit);this.set("settings.inStundenBuchen",this.settings.inStundenBuchen);this.set("settings.inStundenBuchenItem",this.settings.inStundenBuchenItem);this.set("settings.falscheZeitenIgnorieren",this.settings.falscheZeitenIgnorieren);this.set("settings.falscheZeitenIgnorierenItem",this.settings.falscheZeitenIgnorierenItem);this.set("settings.positionVorselektieren",this.settings.positionVorselektieren);this.set("settings.positionVorselektierenItem",this.settings.positionVorselektierenItem);
this.set("settings.alleMitarbeiterVorselektiert",this.settings.alleMitarbeiterVorselektiert);this.set("settings.alleMitarbeiterVorselektiertItem",this.settings.alleMitarbeiterVorselektiertItem);this.set("settings.minutenSchritte",this.settings.minutenSchritte);this.set("settings.minutenSchritteItem",this.settings.minutenSchritteItem);if(DigiWebApp.BautagebuchEinstellungen.find().length===0){var a=DigiWebApp.BautagebuchEinstellungen.createRecord({startUhrzeit:this.settings.startUhrzeit,inStundenBuchen:this.settings.inStundenBuchen,
falscheZeitenIgnorieren:this.settings.falscheZeitenIgnorieren,positionVorselektieren:this.settings.positionVorselektieren,minutenSchritte:this.settings.minutenSchritte,alleMitarbeiterVorselektiert:this.settings.alleMitarbeiterVorselektiert});a.save()}else{a=DigiWebApp.BautagebuchEinstellungen.find()[0];this.set("settings.startUhrzeit",a.get("startUhrzeit"));if(typeof a.get("inStundenBuchen")!=="undefined"){this.set("settings.inStundenBuchen",a.get("inStundenBuchen"));this.set("settings.inStundenBuchenItem",
[{value:"inStundenBuchen",label:M.I18N.l("BautagebuchInStundenBuchen"),isSelected:a.get("inStundenBuchen")}])}if(typeof a.get("falscheZeitenIgnorieren")!=="undefined"){this.set("settings.falscheZeitenIgnorieren",a.get("falscheZeitenIgnorieren"));this.set("settings.falscheZeitenIgnorierenItem",[{value:"falscheZeitenIgnorieren",label:M.I18N.l("falscheZeitenIgnorieren"),isSelected:a.get("falscheZeitenIgnorieren")}])}if(typeof a.get("positionVorselektieren")!=="undefined"){this.set("settings.positionVorselektieren",
a.get("positionVorselektieren"));this.set("settings.positionVorselektierenItem",[{value:"positionVorselektieren",label:M.I18N.l("positionVorselektieren"),isSelected:a.get("positionVorselektieren")}])}if(typeof a.get("alleMitarbeiterVorselektiert")!=="undefined"){this.set("settings.alleMitarbeiterVorselektiert",a.get("alleMitarbeiterVorselektiert"));this.set("settings.alleMitarbeiterVorselektiertItem",[{value:"alleMitarbeiterVorselektiert",label:M.I18N.l("alleMitarbeiterVorselektiert"),isSelected:a.get("alleMitarbeiterVorselektiert")}])}if(typeof a.get("minutenSchritte")!==
"undefined"){this.set("settings.minutenSchritte",a.get("minutenSchritte"));this.set("settings.minutenSchritteItem",_.map(this.settings.minutenSchritteItem,function(b){b.isSelected=NO;if(parseIntRadixTen(b.value)==parseIntRadixTen(a.get("minutenSchritte")))b.isSelected=YES;return b}))}}},save:function(){var a=DigiWebApp.BautagebuchEinstellungen.find()[0];a.set("startUhrzeit",this.settings.startUhrzeit);a.set("inStundenBuchen",this.settings.inStundenBuchen);a.set("falscheZeitenIgnorieren",this.settings.falscheZeitenIgnorieren);
a.set("positionVorselektieren",this.settings.positionVorselektieren);a.set("alleMitarbeiterVorselektiert",this.settings.alleMitarbeiterVorselektiert);a.set("minutenSchritte",this.settings.minutenSchritte);a.save()},setStartUhrzeit:function(){if(DigiWebApp.BautagebuchEinstellungenController.settings.startUhrzeit){$("#"+DigiWebApp.BautagebuchEinstellungenPage.content.startUhrzeitContainer.startUhrzeitGrid.stundeFeld.id)[0].value=parseIntRadixTen(DigiWebApp.BautagebuchEinstellungenController.settings.startUhrzeit.split(":")[0],
10).padLeft(2,"0");$("#"+DigiWebApp.BautagebuchEinstellungenPage.content.startUhrzeitContainer.startUhrzeitGrid.minuteFeld.id)[0].value=parseIntRadixTen(DigiWebApp.BautagebuchEinstellungenController.settings.startUhrzeit.split(":")[1],10).padLeft(2,"0")}}});
DigiWebApp.BautagebuchMainController=M.Controller.extend({projektleiter:null,mitarbeiter:null,auftraege:null,materialien:null,mengeneinheiten:null,buttonPressInterval_var:null,buttonPressInterval:200,wetterDefaults:{temperatur:10,luftfeuchtigkeit:50,bewoelkung:0,niederschlag:0,wind:0,wechselhaft:NO,wechselhaftItem:[{value:"wechselhaft",label:M.I18N.l("BautagebuchWechselhaft"),isSelected:NO}]},init:function(){DigiWebApp.BautagebuchEinstellungenController.load();var a=NO;try{var b=DigiWebApp.BautagebuchProjektleiter.find();
if(b.length!==0){a=NO;b=_.sortBy(b,function(o){return o.get("nachname")+", "+o.get("vorname")});var c=-1,d=_.map(b,function(o){c+=1;if(typeof o==="undefined")console.log("UNDEFINED PROJEKTLEADER");else{try{var p={label:o.vollername(),value:o.get("id"),order:c}}catch(q){console.log(o);throw q;}return p}});d=_.compact(d);d.push({label:M.I18N.l("selectSomething"),value:"0",isSelected:!a});this.set("projektleiter",d)}var e=DigiWebApp.BautagebuchMitarbeiter.find();if(e.length!==0){a=NO;e=_.sortBy(e,function(o){return o.get("nachname")+
", "+o.get("vorname")});c=-1;var f=_.map(e,function(o){c+=1;if(typeof o==="undefined")console.log("UNDEFINED WORKER");else{try{var p={label:o.vollername(),value:o.get("id"),order:c}}catch(q){console.log(o);throw q;}p.isSelected=NO;return p}});f=_.compact(f);this.set("mitarbeiter",f)}a=NO;var g=DigiWebApp.HandOrder.findSorted().concat(DigiWebApp.Order.findSorted()),i=_.map(_.compact(g),function(o){if(typeof o==="undefined")console.log("UNDEFINED ORDER");else{try{var p={label:o.get("name"),value:o.get("id")}}catch(q){console.log(o);
throw q;}return p}});i=_.compact(i);i.push({label:M.I18N.l("selectSomething"),value:"0",isSelected:!a});this.set("auftraege",i);a=NO;var h=DigiWebApp.Position.findSorted(),j=_.map(_.compact(h),function(o){if(typeof o==="undefined")console.log("UNDEFINED ORDER");else{try{var p={label:o.get("name"),value:o.get("id")}}catch(q){console.log(o);throw q;}return p}});j=_.compact(j);j.push({label:M.I18N.l("selectSomething"),value:"0",isSelected:!a});this.set("positionen",j);b=[];if(DigiWebApp.BautagebuchMaterial.findSorted().length!==
0){a=NO;var l=DigiWebApp.BautagebuchMaterial.findSorted();b=_.map(l,function(o){if(typeof o==="undefined")console.log("UNDEFINED MATERIAL");else{try{var p={label:o.get("bezeichnung"),value:o.get("id")}}catch(q){console.log(o);throw q;}return p}});b=_.compact(b)}b.push({label:M.I18N.l("BautagebuchManuelleEingabe"),value:"0",isSelected:!a});this.set("materialien",b);l=[];var n=DigiWebApp.BautagebuchMengeneinheit.findSorted();if(n.length!==0){a=NO;l=_.map(n,function(o){if(typeof o==="undefined")console.log("UNDEFINED MATERIAL");
else{try{var p={label:o.get("kuerzel"),value:o.get("id")}}catch(q){console.log(o);throw q;}return p}});l=_.compact(l)}l.push({label:M.I18N.l("selectSomething"),value:"0",isSelected:!a});this.set("mengeneinheiten",l)}catch(m){trackError(m)}}});
DigiWebApp.BautagebuchMaterialienDetailsController=M.Controller.extend({item:null,auftragId:null,auftragName:null,auftraegeList:null,handOrderId:null,handOrderName:null,positionId:null,positionName:null,positionenList:null,activityId:null,activityName:null,activityList:null,materialId:null,materialienList:null,artikel:null,mengeneinheitId:null,mengeneinheitenList:null,einheit:null,materialgruppeId:null,materialgruppeBezeichnung:null,materialgruppenList:null,materialtypId:null,materialtypBezeichnung:null,
materialtypenList:null,herstellerId:null,herstellerBezeichnung:null,herstellerList:null,lieferantId:null,lieferantBezeichnung:null,lieferantenList:null,menge:null,getMaterialFilterObj:function(){return{lieferantId:this.lieferantId,herstellerId:this.herstellerId,materialgruppeId:this.materialgruppeId,materialtypId:this.materialtypId}},init:function(){if(DigiWebApp.BautagebuchBautagesberichtDetailsController.auftragsId){this.set("auftragsId",DigiWebApp.BautagebuchBautagesberichtDetailsController.auftragsId);
this.set("auftragsName",DigiWebApp.BautagebuchBautagesberichtDetailsController.auftragsName)}},load:function(a){this.set("item",a);var b=_.filter(DigiWebApp.Position.findSorted(),function(e){return e.get("id")==a.get("positionId")})[0],c=_.filter(DigiWebApp.HandOrder.findSorted().concat(DigiWebApp.Order.findSorted()),function(e){return a.get("handOrderId")&&a.get("handOrderId").length>0?e.get("id")==a.get("handOrderId"):e.get("id")==b.get("orderId")})[0],d=c.get("id");c=c.get("name");this.set("auftragId",
d);this.set("auftragName",c);this.set("handOrderId",a.get("handOrderId"));this.set("handOrderName",a.get("handOrderName"));this.set("positionId",a.get("positionId"));this.set("positionName",a.get("positionName"));this.set("activityId",a.get("activityId"));this.set("activityName",a.get("activityName"));this.set("menge",a.get("menge"));this.set("mengeneinheitId",a.get("mengeneinheitId"));this.set("einheit",a.get("einheit"));this.set("materialId",a.get("materialId"));this.set("artikel",a.get("artikel"));
this.set("materialgruppeId",a.get("materialgruppeId"));this.set("materialtypId",a.get("materialtypId"));this.set("lieferantId",a.get("lieferantId"));this.set("herstellerId",a.get("herstellerId"));this.setTaetigkeiten(a.get("positionId"))},save:function(){if(DigiWebApp.BautagebuchBautagesberichtDetailsController.item.get("bautagesberichtTyp")=="<materialerfassung_only>")if(M.ViewManager.getView("bautagebuchMaterialienDetailsPage","auftragComboBox").getSelection()==="0"){DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("noOrderSelected"),
message:M.I18N.l("noOrderSelectedMsg")});return false}if(M.ViewManager.getView("bautagebuchMaterialienDetailsPage","positionComboBox").getSelection()==="0"){DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("noPosSelected"),message:M.I18N.l("noPosSelectedMsg")});return false}if(!this.artikel){DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("BautagebuchKeinMaterial"),message:M.I18N.l("BautagebuchKeinMaterialMsg")});return false}if(!this.mengeneinheitId){DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("BautagebuchKeineEinheit"),
message:M.I18N.l("BautagebuchKeineEinheitMsg")});return false}if(this.menge)if(this.menge.indexOf(".")!==-1&&this.menge.indexOf(",")!==-1){DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("ungueltigeZahl"),message:M.I18N.l("ungueltigeZahlMsg")});return false}else{if(isNaN(parseFloat(this.menge))){DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("BautagebuchUngueltigeMenge"),message:M.I18N.l("BautagebuchUngueltigeMengeMsg")});return false}}else{DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("BautagebuchKeineMenge"),
message:M.I18N.l("BautagebuchKeineMengeMsg")});return false}M.I18N.getLanguage()!=="de_de"&&M.I18N.getLanguage();this.set("menge",this.menge.replace(",","."));this.set("menge",parseFloat(this.menge));if(this.handOrderId){this.item.set("handOrderId",this.handOrderId);this.item.set("handOrderName",this.handOrderName);this.item.set("positionId",null);this.item.set("positionName",null);this.item.set("orderId",null);this.item.set("orderName",null)}else{this.item.set("handOrderId",null);this.item.set("handOrderName",
null);this.item.set("positionId",this.positionId);this.item.set("positionName",this.positionName);this.item.set("orderId",this.auftragId);this.item.set("orderName",this.auftragName)}if(parseIntRadixTen(this.activityId)!==0){this.item.set("activityId",this.activityId);this.item.set("activityName",this.activityName)}else{this.item.set("activityId",null);this.item.set("activityName",null)}this.item.set("menge",this.menge);this.item.set("mengeneinheitId",this.mengeneinheitId);this.item.set("einheit",
this.einheit);this.item.set("materialId",this.materialId);this.item.set("artikel",this.artikel);this.item.set("materialgruppeId",this.materialgruppeId);this.item.set("materialtypId",this.materialtypId);this.item.set("lieferantId",this.lieferantId);this.item.set("herstellerId",this.herstellerId);if(this.item.saveSorted()){DigiWebApp.BautagebuchMaterialienListeController.set("items",DigiWebApp.BautagebuchMaterialBuchung.findSorted(DigiWebApp.BautagebuchBautagesberichtDetailsController.item.get("id")));
DigiWebApp.NavigationController.backToBautagebuchMaterialienListePageTransition();return true}else return false},deleteMaterialbuchung:function(){var a=this;DigiWebApp.ApplicationController.nativeConfirmDialogView({title:M.I18N.l("deleteLabel"),message:M.I18N.l("wirklichLoeschenMsg"),confirmButtonValue:M.I18N.l("yes"),cancelButtonValue:M.I18N.l("no"),callbacks:{confirm:{target:this,action:function(){if(a.item.deleteSorted()){DigiWebApp.BautagebuchMaterialienListeController.set("items",DigiWebApp.BautagebuchMaterialBuchung.findSorted(DigiWebApp.BautagebuchBautagesberichtDetailsController.item.get("id")));
DigiWebApp.NavigationController.backToBautagebuchMaterialienListePageTransition();return true}else return false}},cancel:{target:this,action:function(){return true}}}})},setPositionen:function(a){var b=this;if(typeof a==="undefined")return false;else{var c=NO,d=_.map(DigiWebApp.Position.findSorted(),function(e){if(typeof e==="undefined")console.log("UNDEFINED Position");else if(parseIntRadixTen(e.get("orderId"))==parseIntRadixTen(a)){var f={label:e.get("name"),value:e.get("id"),isSelected:NO};if(parseIntRadixTen(e.get("id"))==
parseIntRadixTen(b.item.get("positionId"))){c=f.isSelected=YES;b.set("positionId",e.get("id"));b.set("positionName",e.get("name"))}return f}});d=_.compact(d);if(!c&&a&&d.length>0){d[0].isSelected=YES;b.set("positionId",d[0].value);b.set("positionName",d[0].label)}b.set("positionenList",d)}},setTaetigkeiten:function(a){var b=this;if(typeof a!=="undefined"){var c=_.select(DigiWebApp.WorkPlan.find(),function(e){if(e)return e.get("id")==a}),d=NO;c=c.length>0?DigiWebApp.SelectionController.getActivitiesFromWorkplan(c[0]):
DigiWebApp.SelectionController.getActivities();c=_.map(c,function(e){if(typeof e==="undefined")console.log("UNDEFINED activity");else{e={label:e.get("name"),value:e.get("id"),isSelected:NO};if(b.activityId===e.value)d=e.isSelected=YES;return e}});c=_.compact(c);c.push({label:M.I18N.l("selectSomethingOptional"),value:"0",isSelected:!d});b.set("activityList",c)}},setLieferanten:function(){var a=DigiWebApp.BautagebuchMaterialienDetailsController,b=a.getMaterialFilterObj();b.selectedId=a.lieferantId;
a.set("lieferantenList",DigiWebApp.BautagebuchLieferant.getList(b));(b=_.find(a.lieferantenList,function(c){return c.isSelected}).value)&&b>0&&a.set("lieferantId",b)},setHersteller:function(){var a=DigiWebApp.BautagebuchMaterialienDetailsController,b=a.getMaterialFilterObj();b.selectedId=a.herstellerId;a.set("herstellerList",DigiWebApp.BautagebuchHersteller.getList(b));(b=_.find(a.herstellerList,function(c){return c.isSelected}).value)&&b>0&&a.set("herstellerId",b)},setMaterialtypen:function(){var a=
DigiWebApp.BautagebuchMaterialienDetailsController,b=a.getMaterialFilterObj();b.selectedId=a.materialtypId;a.set("materialtypenList",DigiWebApp.BautagebuchMaterialtyp.getList(b));(b=_.find(a.materialtypenList,function(c){return c.isSelected}).value)&&b>0&&a.set("materialtypId",b)},setMaterialgruppen:function(a){var b=DigiWebApp.BautagebuchMaterialienDetailsController,c=b.getMaterialFilterObj();c.selectedId=b.materialgruppeId;b.set("materialgruppenList",DigiWebApp.BautagebuchMaterialgruppe.getList(c));
(c=_.find(b.materialgruppenList,function(d){return d.isSelected}).value)&&c>0&&b.set("materialgruppeId",c);b.setMaterialien(a)},setMaterialien:function(a){var b=DigiWebApp.BautagebuchMaterialienDetailsController,c=b.getMaterialFilterObj();c.selectedId=b.materialId;b.set("materialienList",DigiWebApp.BautagebuchMaterial.getList(c));c=_.find(b.materialienList,function(e){return e.isSelected}).value;var d=_.find(b.materialienList,function(e){return e.isSelected}).label;if(c&&c>0){b.set("artikel",d);b.set("materialId",
c)}if(DigiWebApp.BautagebuchMaterialienDetailsController.materialId&&DigiWebApp.BautagebuchMaterialienDetailsController.materialId!=="0"&&DigiWebApp.BautagebuchMaterialienDetailsController.materialId!==null&&DigiWebApp.BautagebuchMaterialienDetailsController.materialId!=="")$("#"+DigiWebApp.BautagebuchMaterialienDetailsPage.content.materialInput.id).parent().hide();else{$("#"+DigiWebApp.BautagebuchMaterialienDetailsPage.content.materialInput.id).parent().show();M.ViewManager.getView("bautagebuchMaterialienDetailsPage",
"materialInput").setValue(DigiWebApp.BautagebuchMaterialienDetailsController.artikel)}a||b.set("mengeneinheitId",null);b.setMengeneinheiten(a)},setMengeneinheiten:function(){var a=DigiWebApp.BautagebuchMaterialienDetailsController,b=null;b=a.materialId&&a.materialId>0?DigiWebApp.BautagebuchMaterial.getById(a.materialId).getMengeneinheiten():DigiWebApp.BautagebuchMengeneinheit.findSorted();b={items:b};if(a.mengeneinheitId)b.selectedId=a.mengeneinheitId;else if(a.materialId&&a.materialId>0)b.selectedId=
DigiWebApp.BautagebuchMaterial.getById(a.materialId).get("standardEinheitId");a.set("mengeneinheitenList",DigiWebApp.BautagebuchMengeneinheit.getList(b));b=_.find(a.mengeneinheitenList,function(d){return d.isSelected}).value;var c=_.find(a.mengeneinheitenList,function(d){return d.isSelected}).label;if(b&&b>0){a.set("einheit",c);a.set("mengeneinheitId",b)}}});
DigiWebApp.BautagebuchMaterialienListeController=M.Controller.extend({items:null,init:function(){var a=DigiWebApp.BautagebuchMaterialBuchung.findSorted(DigiWebApp.BautagebuchBautagesberichtDetailsController.item.get("id"));if(a.length==0)$("#"+DigiWebApp.BautagebuchMaterialienListePage.uebertragenButton.id).hide();else DigiWebApp.BautagebuchBautagesberichtDetailsController.item.get("bautagesberichtTyp")!="<standard>"?$("#"+DigiWebApp.BautagebuchMaterialienListePage.uebertragenButton.id).show():$("#"+
DigiWebApp.BautagebuchMaterialienListePage.uebertragenButton.id).hide();this.set("items",a)},neu:function(){DigiWebApp.BautagebuchMaterialienDetailsController.set("item",DigiWebApp.BautagebuchMaterialBuchung.createRecord({bautagesberichtId:DigiWebApp.BautagebuchBautagesberichtDetailsController.item.get("id")}));if(DigiWebApp.BautagebuchBautagesberichtDetailsController.item.get("orderId")){DigiWebApp.BautagebuchMaterialienDetailsController.set("auftragId",DigiWebApp.BautagebuchBautagesberichtDetailsController.item.get("orderId"));
DigiWebApp.BautagebuchMaterialienDetailsController.set("auftragName",DigiWebApp.BautagebuchBautagesberichtDetailsController.item.get("orderName"))}else{DigiWebApp.BautagebuchMaterialienDetailsController.set("auftragId",null);DigiWebApp.BautagebuchMaterialienDetailsController.set("auftragName",null)}if(DigiWebApp.BautagebuchBautagesberichtDetailsController.item.get("handOrderId")){DigiWebApp.BautagebuchMaterialienDetailsController.set("handOrderId",DigiWebApp.BautagebuchBautagesberichtDetailsController.item.get("handOrderId"));
DigiWebApp.BautagebuchMaterialienDetailsController.set("handOrderName",DigiWebApp.BautagebuchBautagesberichtDetailsController.item.get("handOrderName"))}else{DigiWebApp.BautagebuchMaterialienDetailsController.set("handOrderId",null);DigiWebApp.BautagebuchMaterialienDetailsController.set("handOrderName",null)}DigiWebApp.BautagebuchMaterialienDetailsController.set("positionId",null);DigiWebApp.BautagebuchMaterialienDetailsController.set("positionName",null);DigiWebApp.BautagebuchMaterialienDetailsController.set("activityId",
null);DigiWebApp.BautagebuchMaterialienDetailsController.set("activityName",null);DigiWebApp.BautagebuchMaterialienDetailsController.set("menge",null);DigiWebApp.BautagebuchMaterialienDetailsController.set("mengeneinheitId",null);DigiWebApp.BautagebuchMaterialienDetailsController.set("einheit",null);DigiWebApp.BautagebuchMaterialienDetailsController.set("materialId",null);DigiWebApp.BautagebuchMaterialienDetailsController.set("artikel",null);DigiWebApp.BautagebuchMaterialienDetailsController.set("materialtypId",
null);DigiWebApp.BautagebuchMaterialienDetailsController.set("materialgruppeId",null);DigiWebApp.BautagebuchMaterialienDetailsController.set("herstellerId",null);DigiWebApp.BautagebuchMaterialienDetailsController.set("lieferantId",null);DigiWebApp.NavigationController.toBautagebuchMaterialienDetailsPageTransition()}});
DigiWebApp.BautagebuchMedienDetailsController=M.Controller.extend({item:null,handOrderId:null,handOrderName:null,auftragId:null,auftragName:null,auftraegeList:null,positionId:null,positionName:null,positionenList:null,activityId:null,activityName:null,activityList:null,mitarbeiterId:null,data:null,remark:null,fileType:null,loadedFileName:null,init:function(){},load:function(a){var b=this;b.set("item",a);var c=_.filter(DigiWebApp.Position.findSorted(),function(f){return f.get("id")==a.get("positionId")})[0],
d=_.filter(DigiWebApp.HandOrder.findSorted().concat(DigiWebApp.Order.findSorted()),function(f){return a.get("handOrderId")&&a.get("handOrderId").length>0?f.get("id")==a.get("handOrderId"):f.get("id")==c.get("orderId")})[0],e=d.get("id");d=d.get("name");b.set("auftragId",e);b.set("auftragName",d);b.set("handOrderId",a.get("handOrderId"));b.set("handOrderName",a.get("handOrderName"));b.set("positionId",a.get("positionId"));b.set("positionName",a.get("positionName"));b.set("activityId",a.get("activityId"));
b.set("activityName",a.get("activityName"));b.set("mitarbeiterId",a.get("mitarbeiterId"));document.getElementById(DigiWebApp.BautagebuchMedienDetailsPage.content.image.id).src="";a.readFromFile(function(f){DigiWebApp.ApplicationController.DigiLoaderView.hide();if(f&&f!==""){b.set("data",f);document.getElementById(DigiWebApp.BautagebuchMedienDetailsPage.content.image.id).src=f}},function(){b.set("data",null);document.getElementById(DigiWebApp.BautagebuchMedienDetailsPage.content.image.id).src=""});
b.set("remark",a.get("remark"))},save:function(){var a=this;if(M.ViewManager.getView("bautagebuchMedienDetailsPage","positionComboBox").getSelection()==="0"){DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("noPosSelected"),message:M.I18N.l("noPosSelectedMsg")});return false}if(a.handOrderId){a.item.set("handOrderId",a.handOrderId);a.item.set("handOrderName",a.handOrderName);a.item.set("positionId",null);a.item.set("positionName",null)}else{a.item.set("handOrderId",null);a.item.set("handOrderName",
null);a.item.set("positionId",a.positionId);a.item.set("positionName",a.positionName)}if(parseIntRadixTen(a.activityId)!==0){a.item.set("activityId",a.activityId);a.item.set("activityName",a.activityName)}else{a.item.set("activityId",null);a.item.set("activityName",null)}a.remark!==DigiWebApp.BautagebuchMedienDetailsPage.content.remarkInput.initialText?a.item.set("remark",a.remark):a.item.set("remark",null);a.item.set("mitarbeiterId",a.mitarbeiterId);var b=a.item.state==M.STATE_NEW;if(a.item.saveSorted()){var c=
document.getElementById(DigiWebApp.BautagebuchMedienDetailsPage.content.image.id);a.item.saveToFile(c.src,function(){var d=function(){DigiWebApp.ApplicationController.DigiLoaderView.hide();DigiWebApp.BautagebuchMedienListeController.set("items",DigiWebApp.BautagebuchMediaFile.findSorted(DigiWebApp.BautagebuchBautagesberichtDetailsController.item.get("id")));DigiWebApp.NavigationController.backToBautagebuchMedienListePageTransition()};if(b)DigiWebApp.ApplicationController.nativeConfirmDialogView({title:M.I18N.l("bautagebuchWeiteresFoto"),
message:M.I18N.l("bautagebuchWeiteresFotoMsg"),confirmButtonValue:M.I18N.l("yes"),cancelButtonValue:M.I18N.l("no"),callbacks:{confirm:{target:this,action:function(){var e=JSON.parse(JSON.stringify(a.item));DigiWebApp.BautagebuchMedienListeController.neu(YES);if(a.handOrderId){a.set("handOrderId",e.record.handOrderId);a.set("handOrderName",e.record.handOrderName);a.set("positionId",null);a.set("positionName",null)}else{a.set("handOrderId",null);a.set("handOrderName",null);a.set("positionId",e.record.positionId);
a.set("positionName",e.record.positionName)}a.set("activityId",e.record.activityId);a.set("activityName",e.record.activityName);a.set("mitarbeiterId",e.record.mitarbeiterId)}},cancel:{target:this,action:function(){d();return true}}}});else{d();return true}});return true}else return false},deleteMedienBuchung:function(){var a=this;DigiWebApp.ApplicationController.nativeConfirmDialogView({title:M.I18N.l("deleteLabel"),message:M.I18N.l("wirklichLoeschenMsg"),confirmButtonValue:M.I18N.l("yes"),cancelButtonValue:M.I18N.l("no"),
callbacks:{confirm:{target:this,action:function(){if(a.item.deleteSorted()!==false){DigiWebApp.BautagebuchMedienListeController.set("items",DigiWebApp.BautagebuchMediaFile.findSorted(DigiWebApp.BautagebuchBautagesberichtDetailsController.item.get("id")));DigiWebApp.NavigationController.backToBautagebuchMedienListePageTransition();return true}else return false}},cancel:{target:this,action:function(){return true}}}})},setTaetigkeiten:function(a){var b=this;if(typeof a!=="undefined"){var c=_.select(DigiWebApp.WorkPlan.find(),
function(f){if(f)return f.get("id")==a}),d=NO,e=null;e=c.length>0?DigiWebApp.SelectionController.getActivitiesFromWorkplan(c[0]):DigiWebApp.SelectionController.getActivities();c=_.map(e,function(f){if(typeof f==="undefined")console.log("UNDEFINED activity");else{f={label:f.get("name"),value:f.get("id"),isSelected:NO};if(b.activityId===f.value)d=f.isSelected=YES;return f}});c=_.compact(c);c.push({label:M.I18N.l("selectSomethingOptional"),value:"0",isSelected:!d});b.set("activityList",c)}},takePicture:function(){navigator.camera.getPicture(this.cameraSuccessBase64,
this.cameraError,{quality:40,destinationType:navigator.camera.DestinationType.DATA_URL})},cameraSuccessBase64:function(a){var b=DigiWebApp.BautagebuchMedienDetailsController;b.set("data",a);b.set("fileType",DigiWebApp.ApplicationController.getImageFiletype());document.getElementById(DigiWebApp.BautagebuchMedienDetailsPage.content.image.id).src="data:"+DigiWebApp.ApplicationController.getImageFiletype()+","+a;DigiWebApp.NavigationController.toBautagebuchMedienDetailsPageTransition()},cameraError:function(a){DigiWebApp.ApplicationController.nativeAlertDialogView({title:"ERROR",
message:a,callbacks:{confirm:{target:this,action:function(){DigiWebApp.NavigationController.backToBautagebuchMedienListePageTransition()}}}})}});
DigiWebApp.BautagebuchMedienListeController=M.Controller.extend({items:null,letzteFotoQuelle:null,init:function(){this.set("items",DigiWebApp.BautagebuchMediaFile.findSorted(DigiWebApp.BautagebuchBautagesberichtDetailsController.item.get("id")))},neu:function(a){DigiWebApp.SettingsController.getSetting("pictureEncodingType").toLowerCase();DigiWebApp.BautagebuchMedienDetailsController.set("item",DigiWebApp.BautagebuchMediaFile.createRecord({bautagesberichtId:DigiWebApp.BautagebuchBautagesberichtDetailsController.item.get("id"),
fileType:DigiWebApp.ApplicationController.getImageFiletype()}));if(DigiWebApp.BautagebuchBautagesberichtDetailsController.item.get("orderId")){DigiWebApp.BautagebuchMedienDetailsController.set("auftragId",DigiWebApp.BautagebuchBautagesberichtDetailsController.item.get("orderId"));DigiWebApp.BautagebuchMedienDetailsController.set("auftragName",DigiWebApp.BautagebuchBautagesberichtDetailsController.item.get("orderName"))}else{DigiWebApp.BautagebuchMedienDetailsController.set("auftragId",null);DigiWebApp.BautagebuchMedienDetailsController.set("auftragName",
null)}if(DigiWebApp.BautagebuchBautagesberichtDetailsController.item.get("handOrderId")){DigiWebApp.BautagebuchMedienDetailsController.set("handOrderId",DigiWebApp.BautagebuchBautagesberichtDetailsController.item.get("handOrderId"));DigiWebApp.BautagebuchMedienDetailsController.set("handOrderName",DigiWebApp.BautagebuchBautagesberichtDetailsController.item.get("handOrderName"))}else{DigiWebApp.BautagebuchMedienDetailsController.set("handOrderId",null);DigiWebApp.BautagebuchMedienDetailsController.set("handOrderName",
null)}if(DigiWebApp.BautagebuchBautagesberichtDetailsController.item.get("positionId")){DigiWebApp.BautagebuchMedienDetailsController.set("positionId",DigiWebApp.BautagebuchBautagesberichtDetailsController.item.get("positionId"));DigiWebApp.BautagebuchMedienDetailsController.set("positionName",DigiWebApp.BautagebuchBautagesberichtDetailsController.item.get("positionName"))}DigiWebApp.BautagebuchMedienDetailsController.set("mitarbeiterId",DigiWebApp.BautagebuchBautagesberichtDetailsController.item.get("projektleiterId"));
DigiWebApp.BautagebuchMedienDetailsController.set("activityId",null);DigiWebApp.BautagebuchMedienDetailsController.set("activityName",null);DigiWebApp.BautagebuchMedienDetailsController.set("data",null);DigiWebApp.BautagebuchMedienDetailsController.set("remark",null);DigiWebApp.BautagebuchMedienDetailsController.set("fileType",DigiWebApp.ApplicationController.getImageFiletype());var b=function(){if(typeof navigator.camera!=="undefined"&&typeof navigator.camera.getPicture!=="undefined")navigator.camera.getPicture(function(d){var e=
DigiWebApp.BautagebuchMedienDetailsController,f=document.getElementById(DigiWebApp.BautagebuchMedienDetailsPage.content.image.id);f.src=d.indexOf("data:")===0?d:"data:"+DigiWebApp.ApplicationController.getImageFiletype()+","+d;e.set("data",f.src);e.set("fileType",DigiWebApp.ApplicationController.getImageFiletype());DigiWebApp.NavigationController.toBautagebuchMedienDetailsPageTransition()},function(d){DigiWebApp.BautagebuchMedienDetailsController.set("data",null);DigiWebApp.BautagebuchMedienDetailsController.set("fileType",
null);DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("error"),message:M.I18N.l("noPicLoaded")+": "+d})},{quality:40,allowEdit:true,destinationType:navigator.camera.DestinationType.DATA_URL,encodingType:navigator.camera.EncodingType.JPEG,sourceType:navigator.camera.PictureSourceType.PHOTOLIBRARY,mediaType:navigator.camera.MediaType.PICTURE,saveToPhotoAlbum:false});else{DigiWebApp.FileChooserPage.set("successCallback",function(d,e){var f=DigiWebApp.BautagebuchMedienDetailsController;
if(d!==null){var g=document.getElementById(DigiWebApp.BautagebuchMedienDetailsPage.content.image.id);f.set("loadedFileName",e);for(var i="",h=e,j=0;j!==-1;){h=h.substr(j+1);j=h.indexOf(".")}h=h.toLowerCase();switch(h){case "jpg":i="image/jpeg";break;case "jpeg":i="image/"+h;break;case "png":i="image/"+h;break;case "bmp":i="image/"+h}switch(i){case "":f.set("loadedPicture",null);f.set("fileType",null);DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("error"),message:M.I18N.l("noPicLoaded")});
break;default:f.set("fileType",i);g.src=d.indexOf("data:")===0?d:"data:"+i+","+d;f.set("data",g.src);DigiWebApp.NavigationController.toBautagebuchMedienDetailsPageTransition()}}else{f.set("data",null);f.set("loadedFileName",null);f.set("fileType",null);DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("error"),message:M.I18N.l("noPicLoaded")})}});DigiWebApp.NavigationController.toFileChooserPageTransition()}},c=function(){typeof navigator.camera!=="undefined"&&typeof navigator.camera.getPicture!==
"undefined"?DigiWebApp.BautagebuchMedienDetailsController.takePicture():DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("error"),message:M.I18N.l("noCamera")})};if(a)switch(DigiWebApp.BautagebuchMedienListeController.letzteFotoQuelle){case "library":b();break;case "camera":c();break;default:console.log("unknown ButtonTag")}else M.DialogView.actionSheet({title:M.I18N.l("takePicture"),cancelButtonValue:M.I18N.l("cancel"),otherButtonValues:[M.I18N.l("library"),M.I18N.l("camera"),
M.I18N.l("uebersicht")],otherButtonTags:["library","camera","uebersicht"],callbacks:{other:{action:function(d){DigiWebApp.BautagebuchMedienListeController.letzteFotoQuelle=d;switch(d){case "library":b();break;case "camera":c();break;case "uebersicht":DigiWebApp.BautagebuchBautagesberichtDetailsController.save(DigiWebApp.NavigationController.toBautagebuchMedienListePageTransition);break;default:console.log("unknown ButtonTag")}}},cancel:{action:function(){}}}})}});
DigiWebApp.BautagebuchNotizenListeController=M.Controller.extend({items:null,init:function(){var a=DigiWebApp.BautagebuchNotiz.findSorted(DigiWebApp.BautagebuchBautagesberichtDetailsController.item.get("id"));if(a.length==0)$("#"+DigiWebApp.BautagebuchNotizenListePage.uebertragenButton.id).hide();else DigiWebApp.BautagebuchBautagesberichtDetailsController.item.get("bautagesberichtTyp")!="<standard>"?$("#"+DigiWebApp.BautagebuchNotizenListePage.uebertragenButton.id).show():$("#"+DigiWebApp.BautagebuchNotizenListePage.uebertragenButton.id).hide();
this.set("items",a)},neu:function(){DigiWebApp.BautagebuchNotizenDetailsController.set("item",DigiWebApp.BautagebuchNotiz.createRecord({bautagesberichtId:DigiWebApp.BautagebuchBautagesberichtDetailsController.item.get("id")}));if(DigiWebApp.BautagebuchBautagesberichtDetailsController.item.get("orderId")){DigiWebApp.BautagebuchNotizenDetailsController.set("auftragId",DigiWebApp.BautagebuchBautagesberichtDetailsController.item.get("orderId"));DigiWebApp.BautagebuchNotizenDetailsController.set("auftragName",
DigiWebApp.BautagebuchBautagesberichtDetailsController.item.get("orderName"))}else{DigiWebApp.BautagebuchNotizenDetailsController.set("auftragId",null);DigiWebApp.BautagebuchNotizenDetailsController.set("auftragName",null)}if(DigiWebApp.BautagebuchBautagesberichtDetailsController.item.get("handOrderId")){DigiWebApp.BautagebuchNotizenDetailsController.set("handOrderId",DigiWebApp.BautagebuchBautagesberichtDetailsController.item.get("handOrderId"));DigiWebApp.BautagebuchNotizenDetailsController.set("handOrderName",
DigiWebApp.BautagebuchBautagesberichtDetailsController.item.get("handOrderName"))}else{DigiWebApp.BautagebuchNotizenDetailsController.set("handOrderId",null);DigiWebApp.BautagebuchNotizenDetailsController.set("handOrderName",null)}DigiWebApp.BautagebuchNotizenDetailsController.set("positionId",null);DigiWebApp.BautagebuchNotizenDetailsController.set("positionName",null);DigiWebApp.BautagebuchNotizenDetailsController.set("activityId",null);DigiWebApp.BautagebuchNotizenDetailsController.set("activityName",
null);DigiWebApp.BautagebuchNotizenDetailsController.set("data",null);DigiWebApp.NavigationController.toBautagebuchNotizenDetailsPageTransition()}});
DigiWebApp.BautagebuchNotizenDetailsController=M.Controller.extend({item:null,auftragId:null,auftragName:null,auftraegeList:null,handOrderId:null,handOrderName:null,positionId:null,positionName:null,positionenList:null,activityId:null,activityName:null,activityList:null,data:null,init:function(){},load:function(a){this.set("item",a);var b=_.filter(DigiWebApp.Position.findSorted(),function(e){return e.get("id")==a.get("positionId")})[0],c=_.filter(DigiWebApp.HandOrder.findSorted().concat(DigiWebApp.Order.findSorted()),
function(e){return a.get("handOrderId")&&a.get("handOrderId").length>0?e.get("id")==a.get("handOrderId"):e.get("id")==b.get("orderId")})[0],d=c.get("id");c=c.get("name");this.set("auftragId",d);this.set("auftragName",c);this.set("handOrderId",a.get("handOrderId"));this.set("handOrderName",a.get("handOrderName"));this.set("positionId",a.get("positionId"));this.set("positionName",a.get("positionName"));this.set("activityId",a.get("activityId"));this.set("activityName",a.get("activityName"));this.set("data",
a.get("data"));this.setTaetigkeiten(a.get("positionId"))},save:function(){if(DigiWebApp.BautagebuchBautagesberichtDetailsController.item.get("bautagesberichtTyp")=="<notizen_only>")if(M.ViewManager.getView("bautagebuchNotizenDetailsPage","auftragComboBox").getSelection()==="0"){DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("noOrderSelected"),message:M.I18N.l("noOrderSelectedMsg")});return false}if(M.ViewManager.getView("bautagebuchNotizenDetailsPage","positionComboBox").getSelection()===
"0"){DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("noPosSelected"),message:M.I18N.l("noPosSelectedMsg")});return false}if(this.handOrderId){this.item.set("handOrderId",this.handOrderId);this.item.set("handOrderName",this.handOrderName);this.item.set("positionId",null);this.item.set("positionName",null);this.item.set("orderId",null);this.item.set("orderName",null)}else{this.item.set("handOrderId",null);this.item.set("handOrderName",null);this.item.set("positionId",this.positionId);
this.item.set("positionName",this.positionName);this.item.set("orderId",this.auftragId);this.item.set("orderName",this.auftragName)}this.item.set("activityId",this.activityId);this.item.set("activityName",this.activityName);this.data!==DigiWebApp.BautagebuchNotizenDetailsPage.content.dataInput.initialText?this.item.set("data",this.data):this.item.set("data",null);if(this.item.saveSorted()){DigiWebApp.BautagebuchNotizenListeController.set("items",DigiWebApp.BautagebuchNotiz.findSorted(DigiWebApp.BautagebuchBautagesberichtDetailsController.item.get("id")));
DigiWebApp.NavigationController.backToBautagebuchNotizenListePageTransition();return true}else return false},deleteNotiz:function(){var a=this;DigiWebApp.ApplicationController.nativeConfirmDialogView({title:M.I18N.l("deleteLabel"),message:M.I18N.l("wirklichLoeschenMsg"),confirmButtonValue:M.I18N.l("yes"),cancelButtonValue:M.I18N.l("no"),callbacks:{confirm:{target:this,action:function(){if(a.item.deleteSorted()){DigiWebApp.BautagebuchNotizenListeController.set("items",DigiWebApp.BautagebuchNotiz.findSorted(DigiWebApp.BautagebuchBautagesberichtDetailsController.item.get("id")));
DigiWebApp.NavigationController.backToBautagebuchNotizenListePageTransition();return true}else return false}},cancel:{target:this,action:function(){return true}}}})},setPositionen:function(a){var b=this;if(typeof a==="undefined")return false;else{var c=NO,d=_.map(DigiWebApp.Position.findSorted(),function(e){if(typeof e==="undefined")console.log("UNDEFINED Position");else if(parseIntRadixTen(e.get("orderId"))==parseIntRadixTen(a)){var f={label:e.get("name"),value:e.get("id"),isSelected:NO};if(parseIntRadixTen(e.get("id"))==
parseIntRadixTen(b.item.get("positionId"))){c=f.isSelected=YES;b.set("positionId",e.get("id"));b.set("positionName",e.get("name"))}return f}});d=_.compact(d);if(!c&&a&&d.length>0){d[0].isSelected=YES;b.set("positionId",d[0].value);b.set("positionName",d[0].label)}b.set("positionenList",d)}},setTaetigkeiten:function(a){var b=this;if(typeof a!=="undefined"){var c=_.select(DigiWebApp.WorkPlan.find(),function(f){if(f)return f.get("id")==a}),d=NO,e=null;e=c.length>0?DigiWebApp.SelectionController.getActivitiesFromWorkplan(c[0]):
DigiWebApp.SelectionController.getActivities();c=_.map(e,function(f){if(typeof f==="undefined")console.log("UNDEFINED activity");else{f={label:f.get("name"),value:f.get("id"),isSelected:NO};if(b.activityId===f.value)d=f.isSelected=YES;return f}});c=_.compact(c);c.push({label:M.I18N.l("selectSomethingOptional"),value:"0",isSelected:!d});b.set("activityList",c)}}});
DigiWebApp.BautagebuchZeitenDetailsController=M.Controller.extend({item:null,handOrderId:null,handOrderName:null,auftragId:null,auftragName:null,auftraegeList:null,positionId:null,positionName:null,positionenList:null,activityId:null,activityName:null,activityList:null,mitarbeiterIds:null,mitarbeiterList:null,von:"00:00",timeStampStart:"",bis:"00:00",timeStampEnd:"",dauer:"00:00",remark:"",verbuchen:YES,latitude:"",longitude:"",latitude_bis:"",longitude_bis:"",init:function(){},load:function(a){this.set("item",
a);var b=_.filter(DigiWebApp.Position.findSorted(),function(e){return e.get("id")==a.get("positionId")})[0],c=_.filter(DigiWebApp.HandOrder.findSorted().concat(DigiWebApp.Order.findSorted()),function(e){return a.get("handOrderId")&&a.get("handOrderId").length>0?e.get("id")==a.get("handOrderId"):e.get("id")==b.get("orderId")})[0],d=c.get("id");c=c.get("name");this.set("auftragId",d);this.set("auftragName",c);this.set("handOrderId",a.get("handOrderId"));this.set("handOrderName",a.get("handOrderName"));
this.set("positionId",a.get("positionId"));this.set("positionName",a.get("positionName"));this.set("activityId",a.get("activityId"));this.set("activityName",a.get("activityName"));this.set("mitarbeiterIds",toIntArray(JSON.parse(a.get("mitarbeiterIds"))));this.set("verbuchen",a.get("verbuchen"));this.set("timeStampStart",a.get("timeStampStart"));this.set("timeStampEnd",a.get("timeStampEnd"));this.set("von",a.get("von"));this.set("bis",a.get("bis"));this.setVonBis();this.set("dauer",a.get("dauer"));
this.setDauer();this.set("remark",a.get("remark"))},save:function(){var a=this,b=M.ViewManager.getView("bautagebuchZeitenDetailsPage","positionComboBox").getSelection()!=="0",c=M.ViewManager.getView("bautagebuchZeitenDetailsPage","activityComboBox").getSelection()!=="0",d=!(DigiWebApp.BautagebuchZeitenDetailsController.mitarbeiterIds===null||DigiWebApp.BautagebuchZeitenDetailsController.mitarbeiterIds.length===0);if(!b){DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("noPosSelected"),
message:M.I18N.l("noPosSelectedMsg")});return false}if(!c){DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("noActSelected"),message:M.I18N.l("noActSelectedMsg")});return false}if(!d){DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("noMitarbeiterSelected"),message:M.I18N.l("noMitarbeiterSelectedMsg")});return false}var e=NO;if(!DigiWebApp.BautagebuchEinstellungenController.settings.falscheZeitenIgnorieren&&!DigiWebApp.BautagebuchEinstellungenController.settings.inStundenBuchen){var f=
DigiWebApp.BautagebuchBautagesbericht.find({query:{identifier:"datum",operator:"=",value:DigiWebApp.BautagebuchBautagesberichtDetailsController.datum}});_.each(a.mitarbeiterIds,function(i){_.each(f,function(h){h=DigiWebApp.BautagebuchZeitbuchung.find({query:{identifier:"bautagesberichtId",operator:"=",value:h.get("id")}});_.each(h,function(j){if(JSON.parse(j.get("mitarbeiterIds")).indexOf(i)!=-1&&j.m_id!=a.item.m_id){var l=D8.create(DigiWebApp.BautagebuchBautagesberichtDetailsController.datum+" "+
j.get("von")).getTimestamp();j=D8.create(DigiWebApp.BautagebuchBautagesberichtDetailsController.datum+" "+j.get("bis")).getTimestamp();var n=D8.create(DigiWebApp.BautagebuchBautagesberichtDetailsController.datum+" "+a.von).getTimestamp(),m=D8.create(DigiWebApp.BautagebuchBautagesberichtDetailsController.datum+" "+a.bis).getTimestamp();if(l<n&&n<j)e=YES;if(l<m&&m<j)e=YES;if(n<l&&j<m)e=YES;if(l<n&&m<j)e=YES;if(n==l&&j==m)e=YES}})})})}var g=function(){if(!DigiWebApp.BautagebuchEinstellungen.find()[0].get("inStundenBuchen")&&
!DigiWebApp.BautagebuchEinstellungen.find()[0].get("falscheZeitenIgnorieren")){var i=D8.create("01.01.1993 "+DigiWebApp.BautagebuchZeitenDetailsController.get("von")),h=D8.create("01.01.1993 "+DigiWebApp.BautagebuchZeitenDetailsController.get("bis"));if(i.getTimestamp()>h.getTimestamp()){DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("wrongTimes"),message:M.I18N.l("wrongTimesMsg")});return false}}if(a.handOrderId){a.item.set("handOrderId",a.handOrderId);a.item.set("handOrderName",
a.handOrderName);a.item.set("positionId",null);a.item.set("positionName",null)}else{a.item.set("handOrderId",null);a.item.set("handOrderName",null);a.item.set("positionId",a.positionId);a.item.set("positionName",a.positionName)}a.item.set("activityId",a.activityId);a.item.set("activityName",a.activityName);a.item.set("mitarbeiterIds",JSON.stringify(toIntArray(a.mitarbeiterIds)));a.item.set("verbuchen",a.verbuchen);a.item.set("von",a.von);a.item.set("timeStampStart",a.timeStampStart);a.item.set("bis",
a.bis);a.item.set("timeStampEnd",a.timeStampEnd);a.item.set("dauer",a.dauer);a.item.set("remark",a.remark);i=a.item.state==M.STATE_NEW;if(a.item.saveSorted()){var j=function(){DigiWebApp.BautagebuchZeitenListeController.set("items",DigiWebApp.BautagebuchZeitbuchung.findSorted(DigiWebApp.BautagebuchBautagesberichtDetailsController.item.get("id")));DigiWebApp.NavigationController.backToBautagebuchZeitenListePageTransition()};if(i)DigiWebApp.ApplicationController.nativeConfirmDialogView({title:M.I18N.l("bautagebuchWeitereZeitbuchung"),
message:M.I18N.l("bautagebuchWeitereZeitbuchungMsg"),confirmButtonValue:M.I18N.l("yes"),cancelButtonValue:M.I18N.l("no"),callbacks:{confirm:{target:this,action:function(){var l=JSON.parse(JSON.stringify(a.item));DigiWebApp.BautagebuchZeitenListeController.neu();a.set("positionId",l.record.positionId);a.set("positionName",l.record.positionName);a.set("handOrderId",l.record.handOrderId);a.set("handOrderName",l.record.handOrderName);a.setTaetigkeiten(l.record.positionId);a.set("mitarbeiterIds",toIntArray(JSON.parse(l.record.mitarbeiterIds)));
a.set("von",l.record.bis);a.set("bis",l.record.bis);a.setVonBis();a.set("dauer","00:00");a.setDauer();a.set("remark","");$("#"+DigiWebApp.BautagebuchZeitenDetailsPage.content.remarkInput.id)[0].value=""}},cancel:{target:this,action:function(){j();return true}}}});else{j();return true}}else return false};e?DigiWebApp.ApplicationController.nativeConfirmDialogView({title:M.I18N.l("BautagebuchUeberschneidendeZeitbuchung"),message:M.I18N.l("BautagebuchUeberschneidendeZeitbuchungMsg"),confirmButtonValue:M.I18N.l("yes"),
cancelButtonValue:M.I18N.l("no"),callbacks:{confirm:{target:a,action:function(){g()}},cancel:{target:a,action:function(){return false}}}}):g()},deleteZeitbuchung:function(){var a=this;DigiWebApp.ApplicationController.nativeConfirmDialogView({title:M.I18N.l("deleteLabel"),message:M.I18N.l("wirklichLoeschenMsg"),confirmButtonValue:M.I18N.l("yes"),cancelButtonValue:M.I18N.l("no"),callbacks:{confirm:{target:this,action:function(){if(a.item.deleteSorted()){DigiWebApp.BautagebuchZeitenListeController.set("items",
DigiWebApp.BautagebuchZeitbuchung.findSorted(DigiWebApp.BautagebuchBautagesberichtDetailsController.item.get("id")));DigiWebApp.NavigationController.backToBautagebuchZeitenListePageTransition();return true}else return false}},cancel:{target:this,action:function(){return true}}}})},setTaetigkeiten:function(a){var b=this;if(typeof a!=="undefined"){var c=_.select(DigiWebApp.WorkPlan.find(),function(f){if(f)return f.get("id")==a}),d=NO;c=c.length>0?DigiWebApp.SelectionController.getActivitiesFromWorkplan(c[0]):
DigiWebApp.SelectionController.getActivities();c=_.map(c,function(f){if(typeof f==="undefined")console.log("UNDEFINED activity");else{f={label:f.get("name"),value:f.get("id"),isSelected:NO};if(parseIntRadixTen(b.activityId)===parseIntRadixTen(f.value))d=f.isSelected=YES;return f}});c=_.compact(c);c.push({label:M.I18N.l("selectSomething"),value:"0",isSelected:!d});b.set("activityList",c);try{DigiWebApp.BautagebuchZeitenDetailsPage.content.activityComboBox.events.change.action()}catch(e){}}},setDauer:function(){if(DigiWebApp.BautagebuchZeitenDetailsController.dauer){$("#"+
DigiWebApp.BautagebuchZeitenDetailsPage.content.dauerContainer.dauerGrid.stundeFeld.id)[0].value=parseIntRadixTen(DigiWebApp.BautagebuchZeitenDetailsController.dauer.split(":")[0]).padLeft(2,"0");$("#"+DigiWebApp.BautagebuchZeitenDetailsPage.content.dauerContainer.dauerGrid.minuteFeld.id)[0].value=parseIntRadixTen(DigiWebApp.BautagebuchZeitenDetailsController.dauer.split(":")[1]).padLeft(2,"0")}},setVonBis:function(){if(DigiWebApp.BautagebuchZeitenDetailsController.von){$("#"+DigiWebApp.BautagebuchZeitenDetailsPage.content.VonBisContainer.VonBisGrid.stundeVonFeld.id)[0].value=
parseIntRadixTen(DigiWebApp.BautagebuchZeitenDetailsController.von.split(":")[0]).padLeft(2,"0");$("#"+DigiWebApp.BautagebuchZeitenDetailsPage.content.VonBisContainer.VonBisGrid.minuteVonFeld.id)[0].value=parseIntRadixTen(DigiWebApp.BautagebuchZeitenDetailsController.von.split(":")[1]).padLeft(2,"0")}if(DigiWebApp.BautagebuchZeitenDetailsController.bis){$("#"+DigiWebApp.BautagebuchZeitenDetailsPage.content.VonBisContainer.VonBisGrid.stundeBisFeld.id)[0].value=parseIntRadixTen(DigiWebApp.BautagebuchZeitenDetailsController.bis.split(":")[0]).padLeft(2,
"0");$("#"+DigiWebApp.BautagebuchZeitenDetailsPage.content.VonBisContainer.VonBisGrid.minuteBisFeld.id)[0].value=parseIntRadixTen(DigiWebApp.BautagebuchZeitenDetailsController.bis.split(":")[1]).padLeft(2,"0")}if(DigiWebApp.BautagebuchZeitenDetailsController.von&&DigiWebApp.BautagebuchZeitenDetailsController.bis&&!DigiWebApp.BautagebuchEinstellungenController.settings.inStundenBuchen){var a=D8.create("01.01.2000 "+DigiWebApp.BautagebuchZeitenDetailsController.von),b=D8.create("01.01.2000 "+DigiWebApp.BautagebuchZeitenDetailsController.bis);
a=a.timeBetween(b,"minutes");b=a%60;DigiWebApp.BautagebuchZeitenDetailsController.set("dauer",Math.floor(a/60).padLeft(2)+":"+b.padLeft(2));this.setDauer()}}});
DigiWebApp.BautagebuchZeitenListeController=M.Controller.extend({items:null,init:function(){this.set("items",DigiWebApp.BautagebuchZeitbuchung.findSorted(DigiWebApp.BautagebuchBautagesberichtDetailsController.item.get("id")));DigiWebApp.BautagebuchZusammenfassungController.load(DigiWebApp.BautagebuchBautagesberichtDetailsController.item);DigiWebApp.BautagebuchZusammenfassungController.set("ZeitbuchungenPerMitarbeiterList",DigiWebApp.BautagebuchZusammenfassungController.getZeitbuchungenPerMitarbeiterList());
M.ViewManager.setCurrentPage(DigiWebApp.BautagebuchZeitenListePage)},neu:function(a){DigiWebApp.BautagebuchZeitenDetailsController.set("item",DigiWebApp.BautagebuchZeitbuchung.createRecord({bautagesberichtId:DigiWebApp.BautagebuchBautagesberichtDetailsController.item.get("id")}));if(DigiWebApp.BautagebuchBautagesberichtDetailsController.item.get("orderId")){DigiWebApp.BautagebuchZeitenDetailsController.set("auftragId",DigiWebApp.BautagebuchBautagesberichtDetailsController.item.get("orderId"));DigiWebApp.BautagebuchZeitenDetailsController.set("auftragName",
DigiWebApp.BautagebuchBautagesberichtDetailsController.item.get("orderName"))}else{DigiWebApp.BautagebuchZeitenDetailsController.set("auftragId",null);DigiWebApp.BautagebuchZeitenDetailsController.set("auftragName",null)}if(DigiWebApp.BautagebuchBautagesberichtDetailsController.item.get("handOrderId")){DigiWebApp.BautagebuchZeitenDetailsController.set("handOrderId",DigiWebApp.BautagebuchBautagesberichtDetailsController.item.get("handOrderId"));DigiWebApp.BautagebuchZeitenDetailsController.set("handOrderName",
DigiWebApp.BautagebuchBautagesberichtDetailsController.item.get("handOrderName"))}else{DigiWebApp.BautagebuchZeitenDetailsController.set("handOrderId",null);DigiWebApp.BautagebuchZeitenDetailsController.set("handOrderName",null)}DigiWebApp.BautagebuchZeitenDetailsController.set("positionId",null);DigiWebApp.BautagebuchZeitenDetailsController.set("positionName",null);DigiWebApp.BautagebuchZeitenDetailsController.set("activityId",null);DigiWebApp.BautagebuchZeitenDetailsController.set("activityName",
null);a?DigiWebApp.BautagebuchZeitenDetailsController.set("mitarbeiterIds",toIntArray([a])):DigiWebApp.BautagebuchZeitenDetailsController.set("mitarbeiterIds",null);DigiWebApp.BautagebuchZeitenDetailsController.set("von",DigiWebApp.BautagebuchBautagesberichtDetailsController.startUhrzeit);DigiWebApp.BautagebuchZeitenDetailsController.set("bis",DigiWebApp.BautagebuchBautagesberichtDetailsController.startUhrzeit);DigiWebApp.BautagebuchZeitenDetailsController.set("dauer","00:00");DigiWebApp.BautagebuchZeitenDetailsController.set("remark",
"");DigiWebApp.NavigationController.toBautagebuchZeitenDetailsPageTransition();$("#"+DigiWebApp.BautagebuchZeitenDetailsPage.header.delButton.id).hide()}});
DigiWebApp.BautagebuchZusammenfassungController=M.Controller.extend({item:null,lastTimestampDatatransfer:null,bautagesberichtId:null,projektleiterId:null,projektleiterList:null,mitarbeiterIds:null,mitarbeiterList:null,mitarbeiterListSelected:null,datum:null,auftragsId:null,auftragsName:null,auftraegeList:null,positionenList:null,latitude:null,longitude:null,wetter:null,setWetter:function(a){if(typeof a==="undefined")return NO;else{this.set("wetter",JSON.parse(JSON.stringify(a)));return YES}},startUhrzeit:null,
ZeitbuchungenPerMitarbeiterList:[],init:function(){},load:function(a){this.set("item",a);this.set("bautagesberichtId",a.get("id"));this.set("datum",a.get("datum"));this.set("projektleiterId",a.get("projektleiterId"));this.set("auftragsId",a.get("orderId"));this.set("auftragsName",a.get("orderName"));this.set("mitarbeiterIds",a.get("selektierteMitarbeiter"));this.set("startUhrzeit",a.get("startUhrzeit"));this.setWetter(DigiWebApp.BautagebuchMainController.wetterDefaults);this.set("wetter.temperatur",
a.get("temperatur"));this.set("wetter.luftfeuchtigkeit",a.get("luftfeuchtigkeit"));this.set("wetter.bewoelkung",a.get("bewoelkung"));this.set("wetter.niederschlag",a.get("niederschlag"));this.set("wetter.wind",a.get("wind"));this.set("wetter.wechselhaft",a.get("wechselhaft"));this.set("wetter.wechselhaftItem",[{value:"wechselhaft",label:M.I18N.l("BautagebuchWechselhaft"),isSelected:a.get("wechselhaft")}]);this.setPositionen(a.get("orderId"));this.set("ZeitbuchungenPerMitarbeiterList",this.getZeitbuchungenPerMitarbeiterList())},
save:function(a,b){if(this.item.saveSorted()){DigiWebApp.BautagebuchBautagesberichteListeController.set("items",DigiWebApp.BautagebuchBautagesbericht.findSorted());typeof a==="function"&&a();return true}else{typeof b==="function"&&b();return false}},deleteBautagesbericht:function(a,b){if(this.item.deleteSorted()){DigiWebApp.BautagebuchBautagesberichteListeController.set("items",DigiWebApp.BautagebuchBautagesbericht.findSorted());typeof a==="function"&&a();return true}else{typeof b==="function"&&b();
return false}},finish:function(a,b){var c=this;c.item.set("abgeschlossen",YES);DigiWebApp.BautagebuchEinstellungen.find()[0].get("inStundenBuchen")?c.berechneVonBis(YES):c.setzeTimestamps(YES);var d="";if(DigiWebApp.SettingsController.featureAvailable("405")&&typeof window.requestFileSystem!=="undefined"&&DigiWebApp.BautagebuchZusammenfassungPage.signaturePadAPI){d=DigiWebApp.BautagebuchZusammenfassungPage.signaturePadAPI.getSignatureString();c.item.set("fileType",DigiWebApp.ApplicationController.CONSTTextFiletype);
c.item.saveToFile(d,function(){c.item.set("unterschrift_breite",DigiWebApp.BautagebuchZusammenfassungPage.content.container.signature.signatureform.signaturecanvas.canvasWidth);c.item.set("unterschrift_hoehe",DigiWebApp.BautagebuchZusammenfassungPage.content.container.signature.signatureform.signaturecanvas.canvasHeight);if(c.save()){DigiWebApp.BautagebuchBautagesberichteListeController.set("items",DigiWebApp.BautagebuchBautagesbericht.findSorted());typeof a==="function"&&a();return true}else{typeof b===
"function"&&b();return false}})}else if(c.save()){DigiWebApp.BautagebuchBautagesberichteListeController.set("items",DigiWebApp.BautagebuchBautagesbericht.findSorted());typeof a==="function"&&a();return true}else{typeof b==="function"&&b();return false}},setPositionen:function(a){if(typeof a==="undefined")return false;else{var b=_.map(DigiWebApp.Position.findSorted(),function(c){if(typeof c==="undefined")console.log("UNDEFINED Position");else if(parseIntRadixTen(c.get("orderId"))===parseIntRadixTen(a))return{label:c.get("name"),
value:c.get("id"),isSelected:NO}});b=_.compact(b);if(b.length==1)b[0].isSelected=YES;DigiWebApp.BautagebuchBautagesberichtDetailsController.set("positionenList",b)}},berechneVonBis:function(a){var b=[],c=[];c["0"]=D8.create(DigiWebApp.BautagebuchBautagesberichtDetailsController.item.get("datum")+" "+DigiWebApp.BautagebuchBautagesberichtDetailsController.startUhrzeit);var d=DigiWebApp.BautagebuchZeitbuchung.find({query:{identifier:"bautagesberichtId",operator:"=",value:this.bautagesberichtId}});d=
_.sortBy(d,function(e){return parseIntRadixTen(e.get("_createdAt"))});_.each(d,function(e){var f=c["0"];_.each(JSON.parse(e.get("mitarbeiterIds")),function(i){if(typeof c[""+i]!="undefined")if(c[""+i].getTimestamp()>f.getTimestamp())f=c[""+i]});e.set("von",f.format("HH:MM"));e.set("timeStampStart",f.getTimestamp());var g=e.get("dauer");f=f.addHours(parseIntRadixTen(g.split(":")[0])).addMinutes(parseIntRadixTen(g.split(":")[1]));_.each(JSON.parse(e.get("mitarbeiterIds")),function(i){c[""+i]=f});e.set("bis",
f.format("HH:MM"));e.set("timeStampEnd",f.getTimestamp());typeof a!=="undefined"&&parseBool(a)&&e.saveSorted();b.push(e)});return _.sortBy(b,function(e){return parseIntRadixTen(e.get("von"))})},setzeTimestamps:function(a){var b=[],c=DigiWebApp.BautagebuchZeitbuchung.find({query:{identifier:"bautagesberichtId",operator:"=",value:this.bautagesberichtId}});c=_.sortBy(c,function(d){return parseIntRadixTen(d.get("_createdAt"))});_.each(c,function(d){d.set("timeStampStart",D8.create(DigiWebApp.BautagebuchBautagesberichtDetailsController.item.get("datum")+
" "+d.get("von")).getTimestamp());d.set("timeStampEnd",D8.create(DigiWebApp.BautagebuchBautagesberichtDetailsController.item.get("datum")+" "+d.get("bis")).getTimestamp());typeof a!=="undefined"&&parseBool(a)&&d.saveSorted();b.push(d)});return _.sortBy(b,function(d){return parseIntRadixTen(d.get("von"))})},getZeitbuchungenPerMitarbeiterList:function(){var a=[],b=[];if(parseBool(this.item.get("abgeschlossen"))||!DigiWebApp.BautagebuchEinstellungen.find()[0].get("inStundenBuchen")){var c=DigiWebApp.BautagebuchZeitbuchung.find({query:{identifier:"bautagesberichtId",
operator:"=",value:this.bautagesberichtId}});b=_.sortBy(c,function(e){return parseIntRadixTen(D8.create(DigiWebApp.BautagebuchBautagesberichtDetailsController.item.get("datum")+" "+e.get("von")).getTimestamp())})}else b=this.berechneVonBis();_.each(b,function(e){e=JSON.parse(e.get("mitarbeiterIds"));_.each(e,function(f){var g=DigiWebApp.BautagebuchMitarbeiter.find({query:{identifier:"id",operator:"=",value:f}})[0];if(typeof g!=="undefined"){var i=NO;_.each(a,function(h){if(h.get("id")===g.get("id"))i=
YES});i===NO&&a.push(g)}})});var d=[];_.each(a,function(e){var f=[],g=D8.create(DigiWebApp.BautagebuchBautagesberichtDetailsController.item.get("datum")+" 00:00");_.each(b,function(h){var j=JSON.parse(h.get("mitarbeiterIds"));_.each(j,function(l){if(l===e.get("id")){g=g.addHours(h.get("dauer").split(":")[0]).addMinutes(h.get("dauer").split(":")[1]);l={vonbisdauer:h.get("von")+" - "+h.get("bis")+" ("+h.get("dauer")+"h)",handOrderName:h.get("handOrderName"),positionName:h.get("positionName"),activityName:h.get("activityName"),
mitarbeiterId:l,modelId:h.m_id};f.push(l)}})});var i={label:e.vollername()+": "+g.format("HH:MM")+"h",items:f};d.push(i)});return d}});
DigiWebApp.BookingController=M.Controller.extend({currentBooking:null,currentBookingClosed:null,currentBookingStr:"",currentBookingTimesStampBook:null,isBackFromEmployeePage:NO,isBackFromRemarkPage:NO,timeData:null,timeDataSent:null,timeDataForEdit:null,timeDataSentDays:null,timeDataSentArchived:null,dayToDisplay:null,checkedCurrentBooking:null,init:function(a){if(a){DigiWebApp.SelectionController.set("uebernachtungskennzeichenScholpp",JSON.parse('[{"label":"Keine \u00dcbernachtung","value":"1","isSelected":true},{"label":"Pauschal","value":"2"},{"label":"Beleg (Hotel)","value":"3"},{"label":"Heimreise","value":"4"},{"label":"Baustellenwechsel","value":"5"},{"label":"- -","value":"6"}]'));
DigiWebApp.SelectionController.set("spesenkennzeichenScholpp",JSON.parse('[{"label":" ","value":"1","isSelected":true}]'))}a=M.Environment.getPlatform();a.substr(0,10)!=="BlackBerry"&&a.substr(0,12)!=="Linux armv7l"&&DigiWebApp.ApplicationController.setTransitionsSetting();this.isBackFromRemarkPage||this.isBackFromEmployeePage?this.refreshCurrentBooking(false):this.refreshCurrentBooking(true);if(this.isBackFromEmployeePage)DigiWebApp.BookingController.set("isBackFromEmployeePage",NO);else if(this.isBackFromRemarkPage)DigiWebApp.BookingController.set("isBackFromRemarkPage",
NO);else if(DigiWebApp.SelectionController.useSelections)DigiWebApp.SelectionController.setSelectionByPreviousSelection();else if(DigiWebApp.SelectionController.showHandOrderFirst){DigiWebApp.SelectionController.showHandOrderFirst=NO;DigiWebApp.SelectionController.setSelectionWithCurrentHandOrderFirst()}else this.currentBooking?DigiWebApp.SelectionController.setSelectionByCurrentBooking():DigiWebApp.SelectionController.initSelection();if(DigiWebApp.SettingsController.featureAvailable("416"))if(DigiWebApp.SettingsController.getSetting("DTC6aktiv")){DigiWebApp.ApplicationController.dtc6AktivRenameHelper(DigiWebApp.BookingPageWithIconsScholpp.content.order.id,
M.I18N.l("dtc6Ordner"));DigiWebApp.ApplicationController.dtc6AktivRenameHelper(DigiWebApp.BookingPageWithIconsScholpp.content.position.id,M.I18N.l("dtc6Auftrag"));DigiWebApp.ApplicationController.dtc6AktivRenameHelper(DigiWebApp.BookingPageWithIconsScholpp.content.activity.id,M.I18N.l("dtc6Leistung"))}},refreshCurrentBooking:function(a){var b=DigiWebApp.Booking.find(),c=null;if(b.length>0)c=_.select(b,function(d){if(d)return d.get("isCurrent")===true});if(c&&c.length>0){this.set("currentBooking",
c[0]);this.set("currentBookingStr",this.buildBookingStr(this.currentBooking));a&&DigiWebApp.SelectionController.setSelectionByCurrentBooking()}},refreshCurrentBookingClosed:function(){try{var a=_.sortBy(DigiWebApp.Booking.find().concat(DigiWebApp.SentBooking.find()),function(d){return d.get("timeStampStart")}),b=_.select(a,function(d){if(d)return d.get("isCurrent")===false});DigiWebApp.BookingController.currentBookingClosed=b[b.length-1]}catch(c){}},book:function(){writeToLog("## book button "+M.Date.create(new Date).format("HH:MM:ss.l"));
DigiWebApp.ApplicationController.closeAppAfterCloseDay=NO;var a=DigiWebApp.BookingController;try{DigiWebApp.ApplicationController.vibrate()}catch(b){}if(this.checkBooking()){$("#"+DigiWebApp.BookingPage.content.grid.id).addClass("green");var c=window.setTimeout(function(){window.clearTimeout(c);$("#"+DigiWebApp.BookingPage.content.grid.id).removeClass("green")},500),d=null;d=(new Date).getTime();if(a.currentBooking&&M.Date.create(a.currentBooking.get("timeStampStart")).format("HH:MM")==M.Date.create(d).format("HH:MM")){var e;
d=null;e=typeof DigiWebAppOrdinaryDesign.bookingPageWithIconsScholpp!=="undefined"?M.ViewManager.getView("bookingPageWithIconsScholpp","order").getSelection():M.ViewManager.getView("bookingPage","order").getSelection();var f;var g=(f=typeof DigiWebAppOrdinaryDesign.bookingPageWithIconsScholpp!=="undefined"?M.ViewManager.getView("bookingPageWithIconsScholpp","position").getSelection(YES):M.ViewManager.getView("bookingPage","position").getSelection(YES))?f.value:null;var i=(f=typeof DigiWebAppOrdinaryDesign.bookingPageWithIconsScholpp!==
"undefined"?M.ViewManager.getView("bookingPageWithIconsScholpp","activity").getSelection(YES):M.ViewManager.getView("bookingPage","activity").getSelection(YES))?f.value:null;f=M.I18N.l("unknown");var h=M.I18N.l("unknown"),j=M.I18N.l("unknown"),l=M.I18N.l("unknown");if(a.isHandOrder(e)){d=e;f=h=_.select(DigiWebApp.HandOrder.findSorted(),function(u){if(u)return u.get("id")==e||u.get("name")==e})[0].get("name");g=e=null}else try{if(e!=null){var n=_.find(DigiWebApp.Order.find(),function(u){return parseIntRadixTen(u.get("id"))==
parseIntRadixTen(e)});if(n&&e!=0)f=n.get("name")}}catch(m){trackError(m)}try{if(g!=null){var o=_.find(DigiWebApp.Position.find(),function(u){return parseIntRadixTen(u.get("id"))==parseIntRadixTen(g)});if(o&&g!=0)j=o.get("name")}}catch(p){trackError(p)}try{if(i!=null){var q=_.find(DigiWebApp.Activity.find(),function(u){return parseIntRadixTen(u.get("id"))==parseIntRadixTen(i)});if(q&&i!=0)l=q.get("name")}}catch(r){trackError(r)}a.currentBooking.set("orderId",e);a.currentBooking.set("orderName",f);
a.currentBooking.set("handOrderId",d);a.currentBooking.set("handOrderName",h);a.currentBooking.set("positionId",g);a.currentBooking.set("positionName",j);a.currentBooking.set("activityId",i);a.currentBooking.set("activityName",l);a.currentBooking.save();try{a.startBookingNotification()}catch(s){}a.autoSend()&&a.sendCurrentBookings()}else if(this.currentBooking)if(DigiWebApp.SettingsController.featureAvailable("403")&&!DigiWebApp.SettingsController.getSetting("remarkIsOptional")||DigiWebApp.SettingsController.featureAvailable("422")&&
DigiWebApp.Activity.findById(DigiWebApp.BookingController.currentBooking.get("activityId")).get("istFahrzeitRelevant")){this.refreshCurrentBooking(false);DigiWebApp.NavigationController.toRemarkPage(function(){DigiWebApp.BookingController.set("isBackFromRemarkPage",YES);DigiWebApp.NavigationController.backToBookTimePagePOP();DigiWebApp.ApplicationController.DigiLoaderView.hide();DigiWebApp.ApplicationController.DigiLoaderView.show(M.I18N.l("Save"));DigiWebApp.BookingController.bookWithRemark()})}else{DigiWebApp.ApplicationController.DigiLoaderView.hide();
DigiWebApp.ApplicationController.DigiLoaderView.show(M.I18N.l("Save"));DigiWebApp.BookingController.bookWithRemark()}else{DigiWebApp.ApplicationController.DigiLoaderView.hide();DigiWebApp.ApplicationController.DigiLoaderView.show(M.I18N.l("Save"));DigiWebApp.BookingController.bookWithRemark()}}else{$("#"+DigiWebApp.BookingPage.content.grid.id).addClass("red");c=window.setTimeout(function(){window.clearTimeout(c);$("#"+DigiWebApp.BookingPage.content.grid.id).removeClass("red")},500)}},bookWithRemark:function(){DigiWebApp.SettingsController.getSetting("debug")&&
console.log("in bookWithRemark");this.setNotBookedBookings();this.refreshCurrentBooking(false);if(DigiWebApp.EmployeeController.getEmployeeState()==1){DigiWebApp.ApplicationController.DigiLoaderView.hide();!localStorage.getItem(DigiWebApp.EmployeeController.empSelectionKey)&&DigiWebApp.Booking.find().length===0?DigiWebApp.NavigationController.toEmployeePage():DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("transmitFirst"),message:M.I18N.l("transmitFirstMsg")})}else{var a,b=
null;a=typeof DigiWebAppOrdinaryDesign.bookingPageWithIconsScholpp!=="undefined"?M.ViewManager.getView("bookingPageWithIconsScholpp","order").getSelection():M.ViewManager.getView("bookingPage","order").getSelection();var c;var d=(c=typeof DigiWebAppOrdinaryDesign.bookingPageWithIconsScholpp!=="undefined"?M.ViewManager.getView("bookingPageWithIconsScholpp","position").getSelection(YES):M.ViewManager.getView("bookingPage","position").getSelection(YES))?c.value:null;var e=(c=typeof DigiWebAppOrdinaryDesign.bookingPageWithIconsScholpp!==
"undefined"?M.ViewManager.getView("bookingPageWithIconsScholpp","activity").getSelection(YES):M.ViewManager.getView("bookingPage","activity").getSelection(YES))?c.value:null;c=M.I18N.l("unknown");var f=M.I18N.l("unknown"),g=M.I18N.l("unknown"),i=M.I18N.l("unknown");if(this.isHandOrder(a)){b=a;c=f=_.select(DigiWebApp.HandOrder.findSorted(),function(p){if(p)return p.get("id")==a||p.get("name")==a})[0].get("name");d=a=null}else try{if(a!=null){var h=_.find(DigiWebApp.Order.find(),function(p){return parseIntRadixTen(p.get("id"))==
parseIntRadixTen(a)});if(h&&a!=0)c=h.get("name")}}catch(j){trackError(j)}try{if(d!=null){var l=_.find(DigiWebApp.Position.find(),function(p){return parseIntRadixTen(p.get("id"))==parseIntRadixTen(d)});if(l&&d!=0)g=l.get("name")}}catch(n){trackError(n)}try{if(e!=null){var m=_.find(DigiWebApp.Activity.find(),function(p){return parseIntRadixTen(p.get("id"))==parseIntRadixTen(e)});if(m&&e!=0)i=m.get("name")}}catch(o){trackError(o)}this.set("checkedCurrentBooking",{orderId:a,orderName:c,handOrderId:b,
handOrderName:f,positionId:d,positionName:g,activityId:e,activityName:i});this.currentBookingTimesStampBook=new Date;writeToLog("## currentBookingTimesStampBook "+M.Date.create(this.currentBookingTimesStampBook.getTime()).format("HH:MM:ss.l"));this.getBookingLocation(this.proceedBooking)}},startGetLocationTimestamp:null,getBookingLocation:function(a){var b=false,c=function(g){if(b)writeToLog("[getBookingLocation] successHandler w\u00e4re ein zus\u00e4tzliches mal gefeuert worden");else{b=true;a(g)}};
DigiWebApp.SettingsController.getSetting("debug")&&console.log("in getBookingLocation");var d=DigiWebApp.BookingController;d.startGetLocationTimestamp=(new Date).getTime();var e=function(g,i,h){var j=(new Date).getTime();parseIntRadixTen(d.startGetLocationTimestamp)+parseIntRadixTen(DigiWebApp.SettingsController.getSetting("GPSTimeOut"))<j&&g();DigiWebApp.ApplicationController.DigiLoaderView.show(M.I18N.l("getGPSPositionMsg"),DigiWebApp.SettingsController.getSetting("GPSTimeOut"));j={enableHighAccuracy:parseBool(DigiWebApp.SettingsController.getSetting("GPSenableHighAccuracy")),
maximumAge:parseIntRadixTen(DigiWebApp.SettingsController.getSetting("GPSmaximumAgeMinutes"))*6E4,timeout:parseIntRadixTen(DigiWebApp.SettingsController.getSetting("GPSTimeOut"))};if(i&&!h){j.enableHighAccuracy=i.enableHighAccuracy;j.maximumAge=i.maximumAge;j.timeout=i.timeout}M.LocationManager.getLocation(d,g,function(l){if(l==="POSITION_UNAVAILABLE")if(h){writeToLog("GPS-ERROR: POSITION_UNAVAILABLE, trying again in 100ms");window.setTimeout(function(){h(g,i)},100);DigiWebApp.ApplicationController.DigiLoaderView.hide()}else{writeToLog("GPS-ERROR: POSITION_UNAVAILABLE, giving up");
DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("GPSError"),message:M.I18N.l("GPSunavailable"),callbacks:{confirm:{target:this,action:function(){}},cancel:{target:this,action:function(){}}}});g()}else if(l==="TIMEOUT")if(h){writeToLog("GPS-ERROR: TIMEOUT, trying again in 100ms");window.setTimeout(function(){h(g,i)},100);DigiWebApp.ApplicationController.DigiLoaderView.hide()}else{writeToLog("GPS-ERROR: TIMEOUT, giving up");DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("GPSError"),
message:M.I18N.l("GPStimeout"),callbacks:{confirm:{target:this,action:function(){}},cancel:{target:this,action:function(){}}}});g()}else if(l==="PERMISSION_DENIED")if(h){writeToLog("GPS-ERROR: PERMISSION_DENIED, trying again in 100ms");window.setTimeout(function(){h(g,i)},100);DigiWebApp.ApplicationController.DigiLoaderView.hide()}else{writeToLog("GPS-ERROR: PERMISSION_DENIED, giving up");DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("GPSError"),message:M.I18N.l("GPSmissingPermission"),
callbacks:{confirm:{target:this,action:function(){}},cancel:{target:this,action:function(){}}}});g()}else if(l==="ALREADY_RECEIVING")if(h){writeToLog("GPS-ERROR: ALREADY_RECEIVING, trying again in 1000ms");window.setTimeout(function(){h(g,i)},1E3);DigiWebApp.ApplicationController.DigiLoaderView.hide()}else{writeToLog("GPS-ERROR: ALREADY_RECEIVING, asking user");DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("GPSError"),message:M.I18N.l("GPSalreadyRecieving"),callbacks:{confirm:{target:this,
action:function(){writeToLog("GPS-ERROR: ALREADY_RECEIVING, trying again");e(g,i,e)}},cancel:{target:this,action:function(){writeToLog("GPS-ERROR: ALREADY_RECEIVING, giving up");g()}}}})}else if(h){writeToLog("GPS-ERROR: unknown GPS-error, trying again in 100ms");window.setTimeout(function(){h(g,i)},100);DigiWebApp.ApplicationController.DigiLoaderView.hide()}else{writeToLog("GPS-ERROR: unknown GPS-error, giving up");DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("GPSError"),
message:M.I18N.l("GPSunknownError")+l,callbacks:{confirm:{target:this,action:function(){}},cancel:{target:this,action:function(){}}}});g()}},j)};if(DigiWebApp.SettingsController.featureAvailable("417")&&DigiWebApp.SettingsController.getSetting("ServiceApp_ermittleGeokoordinate")&&DigiWebApp.SettingsController.getSetting("autoSaveGPSData"))DigiWebApp.SettingsController.getSetting("ServiceApp_FallBack")?DigiWebApp.ServiceAppController.knockknock(function(){DigiWebApp.SettingsController.getSetting("debug")&&
console.log("ServiceApp is available");c()},function(){DigiWebApp.SettingsController.getSetting("debug")&&console.log("ServiceApp is NOT available");if(!parseBool(DigiWebApp.SettingsController.getSetting("GPSenableHighAccuracy"))&&parseBool(DigiWebApp.SettingsController.getSetting("GPSenableHighAccuracyFallback"))){var g={enableHighAccuracy:YES,maximumAge:parseIntRadixTen(DigiWebApp.SettingsController.getSetting("GPSmaximumAgeMinutes"))*6E4,timeout:parseIntRadixTen(DigiWebApp.SettingsController.getSetting("GPSTimeOut"))};
e(c,g,e)}else e(c)}):c();else if(DigiWebApp.SettingsController.getSetting("autoSaveGPSData"))if(!parseBool(DigiWebApp.SettingsController.getSetting("GPSenableHighAccuracy"))&&parseBool(DigiWebApp.SettingsController.getSetting("GPSenableHighAccuracyFallback"))){var f={enableHighAccuracy:YES,maximumAge:parseIntRadixTen(DigiWebApp.SettingsController.getSetting("GPSmaximumAgeMinutes"))*6E4,timeout:parseIntRadixTen(DigiWebApp.SettingsController.getSetting("GPSTimeOut"))};e(c,f,e)}else e(c);else c()},checkBooking:function(a){DigiWebApp.SettingsController.getSetting("debug")&&
console.log("in checkBooking");var b;b=typeof DigiWebAppOrdinaryDesign.bookingPageWithIconsScholpp!=="undefined"?M.ViewManager.getView("bookingPageWithIconsScholpp","order").getSelection():M.ViewManager.getView("bookingPage","order").getSelection();if(!b||b&&parseIntRadixTen(b)===0){DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("noOrderSelected"),message:M.I18N.l("noOrderSelectedMsg")});return false}else{if(this.isHandOrder(b)){if(!DigiWebApp.SelectionController.isActivitySelected()){DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("noActSelected"),
message:M.I18N.l("noActSelectedMsg")});return false}}else if(DigiWebApp.SelectionController.isPositionSelected()){if(!DigiWebApp.SelectionController.isActivitySelected()){DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("noActSelected"),message:M.I18N.l("noActSelectedMsg")});return false}}else{DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("noPosSelected"),message:M.I18N.l("noPosSelectedMsg")});return false}var c;if(typeof a==="undefined"){a=(a=typeof DigiWebAppOrdinaryDesign.bookingPageWithIconsScholpp!==
"undefined"?M.ViewManager.getView("bookingPageWithIconsScholpp","position").getSelection(YES):M.ViewManager.getView("bookingPage","position").getSelection(YES))?a.value:null;c=(c=typeof DigiWebAppOrdinaryDesign.bookingPageWithIconsScholpp!=="undefined"?M.ViewManager.getView("bookingPageWithIconsScholpp","activity").getSelection(YES):M.ViewManager.getView("bookingPage","activity").getSelection(YES))?c.value:null;if(this.currentBooking){var d=this.currentBooking.get("orderId"),e=this.currentBooking.get("handOrderId"),
f=this.currentBooking.get("positionId"),g=this.currentBooking.get("activityId");if(d===b||e===b){if(!this.isHandOrder(b)&&f===a&&g===c){DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("doubleBooking"),message:M.I18N.l("doubleBookingMsg")});return false}if(this.isHandOrder(b)&&g===c){DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("doubleBooking"),message:M.I18N.l("doubleBookingMsg")});return false}}}this.refreshCurrentBookingClosed();this.refreshCurrentBooking();
e=null;e=(new Date).getTime();if(this.currentBookingClosed&&this.currentBooking){d=M.Date.create(this.currentBooking.get("timeStampStart")).format("HH:MM");e=M.Date.create(e).format("HH:MM");if(d==e){d=this.currentBookingClosed.get("orderId");e=this.currentBookingClosed.get("handOrderId");f=this.currentBookingClosed.get("positionId");g=this.currentBookingClosed.get("activityId");if(d===b||e===b){if(!this.isHandOrder(b)&&f===a&&g===c){DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("doubleBooking"),
message:M.I18N.l("doubleBookingMsg")});return false}if(this.isHandOrder(b)&&g===c){DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("doubleBooking"),message:M.I18N.l("doubleBookingMsg")});return false}}}}}return true}},proceedBooking:function(a){writeToLog("## proceedBooking "+M.Date.create(new Date).format("HH:MM:ss.l"));var b=DigiWebApp.BookingController,c=true;if(b.currentBooking){if(c=b.currentBooking.closeBooking(a))b.currentBooking.removeAsCurrent();else if(b.checkedCurrentBooking){b.currentBooking.set("orderId",
b.checkedCurrentBooking.orderId);b.currentBooking.set("orderName",b.checkedCurrentBooking.orderName);b.currentBooking.set("handOrderId",b.checkedCurrentBooking.handOrderId);b.currentBooking.set("handOrderName",b.checkedCurrentBooking.handOrderName);b.currentBooking.set("positionId",b.checkedCurrentBooking.positionId);b.currentBooking.set("positionName",b.checkedCurrentBooking.positionName);b.currentBooking.set("activityId",b.checkedCurrentBooking.activityId);b.currentBooking.set("activityName",b.checkedCurrentBooking.activityName)}b.currentBooking.save();
if(c)b.currentBookingClosed=b.currentBooking;else b.autoSend()&&b.sendCurrentBookings()}else{DigiWebApp.SettingsController.setSetting("currentTimezoneOffset",(new Date).getTimezoneOffset());DigiWebApp.SettingsController.setSetting("currentTimezone",jstz.determine().name())}if(c){var d=null,e=null,f=null,g=null;if(a){if(a.latitude)d=a.latitude;if(a.longitude)e=a.longitude;if(a.accuracy)f=a.accuracy;if(a.date)g=a.date.date.getTime()}try{M.ViewManager.getView("remarkPage","remarkInput").value=""}catch(i){}a=
b.openBooking({oId:b.checkedCurrentBooking.orderId,oName:b.checkedCurrentBooking.orderName,hoId:b.checkedCurrentBooking.handOrderId,hoName:b.checkedCurrentBooking.handOrderName,lat:d,lon:e,pId:b.checkedCurrentBooking.positionId,pName:b.checkedCurrentBooking.positionName,aId:b.checkedCurrentBooking.activityId,aName:b.checkedCurrentBooking.activityName,remark:"",genauigkeitVon:f,gps_zeitstempelVon:g});d=localStorage.getItem(DigiWebApp.EmployeeController.empSelectionKey)||localStorage.getItem(DigiWebApp.EmployeeController.empSelectionKeyTmp);
e=[];if(d&&d!=="0"){a.set("istKolonnenbuchung",true);e=d.split(",")}else{a.set("istKolonnenbuchung",false);e=[DigiWebApp.SettingsController.getSetting("mitarbeiterId")]}a.set("employees",e.join());if(DigiWebApp.SettingsController.featureAvailable("419"))if(a.get("activityName")==="Reisezeit"||a.get("activityName")==="Fahrzeit"){d=M.ViewManager.getView("bookingPageWithIconsScholpp","uebernachtungskennzeichen").getSelection(YES);a.set("uebernachtungAuswahl",d?d.value:6)}else a.set("uebernachtungAuswahl",
0);else a.set("uebernachtungAuswahl",0);b.set("currentBooking",a);b.currentBooking.setAsCurrent();b.currentBooking.save();b.set("currentBookingStr",b.buildBookingStr(b.currentBooking));DigiWebApp.ApplicationController.startNotification();try{b.startBookingNotification()}catch(h){}}DigiWebApp.SelectionController.useSelections=NO;var j=function(){DigiWebApp.ApplicationController.DigiLoaderView.hide();DigiWebApp.SettingsController.getSetting("debug")&&console.log("Kommunikation mit ServiceApp beendet");
b.autoSend()&&b.sendCurrentBookings()};if(DigiWebApp.SettingsController.featureAvailable("417")&&DigiWebApp.SettingsController.getSetting("ServiceApp_ermittleGeokoordinate"))if(DigiWebApp.SettingsController.getSetting("ServiceApp_engeKopplung")||DigiWebApp.SettingsController.getSetting("autoTransferAfterBookTime")){var l=function(){DigiWebApp.SettingsController.getSetting("debug")&&console.log("polling for bookinglocations");var m=[];DigiWebApp.BookingController.currentBooking!==null&&m.push(DigiWebApp.BookingController.currentBooking.m_id);
DigiWebApp.BookingController.currentBookingClosed!==null&&m.push(DigiWebApp.BookingController.currentBookingClosed.m_id);DigiWebApp.ServiceAppController.pollBookings(m,function(o){DigiWebApp.SettingsController.getSetting("debug")&&console.log(o.length+" Datens\u00e4tze empfangen");_.each(o,function(p){try{DigiWebApp.SettingsController.getSetting("debug")&&console.log("speichere gepollten Datensatz "+p.m_id);var q=_.find(DigiWebApp.Booking.find(),function(u){return u.m_id===p.m_id}),r=p.record;DigiWebApp.SettingsController.getSetting("debug")&&
console.log("modelBooking: ",q);DigiWebApp.SettingsController.getSetting("debug")&&console.log("datensatz: ",r);q.set("latitude",r.latitude);q.set("latitude_bis",r.latitude_bis);q.set("longitude",r.longitude);q.set("longitude_bis",r.longitude_bis);q.set("ermittlungsverfahrenBis",r.ermittlungsverfahren_bis);q.set("ermittlungsverfahrenVon",r.ermittlungsverfahren);q.set("genauigkeitBis",r.genauigkeit_bis);q.set("genauigkeitVon",r.genauigkeit);q.set("gps_zeitstempelBis",r.gps_zeitstempel_bis);q.set("gps_zeitstempelVon",
r.gps_zeitstempel);q.set("ServiceApp_Status",r.status);q.save();DigiWebApp.SettingsController.getSetting("debug")&&console.log("datensatz "+p.m_id+" gespeichert")}catch(s){DigiWebApp.SettingsController.getSetting("debug")&&console.log("datensatz "+p.m_id+" nicht gefunden")}});j()},j,DigiWebApp.SettingsController.getSetting("GPSTimeOut"))},n=function(){DigiWebApp.SettingsController.getSetting("debug")&&console.log("put currentBooking");DigiWebApp.ServiceAppController.putBookings([b.currentBooking],
l,j)};if(c)if(b.currentBookingClosed!==null){DigiWebApp.SettingsController.getSetting("debug")&&console.log("post currentBookingClosed");DigiWebApp.ServiceAppController.postBookings([b.currentBookingClosed],n,n)}else{DigiWebApp.SettingsController.getSetting("debug")&&console.log("put currentBooking");DigiWebApp.ServiceAppController.putBookings([b.currentBooking],l,n)}else{DigiWebApp.SettingsController.getSetting("debug")&&console.log("post currentBookingClosed");DigiWebApp.ServiceAppController.postBookings([b.currentBookingClosed],
n,n)}}else if(c)if(b.currentBookingClosed!==null){n=function(){var m=function(){DigiWebApp.SettingsController.getSetting("debug")&&console.log("refreshWAIT");DigiWebApp.ServiceAppController.refreshWAITBookings(function(){DigiWebApp.SettingsController.getSetting("debug")&&console.log("refreshWAIT done");j()},function(o){DigiWebApp.ApplicationController.DigiLoaderView.hide();trackError(o)})};DigiWebApp.SettingsController.getSetting("debug")&&console.log("put currentBooking");DigiWebApp.ServiceAppController.putBookings([b.currentBooking],
m,m)};DigiWebApp.SettingsController.getSetting("debug")&&console.log("post currentBookingClosed");DigiWebApp.ServiceAppController.postBookings([b.currentBookingClosed],n,n)}else{DigiWebApp.SettingsController.getSetting("debug")&&console.log("put currentBooking");DigiWebApp.ServiceAppController.putBookings([b.currentBooking],j,j)}else{DigiWebApp.SettingsController.getSetting("debug")&&console.log("post currentBookingClosed");DigiWebApp.ServiceAppController.postBookings([b.currentBookingClosed],n,n)}else j()},
sendCurrentBookings:function(){DigiWebApp.BookingController.sendBookings()},isHandOrder:function(a){return _.select(DigiWebApp.HandOrder.findSorted(),function(b){if(b)return b.get("id")==a||b.get("name")==a}).length>0?YES:NO},autoSend:function(){return DigiWebApp.SettingsController.getSetting("autoTransferAfterBookTime")},openBooking:function(a){var b;try{b=DigiWebApp.BookingController.currentBookingTimesStampBook!=null?DigiWebApp.BookingController.currentBookingTimesStampBook:new Date}catch(c){b=
new Date}b.getTime();var d=new Date(b.getTime()+6E4*((new Date).getTimezoneOffset()-Number(DigiWebApp.SettingsController.getSetting("currentTimezoneOffset")))),e=M.Date.create(d.getTime());d=e.format("dd.mm.yyyy");e=e.format("HH:MM");return DigiWebApp.Booking.createRecord({orderId:a.oId?a.oId:null,orderName:a.oName?a.oName:null,handOrderId:a.hoId?a.hoId:null,handOrderName:a.hoName?a.hoName:null,latitude:a.lat?a.lat:null,longitude:a.lon?a.lon:null,latitude_bis:null,longitude_bis:null,positionId:a.pId?
a.pId:null,positionName:a.pName?a.pName:null,activityId:a.aId?a.aId:null,activityName:a.aName?a.aName:null,remark:a.remark?a.remark:"",istFeierabend:false,istKolonnenbuchung:false,mitarbeiterId:DigiWebApp.SettingsController.getSetting("mitarbeiterId"),genauigkeitVon:a.genauigkeitVon?a.genauigkeitVon:null,gps_zeitstempelVon:a.gps_zeitstempelVon?a.gps_zeitstempelVon:null,ermittlungsverfahrenVon:null,genauigkeitBis:null,gps_zeitstempelBis:null,ermittlungsverfahrenBis:null,ServiceApp_Status:"WAIT",timezoneOffset:DigiWebApp.SettingsController.getSetting("currentTimezoneOffset"),
timezone:DigiWebApp.SettingsController.getSetting("currentTimezone"),timeStampStart:b.getTime(),timeStampEnd:"0",startDateString:d,endeDateString:"",startTimeString:e,endeTimeString:"",modelVersion:"1",gefahreneKilometer:0})},sentBooking:function(a){if(a.get("startDateString")==a.get("endeDateString")&&a.get("startTimeString")==a.get("endeTimeString")){trackError("skip Zeitbuchung (sent) start==ende: "+a.get("startDateString")+", "+a.get("startTimeString")+" - "+a.get("endeDateString")+", "+a.get("endeTimeString"));
return null}var b=M.I18N.l("notDefined"),c=M.I18N.l("notDefined"),d=M.I18N.l("notDefined");if(typeof a.get("orderName")!=="undefined")b=a.get("orderName");else try{var e=a.get("orderId"),f=a.get("handOrderId");if(e!==0||f!==0){var g=_.select(DigiWebApp.Order.findSorted().concat(DigiWebApp.HandOrder.findSorted()),function(l){if(l){l=l.get("id");return e==l||f==l}});if(g&&g.length>0){g=g[0];b=g.get("name")}}}catch(i){trackError(i)}if(typeof a.get("positionName")!=="undefined")c=a.get("positionName");
else try{if(a.get("positionId")!==0)c=_.find(DigiWebApp.Position.find(),function(l){return parseIntRadixTen(l.get("id"))===parseIntRadixTen(a.get("positionId"))}).get("name")}catch(h){trackError(h)}if(typeof a.get("activityName")!=="undefined")d=a.get("activityName");else try{if(a.get("activityId")!==0)d=_.find(DigiWebApp.Activity.find(),function(l){return parseIntRadixTen(l.get("id"))===parseIntRadixTen(a.get("activityId"))}).get("name")}catch(j){trackError(j)}return DigiWebApp.SentBooking.createRecord({orderId:a.get("orderId"),
orderName:b,handOrderId:a.get("handOrderId"),handOrderName:a.get("handOrderName"),latitude:a.get("latitude"),longitude:a.get("longitude"),latitude_bis:a.get("latitude_bis"),longitude_bis:a.get("longitude_bis"),positionId:a.get("positionId"),positionName:c,activityId:a.get("activityId"),activityName:d,remark:a.get("remark"),istFeierabend:a.get("istFeierabend"),istKolonnenbuchung:a.get("istKolonnenbuchung"),genauigkeitVon:a.get("genauigkeitVon"),gps_zeitstempelVon:a.get("gps_zeitstempelVon"),ermittlungsverfahrenVon:a.get("ermittlungsverfahrenVon"),
genauigkeitBis:a.get("genauigkeitBis"),gps_zeitstempelBis:a.get("gps_zeitstempelBis"),ermittlungsverfahrenBis:a.get("ermittlungsverfahrenBis"),ServiceApp_Status:a.get("ServiceApp_Status"),timezoneOffset:a.get("timezoneOffset"),timeStampStart:a.get("timeStampStart"),timeStampEnd:a.get("timeStampEnd"),startDateString:a.get("startDateString"),endeDateString:a.get("endeDateString"),startTimeString:a.get("startTimeString"),endeTimeString:a.get("endeTimeString"),employees:a.get("employees"),isCurrent:false,
gefahreneKilometer:a.get("gefahreneKilometer")})},sentBookingArchived:function(){return null},setNotBookedBookings:function(){try{var a=DigiWebApp.Booking.find();if(a.length>0){_.each(a,function(c){var d=c.get("startDateString"),e=c.get("startTimeString");if((typeof d==="undefined"||!d||d===""||typeof e==="undefined"||!e||e==="")&&c.get("timeStampStart")!=="0"){e=D8.create(new Date(Number(c.get("timeStampStart"))+6E4*((new Date(Number(c.get("timeStampStart")))).getTimezoneOffset()-c.get("timezoneOffset"))));
d=e.format("dd.mm.yyyy");e=e.format("HH:MM")}var f=c.get("endeDateString"),g=c.get("endeTimeString");if((typeof f==="undefined"||!f||f===""||typeof g==="undefined"||!g||g==="")&&c.get("timeStampEnd")!=="0"){g=D8.create(new Date(Number(c.get("timeStampEnd"))+6E4*((new Date(Number(c.get("timeStampEnd")))).getTimezoneOffset()-c.get("timezoneOffset"))));f=g.format("dd.mm.yyyy");g=g.format("HH:MM")}typeof c.get("timezoneOffset")==="undefined"?c.set("date",c.get("timeStampStart")+","+c.get("timeStampEnd")+
",-120,"+d+","+e+","+f+","+g):c.set("date",c.get("timeStampStart")+","+c.get("timeStampEnd")+","+c.get("timezoneOffset")+","+d+","+e+","+f+","+g);parseIntRadixTen(c.get("orderId"))===0&&parseIntRadixTen(c.get("handOrderId"))!==0&&c.set("orderId",c.get("handOrderId"))});a=_.sortBy(a,function(c){return parseIntRadixTen(c.get("timeStampStart"))});this.set("timeData",a.reverse())}else this.set("timeData",[])}catch(b){this.set("timeData",[])}DigiWebApp.BookingController.setBookedBookings();DigiWebApp.BookingController.setArchivedDays()},
setBookedBookings:function(){try{var a=DigiWebApp.SentBooking.find();if(a.length>0){var b=D8.create("11/01/"+(new Date).getFullYear()+" 02:00:00").addDays(-D8.create("11/01/"+(new Date).getFullYear()+" 02:00:00").date.getDay()),c=D8.create("04/01/"+(new Date).getFullYear()+" 02:00:00").addDays(-D8.create("04/01/"+(new Date).getFullYear()+" 02:00:00").date.getDay()),d=new D8;c.timeBetween(d)>=0&&b.timeBetween(d);_.each(a,function(f){var g=f.get("startDateString"),i=f.get("startTimeString");if(typeof g===
"undefined"||!g||g===""||typeof i==="undefined"||!i||i===""){i=D8.create(new Date(Number(f.get("timeStampStart"))+6E4*((new Date(Number(f.get("timeStampStart")))).getTimezoneOffset()-f.get("timezoneOffset"))));g=i.format("dd.mm.yyyy");i=i.format("HH:MM")}var h=f.get("endeDateString"),j=f.get("endeTimeString");if(typeof h==="undefined"||!h||h===""||typeof j==="undefined"||!j||j===""){j=D8.create(new Date(Number(f.get("timeStampEnd"))+6E4*((new Date(Number(f.get("timeStampEnd")))).getTimezoneOffset()-
f.get("timezoneOffset"))));h=j.format("dd.mm.yyyy");j=j.format("HH:MM")}typeof f.get("timezoneOffset")==="undefined"?f.set("date",f.get("timeStampStart")+","+f.get("timeStampEnd")+",-120,"+g+","+i+","+h+","+j):f.set("date",f.get("timeStampStart")+","+f.get("timeStampEnd")+","+f.get("timezoneOffset")+","+g+","+i+","+h+","+j);parseIntRadixTen(f.get("orderId"))===0&&parseIntRadixTen(f.get("handOrderId"))!==0&&f.set("orderId",f.get("handOrderId"))});a=_.sortBy(a,function(f){return parseIntRadixTen(f.get("timeStampStart"))});
this.set("timeDataSent",a.reverse())}else this.set("timeDataSent",[])}catch(e){this.set("timeDataSent",[])}},setArchivedDays:function(){try{var a=DigiWebApp.SentTimeDataDays.find();if(typeof a!="undefined"&&a.length>0){DigiWebApp.SentTimeDataDays.deleteAll();var b=DigiWebApp.SentBookingArchived.find();typeof b!="undefined"&&b.length>0&&DigiWebApp.SentBookingArchived.deleteAll()}if(DigiWebApp.SettingsController.featureAvailable("411")){b=0;try{b=0+new Number(DigiWebApp.SettingsController.getSetting("daysToHoldBookingsOnDevice"))}catch(c){b=
DigiWebApp.SettingsController.defaultsettings.get("daysToHoldBookingsOnDevice")}a=[];for(var d=D8.create(),e=0;e<b;e++){var f=d.addDays(0-e),g=M.I18N.l(f.format("dddd")).substring(0,2)+", "+f.format("dd.mm.yyyy"),i=DigiWebApp.SentTimeDataDays.createRecord({tagLabel:g});a.push(i)}this.set("timeDataSentDays",a)}else this.set("timeDataSentDays",[])}catch(h){this.set("timeDataSentDays",[])}},setArchivedBookings:function(){try{if(DigiWebApp.BookingController.dayToDisplay!==null){var a=DigiWebApp.SentBookingArchived.find({query:{identifier:"tagLabel",
operator:"=",value:DigiWebApp.BookingController.dayToDisplay.get("tagLabel")}});if(a.length>0){var b=D8.create("11/01/"+(new Date).getFullYear()+" 02:00:00").addDays(-D8.create("11/01/"+(new Date).getFullYear()+" 02:00:00").date.getDay()),c=D8.create("04/01/"+(new Date).getFullYear()+" 02:00:00").addDays(-D8.create("04/01/"+(new Date).getFullYear()+" 02:00:00").date.getDay()),d=new D8;c.timeBetween(d)>=0&&b.timeBetween(d);_.each(a,function(f){var g=f.get("startDateString"),i=f.get("startTimeString");
if(typeof g==="undefined"||!g||g===""||typeof i==="undefined"||!i||i===""){i=D8.create(new Date(Number(f.get("timeStampStart"))+6E4*((new Date(Number(f.get("timeStampStart")))).getTimezoneOffset()-f.get("timezoneOffset"))));g=i.format("dd.mm.yyyy");i=i.format("HH:MM")}var h=f.get("endeDateString"),j=f.get("endeTimeString");if(typeof h==="undefined"||!h||h===""||typeof j==="undefined"||!j||j===""){j=D8.create(new Date(Number(f.get("timeStampEnd"))+6E4*((new Date(Number(f.get("timeStampEnd")))).getTimezoneOffset()-
f.get("timezoneOffset"))));h=j.format("dd.mm.yyyy");j=j.format("HH:MM")}typeof f.get("timezoneOffset")==="undefined"?f.set("date",f.get("timeStampStart")+","+f.get("timeStampEnd")+",-120,"+g+","+i+","+h+","+j):f.set("date",f.get("timeStampStart")+","+f.get("timeStampEnd")+","+f.get("timezoneOffset")+","+g+","+i+","+h+","+j);parseIntRadixTen(f.get("orderId"))===0&&parseIntRadixTen(f.get("handOrderId"))!==0&&f.set("orderId",f.get("handOrderId"))});a=_.sortBy(a,function(f){return parseIntRadixTen(f.get("timeStampStart"))});
this.set("timeDataSentArchived",a.reverse())}else this.set("timeDataSentArchived",[])}else this.set("timeDataSentArchived",[])}catch(e){this.set("timeDataSentArchived",[])}},setTimeDataForRemark:function(){try{if(DigiWebApp.BookingController.currentBooking!==null){var a=[DigiWebApp.BookingController.currentBooking];if(a.length>0){var b=D8.create("11/01/"+(new Date).getFullYear()+" 02:00:00").addDays(-D8.create("11/01/"+(new Date).getFullYear()+" 02:00:00").date.getDay()),c=D8.create("04/01/"+(new Date).getFullYear()+
" 02:00:00").addDays(-D8.create("04/01/"+(new Date).getFullYear()+" 02:00:00").date.getDay()),d=new D8;c.timeBetween(d)>=0&&b.timeBetween(d);_.each(a,function(f){var g=f.get("startDateString"),i=f.get("startTimeString");if(typeof g==="undefined"||!g||g===""||typeof i==="undefined"||!i||i===""){i=D8.create(new Date(Number(f.get("timeStampStart"))+6E4*((new Date(Number(f.get("timeStampStart")))).getTimezoneOffset()-f.get("timezoneOffset"))));g=i.format("dd.mm.yyyy");i=i.format("HH:MM")}var h=f.get("endeDateString"),
j=f.get("endeTimeString");if(typeof h==="undefined"||!h||h===""||typeof j==="undefined"||!j||j===""){j=D8.create(new Date(Number(f.get("timeStampEnd"))+6E4*((new Date(Number(f.get("timeStampEnd")))).getTimezoneOffset()-f.get("timezoneOffset"))));h=j.format("dd.mm.yyyy");j=j.format("HH:MM")}typeof f.get("timezoneOffset")==="undefined"?f.set("date",f.get("timeStampStart")+","+f.get("timeStampEnd")+",-120,"+g+","+i+","+h+","+j):f.set("date",f.get("timeStampStart")+","+f.get("timeStampEnd")+","+f.get("timezoneOffset")+
","+g+","+i+","+h+","+j);parseIntRadixTen(f.get("orderId"))===0&&parseIntRadixTen(f.get("handOrderId"))!==0&&f.set("orderId",f.get("handOrderId"))});a=_.sortBy(a,function(f){return parseIntRadixTen(f.get("timeStampStart"))});this.set("timeDataForEdit",a.reverse())}else this.set("timeDataForEdit",[])}}catch(e){this.set("timeDataForEdit",[])}},setTimeDataForEdit:function(){try{if(DigiWebApp.EditTimeDataPage.bookingToEdit!==null){var a=[DigiWebApp.EditTimeDataPage.bookingToEdit];if(a.length>0){var b=
D8.create("11/01/"+(new Date).getFullYear()+" 02:00:00").addDays(-D8.create("11/01/"+(new Date).getFullYear()+" 02:00:00").date.getDay()),c=D8.create("04/01/"+(new Date).getFullYear()+" 02:00:00").addDays(-D8.create("04/01/"+(new Date).getFullYear()+" 02:00:00").date.getDay()),d=new D8;c.timeBetween(d)>=0&&b.timeBetween(d);_.each(a,function(f){var g=f.get("startDateString"),i=f.get("startTimeString");if(typeof g==="undefined"||!g||g===""||typeof i==="undefined"||!i||i===""){i=D8.create(new Date(Number(f.get("timeStampStart"))+
6E4*((new Date(Number(f.get("timeStampStart")))).getTimezoneOffset()-f.get("timezoneOffset"))));g=i.format("dd.mm.yyyy");i=i.format("HH:MM")}var h=f.get("endeDateString"),j=f.get("endeTimeString");if(typeof h==="undefined"||!h||h===""||typeof j==="undefined"||!j||j===""){j=D8.create(new Date(Number(f.get("timeStampEnd"))+6E4*((new Date(Number(f.get("timeStampEnd")))).getTimezoneOffset()-f.get("timezoneOffset"))));h=j.format("dd.mm.yyyy");j=j.format("HH:MM")}typeof f.get("timezoneOffset")==="undefined"?
f.set("date",f.get("timeStampStart")+","+f.get("timeStampEnd")+",-120,"+g+","+i+","+h+","+j):f.set("date",f.get("timeStampStart")+","+f.get("timeStampEnd")+","+f.get("timezoneOffset")+","+g+","+i+","+h+","+j);parseIntRadixTen(f.get("orderId"))===0&&parseIntRadixTen(f.get("handOrderId"))!==0&&f.set("orderId",f.get("handOrderId"))});a=_.sortBy(a,function(f){return parseIntRadixTen(f.get("timeStampStart"))});this.set("timeDataForEdit",a.reverse())}else this.set("timeDataForEdit",[])}}catch(e){this.set("timeDataForEdit",
[])}},closeDay:function(){var a=DigiWebApp.BookingController;try{DigiWebApp.ApplicationController.vibrate()}catch(b){}if(a.currentBooking){var c=null;c=(new Date).getTime();if(M.Date.create(a.currentBooking.get("timeStampStart")).format("HH:MM")==M.Date.create(c).format("HH:MM")&&(a.currentBooking.get("timeStampEnd")==null||a.currentBooking.get("timeStampEnd")==""||parseIntRadixTen(a.currentBooking.get("timeStampEnd"))==0)){$("#"+DigiWebApp.BookingPage.content.grid.id).addClass("red");var d=window.setTimeout(function(){window.clearTimeout(d);
$("#"+DigiWebApp.BookingPage.content.grid.id).removeClass("red")},500);DigiWebApp.DashboardPage.content.list.selectedItem&&$("#"+DigiWebApp.DashboardPage.content.list.selectedItem.id).removeClass("selected");DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("bookingTooShort"),message:M.I18N.l("bookingTooShortMsg")});return null}else{$("#"+DigiWebApp.BookingPage.content.grid.id).addClass("green");d=window.setTimeout(function(){window.clearTimeout(d);$("#"+DigiWebApp.BookingPage.content.grid.id).removeClass("green")},
500);var e=function(){if(DigiWebApp.SettingsController.featureAvailable("403")&&!DigiWebApp.SettingsController.getSetting("remarkIsOptional")||DigiWebApp.SettingsController.featureAvailable("422")&&DigiWebApp.Activity.findById(DigiWebApp.BookingController.currentBooking.get("activityId")).get("istFahrzeitRelevant")){a.refreshCurrentBooking(false);DigiWebApp.NavigationController.toRemarkPage(function(){DigiWebApp.SettingsController.featureAvailable("404")?DigiWebApp.NavigationController.backToButtonDashboardPagePOP():
DigiWebApp.NavigationController.backToDashboardPagePOP();a.closeDayWithRemark()})}else a.closeDayWithRemark()};DigiWebApp.SettingsController.featureAvailable("418")?DigiWebApp.NavigationController.toSpesenPage(function(){DigiWebApp.SettingsController.featureAvailable("404")?DigiWebApp.NavigationController.backToButtonDashboardPagePOP():DigiWebApp.NavigationController.backToDashboardPagePOP();e()}):e()}}else a.closeDayWithRemark()},closeDayWithRemark:function(){this.currentBookingTimesStampBook=new Date;
this.getBookingLocation(this.closeDayWithRemarkWithPosition)},closeDayWithRemarkWithPosition:function(a){var b=DigiWebApp.BookingController,c=true;if(b.currentBooking){b.currentBooking.set("istFeierabend",true);(c=b.currentBooking.closeBooking(a))?b.currentBooking.removeAsCurrent():DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("bookingTooShort"),message:M.I18N.l("bookingTooShortMsg")});b.currentBooking.save();try{b.clearBookingNotification()}catch(d){}if(c){b.currentBookingClosed=
b.currentBooking;b.currentBooking=null}DigiWebApp.SettingsController.setSetting("currentTimezoneOffset",null);DigiWebApp.SettingsController.setSetting("currentTimezone",null);if(c){b.set("currentBookingStr","");DigiWebApp.SelectionController.resetSelection();DigiWebApp.SelectionController.initSelection();DigiWebApp.SelectionController.useSelections=NO}var e=function(){DigiWebApp.ApplicationController.DigiLoaderView.hide();var f=M.I18N.l("abwesend");localStorage.setItem(DigiWebApp.ApplicationController.storagePrefix+
"_notificationMessage",f);localStorage.setItem(DigiWebApp.ApplicationController.storagePrefix+"_currentBookingNotificationTimestamp",null);DigiWebApp.ApplicationController.startNotification();f=DigiWebApp.SettingsController.getSetting("autoTransferAfterClosingDay");if(DigiWebApp.SettingsController.getSetting("closeAppAfterCloseDay"))if(f)DigiWebApp.ApplicationController.closeAppAfterCloseDay=YES;if(DigiWebApp.SettingsController.getSetting("autoTransferAfterClosingDay"))DigiWebApp.DashboardController.dataTransfer(YES);
else{localStorage.setItem(DigiWebApp.EmployeeController.empSelectionKeyTmp,localStorage.getItem(DigiWebApp.EmployeeController.empSelectionKey));localStorage.removeItem(DigiWebApp.EmployeeController.empSelectionKey);DigiWebApp.EmployeeController.getEmployeeState()==2&&DigiWebApp.EmployeeController.setEmployeeState(1);DigiWebApp.ApplicationController.DigiLoaderView.hide();DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("closingDaySuccess"),message:M.I18N.l("closingDaySuccessWithoutMsg")})}};
if(DigiWebApp.SettingsController.featureAvailable("417")&&DigiWebApp.SettingsController.getSetting("ServiceApp_ermittleGeokoordinate"))if(DigiWebApp.SettingsController.getSetting("ServiceApp_engeKopplung")||DigiWebApp.SettingsController.getSetting("autoTransferAfterClosingDay")){a=function(){DigiWebApp.SettingsController.getSetting("debug")&&console.log("polling for bookinglocations");var f=[];b.currentBooking!==null&&f.push(b.currentBooking.m_id);b.currentBookingClosed!==null&&f.push(b.currentBookingClosed.m_id);
DigiWebApp.ServiceAppController.pollBookings(f,function(g){DigiWebApp.SettingsController.getSetting("debug")&&console.log(g.length+" Datens\u00e4tze empfangen");_.each(g,function(i){try{DigiWebApp.SettingsController.getSetting("debug")&&console.log("speichere gepullten Datensatz "+i.m_id);var h=_.find(DigiWebApp.Booking.find(),function(n){return n.m_id===i.m_id}),j=i.record;DigiWebApp.SettingsController.getSetting("debug")&&console.log("modelBooking: ",h);DigiWebApp.SettingsController.getSetting("debug")&&
console.log("datensatz: ",j);h.set("latitude",j.latitude);h.set("latitude_bis",j.latitude_bis);h.set("longitude",j.longitude);h.set("longitude_bis",j.longitude_bis);h.set("ermittlungsverfahrenBis",j.ermittlungsverfahren_bis);h.set("ermittlungsverfahrenVon",j.ermittlungsverfahren);h.set("genauigkeitBis",j.genauigkeit_bis);h.set("genauigkeitVon",j.genauigkeit);h.set("gps_zeitstempelBis",j.gps_zeitstempel_bis);h.set("gps_zeitstempelVon",j.gps_zeitstempel);h.set("ServiceApp_Status",j.status);h.save();
DigiWebApp.SettingsController.getSetting("debug")&&console.log("datensatz "+i.m_id+" gespeichert")}catch(l){DigiWebApp.SettingsController.getSetting("debug")&&console.log("datensatz "+i.m_id+" nicht gefunden")}});b.currentBookingClosed=null;e()},e,DigiWebApp.SettingsController.getSetting("GPSTimeOut"))};if(c){DigiWebApp.SettingsController.getSetting("debug")&&console.log("post currentBookingClosed");DigiWebApp.ServiceAppController.postBookings([b.currentBookingClosed],a,e)}else{DigiWebApp.SettingsController.getSetting("debug")&&
console.log("post currentBooking");DigiWebApp.ServiceAppController.postBookings([b.currentBooking],function(){},function(){})}}else{if(c)if(b.currentBookingClosed!==null){c=function(){DigiWebApp.SettingsController.getSetting("debug")&&console.log("refreshWAIT");DigiWebApp.ServiceAppController.refreshWAITBookings(function(){DigiWebApp.SettingsController.getSetting("debug")&&console.log("refreshWAIT done");e()},function(f){trackError(f);e()})};DigiWebApp.SettingsController.getSetting("debug")&&console.log("post currentBookingClosed");
DigiWebApp.ServiceAppController.postBookings([b.currentBookingClosed],c,c)}else e()}else c&&e()}else{DigiWebApp.ApplicationController.DigiLoaderView.hide();DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("hint"),message:M.I18N.l("noOpenBookings")})}},loadSignatures:function(a,b){if(typeof b!=="function")trackError("loadSignaturesError: successCallback is not a function");else{DigiWebApp.ApplicationController.DigiLoaderView.show(M.I18N.l("loadSignatures"));var c=a.length,d=0;
c!==0?_.each(a,function(e){d+=1;if(e.hasFileName())e.readFromFile(function(f){f&&f!==""&&DigiWebApp.BookingController.propagateBookingWithSignature(a,e.m_id,f);d===c&&b()},function(){d===c&&b()});else d===c&&b()}):b()}},propagateBookingWithSignature:function(a,b,c){_.each(a,function(d){if(d.m_id===b)d.signature=c})},sendBookings:function(a,b){var c=DigiWebApp.Booking.find();DigiWebApp.BookingController.loadSignatures(c,function(){DigiWebApp.BookingController.sendSignatures(c,a,b)})},sendSignatures:function(a,
b,c){var d=this,e=[];_.each(a,function(f){if(f.signature){var g=f.record;g.unterschrift=JSON.parse(f.signature);e.push(g)}});if(e.length!==0){a=function(){d.sendBookingsWithoutSignatures(DigiWebApp.Booking.find(),b,c)};a={data:{unterschriften:e},webservice:"medien/unterschrift",loaderText:M.I18N.l("sendSignatures"),successCallback:a,errorCallback:a};DigiWebApp.JSONDatenuebertragungController.sendData(a)}else d.sendBookingsWithoutSignatures(DigiWebApp.Booking.find(),b,c)},sendBookingsWithoutSignatures:function(a,
b,c){var d=false;if(typeof c!=="undefined")d=c;a.length>0&&DigiWebApp.JSONDatenuebertragungController.sendeZeitdaten(a,function(){var e=DigiWebApp.BookingController,f=false;_.each(a,function(h){if(h.get("isCurrent"))f=true});DigiWebApp.SettingsController.getSetting("debug")&&console.log("CurrentAvailable: ",f);f||DigiWebApp.SentBooking.deleteAll();var g=[];_.each(DigiWebApp.Booking.find(),function(h){if(!h.get("isCurrent")){if(f)try{var j=e.sentBooking(h);j!=null&&j.save()}catch(l){DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("error"),
message:M.I18N.l("errorWhileBackingUpBookings")})}g.push(h.m_id);h.del()}});DigiWebApp.SettingsController.featureAvailable("417")&&DigiWebApp.ServiceAppController.deleteBookings(g,function(){DigiWebApp.SettingsController.getSetting("debug")&&console.log("Buchungen wurden in der ServiceApp gel\u00f6scht.")},function(){DigiWebApp.SettingsController.getSetting("debug")&&console.log("Buchungen konnten nicht in der ServiceApp gel\u00f6scht werden.")});DigiWebApp.SelectionController.resetSelection();f?
DigiWebApp.SelectionController.setSelectionByCurrentBooking():DigiWebApp.SelectionController.initSelection();if(b){e.set("currentBookingStr","");DigiWebApp.EmployeeController.getEmployeeState()==2&&DigiWebApp.EmployeeController.setEmployeeState(1);localStorage.removeItem(DigiWebApp.EmployeeController.empSelectionKey);localStorage.removeItem(DigiWebApp.EmployeeController.empSelectionKeyTmp)}DigiWebApp.ApplicationController.DigiLoaderView.hide();var i=function(){if(DigiWebApp.SettingsController.getSetting("autoSyncAfterBookTime")||
d===true)if(DigiWebApp.ApplicationController.closeAppAfterCloseDay)typeof navigator!="undefined"&&typeof navigator.app!="undefined"&&typeof navigator.app.exitApp!="undefined"?DigiWebApp.ApplicationController.exitApp(true):autoCleanLogs(function(){DigiWebApp.ApplicationController.startsync(YES)});else autoCleanLogs(function(){DigiWebApp.ApplicationController.startsync(YES)})};DigiWebApp.SettingsController.featureAvailable("402")&&!DigiWebApp.BookingController.currentBooking||DigiWebApp.SettingsController.featureAvailable("426")&&
!DigiWebApp.BookingController.currentBooking?DigiWebApp.BautagebuchDatenuebertragungController.ausgekoppelteSenden(function(){i()}):i()},function(){DigiWebApp.ApplicationController.DigiLoaderView.hide();DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("sendDataFail"),message:M.I18N.l("sendDataFailMsg")})},b,d)},buildBookingStr:function(){var a="";a=typeof this.currentBooking.get("timezoneOffset")==="undefined"?(new Date(this.currentBooking.get("timeStampStart"))).getTime():(new Date(this.currentBooking.get("timeStampStart")-
6E4*(this.currentBooking.get("timezoneOffset")-(new Date).getTimezoneOffset()))).getTime();a=M.Date.create(a).format("dd.mm.yy HH:MM");var b=M.I18N.l("bookingNotificationSince")+" "+a;localStorage.setItem(DigiWebApp.ApplicationController.storagePrefix+"_notificationMessage",b);return a},spesenOptionen:null,uebernachtungOptionen:null,startBrowserBookingNotificationTimeout:null,startBrowserBookingNotificationObject:null,startBrowserBookingNotification:function(a){var b=this;if(!onIOS&&!onAndroid23){if(b.startBrowserBookingNotificationTimeout!=
null){window.clearTimeout(b.startBrowserBookingNotificationTimeout);b.startBrowserBookingNotificationTimeout=null}try{b.startBrowserBookingNotificationObject.close()}catch(c){}var d=(new Date).getTime();d=a.getTime()-d;var e=function(){var f=parseIntRadixTen(DigiWebApp.SettingsController.getSetting("BookingReminderHours")),g=M.I18N.l("BookingReminderMessage")+f;g+=f==1?M.I18N.l("BookingReminderMessageTailSingle"):M.I18N.l("BookingReminderMessageTail");try{Notification.requestPermission(function(h){if(Notification.permission!==
h)Notification.permission=h;if(h==="granted"){b.startBrowserBookingNotificationObject=new Notification(M.I18N.l("BookingReminderTitle"),{body:g,icon:"theme/images/Icon.png",tag:"2"});var j=function(){try{pluginObj.notification.local.cancel("4711")}catch(l){}try{pluginObj.notification.local.cancel("4712")}catch(n){}var m=D8.create(a.getTime()).addHours(1).date;b.startBrowserBookingNotification(m)};b.startBrowserBookingNotificationObject.onclose=j;b.startBrowserBookingNotificationObject.onclick=function(){DigiWebApp.NavigationController.toBookTimePage();
j()}}else alert(g)})}catch(i){alert(g)}};if(d>0)b.startBrowserBookingNotificationTimeout=window.setTimeout(e,d);else e()}},startBookingNotification:function(a){if(!onIOS&&!onAndroid23)try{var b=parseIntRadixTen(DigiWebApp.SettingsController.getSetting("BookingReminderHours"));if(b==0)return false;this.clearBookingNotification();var c=window.plugin;if(typeof c=="undefined")c=window.plugins;var d=DigiWebApp.Booking.find().concat(DigiWebApp.SentBooking.find()),e=[];if(d.length>0)e=_.filter(d,function(o){return o.get("istFeierabend")});
var f=null,g;if(e.length>0){f=_.sortBy(e,function(o){return o.get("timeStampStart")})[e.length-1];e=[];if(f!=null)e=_.filter(d,function(o){return o.get("timeStampStart")>f.get("timeStampStart")});if(e.length>0)g=_.sortBy(e,function(o){return o.get("timeStampStart")})[0]}else g=_.sortBy(d,function(o){return o.get("timeStampStart")})[0];if(typeof a=="undefined"){if(typeof g!="undefined")a=D8.create(g.get("timeStampStart"));else return false;a=a.addHours(parseIntRadixTen(DigiWebApp.SettingsController.getSetting("BookingReminderHours")));
a=a.date}if(typeof c=="undefined"||typeof c.notification=="undefined"||typeof c.notification.local=="undefined")return this.startBrowserBookingNotification(a);try{c.notification.local.hasPermission(function(){});c.notification.local.promptForPermission()}catch(i){}var h=M.I18N.l("BookingReminderMessage")+b;h+=b==1?M.I18N.l("BookingReminderMessageTailSingle"):M.I18N.l("BookingReminderMessageTail");try{localStorage.setItem(DigiWebApp.ApplicationController.storagePrefix+"_currentBookingNotificationTimestamp",
a.getTime());var j={id:"4712",title:M.I18N.l("BookingReminderTitle"),message:h,repeat:"hourly",autoCancel:true,ongoing:false},l=(new Date).getTime();if(a.getTime()>l)j.date=a;c.notification.local.add(j)}catch(n){trackError(n)}}catch(m){trackError(m)}},clearBookingNotification:function(){if(!onIOS&&!onAndroid23){var a=window.plugin;if(typeof a=="undefined")a=window.plugins;if(this.startBrowserBookingNotificationTimeout!=null){window.clearTimeout(this.startBrowserBookingNotificationTimeout);this.startBrowserBookingNotificationTimeout=
null}try{this.startBrowserBookingNotificationObject.close()}catch(b){}try{a.notification.local.cancel("4712")}catch(c){}}}});
DigiWebApp.CameraController=M.Controller.extend({orders:null,positions:null,activities:null,selections:{order:null,position:null,activity:null},loadedPicture:null,loadedFileName:null,fileType:null,init:function(){$("#"+DigiWebApp.CameraPage.content.remarkInput.id).val("");M.ViewManager.getView("cameraPage","remarkInput").value="";if(DigiWebApp.CameraController.loadedPicture===null){document.getElementById(DigiWebApp.CameraPage.content.image.id).src="";DigiWebApp.CameraController.myImageObj=new Image}typeof navigator.camera!==
"undefined"&&typeof navigator.camera.getPicture!=="undefined"&&DigiWebApp.CameraController.loadedPicture===null?DigiWebApp.CameraController.takePicture():DigiWebApp.CameraController.useLoadedPicture();DigiWebApp.BookingController.currentBooking?DigiWebApp.CameraController.setSelectionByCurrentBooking():DigiWebApp.CameraController.initSelection();this.saveSelection();if(DigiWebApp.SettingsController.getSetting("DTC6aktiv")){DigiWebApp.ApplicationController.dtc6AktivRenameHelper(DigiWebApp.CameraPage.content.order.id,
M.I18N.l("dtc6Ordner"));DigiWebApp.ApplicationController.dtc6AktivRenameHelper(DigiWebApp.CameraPage.content.position.id,M.I18N.l("dtc6Auftrag"));DigiWebApp.ApplicationController.dtc6AktivRenameHelper(DigiWebApp.CameraPage.content.activity.id,M.I18N.l("dtc6Leistung"))}},setSelectionByCurrentBooking:function(){var a=DigiWebApp.BookingController.currentBooking,b=DigiWebApp.HandOrder.findSorted().concat(DigiWebApp.Order.findSorted()),c=DigiWebApp.Position.findSorted(),d=DigiWebApp.CameraController.getActivities(),
e=(a.get("orderId")=="0"?0:a.get("orderId"))||a.get("handOrderId"),f=a.get("positionId"),g=a.get("activityId");a=_.map(b,function(h){return h.get("id")==e?{label:h.get("name"),value:h.get("id"),isSelected:YES}:{label:h.get("name"),value:h.get("id")}});a=_.compact(a);a.push({label:M.I18N.l("selectSomething"),value:"0"});c=_.map(c,function(h){if(parseIntRadixTen(h.get("orderId"))===parseIntRadixTen(e)){var j=null;return j=h.get("id")==f?{label:h.get("name"),value:h.get("id"),isSelected:YES}:{label:h.get("name"),
value:h.get("id")}}return null});c=_.compact(c);c.push({label:M.I18N.l("selectSomething"),value:"0"});d=_.select(DigiWebApp.WorkPlan.find(),function(h){if(h)return h.get("id")==f});var i=NO;d=d.length>0?this.getActivitiesFromWorkplan(d[0]):DigiWebApp.CameraController.getActivities();d=_.map(d,function(h){if(typeof h==="undefined"){console.log("UNDEFINED ACTIVITY");return null}else{var j=null;if(h.get("id")==g){j={label:h.get("name"),value:h.get("id"),isSelected:YES};i=YES}else j={label:h.get("name"),
value:h.get("id")};return j}});d=_.compact(d);d.push({label:M.I18N.l("selectSomething"),value:"0",isSelected:!i});this.resetSelection();this.set("orders",a);this.set("positions",c);this.set("activities",d)},setPositions:function(){var a=M.ViewManager.getView("cameraPage","order").getSelection(YES).value;if(a){var b=DigiWebApp.Position.findSorted(),c=0;b=_.map(b,function(d){if(d.get("orderId")==a){d={label:d.get("name"),value:d.get("id")};if(c===0)d.isSelected=YES;c+=1;return d}return null});b=_.compact(b);
b.length<1&&b.push({label:M.I18N.l("noData"),value:"0"});M.ViewManager.getView("cameraPage","position").resetSelection();this.set("positions",b);this.setActivities(YES);this.saveSelection()}},setActivities:function(a){var b=null;if(a)if(a=M.ViewManager.getView("cameraPage","position").getSelection(YES))b=a.value;a=[];var c=[];_.each(DigiWebApp.WorkPlan.find(),function(g){g.get("id")==b&&c.push(g)});var d=0;a=c.length===1?this.getActivitiesFromWorkplan(c[0]):DigiWebApp.CameraController.getActivities();
var e=-1;if(typeof DigiWebApp.BookingController.currentBooking!=="undefined"&&DigiWebApp.BookingController.currentBooking!==null)e=DigiWebApp.BookingController.currentBooking.get("activityId");var f=false;_.each(a,function(g){if(typeof g==="undefined"){console.log("UNDEFINED ACTIVITY");return null}else if(g.get("id")==e)f=true});a=_.map(a,function(g){if(typeof g==="undefined"){console.log("UNDEFINED ACTIVITY");return null}else{var i=null;i=f?{label:g.get("name"),value:g.get("id"),isSelected:g.get("id")==
e?YES:NO}:{label:g.get("name"),value:g.get("id"),isSelected:d===0?YES:NO};d+=1;return i}});a=_.compact(a);a.length>0?a.push({label:M.I18N.l("selectSomething"),value:"0",isSelected:NO}):a.push({label:M.I18N.l("noData"),value:"0"});M.ViewManager.getView("cameraPage","activity").resetSelection();this.set("activities",a);this.saveSelection()},initSelection:function(){var a=DigiWebApp.HandOrder.findSorted().concat(DigiWebApp.Order.findSorted()),b=DigiWebApp.Position.findSorted(),c=DigiWebApp.CameraController.getActivities(),
d=[];if(a)d=_.map(a,function(e){if(e)return{label:e.get("name"),value:e.get("id")}});d.push({label:M.I18N.l("selectSomething"),value:"0",isSelected:YES});a=[];if(b)a=_.map(b,function(e){if(e)return{label:e.get("name"),value:e.get("id")}});a.push({label:M.I18N.l("selectSomething"),value:"0",isSelected:YES});b=[];if(c)b=_.map(c,function(e){if(typeof e==="undefined"){console.log("UNDEFINED ACTIVITY");return null}else return{label:e.get("name"),value:e.get("id")}});b.push({label:M.I18N.l("selectSomething"),
value:"0",isSelected:YES});this.resetSelection();this.set("orders",d);this.set("positions",a);this.set("activities",b);M.ViewManager.getView("cameraPage","order").setSelection("0");M.ViewManager.getView("cameraPage","position").setSelection("0");M.ViewManager.getView("cameraPage","activity").setSelection("0")},resetSelection:function(){M.ViewManager.getView("cameraPage","order").resetSelection();M.ViewManager.getView("cameraPage","position").resetSelection();M.ViewManager.getView("cameraPage","activity").resetSelection()},
isPositionSelected:function(){var a=M.ViewManager.getView("cameraPage","position").getSelection(YES);return a&&a.value!="0"?YES:NO},isActivitySelected:function(){var a=M.ViewManager.getView("cameraPage","activity").getSelection(YES);return a&&a.value!="0"?YES:NO},saveSelection:function(){var a=M.ViewManager.getView("cameraPage","order").getSelection(),b=M.ViewManager.getView("cameraPage","position").getSelection(),c=M.ViewManager.getView("cameraPage","activity").getSelection();this.selections.order=
a;this.selections.position=b;this.selections.activity=c;this.useSelections=YES},getActivities:function(a){a=a?DigiWebApp.Activity.find(a):DigiWebApp.Activity.findSorted();a=_.map(a,function(b){return parseIntRadixTen(b.get("positionId"))===1?b:null});return a=_.compact(a)},getActivitiesFromWorkplan:function(a){var b=a.get("activityIds").split(","),c=[];if(b&&b.length>0)for(var d=0;d<b.length;d++)c.push(_.find(DigiWebApp.Activity.find(),function(e){return e.get("id")==b[d]}));if(parseIntRadixTen(a.get("workplanType"))===
1)c=_.map(c,function(e){if(typeof e==="undefined"){console.log("UNDEFINED ACTIVITY");return null}else{var f=NO,g=DigiWebApp.Activity.findSorted();_.each(g,function(i){if(parseIntRadixTen(i.get("positionId"))===1)f=YES});return f?e:null}});return c=_.compact(c)},takePicture:function(){var a=parseIntRadixTen(DigiWebApp.SettingsController.defaultsettings.get("pictureEncodingQuality")),b=DigiWebApp.SettingsController.getSetting("pictureEncodingQuality");if(parseIntRadixTen(b)>9)a=parseIntRadixTen(b);
b=navigator.camera.EncodingType.JPEG;if(DigiWebApp.SettingsController.getSetting("pictureEncodingType")=="PNG")b=navigator.camera.EncodingType.PNG;var c=DigiWebApp.CameraController.cameraSuccessBase64,d=navigator.camera.DestinationType.DATA_URL;c=d==navigator.camera.DestinationType.DATA_URL?DigiWebApp.CameraController.cameraSuccessBase64:DigiWebApp.CameraController.cameraSuccessURI;var e=parseBool(DigiWebApp.SettingsController.getSetting("pictureAllowEdit"));navigator.camera.getPicture(c,DigiWebApp.CameraController.cameraError,
{quality:a,allowEdit:e,destinationType:d,encodingType:b,sourceType:navigator.camera.PictureSourceType.CAMERA,mediaType:navigator.camera.MediaType.PICTURE,saveToPhotoAlbum:false})},useLoadedPicture:function(){document.getElementById(DigiWebApp.CameraPage.content.image.id).src=DigiWebApp.CameraController.loadedPicture;DigiWebApp.CameraController.myImageObj=new Image;DigiWebApp.CameraController.myImageObj.src=DigiWebApp.CameraController.loadedPicture},savePicture:function(){this.savePictureWithLocation(null)},
savePictureWithLocation:function(a){this.saveSelection();var b=M.ViewManager.getView("cameraPage","order").getSelection(),c=M.ViewManager.getView("cameraPage","position").getSelection(YES);c=c?c.value:null;var d=M.ViewManager.getView("cameraPage","activity").getSelection(YES);d=d?d.value:null;var e=null,f=null;if(DigiWebApp.BookingController.isHandOrder(b)){e=b;f=_.select(DigiWebApp.HandOrder.findSorted(),function(q){if(q)return q.get("id")==b||q.get("name")==b})[0].get("name");b=e;c=null}var g="0",
i="0";if(a){if(a.latitude)g=a.latitude;if(a.longitude)i=a.longitude}var h=this.newMediaFile({oId:b,hoId:e,hoName:f,lat:g,lon:i,pId:c,aId:d,mId:DigiWebApp.SettingsController.getSetting("mitarbeiterId")});h.setRemark(M.ViewManager.getView("cameraPage","remarkInput").value);a=document.getElementById(DigiWebApp.CameraPage.content.image.id);h.set("fileType",DigiWebApp.CameraController.get("fileType"));c=M.I18N.l("notDefined");d=M.I18N.l("notDefined");e=M.I18N.l("notDefined");try{var j=h.get("orderId"),
l=h.get("handOrderId");if(j!==null||l!=null){var n=_.select(DigiWebApp.Order.findSorted().concat(DigiWebApp.HandOrder.findSorted()),function(q){if(q){q=q.get("id");return j==q||l==q}});if(n&&n.length>0){n=n[0];c=n.get("name")}}}catch(m){trackError(m)}try{if(parseIntRadixTen(h.get("positionId"))!==0)d=_.find(DigiWebApp.Position.find(),function(q){return parseIntRadixTen(q.get("id"))===parseIntRadixTen(h.get("positionId"))}).get("name")}catch(o){trackError(o)}try{if(parseIntRadixTen(h.get("activityId"))!==
0)e=_.find(DigiWebApp.Activity.find(),function(q){return parseIntRadixTen(q.get("id"))===parseIntRadixTen(h.get("activityId"))}).get("name")}catch(p){trackError(p)}h.set("orderName",c);h.set("positionName",d);h.set("activityName",e);h.save();h.saveToFile(a.src,DigiWebApp.NavigationController.backToMediaListPageTransition)},newMediaFile:function(a){return DigiWebApp.MediaFile.createRecord({orderId:a.oId?a.oId:"0",handOrderId:a.hoId?a.hoId:"0",handOrderName:a.hoName?a.hoName:"0",latitude:a.lat?a.lat:
"0",longitude:a.lon?a.lon:"0",positionId:a.pId?a.pId:"0",activityId:a.aId?a.aId:"0",mitarbeiterId:a.mId?a.mId:"0",icon:"48x48_plain_camera2.png",timeStamp:+new Date})},myImageData:null,myImageObj:null,cameraSuccessBase64:function(a){DigiWebApp.CameraController.set("fileType",DigiWebApp.ApplicationController.getImageFiletype());DigiWebApp.CameraController.myImageData=a;document.getElementById(DigiWebApp.CameraPage.content.image.id).src="data:"+DigiWebApp.ApplicationController.getImageFiletype()+","+
a;DigiWebApp.CameraController.myImageObj=new Image;DigiWebApp.CameraController.myImageObj.src="data:"+DigiWebApp.ApplicationController.getImageFiletype()+","+a},myImageURI:null,cameraSuccessURI:function(a){DigiWebApp.CameraController.myImageURI=a;document.getElementById(DigiWebApp.CameraPage.content.image.id).src=a},cameraError:function(a){DigiWebApp.ApplicationController.nativeAlertDialogView({title:"ERROR",message:a,callbacks:{confirm:{target:this,action:function(){DigiWebApp.NavigationController.backToMediaListPageTransition()}}}})}});
DigiWebApp.DashboardController=M.Controller.extend({items:null,itemsButtons:null,itemsWithoutUpdate:null,latestId:null,lastTimestampDatatransfer:null,appCacheUpdateReady:function(){if(window.applicationCache)if(window.applicationCache.status==window.applicationCache.UPDATEREADY)return true;else{if(DigiWebApp.ApplicationController.timeouthappened&&window.applicationCache.status!==window.applicationCache.UNCACHED)try{window.applicationCache.update()}catch(a){}return window.applicationCache.status==
window.applicationCache.UPDATEREADY}else return false},initButtons:function(a){this.init(a);a={};for(var b=[],c=0;c<this.items.length;c++){a.label=this.items[c].label;a.id=this.items[c].id;switch(this.items[c].label){case M.I18N.l("closingTime"):a.icon="48x48_plain_home.png";break;case M.I18N.l("dataTransfer"):a.icon="48x48_plain_refresh.png";break;case M.I18N.l("handApplications"):a.icon="48x48_plain_handauftrag.png";break;case M.I18N.l("timeData"):a.icon="48x48_plain_note_view.png";break;case M.I18N.l("orderInfo"):a.icon=
"48x48_plain_folder_view.png";break;case M.I18N.l("media"):a.icon="48x48_plain_index.png";break;case M.I18N.l("materialPickUp"):a.icon="48x48_plain_shelf.png";break;case M.I18N.l("dailyChecklist"):a.icon="48x48_plain_pda_write.png";break;case M.I18N.l("Anwesenheitsliste"):a.icon="48x48_plain_text_code.png";break;case M.I18N.l("Bautagebuch"):a.icon="48x48_plain_graphics-tablet.png";break;case M.I18N.l("settings"):a.icon="48x48_plain_gears.png";break;case M.I18N.l("info"):a.icon="48x48_plain_about.png";
break;default:a.icon="icon_info.png"}b.push(JSON.parse(JSON.stringify(a)))}this.set("itemsButtons",b)},init:function(a){if(DigiWebApp.DashboardPage.needsUpdate||a||this.appCacheUpdateReady()){a=DigiWebApp.SettingsController.featureAvailable("409");var b;b=a?[{label:M.I18N.l("dataTransfer"),icon:"48x48_plain_refresh.png",id:"dataTransfer"}]:[{label:M.I18N.l("closingTime"),icon:"48x48_plain_home.png",id:"closingTime"},{label:M.I18N.l("dataTransfer"),icon:"48x48_plain_refresh.png",id:"dataTransfer"},
{label:M.I18N.l("handApplications"),icon:"48x48_plain_handauftrag.png",id:"handOrder"},{label:M.I18N.l("timeData"),icon:"48x48_plain_note_view.png",id:"timeData"}];if(DigiWebApp.SettingsController.featureAvailable("410")){b=_.map(b,function(d){if(d.id!=="handOrder")return d});b=_.compact(b)}if(DigiWebApp.SettingsController.featureAvailable("420")){b=_.map(b,function(d){if(d.id!=="closingTime")return d});b=_.compact(b)}DigiWebApp.SettingsController.featureAvailable("406")&&!a&&b.push({label:M.I18N.l("orderInfo"),
icon:"48x48_plain_folder_view.png",id:"orderInfo"});var c=DigiWebApp.SettingsController.featureAvailable("400");DigiWebApp.SettingsController.featureAvailable("401")&&!a&&b.push({label:M.I18N.l("media")+" (DEMO)",icon:"48x48_plain_camera2.png",id:"demomedia"});c&&b.push({label:M.I18N.l("media"),icon:"48x48_plain_camera2.png",id:"media"});DigiWebApp.SettingsController.featureAvailable("402")&&!a&&b.push({label:M.I18N.l("materialPickUp"),icon:"48x48_plain_shelf.png",id:"materialerfassung"});DigiWebApp.SettingsController.featureAvailable("426")&&
!a&&b.push({label:M.I18N.l("BautagebuchNotizen"),icon:"48x48_plain_clipboard.png",id:"notizen"});DigiWebApp.SettingsController.featureAvailable("407")&&!a&&b.push({label:M.I18N.l("dailyChecklist"),icon:"48x48_plain_pda_write.png",id:"tagescheckliste"});DigiWebApp.SettingsController.featureAvailable("408")&&b.push({label:M.I18N.l("Anwesenheitsliste"),icon:"48x48_plain_text_code.png",id:"anwesenheitsliste"});DigiWebApp.SettingsController.featureAvailable("412")&&b.push({label:M.I18N.l("Bautagebuch"),
icon:"48x48_plain_graphics-tablet.png",id:"bautagebuch"});DigiWebApp.SettingsController.featureAvailable("423")&&b.push({label:M.I18N.l("TerminlisteLong"),icon:"48x48_plain_book_blue_find.png",id:"Terminliste"});DigiWebApp.SettingsController.featureAvailable("425")&&b.push({label:M.I18N.l("FestePauseStornieren"),icon:"48x48_plain_note_delete.png",id:"FestePauseStornieren"});b.push({label:M.I18N.l("settings"),icon:"48x48_plain_gears.png",id:"settings"});b.push({label:M.I18N.l("info"),icon:"48x48_plain_about.png",
id:"info"});this.set("items",b);this.set("itemsWithoutUpdate",b);DigiWebApp.DashboardPage.needsUpdate=false}if(window.newAppVersionAvailable){a=this.itemsWithoutUpdate;a.push({label:M.I18N.l("updateApplication"),icon:"48x48_plain_replace2.png",id:"updateApplication"});this.set("items",a)}else this.set("items",this.itemsWithoutUpdate);(a=M.ViewManager.getView("dashboard","list"))&&$("#"+a.id).find("li").each(function(){$(this).removeClass("selected")})},itemSelected:function(a,b){try{DigiWebApp.ApplicationController.vibrate()}catch(c){}var d=
this;this.latestId&&$("#"+this.latestId).removeClass("selected");$("#"+a).addClass("selected");this.latestId=a;if(b&&typeof this[b]==="function")this[b]();else try{_.each(DigiWebApp.ButtonDashboardPage.content.list.contentBinding.target[DigiWebApp.ButtonDashboardPage.content.list.contentBinding.property],function(f){var g=$("#"+a).html(),i=d[f.id];f.label===g&&typeof i==="function"&&i()})}catch(e){}},bookTime:function(){DigiWebApp.NavigationController.toBookTimePageTransition(YES)},closingTime:function(){DigiWebApp.DashboardPage.content.list.selectedItem&&
$("#"+DigiWebApp.DashboardPage.content.list.selectedItem.id).removeClass("selected");DigiWebApp.ApplicationController.DigiLoaderView.show(M.I18N.l("bucheFeierabend"));setTimeout(DigiWebApp.BookingController.closeDay,100)},dataTransfer:function(a){DigiWebApp.DashboardPage.content.list.selectedItem&&$("#"+DigiWebApp.DashboardPage.content.list.selectedItem.id).removeClass("selected");writeToLog("Hauptmen\u00fc: '"+M.I18N.l("dataTransfer")+"' gedr\u00fcckt");var b=NO;if(DigiWebApp.DashboardController.lastTimestampDatatransfer!==
null)if(D8.now().getTimestamp()-DigiWebApp.DashboardController.lastTimestampDatatransfer>parseIntRadixTen(DigiWebApp.SettingsController.getSetting("datatransfer_min_delay"))){b=YES;DigiWebApp.DashboardPage.content.list.selectedItem&&$("#"+DigiWebApp.DashboardPage.content.list.selectedItem.id).addClass("green");var c=window.setTimeout(function(){window.clearTimeout(c);DigiWebApp.DashboardPage.content.list.selectedItem&&$("#"+DigiWebApp.DashboardPage.content.list.selectedItem.id).removeClass("green")},
500)}else{$("#"+DigiWebApp.DashboardPage.content.list.selectedItem.id).addClass("red");c=window.setTimeout(function(){window.clearTimeout(c);DigiWebApp.DashboardPage.content.list.selectedItem&&$("#"+DigiWebApp.DashboardPage.content.list.selectedItem.id).removeClass("red")},500)}if(b===YES||DigiWebApp.DashboardController.lastTimestampDatatransfer===null){DigiWebApp.ApplicationController.DigiLoaderView.show(M.I18N.l("starteDatenuebertragung"));DigiWebApp.DashboardController.set("lastTimestampDatatransfer",
D8.now().getTimestamp());if(DigiWebApp.Booking.find().length>0){var d=function(){DigiWebApp.BookingController.sendBookings(a,true)};DigiWebApp.SettingsController.featureAvailable("417")&&DigiWebApp.SettingsController.getSetting("ServiceApp_ermittleGeokoordinate")?function(){DigiWebApp.SettingsController.getSetting("debug")&&console.log("polling for bookinglocations");var e=[];DigiWebApp.BookingController.currentBooking!==null&&typeof DigiWebApp.BookingController.currentBooking.get("timeStampEnd")!==
"undefined"&&parseIntRadixTen(DigiWebApp.BookingController.currentBooking.get("timeStampEnd"))>0&&e.push(DigiWebApp.BookingController.currentBooking.m_id);DigiWebApp.BookingController.currentBookingClosed!==null&&e.push(DigiWebApp.BookingController.currentBookingClosed.m_id);DigiWebApp.ServiceAppController.pollBookings(e,function(f){DigiWebApp.SettingsController.getSetting("debug")&&console.log(f.length+" Datens\u00e4tze empfangen");_.each(f,function(g){try{DigiWebApp.SettingsController.getSetting("debug")&&
console.log("speichere gepollten Datensatz "+g.m_id);var i=_.find(DigiWebApp.Booking.find(),function(l){return l.m_id===g.m_id}),h=g.record;DigiWebApp.SettingsController.getSetting("debug")&&console.log("modelBooking: ",i);DigiWebApp.SettingsController.getSetting("debug")&&console.log("datensatz: ",h);i.set("latitude",h.latitude);i.set("latitude_bis",h.latitude_bis);i.set("longitude",h.longitude);i.set("longitude_bis",h.longitude_bis);i.set("ermittlungsverfahrenBis",h.ermittlungsverfahren_bis);i.set("ermittlungsverfahrenVon",
h.ermittlungsverfahren);i.set("genauigkeitBis",h.genauigkeit_bis);i.set("genauigkeitVon",h.genauigkeit);i.set("gps_zeitstempelBis",h.gps_zeitstempel_bis);i.set("gps_zeitstempelVon",h.gps_zeitstempel);i.set("ServiceApp_Status",h.status);i.save();DigiWebApp.SettingsController.getSetting("debug")&&console.log("datensatz "+g.m_id+" gespeichert")}catch(j){DigiWebApp.SettingsController.getSetting("debug")&&console.log("datensatz "+g.m_id+" nicht gefunden")}});d()},d,DigiWebApp.SettingsController.getSetting("GPSTimeOut"))}():
d()}else DigiWebApp.SettingsController.featureAvailable("402")&&!DigiWebApp.BookingController.currentBooking||DigiWebApp.SettingsController.featureAvailable("426")&&!DigiWebApp.BookingController.currentBooking?DigiWebApp.BautagebuchDatenuebertragungController.ausgekoppelteSenden(function(){DigiWebApp.ApplicationController.startsync(YES)}):DigiWebApp.ApplicationController.startsync(YES)}},settings:function(){DigiWebApp.NavigationController.toSettingsPasswordPageTransition()},timeData:function(){DigiWebApp.NavigationController.toTimeDataPageTransition()},
handOrder:function(){DigiWebApp.NavigationController.toHandOrderPageTransition()},info:function(){DigiWebApp.NavigationController.toInfoPageTransition()},demomedia:function(){DigiWebApp.NavigationController.toDemoMediaPageTransition()},media:function(){DigiWebApp.NavigationController.toMediaListPageTransition();DigiWebApp.MediaListController.neu()},orderInfo:function(){DigiWebApp.NavigationController.toOrderInfoPageTransition()},updateApplication:function(){if(this.appCacheUpdateReady()){window.applicationCache.swapCache();
typeof localStorage!=="undefined"&&localStorage.setItem("reloadAppOneMoreTime","true");if(typeof navigator.app!=="undefined")typeof location.origin!=="undefined"?navigator.app.loadUrl(location.origin+location.pathname):navigator.app.loadUrl(location.protocol+"//"+location.pathname);else window.location.reload()}else DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("noApplicationUpdateAvailable"),message:M.I18N.l("noApplicationUpdateAvailableMsg")})},materialerfassung:function(){DigiWebApp.ApplicationController.DigiLoaderView.show(M.I18N.l("starteMaterialerfassung"));
DigiWebApp.BautagebuchBautagesberichteListeController.init();var a=DigiWebApp.BautagebuchBautagesbericht.find(),b=null;_.each(a,function(c){if(c.get("bautagesberichtTyp")=="<materialerfassung_only>")b=c});if(b){DigiWebApp.BautagebuchBautagesberichtDetailsController.load(b);DigiWebApp.BautagebuchMaterialienListeController.neu()}else{DigiWebApp.BautagebuchBautagesberichteListeController.neu("<materialerfassung_only>",YES,M.I18N.l("materialPickUp"));DigiWebApp.BautagebuchBautagesberichtDetailsController.save(DigiWebApp.BautagebuchMaterialienListeController.neu,
function(){},YES)}},notizen:function(){DigiWebApp.ApplicationController.DigiLoaderView.show(M.I18N.l("starteNotizen"));DigiWebApp.BautagebuchBautagesberichteListeController.init();var a=DigiWebApp.BautagebuchBautagesbericht.find(),b=null;_.each(a,function(c){if(c.get("bautagesberichtTyp")=="<notizen_only>")b=c});if(b){DigiWebApp.BautagebuchBautagesberichtDetailsController.load(b);DigiWebApp.BautagebuchNotizenListeController.neu()}else{DigiWebApp.BautagebuchBautagesberichteListeController.neu("<notizen_only>",
YES,M.I18N.l("BautagebuchNotizen"));DigiWebApp.BautagebuchBautagesberichtDetailsController.save(DigiWebApp.BautagebuchNotizenListeController.neu,function(){},YES)}},tagescheckliste:function(){DigiWebApp.NavigationController.toStudieChecklistePage()},anwesenheitsliste:function(){DigiWebApp.NavigationController.toAnwesenheitslistePageTransition()},bautagebuch:function(){DigiWebApp.NavigationController.startBautagebuch()},buttonMenu:function(){DigiWebApp.NavigationController.toButtonsDashboardPageFlipTransition()},
Terminliste:function(){DigiWebApp.TerminlisteController.datum=D8.create().format("dd.mm.yyyy");DigiWebApp.NavigationController.toTerminlistePage()},FestePauseStornieren:function(){DigiWebApp.NavigationController.toFestePauseStornierenPage()}});
DigiWebApp.DemoAudioController=M.Controller.extend({myAudioObject:{},myTimeStamp:null,myFilename:null,myState:null,init:function(){DigiWebApp.SettingsController.globalDebugMode&&console.log("init");DigiWebApp.SettingsController.globalDebugMode&&console.log("this.myState = "+this.myState);DigiWebApp.DemoAudioPage.content.grid.button.events={tap:{action:DigiWebApp.DemoAudioController.recordAudio}};DigiWebApp.DemoAudioPage.content.grid.button.registerEvents();DigiWebApp.DemoAudioPage.content.audioIcon.events=
{tap:{action:DigiWebApp.DemoAudioController.recordAudio}};DigiWebApp.DemoAudioPage.content.audioIcon.registerEvents();document.getElementById(DigiWebApp.DemoAudioPage.content.audioIcon.id).src="theme/images/icon_record.png";this.myTimeStamp=M.Date.create(new Date).format("yymmddHHMMss");this.myFilename="DIGI-WebApp-recording-"+this.myTimeStamp+".wav";this.myState=null;DigiWebApp.DemoAudioController.myAudioObject=new Media(this.myFilename,this.onSuccess,this.onError,this.mediaStatus,this.mediaPosition);
DigiWebApp.SettingsController.globalDebugMode&&console.log(this.myFilename);DigiWebApp.SettingsController.globalDebugMode&&console.log(DigiWebApp.DemoAudioController.myAudioObject)},mediaStatus:function(a){DigiWebApp.SettingsController.globalDebugMode&&console.log("mediaStatus: "+a)},mediaPosition:function(a){DigiWebApp.SettingsController.globalDebugMode&&console.log("mediaPosition: "+a)},onSuccess:function(){DigiWebApp.SettingsController.globalDebugMode&&console.log("onSuccess");DigiWebApp.SettingsController.globalDebugMode&&
console.log("this.myState = "+this.myState);switch(this.myState){case "play":DigiWebApp.DemoAudioPage.content.audioIcon.events={tap:{action:DigiWebApp.DemoAudioController.stopPlayback}};DigiWebApp.DemoAudioPage.content.audioIcon.registerEvents();document.getElementById(DigiWebApp.DemoAudioPage.content.audioIcon.id).src="theme/images/icon_stop.png";break;case "record":DigiWebApp.DemoAudioPage.content.audioIcon.events={tap:{action:DigiWebApp.DemoAudioController.stopRecord}};DigiWebApp.DemoAudioPage.content.audioIcon.registerEvents();
document.getElementById(DigiWebApp.DemoAudioPage.content.audioIcon.id).src="theme/images/icon_stop.png";DigiWebApp.DemoAudioPage.content.grid.button.events={tap:{action:DigiWebApp.DemoAudioController.init}};DigiWebApp.DemoAudioPage.content.grid.button.registerEvents();break;case "stop":DigiWebApp.DemoAudioPage.content.audioIcon.events={tap:{action:DigiWebApp.DemoAudioController.playbackAudio}};DigiWebApp.DemoAudioPage.content.audioIcon.registerEvents();document.getElementById(DigiWebApp.DemoAudioPage.content.audioIcon.id).src=
"theme/images/icon_playbackAudio.png";break;default:DigiWebApp.DemoAudioPage.content.audioIcon.events={tap:{action:DigiWebApp.DemoAudioController.playbackAudio}};DigiWebApp.DemoAudioPage.content.audioIcon.registerEvents();document.getElementById(DigiWebApp.DemoAudioPage.content.audioIcon.id).src="theme/images/icon_playbackAudio.png"}},onError:function(a){DigiWebApp.SettingsController.globalDebugMode&&console.log("onError");console.log("code: "+a.code+"\nmessage: "+a.message+"\n");console.log("Filename: "+
this.myFilename);DigiWebApp.DemoAudioPage.content.audioIcon.events={tap:{action:DigiWebApp.DemoAudioController.playbackAudio}};DigiWebApp.DemoAudioPage.content.audioIcon.registerEvents();document.getElementById(DigiWebApp.DemoAudioPage.content.audioIcon.id).src="theme/images/icon_playbackAudio.png";DigiWebApp.DemoAudioPage.content.grid.button.events={tap:{action:DigiWebApp.DemoAudioController.init}};DigiWebApp.DemoAudioPage.content.grid.button.registerEvents()},recordAudio:function(){this.myState=
"record";DigiWebApp.DemoAudioController.myAudioObject.startRecord();DigiWebApp.DemoAudioPage.content.audioIcon.events={tap:{action:DigiWebApp.DemoAudioController.stopRecord}};DigiWebApp.DemoAudioPage.content.audioIcon.registerEvents();document.getElementById(DigiWebApp.DemoAudioPage.content.audioIcon.id).src="theme/images/icon_stop.png";DigiWebApp.DemoAudioPage.content.grid.button.events={tap:{action:DigiWebApp.DemoAudioController.init}};DigiWebApp.DemoAudioPage.content.grid.button.registerEvents();
DigiWebApp.SettingsController.globalDebugMode&&console.log("recordAudio");DigiWebApp.SettingsController.globalDebugMode&&console.log("this.myState = "+this.myState)},stopRecord:function(){this.myState="stop";DigiWebApp.DemoAudioController.myAudioObject.stopRecord();DigiWebApp.DemoAudioPage.content.audioIcon.events={tap:{action:DigiWebApp.DemoAudioController.playbackAudio}};DigiWebApp.DemoAudioPage.content.audioIcon.registerEvents();document.getElementById(DigiWebApp.DemoAudioPage.content.audioIcon.id).src=
"theme/images/icon_playbackAudio.png";DigiWebApp.SettingsController.globalDebugMode&&console.log("stopRecord");DigiWebApp.SettingsController.globalDebugMode&&console.log("this.myState = "+this.myState)},playbackAudio:function(){this.myState="play";DigiWebApp.DemoAudioController.myAudioObject.play();DigiWebApp.DemoAudioPage.content.audioIcon.events={tap:{action:DigiWebApp.DemoAudioController.stopPlayback}};DigiWebApp.DemoAudioPage.content.audioIcon.registerEvents();document.getElementById(DigiWebApp.DemoAudioPage.content.audioIcon.id).src=
"theme/images/icon_stop.png";DigiWebApp.SettingsController.globalDebugMode&&console.log("playbackAudio");DigiWebApp.SettingsController.globalDebugMode&&console.log("this.myState = "+this.myState)},stopPlayback:function(){this.myState="stop";DigiWebApp.DemoAudioController.myAudioObject.stop();DigiWebApp.DemoAudioPage.content.audioIcon.events={tap:{action:DigiWebApp.DemoAudioController.playbackAudio}};DigiWebApp.DemoAudioPage.content.audioIcon.registerEvents();document.getElementById(DigiWebApp.DemoAudioPage.content.audioIcon.id).src=
"theme/images/icon_playbackAudio.png";DigiWebApp.SettingsController.globalDebugMode&&console.log("stopPlayback");DigiWebApp.SettingsController.globalDebugMode&&console.log("this.myState = "+this.myState)}});
DigiWebApp.DemoMediaPageController=M.Controller.extend({events:{pagebeforeshow:{target:this,action:"init"}},items:null,latestId:null,init:function(){if(DigiWebApp.DemoMediaPage.needsUpdate){var a=[];if(DigiWebApp.SettingsController.featureAvailable("401")){DigiWebApp.SettingsController.globalDebugMode&&console.log("enabling Feature 401 (RecordAudio)");a.push({label:M.I18N.l("recordAudio"),icon:"icon_recordAudio.png",id:"audio"})}this.set("items",a);DigiWebApp.DemoMediaPage.needsUpdate=false}(a=M.ViewManager.getView("mediaPage",
"list"))&&$("#"+a.id).find("li").each(function(){$(this).removeClass("selected")})},itemSelected:function(a,b){this.latestId&&$("#"+this.latestId).removeClass("selected");$("#"+a).addClass("selected");this.latestId=a;b&&typeof this[b]==="function"&&this[b]()},camera:function(){DigiWebApp.NavigationController.toDemoCameraPageTransition()},audio:function(){DigiWebApp.NavigationController.toDemoAudioPageTransition()}});
DigiWebApp.EditPicturePageController=M.Controller.extend({myMediaFile:null,orders:null,positions:null,activities:null,selections:{order:null,position:null,activity:null},deleteMediaFileFromLocalStorage:function(){var a=DigiWebApp.EditPicturePageController.myMediaFile;try{a.del()}catch(b){trackError(b)}DigiWebApp.ApplicationController.DigiLoaderView.hide();DigiWebApp.NavigationController.backToMediaListPageTransition()},init:function(){$("#"+DigiWebApp.EditPicturePage.content.remarkInput.id).val("");
M.ViewManager.getView("editPicturePage","remarkInput").value="";$("#"+DigiWebApp.EditPicturePage.content.remarkInput.id).val(this.myMediaFile.get("remark"));M.ViewManager.getView("editPicturePage","remarkInput").value=this.myMediaFile.get("remark");document.getElementById(DigiWebApp.EditPicturePage.content.image.id).src="";DigiWebApp.EditPicturePageController.myImageObj=new Image;this.myMediaFile.readFromFile(function(a){if(a&&a!=="")document.getElementById(DigiWebApp.EditPicturePage.content.image.id).src=
a},function(){document.getElementById(DigiWebApp.EditPicturePage.content.image.id).src=""});$("#"+DigiWebApp.EditPicturePage.content.savePictureGrid.id).show();DigiWebApp.EditPicturePageController.setSelectionByMediaFile();DigiWebApp.ApplicationController.DigiLoaderView.hide();if(DigiWebApp.SettingsController.getSetting("DTC6aktiv")){DigiWebApp.ApplicationController.dtc6AktivRenameHelper(DigiWebApp.EditPicturePage.content.order.id,M.I18N.l("dtc6Ordner"));DigiWebApp.ApplicationController.dtc6AktivRenameHelper(DigiWebApp.EditPicturePage.content.position.id,
M.I18N.l("dtc6Auftrag"));DigiWebApp.ApplicationController.dtc6AktivRenameHelper(DigiWebApp.EditPicturePage.content.activity.id,M.I18N.l("dtc6Leistung"))}},setSelectionByMediaFile:function(){var a=DigiWebApp.HandOrder.findSorted().concat(DigiWebApp.Order.findSorted()),b=DigiWebApp.Position.findSorted(),c=DigiWebApp.EditPicturePageController.getActivities(),d=this.myMediaFile.get("orderId"),e=this.myMediaFile.get("positionId"),f=this.myMediaFile.get("activityId"),g=NO,i=null;i=_.map(a,function(j){var l=
null;if(j)if(j.get("id")==d){l={label:j.get("name"),value:j.get("id"),isSelected:YES};g=YES}else l={label:j.get("name"),value:j.get("id")};return l});i=_.compact(i);i.push({label:M.I18N.l("selectSomething"),value:"0"});i=g===NO?_.map(i,function(j){var l=null;if(j)l=j.value==d?{label:j.label,value:j.value,isSelected:YES}:{label:j.label,value:j.value};return l}):i;i=_.compact(i);b=_.map(b,function(j){if(j){if(parseIntRadixTen(j.get("orderId"))===parseIntRadixTen(d)){var l=null;return l=j.get("id")==
e?{label:j.get("name"),value:j.get("id"),isSelected:YES}:{label:j.get("name"),value:j.get("id")}}return null}});b=_.compact(b);b.push({label:M.I18N.l("selectSomething"),value:"0"});c=_.select(DigiWebApp.WorkPlan.find(),function(j){if(j)return j.get("id")==e});var h=NO;c=c.length>0?this.getActivitiesFromWorkplan(c[0]):DigiWebApp.EditPicturePageController.getActivities();c=_.map(c,function(j){if(typeof j==="undefined"){console.log("UNDEFINED ACTIVITY");return null}else{var l=null;if(j.get("id")==f){l=
{label:j.get("name"),value:j.get("id"),isSelected:YES};h=YES}else l={label:j.get("name"),value:j.get("id")};return l}});c=_.compact(c);c.push({label:M.I18N.l("selectSomething"),value:"0",isSelected:!h});this.resetSelection();this.set("orders",i);this.set("positions",b);this.set("activities",c)},setPositions:function(){var a=M.ViewManager.getView("editPicturePage","order").getSelection(YES).value;if(a){var b=DigiWebApp.Position.findSorted(),c=0;b=_.map(b,function(d){if(d){if(parseIntRadixTen(d.get("orderId"))===
parseIntRadixTen(a)){d={label:d.get("name"),value:d.get("id")};if(c===0)d.isSelected=YES;c+=1;return d}return null}});b=_.compact(b);b.length<1&&b.push({label:M.I18N.l("noData"),value:"0"});M.ViewManager.getView("editPicturePage","position").resetSelection();this.set("positions",b);this.setActivities(YES);this.saveSelection()}},setActivities:function(a){var b=null;if(a)if(a=M.ViewManager.getView("editPicturePage","position").getSelection(YES))b=a.value;a=[];var c=[];_.each(DigiWebApp.WorkPlan.find(),
function(f){parseIntRadixTen(f.get("id"))===parseIntRadixTen(b)&&c.push(f)});var d=0;a=c.length===1?this.getActivitiesFromWorkplan(c[0]):DigiWebApp.EditPicturePageController.getActivities();var e=false;_.each(a,function(f){if(typeof f==="undefined"){console.log("UNDEFINED ACTIVITY");return null}else if(f.get("id")==-1)e=true});a=_.map(a,function(f){if(typeof f==="undefined"){console.log("UNDEFINED ACTIVITY");return null}else{var g=null;g=e?{label:f.get("name"),value:f.get("id"),isSelected:f.get("id")==
-1?YES:NO}:{label:f.get("name"),value:f.get("id"),isSelected:d===0?YES:NO};d+=1;return g}});a=_.compact(a);a.length>0?a.push({label:M.I18N.l("selectSomething"),value:"0",isSelected:NO}):a.push({label:M.I18N.l("noData"),value:"0"});M.ViewManager.getView("editPicturePage","activity").resetSelection();this.set("activities",a);this.saveSelection()},initSelection:function(){var a=DigiWebApp.HandOrder.findSorted().concat(DigiWebApp.Order.findSorted()),b=DigiWebApp.Position.findSorted(),c=DigiWebApp.EditPicturePageController.getActivities(),
d=[];if(a)d=_.map(a,function(e){if(e)return{label:e.get("name"),value:e.get("id")}});d.push({label:M.I18N.l("selectSomething"),value:"0",isSelected:YES});a=[];if(b)a=_.map(b,function(e){if(e)return{label:e.get("name"),value:e.get("id")}});a.push({label:M.I18N.l("selectSomething"),value:"0",isSelected:YES});b=[];if(c)b=_.map(c,function(e){if(typeof e==="undefined"){console.log("UNDEFINED ACTIVITY");return null}else return{label:e.get("name"),value:e.get("id")}});b.push({label:M.I18N.l("selectSomething"),
value:"0",isSelected:YES});this.resetSelection();this.set("orders",d);this.set("positions",a);this.set("activities",b);M.ViewManager.getView("editPicturePage","order").setSelection("0");M.ViewManager.getView("editPicturePage","position").setSelection("0");M.ViewManager.getView("editPicturePage","activity").setSelection("0")},resetSelection:function(){M.ViewManager.getView("editPicturePage","order").resetSelection();M.ViewManager.getView("editPicturePage","position").resetSelection();M.ViewManager.getView("editPicturePage",
"activity").resetSelection()},isPositionSelected:function(){var a=M.ViewManager.getView("editPicturePage","position").getSelection(YES);return a&&a.value!="0"?YES:NO},isActivitySelected:function(){var a=M.ViewManager.getView("editPicturePage","activity").getSelection(YES);return a&&a.value!="0"?YES:NO},saveSelection:function(){var a=M.ViewManager.getView("editPicturePage","order").getSelection(),b=M.ViewManager.getView("editPicturePage","position").getSelection(),c=M.ViewManager.getView("editPicturePage",
"activity").getSelection();this.selections.order=a;this.selections.position=b;this.selections.activity=c;this.useSelections=YES},getActivities:function(a){a=a?DigiWebApp.Activity.find(a):DigiWebApp.Activity.findSorted();a=_.map(a,function(b){return parseIntRadixTen(b.get("positionId"))===1?b:null});return a=_.compact(a)},getActivitiesFromWorkplan:function(a){var b=a.get("activityIds").split(","),c=[];if(b&&b.length>0)for(var d=0;d<b.length;d++)c.push(_.first(DigiWebApp.Activity.find({query:{identifier:"id",
operator:"=",value:b[d]}})));if(parseIntRadixTen(a.get("workplanType"))===1)c=_.map(c,function(e){if(typeof e==="undefined"){console.log("UNDEFINED ACTIVITY");return null}else{var f=NO,g=DigiWebApp.Activity.findSorted();_.each(g,function(i){if(parseIntRadixTen(i.get("positionId"))===1)f=YES});return f?e:null}});return c=_.compact(c)},savePicture:function(){this.saveSelection();var a=M.ViewManager.getView("editPicturePage","order").getSelection(),b=M.ViewManager.getView("editPicturePage","position").getSelection(YES);
b=b?b.value:null;var c=M.ViewManager.getView("editPicturePage","activity").getSelection(YES),d=c?c.value:null,e=null,f=null;if(DigiWebApp.BookingController.isHandOrder(a)){e=a;f=_.select(DigiWebApp.HandOrder.findSorted(),function(g){if(g)return g.get("id")==a||g.get("name")==a})[0].get("name");a=e;b=null}c=this.myMediaFile;c.set("orderId",a);c.set("handOrderId",e);c.set("handOrderName",f);c.set("positionId",b);c.set("activityId",d);c.set("remark",M.ViewManager.getView("editPicturePage","remarkInput").value);
b=document.getElementById(DigiWebApp.EditPicturePage.content.image.id);c.set("fileType",DigiWebApp.ApplicationController.getImageFiletype());c.save();c.saveToFile(b.src,function(){DigiWebApp.ApplicationController.DigiLoaderView.hide();DigiWebApp.NavigationController.backToMediaListPageTransition()})}});
DigiWebApp.EmployeeController=M.Controller.extend({empSelectionKey:M.LOCAL_STORAGE_PREFIX+M.Application.name+M.LOCAL_STORAGE_SUFFIX+"employeeSelection",empSelectionKeyTmp:M.LOCAL_STORAGE_PREFIX+M.Application.name+M.LOCAL_STORAGE_SUFFIX+"employeeSelectionTmp",employeeState:0,employees:null,init:function(){this.setEmployeesForList()},setEmployeesForList:function(){if(this.getEmployeeState()==1){var a=DigiWebApp.Employee.findSorted();if(a.length>0){a=_.map(a,function(b){if(b)return{label:b.get("name"),
value:b.get("id")}});this.set("employees",a)}}},saveEmployeeSelection:function(){var a=DigiWebApp.Employee.find();_.each(a,function(b){b.set("isSelected",NO);b.save()});a=M.ViewManager.getView("employeePage","employeeSelection").getSelection();if(a.length>0){_.each(a,function(b){var c=_.select(DigiWebApp.Employee.find(),function(d){if(d)return d.get("id")==b});if(c=_.isArray(c)?c[0]:c){c.set("isSelected",YES);c.save()}});this.callbackEmployeesSave()}else DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("employeeSelection"),
message:M.I18N.l("employeeSelectionMsg")})},callbackEmployeesSave:function(){var a=DigiWebApp.EmployeeController;DigiWebApp.BookingController.set("isBackFromEmployeePage",YES);DigiWebApp.NavigationController.backToBookTimePagePOP();localStorage.setItem(DigiWebApp.EmployeeController.empSelectionKey,a.getSelectedEmployeesAsString());a.setEmployeeState(2);DigiWebApp.BookingController.book()},getSelectedEmployees:function(){var a=DigiWebApp.Employee.find();if(a.length>0)return _.select(a,function(b){if(b)return b.get("isSelected")===
true});return[]},getSelectedEmployeesAsString:function(){if(this.getEmployeeState===0)return"0";if(this.getEmployeeState===1)return"";var a=[],b=this.getSelectedEmployees();_.each(b,function(c){a.push(c.get("id"))});return a.join(",")},setEmployeeState:function(a){a==0&&this.saveUniversalEmployeeToLocalStorage();this.set("employeeState",a);localStorage.setItem(M.LOCAL_STORAGE_PREFIX+M.Application.name+M.LOCAL_STORAGE_SUFFIX+"employeeState",this.employeeState)},saveUniversalEmployeeToLocalStorage:function(){localStorage.setItem(this.empSelectionKey,
"0")},getEmployeeState:function(){this.set("employeeState",localStorage.getItem(M.LOCAL_STORAGE_PREFIX+M.Application.name+M.LOCAL_STORAGE_SUFFIX+"employeeState"));return this.employeeState}});
DigiWebApp.FestePauseStornierenController=M.Controller.extend({items:null,init:function(){this.initBalken();this.initPausenLists()},gesternBalken:null,heuteBalken:null,morgenBalken:null,initBalken:function(){var a=DigiWebApp.ApplicationController.dayNames;this.set("gesternBalken",[{label:a[D8.create().yesterday().date.getDay()]+", "+D8.create().yesterday().format("dd.mm.yyyy"),items:[]}]);this.set("heuteBalken",[{label:a[D8.create().date.getDay()]+", "+D8.create().format("dd.mm.yyyy"),items:[]}]);
this.set("morgenBalken",[{label:a[D8.create().tomorrow().date.getDay()]+", "+D8.create().tomorrow().format("dd.mm.yyyy"),items:[]}])},gesternPausenList:null,heutePausenList:null,morgenPausenList:null,initPausenLists:function(){var a=_.sortBy(DigiWebApp.Festepausendefinition.find(),function(m){return m.get("von")}),b=D8.create().yesterday(),c=D8.create(),d=D8.create().tomorrow(),e=b.date.getDay(),f=c.date.getDay(),g=d.date.getDay(),i=_.filter(a,function(m){return m.get("wochentagId")==e}),h=_.filter(a,
function(m){return m.get("wochentagId")==f});a=_.filter(a,function(m){return m.get("wochentagId")==g});var j=DigiWebApp.Sonderbuchung.find(),l=function(m,o){if(m){var p={label:m.get("von")+" - "+m.get("bis"),value:m.get("id")};if(_.find(j,function(q){return q.get("festepausendefinitionId")==m.get("id")&&q.get("ressourceId")==m.get("ressourceId")&&q.get("datum")==o.format("dd.mm.yyyy")}))p.isSelected="true";return p}};i=_.map(i,function(m){return l(m,b)});this.set("gesternPausenList",i);h=_.map(h,
function(m){return l(m,c)});this.set("heutePausenList",h);a=_.map(a,function(m){return l(m,d)});this.set("morgenPausenList",a);var n=function(m,o){var p=_.find(DigiWebApp.Festepausendefinition.find(),function(r){return r.get("id")==m.value}),q=_.find(j,function(r){return r.get("festepausendefinitionId")==p.get("id")&&r.get("ressourceId")==p.get("ressourceId")&&r.get("datum")==o.format("dd.mm.yyyy")});q&&parseBool(q.get("uebertragen"))&&$("#"+m.id)[0].setAttribute("disabled","disabled")};$("#"+DigiWebApp.FestePauseStornierenPage.content.gesternPausenList.id);
_.each(DigiWebApp.FestePauseStornierenPage.content.gesternPausenList.selection,function(m){n(m,b)});$("#"+DigiWebApp.FestePauseStornierenPage.content.heutePausenList.id);_.each(DigiWebApp.FestePauseStornierenPage.content.heutePausenList.selection,function(m){n(m,c)});$("#"+DigiWebApp.FestePauseStornierenPage.content.morgenPausenList.id);_.each(DigiWebApp.FestePauseStornierenPage.content.morgenPausenList.selection,function(m){n(m,d)});this.gesternOldSelection=DigiWebApp.FestePauseStornierenPage.content.gesternPausenList.selection;
this.heuteOldSelection=DigiWebApp.FestePauseStornierenPage.content.heutePausenList.selection;this.morgenOldSelection=DigiWebApp.FestePauseStornierenPage.content.morgenPausenList.selection;if(DigiWebApp.SettingsController.getSetting("festePauseStornieren_nurAktuellerTag")){$("#"+DigiWebApp.FestePauseStornierenPage.content.gesternBalken.id).hide();$("#"+DigiWebApp.FestePauseStornierenPage.content.gesternPausenList.id+"_container").hide();$("#"+DigiWebApp.FestePauseStornierenPage.content.morgenBalken.id).hide();
$("#"+DigiWebApp.FestePauseStornierenPage.content.morgenPausenList.id+"_container").hide()}else{$("#"+DigiWebApp.FestePauseStornierenPage.content.gesternBalken.id).show();$("#"+DigiWebApp.FestePauseStornierenPage.content.gesternPausenList.id+"_container").show();$("#"+DigiWebApp.FestePauseStornierenPage.content.morgenBalken.id).show();$("#"+DigiWebApp.FestePauseStornierenPage.content.morgenPausenList.id+"_container").show()}},gesternOldSelection:null,heuteOldSelection:null,morgenOldSelection:null,
save:function(){var a=DigiWebApp.Sonderbuchung.find(),b=D8.create().yesterday(),c=D8.create(),d=D8.create().tomorrow(),e=_.map(_.map(this.gesternOldSelection,function(h){return h.value}),function(h){var j=_.find(DigiWebApp.Festepausendefinition.find(),function(l){return l.get("id")==h});return{date:b.format("dd.mm.yyyy"),festepausendefinition:j}}),f=_.map(_.map(this.heuteOldSelection,function(h){return h.value}),function(h){var j=_.find(DigiWebApp.Festepausendefinition.find(),function(l){return l.get("id")==
h});return{date:c.format("dd.mm.yyyy"),festepausendefinition:j}}),g=_.map(_.map(this.morgenOldSelection,function(h){return h.value}),function(h){var j=_.find(DigiWebApp.Festepausendefinition.find(),function(l){return l.get("id")==h});return{date:d.format("dd.mm.yyyy"),festepausendefinition:j}});e=e.concat(f.concat(g));_.each(e,function(h){var j=h.festepausendefinition,l=_.find(a,function(n){return n.get("festepausendefinitionId")==j.get("id")&&n.get("ressourceId")==j.get("ressourceId")&&n.get("datum")==
h.date});l&&!parseBool(l.get("uebertragen"))&&l.del()});e=_.map(_.map(DigiWebApp.FestePauseStornierenPage.content.gesternPausenList.selection,function(h){return h.value}),function(h){var j=_.find(DigiWebApp.Festepausendefinition.find(),function(l){return l.get("id")==h});return{date:b.format("dd.mm.yyyy"),festepausendefinition:j}});f=_.map(_.map(DigiWebApp.FestePauseStornierenPage.content.heutePausenList.selection,function(h){return h.value}),function(h){var j=_.find(DigiWebApp.Festepausendefinition.find(),
function(l){return l.get("id")==h});return{date:c.format("dd.mm.yyyy"),festepausendefinition:j}});g=_.map(_.map(DigiWebApp.FestePauseStornierenPage.content.morgenPausenList.selection,function(h){return h.value}),function(h){var j=_.find(DigiWebApp.Festepausendefinition.find(),function(l){return l.get("id")==h});return{date:d.format("dd.mm.yyyy"),festepausendefinition:j}});e=e.concat(f.concat(g));_.each(e,function(h){var j=[{eigenschaftsKey:"<FestepausendefinitionId>",eigenschaftsStringValue:""+h.festepausendefinition.get("id")},
{eigenschaftsKey:"<Datum>",eigenschaftsStringValue:h.date}];_.find(a,function(l){return l.get("festepausendefinitionId")==h.festepausendefinition.get("id")&&l.get("ressourceId")==h.festepausendefinition.get("ressourceId")&&l.get("datum")==h.date&&parseBool(l.get("uebertragen"))==YES})||DigiWebApp.Sonderbuchung.createRecord({sonderbuchungstyp:"<pausenStorno>",sonderbuchungseigenschaften:j,ressourceId:h.festepausendefinition.get("ressourceId"),uebertragen:"false",festepausendefinitionId:h.festepausendefinition.get("id"),
datum:h.date,status:0}).save()});try{DigiWebApp.ApplicationController.vibrate()}catch(i){}DigiWebApp.SettingsController.featureAvailable("404")?DigiWebApp.NavigationController.backToButtonDashboardPagePOP():DigiWebApp.NavigationController.backToDashboardPagePOP()}});
DigiWebApp.HandOrderController=M.Controller.extend({currentHandOrderName:"",orderNameToSave:"",save:function(){var a=this.orderNameToSave;if(a=$.trim(a)){var b=_.select(DigiWebApp.HandOrder.findSorted(),function(h){if(h)return h.get("name")===a});if(DigiWebApp.ApplicationController.sonderzeichenCheck(a))DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("specialCharProblem"),message:M.I18N.l("specialCharProblemMsg")});else if(b.length>0)DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("handOrderExists"),
message:M.I18N.l("handOrderExistsMsg")});else if(a.length>16&&!DigiWebApp.SettingsController.getSetting("DTC6aktiv"))DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("handOrderTooLong"),message:M.I18N.l("handOrderTooLongMsg")});else if(a.length>50&&DigiWebApp.SettingsController.getSetting("DTC6aktiv"))DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("handOrderTooLong"),message:M.I18N.l("handOrderTooLongDTC6Msg")});else{b=DigiWebApp.HandOrder.createRecord({name:a,
id:a,isLocalOnly:YES});var c=DigiWebApp.ApplicationController.storagePrefix+"_handorderKeys",d=localStorage.getItem(c),e=[];if(typeof d==="string")try{e=JSON.parse(d)}catch(f){trackError(f)}try{e.push(b.m_id)}catch(g){trackError(g)}localStorage.setItem(c,JSON.stringify(e));b.save();if(b){M.ViewManager.getView("handOrderPage","orderName").setValue("");DigiWebApp.SelectionController.useSelections=NO;DigiWebApp.SelectionController.showHandOrderFirst=YES;this.currentHandOrderName=a;try{$("#"+DigiWebApp.BookingPage.content.position.id+
"_container").hide()}catch(i){trackError(i)}DigiWebApp.NavigationController.toBookTimePage(YES)}else DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("handOrderSaveError"),message:M.I18N.l("handOrderSaveErrorMsg")})}}else DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("noHandOrderNameEntered"),message:M.I18N.l("noHandOrderNameEnteredMsg")})}});
DigiWebApp.JSONDatenuebertragungController=M.Controller.extend({consoleLogOutput:YES,sendData:function(a){if(a)!DigiWebApp.RequestController.DatabaseServer||DigiWebApp.RequestController.DatabaseServerTimestamp&&DigiWebApp.RequestController.DatabaseServerTimestamp-(new Date).getTime()>6E4?DigiWebApp.RequestController.getDatabaseServer(function(){DigiWebApp.JSONDatenuebertragungController.sendDataWithServer(a)},null):DigiWebApp.JSONDatenuebertragungController.sendDataWithServer(a);else writeToLog("Daten konnten nicht gesendet werden! Falsche \u00dcbergabe an sendData.")},
sendDataWithServer:function(a){var b=a.data,c=a.webservice,d=a.loaderText,e=a.successCallback,f=a.errorCallback,g=a.additionalQueryParameter,i=DigiWebApp.SettingsController.getSetting("WebserviceTimeOut")?DigiWebApp.SettingsController.getSetting("WebserviceTimeOut"):DigiWebApp.SettingsController.defaultsettings.get("WebserviceTimeOut");i=a.timeout?a.timeout:i;var h=a.omitLoaderHide?a.omitLoaderHide:false;a="http://"+DigiWebApp.RequestController.DatabaseServer+"/WebAppServices/"+c+"?modus=0&firmenId="+
DigiWebApp.SettingsController.getSetting("company")+"&kennwort="+DigiWebApp.SettingsController.getSetting("password")+"&geraeteId="+DigiWebApp.SettingsController.getSetting("workerId")+"&geraeteTyp=2&softwareVersion="+DigiWebApp.RequestController.softwareVersion+"&requestTimestamp="+M.Date.now().date.valueOf();if(g)a=a+"&"+g;var j=M.Request.init({url:a,method:"POST",data:JSON.stringify(b),timeout:i,contentType:"text/plain",dataType:"text",beforeSend:function(l){DigiWebApp.ApplicationController.DigiLoaderView.show(d);
l.setRequestHeader("Content-Type","text/plain")},onSuccess:function(l,n,m){console.log(m);h||DigiWebApp.ApplicationController.DigiLoaderView.hide();try{writeToLog("R\u00fcckgabe des Webservices: "+m.responseText)}catch(o){}e(b,n,m)},onError:function(l,n){DigiWebApp.ApplicationController.DigiLoaderView.hide();DigiWebApp.RequestController.DatabaseServer=null;console.error(n);console.error(l);try{trackError(n,function(){try{writeToLog("fehlerhafte R\u00fcckgabe des Webservices: "+l.responseText)}catch(o){}f(l,
n)})}catch(m){}}});writeToLog("JSON-WebService '"+c+"' wird aufgerufen",function(){j.send()})},recieveData:function(a){if(a)!DigiWebApp.RequestController.DatabaseServer||DigiWebApp.RequestController.DatabaseServerTimestamp&&DigiWebApp.RequestController.DatabaseServerTimestamp-(new Date).getTime()>6E4?DigiWebApp.RequestController.getDatabaseServer(function(){DigiWebApp.JSONDatenuebertragungController.recieveDataWithServer(a)},null):DigiWebApp.JSONDatenuebertragungController.recieveDataWithServer(a);
else writeToLog("Daten konnten nicht empfangen werden! Falsche \u00dcbergabe an recieveData.")},recieveDataWithServer:function(a){var b=a.webservice,c=a.loaderText,d=a.successCallback,e=a.errorCallback,f=a.additionalQueryParameter,g=DigiWebApp.SettingsController.getSetting("WebserviceTimeOut")?DigiWebApp.SettingsController.getSetting("WebserviceTimeOut"):DigiWebApp.SettingsController.defaultsettings.get("WebserviceTimeOut");g=a.timeout?a.timeout:g;var i=a.geraeteIdOverride?a.geraeteIdOverride:NO;
a=a.modus?a.modus:0;var h=DigiWebApp.SettingsController.getSetting("workerId"),j=2;if(i){h=0;j=3}i="http://"+DigiWebApp.RequestController.DatabaseServer+"/WebAppServices/"+b+"?modus="+a+"&firmenId="+DigiWebApp.SettingsController.getSetting("company")+"&kennwort="+DigiWebApp.SettingsController.getSetting("password")+"&geraeteId="+h+"&geraeteTyp="+j+"&softwareVersion="+DigiWebApp.RequestController.softwareVersion+"&requestTimestamp="+M.Date.now().date.valueOf();if(f)i=i+"&"+f;writeToLog("JSON-WebService '"+
b+"' wird aufgerufen");M.Request.init({url:i,beforeSend:function(){DigiWebApp.ApplicationController.DigiLoaderView.show(c)},method:"GET",sendNoCacheHeader:YES,sendTimestamp:YES,timeout:g,isJSON:YES,onSuccess:function(l,n,m){DigiWebApp.ApplicationController.DigiLoaderView.hide();d(l,n,m)},onError:function(l,n){DigiWebApp.ApplicationController.DigiLoaderView.hide();DigiWebApp.RequestController.DatabaseServer=null;console.error(n);console.error(l);try{trackError(n,function(){try{writeToLog("fehlerhafte R\u00fcckgabe des Webservices: "+
l.responseText)}catch(o){}e(l,n)})}catch(m){}}}).send()},sendeZeitdaten:function(a,b,c,d,e){var f=function(g,i,h,j){var l=[];g=_.sortBy(g,function(s){return parseIntRadixTen(s.get("_createdAt"))});var n=localStorage.getItem(DigiWebApp.EmployeeController.empSelectionKey)||localStorage.getItem(DigiWebApp.EmployeeController.empSelectionKeyTmp),m=[];m=n&&n!=="0"?n.split(","):[DigiWebApp.SettingsController.getSetting("mitarbeiterId")];_.each(g,function(s){_.each(m,function(u){var t=DigiWebApp.Booking.createRecord({m_id:s.m_id}),
v;for(v in s.record)try{typeof JSON.parse(s.get(v)).length!=="undefined"?t.set(v,JSON.parse(s.get(v))):t.set(v,s.get(v))}catch(x){t.set(v,s.get(v))}if(parseIntRadixTen(t.get("timeStampEnd"))===0){t.set("timeStampEnd",null);t.set("longitude_bis","0");t.set("latitude_bis","0");t.get("longitude")||t.set("longitude","0");t.get("latitude")||t.set("latitude","0")}t.set("gpsLaengeVon",t.get("longitude"));t.set("gpsBreiteVon",t.get("latitude"));t.set("gpsLaengeBis",t.get("longitude_bis"));t.set("gpsBreiteBis",
t.get("latitude_bis"));t.set("handauftragsId",t.get("handOrderId"));t.set("handauftragsBezeichnung",t.get("handOrderName"));t.set("mitarbeiterId",u);l.push(t.record)})});if(l.length!==0){var o={zeitdaten:l},p=function(){if(j){DigiWebApp.EmployeeController.getEmployeeState()==2&&DigiWebApp.EmployeeController.setEmployeeState(1);localStorage.removeItem(DigiWebApp.EmployeeController.empSelectionKey);localStorage.removeItem(DigiWebApp.EmployeeController.empSelectionKeyTmp)}h()},q=function(s,u,t){parseIntRadixTen(t.responseText)!=
l.length?writeToLog("Fehler: Falsche R\u00fcckgabe des Zeitservers ("+t.responseText+")",function(){writeToLog("items.length: "+l.length,function(){p()})}):i()},r=DigiWebApp.SettingsController.getSetting("scrId");writeToLog(r,function(){writeToLog(escape(scrStr(JSON.stringify(o),r)),function(){var s="Sende "+l.length+" Zeitbuchung";if(l.length>1)s+="en";writeToLog(s,function(){var u={data:o,webservice:"zeitdaten",loaderText:M.I18N.l("sendDataMsg"),successCallback:q,errorCallback:p};DigiWebApp.JSONDatenuebertragungController.sendData(u)})})})}else i()};
if(DigiWebApp.SettingsController.featureAvailable("417")&&(DigiWebApp.SettingsController.getSetting("ServiceApp_ermittleGeokoordinate")||DigiWebApp.SettingsController.getSetting("ServiceApp_datenUebertragen"))){DigiWebApp.ApplicationController.DigiLoaderView.show(M.I18N.l("ServiceAppKommunikation"));DigiWebApp.ServiceAppController.refreshWAITBookings(function(){DigiWebApp.ApplicationController.DigiLoaderView.hide();f(a,b,c,d,e)},function(){DigiWebApp.ApplicationController.DigiLoaderView.hide();f(a,
b,c,d,e)},[],true)}else f(a,b,c,d,e)},sendeSonderbuchungen:function(a,b,c,d){!d||!a||a.length==0?b():function(e,f,g){var i=[],h=_.sortBy(e,function(j){return parseIntRadixTen(j.get("_createdAt"))});_.each(h,function(j){i.push(j.record)});if(i.length!==0){h={data:{sonderbuchungen:i},webservice:"sonderbuchung",loaderText:M.I18N.l("sendDataMsg"),successCallback:function(){_.each(e,function(j){j.set("uebertragen",YES);j.save()});_.each(_.filter(DigiWebApp.Sonderbuchung.find(),function(j){return parseBool(j.get("uebertragen"))}),
function(j){var l=D8.create(D8.create().format("dd.mm.yyyy")).yesterday();D8.create(j.get("datum")).date.getTime()<l.date.getTime()&&j.del()});f()},errorCallback:function(){g()}};DigiWebApp.JSONDatenuebertragungController.sendData(h)}else f()}(a,b,c)},empfangeTaetigkeiten:function(a,b){var c={webservice:"leistungen",loaderText:M.I18N.l("getActivitiesLoader"),successCallback:function(d){if(typeof d.leistungen==="undefined"&&d.leistungen!==null&&d.leistungen.length>0){trackError("missing leistungen");
return b()}var e=null;try{e=d.leistungen.length}catch(f){trackError("data.leistungen hat L\u00e4nge "+e)}if(d.leistungen===null)return b();else{e=null;try{e=d.leistungen.length}catch(g){trackError("data.leistungen hat L\u00e4nge "+e);return b()}}DigiWebApp.ApplicationController.DigiProgressView.show(M.I18N.l("Save"),M.I18N.l("activities"),e,0);DigiWebApp.Activity.deleteAll();_.each(d.leistungen,function(i){if(typeof i.leistungsId==="undefined"){trackError("missing leistungsId");return b()}else if(typeof i.leistungsBezeichnung===
"undefined"){trackError("missing leistungsBezeichnung");return b()}else{var h=0;if(i.istMitarbeiterZugeordnet)h=1;DigiWebApp.Activity.createRecord({id:i.leistungsId,name:i.leistungsBezeichnung,positionId:h,istStandardPause:i.istStandardPause,istUnterschriftsAbnahme:i.istUnterschriftsAbnahme,istFahrzeitRelevant:i.istFahrzeitRelevant}).saveSorted();DigiWebApp.ApplicationController.DigiProgressView.increase()}});DigiWebApp.ApplicationController.DigiProgressView.hide();a()},errorCallback:b,additionalQueryParameter:"",
geraeteIdOverride:false,modus:"1"};DigiWebApp.JSONDatenuebertragungController.recieveData(c)},empfangeKolonne:function(a,b){var c={webservice:"mitarbeiter",loaderText:M.I18N.l("getKolonne"),successCallback:function(d){if(typeof d.mitarbeiter==="undefined"||d.mitarbeiter===null||d.mitarbeiter.length===0)return a();DigiWebApp.ApplicationController.setCallbackStatus("kolonne","remote",YES);DigiWebApp.ApplicationController.DigiProgressView.show(M.I18N.l("Save"),M.I18N.l("employees"),d.mitarbeiter.length,
0);d=_.sortBy(d.mitarbeiter,function(e){return[e.nachname,e.vorname]});DigiWebApp.Employee.deleteAll();DigiWebApp.ApplicationController.setCallbackStatus("kolonne","local",NO);_.each(d,function(e){DigiWebApp.ApplicationController.DigiProgressView.increase();DigiWebApp.Employee.createRecord({id:e.mitarbeiterId,name:e.vorname+" "+e.nachname,kolonnenId:"",isSelected:NO}).saveSorted()});DigiWebApp.ApplicationController.setCallbackStatus("kolonne","local",YES);localStorage.getItem(DigiWebApp.EmployeeController.empSelectionKey)==
0&&localStorage.removeItem(DigiWebApp.EmployeeController.empSelectionKey);DigiWebApp.EmployeeController.getEmployeeState()!=2&&DigiWebApp.EmployeeController.setEmployeeState(1);DigiWebApp.ApplicationController.DigiProgressView.hide();a()},errorCallback:b,additionalQueryParameter:"getAll=false&nurKolonne=true",geraeteIdOverride:false,modus:"0"};DigiWebApp.JSONDatenuebertragungController.recieveData(c)},empfangePositionen:function(a,b){var c={webservice:"positionen",loaderText:M.I18N.l("getPositionsLoader"),
successCallback:function(d){if(typeof d.positionen==="undefined"&&d.positionen!==null&&d.positionen.length>0)return trackError("missing positionen",b);var e=null;try{e=d.positionen.length}catch(f){return trackError("data.positionen hat L\u00e4nge "+e,b)}if(d.positionen===null)return b();else{e=null;try{e=d.positionen.length}catch(g){return trackError("data.positionen hat L\u00e4nge "+e,b)}}DigiWebApp.ApplicationController.DigiProgressView.show(M.I18N.l("Save"),M.I18N.l("positions"),e,0);DigiWebApp.Position.deleteAll();
DigiWebApp.Order.deleteAll();var i=false;_.each(d.positionen,function(h){if(typeof h.positionsId==="undefined"){trackError("missing positionsId");i=true}else if(typeof h.positionsBezeichnung==="undefined"){trackError("missing positionsBezeichnung");i=true}else{var j=h.positionsId,l=h.positionsBezeichnung,n=h.strasse,m=h.hausnummer,o=h.plz,p=h.ort,q=h.land,r=h.countrycode,s=h.telefon,u=h.fax,t=h.email,v=h.ansprechpartner,x=h.kundenname,B=h.longitude,z=h.latitude,D=h.positionsBeschreibung,y=h.auftragsId,
E=h.arbeitsbeginn,A=h.arbeitsende,F="";if(h.beginn)F=h.beginn;if(typeof j==="object")j="";if(typeof l==="object")l="";if(typeof n==="object")n="";if(typeof m==="object")m="";if(typeof o==="object")o="";if(typeof p==="object")p="";if(typeof q==="object")q="";if(typeof r==="object")r="";if(typeof s==="object")s="";if(typeof u==="object")u="";if(typeof t==="object")t="";if(typeof v==="object")v="";if(typeof x==="object")x="";if(typeof B==="object")B="";if(typeof z==="object")z="";if(typeof D==="object")D=
"";if(typeof y==="object")y="";if(typeof E==="object")E="";if(typeof A==="object")A="";j=DigiWebApp.Position.createRecord({id:j,name:l,strasse:n,hausnummer:m,plz:o,ort:p,land:q,countrycode:r,telefon:s,fax:u,email:t,ansprechpartner:v,kundenname:x,longitude:B,latitude:z,description:D,orderId:y,positionBegin:F,arbeitsbeginn:E,arbeitsende:A});_.find(DigiWebApp.Order.find(),function(w){return w.get("id")==y})||DigiWebApp.Order.createRecord({id:h.auftragsId,name:h.auftragsBezeichnung}).saveSorted();var C=
[];typeof h.mitarbeiterTermine!=="undefined"&&h.mitarbeiterTermine!==null&&h.mitarbeiterTermine.length>0&&_.each(h.mitarbeiterTermine,function(w){if(w.ganzerTag){var G=w.von.split(" ")[0];w.von=G+" 00:00:00";w.bis=G+" 23:59:59"}C.push(JSON.stringify(w))});j.set("appointments",JSON.stringify(C));j.saveSorted();DigiWebApp.ApplicationController.DigiProgressView.increase()}});DigiWebApp.ApplicationController.DigiProgressView.hide();return i?b():a()},errorCallback:b,additionalQueryParameter:"",geraeteIdOverride:false,
modus:"1"};DigiWebApp.JSONDatenuebertragungController.recieveData(c)},empfangeFestepausendefinitionen:function(a,b){var c={webservice:"festepausendefinitionen",loaderText:M.I18N.l("getFestepausendefinitionenLoader"),successCallback:function(d){if(typeof d.festepausendefinitionen==="undefined"&&d.festepausendefinitionen!==null&&d.festepausendefinitionen.length>0){trackError("missing festepausendefinitionen");return b()}var e=null;try{e=d.festepausendefinitionen.length}catch(f){trackError("data.festepausendefinitionen hat L\u00e4nge "+
e)}if(d.festepausendefinitionen!==null){e=null;try{e=d.festepausendefinitionen.length}catch(g){trackError("data.festepausendefinitionen hat L\u00e4nge "+e);return b()}}DigiWebApp.ApplicationController.DigiProgressView.show(M.I18N.l("Save"),M.I18N.l("festepausendefinitionen"),e,0);DigiWebApp.Festepausendefinition.deleteAll();_.each(d.festepausendefinitionen,function(i){if(typeof i=="undefined"||i==null)trackError("empty element");else if(typeof i.id==="undefined"){trackError("missing id");return b()}else if(typeof i.wochentagId===
"undefined"){trackError("missing wochentagId");return b()}else if(typeof i.von==="undefined"){trackError("missing von");return b()}else if(typeof i.bis==="undefined"){trackError("missing bis");return b()}else{DigiWebApp.Festepausendefinition.createRecord({id:i.id,ressourceId:i.ressourceId,wochentagId:i.wochentagId,von:i.von,bis:i.bis}).saveSorted();DigiWebApp.ApplicationController.DigiProgressView.increase()}});DigiWebApp.ApplicationController.DigiProgressView.hide();a()},errorCallback:b,additionalQueryParameter:"",
geraeteIdOverride:false,modus:"1"};DigiWebApp.JSONDatenuebertragungController.recieveData(c)}});
DigiWebApp.MediaListController=M.Controller.extend({items:null,latestId:null,lastTimestampDatatransfer:null,init:function(){var a=DigiWebApp.MediaListController,b=[];b=_.sortBy(DigiWebApp.MediaFile.find(),function(e){return parseIntRadixTen(e.get("timeStamp"))});a.set("items",b.reverse());if(DigiWebApp.MediaFile.find().length==0){$("#"+DigiWebApp.MediaListPage.uebertragenButton.id).hide();$("#"+DigiWebApp.MediaListPage.newButton.id).show()}else{$("#"+DigiWebApp.MediaListPage.uebertragenButton.id).show();
$("#"+DigiWebApp.MediaListPage.newButton.id).hide()}var c;if(typeof DigiWebApp.app.pages.mediaListPage!="undefined")try{(c=M.ViewManager.getView("mediaListPage","mediafiles"))&&$("#"+c.id).find("li").each(function(){$(this).removeClass("selected")})}catch(d){trackError(d)}DigiWebApp.ApplicationController.DigiLoaderView.hide()},itemSelected:function(a,b){try{DigiWebApp.ApplicationController.vibrate()}catch(c){}this.latestId&&$("#"+this.latestId).removeClass("selected");$("#"+a).addClass("selected");
this.latestId=a;b&&typeof this[b]==="function"&&this[b]()},neu:function(){var a=DigiWebApp.MediaListController;DigiWebApp.SettingsController.featureAvailable("400")?a.foto():DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("notActivated"),message:M.I18N.l("notActivatedMsg")})},foto:function(){M.DialogView.actionSheet({title:M.I18N.l("takePicture"),cancelButtonValue:M.I18N.l("cancel"),otherButtonValues:[M.I18N.l("library"),M.I18N.l("camera")],otherButtonTags:["library","camera"],
callbacks:{other:{action:function(a){switch(a){case "library":if(typeof navigator.camera!=="undefined"&&typeof navigator.camera.getPicture!=="undefined"){a=parseIntRadixTen(DigiWebApp.SettingsController.defaultsettings.get("pictureEncodingQuality"));var b=DigiWebApp.SettingsController.getSetting("pictureEncodingQuality");if(parseIntRadixTen(b)>9)a=parseIntRadixTen(b);b=navigator.camera.EncodingType.JPEG;if(DigiWebApp.SettingsController.getSetting("pictureEncodingType")=="PNG")b=navigator.camera.EncodingType.PNG;
var c=parseBool(DigiWebApp.SettingsController.getSetting("pictureAllowEdit"));navigator.camera.getPicture(function(d){d.indexOf("data:")===0?DigiWebApp.CameraController.set("loadedPicture",d):DigiWebApp.CameraController.set("loadedPicture","data:"+DigiWebApp.ApplicationController.getImageFiletype()+","+d);DigiWebApp.CameraController.set("fileType",DigiWebApp.ApplicationController.getImageFiletype());DigiWebApp.NavigationController.toCameraPageTransition()},function(d){DigiWebApp.CameraController.set("loadedPicture",
null);DigiWebApp.CameraController.set("fileType",null);DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("error"),message:M.I18N.l("noPicLoaded")+": "+d})},{quality:a,allowEdit:c,destinationType:navigator.camera.DestinationType.DATA_URL,encodingType:b,sourceType:navigator.camera.PictureSourceType.PHOTOLIBRARY,mediaType:navigator.camera.MediaType.PICTURE,saveToPhotoAlbum:false})}else{DigiWebApp.FileChooserPage.set("successCallback",function(d,e){if(d!==null){DigiWebApp.CameraController.set("loadedFileName",
e);for(var f="",g=e,i=0;i!==-1;){g=g.substr(i+1);i=g.indexOf(".")}g=g.toLowerCase();switch(g){case "jpg":f="image/jpeg";break;case "jpeg":f="image/"+g;break;case "png":f="image/"+g;break;case "bmp":f="image/"+g}switch(f){case "":DigiWebApp.CameraController.set("loadedPicture",null);DigiWebApp.CameraController.set("fileType",null);DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("error"),message:M.I18N.l("noPicLoaded")});break;default:DigiWebApp.CameraController.set("fileType",
f);d.indexOf("data:")===0?DigiWebApp.CameraController.set("loadedPicture",d):DigiWebApp.CameraController.set("loadedPicture","data:"+f+","+d);DigiWebApp.NavigationController.toCameraPageTransition()}}else{DigiWebApp.CameraController.set("loadedPicture",null);DigiWebApp.CameraController.set("fileType",null);DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("error"),message:M.I18N.l("noPicLoaded")})}});DigiWebApp.NavigationController.toFileChooserPageTransition()}break;case "camera":if(typeof navigator.camera!==
"undefined"&&typeof navigator.camera.getPicture!=="undefined"){DigiWebApp.CameraController.set("loadedPicture",null);DigiWebApp.NavigationController.toCameraPageTransition()}else DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("error"),message:M.I18N.l("noCamera")});break;default:console.log("unknonw ButtonTag")}}},cancel:{action:function(){}}}})},audio:function(){DigiWebApp.NavigationController.toAudioPageTransition()},uploadMediaFiles:function(){var a=DigiWebApp.MediaListController,
b=NO;if(a.lastTimestampDatatransfer!==null)if(D8.now().getTimestamp()-a.lastTimestampDatatransfer>parseIntRadixTen(DigiWebApp.SettingsController.getSetting("datatransfer_min_delay")))b=YES;if(b===YES||a.lastTimestampDatatransfer===null)a.doUploadMediaFiles()},doUploadMediaFiles:function(){var a=DigiWebApp.MediaListController;a.set("lastTimestampDatatransfer",D8.now().getTimestamp());DigiWebApp.ApplicationController.DigiLoaderView.show(M.I18N.l("loadMediaFiles"));var b=function(i){if(i.length!==0){var h=
0;if(i.length>0){var j=i[0],l=[],n=JSON.parse(JSON.stringify(j));if(n.record.handOrderId!==null&&n.record.handOrderId!=="0")n.record.orderId=null;l.push(n.record);l={medien:l};writeToLog("sending mediaFile "+n.record.fileName);n=DigiWebApp.SettingsController.getSetting("WebserviceTimeOut");if(parseIntRadixTen(DigiWebApp.SettingsController.getSetting("WebserviceTimeOut"))<6E4)n=6E4;n={data:l,webservice:"medien",loaderText:M.I18N.l("sendeMedien"),successCallback:function(){var m=[];_.each(i,function(o){o.m_id==
j.m_id?writeToLog("l\u00f6sche mediaFile "+o.record.fileName,function(){var p=function(){o.del();_.sortBy(DigiWebApp.MediaFile.find(),function(q){return parseIntRadixTen(q.get("timeStamp"))});a.init()};o.deleteFile(p,p);h+=1}):m.push(o)});if(m.length>0)b(m);else{writeToLog("sending last mediaFile done (with file)");DigiWebApp.MediaListController.init()}},errorCallback:function(m,o){var p=[];_.each(i,function(q){q.m_id!=j.m_id&&p.push(q)});if(p.length>0)b(p);else{writeToLog("sending mediaFile failed: "+
o);DigiWebApp.MediaListController.init()}},timeout:n,omitLoaderHide:true};DigiWebApp.JSONDatenuebertragungController.sendData(n)}}else DigiWebApp.MediaListController.init()},c=DigiWebApp.MediaFile.find(),d=[],e=c.length,f=0,g=false;e!==0?_.each(c,function(i){if(i.hasFileName()){writeToLog("loading mediaFile "+i.get("fileName"));i.readFromFile(function(h){h&&h!==""&&_.each(c,function(j){if(j.m_id==i.m_id){j.set("data",h);f+=1;d.push(j);writeToLog("mediaFile "+j.get("fileName")+" loaded ("+f+")")}});
if(f===e&&g===false){writeToLog("last mediaFile done (with file)");g=true;b(d)}},function(){var h=function(){f+=1;if(f===e&&g===false){writeToLog("last mediaFile done (last file load failed)");g=true;b(d)}};trackError("loading mediaFile "+i.get("fileName")+" failed!");DigiWebApp.ApplicationController.nativeConfirmDialogView({title:M.I18N.l("error"),message:M.I18N.l("loadingFileFailed")+" (DIGIWebAppData/"+i.get("fileName")+")",callbacks:{confirm:{action:function(){writeToLog("l\u00f6sche mediaFile "+
i.get("fileName"));i.del();h()}},cancel:{action:function(){h()}}}})})}else{f+=1;if(f===e&&g===false){writeToLog("last mediaFile done (no file)");g=true;b(d)}}}):b(d)}});
DigiWebApp.NavigationController=M.Controller.extend({toSplashViewPage:function(){DigiWebApp.NavigationController.switchToPage("splashView",M.TRANSITION.NONE,NO)},toSplashViewPageTransition:function(){DigiWebApp.NavigationController.switchToPage("splashView",M.TRANSITION.FADE,NO)},toInfoPage:function(){DigiWebApp.NavigationController.switchToPage("infoPage",M.TRANSITION.NONE,NO)},toInfoPageTransition:function(){DigiWebApp.NavigationController.switchToPage("infoPage",M.TRANSITION.SLIDEUP,NO)},backToBookTimePage:function(){DigiWebApp.TabBar.setActiveTab(DigiWebApp.TabBar.tabItem1);
if(DigiWebApp.SettingsController.featureAvailable("409"))if(DigiWebApp.SettingsController.featureAvailable("412"))DigiWebApp.NavigationController.startBautagebuch();else{DigiWebApp.ApplicationController.useSplashJustForFade=YES;DigiWebApp.NavigationController.toSplashViewPage();DigiWebApp.ApplicationController.useSplashJustForFade=0;DigiWebApp.NavigationController.backToDashboardPage()}else try{DigiWebApp.SettingsController.featureAvailable("416")?DigiWebApp.NavigationController.switchToPage("bookingPageWithIconsScholpp",
M.TRANSITION.SLIDEUP,YES):DigiWebApp.NavigationController.switchToPage("bookingPage",M.TRANSITION.SLIDEUP,YES)}catch(a){trackError(a)}},backToBookTimePagePOP:function(){DigiWebApp.TabBar.setActiveTab(DigiWebApp.TabBar.tabItem1);if(DigiWebApp.SettingsController.featureAvailable("409"))if(DigiWebApp.SettingsController.featureAvailable("412"))DigiWebApp.NavigationController.startBautagebuch();else{DigiWebApp.ApplicationController.useSplashJustForFade=YES;DigiWebApp.NavigationController.toSplashViewPage();
DigiWebApp.ApplicationController.useSplashJustForFade=0}else try{DigiWebApp.SettingsController.featureAvailable("416")?DigiWebApp.NavigationController.switchToPage("bookingPageWithIconsScholpp",M.TRANSITION.POP,YES):DigiWebApp.NavigationController.switchToPage("bookingPage",M.TRANSITION.POP,YES)}catch(a){trackError(a)}},toBookTimePage:function(){DigiWebApp.TabBar.setActiveTab(DigiWebApp.TabBar.tabItem1);if(DigiWebApp.SettingsController.featureAvailable("409"))if(DigiWebApp.SettingsController.featureAvailable("412"))DigiWebApp.NavigationController.startBautagebuch();
else{DigiWebApp.ApplicationController.useSplashJustForFade=YES;DigiWebApp.NavigationController.toSplashViewPage();DigiWebApp.ApplicationController.useSplashJustForFade=0}else DigiWebApp.SettingsController.featureAvailable("416")?DigiWebApp.NavigationController.switchToPage("bookingPageWithIconsScholpp",M.TRANSITION.NONE,NO):DigiWebApp.NavigationController.switchToPage("bookingPage",M.TRANSITION.NONE,NO)},toBookTimePageTransition:function(){DigiWebApp.TabBar.setActiveTab(DigiWebApp.TabBar.tabItem1);
if(DigiWebApp.SettingsController.featureAvailable("409"))if(DigiWebApp.SettingsController.featureAvailable("412"))DigiWebApp.NavigationController.startBautagebuch();else{DigiWebApp.ApplicationController.useSplashJustForFade=YES;DigiWebApp.NavigationController.toSplashViewPage();DigiWebApp.ApplicationController.useSplashJustForFade=0}else try{DigiWebApp.SettingsController.featureAvailable("416")?DigiWebApp.NavigationController.switchToPage("bookingPageWithIconsScholpp",M.TRANSITION.SLIDEUP,NO):DigiWebApp.NavigationController.switchToPage("bookingPage",
M.TRANSITION.SLIDEUP,NO)}catch(a){trackError(a)}},toBookTimePageFlipTransition:function(){DigiWebApp.TabBar.setActiveTab(DigiWebApp.TabBar.tabItem1);if(DigiWebApp.SettingsController.featureAvailable("409"))if(DigiWebApp.SettingsController.featureAvailable("412"))DigiWebApp.NavigationController.startBautagebuch();else{DigiWebApp.ApplicationController.useSplashJustForFade=YES;DigiWebApp.NavigationController.toSplashViewPage();DigiWebApp.ApplicationController.useSplashJustForFade=0}else try{DigiWebApp.SettingsController.featureAvailable("416")?
DigiWebApp.NavigationController.switchToPage("bookingPageWithIconsScholpp",M.TRANSITION.FLIP,YES):DigiWebApp.NavigationController.switchToPage("bookingPage",M.TRANSITION.FLIP,YES)}catch(a){trackError(a)}},backToBookTimePageFlipTransition:function(){DigiWebApp.TabBar.setActiveTab(DigiWebApp.TabBar.tabItem1);if(DigiWebApp.SettingsController.featureAvailable("409"))if(DigiWebApp.SettingsController.featureAvailable("412"))DigiWebApp.NavigationController.startBautagebuch();else{DigiWebApp.ApplicationController.useSplashJustForFade=
YES;DigiWebApp.NavigationController.toSplashViewPage();DigiWebApp.ApplicationController.useSplashJustForFade=0}else try{DigiWebApp.SettingsController.featureAvailable("416")?DigiWebApp.NavigationController.switchToPage("bookingPageWithIconsScholpp",M.TRANSITION.FLIP,NO):DigiWebApp.NavigationController.switchToPage("bookingPage",M.TRANSITION.FLIP,NO)}catch(a){trackError(a)}},toHandOrderPage:function(){if(DigiWebApp.SettingsController.featureAvailable("409"))DigiWebApp.SettingsController.featureAvailable("404")?
DigiWebApp.NavigationController.toButtonDashboardPage():DigiWebApp.NavigationController.toDashboardPage();else DigiWebApp.NavigationController.switchToPage("handOrderPage",M.TRANSITION.NONE,NO)},toHandOrderPageTransition:function(){if(DigiWebApp.SettingsController.featureAvailable("409"))DigiWebApp.SettingsController.featureAvailable("404")?DigiWebApp.NavigationController.toButtonDashboardPage():DigiWebApp.NavigationController.toDashboardPage();else DigiWebApp.NavigationController.switchToPage("handOrderPage",
M.TRANSITION.SLIDEUP,NO)},toSettingsPage:function(){DigiWebApp.NavigationController.switchToPage("settingsPage",M.TRANSITION.NONE,NO)},backToSettingsPage:function(){DigiWebApp.NavigationController.switchToPage("settingsPage",M.TRANSITION.POP,YES)},toSettingsPasswordPage:function(){DigiWebApp.NavigationController.switchToPage("settingsPasswordPage",M.TRANSITION.NONE,NO)},toSettingsPasswordPageTransition:function(){DigiWebApp.NavigationController.switchToPage("settingsPasswordPage",M.TRANSITION.POP,
NO)},toTimeDataPage:function(){DigiWebApp.NavigationController.switchToPage("timeDataPage",M.TRANSITION.NONE,NO)},toTimeDataPageTransition:function(){DigiWebApp.NavigationController.switchToPage("timeDataPage",M.TRANSITION.SLIDEUP,NO)},backToTimeDataPage:function(){DigiWebApp.NavigationController.switchToPage("timeDataPage",M.TRANSITION.SLIDEUP,YES)},toEmployeePage:function(){DigiWebApp.NavigationController.switchToPage("employeePage",M.TRANSITION.POP,NO)},toDashboardPage:function(){DigiWebApp.TabBar.setActiveTab(DigiWebApp.TabBar.tabItem2);
DigiWebApp.NavigationController.switchToPage("dashboard",M.TRANSITION.NONE,NO)},toDashboardPageTransition:function(){DigiWebApp.TabBar.setActiveTab(DigiWebApp.TabBar.tabItem2);DigiWebApp.NavigationController.switchToPage("dashboard",M.TRANSITION.SLIDEUP,NO)},backToDashboardPage:function(){DigiWebApp.TabBar.setActiveTab(DigiWebApp.TabBar.tabItem2);DigiWebApp.NavigationController.switchToPage("dashboard",M.TRANSITION.SLIDEUP,YES)},backToDashboardPagePOP:function(){DigiWebApp.TabBar.setActiveTab(DigiWebApp.TabBar.tabItem2);
DigiWebApp.NavigationController.switchToPage("dashboard",M.TRANSITION.POP,YES)},backToDashboardPageFlipTransition:function(){DigiWebApp.TabBar.setActiveTab(DigiWebApp.TabBar.tabItem2);DigiWebApp.NavigationController.switchToPage("dashboard",M.TRANSITION.FLIP,YES)},toDashboardPageFlipTransition:function(){DigiWebApp.NavigationController.switchToPage("dashboard",M.TRANSITION.FLIP,NO)},toButtonDashboardPage:function(){DigiWebApp.TabBar.setActiveTab(DigiWebApp.TabBar.tabItem2);DigiWebApp.NavigationController.switchToPage("buttonsDashboard",
M.TRANSITION.NONE,NO)},toButtonDashboardPageTransition:function(){DigiWebApp.TabBar.setActiveTab(DigiWebApp.TabBar.tabItem2);DigiWebApp.NavigationController.switchToPage("buttonsDashboard",M.TRANSITION.SLIDEUP,NO)},backToButtonDashboardPage:function(){DigiWebApp.TabBar.setActiveTab(DigiWebApp.TabBar.tabItem2);DigiWebApp.NavigationController.switchToPage("buttonsDashboard",M.TRANSITION.SLIDEUP,YES)},backToButtonDashboardPagePOP:function(){DigiWebApp.TabBar.setActiveTab(DigiWebApp.TabBar.tabItem2);
DigiWebApp.NavigationController.switchToPage("buttonsDashboard",M.TRANSITION.POP,YES)},backToButtonDashboardPageFlipTransition:function(){DigiWebApp.TabBar.setActiveTab(DigiWebApp.TabBar.tabItem2);DigiWebApp.NavigationController.switchToPage("buttonsDashboard",M.TRANSITION.FLIP,YES)},toButtonDashboardPageFlipTransition:function(){DigiWebApp.TabBar.setActiveTab(DigiWebApp.TabBar.tabItem2);DigiWebApp.NavigationController.switchToPage("buttonsDashboard",M.TRANSITION.FLIP,NO)},toOrderInfoPage:function(){DigiWebApp.NavigationController.switchToPage("orderInfoPage",
M.TRANSITION.NONE,NO)},toOrderInfoPageTransition:function(){DigiWebApp.NavigationController.switchToPage("orderInfoPage",M.TRANSITION.SLIDEUP,NO)},toEditPicturePage:function(){DigiWebApp.NavigationController.switchToPage("editPicturePage",M.TRANSITION.NONE,NO)},toEditPicturePageTransition:function(){DigiWebApp.NavigationController.switchToPage("editPicturePage",M.TRANSITION.SLIDEUP,NO)},backToEditPicturePage:function(){DigiWebApp.NavigationController.switchToPage("editPicturePage",M.TRANSITION.SLIDEUP,
YES)},toDemoMediaPage:function(){DigiWebApp.NavigationController.switchToPage("demomediaPage",M.TRANSITION.NONE,NO)},toDemoMediaPageTransition:function(){DigiWebApp.NavigationController.switchToPage("demomediaPage",M.TRANSITION.SLIDEUP,NO)},backToDemoMediaPage:function(){DigiWebApp.NavigationController.switchToPage("demomediaPage",M.TRANSITION.SLIDEUP,YES)},toMediaListPage:function(){DigiWebApp.NavigationController.switchToPage("mediaListPage",M.TRANSITION.NONE,NO)},toMediaListPageTransition:function(){DigiWebApp.NavigationController.switchToPage("mediaListPage",
M.TRANSITION.SLIDEUP,NO)},backToMediaListPage:function(){DigiWebApp.NavigationController.switchToPage("mediaListPage",M.TRANSITION.NONE,YES)},backToMediaListPageTransition:function(){DigiWebApp.NavigationController.switchToPage("mediaListPage",M.TRANSITION.SLIDEUP,YES)},toAudioPage:function(){DigiWebApp.NavigationController.switchToPage("audioPage",M.TRANSITION.NONE,NO)},toAudioPageTransition:function(){DigiWebApp.NavigationController.switchToPage("audioPage",M.TRANSITION.SLIDEUP,NO)},toDemoAudioPage:function(){DigiWebApp.NavigationController.switchToPage("demoaudioPage",
M.TRANSITION.NONE,NO)},toDemoAudioPageTransition:function(){DigiWebApp.NavigationController.switchToPage("demoaudioPage",M.TRANSITION.SLIDEUP,NO)},toCameraPage:function(){DigiWebApp.NavigationController.switchToPage("cameraPage",M.TRANSITION.NONE,NO)},toCameraPageTransition:function(){DigiWebApp.NavigationController.switchToPage("cameraPage",M.TRANSITION.SLIDEUP,NO)},toDemoCameraPage:function(){DigiWebApp.NavigationController.switchToPage("democameraPage",M.TRANSITION.NONE,NO)},toDemoCameraPageTransition:function(){DigiWebApp.NavigationController.switchToPage("democameraPage",
M.TRANSITION.SLIDEUP,NO)},toSpesenPage:function(a){if(typeof a==="function"){DigiWebApp.SpesenPage.myCallback=a;DigiWebApp.NavigationController.switchToPage("spesenPage",M.TRANSITION.POP,NO)}},toRemarkPage:function(a){DigiWebApp.RemarkPage.myCallback=typeof a==="function"?a:function(){DigiWebApp.NavigationController.toBookTimePage();DigiWebApp.BookingController.bookWithRemark()};DigiWebApp.NavigationController.switchToPage("remarkPage",M.TRANSITION.POP,NO)},toEditTimeDataPage:function(a){DigiWebApp.EditTimeDataPage.myCallback=
typeof a==="function"?a:function(){DigiWebApp.NavigationController.backToTimeDataPage()};DigiWebApp.NavigationController.switchToPage("editTimeDataPage",M.TRANSITION.SLIDEUP,NO)},toAnwesenheitslistePage:function(){DigiWebApp.AnwesenheitslisteController.set("items",{});DigiWebApp.AnwesenheitslisteController.items=null;DigiWebApp.NavigationController.switchToPage("anwesenheitslistePage",M.TRANSITION.NONE,NO)},toAnwesenheitslistePageTransition:function(){DigiWebApp.AnwesenheitslisteController.set("items",
{});DigiWebApp.AnwesenheitslisteController.items=null;DigiWebApp.NavigationController.switchToPage("anwesenheitslistePage",M.TRANSITION.SLIDEUP,NO)},backToAnwesenheitslistePage:function(){DigiWebApp.ZeitbuchungenController.set("items",{});DigiWebApp.ZeitbuchungenController.items=null;DigiWebApp.NavigationController.switchToPage("anwesenheitslistePage",M.TRANSITION.NONE,YES)},backToAnwesenheitslistePageTransition:function(){DigiWebApp.ZeitbuchungenController.set("items",{});DigiWebApp.ZeitbuchungenController.items=
null;DigiWebApp.NavigationController.switchToPage("anwesenheitslistePage",M.TRANSITION.SLIDEUP,YES)},toZeitbuchungenPage:function(){DigiWebApp.ZeitbuchungenController.set("items",{});DigiWebApp.ZeitbuchungenController.items=null;DigiWebApp.NavigationController.switchToPage("zeitbuchungenPage",M.TRANSITION.NONE,NO)},toZeitbuchungenPageTransition:function(){DigiWebApp.ZeitbuchungenController.set("items",{});DigiWebApp.ZeitbuchungenController.items=null;DigiWebApp.NavigationController.switchToPage("zeitbuchungenPage",
M.TRANSITION.SLIDEUP,NO)},backToZeitbuchungenPage:function(){DigiWebApp.ZeitbuchungenController.set("itemForDetails",{});DigiWebApp.ZeitbuchungenController.itemForDetails=null;DigiWebApp.NavigationController.switchToPage("zeitbuchungenPage",M.TRANSITION.NONE,YES)},backToZeitbuchungenPageTransition:function(){DigiWebApp.ZeitbuchungenController.set("itemForDetails",{});DigiWebApp.ZeitbuchungenController.itemForDetails=null;DigiWebApp.NavigationController.switchToPage("zeitbuchungenPage",M.TRANSITION.SLIDEUP,
YES)},toZeitbuchungDetailsPage:function(){DigiWebApp.NavigationController.switchToPage("zeitbuchungDetailsPage",M.TRANSITION.NONE,NO)},toZeitbuchungDetailsPageTransition:function(){DigiWebApp.NavigationController.switchToPage("zeitbuchungDetailsPage",M.TRANSITION.SLIDEUP,NO)},backToZeitbuchungDetailsPage:function(){DigiWebApp.OrderDetailsController.set("positionForDetails",{});DigiWebApp.OrderDetailsController.positionForDetails=null;DigiWebApp.NavigationController.switchToPage("zeitbuchungDetailsPage",
M.TRANSITION.NONE,YES)},backToZeitbuchungDetailsPageTransition:function(){DigiWebApp.OrderDetailsController.set("positionForDetails",{});DigiWebApp.OrderDetailsController.positionForDetails=null;DigiWebApp.NavigationController.switchToPage("zeitbuchungDetailsPage",M.TRANSITION.SLIDEUP,YES)},toOrderDetailsPage:function(){DigiWebApp.NavigationController.switchToPage("orderDetailsPage",M.TRANSITION.NONE,NO)},toOrderDetailsPageTransition:function(){DigiWebApp.NavigationController.switchToPage("orderDetailsPage",
M.TRANSITION.SLIDEUP,NO)},toTimeDataArchivePage:function(){DigiWebApp.NavigationController.switchToPage("timeDataArchivePage",M.TRANSITION.NONE,NO)},toTimeDataArchivePageTransition:function(){DigiWebApp.NavigationController.switchToPage("timeDataArchivePage",M.TRANSITION.SLIDEUP,NO)},toBautagebuchBautagesberichteListePageTransition:function(){DigiWebApp.NavigationController.switchToPage("bautagebuchBautagesberichteListePage",M.TRANSITION.SLIDEUP,NO)},backToBautagebuchBautagesberichteListePageTransition:function(){DigiWebApp.NavigationController.switchToPage("bautagebuchBautagesberichteListePage",
M.TRANSITION.SLIDEUP,YES)},toBautagebuchBautagesberichtDetailsPageTransition:function(){DigiWebApp.NavigationController.switchToPage("bautagebuchBautagesberichtDetailsPage",M.TRANSITION.SLIDEUP,NO)},backToBautagebuchBautagesberichtDetailsPageTransition:function(){DigiWebApp.NavigationController.switchToPage("bautagebuchBautagesberichtDetailsPage",M.TRANSITION.SLIDEUP,YES)},toBautagebuchMaterialienListePageTransition:function(){DigiWebApp.NavigationController.switchToPage("bautagebuchMaterialienListePage",
M.TRANSITION.SLIDEUP,NO)},backToBautagebuchMaterialienListePageTransition:function(){DigiWebApp.NavigationController.switchToPage("bautagebuchMaterialienListePage",M.TRANSITION.SLIDEUP,YES)},toBautagebuchMaterialienDetailsPageTransition:function(){DigiWebApp.NavigationController.switchToPage("bautagebuchMaterialienDetailsPage",M.TRANSITION.SLIDEUP,NO)},backToBautagebuchMaterialienDetailsPageTransition:function(){DigiWebApp.NavigationController.switchToPage("bautagebuchMaterialienDetailsPage",M.TRANSITION.SLIDEUP,
YES)},toBautagebuchZeitenListePageTransition:function(){DigiWebApp.NavigationController.switchToPage("bautagebuchZeitenListePage",M.TRANSITION.SLIDEUP,NO)},backToBautagebuchZeitenListePageTransition:function(){DigiWebApp.NavigationController.switchToPage("bautagebuchZeitenListePage",M.TRANSITION.SLIDEUP,YES)},toBautagebuchZeitenDetailsPageTransition:function(){DigiWebApp.NavigationController.switchToPage("bautagebuchZeitenDetailsPage",M.TRANSITION.SLIDEUP,NO)},backToBautagebuchZeitenDetailsPageTransition:function(){DigiWebApp.NavigationController.switchToPage("bautagebuchZeitenDetailsPage",
M.TRANSITION.SLIDEUP,YES)},toBautagebuchNotizenListePageTransition:function(){DigiWebApp.NavigationController.switchToPage("bautagebuchNotizenListePage",M.TRANSITION.SLIDEUP,NO)},backToBautagebuchNotizenListePageTransition:function(){DigiWebApp.NavigationController.switchToPage("bautagebuchNotizenListePage",M.TRANSITION.SLIDEUP,YES)},toBautagebuchNotizenDetailsPageTransition:function(){DigiWebApp.NavigationController.switchToPage("bautagebuchNotizenDetailsPage",M.TRANSITION.SLIDEUP,NO)},backToBautagebuchNotizenDetailsPageTransition:function(){DigiWebApp.NavigationController.switchToPage("bautagebuchNotizenDetailsPage",
M.TRANSITION.SLIDEUP,YES)},toBautagebuchMedienListePageTransition:function(){DigiWebApp.NavigationController.switchToPage("bautagebuchMedienListePage",M.TRANSITION.SLIDEUP,NO)},backToBautagebuchMedienListePageTransition:function(){DigiWebApp.NavigationController.switchToPage("bautagebuchMedienListePage",M.TRANSITION.SLIDEUP,YES)},toBautagebuchMedienDetailsPageTransition:function(){DigiWebApp.NavigationController.switchToPage("bautagebuchMedienDetailsPage",M.TRANSITION.SLIDEUP,NO)},backToBautagebuchMedienDetailsPageTransition:function(){DigiWebApp.NavigationController.switchToPage("bautagebuchMedienDetailsPage",
M.TRANSITION.SLIDEUP,YES)},toBautagebuchEinstellungenPageTransition:function(){DigiWebApp.NavigationController.switchToPage("bautagebuchEinstellungenPage",M.TRANSITION.SLIDEUP,NO)},backToBautagebuchEinstellungenPageTransition:function(){DigiWebApp.NavigationController.switchToPage("bautagebuchEinstellungenPage",M.TRANSITION.SLIDEUP,YES)},toBautagebuchWetterPageTransition:function(){DigiWebApp.NavigationController.switchToPage("bautagebuchWetterPage",M.TRANSITION.SLIDEUP,NO)},backToBautagebuchWetterPageTransition:function(){DigiWebApp.NavigationController.switchToPage("bautagebuchWetterPage",
M.TRANSITION.SLIDEUP,YES)},toBautagebuchZusammenfassungPageTransition:function(){DigiWebApp.NavigationController.switchToPage("bautagebuchZusammenfassungPage",M.TRANSITION.SLIDEUP,NO)},backToBautagebuchZusammenfassungPageTransition:function(){DigiWebApp.NavigationController.switchToPage("bautagebuchZusammenfassungPage",M.TRANSITION.SLIDEUP,YES)},toBautagebuchMitarbeiterAuswahlPage:function(){DigiWebApp.NavigationController.switchToPage("bautagebuchMitarbeiterAuswahlPage",M.TRANSITION.SLIDEUP,NO)},
toFileChooserPageTransition:function(){DigiWebApp.NavigationController.switchToPage("fileChooserPage",M.TRANSITION.POP,NO)},toButtonsDashboardPage:function(){DigiWebApp.TabBar.setActiveTab(DigiWebApp.TabBar.tabItem2);DigiWebApp.NavigationController.switchToPage("buttonsDashboard",M.TRANSITION.NONE,NO)},toButtonsDashboardPageTransition:function(){DigiWebApp.TabBar.setActiveTab(DigiWebApp.TabBar.tabItem2);DigiWebApp.NavigationController.switchToPage("buttonsDashboard",M.TRANSITION.SLIDEUP,NO)},backToButtonsDashboardPage:function(){DigiWebApp.TabBar.setActiveTab(DigiWebApp.TabBar.tabItem2);
DigiWebApp.NavigationController.switchToPage("buttonsDashboard",M.TRANSITION.SLIDEUP,YES)},backToButtonsDashboardPagePOP:function(){DigiWebApp.TabBar.setActiveTab(DigiWebApp.TabBar.tabItem2);DigiWebApp.NavigationController.switchToPage("buttonsDashboard",M.TRANSITION.POP,YES)},backToButtonsDashboardPageFlipTransition:function(){DigiWebApp.TabBar.setActiveTab(DigiWebApp.TabBar.tabItem2);DigiWebApp.NavigationController.switchToPage("buttonsDashboard",M.TRANSITION.FLIP,YES)},toButtonsDashboardPageFlipTransition:function(){DigiWebApp.TabBar.setActiveTab(DigiWebApp.TabBar.tabItem2);
DigiWebApp.NavigationController.switchToPage("buttonsDashboard",M.TRANSITION.FLIP,NO)},toStudieChecklistePage:function(){DigiWebApp.NavigationController.switchToPage("studieChecklistePage",M.TRANSITION.NONE,NO)},toTerminlistePage:function(){DigiWebApp.NavigationController.switchToPage("terminlistePage",M.TRANSITION.SLIDEUP,NO)},backToTerminlistePage:function(){DigiWebApp.NavigationController.switchToPage("terminlistePage",M.TRANSITION.SLIDEUP,YES)},toFestePauseStornierenPage:function(){DigiWebApp.NavigationController.switchToPage("festePauseStornierenPage",
M.TRANSITION.SLIDEUP,NO)},backToFestePauseStornierenPage:function(){DigiWebApp.NavigationController.switchToPage("festePauseStornierenPage",M.TRANSITION.SLIDEUP,YES)},startBautagebuch:function(){var a=DigiWebApp.BautagebuchBautagesbericht.find();a=_.filter(a,function(d){return d.get("bautagesberichtTyp")=="<standard>"});if(a.length>0){var b=NO,c=null;_.each(a,function(d){if(!d.get("abgeschlossen"))if(!b&&!c){b=YES;c=d}else b=NO});if(b){DigiWebApp.BautagebuchBautagesberichteListeController.init();
DigiWebApp.BautagebuchBautagesberichtDetailsController.load(c);DigiWebApp.NavigationController.toBautagebuchBautagesberichtDetailsPageTransition()}else if(c)DigiWebApp.NavigationController.toBautagebuchBautagesberichteListePageTransition();else{DigiWebApp.BautagebuchBautagesberichteListeController.init();DigiWebApp.BautagebuchBautagesberichteListeController.neu()}}else{DigiWebApp.BautagebuchBautagesberichteListeController.init();DigiWebApp.BautagebuchBautagesberichteListeController.neu()}},toActivityListPage:function(){DigiWebApp.NavigationController.switchToPage("activityListPage",
M.TRANSITION.POP,NO)}});
DigiWebApp.OrderDetailsController=M.Controller.extend({positionForDetails:null,loadedPosition:null,init:function(a){var b=DigiWebApp.OrderDetailsController;b.items===null?DigiWebApp.RequestController.getDatabaseServer(b.initWithServer,a):b.initWithServer(a)},initWithServer:function(){var a=DigiWebApp.OrderDetailsController;if(a.positionForDetails===null){DigiWebApp.ApplicationController.DigiLoaderView.show(M.I18N.l("positionLaden"));DigiWebApp.OnlinePosition.find({urlParams:{},callbacks:{success:{action:function(b){DigiWebApp.ApplicationController.DigiLoaderView.hide();
if(b&&b.length===0||parseIntRadixTen(DigiWebApp.ZeitbuchungenController.itemForDetails.get("positionsId"))===0)DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("error"),message:M.I18N.l("positionKonnteNichtGeladenWerden"),callbacks:{confirm:{target:a,action:function(){DigiWebApp.NavigationController.backToZeitbuchungDetailsPageTransition()}}}});else{a.set("loadedPosition",b);a.setItem()}}},error:{action:function(){DigiWebApp.ApplicationController.DigiLoaderView.hide();DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("error"),
message:M.I18N.l("positionKonnteNichtGeladenWerden"),callbacks:{confirm:{target:a,action:function(){DigiWebApp.NavigationController.backToZeitbuchungDetailsPageTransition()}}}})}}}})}},setItem:function(){var a=DigiWebApp.OrderDetailsController,b={orderName:"",positionName:"",positionStrasse:"",positionHausnummer:"",positionPLZ:"",positionOrt:"",positionLand:"",positionStrasseUndHausnummer:"",positionPLZundOrt:"",positionCountryCode:"",positionTelefon:"",positionFax:"",positionEmail:"",positionAnsprechpartner:"",
positionKundenname:"",positionLongitude:"",positionLatitude:"",positionBeschreibung:""};b.orderName=a.loadedPosition[0].get("auftragsBezeichnung");b.positionName=a.loadedPosition[0].get("positionsBezeichnung");b.positionStrasse=a.loadedPosition[0].get("strasse");b.positionHausnummer=a.loadedPosition[0].get("hausnummer");b.positionPLZ=a.loadedPosition[0].get("plz");b.positionOrt=a.loadedPosition[0].get("ort");b.positionLand=a.loadedPosition[0].get("land");b.positionTelefon=a.loadedPosition[0].get("telefon");
b.positionFax=a.loadedPosition[0].get("fax");b.positionEmail=a.loadedPosition[0].get("email");b.positionAnsprechpartner=a.loadedPosition[0].get("ansprechpartner");b.positionKundenname=a.loadedPosition[0].get("kundenname");b.positionLongitude=a.loadedPosition[0].get("longitude");b.positionLatitude=a.loadedPosition[0].get("latitude");b.positionBeschreibung=a.loadedPosition[0].get("positionsBeschreibung");b.positionCountryCode=a.loadedPosition[0].get("countrycode");b.positionPLZundOrt=b.positionPLZ+
" "+b.positionOrt;b.positionStrasseUndHausnummer=b.positionStrasse+" "+b.positionHausnummer;b.orderName===""&&b.positionName===""?a.set("positionForDetails",[]):a.set("positionForDetails",[b])}});
DigiWebApp.OrderInfoController=M.Controller.extend({orders:null,positions:null,activeOrder:null,activePosition:null,items:[],init:function(){DigiWebApp.OrderInfoController.set("activeOrder",null);DigiWebApp.OrderInfoController.set("activePosition",null);DigiWebApp.OrderInfoController.set("items",[]);var a=DigiWebApp.HandOrder.findSorted().concat(DigiWebApp.Order.findSorted()),b=DigiWebApp.Position.findSorted(),c=NO;if(DigiWebApp.SettingsController.getSetting("auftragsDetailsKoppeln")){a=_.map(a,function(d){if(d){var e=
{label:d.get("name"),value:d.get("id")};if(e.value===M.ViewManager.getView("bookingPage","order").getSelection()){c=e.isSelected=YES;DigiWebApp.OrderInfoController.set("activeOrder",[d])}return e}});a=_.compact(a);c===NO&&a.push({label:M.I18N.l("selectSomething"),value:"0",isSelected:!c});c=NO;b=_.map(b,function(d){if(d){if(DigiWebApp.OrderInfoController.activeOrder!==null){if(d.get("orderId")!==DigiWebApp.OrderInfoController.activeOrder[0].get("id"))return null}else return null;var e={label:d.get("name"),
value:d.get("id")};if(e.value===M.ViewManager.getView("bookingPage","position").getSelection()){c=e.isSelected=YES;DigiWebApp.OrderInfoController.set("activePosition",[d])}return e}})}else{a=_.map(a,function(d){if(d){var e={label:d.get("name"),value:d.get("id")};if(DigiWebApp.BookingController.currentBooking!==null)if(e.value===DigiWebApp.BookingController.currentBooking.get("orderId")||e.value===DigiWebApp.BookingController.currentBooking.get("handOrderId")){c=e.isSelected=YES;DigiWebApp.OrderInfoController.set("activeOrder",
[d])}return e}});a=_.compact(a);c===NO&&a.push({label:M.I18N.l("selectSomething"),value:"0",isSelected:!c});c=NO;b=_.map(b,function(d){if(d){if(DigiWebApp.OrderInfoController.activeOrder!==null){if(d.get("orderId")!==DigiWebApp.OrderInfoController.activeOrder[0].get("id"))return null}else return null;var e={label:d.get("name"),value:d.get("id")};if(DigiWebApp.BookingController.currentBooking!==null)if(e.value===DigiWebApp.BookingController.currentBooking.get("positionId")){c=e.isSelected=YES;DigiWebApp.OrderInfoController.set("activePosition",
[d])}return e}})}b=_.compact(b);c===NO&&b.push({label:M.I18N.l("selectSomething"),value:"0",isSelected:!c});this.set("orders",a);this.set("positions",b);this.setItem();if(DigiWebApp.SettingsController.getSetting("DTC6aktiv")){DigiWebApp.ApplicationController.dtc6AktivRenameHelper(DigiWebApp.OrderInfoPage.selectionContent.order.id,M.I18N.l("dtc6Ordner"));DigiWebApp.ApplicationController.dtc6AktivRenameHelper(DigiWebApp.OrderInfoPage.selectionContent.position.id,M.I18N.l("dtc6Auftrag"))}},setItem:function(){var a=
{orderName:"",positionName:"",positionStrasse:"",positionHausnummer:"",positionPLZ:"",positionOrt:"",positionLand:"",positionStrasseUndHausnummer:"",positionPLZundOrt:"",positionCountryCode:"",positionTelefon:"",positionFax:"",positionEmail:"",positionAnsprechpartner:"",positionKundenname:"",positionLongitude:"",positionLatitude:"",positionBeschreibung:"",arbeitsbeginn:"",arbeitsende:""};if(DigiWebApp.OrderInfoController.activeOrder!==null)a.orderName=DigiWebApp.OrderInfoController.activeOrder[0].get("name");
if(DigiWebApp.OrderInfoController.activePosition!==null){a.positionName=DigiWebApp.OrderInfoController.activePosition[0].get("name");a.positionStrasse=DigiWebApp.OrderInfoController.activePosition[0].get("strasse");a.positionHausnummer=DigiWebApp.OrderInfoController.activePosition[0].get("hausnummer");a.positionPLZ=DigiWebApp.OrderInfoController.activePosition[0].get("plz");a.positionOrt=DigiWebApp.OrderInfoController.activePosition[0].get("ort");a.positionLand=DigiWebApp.OrderInfoController.activePosition[0].get("land");
a.positionTelefon=DigiWebApp.OrderInfoController.activePosition[0].get("telefon");a.positionFax=DigiWebApp.OrderInfoController.activePosition[0].get("fax");a.positionEmail=DigiWebApp.OrderInfoController.activePosition[0].get("email");a.positionAnsprechpartner=DigiWebApp.OrderInfoController.activePosition[0].get("ansprechpartner");a.positionKundenname=DigiWebApp.OrderInfoController.activePosition[0].get("kundenname");a.positionLongitude=DigiWebApp.OrderInfoController.activePosition[0].get("longitude");
a.positionLatitude=DigiWebApp.OrderInfoController.activePosition[0].get("latitude");a.positionBeschreibung=DigiWebApp.OrderInfoController.activePosition[0].get("description");a.positionCountryCode=DigiWebApp.OrderInfoController.activePosition[0].get("countrycode");a.positionPLZundOrt=a.positionPLZ+" "+a.positionOrt;a.positionStrasseUndHausnummer=a.positionStrasse+" "+a.positionHausnummer;a.arbeitsbeginn=DigiWebApp.OrderInfoController.activePosition[0].get("arbeitsbeginn");a.arbeitsende=DigiWebApp.OrderInfoController.activePosition[0].get("arbeitsende")}a.orderName===
""&&a.positionName===""?DigiWebApp.OrderInfoController.set("items",[]):DigiWebApp.OrderInfoController.set("items",[a])},setPositions:function(){var a=M.ViewManager.getView("orderInfoPage","order").getSelection(YES).value;if(a){var b=DigiWebApp.Position.findSorted(),c=0;b=_.map(b,function(d){if(d){if(parseIntRadixTen(d.get("orderId"))===parseIntRadixTen(a)){var e={label:d.get("name"),value:d.get("id")};if(c===0){e.isSelected=YES;DigiWebApp.OrderInfoController.set("activePosition",[d])}c+=1;return e}return null}});
b=_.compact(b);if(b.length<1){b.push({label:M.I18N.l("noData"),value:"0"});DigiWebApp.OrderInfoController.set("activePosition",null)}M.ViewManager.getView("orderInfoPage","position").resetSelection();this.set("positions",b);this.setItem()}},saveAsContact:function(){if(typeof navigator.contacts==="undefined")DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("saveAsContact"),message:M.I18N.l("noContactsAvailable")});else{var a=DigiWebApp.OrderInfoController.items[0],b=new ContactFindOptions;
b.filter=a.orderName+", "+a.positionName;DigiWebApp.ApplicationController.DigiLoaderView.show(M.I18N.l("saveAsContact"));navigator.contacts.find(["displayName","name","givenName","familyName"],DigiWebApp.OrderInfoController.saveAsContactFound,DigiWebApp.OrderInfoController.saveAsContactFoundError,b)}},saveAsContactFound:function(a){var b=DigiWebApp.OrderInfoController.items[0];DigiWebApp.ApplicationController.DigiLoaderView.hide();if(typeof a==="undefined"){b=navigator.contacts.create({displayName:M.I18N.l("orderInfo")+
" "+b.orderName});return DigiWebApp.OrderInfoController.saveAsContactSave(b)}else if(a.length===0){b=navigator.contacts.create({displayName:M.I18N.l("orderInfo")+" "+b.orderName+", "+b.positionName});return DigiWebApp.OrderInfoController.saveAsContactSave(b)}else if(a.length>1)DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("saveAsContact"),message:M.I18N.l("contactExistsMultiple")});else{b=M.I18N.l("saveAsContactChangeQuestionMsg");DigiWebApp.ApplicationController.nativeConfirmDialogView({title:M.I18N.l("saveAsContactChangeQuestionTitle"),
message:b,confirmButtonValue:M.I18N.l("yes"),cancelButtonValue:M.I18N.l("no"),callbacks:{confirm:{target:this,action:function(){a[0].remove(DigiWebApp.OrderInfoController.contactRemoveSuccess,DigiWebApp.OrderInfoController.contactRemoveError)}},cancel:{target:this,action:function(){}}}})}},contactRemoveSuccess:function(){var a=DigiWebApp.OrderInfoController.items[0];a=navigator.contacts.create({displayName:M.I18N.l("orderInfo")+" "+a.orderName});return DigiWebApp.OrderInfoController.saveAsContactSave(a)},
contactRemoveError:function(){DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("saveAsContact"),message:M.I18N.l("saveAsContactChangeErrorMsg")})},saveAsContactFoundError:function(){DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("saveAsContact"),message:M.I18N.l("error")})},saveAsContactSave:function(a){var b=DigiWebApp.OrderInfoController.items[0],c=new ContactName;c.givenName=M.I18N.l("orderInfo");c.familyName=b.orderName+", "+b.positionName;c.honorificPrefix=
"DIGI-WebApp";a.name=c;c=[];var d="",e="";try{d=b.positionTelefon}catch(f){trackError(f)}try{e=b.positionFax}catch(g){trackError(g)}c[0]=new ContactField("work",d,true);c[1]=new ContactField("fax",e,false);a.phoneNumbers=c;c=[];d="";try{d=b.positionEmail}catch(i){trackError(i)}c[0]=new ContactField("work",d,true);a.emails=c;c=new ContactAddress;c.type="Work";c.streetAddress=b.positionStrasseUndHausnummer;c.locality=b.positionOrt;c.postalCode=b.positionPLZ;c.country=b.positionLand;if(a.addresses===
null)a.addresses=[c];else a.addresses[0]=c;c=new Date;a.note=b.positionBeschreibung+" ("+M.I18N.l("contactLastChange")+": "+c.toString()+")";DigiWebApp.ApplicationController.DigiLoaderView.show(M.I18N.l("saveAsContact"));a.save(DigiWebApp.OrderInfoController.saveAsContactSuccess,DigiWebApp.OrderInfoController.saveAsContactError)},saveAsContactSuccess:function(){DigiWebApp.ApplicationController.DigiLoaderView.hide()},saveAsContactError:function(){DigiWebApp.ApplicationController.DigiLoaderView.hide()}});
DigiWebApp.RequestController=M.Controller.extend({GatewayServer:"primary.digi-gateway.de",GatewayPool:"pool.digi-gateway.de",DatabaseServer:null,DatabaseServerTimestamp:null,handy2WebServicesUrl:"/Handy2WebServices/services/DatenTransfer",successCallback:{},errorCallback:{},softwareVersion:6360,makeRequest:function(a){var b=this,c=DigiWebApp.SettingsController.getSetting("WebserviceTimeOut")?DigiWebApp.SettingsController.getSetting("WebserviceTimeOut"):DigiWebApp.SettingsController.defaultsettings.get("WebserviceTimeOut"),
d=M.Request.init({url:"http://"+DigiWebApp.RequestController.DatabaseServer+DigiWebApp.RequestController.handy2WebServicesUrl+"/"+a.url+(a.urlParams?"?"+a.urlParams:""),timeout:a.timeout?a.timeout:c,method:"GET",beforeSend:function(e){a.loaderText?DigiWebApp.ApplicationController.DigiLoaderView.show(a.loaderText):DigiWebApp.ApplicationController.DigiLoaderView.show("Lade Daten");e.setRequestHeader("Cache-Control","no-cache")},onSuccess:function(e,f,g){var i=NO;if(typeof a.leaveLoaderOpen!=="undefined")i=
a.leaveLoaderOpen;i||DigiWebApp.ApplicationController.DigiLoaderView.hide();this.bindToCaller(b,b.handleSuccessCallback,[e,f,g,a.isWorkPlanRequest,a.isKolonnenRequest,a.source])()},onError:function(e,f){trackError(f);DigiWebApp.ApplicationController.DigiLoaderView.hide();DigiWebApp.RequestController.DatabaseServer=null;this.bindToCaller(b,b.handleErrorCallback,[e,f,a.source])()}});writeToLog("XML-WebService '"+a.url+"' wird aufgerufen",function(){d.send()})},getUrl:function(){try{if(device&&device.uuid)return"http://"+
DigiWebApp.RequestController.DatabaseServer+DigiWebApp.RequestController.handy2WebServicesUrl+"/"}catch(a){return"/Handy2WebServices/services/DatenTransfer/"}},getDatabaseServer:function(a,b){if(location.host==="localhost:8080"||DigiWebApp.SettingsController.getSetting("debugDatabaseServer")){DigiWebApp.RequestController.DatabaseServer=location.host==="localhost:8080"?"localhost:8080":DigiWebApp.SettingsController.getSetting("debugDatabaseServer");return a(b)}if(!DigiWebApp.RequestController.DatabaseServer||
DigiWebApp.RequestController.DatabaseServerTimestamp&&DigiWebApp.RequestController.DatabaseServerTimestamp-(new Date).getTime()>6E4)console.log("getDatabaseServer");else return a(b);DigiWebApp.RequestController.DatabaseServer="";var c=DigiWebApp.SettingsController.getSetting("company"),d=DigiWebApp.RequestController.GatewayServer;if(typeof device==="undefined")d=location.host;var e=function(f){DigiWebApp.ApplicationController.DigiLoaderView.hide();f=DigiWebApp.RequestController.transformResultToJson(f);
if(typeof f["return"]==="undefined"&&typeof f["ns:return"]!=="undefined")f["return"]=f["ns:return"];if(f["return"]!=="")DigiWebApp.RequestController.DatabaseServer=f["return"];else{console.log("FALLBACK: empty DatabaseServer --\> falling back to GatewayServer");DigiWebApp.RequestController.DatabaseServer=DigiWebApp.RequestController.GatewayServer}DigiWebApp.RequestController.DatabaseServerTimestamp=(new Date).getTime();if(typeof device==="undefined")location.host!==DigiWebApp.RequestController.DatabaseServer?
DigiWebApp.ApplicationController.nativeConfirmDialogView({title:M.I18N.l("wrongServer"),message:M.I18N.l("wrongServerMessage"),confirmButtonValue:M.I18N.l("yes"),cancelButtonValue:M.I18N.l("appZuruecksetzen"),callbacks:{confirm:{target:this,action:function(){location.href="http://"+DigiWebApp.RequestController.DatabaseServer+location.pathname}},cancel:{target:this,action:function(){DigiWebApp.ApplicationController.deleteAllData();if(typeof navigator.app!=="undefined")typeof location.origin!=="undefined"?
navigator.app.loadUrl(location.origin+location.pathname):navigator.app.loadUrl(location.protocol+"//"+location.pathname);else window.location.reload()}}}}):a(b);else a(b)};M.Request.init({url:"http://"+d+DigiWebApp.RequestController.handy2WebServicesUrl+"/empfangeUrl?firmenId="+c+"&modus=0&requestTimestamp="+M.Date.now().date.valueOf(),method:"GET",beforeSend:function(f){DigiWebApp.ApplicationController.DigiLoaderView.show(M.I18N.l("empfangeUrlLoader"));f.setRequestHeader("Cache-Control","no-cache")},
onSuccess:e,onError:function(){M.Request.init({url:"http://"+DigiWebApp.RequestController.GatewayPool+DigiWebApp.RequestController.handy2WebServicesUrl+"/empfangeUrl?firmenId="+c+"&modus=0&requestTimestamp="+M.Date.now().date.valueOf(),method:"GET",beforeSend:function(f){DigiWebApp.ApplicationController.DigiLoaderView.show(M.I18N.l("empfangeUrlLoader"));f.setRequestHeader("Cache-Control","no-cache")},onSuccess:e,onError:function(){DigiWebApp.ApplicationController.DigiLoaderView.hide();DigiWebApp.ApplicationController.proceedWithLocalData("getDatabaseServer")}}).send()}}).send()},
myRequest:null,authenticate:function(a){DigiWebApp.RequestController.getDatabaseServer(DigiWebApp.RequestController.authenticateWithDatabaseServer,a)},authenticateWithDatabaseServer:function(a){DigiWebApp.RequestController.saveCallbacks(a.success,a.error,"authenticate");var b=DigiWebApp.SettingsController.getSetting("company"),c=DigiWebApp.SettingsController.getSetting("password"),d=DigiWebApp.SettingsController.getSetting("workerId");b={url:"authentifizieren",urlParams:"firmenId="+b+"&kennwort="+
c+"&geraeteId="+d+"&geraeteTyp=2&softwareVersion="+DigiWebApp.RequestController.softwareVersion+"&requestTimestamp="+M.Date.now().date.valueOf(),loaderText:M.I18N.l("authenticateLoader"),source:"authenticate"};DigiWebApp.RequestController.makeRequest(_.extend(a,b))},endSession:function(a){this.saveCallbacks(a.success,a.error,"endSession");this.makeRequest(_.extend(a,{url:"beendeSession",urlParams:"modus=0&requestTimestamp="+M.Date.now().date.valueOf(),loaderText:M.I18N.l("logout"),source:"endSession"}))},
getActivities:function(a){this.saveCallbacks(a.success,a.error,"getActivities");this.makeRequest(_.extend(a,{url:"empfangeTaetigkeiten",urlParams:"modus=1&requestTimestamp="+M.Date.now().date.valueOf(),loaderText:M.I18N.l("getActivitiesLoader"),source:"getActivities",leaveLoaderOpen:YES}))},getOrders:function(a){this.saveCallbacks(a.success,a.error,"getOrders");this.makeRequest(_.extend(a,{url:"empfangeAuftraege",urlParams:"modus=0&requestTimestamp="+M.Date.now().date.valueOf(),loaderText:M.I18N.l("getOrdersLoader"),
source:"getOrders",leaveLoaderOpen:YES}))},getFeatures:function(a){this.saveCallbacks(a.success,a.error,"getFeatures");this.makeRequest(_.extend(a,{url:"empfangeKonfiguration",urlParams:"modus=0&requestTimestamp="+M.Date.now().date.valueOf(),loaderText:M.I18N.l("getFeaturesLoader"),source:"getFeatures",leaveLoaderOpen:YES}))},getPositions:function(a){this.saveCallbacks(a.success,a.error,"getPositions");this.makeRequest(_.extend(a,{url:"empfangePositionenInfo",urlParams:"modus=0&requestTimestamp="+
M.Date.now().date.valueOf(),loaderText:M.I18N.l("getPositionsLoader"),source:"getPositions",leaveLoaderOpen:YES}))},getWorkPlans:function(a){this.saveCallbacks(a.success,a.error,"getWorkPlans");this.makeRequest(_.extend(a,{isWorkPlanRequest:YES,url:"empfangeArbeitsplanNeu",urlParams:"modus=0&requestTimestamp="+M.Date.now().date.valueOf(),loaderText:M.I18N.l("getWorkPlansLoader"),source:"getWorkPlans",leaveLoaderOpen:YES}))},getHandOrders:function(a){this.saveCallbacks(a.success,a.error,"getHandOrders");
this.makeRequest(_.extend(a,{url:"empfangeHandauftraege",urlParams:"modus=0&requestTimestamp="+M.Date.now().date.valueOf(),loaderText:M.I18N.l("getHandOrdersLoader"),source:"getHandOrders",leaveLoaderOpen:YES}))},getKolonne:function(a){this.saveCallbacks(a.success,a.error,"getKolonne");this.makeRequest(_.extend(a,{isKolonnenRequest:YES,url:"empfangeKolonne",urlParams:"modus=0&requestTimestamp="+M.Date.now().date.valueOf(),loaderText:M.I18N.l("getKolonne"),source:"getKolonne",leaveLoaderOpen:YES}))},
buildDataBodyConfiguration:function(a){var b="";a=typeof a==="object"&&!_.isArray(a)?[a]:a;var c=+new Date;if(_.isArray(a))for(var d in a){var e=a[d],f;for(f in e.record){var g="   <tran:konfigurationHandy>\n       <xsd:keyId><keyId></xsd:keyId>\n       <xsd:value><value></xsd:value>\n       <xsd:valueType><valueType></xsd:valueType>\n       <xsd:mitarbeiter><mitarbeiter></xsd:mitarbeiter>\n       <xsd:timestamp><timestamp></xsd:timestamp>\n   </tran:konfigurationHandy>\n";if(!(f==="_createdAt"||
f==="_updatedAt")){g=g.replace(/<keyId>/,f);g=g.replace(/<value>/,e.get(f));g=g.replace(/<valueType>/,"SettingRemote_WebApp");g=g.replace(/<mitarbeiter>/,DigiWebApp.SettingsController.getSetting("workerId"));g=g.replace(/<timestamp>/,c);b+=g}}}for(;b.match(/><.*<\/xsd:/)!==null;)b=b.replace(/><.*<\/xsd:/,"></xsd:");return b},sendConfiguration:function(a){this.authenticate({success:{target:this,action:function(){var b=this;this.saveCallbacks(a.success,a.error,"sendConfiguration");var c='<soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/" xmlns:tran="http://transfer.webservice.handy2.digi.de" xmlns:xsd="http://transferClasses.data.handy2.digi.de/xsd"><soapenv:Header/><soapenv:Body><tran:sendeKonfiguration>';
c+=this.buildDataBodyConfiguration(a.settings);c+="   <tran:modus>0</tran:modus></tran:sendeKonfiguration></soapenv:Body></soapenv:Envelope>";M.Request.init({url:"http://"+DigiWebApp.RequestController.DatabaseServer+DigiWebApp.RequestController.handy2WebServicesUrl+".DatenTransferHttpSoap11Endpoint/",method:"POST",data:c,timeout:15E3,contentType:"text/xml; charset=UTF-8",dataType:"xml",beforeSend:function(d){a.loaderText?DigiWebApp.ApplicationController.DigiLoaderView.show(a.loaderText):DigiWebApp.ApplicationController.DigiLoaderView.show(M.I18N.l("sendConfigurationMsg"));
d.setRequestHeader("SOAPAction","urn:sendeKonfiguration");d.setRequestHeader("Content-Type","text/xml;charset=UTF-8")},onSuccess:function(d,e,f){b.endSession({success:{target:b,action:function(){DigiWebApp.ApplicationController.DigiLoaderView.hide();this.bindToCaller(this,this.handleSuccessCallback,[d,e,f,null,null,"sendConfiguration"])();DigiWebApp.ApplicationController.authenticate()}},error:{target:b,action:function(){DigiWebApp.ApplicationController.DigiLoaderView.hide();this.bindToCaller(this,
this.handleSuccessCallback,[d,e,f,null,null,"sendConfiguration"])();DigiWebApp.ApplicationController.authenticate()}}})},onError:function(d,e){b.endSession({success:{target:b,action:function(){DigiWebApp.ApplicationController.DigiLoaderView.hide();b.bindToCaller(b,b.handleErrorCallback,[d,e,"sendConfiguration"])();DigiWebApp.ApplicationController.authenticate()}},error:{target:b,action:function(){DigiWebApp.ApplicationController.DigiLoaderView.hide();b.bindToCaller(b,b.handleErrorCallback,[d,e,"sendConfiguration"])();
DigiWebApp.ApplicationController.authenticate()}}})}}).send()}},error:{target:this,action:function(){DigiWebApp.ApplicationController.authenticate();trackError("ConnectionError while sendConfiguration")}}})},handleSuccessCallback:function(a,b,c,d,e,f){var g=null;if(!d&&!e)g=this.transformResultToJson(a);else if(d)g=this.transformWorkPlanXmlToJson(a);else if(e)g=this.transformKolonneXmlToJson(a);M.EventDispatcher.checkHandler(this.successCallback[f]);this.successCallback[f].target=this.successCallback[f].target||
this;this.bindToCaller(this.successCallback[f].target,this.successCallback[f].action,[g,b,c])()},handleErrorCallback:function(a,b,c){M.EventDispatcher.checkHandler(this.errorCallback[c]);this.errorCallback[c].target=this.errorCallback[c].target||this;this.bindToCaller(this.errorCallback[c].target,this.errorCallback[c].action,[a,b])()},saveCallbacks:function(a,b,c){if(a)this.successCallback[c]=a;if(b)this.errorCallback[c]=b},transformResultToJson:function(a){return $.xml2json(a)},transformWorkPlanXmlToJson:function(a){var b=
{};b["return"]=[];a=$.parseXML(a);YES||$(a).find("return").length!==a.documentElement.childNodes.length?_.forEach(a.documentElement.childNodes,function(c){var d={};d.positionen=[];d.taetigkeitsIds=[];for(var e=(c.childNodes.length-2)/2,f=c.childNodes[0].childNodes[0].nodeValue,g=c.childNodes[1].childNodes[0].nodeValue,i=2;i<e+2;i++){var h=c.childNodes[i].childNodes[0].nodeValue,j=c.childNodes[i+e].childNodes[0].nodeValue;d.arbeitsplanId=f;d.arbeitsplanTyp=g;d.positionen.push(h);d.taetigkeitsIds.push(j)}b["return"].push(d)}):
$(a).find("return").each(function(c,d){var e={};$(d).find('[localName$="arbeitsplanId"]').each(function(f,g){e.arbeitsplanId=$(g).text()});$(d).find('[localName$="arbeitsplanTyp"]').each(function(f,g){e.arbeitsplanTyp=$(g).text()});e.positionen=[];$(d).find('[localName$="positionTaetigkeit"]').each(function(f,g){e.positionen.push($(g).text())});e.taetigkeitsIds=[];$(d).find('[localName$="tateigkeitId"]').each(function(f,g){e.taetigkeitsIds.push($(g).text())});b["return"].push(e)});return b},transformKolonneXmlToJson:function(a){var b=
{};b["return"]=[];a=$.parseXML(a);YES||$(a).find("return").length!==a.documentElement.childNodes.length?_.forEach(a.documentElement.childNodes,function(d){var e={};e.mitarbeiterIds=[];e.mitarbeiterName=[];for(var f=(d.childNodes.length-1)/2,g=d.childNodes[0].childNodes[0].nodeValue,i=1;i<=f;i++){var h=d.childNodes[i].childNodes[0].nodeValue,j=d.childNodes[i+f].childNodes[0].nodeValue;e.kolonnenId=g;e.mitarbeiterIds.push(h);e.mitarbeiterName.push(j)}b["return"]=e}):$(a).find("return").each(function(d,
e){var f={};$(e).find('[nodeName$="kolonnenId"]').each(function(g,i){f.kolonnenId=$(i).text()});f.mitarbeiterIds=[];$(e).find('[nodeName$="mitarbeiterId"]').each(function(g,i){f.mitarbeiterIds.push($(i).text())});f.mitarbeiterName=[];$(e).find('[nodeName$="mitarbeiterName"]').each(function(g,i){f.mitarbeiterName.push($(i).text())});b["return"]=f});if(b["return"]&&b["return"].mitarbeiterIds){a=[];for(var c in b["return"].mitarbeiterIds)a.push({kolonnenId:b["return"].kolonnenId,id:b["return"].mitarbeiterIds[c],
name:b["return"].mitarbeiterName[c]});b["return"]=a;return b}else return null},connectionError:function(){DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("connectionError"),message:M.I18N.l("connectionErrorMsg")})}});
DigiWebApp.ScholppBookingController=M.Controller.extend({resetButtons:function(){var a=$("#"+DigiWebApp.BookingPageWithIconsScholpp.content.fahrzeit_arbeitszeit_spezial_ButtonGrid.fahrzeitButtonGrid.button.id)[0],b=$("#"+DigiWebApp.BookingPageWithIconsScholpp.content.fahrzeit_arbeitszeit_spezial_ButtonGrid.arbeitszeitButtonGrid.button.id)[0],c=$("#"+DigiWebApp.BookingPageWithIconsScholpp.content.fahrzeit_arbeitszeit_spezial_ButtonGrid.spezialButtonGrid.button.id)[0],d=$("#"+DigiWebApp.BookingPageWithIconsScholpp.content.unterbrechung_pause_arbeitsende_ButtonGrid.unterbrechungButtonGrid.button.id)[0],
e=$("#"+DigiWebApp.BookingPageWithIconsScholpp.content.unterbrechung_pause_arbeitsende_ButtonGrid.pauseButtonGrid.button.id)[0],f=$("#"+DigiWebApp.BookingPageWithIconsScholpp.content.unterbrechung_pause_arbeitsende_ButtonGrid.arbeitsendeButtonGrid.button.id)[0];a.classList.remove("buttonSelected");b.classList.remove("buttonSelected");c.classList.remove("buttonSelected");d.classList.remove("buttonSelected");e.classList.remove("buttonSelected");f.classList.remove("buttonSelected")},sleepFor:500,bucheFahrzeitTimeoutvar:null,
bucheFahrzeit:function(){var a=DigiWebApp.SelectionController.getActivities();a=_.map(a,function(b){if(typeof b==="undefined"){console.log("UNDEFINED ACTIVITY");return null}else{var c=null;return c=b.get("name").indexOf("Reisezeit")>=0||b.get("name").indexOf("Fahrzeit")>=0?{label:b.get("name"),value:b.get("id"),isSelected:YES}:{label:b.get("name"),value:b.get("id")}}});DigiWebApp.SelectionController.set("activities",a);if(DigiWebApp.BookingController.checkBooking()){DigiWebApp.ScholppBookingController.selectFahrzeit();
DigiWebApp.ScholppBookingController.bucheFahrzeitTimeoutvar=setTimeout("DigiWebApp.ScholppBookingController.doBucheFahrzeit()",this.sleepFor)}},doBucheFahrzeit:function(){DigiWebApp.ScholppBookingController.bucheFahrzeitTimeoutvar!==null&&clearTimeout(DigiWebApp.ScholppBookingController.bucheFahrzeitTimeoutvar);DigiWebApp.BookingController.book();DigiWebApp.SelectionController.saveSelection()},bucheArbeitszeitTimeoutvar:null,bucheArbeitszeit:function(){var a=DigiWebApp.SelectionController.getActivities();
a=_.map(a,function(b){if(typeof b==="undefined"){console.log("UNDEFINED ACTIVITY");return null}else{var c=null;return c=b.get("name").indexOf("Arbeitszeit")>=0?{label:b.get("name"),value:b.get("id"),isSelected:YES}:{label:b.get("name"),value:b.get("id")}}});DigiWebApp.SelectionController.set("activities",a);if(DigiWebApp.BookingController.checkBooking()){DigiWebApp.ScholppBookingController.selectArbeitszeit();DigiWebApp.ScholppBookingController.bucheArbeitszeitTimeoutvar=setTimeout("DigiWebApp.ScholppBookingController.doBucheArbeitszeit()",
this.sleepFor)}},doBucheArbeitszeit:function(){DigiWebApp.ScholppBookingController.bucheArbeitszeitTimeoutvar!==null&&clearTimeout(DigiWebApp.ScholppBookingController.bucheArbeitszeitTimeoutvar);DigiWebApp.BookingController.book();DigiWebApp.SelectionController.saveSelection()},bucheUnterbrechungTimeoutvar:null,bucheUnterbrechung:function(){var a=DigiWebApp.SelectionController.getActivities();a=_.map(a,function(b){if(typeof b==="undefined"){console.log("UNDEFINED ACTIVITY");return null}else{var c=
null;return c=b.get("name").indexOf("Unterbrechung")>=0?{label:b.get("name"),value:b.get("id"),isSelected:YES}:{label:b.get("name"),value:b.get("id")}}});DigiWebApp.SelectionController.set("activities",a);if(DigiWebApp.BookingController.checkBooking()){DigiWebApp.ScholppBookingController.selectUnterbrechung();DigiWebApp.ScholppBookingController.bucheUnterbrechungTimeoutvar=setTimeout("DigiWebApp.ScholppBookingController.doBucheUnterbrechung()",this.sleepFor)}},doBucheUnterbrechung:function(){DigiWebApp.ScholppBookingController.bucheUnterbrechungTimeoutvar!==
null&&clearTimeout(DigiWebApp.ScholppBookingController.bucheUnterbrechungTimeoutvar);DigiWebApp.BookingController.book();DigiWebApp.SelectionController.saveSelection()},buchePauseTimeoutvar:null,buchePause:function(){var a=DigiWebApp.SelectionController.getActivities();a=_.map(a,function(b){if(typeof b==="undefined"){console.log("UNDEFINED ACTIVITY");return null}else{var c=null;return c=b.get("name").indexOf("Pause")>=0?{label:b.get("name"),value:b.get("id"),isSelected:YES}:{label:b.get("name"),value:b.get("id")}}});
DigiWebApp.SelectionController.set("activities",a);if(DigiWebApp.BookingController.checkBooking()){DigiWebApp.ScholppBookingController.selectPause();DigiWebApp.ScholppBookingController.buchePauseTimeoutvar=setTimeout("DigiWebApp.ScholppBookingController.doBuchePause()",this.sleepFor)}},doBuchePause:function(){DigiWebApp.ScholppBookingController.buchePauseTimeoutvar!==null&&clearTimeout(DigiWebApp.ScholppBookingController.buchePauseTimeoutvar);DigiWebApp.BookingController.book();DigiWebApp.SelectionController.saveSelection()},
bucheArbeitsendeTimeoutvar:null,bucheArbeitsende:function(){DigiWebApp.ScholppBookingController.selectArbeitsende();DigiWebApp.ScholppBookingController.bucheArbeitsendeTimeoutvar=setTimeout("DigiWebApp.ScholppBookingController.doBucheArbeitsende()",this.sleepFor)},doBucheArbeitsende:function(){DigiWebApp.ScholppBookingController.bucheArbeitsendeTimeoutvar!==null&&clearTimeout(DigiWebApp.ScholppBookingController.bucheArbeitsendeTimeoutvar);DigiWebApp.BookingController.closeDay();DigiWebApp.SelectionController.resetSelection()},
selectFahrzeit:function(){DigiWebApp.ScholppBookingController.resetButtons();$("#"+DigiWebApp.BookingPageWithIconsScholpp.content.fahrzeit_arbeitszeit_spezial_ButtonGrid.fahrzeitButtonGrid.button.id)[0].classList.add("buttonSelected")},selectArbeitszeit:function(){DigiWebApp.ScholppBookingController.resetButtons();$("#"+DigiWebApp.BookingPageWithIconsScholpp.content.fahrzeit_arbeitszeit_spezial_ButtonGrid.arbeitszeitButtonGrid.button.id)[0].classList.add("buttonSelected")},selectUnterbrechung:function(){DigiWebApp.ScholppBookingController.resetButtons();
$("#"+DigiWebApp.BookingPageWithIconsScholpp.content.unterbrechung_pause_arbeitsende_ButtonGrid.unterbrechungButtonGrid.button.id)[0].classList.add("buttonSelected")},selectPause:function(){DigiWebApp.ScholppBookingController.resetButtons();$("#"+DigiWebApp.BookingPageWithIconsScholpp.content.unterbrechung_pause_arbeitsende_ButtonGrid.pauseButtonGrid.button.id)[0].classList.add("buttonSelected")},selectArbeitsende:function(){DigiWebApp.ScholppBookingController.resetButtons();$("#"+DigiWebApp.BookingPageWithIconsScholpp.content.unterbrechung_pause_arbeitsende_ButtonGrid.arbeitsendeButtonGrid.button.id)[0].classList.add("buttonSelected")}});
DigiWebApp.SelectionController=M.Controller.extend({orders:null,positions:null,activities:null,selections:{order:null,position:null,activity:null,uebernachtungskennzeichenScholpp:null,spesenkennzeichenScholpp:null},useSelections:NO,showHandOrderFirst:NO,uebernachtungskennzeichenScholpp:null,spesenkennzeichenScholpp:null,setSelectionByPreviousSelection:function(){var a=JSON.parse(JSON.stringify(this.selections));this.resetSelection();var b=DigiWebApp.HandOrder.findSorted().concat(DigiWebApp.Order.findSorted()),
c=NO;b=_.map(b,function(g){if(g){g={label:g.get("name"),value:g.get("id")};if(g.value===a.order)c=g.isSelected=YES;return g}});b=_.compact(b);DigiWebApp.SettingsController.featureAvailable("416")?b.push({label:M.I18N.l("order"),value:"0",isSelected:!c}):b.push({label:M.I18N.l("selectSomething"),value:"0",isSelected:!c});this.set("orders",b);b=M.ViewManager.getView("bookingPage","order").getSelection(YES);if(b.label==b.value||isGUID(b.value))try{$("#"+DigiWebApp.BookingPage.content.position.id+"_container").hide()}catch(d){trackError(d)}else try{$("#"+
DigiWebApp.BookingPage.content.position.id+"_container").show()}catch(e){trackError(e)}this.setPositions();c=NO;b=_.map(this.get("positions"),function(g){if(g){g={label:g.label,value:g.value};if(g.value===a.position)c=g.isSelected=YES;return g}});b=_.compact(b);this.set("positions",b);this.setActivities(YES);c=NO;b=_.map(this.get("activities"),function(g){if(typeof g==="undefined")console.log("UNDEFINED ACTIVITY");else{g={label:g.label,value:g.value};if(g.value===a.activity)c=g.isSelected=YES;return g}});
b=_.compact(b);this.set("activities",b);if(DigiWebApp.SettingsController.featureAvailable("419")){c=NO;b=_.map(this.uebernachtungskennzeichenScholpp,function(g){if(typeof g==="undefined")console.log("UNDEFINED uebernachtungskennzeichenScholpp");else{g={label:g.label,value:g.value};if(g.value===a.uebernachtungskennzeichenScholpp)c=g.isSelected=YES;return g}});b=_.compact(b);this.set("uebernachtungskennzeichenScholpp",b);this.saveSelection()}typeof DigiWebAppOrdinaryDesign.bookingPageWithIconsScholpp!==
"undefined"&&DigiWebApp.ScholppBookingController.resetButtons();if(typeof DigiWebAppOrdinaryDesign.bookingPageWithIconsScholpp!=="undefined"){var f=M.ViewManager.getView("bookingPageWithIconsScholpp","activity").getSelection(YES);DigiWebApp.BookingController.currentBooking||(f=null);if(typeof f!=="undefined"&&f!=null)if(b=_.find(DigiWebApp.Activity.find(),function(g){return parseIntRadixTen(g.get("id"))===f.value})){b=b.get("name");if(b.indexOf("Reisezeit")>=0||b.indexOf("Fahrzeit")>=0)DigiWebApp.ScholppBookingController.selectFahrzeit();
else if(b.indexOf("Arbeitszeit")>=0)DigiWebApp.ScholppBookingController.selectArbeitszeit();else if(b.indexOf("Unterbrechung")>=0)DigiWebApp.ScholppBookingController.selectUnterbrechung();else b.indexOf("Pause")>=0?DigiWebApp.ScholppBookingController.selectPause():DigiWebApp.ScholppBookingController.selectArbeitsende()}else DigiWebApp.ScholppBookingController.selectArbeitsende();else DigiWebApp.ScholppBookingController.selectArbeitsende()}},setSelectionWithCurrentHandOrderFirst:function(){var a=DigiWebApp.HandOrder.findSorted().concat(DigiWebApp.Order.findSorted()),
b=DigiWebApp.SelectionController.getActivities(),c=NO,d=_.map(a,function(j){if(j){j={label:j.get("name"),value:j.get("id")};if(j.label===DigiWebApp.HandOrderController.currentHandOrderName)c=j.isSelected=YES;else j.isSelected=NO;return j}});d=_.compact(d);DigiWebApp.SettingsController.featureAvailable("419")?d.push({label:M.I18N.l("order"),value:"0",isSelected:!c}):d.push({label:M.I18N.l("selectSomething"),value:"0",isSelected:!c});a=[];a.push({label:M.I18N.l("noData"),value:"0",isSelected:YES});
var e=0;b=_.map(b,function(j){if(typeof j==="undefined"){console.log("UNDEFINED ACTIVITY");return null}else{var l=null;if(e===0){c=YES;l={label:j.get("name"),value:j.get("id"),isSelected:YES}}else l={label:j.get("name"),value:j.get("id")};e++;return l}});b=_.compact(b);DigiWebApp.SettingsController.featureAvailable("419")?b.push({label:M.I18N.l("activity"),value:"0",isSelected:!c}):b.push({label:M.I18N.l("selectSomething"),value:"0",isSelected:!c});this.resetSelection();if(DigiWebApp.SettingsController.featureAvailable("419")){c=
NO;var f=_.map(this.uebernachtungskennzeichenScholpp,function(j){if(typeof j==="undefined")console.log("UNDEFINED uebernachtungskennzeichenScholpp");else{j={label:j.label,value:j.value};if(parseIntRadixTen(j.value)===6)c=j.isSelected=YES;return j}});f=_.compact(f);this.set("uebernachtungskennzeichenScholpp",f);this.saveSelection()}this.set("orders",d);d=M.ViewManager.getView("bookingPage","order").getSelection(YES);if(d.label==d.value||isGUID(d.value))try{$("#"+DigiWebApp.BookingPage.content.position.id+
"_container").hide()}catch(g){trackError(g)}else try{$("#"+DigiWebApp.BookingPage.content.position.id+"_container").show()}catch(i){trackError(i)}this.set("positions",a);this.set("activities",b);if(typeof DigiWebAppOrdinaryDesign.bookingPageWithIconsScholpp!=="undefined"){M.ViewManager.getView("bookingPageWithIconsScholpp","position").setSelection("0");DigiWebApp.ScholppBookingController.resetButtons()}else M.ViewManager.getView("bookingPage","position").setSelection("0");if(typeof DigiWebAppOrdinaryDesign.bookingPageWithIconsScholpp!==
"undefined"){var h=M.ViewManager.getView("bookingPageWithIconsScholpp","activity").getSelection(YES);DigiWebApp.BookingController.currentBooking||(h=null);if(typeof h!=="undefined"&&h!=null){a=_.find(DigiWebApp.Activity.find(),function(j){return parseIntRadixTen(j.get("id"))===h.value});if(typeof a==="undefined")DigiWebApp.ScholppBookingController.selectArbeitsende();else{a=a.get("name");if(a.indexOf("Reisezeit")>=0||a.indexOf("Fahrzeit")>=0)DigiWebApp.ScholppBookingController.selectFahrzeit();else if(a.indexOf("Arbeitszeit")>=
0)DigiWebApp.ScholppBookingController.selectArbeitszeit();else if(a.indexOf("Unterbrechung")>=0)DigiWebApp.ScholppBookingController.selectUnterbrechung();else a.indexOf("Pause")>=0&&DigiWebApp.ScholppBookingController.selectPause()}}}},setSelectionByCurrentBooking:function(){this.resetSelection();var a=DigiWebApp.BookingController.currentBooking,b=DigiWebApp.HandOrder.findSorted().concat(DigiWebApp.Order.findSorted()),c=(a.get("orderId")=="0"?0:a.get("orderId"))||a.get("handOrderId"),d=a.get("positionId"),
e=a.get("activityId"),f=a.get("uebernachtungAuswahl");a=_.map(b,function(l){if(l)return l.get("id")==c?{label:l.get("name"),value:l.get("id"),isSelected:YES}:{label:l.get("name"),value:l.get("id")}});a=_.compact(a);DigiWebApp.SettingsController.featureAvailable("419")?a.push({label:M.I18N.l("order"),value:"0",isSelected:!h}):a.push({label:M.I18N.l("selectSomething"),value:"0",isSelected:!h});this.set("orders",a);a=M.ViewManager.getView("bookingPage","order").getSelection(YES);if(a.label==a.value||
isGUID(a.value))try{$("#"+DigiWebApp.BookingPage.content.position.id+"_container").hide()}catch(g){trackError(g)}else try{$("#"+DigiWebApp.BookingPage.content.position.id+"_container").show()}catch(i){trackError(i)}this.setPositions();a=_.map(this.get("positions"),function(l){if(l)return parseIntRadixTen(l.value)===parseIntRadixTen(d)?{label:l.label,value:l.value,isSelected:YES}:{label:l.label,value:l.value}});a=_.compact(a);DigiWebApp.SettingsController.featureAvailable("416")?a.push({label:M.I18N.l("position"),
value:"0",isSelected:!h}):a.push({label:M.I18N.l("selectSomething"),value:"0",isSelected:!h});this.set("positions",a);this.setActivities(YES);var h=NO;a=_.map(this.get("activities"),function(l){if(typeof l==="undefined"){console.log("UNDEFINED ACTIVITY");return null}else{var n=null;if(parseIntRadixTen(l.value)==parseIntRadixTen(e)){n={label:l.label,value:l.value,isSelected:YES};h=YES}else n={label:l.label,value:l.value};return n}});a=_.compact(a);DigiWebApp.SettingsController.featureAvailable("419")?
a.push({label:M.I18N.l("activity"),value:"0",isSelected:!h}):a.push({label:M.I18N.l("selectSomething"),value:"0",isSelected:!h});this.set("activities",a);if(typeof DigiWebAppOrdinaryDesign.bookingPageWithIconsScholpp!=="undefined"){var j=M.ViewManager.getView("bookingPageWithIconsScholpp","activity").getSelection(YES);DigiWebApp.BookingController.currentBooking||(j=null);if(typeof j!=="undefined"&&j!=null){a=_.find(DigiWebApp.Activity.find(),function(l){return parseIntRadixTen(l.get("id"))===j.value});
if(typeof a==="undefined"){f="6";DigiWebApp.ScholppBookingController.selectArbeitsende()}else{a=a.get("name");if(a.indexOf("Reisezeit")>=0||a.indexOf("Fahrzeit")>=0)DigiWebApp.ScholppBookingController.selectFahrzeit();else if(a.indexOf("Arbeitszeit")>=0){f="6";DigiWebApp.ScholppBookingController.selectArbeitszeit()}else if(a.indexOf("Unterbrechung")>=0){f="6";DigiWebApp.ScholppBookingController.selectUnterbrechung()}else if(a.indexOf("Pause")>=0){f="6";DigiWebApp.ScholppBookingController.selectPause()}else{f=
"6";DigiWebApp.ScholppBookingController.selectArbeitsende()}}}else{f="6";DigiWebApp.ScholppBookingController.selectArbeitsende()}}if(DigiWebApp.SettingsController.featureAvailable("419")){h=NO;a=_.map(this.uebernachtungskennzeichenScholpp,function(l){if(typeof l==="undefined")console.log("UNDEFINED uebernachtungskennzeichenScholpp");else{l={label:l.label,value:l.value};if(l.value===f)h=l.isSelected=YES;return l}});a=_.compact(a);this.set("uebernachtungskennzeichenScholpp",a);this.saveSelection()}},
setPositions:function(){var a;if(typeof DigiWebAppOrdinaryDesign.bookingPageWithIconsScholpp!=="undefined"){a=M.ViewManager.getView("bookingPageWithIconsScholpp","order").getSelection(YES).value;M.ViewManager.getView("bookingPageWithIconsScholpp","uebernachtungskennzeichen").resetSelection();M.ViewManager.getView("bookingPageWithIconsScholpp","uebernachtungskennzeichen").setSelection("6")}else a=M.ViewManager.getView("bookingPage","order").getSelection(YES).value;if(a){if(DigiWebApp.SettingsController.featureAvailable("406")&&
DigiWebApp.SettingsController.getSetting("auftragsDetailsKoppeln")){typeof M.ViewManager.getView("orderInfoPage","order").getSelection()==="undefined"&&DigiWebApp.OrderInfoController.init();M.ViewManager.getView("orderInfoPage","order").setSelection(a);DigiWebApp.OrderInfoController.setPositions();DigiWebApp.OrderInfoController.setItem()}var b=DigiWebApp.Position.findSorted(),c=0;b=_.map(b,function(d){if(d){if(parseIntRadixTen(d.get("orderId"))===parseIntRadixTen(a)){d={label:d.get("name"),value:d.get("id")};
if(c===0)d.isSelected=YES;c+=1;return d}return null}});b=_.compact(b);b.length<1&&b.push({label:M.I18N.l("noData"),value:"0"});typeof DigiWebAppOrdinaryDesign.bookingPageWithIconsScholpp!=="undefined"?M.ViewManager.getView("bookingPageWithIconsScholpp","position").resetSelection():M.ViewManager.getView("bookingPage","position").resetSelection();this.set("positions",b);this.setActivities(YES);this.saveSelection()}},setActivities:function(a){var b=null,c=[],d=0;if(a)if(a=typeof DigiWebAppOrdinaryDesign.bookingPageWithIconsScholpp!==
"undefined"?M.ViewManager.getView("bookingPageWithIconsScholpp","position").getSelection(YES):M.ViewManager.getView("bookingPage","position").getSelection(YES))b=a.value;if(b){if(DigiWebApp.SettingsController.featureAvailable("406")&&DigiWebApp.SettingsController.getSetting("auftragsDetailsKoppeln")){typeof M.ViewManager.getView("orderInfoPage","position").getSelection()==="undefined"&&DigiWebApp.OrderInfoController.init();M.ViewManager.getView("orderInfoPage","position").setSelection(b);DigiWebApp.OrderInfoController.setItem()}var e=
[];_.each(DigiWebApp.WorkPlan.find(),function(i){parseIntRadixTen(i.get("id"))===parseIntRadixTen(b)&&e.push(i)});d=0;c=e.length===1?DigiWebApp.SelectionController.getActivitiesFromWorkplan(e[0]):DigiWebApp.SelectionController.getActivities()}else c=DigiWebApp.SelectionController.getActivities();var f=-1;if(typeof DigiWebApp.BookingController.currentBooking!=="undefined"&&DigiWebApp.BookingController.currentBooking!==null)f=DigiWebApp.BookingController.currentBooking.get("activityId");var g=false;
_.each(c,function(i){if(typeof i==="undefined"){console.log("UNDEFINED ACTIVITY");return null}else if(parseIntRadixTen(i.get("id"))===parseIntRadixTen(f))g=true});c=_.map(c,function(i){if(typeof i==="undefined"){console.log("UNDEFINED ACTIVITY");return null}else{var h=null;h=g?{label:i.get("name"),value:i.get("id"),isSelected:i.get("id")==f?YES:NO}:{label:i.get("name"),value:i.get("id"),isSelected:d===0?YES:NO};d+=1;return h}});c=_.compact(c);if(c.length>0)DigiWebApp.SettingsController.featureAvailable("419")?
c.push({label:M.I18N.l("activity"),value:"0",isSelected:NO}):c.push({label:M.I18N.l("selectSomething"),value:"0",isSelected:NO});else c.push({label:M.I18N.l("noData"),value:"0"});if(typeof DigiWebAppOrdinaryDesign.bookingPageWithIconsScholpp!=="undefined"){M.ViewManager.getView("bookingPageWithIconsScholpp","activity").resetSelection();this.set("activities",c);DigiWebApp.ScholppBookingController.resetButtons()}else{M.ViewManager.getView("bookingPage","activity").resetSelection();this.set("activities",
c)}this.saveSelection()},initSelection:function(){var a=DigiWebApp.HandOrder.findSorted().concat(DigiWebApp.Order.findSorted()),b=DigiWebApp.Position.findSorted(),c=DigiWebApp.SelectionController.getActivities(),d=[];if(a)d=_.map(a,function(f){if(f)return{label:f.get("name"),value:f.get("id")}});DigiWebApp.SettingsController.featureAvailable("416")?d.push({label:M.I18N.l("order"),value:"0",isSelected:YES}):d.push({label:M.I18N.l("selectSomething"),value:"0",isSelected:YES});d=_.compact(d);a=[];if(b)a=
_.map(b,function(f){if(f)return{label:f.get("name"),value:f.get("id")}});DigiWebApp.SettingsController.featureAvailable("416")?a.push({label:M.I18N.l("position"),value:"0",isSelected:YES}):a.push({label:M.I18N.l("selectSomething"),value:"0",isSelected:YES});a=_.compact(a);b=[];if(c)b=_.map(c,function(f){if(typeof f==="undefined"){console.log("UNDEFINED ACTIVITY");return null}else return{label:f.get("name"),value:f.get("id")}});DigiWebApp.SettingsController.featureAvailable("419")?b.push({label:M.I18N.l("activity"),
value:"0",isSelected:YES}):b.push({label:M.I18N.l("selectSomething"),value:"0",isSelected:YES});b=_.compact(b);this.resetSelection();this.set("orders",d);this.set("positions",a);this.set("activities",b);try{if(typeof DigiWebAppOrdinaryDesign.bookingPageWithIconsScholpp!=="undefined"){M.ViewManager.getView("bookingPageWithIconsScholpp","uebernachtungskennzeichen").setSelection("6");M.ViewManager.getView("bookingPageWithIconsScholpp","order").setSelection("0");M.ViewManager.getView("bookingPageWithIconsScholpp",
"position").setSelection("0");M.ViewManager.getView("bookingPageWithIconsScholpp","activity").setSelection("0");DigiWebApp.ScholppBookingController.resetButtons()}else{M.ViewManager.getView("bookingPage","order").setSelection("0");M.ViewManager.getView("bookingPage","position").setSelection("0");M.ViewManager.getView("bookingPage","activity").setSelection("0")}}catch(e){}},resetSelection:function(){try{if(typeof DigiWebAppOrdinaryDesign.bookingPageWithIconsScholpp!=="undefined"){M.ViewManager.getView("bookingPageWithIconsScholpp",
"uebernachtungskennzeichen").resetSelection();M.ViewManager.getView("bookingPageWithIconsScholpp","uebernachtungskennzeichen").setSelection("6");M.ViewManager.getView("bookingPageWithIconsScholpp","order").resetSelection();M.ViewManager.getView("bookingPageWithIconsScholpp","position").resetSelection();M.ViewManager.getView("bookingPageWithIconsScholpp","activity").resetSelection()}else{M.ViewManager.getView("bookingPage","order").resetSelection();M.ViewManager.getView("bookingPage","position").resetSelection();
M.ViewManager.getView("bookingPage","activity").resetSelection()}}catch(a){}},isPositionSelected:function(){var a;return(a=typeof DigiWebAppOrdinaryDesign.bookingPageWithIconsScholpp!=="undefined"?M.ViewManager.getView("bookingPageWithIconsScholpp","position").getSelection(YES):M.ViewManager.getView("bookingPage","position").getSelection(YES))&&a.value!="0"?YES:NO},isActivitySelected:function(){var a;return(a=typeof DigiWebAppOrdinaryDesign.bookingPageWithIconsScholpp!=="undefined"?M.ViewManager.getView("bookingPageWithIconsScholpp",
"activity").getSelection(YES):M.ViewManager.getView("bookingPage","activity").getSelection(YES))&&a.value!="0"?YES:NO},saveSelection:function(){var a=null,b=null,c=null,d=null,e=null;if(typeof DigiWebAppOrdinaryDesign.bookingPageWithIconsScholpp!=="undefined"){a=M.ViewManager.getView("bookingPageWithIconsScholpp","order").getSelection();b=M.ViewManager.getView("bookingPageWithIconsScholpp","position").getSelection();c=M.ViewManager.getView("bookingPageWithIconsScholpp","activity").getSelection();
d=M.ViewManager.getView("bookingPageWithIconsScholpp","uebernachtungskennzeichen").getSelection();e=M.ViewManager.getView("bookingPageWithIconsScholpp","spesenkennzeichen").getSelection()}else{a=M.ViewManager.getView("bookingPage","order").getSelection();b=M.ViewManager.getView("bookingPage","position").getSelection();c=M.ViewManager.getView("bookingPage","activity").getSelection()}this.selections.order=a;this.selections.position=b;this.selections.activity=c;this.selections.uebernachtungskennzeichenScholpp=
d;this.selections.spesenkennzeichenScholpp=e;if(!DigiWebApp.SelectionController.showHandOrderFirst)this.useSelections=YES},getActivities:function(a){a=a?DigiWebApp.Activity.find(a):DigiWebApp.Activity.findSorted();a=_.map(a,function(b){if(b)return parseIntRadixTen(b.get("positionId"))===1?b:null});return a=_.compact(a)},getActivitiesFromWorkplan:function(a){var b=a.get("activityIds").split(","),c=[];if(b&&b.length>0)for(var d=DigiWebApp.Activity.find(),e=0;e<b.length;e++){var f=_.find(d,function(g){return parseIntRadixTen(g.get("id"))===
parseIntRadixTen(b[e])});f&&c.push(f)}if(parseIntRadixTen(a.get("workplanType"))===1)c=_.map(c,function(g){if(typeof g==="undefined"){console.log("UNDEFINED ACTIVITY");return null}else{var i=NO,h=DigiWebApp.Activity.findSorted();_.each(h,function(j){if(g.get("id")===j.get("id")&&parseIntRadixTen(j.get("positionId"))===1)i=YES});return i?g:null}});return c=_.compact(c)}});
DigiWebApp.ServiceAppController=M.Controller.extend({ServiceAppCommunication:function(a,b,c){this.timeout=typeof c!=="undefined"?c:5E3;this._requestInterval=300;this.sendData=a;this.callback=b;this._requestFileName="DigiWebAppServiceApp."+(new Date).getTime()+".response.json";this.returnData=null;this.internalCallback=function(d){this.callback(d)};this.available=null;this.ermittleGeokoordinate=DigiWebApp.SettingsController.getSetting("ServiceApp_ermittleGeokoordinate");this.uebertragen=DigiWebApp.SettingsController.getSetting("ServiceApp_datenUebertragen");
this.engeKopplung=DigiWebApp.SettingsController.getSetting("ServiceApp_engeKopplung");this.debug=DigiWebApp.SettingsController.getSetting("debug");this.password=DigiWebApp.SettingsController.getSetting("password");this.workerId=DigiWebApp.SettingsController.getSetting("workerId");if(this.workerId==="")this.workerId=0;this.company=DigiWebApp.SettingsController.getSetting("company");if(this.company==="")this.company=0;this.WebAppVersion=DigiWebApp.app.config.version;this.WebAppGPSTimeout=DigiWebApp.SettingsController.getSetting("GPSTimeOut");
this.sendData.parameter={};this.send=function(){var d=this;d.sendData.parameter={ermittleGeokoordinate:this.ermittleGeokoordinate,uebertragen:this.uebertragen,engeKopplung:this.engeKopplung,debug:this.debug,fileName:this._requestFileName,kennwort:this.password,GeraeteId:this.workerId,firmenId:this.company,WebAppVersion:this.WebAppVersion,WebAppGPSTimeout:this.WebAppGPSTimeout};$.ajax({dataType:"json",type:"POST",crossDomain:true,processData:false,async:true,contentType:"application/json",url:"http://127.0.0.1:"+
DigiWebApp.SettingsController.getSetting("ServiceApp_PORT")+"/",data:JSON.stringify(a),success:function(e,f,g){d.returnHandler(e,f,g)},error:function(e,f,g){d.returnHandler(e,f,g)},timeout:1E3})};this.returnHandler=function(){var d=this;this._readFile_Interval_Counter=0;this._readFile_IntervalVar=window.setInterval(function(){d.readFileHandler()},this._requestInterval)};this.readFileHandler=function(){var d=this;this._readFile_Interval_Counter++;if(this._readFile_Interval_Counter>this.timeout/this._requestInterval){window.clearInterval(this._readFile_IntervalVar);
this._readFile_Interval_Counter=null;this.available=false;console.log(Error("@@@ ServiceApp is UNavailable !!!").stack);DigiWebApp.ApplicationController.DigiLoaderView.hide();this.callback(null)}this.readFromFile(this._requestFileName,function(e){window.clearInterval(d._readFile_IntervalVar);d.returnData=e;d.available=true;d.internalCallback(d.returnData)},function(){d.available=false})};this.readFromFile=function(d,e,f){var g;g=!f||typeof f!=="function"?function(){trackError("readFromFileError")}:
f;if(typeof e!=="function"){trackError("readFromFileError: successCallback is not a function");return false}if(!d||d&&d.length===0){trackError("readFromFileError: no fileName given");g();return false}if(typeof window.requestFileSystem==="undefined"){trackError("readFromFileError: no LocalFileSystem available");e("");return true}try{var i=DigiWebApp.ApplicationController.CONSTApplicationQuota;typeof navigator.webkitPersistentStorage!=="undefined"?navigator.webkitPersistentStorage.requestQuota(i,function(j){window.requestFileSystem(PERSISTENT,
j,function(l){l.root.getDirectory("DIGIWebAppData",{create:true,exclusive:false},function(n){n.getFile(d,null,function(m){m.file(function(o){try{var p=new FileReader;p.onloadend=function(r){e(r.target.result)};p.readAsText(o)}catch(q){}},g)},g)},g)},g)},function(){trackError("Error while requesting Quota");DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("error"),message:M.I18N.l("errorWhileRequestingQuota")+": "+err})}):window.requestFileSystem(LocalFileSystem.PERSISTENT,0,
function(j){j.root.getDirectory("DIGIWebAppData",{create:true,exclusive:false},function(l){l.getFile(d,null,function(n){n.file(function(m){try{var o=new FileReader;o.onloadend=function(q){e(q.target.result)};o.readAsText(m)}catch(p){}},g)},g)},g)},g)}catch(h){g(h)}};this.deleteFile=function(d,e,f){if(!d||d&&d.length===0){trackError("deleteFileError: no fileName given");return false}if(typeof e!=="function"){trackError("deleteFileError: successCallback is not a function");return false}var g;g=!f||
typeof f!=="function"?function(){trackError("deleteFileError")}:f;if(typeof window.requestFileSystem==="undefined"){trackError("deleteFileError: no LocalFileSystem available");e("");return true}try{var i=DigiWebApp.ApplicationController.CONSTApplicationQuota;typeof navigator.webkitPersistentStorage!=="undefined"?navigator.webkitPersistentStorage.requestQuota(i,function(j){window.requestFileSystem(PERSISTENT,j,function(l){l.root.getDirectory("DIGIWebAppData",{create:true,exclusive:false},function(n){n.getFile(d,
null,function(m){try{m.remove(e,g)}catch(o){}},g)},g)},g)},function(){trackError("Error while requesting Quota");DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("error"),message:M.I18N.l("errorWhileRequestingQuota")+": "+err})}):window.requestFileSystem(LocalFileSystem.PERSISTENT,0,function(j){j.root.getDirectory("DIGIWebAppData",{create:true,exclusive:false},function(l){l.getFile(d,null,function(n){try{n.remove(e,g)}catch(m){}},g)},g)},g)}catch(h){g(h)}};this.listDataDirectory=
function(d,e){var f;f=!e||typeof e!=="function"?function(){trackError("deleteFileError")}:e;if(typeof d!=="function"){trackError("listDataDirectoryError: successCallback is not a function");return false}if(typeof window.requestFileSystem==="undefined"){trackError("listDataDirectoryError: no LocalFileSystem available");d("");return true}try{var g=DigiWebApp.ApplicationController.CONSTApplicationQuota;typeof navigator.webkitPersistentStorage!=="undefined"?navigator.webkitPersistentStorage.requestQuota(g,
function(h){window.requestFileSystem(PERSISTENT,h,function(j){j.root.getDirectory("DIGIWebAppData",{create:true,exclusive:false},function(l){var n=l.createReader();(function(){n.readEntries(function(m){var o=[];_.each(m,function(p){p=p.fullPath.split("/");o.push(p[p.length-1])});d(o)},function(m){trackError("error in readEntries:"+m)})})()},f)},f)},function(h){trackError("Error while requesting Quota: "+h);DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("error"),message:M.I18N.l("errorWhileRequestingQuota")+
": "+err})}):window.requestFileSystem(LocalFileSystem.PERSISTENT,0,function(h){h.root.getDirectory("DIGIWebAppData",{create:true,exclusive:false},function(j){var l=j.createReader();(function(){l.readEntries(function(n){var m=[];_.each(n,function(o){o=o.fullPath.split("/");m.push(o[o.length-1])});d(m)},function(n){trackError("error in readEntries: "+n)})})()},f)},f)}catch(i){f(i)}}},listDirectory:function(a){(new DigiWebApp.ServiceAppController.ServiceAppCommunication({},a)).listDataDirectory(a)},
deleteFile:function(a,b){(new DigiWebApp.ServiceAppController.ServiceAppCommunication({},b)).deleteFile(a,b,b)},knockknock:function(a,b,c){(new DigiWebApp.ServiceAppController.ServiceAppCommunication({GET:{buchungen:[],queryParameter:null}},function(d){if(this.available)a(d);else{console.log("this.available = "+this.available);b()}},c)).send()},getBookings:function(a,b,c,d,e){a=new DigiWebApp.ServiceAppController.ServiceAppCommunication({GET:{buchungen:[],queryParameter:{ids:a}}},function(f){this.available?
b(f):c()},d);a.engeKopplung=typeof e!=="undefined"&&e===true;a.send()},deleteFilesInServiceApp:function(a,b,c,d,e){a=new DigiWebApp.ServiceAppController.ServiceAppCommunication({DELETEFILES:{files:[],queryParameter:{fileNames:a}}},function(f){this.available?b(f):c()},d);a.engeKopplung=typeof e!=="undefined"&&e===true;a.send()},pollBookings:function(a,b,c,d){DigiWebApp.ApplicationController.DigiLoaderView.show(M.I18N.l("ServiceAppKommunikation"));this.getBookings(a,function(e){try{var f=[];_.each(JSON.parse(e).GET.buchungen,
function(i){i.status==="OK"&&f.push(i.datensatz)});b(f)}catch(g){trackError(g);c(g.message)}},function(){c()},d,true)},putBookings:function(a,b,c,d){DigiWebApp.ApplicationController.DigiLoaderView.show(M.I18N.l("ServiceAppKommunikation"));var e={PUT:{buchungen:[]}};_.each(a,function(f){e.PUT.buchungen.push({datensatz:f,status:"WAIT"})});(new DigiWebApp.ServiceAppController.ServiceAppCommunication(e,function(f){this.available?b(f):c()},d)).send()},postBookings:function(a,b,c,d){DigiWebApp.ApplicationController.DigiLoaderView.show(M.I18N.l("ServiceAppKommunikation"));
var e={POST:{buchungen:[]}};_.each(a,function(f){e.POST.buchungen.push({datensatz:f,status:"WAIT"})});(new DigiWebApp.ServiceAppController.ServiceAppCommunication(e,function(f){this.available?b(f):c()},d)).send()},deleteBookings:function(a,b,c,d){DigiWebApp.ApplicationController.DigiLoaderView.show(M.I18N.l("ServiceAppKommunikation"));a=new DigiWebApp.ServiceAppController.ServiceAppCommunication({DELETE:{buchungen:[],queryParameter:{ids:a}}},function(e){this.available?b(e):c()},d);a.engeKopplung=
typeof engeKopplungOverride!=="undefined"&&engeKopplungOverride===true;a.send()},refreshWAITBookings:function(a,b,c,d){var e=this;c=DigiWebApp.Booking.find();var f=[];_.each(c,function(i){if(typeof i.get("ServiceApp_Status")=="undefined"||i.get("ServiceApp_Status")==="WAIT")f.push(i.m_id)});var g=[];if(f.length>0)e.getBookings(f,function(i){try{var h=JSON.parse(i).GET.buchungen;_.each(h,function(l){var n=l.datensatz,m=function(p,q){if(DigiWebApp.SettingsController.getSetting("ServiceApp_ermittleGeokoordinate")){var r=
q.record;typeof r.latitude!=="undefined"&&p.set("latitude",r.latitude);typeof r.latitude_bis!=="undefined"&&p.set("latitude_bis",r.latitude_bis);typeof r.longitude!=="undefined"&&p.set("longitude",r.longitude);typeof r.longitude_bis!=="undefined"&&p.set("longitude_bis",r.longitude_bis);typeof r.ermittlungsverfahren_bis!=="undefined"&&p.set("ermittlungsverfahrenBis",r.ermittlungsverfahren_bis);typeof r.ermittlungsverfahren!=="undefined"&&p.set("ermittlungsverfahrenVon",r.ermittlungsverfahren);typeof r.genauigkeit_bis!==
"undefined"&&p.set("genauigkeitBis",r.genauigkeit_bis);typeof r.genauigkeit!=="undefined"&&p.set("genauigkeitVon",r.genauigkeit);typeof r.gps_zeitstempel_bis!=="undefined"&&p.set("gps_zeitstempelBis",r.gps_zeitstempel_bis);typeof r.gps_zeitstempel!=="undefined"&&p.set("gps_zeitstempelVon",r.gps_zeitstempel);typeof r.status!=="undefined"&&p.set("ServiceApp_Status",r.status);p.save()}},o=_.find(DigiWebApp.Booking.find(),function(p){return p.m_id===n.m_id});o.set("ServiceApp_Status",l.status);o.save();
switch(l.status){case "WAIT":m(o,n);g.push(n.m_id);break;case "OK":m(o,n);break;case "SENT":if(DigiWebApp.SettingsController.getSetting("ServiceApp_datenUebertragen")){l=DigiWebApp.BookingController.sentBooking(o);l!=null&&l.save();o.del()}break;case "DELETE":o.del();break;default:b("refreshWAITBookings: Unbekannter Status")}});DigiWebApp.ApplicationController.DigiLoaderView.hide();if(g.length>0&&typeof a==="function"&&d)e.pollBookings(g,function(l){_.each(l,function(n){try{var m=_.find(DigiWebApp.Booking.find(),
function(q){return q.m_id===n.m_id}),o=n.record;m.set("latitude",o.latitude);m.set("latitude_bis",o.latitude_bis);m.set("longitude",o.longitude);m.set("longitude_bis",o.longitude_bis);m.set("ermittlungsverfahrenBis",o.ermittlungsverfahren_bis);m.set("ermittlungsverfahrenVon",o.ermittlungsverfahren);m.set("genauigkeitBis",o.genauigkeit_bis);m.set("genauigkeitVon",o.genauigkeit);m.set("gps_zeitstempelBis",o.gps_zeitstempel_bis);m.set("gps_zeitstempelVon",o.gps_zeitstempel);m.set("ServiceApp_Status",
o.status);m.save()}catch(p){}});a()},a,DigiWebApp.SettingsController.getSetting("GPSTimeOut"));else typeof a==="function"&&a()}catch(j){DigiWebApp.ApplicationController.DigiLoaderView.hide();b("ERROR in refreshWAITBookings: "+j.message)}},function(){DigiWebApp.ApplicationController.DigiLoaderView.hide();b("refreshWAITBookings: ServiceApp hat nicht geantwortet!")});else typeof a==="function"&&a()}});
DigiWebApp.SettingsController=M.Controller.extend({showCredentialsAlert:NO,credentialsAlertShown:false,showIOSMessage:true,settings:null,mitarbeiterNameVorname:"",globalDebugMode:NO,defaultsettings_object:{debug:false,treatAllAsTablet:false,treatAllAsPhone:false,company:"",password:"",connectionCode:"",settingsPassword:"digi$",workerId:"",platform:"",userAgent:"",skipEvents:"",timeouthappened:"",mapType:"Google",autoSyncAfterBookTime:false,autoTransferAfterBookTime:true,autoTransferAfterClosingDay:true,
autoSaveGPSData:false,GPSDataIsMandatory:false,remarkIsMandatory:false,remarkIsOptional:false,useTransitionsSetting:true,daysToHoldBookingsOnDevice:"40",bautagebuchLimit_autoStartUhrzeit:false,datatransfer_min_delay:1E4,branding:"",GPSTimeOut:6E4,WebserviceTimeOut:3E4,LoaderTimeOut:3E4,silentLoader:false,currentTimezoneOffset:null,currentTimezone:null,ServiceApp_ermittleGeokoordinate:false,ServiceApp_datenUebertragen:false,ServiceApp_engeKopplung:false,ServiceApp_PORT:"60000",ServiceApp_FallBack:true,
debugDatabaseServer:null,mitarbeiterVorname:"",mitarbeiterNachname:"",mitarbeiterId:"0",auftragsDetailsKoppeln:false,detailierteZeitdaten:true,vibrationsDauer:100,terminliste_keineKuenstlichenTermine:false,terminliste_ignoriereAuftragszeitraum:true,stammdatenabgleichBeimAppStart:false,festePauseStornieren_nurAktuellerTag:true,startTimeout:1E4,GPSenableHighAccuracy:NO,GPSenableHighAccuracyFallback:YES,GPSmaximumAgeMinutes:3,GPSBackgroundService:NO,BookingReminderHours:11,closeAppAfterCloseDay:YES,
DTC6aktiv:NO,useNativeLoader:YES,pictureEncodingType:"JPEG",pictureEncodingQuality:50,pictureAllowEdit:YES,mengeneingabeMitTelKeyboard:false,scrId:8367,overrideApplicationQuota:"-1",logWriterInterval:500,progressViewVerwendenAb:300,logDelete:false,logSave:false},defaultsettings:null,init:function(a,b){var c=DigiWebApp.SettingsController,d=b&&DigiWebApp.SettingsController.featureAvailable("417");M.I18N.defaultLanguage="de_de";DigiWebApp.TabBar.setActiveTab(DigiWebApp.TabBar.tabItem2);if(c.showCredentialsAlert&&
!c.credentialsAlertShown){if((M.Environment.getPlatform().substr(0,4)==="iPad"||M.Environment.getPlatform().substr(0,6)==="iPhone")&&typeof device!=="undefined"){DigiWebApp.ApplicationController.enforceChefToolOnly();console.log("device.version: "+device.version)}else DigiWebApp.ApplicationController.enforceChefToolOnly();DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("noCredentials"),message:M.I18N.l("noCredentialsMsg")});c.credentialsAlertShown=true}c.defaultsettings=DigiWebApp.Settings.createRecord(DigiWebApp.SettingsController.defaultsettings_object);
DigiWebApp.Settings.find();if(DigiWebApp.SettingsController.featureAvailable("403")){$("#"+DigiWebApp.SettingsPage.content.remarkIsMandatory.id).show();$("#"+DigiWebApp.SettingsPage.content.remarkIsOptional.id).show()}else{$("#"+DigiWebApp.SettingsPage.content.remarkIsMandatory.id).hide();$("#"+DigiWebApp.SettingsPage.content.remarkIsOptional.id).hide()}DigiWebApp.SettingsController.featureAvailable("406")?$("#"+DigiWebApp.SettingsPage.content.auftragsDetailsKoppeln.id).show():$("#"+DigiWebApp.SettingsPage.content.auftragsDetailsKoppeln.id).hide();
DigiWebApp.SettingsController.featureAvailable("411")?$("#"+DigiWebApp.SettingsPage.content.daysToHoldBookingsOnDeviceSliderContainer.id).show():$("#"+DigiWebApp.SettingsPage.content.daysToHoldBookingsOnDeviceSliderContainer.id).hide();DigiWebApp.SettingsController.featureAvailable("412")?$("#"+DigiWebApp.SettingsPage.content.bautagebuchLimit_autoStartUhrzeit.id).show():$("#"+DigiWebApp.SettingsPage.content.bautagebuchLimit_autoStartUhrzeit.id).hide();if(DigiWebApp.SettingsController.featureAvailable("423")){$("#"+
DigiWebApp.SettingsPage.content.terminlisteEinstellungen.id).show();DigiWebApp.SettingsController.set("terminlisteEinstellungen_titel",DigiWebApp.SettingsController.terminlisteEinstellungen_titel)}else $("#"+DigiWebApp.SettingsPage.content.terminlisteEinstellungen.id).hide();if(DigiWebApp.SettingsController.featureAvailable("425")){$("#"+DigiWebApp.SettingsPage.content.festePauseStornierenEinstellungen.id).show();DigiWebApp.SettingsController.set("festePauseStornierenEinstellungen_titel",DigiWebApp.SettingsController.festePauseStornierenEinstellungen_titel)}else $("#"+
DigiWebApp.SettingsPage.content.festePauseStornierenEinstellungen.id).hide();if(typeof navigator=="undefined"||typeof navigator.app=="undefined"||typeof navigator.app.exitApp!="function")try{$("[id="+DigiWebApp.SettingsPage.content.closeAppAfterCloseDay.id+"]").each(function(){$(this).hide()})}catch(e){}DigiWebApp.ApplicationController.enforceChefToolOnly();$("#"+DigiWebApp.SettingsPage.content.useTransitionsSetting.id).hide();var f=null;if(DigiWebApp.Settings.records().length>0){var g=DigiWebApp.Settings.records()[0];
(f=g.get("daysToHoldBookingsOnDevice"))||(f=DigiWebApp.SettingsController.defaultsettings.get("daysToHoldBookingsOnDevice"));var i=g.get("vibrationsDauer");if(!i){i="";try{i=device.platform.substr(0,3)}catch(h){}i=i==="iOS"?0:DigiWebApp.SettingsController.defaultsettings.get("vibrationsDauer")}var j=g.get("GPSDataIsMandatory");j||(j=DigiWebApp.SettingsController.defaultsettings.get("GPSDataIsMandatory"));var l=g.get("bautagebuchLimit_autoStartUhrzeit");l||(l=DigiWebApp.SettingsController.defaultsettings.get("bautagebuchLimit_autoStartUhrzeit"));
var n=DigiWebApp.SettingsController.defaultsettings.get("terminliste_keineKuenstlichenTermine");try{if(typeof g.record.terminliste_keineKuenstlichenTermine!=="undefined")n=g.get("terminliste_keineKuenstlichenTermine")}catch(m){}var o=DigiWebApp.SettingsController.defaultsettings.get("terminliste_ignoriereAuftragszeitraum");try{if(typeof g.record.terminliste_ignoriereAuftragszeitraum!=="undefined")o=g.get("terminliste_ignoriereAuftragszeitraum")}catch(p){}var q=DigiWebApp.SettingsController.defaultsettings.get("festePauseStornieren_nurAktuellerTag");
try{if(typeof g.record.festePauseStornieren_nurAktuellerTag!=="undefined")q=g.get("festePauseStornieren_nurAktuellerTag")}catch(r){}var s=DigiWebApp.SettingsController.defaultsettings.get("GPSenableHighAccuracy");try{if(typeof g.record.GPSenableHighAccuracy!=="undefined")s=g.get("GPSenableHighAccuracy")}catch(u){}var t=DigiWebApp.SettingsController.defaultsettings.get("GPSenableHighAccuracyFallback");try{if(typeof g.record.GPSenableHighAccuracyFallback!=="undefined")t=g.get("GPSenableHighAccuracyFallback")}catch(v){}var x=
DigiWebApp.SettingsController.defaultsettings.get("GPSmaximumAgeMinutes");try{if(typeof g.record.GPSmaximumAgeMinutes!=="undefined")x=g.get("GPSmaximumAgeMinutes")}catch(B){}var z=DigiWebApp.SettingsController.defaultsettings.get("GPSBackgroundService");try{if(typeof g.record.GPSBackgroundService!=="undefined")z=g.get("GPSBackgroundService")}catch(D){}var y=DigiWebApp.SettingsController.defaultsettings.get("BookingReminderHours");try{if(typeof g.record.BookingReminderHours!=="undefined")y=g.get("BookingReminderHours")}catch(E){}var A=
DigiWebApp.SettingsController.defaultsettings.get("closeAppAfterCloseDay");try{if(typeof g.record.closeAppAfterCloseDay!=="undefined")A=g.get("closeAppAfterCloseDay")}catch(F){}var C=g.get("DTC6aktiv");C||(C=DigiWebApp.SettingsController.defaultsettings.get("DTC6aktiv"));var w=DigiWebApp.SettingsController.defaultsettings.get("useNativeLoader");try{if(typeof g.record.useNativeLoader!=="undefined")w=g.get("useNativeLoader")}catch(G){}var K=DigiWebApp.SettingsController.defaultsettings.get("pictureEncodingType");
try{if(typeof g.record.pictureEncodingType!=="undefined")K=g.get("pictureEncodingType")}catch(W){}var H=DigiWebApp.SettingsController.defaultsettings.get("pictureEncodingQuality");try{if(typeof g.record.pictureEncodingQuality!=="undefined")H=g.get("pictureEncodingQuality")}catch(S){}var I=DigiWebApp.SettingsController.defaultsettings.get("pictureAllowEdit");try{if(typeof g.record.pictureAllowEdit!=="undefined")I=g.get("pictureAllowEdit")}catch(T){}var J=DigiWebApp.SettingsController.defaultsettings.get("mengeneingabeMitTelKeyboard");
try{if(typeof g.record.mengeneingabeMitTelKeyboard!=="undefined")J=g.get("mengeneingabeMitTelKeyboard")}catch(X){}var L=DigiWebApp.SettingsController.defaultsettings.get("scrId");try{if(typeof g.record.scrId!=="undefined")L=g.get("scrId");else f=DigiWebApp.SettingsController.defaultsettings.get("daysToHoldBookingsOnDevice")}catch(Y){}var N=DigiWebApp.SettingsController.defaultsettings.get("overrideApplicationQuota");try{if(typeof g.record.overrideApplicationQuota!=="undefined")N=g.get("overrideApplicationQuota")}catch(Z){}var O=
DigiWebApp.SettingsController.defaultsettings.get("logWriterInterval");try{if(typeof g.record.logWriterInterval!=="undefined")O=g.get("logWriterInterval")}catch(aa){}var U=DigiWebApp.SettingsController.defaultsettings.get("progressViewVerwendenAb");try{if(typeof g.record.progressViewVerwendenAb!=="undefined")U=g.get("progressViewVerwendenAb")}catch(ha){}var V=DigiWebApp.SettingsController.defaultsettings.get("logDelete");try{if(typeof g.record.logDelete!=="undefined")V=g.get("logDelete")}catch(ba){}var P=
DigiWebApp.SettingsController.defaultsettings.get("logSave");try{if(typeof g.record.logSave!=="undefined")P=g.get("logSave")}catch(Q){}if(onIOS||onAndroid23){try{$("[id="+DigiWebApp.SettingsPage.content.GPSBackgroundService.id+"]").each(function(){$(this).hide()})}catch(ca){}try{$("[id="+DigiWebApp.SettingsPage.content.BookingReminderHoursGrid.id+"]").each(function(){$(this).hide()})}catch(R){}}if(onIOS)try{$("[id="+DigiWebApp.SettingsPage.content.closeAppAfterCloseDay.id+"]").each(function(){$(this).hide()})}catch(da){}var ea=
DigiWebApp.SettingsController.defaultsettings.get("autoSaveGPSData");try{if(typeof g.record.autoSaveGPSData!=="undefined")if(ea=g.get("autoSaveGPSData")){try{$("[id="+DigiWebApp.SettingsPage.content.GPSenableHighAccuracy.id+"]").each(function(){$(this).show()})}catch(ia){}if(s)try{$("[id="+DigiWebApp.SettingsPage.content.GPSenableHighAccuracyFallback.id+"]").each(function(){$(this).hide()})}catch(ja){}else try{$("[id="+DigiWebApp.SettingsPage.content.GPSenableHighAccuracyFallback.id+"]").each(function(){$(this).show()})}catch(ka){}try{$("[id="+
DigiWebApp.SettingsPage.content.GPSmaximumAgeMinutesGrid.id+"]").each(function(){$(this).show()})}catch(la){}if(!onIOS&&!onAndroid23)try{$("[id="+DigiWebApp.SettingsPage.content.GPSBackgroundService.id+"]").each(function(){$(this).show()})}catch(ma){}}else{try{$("[id="+DigiWebApp.SettingsPage.content.GPSenableHighAccuracy.id+"]").each(function(){$(this).hide()})}catch(na){}try{$("[id="+DigiWebApp.SettingsPage.content.GPSenableHighAccuracyFallback.id+"]").each(function(){$(this).hide()})}catch(oa){}try{$("[id="+
DigiWebApp.SettingsPage.content.GPSmaximumAgeMinutesGrid.id+"]").each(function(){$(this).hide()})}catch(pa){}try{$("[id="+DigiWebApp.SettingsPage.content.GPSBackgroundService.id+"]").each(function(){$(this).hide()})}catch(qa){}}}catch(ra){}f={debug:[{value:g.get("debug"),label:"debug",isSelected:g.get("debug")}],treatAllAsTablet:[{value:g.get("treatAllAsTablet"),label:"treatAllAsTablet",isSelected:g.get("treatAllAsTablet")}],treatAllAsPhone:[{value:g.get("treatAllAsPhone"),label:"treatAllAsPhone",
isSelected:g.get("treatAllAsPhone")}],daysToHoldBookingsOnDevice:f,company:g.get("company"),password:g.get("password"),connectionCode:g.get("connectionCode"),settingsPassword:g.get("settingsPassword"),workerId:g.get("workerId"),timeouthappened:DigiWebApp.ApplicationController.timeouthappened,skipEvents:DigiWebApp.ApplicationController.skipEvents,platform:M.Environment.getPlatform(),userAgent:navigator.userAgent,mapType:g.get("mapType"),autoTransferAfterBookTime:[{value:g.get("autoTransferAfterBookTime"),
label:M.I18N.l("autoTransferAfterBookTimeCheck"),isSelected:g.get("autoTransferAfterBookTime")}],autoTransferAfterClosingDay:[{value:g.get("autoTransferAfterClosingDay"),label:M.I18N.l("autoTransferAfterClosingDayCheck"),isSelected:g.get("autoTransferAfterClosingDay")}],autoSyncAfterBookTime:[{value:g.get("autoSyncAfterBookTime"),label:M.I18N.l("autoSyncAfterBookTimeCheck"),isSelected:g.get("autoSyncAfterBookTime")}],stammdatenabgleichBeimAppStart:[{value:g.get("stammdatenabgleichBeimAppStart"),label:M.I18N.l("stammdatenabgleichBeimAppStart"),
isSelected:g.get("stammdatenabgleichBeimAppStart")}],autoSaveGPSData:[{value:g.get("autoSaveGPSData"),label:M.I18N.l("autoSaveGPSData"),isSelected:g.get("autoSaveGPSData")}],bautagebuchLimit_autoStartUhrzeit:[{value:l,label:M.I18N.l("bautagebuchLimit_autoStartUhrzeit"),isSelected:l}],GPSDataIsMandatory:[{value:j,label:M.I18N.l("GPSDataIsMandatory"),isSelected:j}],remarkIsMandatory:[{value:g.get("remarkIsMandatory"),label:M.I18N.l("remarkIsMandatory"),isSelected:g.get("remarkIsMandatory")}],remarkIsOptional:[{value:g.get("remarkIsOptional"),
label:M.I18N.l("remarkIsOptional"),isSelected:g.get("remarkIsOptional")}],detailierteZeitdaten:[{value:g.get("detailierteZeitdaten"),label:M.I18N.l("detailierteZeitdaten"),isSelected:g.get("detailierteZeitdaten")}],useTransitionsSetting:[{value:g.get("useTransitionsSetting"),label:M.I18N.l("useTransitionsSetting"),isSelected:g.get("useTransitionsSetting")}],datatransfer_min_delay:g.get("datatransfer_min_delay"),branding:g.get("branding"),GPSTimeOut:g.get("GPSTimeOut"),WebserviceTimeOut:g.get("WebserviceTimeOut"),
LoaderTimeOut:g.get("LoaderTimeOut"),silentLoader:g.get("silentLoader"),currentTimezoneOffset:g.get("currentTimezoneOffset"),currentTimezone:g.get("currentTimezone"),ServiceApp_ermittleGeokoordinate:[{value:g.get("ServiceApp_ermittleGeokoordinate"),label:M.I18N.l("ServiceApp_ermittleGeokoordinate"),isSelected:g.get("ServiceApp_ermittleGeokoordinate")}],ServiceApp_datenUebertragen:[{value:g.get("ServiceApp_datenUebertragen"),label:M.I18N.l("ServiceApp_datenUebertragen"),isSelected:g.get("ServiceApp_datenUebertragen")}],
ServiceApp_engeKopplung:[{value:g.get("ServiceApp_engeKopplung"),label:M.I18N.l("ServiceApp_engeKopplung"),isSelected:g.get("ServiceApp_engeKopplung")}],ServiceApp_FallBack:[{value:g.get("ServiceApp_FallBack"),label:M.I18N.l("ServiceApp_FallBack"),isSelected:g.get("ServiceApp_FallBack")}],ServiceApp_PORT:g.get("ServiceApp_PORT"),debugDatabaseServer:g.get("debugDatabaseServer"),mitarbeiterVorname:g.get("mitarbeiterVorname"),mitarbeiterNachname:g.get("mitarbeiterNachname"),mitarbeiterId:g.get("mitarbeiterId"),
auftragsDetailsKoppeln:[{value:g.get("auftragsDetailsKoppeln"),label:M.I18N.l("auftragsDetailsKoppeln"),isSelected:g.get("auftragsDetailsKoppeln")}],vibrationsDauer:i,terminliste_keineKuenstlichenTermine:[{value:n,label:M.I18N.l("terminliste_keineKuenstlichenTermine"),isSelected:n}],terminliste_ignoriereAuftragszeitraum:[{value:o,label:M.I18N.l("terminliste_ignoriereAuftragszeitraum"),isSelected:o}],festePauseStornieren_nurAktuellerTag:[{value:q,label:M.I18N.l("festePauseStornieren_nurAktuellerTag"),
isSelected:q}],startTimeout:g.get("startTimeout"),GPSenableHighAccuracy:[{value:s,label:M.I18N.l("GPSenableHighAccuracy"),isSelected:s}],GPSenableHighAccuracyFallback:[{value:t,label:M.I18N.l("GPSenableHighAccuracyFallback"),isSelected:t}],GPSmaximumAgeMinutes:x,GPSBackgroundService:[{value:z,label:M.I18N.l("GPSBackgroundService"),isSelected:z}],BookingReminderHours:y,closeAppAfterCloseDay:[{value:A,label:M.I18N.l("closeAppAfterCloseDay"),isSelected:A}],DTC6aktiv:C,useNativeLoader:w,pictureEncodingType:K,
pictureEncodingQuality:H,pictureAllowEdit:I,mengeneingabeMitTelKeyboard:J,scrId:L,overrideApplicationQuota:N,logWriterInterval:O,progressViewVerwendenAb:U,logDelete:V,logSave:P}}else{f={debug:[{value:DigiWebApp.SettingsController.defaultsettings.get("debug"),label:"debug"}],treatAllAsTablet:[{value:DigiWebApp.SettingsController.defaultsettings.get("treatAllAsTablet"),label:"treatAllAsTablet"}],treatAllAsPhone:[{value:DigiWebApp.SettingsController.defaultsettings.get("treatAllAsPhone"),label:"treatAllAsPhone"}],
daysToHoldBookingsOnDevice:DigiWebApp.SettingsController.defaultsettings.get("daysToHoldBookingsOnDevice"),company:DigiWebApp.SettingsController.defaultsettings.get("company"),password:DigiWebApp.SettingsController.defaultsettings.get("password"),connectionCode:DigiWebApp.SettingsController.defaultsettings.get("connectionCode"),settingsPassword:DigiWebApp.SettingsController.defaultsettings.get("settingsPassword"),workerId:DigiWebApp.SettingsController.defaultsettings.get("workerId"),timeouthappened:DigiWebApp.ApplicationController.timeouthappened,
skipEvents:DigiWebApp.ApplicationController.skipEvents,platform:M.Environment.getPlatform(),userAgent:navigator.userAgent,mapType:DigiWebApp.SettingsController.defaultsettings.get("mapType"),autoTransferAfterBookTime:[{value:DigiWebApp.SettingsController.defaultsettings.get("autoTransferAfterBookTime"),label:M.I18N.l("autoTransferAfterBookTimeCheck")}],autoTransferAfterClosingDay:[{value:DigiWebApp.SettingsController.defaultsettings.get("autoTransferAfterClosingDay"),label:M.I18N.l("autoTransferAfterClosingDayCheck")}],
autoSyncAfterBookTime:[{value:DigiWebApp.SettingsController.defaultsettings.get("autoSyncAfterBookTime"),label:M.I18N.l("autoSyncAfterBookTimeCheck")}],stammdatenabgleichBeimAppStart:[{value:DigiWebApp.SettingsController.defaultsettings.get("stammdatenabgleichBeimAppStart"),label:M.I18N.l("stammdatenabgleichBeimAppStart")}],autoSaveGPSData:[{value:DigiWebApp.SettingsController.defaultsettings.get("autoSaveGPSData"),label:M.I18N.l("autoSaveGPSData")}],bautagebuchLimit_autoStartUhrzeit:[{value:DigiWebApp.SettingsController.defaultsettings.get("bautagebuchLimit_autoStartUhrzeit"),
label:M.I18N.l("bautagebuchLimit_autoStartUhrzeit")}],GPSDataIsMandatory:[{value:DigiWebApp.SettingsController.defaultsettings.get("GPSDataIsMandatory"),label:M.I18N.l("GPSDataIsMandatory")}],remarkIsMandatory:[{value:DigiWebApp.SettingsController.defaultsettings.get("remarkIsMandatory"),label:M.I18N.l("remarkIsMandatory")}],remarkIsOptional:[{value:DigiWebApp.SettingsController.defaultsettings.get("remarkIsOptional"),label:M.I18N.l("remarkIsOptional")}],detailierteZeitdaten:[{value:DigiWebApp.SettingsController.defaultsettings.get("detailierteZeitdaten"),
label:M.I18N.l("detailierteZeitdaten")}],useTransitionsSetting:[{value:DigiWebApp.SettingsController.defaultsettings.get("useTransitionsSetting"),label:M.I18N.l("useTransitionsSetting")}],datatransfer_min_delay:DigiWebApp.SettingsController.defaultsettings.get("datatransfer_min_delay"),branding:DigiWebApp.SettingsController.defaultsettings.get("branding"),GPSTimeOut:DigiWebApp.SettingsController.defaultsettings.get("GPSTimeOut"),WebserviceTimeOut:DigiWebApp.SettingsController.defaultsettings.get("WebserviceTimeOut"),
LoaderTimeOut:DigiWebApp.SettingsController.defaultsettings.get("LoaderTimeOut"),silentLoader:DigiWebApp.SettingsController.defaultsettings.get("silentLoader"),currentTimezoneOffset:DigiWebApp.SettingsController.defaultsettings.get("currentTimezoneOffset"),currentTimezone:DigiWebApp.SettingsController.defaultsettings.get("currentTimezone"),ServiceApp_ermittleGeokoordinate:[{value:DigiWebApp.SettingsController.defaultsettings.get("ServiceApp_ermittleGeokoordinate"),label:M.I18N.l("ServiceApp_ermittleGeokoordinate")}],
ServiceApp_datenUebertragen:[{value:DigiWebApp.SettingsController.defaultsettings.get("ServiceApp_datenUebertragen"),label:M.I18N.l("ServiceApp_datenUebertragen")}],ServiceApp_engeKopplung:[{value:DigiWebApp.SettingsController.defaultsettings.get("ServiceApp_engeKopplung"),label:M.I18N.l("ServiceApp_engeKopplung")}],ServiceApp_FallBack:[{value:DigiWebApp.SettingsController.defaultsettings.get("ServiceApp_FallBack"),label:M.I18N.l("ServiceApp_FallBack")}],ServiceApp_PORT:DigiWebApp.SettingsController.defaultsettings.get("ServiceApp_PORT"),
debugDatabaseServer:DigiWebApp.SettingsController.defaultsettings.get("debugDatabaseServer"),mitarbeiterVorname:DigiWebApp.SettingsController.defaultsettings.get("mitarbeiterVorname"),mitarbeiterNachname:DigiWebApp.SettingsController.defaultsettings.get("mitarbeiterNachname"),mitarbeiterId:DigiWebApp.SettingsController.defaultsettings.get("mitarbeiterId"),auftragsDetailsKoppeln:[{value:DigiWebApp.SettingsController.defaultsettings.get("auftragsDetailsKoppeln"),label:M.I18N.l("auftragsDetailsKoppeln")}],
vibrationsDauer:DigiWebApp.SettingsController.defaultsettings.get("vibrationsDauer"),terminliste_keineKuenstlichenTermine:[{value:DigiWebApp.SettingsController.defaultsettings.get("terminliste_keineKuenstlichenTermine"),label:M.I18N.l("terminliste_keineKuenstlichenTermine")}],terminliste_ignoriereAuftragszeitraum:[{value:DigiWebApp.SettingsController.defaultsettings.get("terminliste_ignoriereAuftragszeitraum"),label:M.I18N.l("terminliste_ignoriereAuftragszeitraum")}],festePauseStornieren_nurAktuellerTag:[{value:DigiWebApp.SettingsController.defaultsettings.get("festePauseStornieren_nurAktuellerTag"),
label:M.I18N.l("festePauseStornieren_nurAktuellerTag")}],startTimeout:DigiWebApp.SettingsController.defaultsettings.get("startTimeout"),GPSenableHighAccuracy:[{value:DigiWebApp.SettingsController.defaultsettings.get("GPSenableHighAccuracy"),label:M.I18N.l("GPSenableHighAccuracy")}],GPSenableHighAccuracyFallback:[{value:DigiWebApp.SettingsController.defaultsettings.get("GPSenableHighAccuracyFallback"),label:M.I18N.l("GPSenableHighAccuracyFallback")}],GPSmaximumAgeMinutes:DigiWebApp.SettingsController.defaultsettings.get("GPSmaximumAgeMinutes"),
GPSBackgroundService:[{value:DigiWebApp.SettingsController.defaultsettings.get("GPSBackgroundService"),label:M.I18N.l("GPSBackgroundService")}],BookingReminderHours:DigiWebApp.SettingsController.defaultsettings.get("BookingReminderHours"),closeAppAfterCloseDay:[{value:DigiWebApp.SettingsController.defaultsettings.get("closeAppAfterCloseDay"),label:M.I18N.l("closeAppAfterCloseDay")}],DTC6aktiv:DigiWebApp.SettingsController.defaultsettings.get("DTC6aktiv"),useNativeLoader:DigiWebApp.SettingsController.defaultsettings.get("useNativeLoader"),
pictureEncodingType:DigiWebApp.SettingsController.defaultsettings.get("pictureEncodingType"),pictureEncodingQuality:DigiWebApp.SettingsController.defaultsettings.get("pictureEncodingQuality"),pictureAllowEdit:DigiWebApp.SettingsController.defaultsettings.get("pictureAllowEdit"),mengeneingabeMitTelKeyboard:DigiWebApp.SettingsController.defaultsettings.get("mengeneingabeMitTelKeyboard"),scrId:DigiWebApp.SettingsController.defaultsettings.get("scrId"),overrideApplicationQuota:DigiWebApp.SettingsController.defaultsettings.get("overrideApplicationQuota"),
logWriterInterval:DigiWebApp.SettingsController.defaultsettings.get("logWriterInterval"),progressViewVerwendenAb:DigiWebApp.SettingsController.defaultsettings.get("progressViewVerwendenAb"),logDelete:DigiWebApp.SettingsController.defaultsettings.get("logDelete"),logSave:DigiWebApp.SettingsController.defaultsettings.get("logSave")};g=DigiWebApp.Settings.createRecord(DigiWebApp.SettingsController.defaultsettings_object).save()}c.set("settings",f);if(typeof window.logDelete!="undefined")window.logDelete=
parseBool(f.logDelete);if(typeof window.logSave!="undefined")window.logSave=parseBool(f.logSave);var fa=[],k=function(){(function(){DigiWebApp.ServiceAppController.refreshWAITBookings(function(){DigiWebApp.BookingController.init(YES)},function(ga){trackError(ga)},fa)})()};d&&DigiWebApp.SettingsController.featureAvailable("417")&&k();(function(){$("#"+DigiWebApp.SettingsPage.content.ServiceApp_datenUebertragen.id).hide();if(DigiWebApp.SettingsController.featureAvailable("417")){$("#"+DigiWebApp.SettingsPage.content.ServiceApp_PORTGrid.id).show();
$("#"+DigiWebApp.SettingsPage.content.ServiceApp_datenUebertragen.id).hide();$("#"+DigiWebApp.SettingsPage.content.ServiceApp_ermittleGeokoordinate.id).show();$("#"+DigiWebApp.SettingsPage.content.ServiceApp_engeKopplung.id).show();$("#"+DigiWebApp.SettingsPage.content.ServiceApp_FallBack.id).show();DigiWebApp.ServiceAppController.knockknock(function(ga){DigiWebApp.SettingsController.getSetting("debug")&&console.log("ServiceApp is available");if(JSON.parse(ga)!==null)try{var sa=[],wa=DigiWebApp.Booking.find();
_.each(JSON.parse(ga).GET.buchungen,function(xa){var ta=false,va=xa.datensatz;_.each(wa,function(ya){if(ya.m_id===va.m_id)ta=true});ta||sa.push(va.m_id)});DigiWebApp.ServiceAppController.deleteBookings(sa,k,k)}catch(za){d&&k()}else d&&k()},function(){DigiWebApp.SettingsController.getSetting("debug")&&console.log("ServiceApp is NOT available");d&&k()})}})()},saveDone:YES,save:function(){if(DigiWebApp.SettingsController.saveDone===YES){DigiWebApp.SettingsController.saveDone=NO;var a=/^[0-9]+$/,b=DigiWebApp.SettingsController.globalDebugMode,
c=DigiWebApp.SettingsController.getSetting("treatAllAsTablet"),d=DigiWebApp.SettingsController.getSetting("treatAllAsPhone"),e=DigiWebApp.SettingsController.getSetting("settingsPassword"),f=$("#"+M.ViewManager.getView("settingsPage","daysToHoldBookingsOnDeviceSlider").id).val(),g=$("#"+M.ViewManager.getView("settingsPage","companyInput").id).val(),i=$("#"+M.ViewManager.getView("settingsPage","passwordInput").id).val(),h=$("#"+M.ViewManager.getView("settingsPage","connectionCodeInput").id).val(),j=
$("#"+M.ViewManager.getView("settingsPage","workerIdInput").id).val(),l=DigiWebApp.ApplicationController.timeouthappened,n=DigiWebApp.ApplicationController.skipEvents,m=M.Environment.getPlatform(),o=navigator.userAgent,p=DigiWebApp.SettingsController.getSetting("mapType"),q=$("#"+M.ViewManager.getView("settingsPage","autoTransferAfterBookTimeCheck").id+" label.ui-checkbox-on").length>0?YES:NO,r=$("#"+M.ViewManager.getView("settingsPage","autoTransferAfterClosingDayCheck").id+" label.ui-checkbox-on").length>
0?YES:NO,s=$("#"+M.ViewManager.getView("settingsPage","autoSyncAfterBookTimeCheck").id+" label.ui-checkbox-on").length>0?YES:NO,u=$("#"+M.ViewManager.getView("settingsPage","stammdatenabgleichBeimAppStartCheck").id+" label.ui-checkbox-on").length>0?YES:NO,t=$("#"+M.ViewManager.getView("settingsPage","autoSaveGPSData").id+" label.ui-checkbox-on").length>0?YES:NO,v=$("#"+M.ViewManager.getView("settingsPage","useTransitionsSetting").id+" label.ui-checkbox-on").length>0?YES:NO,x=NO;if(M.ViewManager.getView("settingsPage",
"remarkIsMandatory")!==null)x=$("#"+M.ViewManager.getView("settingsPage","remarkIsMandatory").id+" label.ui-checkbox-on").length>0?YES:NO;var B=NO;if(M.ViewManager.getView("settingsPage","remarkIsOptional")!==null){B=$("#"+M.ViewManager.getView("settingsPage","remarkIsOptional").id+" label.ui-checkbox-on").length>0?YES:NO;if(B===YES)x=NO}var z=$("#"+M.ViewManager.getView("settingsPage","detailierteZeitdaten").id+" label.ui-checkbox-on").length>0?YES:NO,D=NO;if(M.ViewManager.getView("settingsPage",
"GPSDataIsMandatory")!==null)D=$("#"+M.ViewManager.getView("settingsPage","GPSDataIsMandatory").id+" label.ui-checkbox-on").length>0?YES:NO;var y=NO;if(M.ViewManager.getView("settingsPage","bautagebuchLimit_autoStartUhrzeit")!==null)y=$("#"+M.ViewManager.getView("settingsPage","bautagebuchLimit_autoStartUhrzeit").id+" label.ui-checkbox-on").length>0?YES:NO;var E=DigiWebApp.SettingsController.getSetting("datatransfer_min_delay"),A=DigiWebApp.SettingsController.getSetting("branding"),F=DigiWebApp.SettingsController.getSetting("GPSTimeOut"),
C=DigiWebApp.SettingsController.getSetting("WebserviceTimeOut"),w=DigiWebApp.SettingsController.getSetting("LoaderTimeOut"),G=DigiWebApp.SettingsController.getSetting("silentLoader"),K=DigiWebApp.SettingsController.getSetting("currentTimezoneOffset"),W=DigiWebApp.SettingsController.getSetting("currentTimezone"),H=DigiWebApp.SettingsController.getSetting("ServiceApp_ermittleGeokoordinate");if(M.ViewManager.getView("settingsPage","ServiceApp_ermittleGeokoordinate")!==null)H=$("#"+M.ViewManager.getView("settingsPage",
"ServiceApp_ermittleGeokoordinate").id+" label.ui-checkbox-on").length>0?YES:NO;var S=DigiWebApp.SettingsController.getSetting("ServiceApp_datenUebertragen");if(M.ViewManager.getView("settingsPage","ServiceApp_datenUebertragen")!==null)S=$("#"+M.ViewManager.getView("settingsPage","ServiceApp_datenUebertragen").id+" label.ui-checkbox-on").length>0?YES:NO;var I=DigiWebApp.SettingsController.getSetting("ServiceApp_engeKopplung");if(M.ViewManager.getView("settingsPage","ServiceApp_engeKopplung")!==null)I=
$("#"+M.ViewManager.getView("settingsPage","ServiceApp_engeKopplung").id+" label.ui-checkbox-on").length>0?YES:NO;var T=DigiWebApp.SettingsController.getSetting("ServiceApp_FallBack");if(M.ViewManager.getView("settingsPage","ServiceApp_FallBack")!==null)T=$("#"+M.ViewManager.getView("settingsPage","ServiceApp_FallBack").id+" label.ui-checkbox-on").length>0?YES:NO;var J=DigiWebApp.SettingsController.getSetting("ServiceApp_PORT");if(M.ViewManager.getView("settingsPage","ServiceApp_PORTInput")!==null)J=
$("#"+M.ViewManager.getView("settingsPage","ServiceApp_PORTInput").id).val();var X=DigiWebApp.SettingsController.getSetting("debugDatabaseServer"),L=DigiWebApp.SettingsController.getSetting("mitarbeiterVorname"),Y=DigiWebApp.SettingsController.getSetting("mitarbeiterNachname"),N=DigiWebApp.SettingsController.getSetting("mitarbeiterId"),Z=$("#"+M.ViewManager.getView("settingsPage","auftragsDetailsKoppeln").id+" label.ui-checkbox-on").length>0?YES:NO,O=$("#"+M.ViewManager.getView("settingsPage","vibrationsDauerSlider").id).val(),
aa=$("#"+M.ViewManager.getView("settingsPage","terminliste_keineKuenstlichenTermine").id+" label.ui-checkbox-on").length>0?YES:NO,U=$("#"+M.ViewManager.getView("settingsPage","terminliste_ignoriereAuftragszeitraum").id+" label.ui-checkbox-on").length>0?YES:NO,ha=$("#"+M.ViewManager.getView("settingsPage","festePauseStornieren_nurAktuellerTag").id+" label.ui-checkbox-on").length>0?YES:NO,V=DigiWebApp.SettingsController.getSetting("startTimeout"),ba=NO;if(M.ViewManager.getView("settingsPage","GPSenableHighAccuracy")!==
null)ba=$("#"+M.ViewManager.getView("settingsPage","GPSenableHighAccuracy").id+" label.ui-checkbox-on").length>0?YES:NO;var P=NO;if(M.ViewManager.getView("settingsPage","GPSenableHighAccuracyFallback")!==null)P=$("#"+M.ViewManager.getView("settingsPage","GPSenableHighAccuracyFallback").id+" label.ui-checkbox-on").length>0?YES:NO;var Q=$("#"+M.ViewManager.getView("settingsPage","GPSmaximumAgeMinutesInput").id).val();if(parseIntRadixTen(Q)<0||!a.test(Q))Q=0;var ca=NO;if(M.ViewManager.getView("settingsPage",
"GPSBackgroundService")!==null)ca=$("#"+M.ViewManager.getView("settingsPage","GPSBackgroundService").id+" label.ui-checkbox-on").length>0?YES:NO;var R=$("#"+M.ViewManager.getView("settingsPage","BookingReminderHoursInput").id).val();if(parseIntRadixTen(R)<0||!a.test(R))R=0;var da=NO;if(M.ViewManager.getView("settingsPage","closeAppAfterCloseDay")!==null)da=$("#"+M.ViewManager.getView("settingsPage","closeAppAfterCloseDay").id+" label.ui-checkbox-on").length>0?YES:NO;var ea=DigiWebApp.SettingsController.getSetting("DTC6aktiv"),
ia=DigiWebApp.SettingsController.getSetting("useNativeLoader"),ja=DigiWebApp.SettingsController.getSetting("pictureEncodingType"),ka=DigiWebApp.SettingsController.getSetting("pictureEncodingQuality"),la=DigiWebApp.SettingsController.getSetting("pictureAllowEdit"),ma=DigiWebApp.SettingsController.getSetting("mengeneingabeMitTelKeyboard"),na=DigiWebApp.SettingsController.getSetting("scrId"),oa=DigiWebApp.SettingsController.getSetting("overrideApplicationQuota"),pa=DigiWebApp.SettingsController.getSetting("logWriterInterval"),
qa=DigiWebApp.SettingsController.getSetting("progressViewVerwendenAb"),ra=DigiWebApp.SettingsController.getSetting("logDelete"),fa=DigiWebApp.SettingsController.getSetting("logSave");if(g)if(!a.test(g)){DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("inputError"),message:M.I18N.l("inputErrorOnlyNumbers")+":<br />"+M.I18N.l("company")});DigiWebApp.SettingsController.saveDone=YES;return}if(j)if(!a.test(j)){DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("inputError"),
message:M.I18N.l("inputErrorOnlyNumbers")+":<br />"+M.I18N.l("workerId")});DigiWebApp.SettingsController.saveDone=YES;return}if(f)if(!a.test(f)){DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("inputError"),message:M.I18N.l("inputErrorOnlyNumbers")+":<br />"+M.I18N.l("daysToHoldBookingsOnDeviceLabel")});DigiWebApp.SettingsController.saveDone=YES;return}DigiWebApp.ApplicationController.nativeConfirmDialogView({title:M.I18N.l("hint"),message:M.I18N.l("confirmSaveOfSettings"),
callbacks:{confirm:{action:function(){var k=DigiWebApp.Settings.find()[0];if(k){var ga=k.get("company")==""&&k.get("password")==""&&k.get("connectionCode")==""&&k.get("workerId")=="";if(!ga&&(k.get("company")!=g||k.get("password")!=i||k.get("connectionCode")!=h||k.get("workerId")!=j)){DigiWebApp.RequestController.DatabaseServer=null;if(DigiWebApp.Booking.find().length>0)DigiWebApp.ApplicationController.nativeConfirmDialogView({title:M.I18N.l("hint"),message:M.I18N.l("openBookingsOverwriteBySettingsUpdate"),
callbacks:{confirm:{action:function(){DigiWebApp.ApplicationController.restartApp=YES;k.set("debug",b);k.set("treatAllAsTablet",c);k.set("treatAllAsPhone",d);k.set("daysToHoldBookingsOnDevice",f);k.set("company",g);k.set("password",i);k.set("connectionCode",h);k.set("settingsPassword",e);k.set("workerId",j);k.set("timeouthappened",l);k.set("skipEvents",n);k.set("platform",m);k.set("userAgent",o);k.set("mapType",p);k.set("autoTransferAfterBookTime",q);k.set("autoTransferAfterClosingDay",r);k.set("autoSyncAfterBookTime",
s);k.set("stammdatenabgleichBeimAppStart",u);k.set("autoSaveGPSData",t);k.set("bautagebuchLimit_autoStartUhrzeit",y);k.set("GPSDataIsMandatory",D);k.set("remarkIsMandatory",x);k.set("remarkIsOptional",B);k.set("detailierteZeitdaten",z);k.set("useTransitionsSetting",v);k.set("datatransfer_min_delay",E);k.set("branding",A);k.set("GPSTimeOut",F);k.set("WebserviceTimeOut",C);k.set("LoaderTimeOut",w);k.set("silentLoader",G);k.set("currentTimezoneOffset",K);k.set("currentTimezone",W);k.set("ServiceApp_ermittleGeokoordinate",
H);k.set("ServiceApp_datenUebertragen",S);k.set("ServiceApp_engeKopplung",I);k.set("ServiceApp_PORT",J);k.set("ServiceApp_FallBack",T);k.set("debugDatabaseServer",X);k.set("mitarbeiterVorname",L);k.set("mitarbeiterNachname",Y);k.set("mitarbeiterId",N);k.set("auftragsDetailsKoppeln",Z);k.set("vibrationsDauer",O);k.set("terminliste_keineKuenstlichenTermine",aa);k.set("terminliste_ignoriereAuftragszeitraum",U);k.set("festePauseStornieren_nurAktuellerTag",ha);k.set("startTimeout",V);k.set("GPSenableHighAccuracy",
ba);k.set("GPSenableHighAccuracyFallback",P);k.set("GPSmaximumAgeMinutes",Q);k.set("GPSBackgroundService",ca);k.set("BookingReminderHours",R);k.set("closeAppAfterCloseDay",da);k.set("DTC6aktiv",ea);k.set("useNativeLoader",ia);k.set("pictureEncodingType",ja);k.set("pictureEncodingQuality",ka);k.set("pictureAllowEdit",la);k.set("mengeneingabeMitTelKeyboard",ma);k.set("scrId",na);k.set("overrideApplicationQuota",oa);k.set("logWriterInterval",pa);k.set("progressViewVerwendenAb",qa);k.set("logDelete",
ra);k.set("logSave",fa);DigiWebApp.SettingsController.saveSettings(k,YES);DigiWebApp.SettingsController.saveDone=YES}},cancel:{action:function(){DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("hint"),message:M.I18N.l("settingsUpdateCanceled"),callbacks:{confirm:{action:function(){DigiWebApp.SettingsController.featureAvailable("404")?DigiWebApp.NavigationController.backToButtonDashboardPage():DigiWebApp.NavigationController.backToDashboardPage();DigiWebApp.SettingsController.saveDone=
YES}}}})}}}});else{DigiWebApp.ApplicationController.restartApp=YES;k.set("debug",b);k.set("treatAllAsTablet",c);k.set("treatAllAsPhone",d);k.set("daysToHoldBookingsOnDevice",f);k.set("company",g);k.set("password",i);k.set("connectionCode",h);k.set("settingsPassword",e);k.set("workerId",j);k.set("timeouthappened",l);k.set("skipEvents",n);k.set("platform",m);k.set("userAgent",o);k.set("mapType",p);k.set("autoTransferAfterBookTime",q);k.set("autoTransferAfterClosingDay",r);k.set("autoSyncAfterBookTime",
s);k.set("stammdatenabgleichBeimAppStart",u);k.set("autoSaveGPSData",t);k.set("bautagebuchLimit_autoStartUhrzeit",y);k.set("GPSDataIsMandatory",D);k.set("remarkIsMandatory",x);k.set("remarkIsOptional",B);k.set("detailierteZeitdaten",z);k.set("useTransitionsSetting",v);k.set("datatransfer_min_delay",E);k.set("branding",A);k.set("GPSTimeOut",F);k.set("WebserviceTimeOut",C);k.set("LoaderTimeOut",w);k.set("silentLoader",G);k.set("currentTimezoneOffset",K);k.set("currentTimezone",W);k.set("ServiceApp_ermittleGeokoordinate",
H);k.set("ServiceApp_datenUebertragen",S);k.set("ServiceApp_engeKopplung",I);k.set("ServiceApp_PORT",J);k.set("ServiceApp_FallBack",T);k.set("debugDatabaseServer",X);k.set("mitarbeiterVorname",L);k.set("mitarbeiterNachname",Y);k.set("mitarbeiterId",N);k.set("auftragsDetailsKoppeln",Z);k.set("vibrationsDauer",O);k.set("terminliste_keineKuenstlichenTermine",aa);k.set("terminliste_ignoriereAuftragszeitraum",U);k.set("festePauseStornieren_nurAktuellerTag",ha);k.set("startTimeout",V);k.set("GPSenableHighAccuracy",
ba);k.set("GPSenableHighAccuracyFallback",P);k.set("GPSmaximumAgeMinutes",Q);k.set("GPSBackgroundService",ca);k.set("BookingReminderHours",R);k.set("closeAppAfterCloseDay",da);k.set("DTC6aktiv",ea);k.set("useNativeLoader",ia);k.set("pictureEncodingType",ja);k.set("pictureEncodingQuality",ka);k.set("pictureAllowEdit",la);k.set("mengeneingabeMitTelKeyboard",ma);k.set("scrId",na);k.set("overrideApplicationQuota",oa);k.set("logWriterInterval",pa);k.set("progressViewVerwendenAb",qa);k.set("logDelete",
ra);k.set("logSave",fa);DigiWebApp.SettingsController.saveSettings(k,YES);DigiWebApp.SettingsController.saveDone=YES}}else{if(ga){k.set("debug",b);k.set("treatAllAsTablet",c);k.set("treatAllAsPhone",d);k.set("daysToHoldBookingsOnDevice",f);k.set("company",g);k.set("password",i);k.set("connectionCode",h);k.set("settingsPassword",e);k.set("workerId",j);k.set("timeouthappened",l);k.set("skipEvents",n);k.set("platform",m);k.set("userAgent",o);k.set("mapType",p);k.set("autoTransferAfterBookTime",q);k.set("autoTransferAfterClosingDay",
r);k.set("autoSyncAfterBookTime",s);k.set("stammdatenabgleichBeimAppStart",u);k.set("autoSaveGPSData",t);k.set("bautagebuchLimit_autoStartUhrzeit",y);k.set("GPSDataIsMandatory",D);k.set("remarkIsMandatory",x);k.set("remarkIsOptional",B);k.set("detailierteZeitdaten",z);k.set("useTransitionsSetting",v);k.set("datatransfer_min_delay",E);k.set("branding",A);k.set("GPSTimeOut",F);k.set("WebserviceTimeOut",C);k.set("LoaderTimeOut",w);k.set("silentLoader",G);k.set("currentTimezoneOffset",K);k.set("currentTimezone",
W);k.set("ServiceApp_ermittleGeokoordinate",H);k.set("ServiceApp_datenUebertragen",S);k.set("ServiceApp_engeKopplung",I);k.set("ServiceApp_PORT",J);k.set("ServiceApp_FallBack",T);k.set("debugDatabaseServer",X);k.set("mitarbeiterVorname",L);k.set("mitarbeiterNachname",Y);k.set("mitarbeiterId",N);k.set("auftragsDetailsKoppeln",Z);k.set("vibrationsDauer",O);k.set("terminliste_keineKuenstlichenTermine",aa);k.set("terminliste_ignoriereAuftragszeitraum",U);k.set("festePauseStornieren_nurAktuellerTag",ha);
k.set("startTimeout",V);k.set("GPSenableHighAccuracy",ba);k.set("GPSenableHighAccuracyFallback",P);k.set("GPSmaximumAgeMinutes",Q);k.set("GPSBackgroundService",ca);k.set("BookingReminderHours",R);k.set("closeAppAfterCloseDay",da);k.set("DTC6aktiv",ea);k.set("useNativeLoader",ia);k.set("pictureEncodingType",ja);k.set("pictureEncodingQuality",ka);k.set("pictureAllowEdit",la);k.set("mengeneingabeMitTelKeyboard",ma);k.set("scrId",na);k.set("overrideApplicationQuota",oa);k.set("logWriterInterval",pa);
k.set("progressViewVerwendenAb",qa);k.set("logDelete",ra);k.set("logSave",fa);DigiWebApp.SettingsController.saveSettings(k,YES)}else{k.set("debug",b);k.set("treatAllAsTablet",c);k.set("treatAllAsPhone",d);k.set("daysToHoldBookingsOnDevice",f);k.set("company",g);k.set("password",i);k.set("connectionCode",h);k.set("settingsPassword",e);k.set("workerId",j);k.set("timeouthappened",l);k.set("skipEvents",n);k.set("platform",m);k.set("userAgent",o);k.set("mapType",p);k.set("autoTransferAfterBookTime",q);
k.set("autoTransferAfterClosingDay",r);k.set("autoSyncAfterBookTime",s);k.set("stammdatenabgleichBeimAppStart",u);k.set("autoSaveGPSData",t);k.set("bautagebuchLimit_autoStartUhrzeit",y);k.set("GPSDataIsMandatory",D);k.set("remarkIsMandatory",x);k.set("remarkIsOptional",B);k.set("detailierteZeitdaten",z);k.set("useTransitionsSetting",v);k.set("datatransfer_min_delay",E);k.set("branding",A);k.set("GPSTimeOut",F);k.set("WebserviceTimeOut",C);k.set("LoaderTimeOut",w);k.set("silentLoader",G);k.set("currentTimezoneOffset",
K);k.set("currentTimezone",W);k.set("ServiceApp_ermittleGeokoordinate",H);k.set("ServiceApp_datenUebertragen",S);k.set("ServiceApp_engeKopplung",I);k.set("ServiceApp_PORT",J);k.set("ServiceApp_FallBack",T);k.set("debugDatabaseServer",X);k.set("mitarbeiterVorname",L);k.set("mitarbeiterNachname",Y);k.set("mitarbeiterId",N);k.set("auftragsDetailsKoppeln",Z);k.set("vibrationsDauer",O);k.set("terminliste_keineKuenstlichenTermine",aa);k.set("terminliste_ignoriereAuftragszeitraum",U);k.set("festePauseStornieren_nurAktuellerTag",
ha);k.set("startTimeout",V);k.set("GPSenableHighAccuracy",ba);k.set("GPSenableHighAccuracyFallback",P);k.set("GPSmaximumAgeMinutes",Q);k.set("GPSBackgroundService",ca);k.set("BookingReminderHours",R);k.set("closeAppAfterCloseDay",da);k.set("DTC6aktiv",ea);k.set("useNativeLoader",ia);k.set("pictureEncodingType",ja);k.set("pictureEncodingQuality",ka);k.set("pictureAllowEdit",la);k.set("mengeneingabeMitTelKeyboard",ma);k.set("scrId",na);k.set("overrideApplicationQuota",oa);k.set("logWriterInterval",
pa);k.set("progressViewVerwendenAb",qa);k.set("logDelete",ra);k.set("logSave",fa);DigiWebApp.SettingsController.saveSettings(k)}DigiWebApp.SettingsController.saveDone=YES}}else{k=DigiWebApp.Settings.createRecord({debug:b,treatAllAsTablet:c,treatAllAsPhone:d,daysToHoldBookingsOnDevice:f,company:g,password:i,connectionCode:h,settingsPassword:e,workerId:j,timeouthappened:l,skipEvents:n,platform:m,userAgent:o,mapType:p,autoTransferAfterBookTime:q,autoTransferAfterClosingDay:r,autoSyncAfterBookTime:s,
stammdatenabgleichBeimAppStart:u,autoSaveGPSData:t,GPSDataIsMandatory:D,bautagebuchLimit_autoStartUhrzeit:y,remarkIsMandatory:x,remarkIsOptional:B,detailierteZeitdaten:z,useTransitionsSetting:v,datatransfer_min_delay:E,branding:A,GPSTimeOut:F,WebserviceTimeOut:C,LoaderTimeOut:w,silentLoader:G,currentTimezoneOffset:K,currentTimezone:W,ServiceApp_ermittleGeokoordinate:H,ServiceApp_datenUebertragen:S,ServiceApp_engeKopplung:I,ServiceApp_PORT:J,ServiceApp_FallBack:T,debugDatabaseServer:X,mitarbeiterVorname:L,
mitarbeiterNachname:Y,mitarbeiterId:N,auftragsDetailsKoppeln:Z,vibrationsDauer:O,terminliste_keineKuenstlichenTermine:aa,terminliste_ignoriereAuftragszeitraum:U,festePauseStornieren_nurAktuellerTag:ha,startTimeout:V,GPSenableHighAccuracy:ba,GPSenableHighAccuracyFallback:P,GPSmaximumAgeMinutes:Q,GPSBackgroundService:ca,BookingReminderHours:R,closeAppAfterCloseDay:da,DTC6aktiv:ea,useNativeLoader:ia,pictureEncodingType:ja,pictureEncodingQuality:ka,pictureAllowEdit:la,mengeneingabeMitTelKeyboard:ma,scrId:na,
overrideApplicationQuota:oa,logWriterInterval:pa,progressViewVerwendenAb:qa,logDelete:ra,logSave:fa});DigiWebApp.SettingsController.saveSettings(k);DigiWebApp.SettingsController.saveDone=YES}}},cancel:{action:function(){DigiWebApp.SettingsController.saveDone=YES}}}})}},saveSettings:function(a,b,c,d){if(b){DigiWebApp.ApplicationController.deleteAllData();DigiWebApp.BookingController.currentBooking=null;typeof DigiWebAppOrdinaryDesign.bookingPageWithIconsScholpp!=="undefined"?$("#"+DigiWebApp.BookingPageWithIconsScholpp.content.currentBookingLabel.id).html(""):
$("#"+DigiWebApp.BookingPage.content.currentBookingLabel.id).html("")}if(a.save()){DigiWebApp.SettingsController.mitarbeiterNameVorname="";if(!d)if(b)DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("hint"),message:M.I18N.l("settingsSaveDoneReloadApp"),callbacks:{confirm:{action:function(){DigiWebApp.SettingsController.showCredentialsAlert=NO;DigiWebApp.ApplicationController.init(true)}}}});else if(c){if(DigiWebApp.ApplicationController.profilingIntervalVar===null)if(DigiWebApp.ApplicationController.syncRunning!==
YES)DigiWebApp.SettingsController.featureAvailable("404")?DigiWebApp.NavigationController.backToButtonDashboardPage():DigiWebApp.NavigationController.backToDashboardPage()}else DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("hint"),message:M.I18N.l("settingsSaveDone"),callbacks:{confirm:{action:function(){DigiWebApp.SettingsController.featureAvailable("404")?DigiWebApp.NavigationController.backToButtonDashboardPage():DigiWebApp.NavigationController.backToDashboardPage()}}}});
DigiWebApp.ApplicationController.startBgGeo()}else DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("error"),message:M.I18N.l("settingsSaveError")})},getSetting:function(a){var b=DigiWebApp.Settings.find()[0];if(typeof b!=="undefined"){var c=b.get(a);if(typeof c==="undefined"||c!==null&&typeof c["xsi:nil"]!=="undefined"&&(c["xsi:nil"]==="true"||c["xsi:nil"]===true))try{c=DigiWebApp.SettingsController.defaultsettings_object[a];b.set(a,c)}catch(d){trackError("ERROR: setting.get for prop="+
a)}return c}},setSetting:function(a,b){var c=DigiWebApp.Settings.find()[0];if(typeof c!=="undefined"){try{c.set(a,b);if(a=="logDelete"&&typeof window.logDelete!="undefined")window.logDelete=parseBool(b);if(a=="logSave"&&typeof window.logSave!="undefined")window.logSave=parseBool(b)}catch(d){trackError("ERROR: setting.set for prop="+a)}a==="currentTimezoneOffset"||a==="currentTimezone"?DigiWebApp.SettingsController.saveSettings(c,NO,YES,YES):DigiWebApp.SettingsController.saveSettings(c,NO,YES)}},featureAvailable:function(a){if(typeof a!==
"string")return false;if(a.length===0)return false;var b=_.select(DigiWebApp.Features.find(),function(c){if(c)return c.get("id")==a})[0];return typeof b==="undefined"?false:b.get("isAvailable")==="true"},refreshMitarbeiterNameVorname:function(a,b){try{DigiWebApp.Anwesenheitsliste.find({urlParams:{},callbacks:{success:{action:function(d){try{_.each(d,function(f){try{if(f.get("geraeteId")===a)DigiWebApp.SettingsController.mitarbeiterNameVorname=f.get("nameVorname")}catch(g){trackError(g)}});b&&b()}catch(e){trackError(e)}}},
error:{action:function(){}}}})}catch(c){trackError(c)}},sendConfiguration:function(){var a=DigiWebApp.Settings.find();DigiWebApp.RequestController.sendConfiguration({settings:a,success:{target:this,action:function(){DigiWebApp.ApplicationController.profilingIntervalVar===null&&DigiWebApp.NavigationController.toBookTimePageTransition()}},error:{target:this,action:function(){}}})},terminlisteEinstellungen_titel:[{label:M.I18N.l("Terminliste"),items:[]}],festePauseStornierenEinstellungen_titel:[{label:M.I18N.l("FestePauseStornieren"),
items:[]}]});DigiWebApp.StudieChecklisteController=M.Controller.extend({listData:null,t1:null,t2:null,comboBoxData:null,init:function(){this.set("listData",[{label:"Test 1",comboBox:[{label:"eintrag 1",value:"1"},{label:"eintrag 2",value:"2"}]},{label:"Test 2",comboBox:[{label:"eintrag 3",value:"3"},{label:"eintrag 4",value:"4"}]},{label:"Test 3",comboBox:[{label:"eintrag 5",value:"5"},{label:"eintrag 6",value:"6"}]}])}});
DigiWebApp.TerminlisteController=M.Controller.extend({items:null,datum:null,datumAsDate:null,init:function(){var a=DigiWebApp.TerminlisteController,b=DigiWebApp.TerminlisteController.datum.split(".");DigiWebApp.TerminlisteController.set("datumAsDate",b[2]+"-"+b[1]+"-"+b[0]);b=DigiWebApp.TerminlisteVorZurueckTabBar;b.setActiveTab(b.tabItemDayToShow);b=[];var c=[],d={label:M.I18N.l("ganztaegig"),items:c};b.push(d);var e=[];d={label:M.I18N.l("nachUhrzeit"),items:e};b.push(d);a.set("items",b);b=[];c=
[];e=[];_.each(DigiWebApp.Position.findSorted(),function(f){for(var g=D8.create(DigiWebApp.TerminlisteController.datum).addDays(0),i=0;i<=0;i++){var h=D8.create(g.format("dd.mm.yyyy")),j=h.addDays(1).addMilliseconds(-1),l=h.format("dd.mm.yyyy"),n=f.get("positionBegin"),m=null;if(typeof n!="undefined"&&n!=="")m=D8.create(n);var o=f.get("positionEnd");n=null;if(typeof o!="undefined"&&o!=="")n=D8.create(o);var p=NO;o=NO;var q;if(m!=null)q=m.getTimestamp();var r;if(n!=null)r=n.addDays(1).addMilliseconds(-1).getTimestamp();
h=h.getTimestamp();j=j.getTimestamp();j=m&&q<=h&&n&&j<=r;if(m&&q<=h&&!n||j||!m)p=YES;m=JSON.parse(f.get("appointments"));o=m.length!==0;n=[];if(o)n=_.filter(m,function(s){s=JSON.parse(s);return D8.create(s.von).format("dd.mm.yyyy")==l});if(o)_.each(n,function(s){s=JSON.parse(s);s.m_id=f.m_id;if(DigiWebApp.SettingsController.getSetting("terminliste_ignoriereAuftragszeitraum")||p)s.ganzerTag?addToListIfNotFoundById(c,s,s.terminId):addToListIfNotFoundById(e,s,s.terminId)});else if(!DigiWebApp.SettingsController.getSetting("terminliste_keineKuenstlichenTermine")&&
(DigiWebApp.SettingsController.getSetting("terminliste_ignoriereAuftragszeitraum")||p)){m=_.find(DigiWebApp.Order.find(),function(s){return parseIntRadixTen(s.get("id"))==parseIntRadixTen(f.get("orderId"))});n="";if(m)n=", "+m.get("name");m={_createdAt:D8.create().getTimestamp(),_updatedAt:D8.create().getTimestamp(),beschreibung:null,betreff:f.get("name")+n,von:l+" 00:00:00",bis:l+" 23:59:59",erinnert:false,erinnerung:null,erstellerBenutzerId:null,ganzerTag:false,neueTerminId:null,ortId:null,positionId:f.get("id"),
ressourcen:null,serienterminId:null,status:null,terminId:null,terminartId:null,timeStampBis:D8.create(l+" 23:59:59").getTimestamp(),timeStampErinnerung:null,timeStampVon:D8.create(l+" 00:00:00").getTimestamp(),zeitstempel:D8.create().getTimestamp(),m_id:f.m_id};addToListIfNotFoundById(c,m,m.terminId)}}});c=_.sortBy(c,function(f){return D8.create(f.timeStampVon).getTimestamp()});d={label:M.I18N.l("ganztaegig"),items:c};b.push(d);e=_.sortBy(e,function(f){return D8.create(f.timeStampVon).getTimestamp()});
d={label:M.I18N.l("nachUhrzeit"),items:e};b.push(d);a.set("items",b)}});
DigiWebApp.ZeitbuchungenController=M.Controller.extend({items:null,itemForDetails:null,datum:null,mitarbeiterID:null,mitarbeiterNameVorname:null,backFunction:DigiWebApp.NavigationController.backToAnwesenheitslistePageTransition,init:function(a){DigiWebApp.VorZurueckTabBar.setActiveTab(DigiWebApp.VorZurueckTabBar.tabItemDayToShow);DigiWebApp.SettingsController.featureAvailable("408")?$("#"+DigiWebApp.ZeitbuchungenPage.tabBar.id).show():$("#"+DigiWebApp.ZeitbuchungenPage.tabBar.id).hide();DigiWebApp.ZeitbuchungenController.items===
null?DigiWebApp.RequestController.getDatabaseServer(DigiWebApp.ZeitbuchungenController.initWithServer,a):DigiWebApp.ZeitbuchungenController.initWithServer(a)},initWithServer:function(){if(DigiWebApp.ZeitbuchungenController.items===null){DigiWebApp.ApplicationController.DigiLoaderView.show(M.I18N.l("ZeitbuchungenLaden"));DigiWebApp.Zeitbuchungen.find({urlParams:{datum:DigiWebApp.ZeitbuchungenController.datum,mitarbeiterID:DigiWebApp.ZeitbuchungenController.mitarbeiterID},callbacks:{success:{action:function(c){DigiWebApp.ApplicationController.DigiLoaderView.hide();
try{!c||c&&c.length===0||c&&c.length===1&&(typeof c[0].get("mitarbeiterId")==="undefined"||c[0].get("mitarbeiterId")==null)?DigiWebApp.ZeitbuchungenController.set("items",[]):DigiWebApp.ZeitbuchungenController.set("items",c)}catch(d){DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("error"),message:M.I18N.l("ZeitbuchungenKonntenNichtGeladenWerden"),callbacks:{confirm:{target:this,action:function(){this.backFunction()}}}})}}},error:{action:function(){DigiWebApp.ApplicationController.DigiLoaderView.hide();
DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("error"),message:M.I18N.l("ZeitbuchungenKonntenNichtGeladenWerden"),callbacks:{confirm:{target:this,action:function(){this.backFunction()}}}})}}}})}if(DigiWebApp.ZeitbuchungenController.mitarbeiterNameVorname!==null){var a="";try{a=M.I18N.l(D8.create(DigiWebApp.ZeitbuchungenController.datum).format("dddd")).substring(0,2)+", "}catch(b){a=""}DigiWebApp.ZeitbuchungenPage.header.title.set("value",DigiWebApp.ZeitbuchungenController.mitarbeiterNameVorname+
"<br />"+a+DigiWebApp.ZeitbuchungenController.datum);DigiWebApp.ZeitbuchungenPage.header.title.renderUpdate()}}});
DigiWebApp.ActivityListTemplateView=M.ListItemView.design({isSelectable:NO,childViews:"label",cssClass:"activityListEntry",events:{tap:{target:DigiWebApp.ActivityListController,action:"itemSelected"}},icon:M.ImageView.design({cssClass:"unselectable",computedValue:{valuePattern:"<%= icon %>",operation:function(a){return"theme/images/"+a}}}),label:M.LabelView.design({cssClass:"unselectable",valuePattern:"<%= label %>"})});m_require("app/views/ActivityListTemplateView.js");
DigiWebApp.ActivityListPage=M.PageView.design({childViews:"header content",cssClass:"activityListPage unselectable",events:{pagebeforeshow:{action:function(){}},pageshow:{action:function(){}}},header:M.ToolbarView.design({childViews:"backButton title",cssClass:"header unselectable",isFixed:YES,title:M.LabelView.design({value:M.I18N.l("activity"),anchorLocation:M.CENTER}),backButton:M.ButtonView.design({value:M.I18N.l("back"),icon:"arrow-l",anchorLocation:M.LEFT,events:{tap:{action:function(){try{DigiWebApp.ApplicationController.vibrate()}catch(a){}history.back()}}}})}),
content:M.ScrollView.design({childViews:"list",list:M.ListView.design({contentBinding:{target:DigiWebApp.ActivityListController,property:"items"},listItemTemplateView:DigiWebApp.ActivityListTemplateView})})});
DigiWebApp.AnwesenheitslisteTemplateView=M.ListItemView.design({isSelectable:YES,childViews:"farbeAnwesenheit nameVorname spacer1 datumLabel datum uhrzeit spacer2 fehlzeitBezeichnung auftragsBezeichnung positionsBezeichnung handauftragsBezeichnung taetigkeit gpsBreite gpsLaenge spacer3 gpsBreitePosition gpsLaengePosition",events:{tap:{action:function(a){var b=M.ViewManager.getViewById(a).modelId,c=NO;_.each(DigiWebApp.AnwesenheitslisteController.items,function(d){if(d.m_id===b)if(d.get("datum")!==
"-"){DigiWebApp.ZeitbuchungenController.set("datum",d.get("datum"));DigiWebApp.ZeitbuchungenController.set("mitarbeiterID",d.get("mitarbeiterId"));DigiWebApp.ZeitbuchungenController.set("mitarbeiterNameVorname",d.get("nameVorname"));DigiWebApp.ZeitbuchungenController.set("backFunction",DigiWebApp.NavigationController.backToAnwesenheitslistePageTransition);c=YES}});c===YES&&DigiWebApp.NavigationController.toZeitbuchungenPageTransition()}}},spacer1:M.LabelView.design({cssClass:"unselectable marginBottom12",
value:" "}),spacer2:M.LabelView.design({cssClass:"unselectable marginBottom12",value:" "}),spacer3:M.LabelView.design({cssClass:"unselectable",value:" "}),datumLabel:M.LabelView.design({cssClass:"normal unselectable",isInline:YES,computedValue:{valuePattern:"<%= datumLabel %>",operation:function(a){return a}}}),datum:M.LabelView.design({cssClass:"normal unselectable",isInline:YES,computedValue:{valuePattern:"<%= datum %>",operation:function(a){return a!=="-"?a:""}}}),farbeAmpel:M.LabelView.design({cssClass:"unselectable",
computedValue:{valuePattern:"<%= farbeAmpel %>",operation:function(a){return a}}}),farbeAnwesenheit:M.LabelView.design({cssClass:"unselectable",isInline:YES,computedValue:{valuePattern:"<%= farbeAnwesenheit %>",operation:function(a){return'<span style="box-shadow: 2px 2px 6px rgba(0,0,0,0.6);background:'+a+";color:"+a+';margin-right: 5px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>&nbsp;&nbsp;'}}}),fehlzeitBezeichnung:M.LabelView.design({cssClass:"normal unselectable",computedValue:{valuePattern:"<%= fehlzeitBezeichnung %>",
operation:function(a){return a!==""&&typeof a!=="undefined"&&a!=="undefined"&&a!=="-"&&a!=="null"&&a!==null?M.I18N.l("fehlzeit")+": "+a:""}}}),gpsBreite:M.LabelView.design({cssClass:"normal unselectable",isInline:YES,computedValue:{valuePattern:"<%= gpsBreite %>",operation:function(a){if(a!="0.0"&&a!=="null"&&a!==null){a=new Number(a);return M.I18N.l("buchungskoordinaten")+": "+a.toFixed(4)}else return""}}}),gpsBreitePosition:M.LabelView.design({cssClass:"normal unselectable",isInline:YES,computedValue:{valuePattern:"<%= gpsBreitePosition %>",
operation:function(a){if(a!="0.0"&&a!=="null"&&a!==null){a=new Number(a);return M.I18N.l("auftragskoordinaten")+": "+a.toFixed(4)}else return""}}}),gpsLaenge:M.LabelView.design({cssClass:"normal unselectable",isInline:YES,computedValue:{valuePattern:"<%= gpsLaenge %>",operation:function(a){return a!="0.0"&&a!=="null"&&a!==null?", "+(new Number(a)).toFixed(4):""}}}),gpsLaengePosition:M.LabelView.design({cssClass:"normal unselectable",isInline:YES,computedValue:{valuePattern:"<%= gpsLaengePosition %>",
operation:function(a){return a!="0.0"&&a!=="null"&&a!==null?", "+(new Number(a)).toFixed(4):""}}}),handauftragsBezeichnung:M.LabelView.design({cssClass:"normal unselectable",computedValue:{valuePattern:"<%= handauftragsBezeichnung %>",operation:function(a){return a!==""&&typeof a!=="undefined"&&a!=="undefined"&&a!=="-"&&a!=="null"&&a!==null?M.I18N.l("handApplications")+": "+a:""}}}),handauftragsId:M.LabelView.design({cssClass:"unselectable",computedValue:{valuePattern:"<%= handauftragsId %>",operation:function(a){return a}}}),
mitarbeiterId:M.LabelView.design({cssClass:"unselectable",computedValue:{valuePattern:"<%= mitarbeiterId %>",operation:function(a){return a}}}),name:M.LabelView.design({cssClass:"bold unselectable",computedValue:{valuePattern:"<%= name %>",operation:function(a){return a}}}),nameVorname:M.LabelView.design({cssClass:"bold unselectable",isInline:YES,computedValue:{valuePattern:"<%= nameVorname %>",operation:function(a){return a}}}),auftragsBezeichnung:M.LabelView.design({cssClass:"normal unselectable",
computedValue:{valuePattern:"<%= auftragsBezeichnung %>",operation:function(a){return a!==""&&typeof a!=="undefined"&&a!=="undefined"&&a!=="-"&&a!=="null"&&a!==null?(DigiWebApp.SettingsController.getSetting("DTC6aktiv")===YES?M.I18N.l("dtc6Ordner"):M.I18N.l("order"))+": "+a:""}}}),positionsBezeichnung:M.LabelView.design({cssClass:"normal unselectable",computedValue:{valuePattern:"<%= positionsBezeichnung %>",operation:function(a){return a!==""&&typeof a!=="undefined"&&a!=="undefined"&&a!=="-"&&a!==
"null"&&a!==null?(DigiWebApp.SettingsController.getSetting("DTC6aktiv")===YES?M.I18N.l("dtc6Auftrag"):M.I18N.l("position"))+": "+a:""}}}),positionsId:M.LabelView.design({cssClass:"unselectable",computedValue:{valuePattern:"<%= positionsId %>",operation:function(a){return a}}}),taetigkeit:M.LabelView.design({cssClass:"normal unselectable",computedValue:{valuePattern:"<%= taetigkeit %>",operation:function(a){return a!==""&&typeof a!=="undefined"&&a!=="undefined"&&a!=="-"&&a!=="null"&&a!==null?(DigiWebApp.SettingsController.getSetting("DTC6aktiv")===
YES?M.I18N.l("dtc6Leistung"):M.I18N.l("activity"))+": "+a:""}}}),taetigkeitsId:M.LabelView.design({cssClass:"unselectable",computedValue:{valuePattern:"<%= taetigkeitsId %>",operation:function(a){return a}}}),taetigkeitsart:M.LabelView.design({cssClass:"unselectable",computedValue:{valuePattern:"<%= taetigkeitsart %>",operation:function(a){return a}}}),uhrzeit:M.LabelView.design({cssClass:"normal unselectable",isInline:YES,computedValue:{valuePattern:"<%= uhrzeit %>",operation:function(a){return a!==
""&&typeof a!=="undefined"&&a!=="undefined"&&a!=="-"&&a!=="null"&&a!==null?" "+a:""}}}),vorname:M.LabelView.design({cssClass:"bold unselectable",computedValue:{valuePattern:"<%= vorname %>",operation:function(a){return a}}})});m_require("app/views/AnwesenheitslisteTemplateView");
DigiWebApp.AnwesenheitslistePage=M.PageView.design({events:{pageshow:{target:DigiWebApp.AnwesenheitslisteController,action:"init"}},childViews:"header content",cssClass:"anwesenheitslistePage unselectable",header:M.ToolbarView.design({childViews:"backButton title refreshButton",cssClass:"header unselectable",isFixed:YES,backButton:M.ButtonView.design({value:M.I18N.l("back"),icon:"arrow-l",anchorLocation:M.LEFT,events:{tap:{target:DigiWebApp.NavigationController,action:function(){try{DigiWebApp.ApplicationController.vibrate()}catch(a){}this.backToDashboardPage()}}}}),
title:M.LabelView.design({value:M.I18N.l("Anwesenheitsliste"),anchorLocation:M.CENTER}),refreshButton:M.ButtonView.design({value:M.I18N.l("refresh"),icon:"refresh",anchorLocation:M.RIGHT,events:{tap:{action:function(){try{DigiWebApp.ApplicationController.vibrate()}catch(a){}DigiWebApp.AnwesenheitslisteController.set("items",{});DigiWebApp.AnwesenheitslisteController.items=null;DigiWebApp.AnwesenheitslisteController.init()}}}}),anchorLocation:M.TOP}),content:M.ScrollView.design({childViews:"list",
list:M.ListView.design({contentBinding:{target:DigiWebApp.AnwesenheitslisteController,property:"items"},listItemTemplateView:DigiWebApp.AnwesenheitslisteTemplateView})})});
DigiWebApp.AudioPage=M.PageView.design({events:{pagebeforeshow:{target:DigiWebApp.AudioController,action:"init"}},childViews:"header content",cssClass:"audioPage",header:M.ToolbarView.design({childViews:"backButton title",cssClass:"header",isFixed:YES,backButton:M.ButtonView.design({value:M.I18N.l("back"),icon:"arrow-l",anchorLocation:M.LEFT,events:{tap:{target:DigiWebApp.NavigationController,action:"backToMediaListPageTransition"}}}),title:M.LabelView.design({value:M.I18N.l("settings"),anchorLocation:M.CENTER}),
anchorLocation:M.TOP}),content:M.ScrollView.design({childViews:"audioIcon grid",audioIcon:M.ImageView.design({value:"theme/images/icon_record.png",cssClass:"audioIcon",events:{tap:{target:DigiWebApp.AudioController,action:"recordAudio"}}}),recordIcon:M.ImageView.design({value:"theme/images/icon_record.png",cssClass:"mediaIcon",events:{tap:{action:DigiWebApp.AudioController.recordAudio}}}),stopRecordIcon:M.ImageView.design({value:"theme/images/icon_stop.png",cssClass:"mediaIcon",events:{tap:{action:DigiWebApp.AudioController.stopRecord}}}),
playIcon:M.ImageView.design({value:"theme/images/icon_playbackAudio.png",cssClass:"mediaIcon",events:{tap:{action:DigiWebApp.AudioController.playbackAudio}}}),stopIcon:M.ImageView.design({value:"theme/images/icon_stop.png",cssClass:"mediaIcon",events:{tap:{action:DigiWebApp.AudioController.stopPlayback}}}),grid:M.GridView.design({childViews:"button icon",layout:{cssClass:"marginTop40 digiButton",columns:{0:"button",1:"icon"}},button:M.ButtonView.design({value:M.I18N.l("recordAudio"),cssClass:"digiButton",
anchorLocation:M.RIGHT,events:{tap:{target:DigiWebApp.AudioController,action:"recordAudio"}}}),icon:M.ImageView.design({value:"theme/images/icon_bookTime.png"})})})});
DigiWebApp.BautagebuchBautagesberichtDetailsPage=M.PageView.design({events:{pagebeforeshow:{action:function(){if(DigiWebApp.BautagebuchBautagesberichtDetailsController.datum){var a=DigiWebApp.BautagebuchBautagesberichtDetailsController.datum.split(".");DigiWebApp.BautagebuchBautagesberichtDetailsController.set("datumAsDate",a[2]+"-"+a[1]+"-"+a[0])}a=_.map(DigiWebApp.BautagebuchMainController.projektleiter,function(d){if(typeof d==="undefined")console.log("UNDEFINED PROJEKTLEADER");else{if(DigiWebApp.BautagebuchBautagesberichtDetailsController.projektleiterId)d.isSelected=
d.value===DigiWebApp.BautagebuchBautagesberichtDetailsController.projektleiterId;return d}});a=_.compact(a);DigiWebApp.BautagebuchBautagesberichtDetailsController.set("projektleiterList",a);a=_.map(DigiWebApp.BautagebuchMainController.auftraege,function(d){if(typeof d==="undefined")console.log("UNDEFINED ORDER");else{if(DigiWebApp.BautagebuchBautagesberichtDetailsController.auftragsId)d.isSelected=d.value===DigiWebApp.BautagebuchBautagesberichtDetailsController.auftragsId;return d}});a=_.compact(a);
DigiWebApp.BautagebuchBautagesberichtDetailsController.set("auftraegeList",a);if(DigiWebApp.BautagebuchBautagesberichtDetailsController.auftragsId)DigiWebApp.BautagebuchBautagesberichtDetailsController.setPositionen(DigiWebApp.BautagebuchBautagesberichtDetailsController.auftragsId);else{a=_.map(DigiWebApp.BautagebuchMainController.positionen,function(d){if(typeof d==="undefined")console.log("UNDEFINED POSITION");else return d});a=_.compact(a);DigiWebApp.BautagebuchBautagesberichtDetailsController.set("positionenList",
a)}var b=DigiWebApp.BautagebuchBautagesberichtDetailsController.mitarbeiterIds;a=JSON.parse(JSON.stringify(DigiWebApp.BautagebuchMainController.mitarbeiter));var c=[];c=b&&b.length!==0?_.map(a,function(d){var e=NO;_.each(b,function(f){if(f===d.value)e=YES});d.isSelected=e===YES;return d}):DigiWebApp.BautagebuchMainController.mitarbeiter;c=_.compact(c);DigiWebApp.BautagebuchBautagesberichtDetailsController.set("mitarbeiterList",c);c=[];a=JSON.parse(JSON.stringify(DigiWebApp.BautagebuchMainController.mitarbeiter));
if(b&&b.length!==0)c=_.map(a,function(d){var e=NO;_.each(b,function(f){if(f===d.value)e=YES});if(e){d.isSelected=YES;return d}});c=_.compact(c);DigiWebApp.BautagebuchBautagesberichtDetailsController.set("mitarbeiterListSelected",c);if(DigiWebApp.SettingsController.getSetting("bautagebuchLimit_autoStartUhrzeit")){$(DigiWebApp.BautagebuchBautagesberichtDetailsPage.content.startUhrzeitContainer.plusGrid.stundePlusButton)[0].disable();$(DigiWebApp.BautagebuchBautagesberichtDetailsPage.content.startUhrzeitContainer.plusGrid.minutePlusButton)[0].disable();
$(DigiWebApp.BautagebuchBautagesberichtDetailsPage.content.startUhrzeitContainer.minusGrid.stundeMinusButton)[0].disable();$(DigiWebApp.BautagebuchBautagesberichtDetailsPage.content.startUhrzeitContainer.minusGrid.minuteMinusButton)[0].disable()}else{$(DigiWebApp.BautagebuchBautagesberichtDetailsPage.content.startUhrzeitContainer.plusGrid.stundePlusButton)[0].enable();$(DigiWebApp.BautagebuchBautagesberichtDetailsPage.content.startUhrzeitContainer.plusGrid.minutePlusButton)[0].enable();$(DigiWebApp.BautagebuchBautagesberichtDetailsPage.content.startUhrzeitContainer.minusGrid.stundeMinusButton)[0].enable();
$(DigiWebApp.BautagebuchBautagesberichtDetailsPage.content.startUhrzeitContainer.minusGrid.minuteMinusButton)[0].enable()}$("#"+DigiWebApp.BautagebuchBautagesberichtDetailsPage.content.mitarbeiter_zeiten_ButtonGrid.mitarbeiterButton.id).addClass("bigButton");$("#"+DigiWebApp.BautagebuchBautagesberichtDetailsPage.content.mitarbeiter_zeiten_ButtonGrid.zeitenButton.id).addClass("bigButton");$("#"+DigiWebApp.BautagebuchBautagesberichtDetailsPage.content.material_wetter_ButtonGrid.materialienButton.id).addClass("bigButton");
$("#"+DigiWebApp.BautagebuchBautagesberichtDetailsPage.content.material_wetter_ButtonGrid.wetterButton.id).addClass("bigButton");$("#"+DigiWebApp.BautagebuchBautagesberichtDetailsPage.content.medien_notizen_ButtonGrid.medienButton.id).addClass("bigButton");$("#"+DigiWebApp.BautagebuchBautagesberichtDetailsPage.content.medien_notizen_ButtonGrid.notizenButton.id).addClass("bigButton");DigiWebApp.BautagebuchEinstellungenController.settings.positionVorselektieren||DigiWebApp.BautagebuchBautagesberichtDetailsController.item.get("bautagesberichtTyp")!=
"<standard>"?$("#"+DigiWebApp.BautagebuchBautagesberichtDetailsPage.content.positionComboBox.id).parent().parent().parent().show():$("#"+DigiWebApp.BautagebuchBautagesberichtDetailsPage.content.positionComboBox.id).parent().parent().parent().hide();DigiWebApp.BautagebuchBautagesberichtDetailsController.setStartUhrzeit();DigiWebApp.BautagebuchBautagesberichtDetailsController.get("handOrderId")&&$("#"+DigiWebApp.BautagebuchBautagesberichtDetailsPage.content.positionComboBox.id+"_container").hide();
$("#"+DigiWebApp.BautagebuchBautagesberichtDetailsPage.content.startUhrzeitContainer.startUhrzeitGrid.stundeFeld.id).prop("disabled",true);$("#"+DigiWebApp.BautagebuchBautagesberichtDetailsPage.content.startUhrzeitContainer.startUhrzeitGrid.minuteFeld.id).prop("disabled",true);if(DigiWebApp.BautagebuchEinstellungenController.settings.inStundenBuchen||DigiWebApp.SettingsController.getSetting("bautagebuchLimit_autoStartUhrzeit")){$("label[for='"+DigiWebApp.BautagebuchBautagesberichtDetailsPage.content.startUhrzeitContainer.id+
"']").show();$("#"+DigiWebApp.BautagebuchBautagesberichtDetailsPage.content.startUhrzeitContainer.id).show()}else{$("label[for='"+DigiWebApp.BautagebuchBautagesberichtDetailsPage.content.startUhrzeitContainer.id+"']").hide();$("#"+DigiWebApp.BautagebuchBautagesberichtDetailsPage.content.startUhrzeitContainer.id).hide()}if(DigiWebApp.SettingsController.getSetting("DTC6aktiv")){DigiWebApp.ApplicationController.dtc6AktivRenameHelper(DigiWebApp.BautagebuchBautagesberichtDetailsPage.content.auftragComboBox.id,
M.I18N.l("dtc6Ordner"));DigiWebApp.ApplicationController.dtc6AktivRenameHelper(DigiWebApp.BautagebuchBautagesberichtDetailsPage.content.positionComboBox.id,M.I18N.l("dtc6Auftrag"))}}},pagehide:{action:function(){}}},cssClass:"bautagebuchBautagesberichtDetailsPage",childViews:"header content",header:M.ToolbarView.design({childViews:"backButton title uebersichtButton",cssClass:"header unselectable",isFixed:YES,backButton:M.ButtonView.design({value:M.I18N.l("back"),icon:"arrow-l",anchorLocation:M.LEFT,
events:{tap:{target:DigiWebApp.NavigationController,action:function(){try{DigiWebApp.ApplicationController.vibrate()}catch(a){}this.backToBautagebuchBautagesberichteListePageTransition()}}}}),title:M.LabelView.design({value:"",anchorLocation:M.CENTER,contentBinding:{target:DigiWebApp.BautagebuchBautagesberichtDetailsController,property:"datum"},events:{tap:{action:function(){try{DigiWebApp.ApplicationController.vibrate()}catch(a){}DigiWebApp.SettingsController.getSetting("bautagebuchLimit_autoStartUhrzeit")||
M.DatePickerView.show({source:M.ViewManager.getView("bautagebuchBautagesberichtDetailsPage","title"),initialDate:D8.create(DigiWebApp.BautagebuchBautagesberichtDetailsController.datum),showTimePicker:NO,showDatePicker:YES,dateOrder:"ddMMyy",dateFormat:"dd.mm.yy",timeFormat:"HH:ii",minutesLabel:M.I18N.l("minute"),hoursLabel:M.I18N.l("hour"),dayLabel:M.I18N.l("day"),monthLabel:M.I18N.l("month"),yearLabel:M.I18N.l("year"),dayNamesShort:DigiWebApp.ApplicationController.dayNamesShort,dayNames:DigiWebApp.ApplicationController.dayNames,
monthNamesShort:DigiWebApp.ApplicationController.monthNamesShort,monthNames:DigiWebApp.ApplicationController.monthNames,callbacks:{confirm:{target:this,action:function(b){DigiWebApp.BautagebuchBautagesberichtDetailsController.set("datum",b)}},before:{action:function(){}},cancel:{action:function(){}}}})}}}}),delButton:M.ButtonView.design({value:M.I18N.l("BautagebuchDelete"),icon:"delete",anchorLocation:M.RIGHT,cssClass:"red_background",events:{tap:{action:function(){try{DigiWebApp.ApplicationController.vibrate()}catch(a){}DigiWebApp.BautagebuchBautagesberichtDetailsController.deleteBautagesbericht(DigiWebApp.NavigationController.backToBautagebuchBautagesberichteListePageTransition)}}}}),
uebersichtButton:M.ButtonView.design({value:M.I18N.l("uebersicht"),icon:"forward",anchorLocation:M.RIGHT,events:{tap:{action:function(){try{DigiWebApp.ApplicationController.vibrate()}catch(a){}DigiWebApp.NavigationController.backToBautagebuchBautagesberichteListePageTransition()}}}}),anchorLocation:M.TOP}),content:M.ScrollView.design({childViews:"auftragComboBox positionComboBox projektleiterComboBox startUhrzeitContainer spacer2 spacer3 mitarbeiter_zeiten_ButtonGrid material_wetter_ButtonGrid medien_notizen_ButtonGrid spacer1 grid loeschenButton",
cssClass:"content",spacer1:M.LabelView.design({value:"&nbsp;<br>"}),spacer2:M.LabelView.design({value:"&nbsp;<br>"}),spacer3:M.LabelView.design({value:"&nbsp;<br>"}),startUhrzeitContainer:M.ContainerView.design({label:M.I18N.l("BautagebuchStartUhrzeit"),childViews:"plusGrid startUhrzeitGrid minusGrid",plusGrid:M.GridView.design({childViews:"stundePlusButton trennText minutePlusButton",layout:{cssClass:"timecontainer",columns:{0:"column1",1:"column2",2:"column3"}},stundePlusButton:M.ButtonView.design({value:"+",
cssClass:"plusMinusButton",events:{tap:{action:function(){if(!DigiWebApp.SettingsController.getSetting("bautagebuchLimit_autoStartUhrzeit")){var a=parseIntRadixTen($("#"+DigiWebApp.BautagebuchBautagesberichtDetailsPage.content.startUhrzeitContainer.startUhrzeitGrid.stundeFeld.id)[0].value),b=parseIntRadixTen($("#"+DigiWebApp.BautagebuchBautagesberichtDetailsPage.content.startUhrzeitContainer.startUhrzeitGrid.minuteFeld.id)[0].value);a=(a+1)%24;a=a.padLeft(2,"0")+":"+b.padLeft(2,"0");DigiWebApp.BautagebuchBautagesberichtDetailsController.set("startUhrzeit",
a);DigiWebApp.BautagebuchBautagesberichtDetailsController.setStartUhrzeit()}}}}}),trennText:M.LabelView.design({value:"&nbsp;"}),minutePlusButton:M.ButtonView.design({value:"+",cssClass:"plusMinusButton",events:{tap:{action:function(){if(!DigiWebApp.SettingsController.getSetting("bautagebuchLimit_autoStartUhrzeit")){var a=parseIntRadixTen($("#"+DigiWebApp.BautagebuchBautagesberichtDetailsPage.content.startUhrzeitContainer.startUhrzeitGrid.stundeFeld.id)[0].value),b=parseIntRadixTen($("#"+DigiWebApp.BautagebuchBautagesberichtDetailsPage.content.startUhrzeitContainer.startUhrzeitGrid.minuteFeld.id)[0].value),
c=parseIntRadixTen(DigiWebApp.BautagebuchEinstellungenController.settings.minutenSchritte);if(b+c>59)a=(a+1)%24;b=(b+c)%60;a=a.padLeft(2,"0")+":"+b.padLeft(2,"0");DigiWebApp.BautagebuchBautagesberichtDetailsController.set("startUhrzeit",a);DigiWebApp.BautagebuchBautagesberichtDetailsController.setStartUhrzeit()}}}}})}),startUhrzeitGrid:M.GridView.design({childViews:"stundeFeld trennText minuteFeld",layout:{cssClass:"timecontainer",columns:{0:"column1",1:"column2",2:"column3"}},stundeFeld:M.TextFieldView.design({cssClass:"startUhrzeit",
inputType:M.INPUT_TEXT}),trennText:M.LabelView.design({value:":"}),minuteFeld:M.TextFieldView.design({cssClass:"startUhrzeit",inputType:M.INPUT_TEXT})}),minusGrid:M.GridView.design({childViews:"stundeMinusButton trennText minuteMinusButton",layout:{cssClass:"timecontainer",columns:{0:"column1",1:"column2",2:"column3"}},stundeMinusButton:M.ButtonView.design({value:"-",cssClass:"plusMinusButton",events:{tap:{action:function(){if(!DigiWebApp.SettingsController.getSetting("bautagebuchLimit_autoStartUhrzeit")){var a=
parseIntRadixTen($("#"+DigiWebApp.BautagebuchBautagesberichtDetailsPage.content.startUhrzeitContainer.startUhrzeitGrid.stundeFeld.id)[0].value),b=parseIntRadixTen($("#"+DigiWebApp.BautagebuchBautagesberichtDetailsPage.content.startUhrzeitContainer.startUhrzeitGrid.minuteFeld.id)[0].value);a-=1;if(a<0)a=23;a=a.padLeft(2,"0")+":"+b.padLeft(2,"0");DigiWebApp.BautagebuchBautagesberichtDetailsController.set("startUhrzeit",a);DigiWebApp.BautagebuchBautagesberichtDetailsController.setStartUhrzeit()}}}}}),
trennText:M.LabelView.design({value:"&nbsp;"}),minuteMinusButton:M.ButtonView.design({value:"-",cssClass:"plusMinusButton",events:{tap:{action:function(){if(!DigiWebApp.SettingsController.getSetting("bautagebuchLimit_autoStartUhrzeit")){var a=parseIntRadixTen($("#"+DigiWebApp.BautagebuchBautagesberichtDetailsPage.content.startUhrzeitContainer.startUhrzeitGrid.stundeFeld.id)[0].value),b=parseIntRadixTen($("#"+DigiWebApp.BautagebuchBautagesberichtDetailsPage.content.startUhrzeitContainer.startUhrzeitGrid.minuteFeld.id)[0].value),
c=parseIntRadixTen(DigiWebApp.BautagebuchEinstellungenController.settings.minutenSchritte);if(b-c<0){a-=1;if(a<0)a=23;b=60}b=(b-c)%60;if(b<0)b=60-c;a=a.padLeft(2,"0")+":"+b.padLeft(2,"0");DigiWebApp.BautagebuchBautagesberichtDetailsController.set("startUhrzeit",a);DigiWebApp.BautagebuchBautagesberichtDetailsController.setStartUhrzeit()}}}}})})}),startUhrzeit:M.TextFieldView.design({label:M.I18N.l("BautagebuchStartUhrzeit"),cssClass:"startUhrzeit",inputType:M.INPUT_TIME,contentBindingReverse:{target:DigiWebApp.BautagebuchBautagesberichtDetailsController,
property:"startUhrzeit"},contentBinding:{target:DigiWebApp.BautagebuchBautagesberichtDetailsController,property:"startUhrzeit"},events:{tap:{action:function(){DigiWebApp.SettingsController.getSetting("bautagebuchLimit_autoStartUhrzeit")}}}}),startUhrzeitOld:M.GridView.design({childViews:"startUhrzeitLabel startUhrzeitInput",layout:M.TWO_COLUMNS,startUhrzeitLabel:M.LabelView.design({cssClass:"whiteText",value:M.I18N.l("BautagebuchStartUhrzeit")}),startUhrzeitInput:M.TextFieldView.design({contentBindingReverse:{target:DigiWebApp.BautagebuchBautagesberichtDetailsController,
property:"startUhrzeit"},contentBinding:{target:DigiWebApp.BautagebuchBautagesberichtDetailsController,property:"startUhrzeit"},events:{tap:{action:function(){if(!DigiWebApp.SettingsController.getSetting("bautagebuchLimit_autoStartUhrzeit")){$(DigiWebApp.BautagebuchBautagesberichtDetailsPage.content.startUhrzeit.startUhrzeitInput).blur();M.DatePickerView.show({source:M.ViewManager.getView("bautagebuchBautagesberichtDetailsPage","startUhrzeitInput"),initialDate:D8.create("01.01.1993 "+DigiWebApp.BautagebuchBautagesberichtDetailsController.startUhrzeit),
showTimePicker:YES,showDatePicker:NO,showAmPm:NO,dateOrder:"ddmmyy",dateFormat:"dd.mm.yy",timeFormat:"HH:ii",minutesLabel:M.I18N.l("minute"),hoursLabel:M.I18N.l("hour"),dayLabel:M.I18N.l("day"),monthLabel:M.I18N.l("month"),yearLabel:M.I18N.l("year"),dayNamesShort:DigiWebApp.ApplicationController.dayNamesShort,dayNames:DigiWebApp.ApplicationController.dayNames,monthNamesShort:DigiWebApp.ApplicationController.monthNamesShort,monthNames:DigiWebApp.ApplicationController.monthNames,callbacks:{confirm:{target:this,
action:function(a){DigiWebApp.BautagebuchBautagesberichtDetailsController.set("startUhrzeit",a)}},before:{action:function(){}},cancel:{action:function(){}}}})}}}}})}),projektleiterComboBox:M.SelectionListView.design({selectionMode:M.SINGLE_SELECTION_DIALOG,initialText:M.I18N.l("noData"),label:M.I18N.l("BautagebuchProjektleiter"),applyTheme:NO,contentBinding:{target:DigiWebApp.BautagebuchBautagesberichtDetailsController,property:"projektleiterList"},events:{change:{action:function(){DigiWebApp.BautagebuchBautagesberichtDetailsController.set("projektleiterId",
M.ViewManager.getView("bautagebuchBautagesberichtDetailsPage","projektleiterComboBox").getSelection(YES).value)}}}}),auftragComboBox:M.SelectionListView.design({selectionMode:M.SINGLE_SELECTION_DIALOG,initialText:M.I18N.l("noData"),label:M.I18N.l("order"),applyTheme:NO,contentBinding:{target:DigiWebApp.BautagebuchBautagesberichtDetailsController,property:"auftraegeList"},events:{change:{action:function(){var a=M.ViewManager.getView("bautagebuchBautagesberichtDetailsPage","auftragComboBox").getSelection(YES);
if(a.label==a.value||isGUID(a.value)){DigiWebApp.BautagebuchBautagesberichtDetailsController.set("handOrderId",a.value);DigiWebApp.BautagebuchBautagesberichtDetailsController.set("handOrderName",a.label);$("#"+DigiWebApp.BautagebuchBautagesberichtDetailsPage.content.positionComboBox.id+"_container").hide()}else{DigiWebApp.BautagebuchBautagesberichtDetailsController.set("handOrderId",null);DigiWebApp.BautagebuchBautagesberichtDetailsController.set("handOrderName",null);$("#"+DigiWebApp.BautagebuchBautagesberichtDetailsPage.content.positionComboBox.id+
"_container").show()}DigiWebApp.BautagebuchBautagesberichtDetailsController.set("auftragsId",a.value);DigiWebApp.BautagebuchBautagesberichtDetailsController.set("auftragsName",a.label);DigiWebApp.BautagebuchBautagesberichtDetailsController.setPositionen(M.ViewManager.getView("bautagebuchBautagesberichtDetailsPage","auftragComboBox").getSelection(YES).value);DigiWebApp.BautagebuchEinstellungenController.settings.positionVorselektieren||DigiWebApp.BautagebuchBautagesberichtDetailsController.item.get("bautagesberichtTyp")!=
"<standard>"?$("#"+DigiWebApp.BautagebuchBautagesberichtDetailsPage.content.positionComboBox.id).parent().parent().parent().show():$("#"+DigiWebApp.BautagebuchBautagesberichtDetailsPage.content.positionComboBox.id).parent().parent().parent().hide()}}}}),positionComboBox:M.SelectionListView.design({selectionMode:M.SINGLE_SELECTION_DIALOG,initialText:M.I18N.l("noData"),label:M.I18N.l("position"),applyTheme:NO,contentBinding:{target:DigiWebApp.BautagebuchBautagesberichtDetailsController,property:"positionenList"},
events:{change:{action:function(){DigiWebApp.BautagebuchBautagesberichtDetailsController.set("positionId",M.ViewManager.getView("bautagebuchBautagesberichtDetailsPage","positionComboBox").getSelection(YES).value);DigiWebApp.BautagebuchBautagesberichtDetailsController.set("positionName",M.ViewManager.getView("bautagebuchBautagesberichtDetailsPage","positionComboBox").getSelection(YES).label)}}}}),mitarbeiter_zeiten_ButtonGrid:M.GridView.design({childViews:"mitarbeiterButton zeitenButton",layout:M.TWO_COLUMNS,
mitarbeiterButton:M.GridView.design({childViews:"buttongrid",layout:M.TWO_COLUMNS,buttongrid:M.GridView.design({childViews:"button icon",layout:{cssClass:"bautagebuchButton",columns:{0:"button",1:"icon"}},button:M.ButtonView.design({value:M.I18N.l("employees"),cssClass:"bautagebuchButton",anchorLocation:M.RIGHT,events:{tap:{action:function(){try{DigiWebApp.ApplicationController.vibrate()}catch(a){}DigiWebApp.NavigationController.toBautagebuchMitarbeiterAuswahlPage()}}}}),icon:M.ImageView.design({value:"theme/images/48x48_plain_businessmen.png"})})}),
zeitenButton:M.GridView.design({childViews:"buttongrid",layout:M.TWO_COLUMNS,buttongrid:M.GridView.design({childViews:"button icon",layout:{cssClass:"bautagebuchButton",columns:{0:"button",1:"icon"}},button:M.ButtonView.design({value:M.I18N.l("BautagebuchZeiten"),cssClass:"bautagebuchButton",anchorLocation:M.RIGHT,events:{tap:{action:function(){try{DigiWebApp.ApplicationController.vibrate()}catch(a){}DigiWebApp.BautagebuchZeitbuchung.findSorted(DigiWebApp.BautagebuchBautagesberichtDetailsController.item.get("id")).length>
0?DigiWebApp.BautagebuchBautagesberichtDetailsController.save(DigiWebApp.NavigationController.toBautagebuchZeitenListePageTransition):DigiWebApp.BautagebuchBautagesberichtDetailsController.save(DigiWebApp.BautagebuchZeitenListeController.neu)}}}}),icon:M.ImageView.design({value:"theme/images/48x48_plain_note_view.png"})})})}),medien_notizen_ButtonGrid:M.GridView.design({childViews:"medienButton notizenButton",layout:M.TWO_COLUMNS,notizenButton:M.GridView.design({childViews:"buttongrid",layout:M.TWO_COLUMNS,
buttongrid:M.GridView.design({childViews:"button icon",layout:{cssClass:"bautagebuchButton",columns:{0:"button",1:"icon"}},button:M.ButtonView.design({value:M.I18N.l("BautagebuchNotizen"),cssClass:"bautagebuchButton",anchorLocation:M.RIGHT,events:{tap:{action:function(){try{DigiWebApp.ApplicationController.vibrate()}catch(a){}DigiWebApp.BautagebuchNotizenListeController.init();DigiWebApp.BautagebuchBautagesberichtDetailsController.save(DigiWebApp.BautagebuchNotizenListeController.neu)}}}}),icon:M.ImageView.design({value:"theme/images/48x48_plain_clipboard.png"})})}),
medienButton:M.GridView.design({childViews:"buttongrid",layout:M.TWO_COLUMNS,buttongrid:M.GridView.design({childViews:"button icon",layout:{cssClass:"bautagebuchButton",columns:{0:"button",1:"icon"}},button:M.ButtonView.design({value:M.I18N.l("BautagebuchMedien"),cssClass:"bautagebuchButton",anchorLocation:M.RIGHT,events:{tap:{action:function(){try{DigiWebApp.ApplicationController.vibrate()}catch(a){}DigiWebApp.BautagebuchMedienListeController.init();DigiWebApp.BautagebuchBautagesberichtDetailsController.save(DigiWebApp.BautagebuchMedienListeController.neu)}}}}),
icon:M.ImageView.design({value:"theme/images/48x48_plain_camera2.png"})})})}),material_wetter_ButtonGrid:M.GridView.design({childViews:"materialienButton wetterButton",layout:M.TWO_COLUMNS,materialienButton:M.GridView.design({childViews:"buttongrid",layout:M.TWO_COLUMNS,buttongrid:M.GridView.design({childViews:"button icon",layout:{cssClass:"bautagebuchButton",columns:{0:"button",1:"icon"}},button:M.ButtonView.design({value:M.I18N.l("BautagebuchMaterialien"),cssClass:"bautagebuchButton",anchorLocation:M.RIGHT,
events:{tap:{action:function(){try{DigiWebApp.ApplicationController.vibrate()}catch(a){}DigiWebApp.BautagebuchBautagesberichteListeController.init();DigiWebApp.BautagebuchBautagesberichtDetailsController.save(DigiWebApp.BautagebuchMaterialienListeController.neu)}}}}),icon:M.ImageView.design({value:"theme/images/48x48_plain_shelf.png"})})}),wetterButton:M.GridView.design({childViews:"buttongrid",layout:M.TWO_COLUMNS,buttongrid:M.GridView.design({childViews:"button icon",layout:{cssClass:"bautagebuchButton",
columns:{0:"button",1:"icon"}},button:M.ButtonView.design({value:M.I18N.l("BautagebuchWetter"),cssClass:"bautagebuchButton",anchorLocation:M.RIGHT,events:{tap:{action:function(){try{DigiWebApp.ApplicationController.vibrate()}catch(a){}DigiWebApp.BautagebuchBautagesberichtDetailsController.save(DigiWebApp.NavigationController.toBautagebuchWetterPageTransition)}}}}),icon:M.ImageView.design({value:"theme/images/48x48_plain_cloud_dark.png"})})})}),grid:M.GridView.design({childViews:"speichernButton abschliessenButton",
layout:M.TWO_COLUMNS,speichernButton:M.GridView.design({childViews:"button icon",layout:{cssClass:"digiButton",columns:{0:"button",1:"icon"}},button:M.ButtonView.design({value:M.I18N.l("BautagebuchSpeichern"),cssClass:"digiButton green_background",anchorLocation:M.RIGHT,events:{tap:{action:function(){try{DigiWebApp.ApplicationController.vibrate()}catch(a){}DigiWebApp.BautagebuchBautagesberichtDetailsController.save(DigiWebApp.NavigationController.backToBautagebuchBautagesberichteListePageTransition)}}}}),
icon:M.ImageView.design({value:"theme/images/icon_bookTime.png"})}),abschliessenButton:M.GridView.design({childViews:"button icon",layout:{cssClass:"digiButton",columns:{0:"button",1:"icon"}},button:M.ButtonView.design({value:M.I18N.l("BautagebuchAbschliessen"),cssClass:"digiButton",anchorLocation:M.RIGHT,events:{tap:{action:function(){try{DigiWebApp.ApplicationController.vibrate()}catch(a){}DigiWebApp.BautagebuchBautagesberichtDetailsController.finish()}}}}),icon:M.ImageView.design({value:"theme/images/icon_bookTime.png"})})}),
loeschenButton:M.ButtonView.design({value:M.I18N.l("BautagebuchDelete"),cssClass:"red_background",events:{tap:{action:function(){try{DigiWebApp.ApplicationController.vibrate()}catch(a){}DigiWebApp.BautagebuchBautagesberichtDetailsController.deleteBautagesbericht(DigiWebApp.NavigationController.backToBautagebuchBautagesberichteListePageTransition)}}}})})});
DigiWebApp.BautagebuchBautagesberichtTemplateView=M.ListItemView.design({isSelectable:YES,childViews:"abgeschlossen datum startUhrzeit orderName",events:{tap:{action:function(a){var b=M.ViewManager.getViewById(a).modelId;_.each(DigiWebApp.BautagebuchBautagesberichteListeController.items,function(c){if(c.m_id===b)if(c.get("bautagesberichtTyp")=="<standard>"){DigiWebApp.BautagebuchBautagesberichtDetailsController.load(c);if(c.get("abgeschlossen")===YES){DigiWebApp.BautagebuchZusammenfassungController.load(c);
DigiWebApp.NavigationController.toBautagebuchZusammenfassungPageTransition()}else DigiWebApp.NavigationController.toBautagebuchBautagesberichtDetailsPageTransition()}else if(c.get("bautagesberichtTyp")=="<materialerfassung_only>")DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("materialPickUp"),message:M.I18N.l("nurMaterialErfassung")});else c.get("bautagesberichtTyp")=="<notizen_only>"&&DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("BautagebuchNotizen"),
message:M.I18N.l("nurNotizenErfassung")})})}}},spacer:M.LabelView.design({cssClass:"unselectable marginBottom12",value:" "}),abgeschlossen:M.LabelView.design({cssClass:"bigLabel unselectable",isInline:NO,computedValue:{valuePattern:"<%= abgeschlossen %>",operation:function(a){return parseBool(a)?M.I18N.l("BautagebuchAbgeschlossen"):""}}}),datum:M.LabelView.design({cssClass:"normal unselectable",isInline:YES,computedValue:{valuePattern:"<%= datum %>",operation:function(a){return a&&a!==""?a:""}}}),
startUhrzeit:M.LabelView.design({cssClass:"normal unselectable",isInline:YES,computedValue:{valuePattern:"<%= startUhrzeit %>",operation:function(a){return a&&a!==""?", "+M.I18N.l("BautagebuchStartingFrom")+" "+a:""}}}),orderName:M.LabelView.design({cssClass:"normal unselectable",computedValue:{valuePattern:"<%= orderName %>",operation:function(a){return a&&a!==""?a:""}}})});
DigiWebApp.BautagebuchEinstellungenPage=M.PageView.design({events:{pagebeforeshow:{action:function(){DigiWebApp.BautagebuchEinstellungenController.load();DigiWebApp.BautagebuchEinstellungenController.set("settings",DigiWebApp.BautagebuchEinstellungenController.settings);DigiWebApp.BautagebuchEinstellungenController.setStartUhrzeit();$("#"+DigiWebApp.BautagebuchEinstellungenPage.content.startUhrzeitContainer.startUhrzeitGrid.stundeFeld.id).prop("disabled",true);$("#"+DigiWebApp.BautagebuchEinstellungenPage.content.startUhrzeitContainer.startUhrzeitGrid.minuteFeld.id).prop("disabled",
true)}},pagebeforehide:{action:function(){DigiWebApp.BautagebuchEinstellungenController.save()}}},controller:DigiWebApp.BautagebuchEinstellungenController,navigationController:DigiWebApp.NavigationController,cssClass:"settingsPage",childViews:"header content",header:M.ToolbarView.design({childViews:"backButton title",cssClass:"header unselectable",isFixed:YES,backButton:M.ButtonView.design({value:M.I18N.l("back"),icon:"arrow-l",anchorLocation:M.LEFT,events:{tap:{target:DigiWebApp.NavigationController,
action:function(){try{DigiWebApp.ApplicationController.vibrate()}catch(a){}this.backToBautagebuchBautagesberichteListePageTransition()}}}}),title:M.LabelView.design({value:M.I18N.l("BautagebuchBautagesbericht"),anchorLocation:M.CENTER}),anchorLocation:M.TOP}),content:M.ScrollView.design({childViews:"startUhrzeitContainer inStundenBuchenCheckbox falscheZeitenIgnorierenCheckbox positionVorselektierenCheckbox minutenSchritteCombobox alleMitarbeiterVorselektiertCheckbox",startUhrzeitContainer:M.ContainerView.design({label:M.I18N.l("BautagebuchTaeglicheStartUhrzeit"),
childViews:"plusGrid startUhrzeitGrid minusGrid",plusGrid:M.GridView.design({childViews:"stundePlusButton trennText minutePlusButton",layout:{cssClass:"timecontainer",columns:{0:"column1",1:"column2",2:"column3"}},stundePlusButton:M.ButtonView.design({value:"+",cssClass:"plusMinusButton",events:{tap:{action:function(){var a=parseIntRadixTen($("#"+DigiWebApp.BautagebuchEinstellungenPage.content.startUhrzeitContainer.startUhrzeitGrid.stundeFeld.id)[0].value),b=parseIntRadixTen($("#"+DigiWebApp.BautagebuchEinstellungenPage.content.startUhrzeitContainer.startUhrzeitGrid.minuteFeld.id)[0].value);
a=(a+1)%24;a=a.padLeft(2,"0")+":"+b.padLeft(2,"0");DigiWebApp.BautagebuchEinstellungenController.set("settings.startUhrzeit",a);DigiWebApp.BautagebuchEinstellungenController.setStartUhrzeit()}}}}),trennText:M.LabelView.design({value:"&nbsp;"}),minutePlusButton:M.ButtonView.design({value:"+",cssClass:"plusMinusButton",events:{tap:{action:function(){var a=parseIntRadixTen($("#"+DigiWebApp.BautagebuchEinstellungenPage.content.startUhrzeitContainer.startUhrzeitGrid.stundeFeld.id)[0].value),b=parseIntRadixTen($("#"+
DigiWebApp.BautagebuchEinstellungenPage.content.startUhrzeitContainer.startUhrzeitGrid.minuteFeld.id)[0].value),c=parseIntRadixTen(DigiWebApp.BautagebuchEinstellungenController.settings.minutenSchritte);if(b+c>59)a=(a+1)%24;b=(b+c)%60;a=a.padLeft(2,"0")+":"+b.padLeft(2,"0");DigiWebApp.BautagebuchEinstellungenController.set("settings.startUhrzeit",a);DigiWebApp.BautagebuchEinstellungenController.setStartUhrzeit()}}}})}),startUhrzeitGrid:M.GridView.design({childViews:"stundeFeld trennText minuteFeld",
layout:{cssClass:"timecontainer",columns:{0:"column1",1:"column2",2:"column3"}},stundeFeld:M.TextFieldView.design({cssClass:"startUhrzeit",inputType:M.INPUT_TEXT}),trennText:M.LabelView.design({value:":"}),minuteFeld:M.TextFieldView.design({cssClass:"startUhrzeit",inputType:M.INPUT_TEXT})}),minusGrid:M.GridView.design({childViews:"stundeMinusButton trennText minuteMinusButton",layout:{cssClass:"timecontainer",columns:{0:"column1",1:"column2",2:"column3"}},stundeMinusButton:M.ButtonView.design({value:"-",
cssClass:"plusMinusButton",events:{tap:{action:function(){var a=parseIntRadixTen($("#"+DigiWebApp.BautagebuchEinstellungenPage.content.startUhrzeitContainer.startUhrzeitGrid.stundeFeld.id)[0].value),b=parseIntRadixTen($("#"+DigiWebApp.BautagebuchEinstellungenPage.content.startUhrzeitContainer.startUhrzeitGrid.minuteFeld.id)[0].value);a-=1;if(a<0)a=23;a=a.padLeft(2,"0")+":"+b.padLeft(2,"0");DigiWebApp.BautagebuchEinstellungenController.set("settings.startUhrzeit",a);DigiWebApp.BautagebuchEinstellungenController.setStartUhrzeit()}}}}),
trennText:M.LabelView.design({value:"&nbsp;"}),minuteMinusButton:M.ButtonView.design({value:"-",cssClass:"plusMinusButton",events:{tap:{action:function(){var a=parseIntRadixTen($("#"+DigiWebApp.BautagebuchEinstellungenPage.content.startUhrzeitContainer.startUhrzeitGrid.stundeFeld.id)[0].value),b=parseIntRadixTen($("#"+DigiWebApp.BautagebuchEinstellungenPage.content.startUhrzeitContainer.startUhrzeitGrid.minuteFeld.id)[0].value),c=parseIntRadixTen(DigiWebApp.BautagebuchEinstellungenController.settings.minutenSchritte);
if(b-c<0){a-=1;if(a<0)a=23;b=60}b=(b-c)%60;if(b<0)b=60-c;a=a.padLeft(2,"0")+":"+b.padLeft(2,"0");DigiWebApp.BautagebuchEinstellungenController.set("settings.startUhrzeit",a);DigiWebApp.BautagebuchEinstellungenController.setStartUhrzeit()}}}})})}),inStundenBuchenCheckbox:M.SelectionListView.design({selectionMode:M.MULTIPLE_SELECTION,contentBinding:{target:DigiWebApp.BautagebuchEinstellungenController,property:"settings.inStundenBuchenItem"},events:{change:{target:DigiWebApp.BautagebuchEinstellungenController,
action:function(a){this.settings.inStundenBuchen=a.length===1;this.settings.inStundenBuchenItem.isSelected=a.length===1}}}}),falscheZeitenIgnorierenCheckbox:M.SelectionListView.design({selectionMode:M.MULTIPLE_SELECTION,contentBinding:{target:DigiWebApp.BautagebuchEinstellungenController,property:"settings.falscheZeitenIgnorierenItem"},events:{change:{target:DigiWebApp.BautagebuchEinstellungenController,action:function(a){this.settings.falscheZeitenIgnorieren=a.length===1;this.settings.falscheZeitenIgnorierenItem.isSelected=
a.length===1}}}}),positionVorselektierenCheckbox:M.SelectionListView.design({selectionMode:M.MULTIPLE_SELECTION,contentBinding:{target:DigiWebApp.BautagebuchEinstellungenController,property:"settings.positionVorselektierenItem"},events:{change:{target:DigiWebApp.BautagebuchEinstellungenController,action:function(a){this.settings.positionVorselektieren=a.length===1;this.settings.positionVorselektierenItem.isSelected=a.length===1}}}}),minutenSchritteCombobox:M.SelectionListView.design({selectionMode:M.SINGLE_SELECTION_DIALOG,
label:M.I18N.l("minutenSchritte"),contentBinding:{target:DigiWebApp.BautagebuchEinstellungenController,property:"settings.minutenSchritteItem"},events:{change:{target:DigiWebApp.BautagebuchEinstellungenController,action:function(){var a=this,b=M.ViewManager.getView("bautagebuchEinstellungenPage","minutenSchritteCombobox").getSelection(YES);a.set("settings.minutenSchritte",b.value);b=_.map(a.settings.minutenSchritteItem,function(c){c.isSelected=NO;if(parseIntRadixTen(c.value)==parseIntRadixTen(a.settings.minutenSchritte))c.isSelected=
YES;return c});a.set("settings.minutenSchritteItem",b)}}}}),alleMitarbeiterVorselektiertCheckbox:M.SelectionListView.design({selectionMode:M.MULTIPLE_SELECTION,contentBinding:{target:DigiWebApp.BautagebuchEinstellungenController,property:"settings.alleMitarbeiterVorselektiertItem"},events:{change:{target:DigiWebApp.BautagebuchEinstellungenController,action:function(a){this.settings.alleMitarbeiterVorselektiert=a.length===1;this.settings.alleMitarbeiterVorselektiertItem.isSelected=a.length===1}}}})})});
DigiWebApp.BautagebuchMaterialienDetailsPage=M.PageView.design({events:{pagebeforeshow:{action:function(){var a=NO,b=DigiWebApp.BautagebuchMaterialienDetailsController;if(b.auftragId)b.set("auftraegeList",DigiWebApp.Order.getList({selectedId:b.auftragId}));else if(DigiWebApp.BookingController.currentBooking)if(DigiWebApp.BookingController.currentBooking.get("handOrderId")){b.set("auftraegeList",DigiWebApp.Order.getList({selectedId:DigiWebApp.BookingController.currentBooking.get("handOrderId")}));
b.set("handOrderId",DigiWebApp.BookingController.currentBooking.get("handOrderId"));b.set("handOrderName",DigiWebApp.BookingController.currentBooking.get("handOrderName"))}else{b.set("auftraegeList",DigiWebApp.Order.getList({selectedId:DigiWebApp.BookingController.currentBooking.get("orderId")}));b.set("auftragId",DigiWebApp.BookingController.currentBooking.get("orderId"));b.set("auftragName",DigiWebApp.BookingController.currentBooking.get("orderName"))}else b.set("auftraegeList",DigiWebApp.Order.getList());
_.each(b.auftraegeList,function(g){if(g.isSelected==YES&&parseIntRadixTen(g.value)!=0){b.set("auftragId",parseIntRadixTen(g.value));b.set("auftragName",g.label)}});if(DigiWebApp.BautagebuchBautagesberichtDetailsController.bautagesberichtTyp=="<standard>"){var c=JSON.parse(JSON.stringify(DigiWebApp.BautagebuchBautagesberichtDetailsController.positionenList));_.each(c,function(g){g.isSelected=parseIntRadixTen(g.value)!==0?NO:YES});c=_.map(c,function(g){if(typeof g==="undefined")console.log("UNDEFINED position");
else{if(b.positionId){g.isSelected=g.value===b.positionId;if(g.isSelected)a=YES}return g}});if(!a&&DigiWebApp.BautagebuchEinstellungenController.settings.positionVorselektieren)c=_.map(c,function(g){if(DigiWebApp.BautagebuchBautagesberichtDetailsController.positionId){g.isSelected=g.value===DigiWebApp.BautagebuchBautagesberichtDetailsController.positionId;if(g.isSelected){a=YES;b.set("positionId",g.value);b.set("positionName",g.label)}}return g});c=_.compact(c);c.length>1&&c.push({label:M.I18N.l("selectSomething"),
value:"0",isSelected:!a});if(!a&&c.length==1){c[0].isSelected=YES;b.set("positionId",c[0].value);b.set("positionName",c[0].label)}b.set("positionenList",c)}else{b.setPositionen(b.auftragId);if(DigiWebApp.BookingController.currentBooking){b.set("positionId",DigiWebApp.BookingController.currentBooking.get("positionId"));b.set("positionName",DigiWebApp.BookingController.currentBooking.get("positionName"));_.each(b.positionenList,function(g){g.isSelected=g.value==b.get("positionId")?YES:NO})}}_.each(b.positionenList,
function(g){if(g.isSelected==YES&&parseIntRadixTen(g.value)!=0){b.set("positionId",parseIntRadixTen(g.value));b.set("positionName",g.label)}});b.set("positionenList",b.positionenList);b.setTaetigkeiten(b.positionId);try{_.each(b.activityList,function(g){if(g.isSelected==YES&&parseIntRadixTen(g.value)!=0){b.set("activityId",parseIntRadixTen(g.value));b.set("activityName",g.label)}})}catch(d){trackError(d)}b.setLieferanten(YES);b.setHersteller(YES);b.setMaterialtypen(YES);b.setMaterialgruppen(YES);
b.setMaterialien(YES);b.setMengeneinheiten(YES);M.ViewManager.getView("bautagebuchMaterialienDetailsPage","mengenInput").setValue(DigiWebApp.BautagebuchMaterialienDetailsController.menge);c=DigiWebApp.BautagebuchBautagesberichtDetailsController.get("bautagesberichtTyp");if(DigiWebApp.BautagebuchBautagesberichtDetailsController.item.get("abgeschlossen")&&c=="<standard>"){$("#"+DigiWebApp.BautagebuchMaterialienDetailsPage.content.speichernButton.id).hide();$("#"+DigiWebApp.BautagebuchMaterialienDetailsPage.header.delButton.id).hide()}else{$("#"+
DigiWebApp.BautagebuchMaterialienDetailsPage.content.speichernButton.id).show();$("#"+DigiWebApp.BautagebuchMaterialienDetailsPage.header.delButton.id).show()}if(c=="<materialerfassung_only>"){$("#"+DigiWebApp.BautagebuchMaterialienDetailsPage.content.auftragComboBox.id+"_container").show();$("#"+DigiWebApp.BautagebuchMaterialienDetailsPage.content.materialgruppeComboBox.id+"_container").show()}else{$("#"+DigiWebApp.BautagebuchMaterialienDetailsPage.content.auftragComboBox.id+"_container").hide();
$("#"+DigiWebApp.BautagebuchMaterialienDetailsPage.content.materialgruppeComboBox.id+"_container").hide()}b.get("handOrderId")?$("#"+DigiWebApp.BautagebuchMaterialienDetailsPage.content.positionComboBox.id+"_container").hide():$("#"+DigiWebApp.BautagebuchMaterialienDetailsPage.content.positionComboBox.id+"_container").show();$("#"+DigiWebApp.BautagebuchMaterialienDetailsPage.content.activityComboBox.id+"_container").hide();$("#"+DigiWebApp.BautagebuchMaterialienDetailsPage.content.materialtypComboBox.id+
"_container").hide();$("#"+DigiWebApp.BautagebuchMaterialienDetailsPage.content.herstellerComboBox.id+"_container").hide();$("#"+DigiWebApp.BautagebuchMaterialienDetailsPage.content.lieferantComboBox.id+"_container").hide();try{var e=$("#"+DigiWebApp.BautagebuchMaterialienDetailsPage.content.mengeGrid.mengenInput.id)[0];if(onAndroid&&onSamsung&&(onAndroid23||onAndroid3||onAndroid4)||parseBool(DigiWebApp.SettingsController.getSetting("mengeneingabeMitTelKeyboard")))e.type="tel"}catch(f){}DigiWebApp.ApplicationController.DigiLoaderView.hide();
if(DigiWebApp.SettingsController.getSetting("DTC6aktiv")){DigiWebApp.ApplicationController.dtc6AktivRenameHelper(DigiWebApp.BautagebuchMaterialienDetailsPage.content.auftragComboBox.id,M.I18N.l("dtc6Ordner"));DigiWebApp.ApplicationController.dtc6AktivRenameHelper(DigiWebApp.BautagebuchMaterialienDetailsPage.content.positionComboBox.id,M.I18N.l("dtc6Auftrag"));DigiWebApp.ApplicationController.dtc6AktivRenameHelper(DigiWebApp.BautagebuchMaterialienDetailsPage.content.activityComboBox.id,M.I18N.l("dtc6Leistung"))}}},
pagehide:{action:function(){}}},cssClass:"bautagebuchMaterialienDetailsPage",childViews:"header content",header:M.ToolbarView.design({childViews:"backButton title uebersichtButton",cssClass:"header unselectable",isFixed:YES,backButton:M.ButtonView.design({value:M.I18N.l("back"),icon:"arrow-l",anchorLocation:M.LEFT,events:{tap:{action:function(){try{DigiWebApp.ApplicationController.vibrate()}catch(a){}history.back()}}}}),title:M.LabelView.design({value:M.I18N.l("BautagebuchMaterial"),anchorLocation:M.CENTER}),
delButton:M.ButtonView.design({value:M.I18N.l("BautagebuchDelete"),icon:"delete",anchorLocation:M.RIGHT,cssClass:"red_background",events:{tap:{target:DigiWebApp.BautagebuchMaterialienDetailsController,action:function(){try{DigiWebApp.ApplicationController.vibrate()}catch(a){}this.deleteMaterialbuchung()}}}}),uebersichtButton:M.ButtonView.design({value:M.I18N.l("uebersicht"),icon:"forward",anchorLocation:M.RIGHT,events:{tap:{target:DigiWebApp.BautagebuchMaterialienDetailsController,action:function(){try{DigiWebApp.ApplicationController.vibrate()}catch(a){}DigiWebApp.NavigationController.backToBautagebuchMaterialienListePageTransition()}}}}),
anchorLocation:M.TOP}),content:M.ScrollView.design({childViews:"auftragComboBox positionComboBox activityComboBox materialtypComboBox materialgruppeComboBox herstellerComboBox lieferantComboBox materialComboBox materialInput spacer1 mengeGrid speichernButton loeschenButton",cssClass:"content",spacer1:M.LabelView.design({value:"&nbsp;<br>"}),spacer2:M.LabelView.design({value:"&nbsp;<br>"}),spacer3:M.LabelView.design({value:"&nbsp;<br>"}),auftragComboBox:M.SelectionListView.design({selectionMode:M.SINGLE_SELECTION_DIALOG,
initialText:M.I18N.l("noData"),label:M.I18N.l("order"),applyTheme:NO,contentBinding:{target:DigiWebApp.BautagebuchMaterialienDetailsController,property:"auftraegeList"},events:{change:{action:function(){var a=M.ViewManager.getView("bautagebuchMaterialienDetailsPage","auftragComboBox").getSelection(YES);if(a.label==a.value||isGUID(a.value)){DigiWebApp.BautagebuchMaterialienDetailsController.set("auftragId",null);DigiWebApp.BautagebuchMaterialienDetailsController.set("auftragName",null);DigiWebApp.BautagebuchMaterialienDetailsController.set("handOrderId",
a.value);DigiWebApp.BautagebuchMaterialienDetailsController.set("handOrderName",a.label);$("#"+DigiWebApp.BautagebuchMaterialienDetailsPage.content.positionComboBox.id+"_container").hide()}else{DigiWebApp.BautagebuchMaterialienDetailsController.set("auftragId",a.value);DigiWebApp.BautagebuchMaterialienDetailsController.set("auftragName",a.label);DigiWebApp.BautagebuchMaterialienDetailsController.set("handOrderId",null);DigiWebApp.BautagebuchMaterialienDetailsController.set("handOrderName",null);$("#"+
DigiWebApp.BautagebuchMaterialienDetailsPage.content.positionComboBox.id+"_container").show()}DigiWebApp.BautagebuchMaterialienDetailsController.setPositionen(M.ViewManager.getView("bautagebuchMaterialienDetailsPage","auftragComboBox").getSelection(YES).value)}}}}),positionComboBox:M.SelectionListView.design({selectionMode:M.SINGLE_SELECTION_DIALOG,initialText:M.I18N.l("noData"),label:M.I18N.l("position"),applyTheme:NO,contentBinding:{target:DigiWebApp.BautagebuchMaterialienDetailsController,property:"positionenList"},
events:{change:{action:function(){DigiWebApp.BautagebuchMaterialienDetailsController.set("positionId",M.ViewManager.getView("bautagebuchMaterialienDetailsPage","positionComboBox").getSelection(YES).value);DigiWebApp.BautagebuchMaterialienDetailsController.set("positionName",M.ViewManager.getView("bautagebuchMaterialienDetailsPage","positionComboBox").getSelection(YES).label);DigiWebApp.BautagebuchMaterialienDetailsController.setTaetigkeiten(M.ViewManager.getView("bautagebuchMaterialienDetailsPage",
"positionComboBox").getSelection(YES).value)}}}}),activityComboBox:M.SelectionListView.design({selectionMode:M.SINGLE_SELECTION_DIALOG,initialText:M.I18N.l("noData"),label:M.I18N.l("activity"),applyTheme:NO,contentBinding:{target:DigiWebApp.BautagebuchMaterialienDetailsController,property:"activityList"},events:{change:{action:function(){DigiWebApp.BautagebuchMaterialienDetailsController.set("activityId",M.ViewManager.getView("bautagebuchMaterialienDetailsPage","activityComboBox").getSelection(YES).value);
DigiWebApp.BautagebuchMaterialienDetailsController.set("activityName",M.ViewManager.getView("bautagebuchMaterialienDetailsPage","activityComboBox").getSelection(YES).label)}}}}),materialtypComboBox:M.SelectionListView.design({selectionMode:M.SINGLE_SELECTION_DIALOG,initialText:M.I18N.l("noData"),label:M.I18N.l("BautagebuchMaterialtyp"),applyTheme:NO,contentBinding:{target:DigiWebApp.BautagebuchMaterialienDetailsController,property:"materialtypenList"},events:{change:{action:function(){DigiWebApp.BautagebuchMaterialienDetailsController.set("materialtypId",
M.ViewManager.getView("bautagebuchMaterialienDetailsPage","materialtypComboBox").getSelection(YES).value);DigiWebApp.BautagebuchMaterialienDetailsController.set("materialtypBezeichnung",M.ViewManager.getView("bautagebuchMaterialienDetailsPage","materialtypComboBox").getSelection(YES).label);DigiWebApp.BautagebuchMaterialienDetailsController.setMaterialien()}}}}),materialgruppeComboBox:M.SelectionListView.design({selectionMode:M.SINGLE_SELECTION_DIALOG,initialText:M.I18N.l("noData"),label:M.I18N.l("BautagebuchMaterialgruppe"),
applyTheme:NO,contentBinding:{target:DigiWebApp.BautagebuchMaterialienDetailsController,property:"materialgruppenList"},events:{change:{action:function(){DigiWebApp.BautagebuchMaterialienDetailsController.set("materialgruppeId",M.ViewManager.getView("bautagebuchMaterialienDetailsPage","materialgruppeComboBox").getSelection(YES).value);DigiWebApp.BautagebuchMaterialienDetailsController.set("materialgruppeBezeichnung",M.ViewManager.getView("bautagebuchMaterialienDetailsPage","materialgruppeComboBox").getSelection(YES).label);
DigiWebApp.BautagebuchMaterialienDetailsController.setMaterialien()}}}}),herstellerComboBox:M.SelectionListView.design({selectionMode:M.SINGLE_SELECTION_DIALOG,initialText:M.I18N.l("noData"),label:M.I18N.l("BautagebuchHersteller"),applyTheme:NO,contentBinding:{target:DigiWebApp.BautagebuchMaterialienDetailsController,property:"herstellerList"},events:{change:{action:function(){DigiWebApp.BautagebuchMaterialienDetailsController.set("herstellerId",M.ViewManager.getView("bautagebuchMaterialienDetailsPage",
"herstellerComboBox").getSelection(YES).value);DigiWebApp.BautagebuchMaterialienDetailsController.set("herstellerBezeichnung",M.ViewManager.getView("bautagebuchMaterialienDetailsPage","herstellerComboBox").getSelection(YES).label);DigiWebApp.BautagebuchMaterialienDetailsController.setMaterialien()}}}}),lieferantComboBox:M.SelectionListView.design({selectionMode:M.SINGLE_SELECTION_DIALOG,initialText:M.I18N.l("noData"),label:M.I18N.l("BautagebuchLieferant"),applyTheme:NO,contentBinding:{target:DigiWebApp.BautagebuchMaterialienDetailsController,
property:"lieferantenList"},events:{change:{action:function(){DigiWebApp.BautagebuchMaterialienDetailsController.set("lieferantId",M.ViewManager.getView("bautagebuchMaterialienDetailsPage","lieferantComboBox").getSelection(YES).value);DigiWebApp.BautagebuchMaterialienDetailsController.set("lieferantBezeichnung",M.ViewManager.getView("bautagebuchMaterialienDetailsPage","lieferantComboBox").getSelection(YES).label);DigiWebApp.BautagebuchMaterialienDetailsController.setMaterialien()}}}}),materialComboBox:M.SelectionListView.design({selectionMode:M.SINGLE_SELECTION_DIALOG,
initialText:M.I18N.l("noData"),label:M.I18N.l("BautagebuchMaterial"),applyTheme:NO,contentBinding:{target:DigiWebApp.BautagebuchMaterialienDetailsController,property:"materialienList"},events:{change:{action:function(a){var b=DigiWebApp.BautagebuchMaterialienDetailsController;b.set("materialId",M.ViewManager.getView("bautagebuchMaterialienDetailsPage","materialComboBox").getSelection(YES).value);if(a===0||parseIntRadixTen(a)===0)$("#"+DigiWebApp.BautagebuchMaterialienDetailsPage.content.materialInput.id).parent().show();
else{$("#"+DigiWebApp.BautagebuchMaterialienDetailsPage.content.materialInput.id).parent().hide();b.set("artikel",M.ViewManager.getView("bautagebuchMaterialienDetailsPage","materialComboBox").getSelection(YES).label)}b.set("mengeneinheitId",null);b.setMengeneinheiten()}}}}),materialInput:M.TextFieldView.design({cssClass:"materialInput",events:{keyup:{action:function(){DigiWebApp.BautagebuchMaterialienDetailsController.set("artikel",M.ViewManager.getView("bautagebuchMaterialienDetailsPage","materialInput").getValue())}}}}),
mengeGrid:M.GridView.design({childViews:"mengenInput mengeneinheitComboBox",layout:M.TWO_COLUMNS,label:M.I18N.l("BautagebuchMenge"),mengeneinheitComboBox:M.SelectionListView.design({selectionMode:M.SINGLE_SELECTION_DIALOG,initialText:M.I18N.l("noData"),applyTheme:NO,contentBinding:{target:DigiWebApp.BautagebuchMaterialienDetailsController,property:"mengeneinheitenList"},events:{change:{action:function(a){DigiWebApp.BautagebuchMaterialienDetailsController.set("mengeneinheitId",M.ViewManager.getView("bautagebuchMaterialienDetailsPage",
"mengeneinheitComboBox").getSelection(YES).value);if(!(a===0||parseIntRadixTen(a)===0)){a=M.ViewManager.getView("bautagebuchMaterialienDetailsPage","mengeneinheitComboBox").getSelection(YES).value;a=DigiWebApp.BautagebuchMengeneinheit.findSorted(a)[0].get("kuerzel");DigiWebApp.BautagebuchMaterialienDetailsController.set("einheit",a)}}}}}),mengeneinheitInput:M.TextFieldView.design({events:{keyup:{action:function(){DigiWebApp.BautagebuchMaterialienDetailsController.set("einheit",M.ViewManager.getView("bautagebuchMaterialienDetailsPage",
"mengeneinheitInput").getValue())}}}}),mengenInput:M.TextFieldView.design({inputType:M.INPUT_NUMBER,cssClass:"mengeInput",inputStep:"any",onlyPositiveValues:YES,events:{keyup:{action:function(){DigiWebApp.BautagebuchMaterialienDetailsController.set("menge",M.ViewManager.getView("bautagebuchMaterialienDetailsPage","mengenInput").getValue())}}}})}),speichernButton:M.GridView.design({childViews:"button icon",layout:{cssClass:"digiButton",columns:{0:"button",1:"icon"}},button:M.ButtonView.design({value:M.I18N.l("save"),
cssClass:"digiButton green_background",anchorLocation:M.RIGHT,events:{tap:{target:DigiWebApp.BautagebuchMaterialienDetailsController,action:function(){try{DigiWebApp.ApplicationController.vibrate()}catch(a){}var b=DigiWebApp.BautagebuchMaterialienDetailsController;b.set("materialId",M.ViewManager.getView("bautagebuchMaterialienDetailsPage","materialComboBox").getSelection(YES).value);var c=M.ViewManager.getView("bautagebuchMaterialienDetailsPage","materialComboBox").getSelection(YES).value;if(c==
0||parseIntRadixTen(c)==0)$("#"+DigiWebApp.BautagebuchMaterialienDetailsPage.content.materialInput.id).parent().show();else{$("#"+DigiWebApp.BautagebuchMaterialienDetailsPage.content.materialInput.id).parent().hide();b.set("artikel",M.ViewManager.getView("bautagebuchMaterialienDetailsPage","materialComboBox").getSelection(YES).label)}b.set("menge",M.ViewManager.getView("bautagebuchMaterialienDetailsPage","mengenInput").getValue());this.save()}}}}),icon:M.ImageView.design({value:"theme/images/icon_bookTime.png"})}),
loeschenButton:M.ButtonView.design({value:M.I18N.l("BautagebuchDelete"),cssClass:"red_background",events:{tap:{target:DigiWebApp.BautagebuchMaterialienDetailsController,action:function(){try{DigiWebApp.ApplicationController.vibrate()}catch(a){}this.deleteMaterialbuchung()}}}})})});
DigiWebApp.BautagebuchMaterialienTemplateView=M.ListItemView.design({isSelectable:YES,childViews:"orderName positionName handOrderName activityName spacer menge einheit artikel",events:{tap:{action:function(a){var b=M.ViewManager.getViewById(a).modelId;_.each(DigiWebApp.BautagebuchMaterialienListeController.items,function(c){c.m_id===b&&DigiWebApp.BautagebuchMaterialienDetailsController.load(c)});DigiWebApp.NavigationController.toBautagebuchMaterialienDetailsPageTransition()}}},spacer:M.LabelView.design({value:""}),
orderName:M.LabelView.design({cssClass:"normal unselectable",isInline:YES,computedValue:{valuePattern:"<%= orderName %>",operation:function(a){return a!==""&&a!==null&&DigiWebApp.BautagebuchBautagesberichtDetailsController.bautagesberichtTyp!="<standard>"?a:""}}}),positionName:M.LabelView.design({cssClass:"normal unselectable",isInline:YES,computedValue:{valuePattern:"<%= positionName %>",operation:function(a){return a!==""&&a!==null?DigiWebApp.BautagebuchBautagesberichtDetailsController.bautagesberichtTyp==
"<standard>"?a:", "+a:""}}}),handOrderName:M.LabelView.design({cssClass:"normal unselectable",isInline:YES,computedValue:{valuePattern:"<%= handOrderName %>",operation:function(a){return a!==""&&a!==null?a:""}}}),activityName:M.LabelView.design({cssClass:"normal unselectable",isInline:YES,computedValue:{valuePattern:"<%= activityName %>",operation:function(a){return a!==""&&a!==null?", "+a+":":":"}}}),menge:M.LabelView.design({cssClass:"normal unselectable",isInline:YES,computedValue:{valuePattern:"<%= menge %>",
operation:function(a){return a!==""&&a!==null?a:""}}}),einheit:M.LabelView.design({cssClass:"normal unselectable",isInline:YES,computedValue:{valuePattern:"<%= einheit %>",operation:function(a){return a!==""&&a!==null?" "+a:""}}}),artikel:M.LabelView.design({cssClass:"normal unselectable",isInline:YES,computedValue:{valuePattern:"<%= artikel %>",operation:function(a){return a!==""&&a!==null?' "'+a+'"':""}}})});m_require("app/views/BautagebuchMaterialienTemplateView");
DigiWebApp.BautagebuchMaterialienListePage=M.PageView.design({events:{pagebeforeshow:{target:DigiWebApp.BautagebuchMaterialienListeController,action:"init"}},childViews:"header uebertragenButton content",cssClass:"bautagebuchListePage unselectable",header:M.ToolbarView.design({childViews:"backButton title newButton",cssClass:"header unselectable",isFixed:YES,backButton:M.ButtonView.design({value:M.I18N.l("back"),icon:"arrow-l",anchorLocation:M.LEFT,events:{tap:{target:DigiWebApp.NavigationController,
action:function(){try{DigiWebApp.ApplicationController.vibrate()}catch(a){}var b=DigiWebApp.BautagebuchBautagesberichtDetailsController.get("bautagesberichtTyp");if(b=="<standard>")this.backToBautagebuchBautagesberichtDetailsPageTransition();else b=="<materialerfassung_only>"?DigiWebApp.NavigationController.backToDashboardPage():history.back()}}}}),title:M.LabelView.design({value:M.I18N.l("BautagebuchMaterialien"),anchorLocation:M.CENTER}),newButton:M.ButtonView.design({value:M.I18N.l("BautagebuchAdd"),
icon:"new",anchorLocation:M.RIGHT,cssClass:"green_background",events:{tap:{action:function(){try{DigiWebApp.ApplicationController.vibrate()}catch(a){}DigiWebApp.BautagebuchMaterialienListeController.neu()}}}}),anchorLocation:M.TOP}),uebertragenButton:M.ButtonView.design({value:M.I18N.l("BautagebuchUebertragen"),events:{tap:{action:function(){DigiWebApp.BautagebuchDatenuebertragungController.ausgekoppelteMaterialerfassungSenden(function(){DigiWebApp.BautagebuchMaterialienListeController.init()})}}}}),
content:M.ScrollView.design({childViews:"list",list:M.ListView.design({contentBinding:{target:DigiWebApp.BautagebuchMaterialienListeController,property:"items"},listItemTemplateView:DigiWebApp.BautagebuchMaterialienTemplateView})})});
DigiWebApp.BautagebuchMedienDetailsPage=M.PageView.design({events:{pagebeforeshow:{action:function(){var a=NO,b=DigiWebApp.BautagebuchMedienDetailsController,c=JSON.parse(JSON.stringify(DigiWebApp.BautagebuchBautagesberichtDetailsController.positionenList));_.each(c,function(e){e.isSelected=parseIntRadixTen(e.value)!==0?NO:YES});c=_.map(c,function(e){if(typeof e==="undefined")console.log("UNDEFINED position");else{if(b.positionId){e.isSelected=e.value===b.positionId;if(e.isSelected)a=YES}return e}});
if(!a&&DigiWebApp.BautagebuchEinstellungenController.settings.positionVorselektieren)c=_.map(c,function(e){if(DigiWebApp.BautagebuchBautagesberichtDetailsController.positionId){e.isSelected=e.value===DigiWebApp.BautagebuchBautagesberichtDetailsController.positionId;if(e.isSelected){a=YES;b.set("positionId",e.value);b.set("positionName",e.label)}}return e});c=_.compact(c);c.length>1&&c.push({label:M.I18N.l("selectSomething"),value:"0",isSelected:!a});if(!a&&c.length==1){c[0].isSelected=YES;b.set("positionId",
c[0].value);b.set("positionName",c[0].label)}b.set("positionenList",c);_.each(b.positionenList,function(e){if(e.isSelected==YES&&parseIntRadixTen(e.value)!=0){b.set("positionId",parseIntRadixTen(e.value));b.set("positionName",e.label)}});b.setTaetigkeiten(b.positionId);try{_.each(b.activityList,function(e){if(e.isSelected==YES&&parseIntRadixTen(e.value)!=0){b.set("activityId",parseIntRadixTen(e.value));b.set("activityName",e.label)}})}catch(d){trackError(d)}M.ViewManager.getView("bautagebuchMedienDetailsPage",
"remarkInput").setValue(DigiWebApp.BautagebuchMedienDetailsController.remark);if(DigiWebApp.BautagebuchBautagesberichtDetailsController.item.get("abgeschlossen")){$("#"+DigiWebApp.BautagebuchMedienDetailsPage.content.grid.id).hide();$("#"+DigiWebApp.BautagebuchMedienDetailsPage.header.delButton.id).hide()}else{$("#"+DigiWebApp.BautagebuchMedienDetailsPage.content.grid.id).show();$("#"+DigiWebApp.BautagebuchMedienDetailsPage.header.delButton.id).show()}$("#"+DigiWebApp.BautagebuchMedienDetailsPage.content.activityComboBox.id+
"_container").hide();b.get("handOrderId")?$("#"+DigiWebApp.BautagebuchMedienDetailsPage.content.positionComboBox.id+"_container").hide():$("#"+DigiWebApp.BautagebuchMedienDetailsPage.content.positionComboBox.id+"_container").show();if(DigiWebApp.SettingsController.getSetting("DTC6aktiv")){DigiWebApp.ApplicationController.dtc6AktivRenameHelper(DigiWebApp.BautagebuchMedienDetailsPage.content.positionComboBox.id,M.I18N.l("dtc6Auftrag"));DigiWebApp.ApplicationController.dtc6AktivRenameHelper(DigiWebApp.BautagebuchMedienDetailsPage.content.activityComboBox.id,
M.I18N.l("dtc6Leistung"))}}},pageshow:{action:function(){}},pagehide:{action:function(){M.ViewManager.getView("bautagebuchMedienDetailsPage","remarkInput").setCssProperty("height","50px")}}},cssClass:"bautagebuchMedienDetailsPage",childViews:"header content",header:M.ToolbarView.design({childViews:"backButton title uebersichtButton",cssClass:"header unselectable",isFixed:YES,backButton:M.ButtonView.design({value:M.I18N.l("back"),icon:"arrow-l",anchorLocation:M.LEFT,events:{tap:{action:function(){try{DigiWebApp.ApplicationController.vibrate()}catch(a){}history.back()}}}}),
title:M.LabelView.design({value:M.I18N.l("BautagebuchMedium"),anchorLocation:M.CENTER}),delButton:M.ButtonView.design({value:M.I18N.l("BautagebuchDelete"),icon:"delete",anchorLocation:M.RIGHT,cssClass:"red_background",events:{tap:{target:DigiWebApp.BautagebuchMedienDetailsController,action:function(){try{DigiWebApp.ApplicationController.vibrate()}catch(a){}this.deleteMedienBuchung()}}}}),uebersichtButton:M.ButtonView.design({value:M.I18N.l("uebersicht"),icon:"forward",anchorLocation:M.RIGHT,events:{tap:{target:DigiWebApp.BautagebuchMedienDetailsController,
action:function(){try{DigiWebApp.ApplicationController.vibrate()}catch(a){}DigiWebApp.NavigationController.backToBautagebuchMedienListePageTransition()}}}}),anchorLocation:M.TOP}),content:M.ScrollView.design({childViews:"positionComboBox activityComboBox image remarkInput grid loeschenButton",cssClass:"content",image:M.ImageView.design({value:"",cssClass:"photo"}),remarkInput:M.TextFieldView.design({label:M.I18N.l("remark"),cssClass:"remarkInput",cssClassOnInit:"remarkInputInitial",initialText:"max. 255 "+
M.I18N.l("characters"),hasMultipleLines:YES,events:{keyup:{action:function(){if(M.ViewManager.getView("bautagebuchMedienDetailsPage","remarkInput").getValue().length<=255)DigiWebApp.BautagebuchMedienDetailsController.set("remark",M.ViewManager.getView("bautagebuchMedienDetailsPage","remarkInput").getValue());else{M.ViewManager.getView("bautagebuchMedienDetailsPage","remarkInput").setValue(DigiWebApp.BautagebuchMedienDetailsController.remark);DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("maximaleFeldlaengeErreicht"),
message:M.I18N.l("maximaleFeldlaengeErreichtMsg")})}}}}}),positionComboBox:M.SelectionListView.design({selectionMode:M.SINGLE_SELECTION_DIALOG,initialText:M.I18N.l("noData"),label:M.I18N.l("position"),applyTheme:NO,contentBinding:{target:DigiWebApp.BautagebuchMedienDetailsController,property:"positionenList"},events:{change:{action:function(){DigiWebApp.BautagebuchMedienDetailsController.set("positionId",M.ViewManager.getView("bautagebuchMedienDetailsPage","positionComboBox").getSelection(YES).value);
DigiWebApp.BautagebuchMedienDetailsController.set("positionName",M.ViewManager.getView("bautagebuchMedienDetailsPage","positionComboBox").getSelection(YES).label);DigiWebApp.BautagebuchMedienDetailsController.setTaetigkeiten(M.ViewManager.getView("bautagebuchMedienDetailsPage","positionComboBox").getSelection(YES).value)}}}}),activityComboBox:M.SelectionListView.design({selectionMode:M.SINGLE_SELECTION_DIALOG,initialText:M.I18N.l("noData"),label:M.I18N.l("activity"),applyTheme:NO,contentBinding:{target:DigiWebApp.BautagebuchMedienDetailsController,
property:"activityList"},events:{change:{action:function(){DigiWebApp.BautagebuchMedienDetailsController.set("activityId",M.ViewManager.getView("bautagebuchMedienDetailsPage","activityComboBox").getSelection(YES).value);DigiWebApp.BautagebuchMedienDetailsController.set("activityName",M.ViewManager.getView("bautagebuchMedienDetailsPage","activityComboBox").getSelection(YES).label)}}}}),grid:M.GridView.design({childViews:"button icon",layout:{cssClass:"digiButton",columns:{0:"button",1:"icon"}},button:M.ButtonView.design({value:M.I18N.l("save"),
cssClass:"digiButton green_background",anchorLocation:M.RIGHT,events:{tap:{target:DigiWebApp.BautagebuchMedienDetailsController,action:function(){try{DigiWebApp.ApplicationController.vibrate()}catch(a){}this.save()}}}}),icon:M.ImageView.design({value:"theme/images/icon_bookTime.png"})}),loeschenButton:M.ButtonView.design({value:M.I18N.l("BautagebuchDelete"),cssClass:"red_background",events:{tap:{target:DigiWebApp.BautagebuchMedienDetailsController,action:function(){try{DigiWebApp.ApplicationController.vibrate()}catch(a){}this.deleteMedienBuchung()}}}})})});
DigiWebApp.BautagebuchMedienTemplateView=M.ListItemView.design({isSelectable:YES,childViews:"positionName handOrderName activityName spacer remark",events:{tap:{action:function(a){var b=M.ViewManager.getViewById(a).modelId;_.each(DigiWebApp.BautagebuchMedienListeController.items,function(c){c.m_id===b&&DigiWebApp.BautagebuchMedienDetailsController.load(c)});DigiWebApp.NavigationController.toBautagebuchMedienDetailsPageTransition()}}},spacer:M.LabelView.design({value:""}),positionName:M.LabelView.design({cssClass:"normal unselectable",
isInline:YES,computedValue:{valuePattern:"<%= positionName %>",operation:function(a){return a!==""&&a!==null?a:""}}}),handOrderName:M.LabelView.design({cssClass:"normal unselectable",isInline:YES,computedValue:{valuePattern:"<%= handOrderName %>",operation:function(a){return a!==""&&a!==null?a:""}}}),activityName:M.LabelView.design({cssClass:"normal unselectable",isInline:YES,computedValue:{valuePattern:"<%= activityName %>",operation:function(a){return a!==""&&a!==null?", "+a+":":":"}}}),remark:M.LabelView.design({cssClass:"small unselectable",
computedValue:{valuePattern:"<%= remark %>",operation:function(a){return a!==""&&a!==null?a.length>50?a.substring(0,50)+"...":a.substring(0,50):""}}})});m_require("app/views/BautagebuchMedienTemplateView");
DigiWebApp.BautagebuchMedienListePage=M.PageView.design({events:{pagebeforeshow:{target:DigiWebApp.BautagebuchMedienListeController,action:"init"}},controller:DigiWebApp.BautagebuchMedienListeController,navigationController:DigiWebApp.NavigationController,childViews:"header content",cssClass:"bautagebuchListePage unselectable",header:M.ToolbarView.design({childViews:"backButton title newButton",cssClass:"header unselectable",isFixed:YES,backButton:M.ButtonView.design({value:M.I18N.l("back"),icon:"arrow-l",
anchorLocation:M.LEFT,events:{tap:{target:DigiWebApp.NavigationController,action:function(){try{DigiWebApp.ApplicationController.vibrate()}catch(a){}this.backToBautagebuchBautagesberichtDetailsPageTransition()}}}}),title:M.LabelView.design({value:M.I18N.l("BautagebuchMedien"),anchorLocation:M.CENTER}),newButton:M.ButtonView.design({value:M.I18N.l("BautagebuchAdd"),icon:"new",anchorLocation:M.RIGHT,cssClass:"green_background",events:{tap:{action:function(){try{DigiWebApp.ApplicationController.vibrate()}catch(a){}DigiWebApp.BautagebuchMedienListeController.neu()}}}}),
anchorLocation:M.TOP}),content:M.ScrollView.design({childViews:"list",list:M.ListView.design({contentBinding:{target:DigiWebApp.BautagebuchMedienListeController,property:"items"},listItemTemplateView:DigiWebApp.BautagebuchMedienTemplateView})})});
DigiWebApp.BautagebuchMitarbeiterAuswahlPage=M.PageView.design({events:{pagebeforeshow:{action:function(){var a=DigiWebApp.BautagebuchBautagesberichtDetailsController.mitarbeiterIds,b=JSON.parse(JSON.stringify(DigiWebApp.BautagebuchMainController.mitarbeiter)),c=[];c=a&&a.length!==0?_.map(b,function(d){var e=NO;_.each(a,function(f){if(f===d.value)e=YES});d.isSelected=e===YES;return d}):DigiWebApp.BautagebuchMainController.mitarbeiter;c=_.compact(c);c=_.sortBy(c,function(d){return d.order});DigiWebApp.BautagebuchBautagesberichtDetailsController.set("mitarbeiterList",
c);c=[];b=JSON.parse(JSON.stringify(DigiWebApp.BautagebuchMainController.mitarbeiter));if(a&&a.length!==0)c=_.map(b,function(d){var e=NO;_.each(a,function(f){if(f===d.value)e=YES});if(e){d.isSelected=YES;return d}});c=_.compact(c);DigiWebApp.BautagebuchBautagesberichtDetailsController.set("mitarbeiterListSelected",c)}},pagehide:{action:function(){}}},cssClass:"bautagebuchMitarbeiterAuswahlPage",childViews:"header content",header:M.ToolbarView.design({childViews:"backButton title",cssClass:"header unselectable",
isFixed:YES,backButton:M.ButtonView.design({value:M.I18N.l("back"),icon:"arrow-l",anchorLocation:M.LEFT,events:{tap:{target:DigiWebApp.NavigationController,action:function(){try{DigiWebApp.ApplicationController.vibrate()}catch(a){}history.back()}}}}),title:M.LabelView.design({value:M.I18N.l("employees"),anchorLocation:M.CENTER}),anchorLocation:M.TOP}),content:M.ScrollView.design({childViews:"mitarbeiterGroup spacer1 grid",cssClass:"content",spacer1:M.LabelView.design({value:"&nbsp;<br>"}),mitarbeiterGroup:M.SelectionListView.design({selectionMode:M.MULTIPLE_SELECTION,
initialText:M.I18N.l("noData"),applyTheme:NO,contentBinding:{target:DigiWebApp.BautagebuchBautagesberichtDetailsController,property:"mitarbeiterList"},events:{change:{action:function(a){for(var b=[],c=0;c<a.length;c++)b.push(a[c]);DigiWebApp.BautagebuchBautagesberichtDetailsController.set("mitarbeiterIds",b);a=[];if(b&&b.length!==0)a=_.map(DigiWebApp.BautagebuchMainController.mitarbeiter,function(d){var e=NO;_.each(b,function(f){if(f===d.value)e=YES});if(e){d.isSelected=YES;return d}});a=_.compact(a);
DigiWebApp.BautagebuchBautagesberichtDetailsController.set("mitarbeiterListSelected",a)}}}}),grid:M.GridView.design({childViews:"button icon",layout:{cssClass:"digiButton",columns:{0:"button",1:"icon"}},button:M.ButtonView.design({value:M.I18N.l("save"),cssClass:"digiButton green_background",anchorLocation:M.RIGHT,events:{tap:{action:function(){try{DigiWebApp.ApplicationController.vibrate()}catch(a){}history.back()}}}}),icon:M.ImageView.design({value:"theme/images/icon_bookTime.png"})})})});
DigiWebApp.BautagebuchNotizenDetailsPage=M.PageView.design({events:{pagebeforeshow:{action:function(){var a=NO,b=DigiWebApp.BautagebuchNotizenDetailsController;if(b.auftragId)b.set("auftraegeList",DigiWebApp.Order.getList({selectedId:b.auftragId}));else if(DigiWebApp.BookingController.currentBooking)if(DigiWebApp.BookingController.currentBooking.get("handOrderId")){b.set("auftraegeList",DigiWebApp.Order.getList({selectedId:DigiWebApp.BookingController.currentBooking.get("handOrderId")}));b.set("handOrderId",
DigiWebApp.BookingController.currentBooking.get("handOrderId"));b.set("handOrderName",DigiWebApp.BookingController.currentBooking.get("handOrderName"))}else{b.set("auftraegeList",DigiWebApp.Order.getList({selectedId:DigiWebApp.BookingController.currentBooking.get("orderId")}));b.set("auftragId",DigiWebApp.BookingController.currentBooking.get("orderId"));b.set("auftragName",DigiWebApp.BookingController.currentBooking.get("orderName"))}else b.set("auftraegeList",DigiWebApp.Order.getList());_.each(b.auftraegeList,
function(e){if(e.isSelected==YES&&parseIntRadixTen(e.value)!=0){b.set("auftragId",parseIntRadixTen(e.value));b.set("auftragName",e.label)}});if(DigiWebApp.BautagebuchBautagesberichtDetailsController.bautagesberichtTyp=="<standard>"){var c=JSON.parse(JSON.stringify(DigiWebApp.BautagebuchBautagesberichtDetailsController.positionenList));_.each(c,function(e){e.isSelected=parseIntRadixTen(e.value)!==0?NO:YES});c=_.map(c,function(e){if(typeof e==="undefined")console.log("UNDEFINED position");else{if(b.positionId){e.isSelected=
e.value===b.positionId;if(e.isSelected)a=YES}return e}});if(!a&&DigiWebApp.BautagebuchEinstellungenController.settings.positionVorselektieren)c=_.map(c,function(e){if(DigiWebApp.BautagebuchBautagesberichtDetailsController.positionId){e.isSelected=e.value===DigiWebApp.BautagebuchBautagesberichtDetailsController.positionId;if(e.isSelected){a=YES;b.set("positionId",e.value);b.set("positionName",e.label)}}return e});c=_.compact(c);c.length>1&&c.push({label:M.I18N.l("selectSomething"),value:"0",isSelected:!a});
if(!a&&c.length==1){c[0].isSelected=YES;b.set("positionId",c[0].value);b.set("positionName",c[0].label)}b.set("positionenList",c)}else{b.setPositionen(b.auftragId);if(DigiWebApp.BookingController.currentBooking){b.set("positionId",DigiWebApp.BookingController.currentBooking.get("positionId"));b.set("positionName",DigiWebApp.BookingController.currentBooking.get("positionName"));_.each(b.positionenList,function(e){e.isSelected=e.value==b.get("positionId")?YES:NO})}}_.each(b.positionenList,function(e){if(e.isSelected==
YES&&parseIntRadixTen(e.value)!=0){b.set("positionId",parseIntRadixTen(e.value));b.set("positionName",e.label)}});b.set("positionenList",b.positionenList);b.setTaetigkeiten(b.positionId);try{_.each(b.activityList,function(e){if(e.isSelected==YES&&parseIntRadixTen(e.value)!=0){b.set("activityId",parseIntRadixTen(e.value));b.set("activityName",e.label)}})}catch(d){trackError(d)}M.ViewManager.getView("bautagebuchNotizenDetailsPage","dataInput").setValue(DigiWebApp.BautagebuchNotizenDetailsController.data);
c=DigiWebApp.BautagebuchBautagesberichtDetailsController.get("bautagesberichtTyp");if(DigiWebApp.BautagebuchBautagesberichtDetailsController.item.get("abgeschlossen")&&c=="<standard>"){$("#"+DigiWebApp.BautagebuchNotizenDetailsPage.content.speichernButton.id).hide();$("#"+DigiWebApp.BautagebuchNotizenDetailsPage.header.delButton.id).hide()}else{$("#"+DigiWebApp.BautagebuchNotizenDetailsPage.content.speichernButton.id).show();$("#"+DigiWebApp.BautagebuchNotizenDetailsPage.header.delButton.id).show()}c==
"<notizen_only>"?$("#"+DigiWebApp.BautagebuchNotizenDetailsPage.content.auftragComboBox.id+"_container").show():$("#"+DigiWebApp.BautagebuchNotizenDetailsPage.content.auftragComboBox.id+"_container").hide();b.get("handOrderId")?$("#"+DigiWebApp.BautagebuchNotizenDetailsPage.content.positionComboBox.id+"_container").hide():$("#"+DigiWebApp.BautagebuchNotizenDetailsPage.content.positionComboBox.id+"_container").show();DigiWebApp.ApplicationController.DigiLoaderView.hide();if(DigiWebApp.SettingsController.getSetting("DTC6aktiv")){DigiWebApp.ApplicationController.dtc6AktivRenameHelper(DigiWebApp.BautagebuchNotizenDetailsPage.content.auftragComboBox.id,
M.I18N.l("dtc6Ordner"));DigiWebApp.ApplicationController.dtc6AktivRenameHelper(DigiWebApp.BautagebuchNotizenDetailsPage.content.positionComboBox.id,M.I18N.l("dtc6Auftrag"));DigiWebApp.ApplicationController.dtc6AktivRenameHelper(DigiWebApp.BautagebuchNotizenDetailsPage.content.activityComboBox.id,M.I18N.l("dtc6Leistung"))}}},pageshow:{action:function(){}},pagehide:{action:function(){M.ViewManager.getView("bautagebuchNotizenDetailsPage","dataInput").setCssProperty("height","400px")}}},cssClass:"bautagebuchNotizenDetailsPage",
childViews:"header content",header:M.ToolbarView.design({childViews:"backButton title uebersichtButton",cssClass:"header unselectable",isFixed:YES,backButton:M.ButtonView.design({value:M.I18N.l("back"),icon:"arrow-l",anchorLocation:M.LEFT,events:{tap:{action:function(){try{DigiWebApp.ApplicationController.vibrate()}catch(a){}history.back()}}}}),title:M.LabelView.design({value:M.I18N.l("BautagebuchNotiz"),anchorLocation:M.CENTER}),delButton:M.ButtonView.design({value:M.I18N.l("BautagebuchDelete"),
icon:"delete",anchorLocation:M.RIGHT,cssClass:"red_background",events:{tap:{target:DigiWebApp.BautagebuchNotizenDetailsController,action:function(){try{DigiWebApp.ApplicationController.vibrate()}catch(a){}this.deleteNotiz()}}}}),uebersichtButton:M.ButtonView.design({value:M.I18N.l("uebersicht"),icon:"forward",anchorLocation:M.RIGHT,events:{tap:{target:DigiWebApp.BautagebuchNotizenDetailsController,action:function(){try{DigiWebApp.ApplicationController.vibrate()}catch(a){}DigiWebApp.NavigationController.backToBautagebuchNotizenListePageTransition()}}}}),
anchorLocation:M.TOP}),content:M.ScrollView.design({childViews:"auftragComboBox positionComboBox activityComboBox dataInput speichernButton loeschenButton",cssClass:"content",auftragComboBox:M.SelectionListView.design({selectionMode:M.SINGLE_SELECTION_DIALOG,initialText:M.I18N.l("noData"),label:M.I18N.l("order"),applyTheme:NO,contentBinding:{target:DigiWebApp.BautagebuchNotizenDetailsController,property:"auftraegeList"},events:{change:{action:function(){var a=M.ViewManager.getView("bautagebuchNotizenDetailsPage",
"auftragComboBox").getSelection(YES);if(a.label==a.value||isGUID(a.value)){DigiWebApp.BautagebuchNotizenDetailsController.set("auftragId",null);DigiWebApp.BautagebuchNotizenDetailsController.set("auftragName",null);DigiWebApp.BautagebuchNotizenDetailsController.set("handOrderId",a.value);DigiWebApp.BautagebuchNotizenDetailsController.set("handOrderName",a.label);$("#"+DigiWebApp.BautagebuchNotizenDetailsPage.content.positionComboBox.id+"_container").hide()}else{DigiWebApp.BautagebuchNotizenDetailsController.set("auftragId",
a.value);DigiWebApp.BautagebuchNotizenDetailsController.set("auftragName",a.label);DigiWebApp.BautagebuchNotizenDetailsController.set("handOrderId",null);DigiWebApp.BautagebuchNotizenDetailsController.set("handOrderName",null);$("#"+DigiWebApp.BautagebuchNotizenDetailsPage.content.positionComboBox.id+"_container").show()}DigiWebApp.BautagebuchNotizenDetailsController.setPositionen(M.ViewManager.getView("bautagebuchNotizenDetailsPage","auftragComboBox").getSelection(YES).value)}}}}),positionComboBox:M.SelectionListView.design({selectionMode:M.SINGLE_SELECTION_DIALOG,
initialText:M.I18N.l("noData"),label:M.I18N.l("position"),applyTheme:NO,contentBinding:{target:DigiWebApp.BautagebuchNotizenDetailsController,property:"positionenList"},events:{change:{action:function(){DigiWebApp.BautagebuchNotizenDetailsController.set("positionId",M.ViewManager.getView("bautagebuchNotizenDetailsPage","positionComboBox").getSelection(YES).value);DigiWebApp.BautagebuchNotizenDetailsController.set("positionName",M.ViewManager.getView("bautagebuchNotizenDetailsPage","positionComboBox").getSelection(YES).label);
DigiWebApp.BautagebuchNotizenDetailsController.setTaetigkeiten(M.ViewManager.getView("bautagebuchNotizenDetailsPage","positionComboBox").getSelection(YES).value)}}}}),activityComboBox:M.SelectionListView.design({selectionMode:M.SINGLE_SELECTION_DIALOG,initialText:M.I18N.l("noData"),label:M.I18N.l("activity"),applyTheme:NO,contentBinding:{target:DigiWebApp.BautagebuchNotizenDetailsController,property:"activityList"},events:{change:{action:function(){DigiWebApp.BautagebuchNotizenDetailsController.set("activityId",
M.ViewManager.getView("bautagebuchNotizenDetailsPage","activityComboBox").getSelection(YES).value);DigiWebApp.BautagebuchNotizenDetailsController.set("activityName",M.ViewManager.getView("bautagebuchNotizenDetailsPage","activityComboBox").getSelection(YES).label)}}}}),dataInput:M.TextFieldView.design({label:M.I18N.l("BautagebuchNotiz"),cssClass:"dataInput",cssClassOnInit:"dataInputInitial",hasMultipleLines:YES,initialText:"max. 4000 "+M.I18N.l("characters"),numberOfChars:4E3,events:{keyup:{action:function(){if(M.ViewManager.getView("bautagebuchNotizenDetailsPage",
"dataInput").getValue().length<=4E3)DigiWebApp.BautagebuchNotizenDetailsController.set("data",M.ViewManager.getView("bautagebuchNotizenDetailsPage","dataInput").getValue());else{M.ViewManager.getView("bautagebuchNotizenDetailsPage","dataInput").setValue(DigiWebApp.BautagebuchNotizenDetailsController.data);DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("maximaleFeldlaengeErreicht"),message:M.I18N.l("maximaleFeldlaengeErreichtMsg")})}}}}}),speichernButton:M.GridView.design({childViews:"button icon",
layout:{cssClass:"digiButton",columns:{0:"button",1:"icon"}},button:M.ButtonView.design({value:M.I18N.l("save"),cssClass:"digiButton green_background",anchorLocation:M.RIGHT,events:{tap:{target:DigiWebApp.BautagebuchNotizenDetailsController,action:function(){try{DigiWebApp.ApplicationController.vibrate()}catch(a){}this.save()}}}}),icon:M.ImageView.design({value:"theme/images/icon_bookTime.png"})}),loeschenButton:M.ButtonView.design({value:M.I18N.l("BautagebuchDelete"),cssClass:"red_background",events:{tap:{target:DigiWebApp.BautagebuchNotizenDetailsController,
action:function(){try{DigiWebApp.ApplicationController.vibrate()}catch(a){}this.deleteNotiz()}}}})})});
DigiWebApp.BautagebuchNotizenTemplateView=M.ListItemView.design({isSelectable:YES,childViews:"orderName positionName handOrderName activityName spacer data",events:{tap:{action:function(a){var b=M.ViewManager.getViewById(a).modelId;_.each(DigiWebApp.BautagebuchNotizenListeController.items,function(c){c.m_id===b&&DigiWebApp.BautagebuchNotizenDetailsController.load(c)});DigiWebApp.NavigationController.toBautagebuchNotizenDetailsPageTransition()}}},spacer:M.LabelView.design({value:""}),orderName:M.LabelView.design({cssClass:"normal unselectable",
isInline:YES,computedValue:{valuePattern:"<%= orderName %>",operation:function(a){return a!==""&&a!==null&&DigiWebApp.BautagebuchBautagesberichtDetailsController.bautagesberichtTyp!="<standard>"?a:""}}}),positionName:M.LabelView.design({cssClass:"normal unselectable",isInline:YES,computedValue:{valuePattern:"<%= positionName %>",operation:function(a){return a!==""&&a!==null?DigiWebApp.BautagebuchBautagesberichtDetailsController.bautagesberichtTyp=="<standard>"?a:", "+a:""}}}),handOrderName:M.LabelView.design({cssClass:"normal unselectable",
isInline:YES,computedValue:{valuePattern:"<%= handOrderName %>",operation:function(a){return a!==""&&a!==null?a:""}}}),activityName:M.LabelView.design({cssClass:"normal unselectable",isInline:YES,computedValue:{valuePattern:"<%= activityName %>",operation:function(a){return a!==""&&a!==null?", "+a+":":":"}}}),data:M.LabelView.design({cssClass:"small unselectable",computedValue:{valuePattern:"<%= data %>",operation:function(a){return a!==""&&a!==null?a.length>50?a.substring(0,50)+"...":a.substring(0,
50):""}}})});m_require("app/views/BautagebuchNotizenTemplateView");
DigiWebApp.BautagebuchNotizenListePage=M.PageView.design({events:{pagebeforeshow:{target:DigiWebApp.BautagebuchNotizenListeController,action:"init"}},controller:DigiWebApp.BautagebuchNotizenListeController,navigationController:DigiWebApp.NavigationController,childViews:"header uebertragenButton content",cssClass:"bautagebuchListePage unselectable",header:M.ToolbarView.design({childViews:"backButton title newButton",cssClass:"header unselectable",isFixed:YES,backButton:M.ButtonView.design({value:M.I18N.l("back"),
icon:"arrow-l",anchorLocation:M.LEFT,events:{tap:{target:DigiWebApp.NavigationController,action:function(){try{DigiWebApp.ApplicationController.vibrate()}catch(a){}var b=DigiWebApp.BautagebuchBautagesberichtDetailsController.get("bautagesberichtTyp");if(b=="<standard>")this.backToBautagebuchBautagesberichtDetailsPageTransition();else b=="<notizen_only>"?DigiWebApp.NavigationController.backToDashboardPage():history.back()}}}}),title:M.LabelView.design({value:M.I18N.l("BautagebuchNotizen"),anchorLocation:M.CENTER}),
newButton:M.ButtonView.design({value:M.I18N.l("BautagebuchAdd"),icon:"new",anchorLocation:M.RIGHT,cssClass:"green_background",events:{tap:{action:function(){try{DigiWebApp.ApplicationController.vibrate()}catch(a){}DigiWebApp.BautagebuchNotizenListeController.neu()}}}}),anchorLocation:M.TOP}),uebertragenButton:M.ButtonView.design({value:M.I18N.l("BautagebuchUebertragen"),events:{tap:{action:function(){DigiWebApp.BautagebuchDatenuebertragungController.ausgekoppelteNotizSenden(function(){DigiWebApp.BautagebuchNotizenListeController.init()})}}}}),
content:M.ScrollView.design({childViews:"list",list:M.ListView.design({contentBinding:{target:DigiWebApp.BautagebuchNotizenListeController,property:"items"},listItemTemplateView:DigiWebApp.BautagebuchNotizenTemplateView})})});
DigiWebApp.BautagebuchNotizenZusammenfassungTemplateView=M.ListItemView.design({isSelectable:YES,childViews:"positionName activityName spacer data",events:{tap:{action:function(a){var b=M.ViewManager.getViewById(a).modelId;_.each(DigiWebApp.BautagebuchNotizenListeController.items,function(c){c.m_id===b&&DigiWebApp.BautagebuchNotizenDetailsController.load(c)});DigiWebApp.NavigationController.toBautagebuchNotizenDetailsPageTransition()}}},spacer:M.LabelView.design({value:""}),positionName:M.LabelView.design({cssClass:"normal unselectable",
isInline:YES,computedValue:{valuePattern:"<%= positionName %>",operation:function(a){return a!==""&&a!==null?a:""}}}),activityName:M.LabelView.design({cssClass:"normal unselectable",isInline:YES,computedValue:{valuePattern:"<%= activityName %>",operation:function(a){return a!==""&&a!==null?", "+a+":":":"}}}),data:M.LabelView.design({cssClass:"small unselectable marginRight40",computedValue:{valuePattern:"<%= data %>",operation:function(a){return a!==""&&a!==null?a:""}}})});
DigiWebApp.BautagebuchTabBar=M.TabBarView.design({childViews:"tabItemMitte",anchorLocation:M.BOTTOM,isFixed:YES,transition:M.TRANSITION.FADE,name:"bautagebuchtabbar",tabItemLinks:M.TabBarItemView.design({value:M.I18N.l("backward"),page:"zeitbuchungenPage",icon:"arrow-l",switchPage:function(){try{DigiWebApp.ApplicationController.vibrate()}catch(a){}that.backwardHandler()}}),tabItemMitte:M.TabBarItemView.design({value:M.I18N.l("Bautagebuch")+" "+M.I18N.l("settings"),page:"bautagebuchEinstellungenPage",
icon:"gear",switchPage:function(){DigiWebApp.BautagebuchEinstellungenController.lastPage=M.ViewManager.getCurrentPage();DigiWebApp.NavigationController.toBautagebuchEinstellungenPageTransition()}}),tabItemRechts:M.TabBarItemView.design({value:M.I18N.l("forward"),page:"zeitbuchungenPage",icon:"arrow-r",switchPage:function(){try{DigiWebApp.ApplicationController.vibrate()}catch(a){}that.forwardHandler()}}),backwardHandler:function(){},forwardHandler:function(){}});m_require("app/views/BautagebuchTabBar.js");
m_require("app/views/BautagebuchBautagesberichtTemplateView");
DigiWebApp.BautagebuchBautagesberichteListePage=M.PageView.design({events:{pagebeforeshow:{target:DigiWebApp.BautagebuchBautagesberichteListeController,action:"init"}},childViews:"header uebertragenButton content tabBar",cssClass:"bautagebuchListePage unselectable",header:M.ToolbarView.design({childViews:"backButton title newButton",cssClass:"header unselectable",isFixed:YES,backButton:M.ButtonView.design({value:M.I18N.l("back"),icon:"arrow-l",anchorLocation:M.LEFT,events:{tap:{target:DigiWebApp.NavigationController,
action:function(){try{DigiWebApp.ApplicationController.vibrate()}catch(a){}this.backToDashboardPage()}}}}),title:M.LabelView.design({value:M.I18N.l("BautagebuchBautagesberichte"),anchorLocation:M.CENTER}),newButton:M.ButtonView.design({value:M.I18N.l("BautagebuchAdd"),icon:"new",anchorLocation:M.RIGHT,cssClass:"green_background",events:{tap:{action:function(){try{DigiWebApp.ApplicationController.vibrate()}catch(a){}DigiWebApp.BautagebuchBautagesberichteListeController.neu()}}}}),anchorLocation:M.TOP}),
uebertragenButton:M.ButtonView.design({value:M.I18N.l("BautagebuchUebertragen"),events:{tap:{action:function(){writeToLog("Bautagebuch: '"+M.I18N.l("BautagebuchUebertragen")+"' gedr\u00fcckt");DigiWebApp.BautagebuchDatenuebertragungController.abgeschlosseneUebertragen()}}}}),content:M.ScrollView.design({childViews:"list",list:M.ListView.design({contentBinding:{target:DigiWebApp.BautagebuchBautagesberichteListeController,property:"items"},listItemTemplateView:DigiWebApp.BautagebuchBautagesberichtTemplateView})}),
tabBar:DigiWebApp.BautagebuchTabBar});
DigiWebApp.BautagebuchWetterPage=M.PageView.design({events:{pagebeforeshow:{action:function(){DigiWebApp.BautagebuchBautagesberichtDetailsController.set("wetterBackup",JSON.parse(JSON.stringify(DigiWebApp.BautagebuchBautagesberichtDetailsController.get("wetter"))))}},pagehide:{action:function(){clearAllIntervals()}}},cssClass:"bautagebuchWetterPage",childViews:"header content",header:M.ToolbarView.design({childViews:"backButton title",cssClass:"header unselectable",isFixed:YES,backButton:M.ButtonView.design({value:M.I18N.l("back"),
icon:"arrow-l",anchorLocation:M.LEFT,events:{tap:{target:DigiWebApp.NavigationController,action:function(){try{DigiWebApp.ApplicationController.vibrate()}catch(a){}clearAllIntervals();DigiWebApp.BautagebuchBautagesberichtDetailsController.set("wetter",JSON.parse(JSON.stringify(DigiWebApp.BautagebuchBautagesberichtDetailsController.wetterBackup)));this.backToBautagebuchBautagesberichtDetailsPageTransition()}}}}),title:M.LabelView.design({value:M.I18N.l("BautagebuchWetter"),anchorLocation:M.CENTER}),
delButton:M.ButtonView.design({value:M.I18N.l("BautagebuchDelete"),icon:"delete",anchorLocation:M.RIGHT,events:{tap:{}}}),anchorLocation:M.TOP}),content:M.ScrollView.design({childViews:"temperaturView luftfeuchteView bewoelkungView niederschlagView windView wechselhaftCheckbox speichernButton",cssClass:"content",spacer1:M.LabelView.design({value:"&nbsp;"}),wechselhaftCheckbox:M.SelectionListView.design({selectionMode:M.MULTIPLE_SELECTION,contentBinding:{target:DigiWebApp.BautagebuchBautagesberichtDetailsController,
property:"wetter.wechselhaftItem"},events:{change:{target:DigiWebApp.BautagebuchBautagesberichtDetailsController,action:function(a){this.wetter.wechselhaft=a.length===1;this.wetter.wechselhaftItem.isSelected=a.length===1}}}}),temperaturView:M.ContainerView.design({childViews:"myLabel myGrid",cssClass:"temperaturView",myLabel:M.LabelView.design({cssClass:"whiteText marginBottom5px",value:M.I18N.l("BautagebuchTemperatur")}),myGrid:M.GridView.design({childViews:"minusButton plusButton TextValue",layout:M.THREE_COLUMNS,
minusButton:M.ButtonView.design({value:"-",events:{tap:{action:function(){try{DigiWebApp.ApplicationController.vibrate()}catch(a){}}},mousedown:{action:function(a,b){if(!(typeof device!="undefined"||onMobile)){var c=function(){var d=DigiWebApp.BautagebuchBautagesberichtDetailsController.wetter;if(d.temperatur!==-50){d.temperatur-=1;DigiWebApp.BautagebuchBautagesberichtDetailsController.set("wetter",d)}};clearAllIntervals();DigiWebApp.BautagebuchMainController.buttonPressInterval_Var=setInterval(c,
DigiWebApp.BautagebuchMainController.buttonPressInterval);c();b.stopPropagation();b.preventDefault()}}},mouseup:{action:function(){clearAllIntervals()}},touchstart:{action:function(a,b){var c=function(){var d=DigiWebApp.BautagebuchBautagesberichtDetailsController.wetter;if(d.temperatur!==-50){d.temperatur-=1;DigiWebApp.BautagebuchBautagesberichtDetailsController.set("wetter",d)}};clearAllIntervals();DigiWebApp.BautagebuchMainController.buttonPressInterval_Var=setInterval(c,DigiWebApp.BautagebuchMainController.buttonPressInterval);
c();b.stopPropagation();b.preventDefault()}},touchend:{action:function(){clearAllIntervals()}}}}),plusButton:M.ButtonView.design({value:"+",events:{tap:{action:function(){try{DigiWebApp.ApplicationController.vibrate()}catch(a){}}},mousedown:{action:function(a,b){if(!(typeof device!="undefined"||onMobile)){var c=function(){var d=DigiWebApp.BautagebuchBautagesberichtDetailsController.wetter;if(d.temperatur!==50){d.temperatur+=1;DigiWebApp.BautagebuchBautagesberichtDetailsController.set("wetter",d)}};
clearAllIntervals();DigiWebApp.BautagebuchMainController.buttonPressInterval_Var=setInterval(c,DigiWebApp.BautagebuchMainController.buttonPressInterval);c();b.stopPropagation();b.preventDefault()}}},mouseup:{action:function(){clearAllIntervals()}},touchstart:{action:function(a,b){var c=function(){var d=DigiWebApp.BautagebuchBautagesberichtDetailsController.wetter;if(d.temperatur!==50){d.temperatur+=1;DigiWebApp.BautagebuchBautagesberichtDetailsController.set("wetter",d)}};clearAllIntervals();DigiWebApp.BautagebuchMainController.buttonPressInterval_Var=
setInterval(c,DigiWebApp.BautagebuchMainController.buttonPressInterval);c();b.stopPropagation();b.preventDefault()}},touchend:{action:function(){clearAllIntervals()}}}}),TextValue:M.LabelView.design({cssClass:"whiteText centerText bold",computedValue:{contentBinding:{target:DigiWebApp.BautagebuchBautagesberichtDetailsController,property:"wetter.temperatur"},contentBindingReverse:{target:DigiWebApp.BautagebuchBautagesberichtDetailsController,property:"wetter.temperatur"},value:10,operation:function(a){return a+
"\u00b0C"}}})})}),luftfeuchteView:M.ContainerView.design({childViews:"myLabel myGrid",cssClass:"luftfeuchteView",myLabel:M.LabelView.design({cssClass:"whiteText marginBottom5px",value:M.I18N.l("BautagebuchLuftfeuchtigkeit")}),myGrid:M.GridView.design({childViews:"minusButton plusButton TextValue",layout:M.THREE_COLUMNS,minusButton:M.ButtonView.design({value:"-",events:{tap:{action:function(){try{DigiWebApp.ApplicationController.vibrate()}catch(a){}}},mousedown:{action:function(a,b){if(!(typeof device!=
"undefined"||onMobile)){var c=function(){var d=DigiWebApp.BautagebuchBautagesberichtDetailsController.wetter;if(d.luftfeuchtigkeit!==0){d.luftfeuchtigkeit-=1;DigiWebApp.BautagebuchBautagesberichtDetailsController.set("wetter",d)}};clearAllIntervals();DigiWebApp.BautagebuchMainController.buttonPressInterval_Var=setInterval(c,DigiWebApp.BautagebuchMainController.buttonPressInterval);c();b.stopPropagation();b.preventDefault()}}},mouseup:{action:function(){clearAllIntervals()}},touchstart:{action:function(a,
b){var c=function(){var d=DigiWebApp.BautagebuchBautagesberichtDetailsController.wetter;if(d.luftfeuchtigkeit!==0){d.luftfeuchtigkeit-=1;DigiWebApp.BautagebuchBautagesberichtDetailsController.set("wetter",d)}};clearAllIntervals();DigiWebApp.BautagebuchMainController.buttonPressInterval_Var=setInterval(c,DigiWebApp.BautagebuchMainController.buttonPressInterval);c();b.stopPropagation();b.preventDefault()}},touchend:{action:function(){clearAllIntervals()}}}}),plusButton:M.ButtonView.design({value:"+",
events:{tap:{action:function(){try{DigiWebApp.ApplicationController.vibrate()}catch(a){}}},mousedown:{action:function(a,b){if(!(typeof device!="undefined"||onMobile)){var c=function(){var d=DigiWebApp.BautagebuchBautagesberichtDetailsController.wetter;if(d.luftfeuchtigkeit!==100){d.luftfeuchtigkeit+=1;DigiWebApp.BautagebuchBautagesberichtDetailsController.set("wetter",d)}};clearAllIntervals();DigiWebApp.BautagebuchMainController.buttonPressInterval_Var=setInterval(c,DigiWebApp.BautagebuchMainController.buttonPressInterval);
c();b.stopPropagation();b.preventDefault()}}},mouseup:{action:function(){clearAllIntervals()}},touchstart:{action:function(a,b){var c=function(){var d=DigiWebApp.BautagebuchBautagesberichtDetailsController.wetter;if(d.luftfeuchtigkeit!==100){d.luftfeuchtigkeit+=1;DigiWebApp.BautagebuchBautagesberichtDetailsController.set("wetter",d)}};clearAllIntervals();DigiWebApp.BautagebuchMainController.buttonPressInterval_Var=setInterval(c,DigiWebApp.BautagebuchMainController.buttonPressInterval);c();b.stopPropagation();
b.preventDefault()}},touchend:{action:function(){clearAllIntervals()}}}}),TextValue:M.LabelView.design({cssClass:"whiteText centerText bold",computedValue:{contentBinding:{target:DigiWebApp.BautagebuchBautagesberichtDetailsController,property:"wetter.luftfeuchtigkeit"},value:0,operation:function(a){return a+"%"}}})})}),bewoelkungView:M.ContainerView.design({childViews:"myLabel myGrid",cssClass:"bewoelkungView",myLabel:M.LabelView.design({cssClass:"whiteText marginBottom5px",value:M.I18N.l("BautagebuchBewoelkung")}),
myGrid:M.GridView.design({childViews:"minusButton plusButton TextValue",layout:M.THREE_COLUMNS,minusButton:M.ButtonView.design({value:"-",events:{tap:{action:function(){try{DigiWebApp.ApplicationController.vibrate()}catch(a){}}},mousedown:{action:function(a,b){if(!(typeof device!="undefined"||onMobile)){var c=function(){var d=DigiWebApp.BautagebuchBautagesberichtDetailsController.wetter;if(d.bewoelkung!==0){d.bewoelkung-=1;DigiWebApp.BautagebuchBautagesberichtDetailsController.set("wetter",d)}};clearAllIntervals();
DigiWebApp.BautagebuchMainController.buttonPressInterval_Var=setInterval(c,DigiWebApp.BautagebuchMainController.buttonPressInterval);c();b.stopPropagation();b.preventDefault()}}},mouseup:{action:function(){clearAllIntervals()}},touchstart:{action:function(a,b){var c=function(){var d=DigiWebApp.BautagebuchBautagesberichtDetailsController.wetter;if(d.bewoelkung!==0){d.bewoelkung-=1;DigiWebApp.BautagebuchBautagesberichtDetailsController.set("wetter",d)}};clearAllIntervals();DigiWebApp.BautagebuchMainController.buttonPressInterval_Var=
setInterval(c,DigiWebApp.BautagebuchMainController.buttonPressInterval);c();b.stopPropagation();b.preventDefault()}},touchend:{action:function(){clearAllIntervals()}}}}),plusButton:M.ButtonView.design({value:"+",events:{tap:{action:function(){try{DigiWebApp.ApplicationController.vibrate()}catch(a){}}},mousedown:{action:function(a,b){if(!(typeof device!="undefined"||onMobile)){var c=function(){var d=DigiWebApp.BautagebuchBautagesberichtDetailsController.wetter;if(d.bewoelkung!==3){d.bewoelkung+=1;
DigiWebApp.BautagebuchBautagesberichtDetailsController.set("wetter",d)}};clearAllIntervals();DigiWebApp.BautagebuchMainController.buttonPressInterval_Var=setInterval(c,DigiWebApp.BautagebuchMainController.buttonPressInterval);c();b.stopPropagation();b.preventDefault()}}},mouseup:{action:function(){clearAllIntervals()}},touchstart:{action:function(a,b){var c=function(){var d=DigiWebApp.BautagebuchBautagesberichtDetailsController.wetter;if(d.bewoelkung!==3){d.bewoelkung+=1;DigiWebApp.BautagebuchBautagesberichtDetailsController.set("wetter",
d)}};clearAllIntervals();DigiWebApp.BautagebuchMainController.buttonPressInterval_Var=setInterval(c,DigiWebApp.BautagebuchMainController.buttonPressInterval);c();b.stopPropagation();b.preventDefault()}},touchend:{action:function(){clearAllIntervals()}}}}),TextValue:M.LabelView.design({cssClass:"whiteText centerText bold",computedValue:{contentBinding:{target:DigiWebApp.BautagebuchBautagesberichtDetailsController,property:"wetter.bewoelkung"},value:0,operation:function(a){switch(a){case 0:return M.I18N.l("BautagebuchBewoelkungKlar");
case 1:return M.I18N.l("BautagebuchBewoelkungMaessig");case 2:return M.I18N.l("BautagebuchBewoelkungBedeckt");case 3:return M.I18N.l("BautagebuchBewoelkungNeblig");default:return""}}}})})}),niederschlagView:M.ContainerView.design({childViews:"myLabel myGrid",cssClass:"niederschlagView",myLabel:M.LabelView.design({cssClass:"whiteText marginBottom5px",value:M.I18N.l("BautagebuchNiederschlag")}),myGrid:M.GridView.design({childViews:"minusButton plusButton TextValue",layout:M.THREE_COLUMNS,minusButton:M.ButtonView.design({value:"-",
events:{tap:{action:function(){try{DigiWebApp.ApplicationController.vibrate()}catch(a){}}},mousedown:{action:function(a,b){if(!(typeof device!="undefined"||onMobile)){var c=function(){var d=DigiWebApp.BautagebuchBautagesberichtDetailsController.wetter;if(d.niederschlag!==0){d.niederschlag-=1;DigiWebApp.BautagebuchBautagesberichtDetailsController.set("wetter",d)}};clearAllIntervals();DigiWebApp.BautagebuchMainController.buttonPressInterval_Var=setInterval(c,DigiWebApp.BautagebuchMainController.buttonPressInterval);
c();b.stopPropagation();b.preventDefault()}}},mouseup:{action:function(){clearAllIntervals()}},touchstart:{action:function(a,b){var c=function(){var d=DigiWebApp.BautagebuchBautagesberichtDetailsController.wetter;if(d.niederschlag!==0){d.niederschlag-=1;DigiWebApp.BautagebuchBautagesberichtDetailsController.set("wetter",d)}};clearAllIntervals();DigiWebApp.BautagebuchMainController.buttonPressInterval_Var=setInterval(c,DigiWebApp.BautagebuchMainController.buttonPressInterval);c();b.stopPropagation();
b.preventDefault()}},touchend:{action:function(){clearAllIntervals()}}}}),plusButton:M.ButtonView.design({value:"+",events:{tap:{action:function(){try{DigiWebApp.ApplicationController.vibrate()}catch(a){}}},mousedown:{action:function(a,b){if(!(typeof device!="undefined"||onMobile)){var c=function(){var d=DigiWebApp.BautagebuchBautagesberichtDetailsController.wetter;if(d.niederschlag!==5){d.niederschlag+=1;DigiWebApp.BautagebuchBautagesberichtDetailsController.set("wetter",d)}};clearAllIntervals();
DigiWebApp.BautagebuchMainController.buttonPressInterval_Var=setInterval(c,DigiWebApp.BautagebuchMainController.buttonPressInterval);c();b.stopPropagation();b.preventDefault()}}},mouseup:{action:function(){clearAllIntervals()}},touchstart:{action:function(a,b){if(!(DigiWebApp.BautagebuchWetterPage.eventLoopInAction&&DigiWebApp.BautagebuchWetterPage.eventLoopInAction&&DigiWebApp.BautagebuchWetterPage.eventLoopInAction!=b.type)){var c=function(){var d=DigiWebApp.BautagebuchBautagesberichtDetailsController.wetter;
if(d.niederschlag!==5){d.niederschlag+=1;DigiWebApp.BautagebuchBautagesberichtDetailsController.set("wetter",d)}};clearAllIntervals();DigiWebApp.BautagebuchMainController.buttonPressInterval_Var=setInterval(c,DigiWebApp.BautagebuchMainController.buttonPressInterval);c();b.stopPropagation();b.preventDefault()}}},touchend:{action:function(){clearAllIntervals()}}}}),TextValue:M.LabelView.design({cssClass:"whiteText centerText bold",computedValue:{contentBinding:{target:DigiWebApp.BautagebuchBautagesberichtDetailsController,
property:"wetter.niederschlag"},value:0,operation:function(a){switch(a){case 0:return M.I18N.l("BautagebuchNiederschlagKein");case 1:return M.I18N.l("BautagebuchNiederschlagNiesel");case 2:return M.I18N.l("BautagebuchNiederschlagRegen");case 3:return M.I18N.l("BautagebuchNiederschlagGraupel");case 4:return M.I18N.l("BautagebuchNiederschlagSchnee");case 5:return M.I18N.l("BautagebuchNiederschlagHagel");default:return""}}}})})}),windView:M.ContainerView.design({childViews:"myLabel myGrid",cssClass:"windView",
myLabel:M.LabelView.design({cssClass:"whiteText marginBottom5px",value:M.I18N.l("BautagebuchWind")}),myGrid:M.GridView.design({childViews:"minusButton plusButton TextValue",layout:M.THREE_COLUMNS,minusButton:M.ButtonView.design({value:"-",events:{tap:{action:function(){try{DigiWebApp.ApplicationController.vibrate()}catch(a){}}},mousedown:{action:function(a,b){if(!(typeof device!="undefined"||onMobile)){var c=function(){var d=DigiWebApp.BautagebuchBautagesberichtDetailsController.wetter;if(d.wind!==
0){d.wind-=1;DigiWebApp.BautagebuchBautagesberichtDetailsController.set("wetter",d)}};clearAllIntervals();DigiWebApp.BautagebuchMainController.buttonPressInterval_Var=setInterval(c,DigiWebApp.BautagebuchMainController.buttonPressInterval);c();b.stopPropagation();b.preventDefault()}}},mouseup:{action:function(){clearAllIntervals()}},touchstart:{action:function(a,b){var c=function(){var d=DigiWebApp.BautagebuchBautagesberichtDetailsController.wetter;if(d.wind!==0){d.wind-=1;DigiWebApp.BautagebuchBautagesberichtDetailsController.set("wetter",
d)}};clearAllIntervals();DigiWebApp.BautagebuchMainController.buttonPressInterval_Var=setInterval(c,DigiWebApp.BautagebuchMainController.buttonPressInterval);c();b.stopPropagation();b.preventDefault()}},touchend:{action:function(){clearAllIntervals()}}}}),plusButton:M.ButtonView.design({value:"+",events:{tap:{action:function(){try{DigiWebApp.ApplicationController.vibrate()}catch(a){}}},mousedown:{action:function(a,b){if(!(typeof device!="undefined"||onMobile)){var c=function(){var d=DigiWebApp.BautagebuchBautagesberichtDetailsController.wetter;
if(d.wind!==4){d.wind+=1;DigiWebApp.BautagebuchBautagesberichtDetailsController.set("wetter",d)}};clearAllIntervals();DigiWebApp.BautagebuchMainController.buttonPressInterval_Var=setInterval(c,DigiWebApp.BautagebuchMainController.buttonPressInterval);c();b.stopPropagation();b.preventDefault()}}},mouseup:{action:function(){clearAllIntervals()}},touchstart:{action:function(a,b){var c=function(){var d=DigiWebApp.BautagebuchBautagesberichtDetailsController.wetter;if(d.wind!==4){d.wind+=1;DigiWebApp.BautagebuchBautagesberichtDetailsController.set("wetter",
d)}};clearAllIntervals();DigiWebApp.BautagebuchMainController.buttonPressInterval_Var=setInterval(c,DigiWebApp.BautagebuchMainController.buttonPressInterval);c();b.stopPropagation();b.preventDefault()}},touchend:{action:function(){clearAllIntervals()}}}}),TextValue:M.LabelView.design({cssClass:"whiteText centerText bold",computedValue:{contentBinding:{target:DigiWebApp.BautagebuchBautagesberichtDetailsController,property:"wetter.wind"},value:0,operation:function(a){switch(a){case 0:return M.I18N.l("BautagebuchWindStill");
case 1:return M.I18N.l("BautagebuchWindMaessig");case 2:return M.I18N.l("BautagebuchWindBoeig");case 3:return M.I18N.l("BautagebuchWindStuermisch");case 4:return M.I18N.l("BautagebuchWindOrkan");default:return""}}}})})}),speichernButton:M.GridView.design({childViews:"button icon",layout:{cssClass:"digiButton",columns:{0:"button",1:"icon"}},button:M.ButtonView.design({value:M.I18N.l("save"),cssClass:"digiButton green_background",anchorLocation:M.RIGHT,events:{tap:{action:function(){clearAllTimeouts();
DigiWebApp.BautagebuchBautagesberichtDetailsController.save(DigiWebApp.NavigationController.backToBautagebuchBautagesberichtDetailsPageTransition)}}}}),icon:M.ImageView.design({value:"theme/images/icon_bookTime.png"})})})});
DigiWebApp.BautagebuchZeitenDetailsPage=M.PageView.design({events:{pagebeforeshow:{action:function(){var a=NO,b=DigiWebApp.BautagebuchZeitenDetailsController,c=JSON.parse(JSON.stringify(DigiWebApp.BautagebuchBautagesberichtDetailsController.positionenList));_.each(c,function(o){o.isSelected=parseIntRadixTen(o.value)!==0?NO:YES});c=_.map(c,function(o){if(typeof o==="undefined")console.log("UNDEFINED position");else{if(b.positionId){o.isSelected=o.value===b.positionId;if(o.isSelected)a=YES}return o}});
if(!a&&DigiWebApp.BautagebuchEinstellungenController.settings.positionVorselektieren)c=_.map(c,function(o){if(DigiWebApp.BautagebuchBautagesberichtDetailsController.positionId){o.isSelected=o.value===DigiWebApp.BautagebuchBautagesberichtDetailsController.positionId;if(o.isSelected){a=YES;b.set("positionId",o.value);b.set("positionName",o.label)}}return o});c=_.compact(c);c.length>1&&c.push({label:M.I18N.l("selectSomething"),value:"0",isSelected:!a});if(!a&&c.length==1){c[0].isSelected=YES;b.set("positionId",
c[0].value);b.set("positionName",c[0].label)}b.set("positionenList",c);_.each(b.positionenList,function(o){if(o.isSelected==YES&&parseIntRadixTen(o.value)!=0){b.set("positionId",parseIntRadixTen(o.value));b.set("positionName",o.label)}});b.setTaetigkeiten(b.positionId);try{_.each(b.activityList,function(o){if(o.isSelected==YES&&parseIntRadixTen(o.value)!=0){b.set("activityId",parseIntRadixTen(o.value));b.set("activityName",o.label)}})}catch(d){trackError(d)}var e=DigiWebApp.BautagebuchZeitenDetailsController.mitarbeiterIds;
c=[];c=_.map(JSON.parse(JSON.stringify(DigiWebApp.BautagebuchBautagesberichtDetailsController.mitarbeiterListSelected)),function(o){var p=NO;_.each(e,function(q){if(parseIntRadixTen(q)===parseIntRadixTen(o.value))p=YES});o.isSelected=p===YES;return o});c=_.compact(c);DigiWebApp.BautagebuchZeitenDetailsController.set("mitarbeiterList",c);if(DigiWebApp.BautagebuchEinstellungen.find()[0].get("inStundenBuchen")){try{$("[id="+DigiWebApp.BautagebuchZeitenDetailsPage.content.VonBisContainer.id+"]").each(function(){$(this).hide()})}catch(f){}try{$("label[for='"+
DigiWebApp.BautagebuchZeitenDetailsPage.content.VonBisContainer.id+"']").each(function(){$(this).hide()})}catch(g){}try{$("[id="+DigiWebApp.BautagebuchZeitenDetailsPage.content.dauerContainer.id+"]").each(function(){$(this).show()})}catch(i){}try{$("label[for='"+DigiWebApp.BautagebuchZeitenDetailsPage.content.dauerContainer.id+"']").each(function(){$(this).show()})}catch(h){}}else{try{$("[id="+DigiWebApp.BautagebuchZeitenDetailsPage.content.VonBisContainer.id+"]").each(function(){$(this).show()})}catch(j){}try{$("label[for='"+
DigiWebApp.BautagebuchZeitenDetailsPage.content.VonBisContainer.id+"']").each(function(){$(this).show()})}catch(l){}try{$("[id="+DigiWebApp.BautagebuchZeitenDetailsPage.content.dauerContainer.id+"]").each(function(){$(this).hide()})}catch(n){}try{$("label[for='"+DigiWebApp.BautagebuchZeitenDetailsPage.content.dauerContainer.id+"']").each(function(){$(this).hide()})}catch(m){}}if(DigiWebApp.BautagebuchBautagesberichtDetailsController.item.get("abgeschlossen")){$("#"+DigiWebApp.BautagebuchZeitenDetailsPage.content.grid.id).hide();
$("#"+DigiWebApp.BautagebuchZeitenDetailsPage.header.delButton.id).hide()}else{$("#"+DigiWebApp.BautagebuchZeitenDetailsPage.content.grid.id).show();$("#"+DigiWebApp.BautagebuchZeitenDetailsPage.header.delButton.id).show()}M.ViewManager.getView("bautagebuchZeitenDetailsPage","remarkInput").setValue(DigiWebApp.BautagebuchZeitenDetailsController.remark);DigiWebApp.BautagebuchZeitenDetailsController.setDauer();DigiWebApp.BautagebuchZeitenDetailsController.setVonBis();b.get("handOrderId")?$("#"+DigiWebApp.BautagebuchZeitenDetailsPage.content.positionComboBox.id+
"_container").hide():$("#"+DigiWebApp.BautagebuchZeitenDetailsPage.content.positionComboBox.id+"_container").show();$("#"+DigiWebApp.BautagebuchZeitenDetailsPage.content.dauerContainer.dauerGrid.stundeFeld.id).prop("disabled",true);$("#"+DigiWebApp.BautagebuchZeitenDetailsPage.content.dauerContainer.dauerGrid.minuteFeld.id).prop("disabled",true);$("#"+DigiWebApp.BautagebuchZeitenDetailsPage.content.VonBisContainer.VonBisGrid.stundeVonFeld.id).prop("disabled",true);$("#"+DigiWebApp.BautagebuchZeitenDetailsPage.content.VonBisContainer.VonBisGrid.minuteVonFeld.id).prop("disabled",
true);$("#"+DigiWebApp.BautagebuchZeitenDetailsPage.content.VonBisContainer.VonBisGrid.stundeBisFeld.id).prop("disabled",true);$("#"+DigiWebApp.BautagebuchZeitenDetailsPage.content.VonBisContainer.VonBisGrid.minuteBisFeld.id).prop("disabled",true);if(DigiWebApp.SettingsController.featureAvailable("427")){$("#"+DigiWebApp.BautagebuchZeitenDetailsPage.content.activityComboBox.id+"_container").hide();$("#"+DigiWebApp.BautagebuchZeitenDetailsPage.content.activityButton.id).show();$("label[for='"+DigiWebApp.BautagebuchZeitenDetailsPage.content.activityButton.id+
"']").show()}else{$("#"+DigiWebApp.BautagebuchZeitenDetailsPage.content.activityComboBox.id+"_container").show();$("#"+DigiWebApp.BautagebuchZeitenDetailsPage.content.activityButton.id).hide();$("label[for='"+DigiWebApp.BautagebuchZeitenDetailsPage.content.activityButton.id+"']").hide()}if(DigiWebApp.SettingsController.getSetting("DTC6aktiv")){DigiWebApp.ApplicationController.dtc6AktivRenameHelper(DigiWebApp.BautagebuchZeitenDetailsPage.content.positionComboBox.id,M.I18N.l("dtc6Auftrag"));DigiWebApp.ApplicationController.dtc6AktivRenameHelper(DigiWebApp.BautagebuchZeitenDetailsPage.content.activityComboBox.id,
M.I18N.l("dtc6Leistung"));$("#"+DigiWebApp.BautagebuchZeitenDetailsPage.content.activityButton.id).prev()[0].textContent=M.I18N.l("dtc6Leistung")}}},pagehide:{action:function(){}}},cssClass:"bautagebuchZeitenDetailsPage",childViews:"header content",header:M.ToolbarView.design({childViews:"backButton title uebersichtButton",cssClass:"header unselectable",isFixed:YES,backButton:M.ButtonView.design({value:M.I18N.l("back"),icon:"arrow-l",anchorLocation:M.LEFT,events:{tap:{action:function(){try{DigiWebApp.ApplicationController.vibrate()}catch(a){}history.back()}}}}),
title:M.LabelView.design({value:M.I18N.l("Zeitbuchung"),anchorLocation:M.CENTER}),delButton:M.ButtonView.design({value:M.I18N.l("BautagebuchDelete"),icon:"delete",anchorLocation:M.RIGHT,cssClass:"red_background",events:{tap:{target:DigiWebApp.BautagebuchZeitenDetailsController,action:function(){try{DigiWebApp.ApplicationController.vibrate()}catch(a){}this.deleteZeitbuchung()}}}}),uebersichtButton:M.ButtonView.design({value:M.I18N.l("uebersicht"),icon:"forward",anchorLocation:M.RIGHT,events:{tap:{target:DigiWebApp.BautagebuchZeitenDetailsController,
action:function(){try{DigiWebApp.ApplicationController.vibrate()}catch(a){}DigiWebApp.NavigationController.backToBautagebuchZeitenListePageTransition()}}}}),anchorLocation:M.TOP}),content:M.ScrollView.design({childViews:"positionComboBox activityComboBox activityButton mitarbeiterGroup VonBisContainer dauerContainer remarkInput grid loeschenButton",cssClass:"content",positionComboBox:M.SelectionListView.design({selectionMode:M.SINGLE_SELECTION_DIALOG,initialText:M.I18N.l("noData"),label:M.I18N.l("position"),
applyTheme:NO,contentBinding:{target:DigiWebApp.BautagebuchZeitenDetailsController,property:"positionenList"},events:{change:{action:function(){DigiWebApp.BautagebuchZeitenDetailsController.set("positionId",M.ViewManager.getView("bautagebuchZeitenDetailsPage","positionComboBox").getSelection(YES).value);DigiWebApp.BautagebuchZeitenDetailsController.set("positionName",M.ViewManager.getView("bautagebuchZeitenDetailsPage","positionComboBox").getSelection(YES).label);DigiWebApp.BautagebuchZeitenDetailsController.setTaetigkeiten(M.ViewManager.getView("bautagebuchZeitenDetailsPage",
"positionComboBox").getSelection(YES).value)}}}}),activityComboBox:M.SelectionListView.design({selectionMode:M.SINGLE_SELECTION_DIALOG,initialText:M.I18N.l("noData"),label:M.I18N.l("activity"),applyTheme:NO,contentBinding:{target:DigiWebApp.BautagebuchZeitenDetailsController,property:"activityList"},events:{change:{action:function(){DigiWebApp.BautagebuchZeitenDetailsController.set("activityId",M.ViewManager.getView("bautagebuchZeitenDetailsPage","activityComboBox").getSelection(YES).value);DigiWebApp.BautagebuchZeitenDetailsController.set("activityName",
M.ViewManager.getView("bautagebuchZeitenDetailsPage","activityComboBox").getSelection(YES).label);DigiWebApp.BautagebuchZeitenDetailsPage.content.activityButton.setValue(M.ViewManager.getView("bautagebuchZeitenDetailsPage","activityComboBox").getSelection(YES).label)}}}}),activityButton:M.ButtonView.design({value:M.I18N.l("activity"),label:M.I18N.l("activity"),events:{tap:{target:DigiWebApp.ActivityListController,action:function(){try{DigiWebApp.ApplicationController.vibrate()}catch(a){}this.itemsToUse=
DigiWebApp.BautagebuchZeitenDetailsController.activityList;this.init();this.comboBoxToUpdate=DigiWebApp.BautagebuchZeitenDetailsPage.content.activityComboBox;DigiWebApp.NavigationController.toActivityListPage()}}}}),mitarbeiterGroup:M.SelectionListView.design({selectionMode:M.MULTIPLE_SELECTION,initialText:M.I18N.l("noData"),label:M.I18N.l("employees"),applyTheme:NO,contentBinding:{target:DigiWebApp.BautagebuchZeitenDetailsController,property:"mitarbeiterList"},events:{change:{action:function(a){for(var b=
[],c=0;c<a.length;c++)b.push(a[c]);DigiWebApp.BautagebuchZeitenDetailsController.set("mitarbeiterIds",b);a=[];if(b&&b.length!==0)a=_.map(DigiWebApp.BautagebuchMainController.mitarbeiter,function(d){var e=NO;_.each(b,function(f){if(f===d.value)e=YES});if(e){d.isSelected=YES;return d}});a=_.compact(a);DigiWebApp.BautagebuchZeitenDetailsController.set("mitarbeiterListSelected",a)}}}}),VonBisContainer:M.ContainerView.design({label:M.I18N.l("bookingFrom")+"/"+M.I18N.l("bookingTo"),childViews:"plusGrid VonBisGrid minusGrid",
plusGrid:M.GridView.design({childViews:"stundeVonPlusButton minuteVonPlusButton trennText stundeBisPlusButton minuteBisPlusButton",layout:{cssClass:"vonbiscontainer",columns:{0:"column1",1:"column2",2:"column3",3:"column4",4:"column5"}},stundeVonPlusButton:M.ButtonView.design({value:"+",cssClass:"plusMinusButton",events:{tap:{action:function(){var a=parseIntRadixTen($("#"+DigiWebApp.BautagebuchZeitenDetailsPage.content.VonBisContainer.VonBisGrid.stundeVonFeld.id)[0].value),b=parseIntRadixTen($("#"+
DigiWebApp.BautagebuchZeitenDetailsPage.content.VonBisContainer.VonBisGrid.minuteVonFeld.id)[0].value);a=(a+1)%24;var c=a.padLeft(2,"0")+":"+b.padLeft(2,"0");if(DigiWebApp.SettingsController.getSetting("bautagebuchLimit_autoStartUhrzeit")){var d=DigiWebApp.BautagebuchBautagesberichtDetailsController.get("startUhrzeit"),e=d.split(":")[0];d=d.split(":")[1];if(parseIntRadixTen(a)<parseIntRadixTen(e))return false;if(parseIntRadixTen(a)==parseIntRadixTen(e)&&parseIntRadixTen(b)<parseIntRadixTen(d))return false}DigiWebApp.BautagebuchZeitenDetailsController.set("von",
c);DigiWebApp.BautagebuchZeitenDetailsController.setVonBis()}}}}),minuteVonPlusButton:M.ButtonView.design({value:"+",cssClass:"plusMinusButton",events:{tap:{action:function(){var a=parseIntRadixTen($("#"+DigiWebApp.BautagebuchZeitenDetailsPage.content.VonBisContainer.VonBisGrid.stundeVonFeld.id)[0].value),b=parseIntRadixTen($("#"+DigiWebApp.BautagebuchZeitenDetailsPage.content.VonBisContainer.VonBisGrid.minuteVonFeld.id)[0].value),c=parseIntRadixTen(DigiWebApp.BautagebuchEinstellungenController.settings.minutenSchritte);
if(b+c>59)a=(a+1)%24;b=(b+c)%60;if(b%c!=0)b-=b%c;c=a.padLeft(2,"0")+":"+b.padLeft(2,"0");if(DigiWebApp.SettingsController.getSetting("bautagebuchLimit_autoStartUhrzeit")){var d=DigiWebApp.BautagebuchBautagesberichtDetailsController.get("startUhrzeit"),e=d.split(":")[0];d=d.split(":")[1];if(parseIntRadixTen(a)<parseIntRadixTen(e))return false;if(parseIntRadixTen(a)==parseIntRadixTen(e)&&parseIntRadixTen(b)<parseIntRadixTen(d))return false}DigiWebApp.BautagebuchZeitenDetailsController.set("von",c);
DigiWebApp.BautagebuchZeitenDetailsController.setVonBis()}}}}),trennText:M.LabelView.design({value:"&nbsp;"}),stundeBisPlusButton:M.ButtonView.design({value:"+",cssClass:"plusMinusButton",events:{tap:{action:function(){var a=parseIntRadixTen($("#"+DigiWebApp.BautagebuchZeitenDetailsPage.content.VonBisContainer.VonBisGrid.stundeBisFeld.id)[0].value),b=parseIntRadixTen($("#"+DigiWebApp.BautagebuchZeitenDetailsPage.content.VonBisContainer.VonBisGrid.minuteBisFeld.id)[0].value);a=(a+1)%24;var c=a.padLeft(2,
"0")+":"+b.padLeft(2,"0");if(DigiWebApp.SettingsController.getSetting("bautagebuchLimit_autoStartUhrzeit")){var d=DigiWebApp.BautagebuchBautagesberichtDetailsController.get("startUhrzeit"),e=d.split(":")[0];d=d.split(":")[1];if(parseIntRadixTen(a)<parseIntRadixTen(e))return false;if(parseIntRadixTen(a)==parseIntRadixTen(e)&&parseIntRadixTen(b)<parseIntRadixTen(d))return false}DigiWebApp.BautagebuchZeitenDetailsController.set("bis",c);DigiWebApp.BautagebuchZeitenDetailsController.setVonBis()}}}}),
minuteBisPlusButton:M.ButtonView.design({value:"+",cssClass:"plusMinusButton",events:{tap:{action:function(){var a=parseIntRadixTen($("#"+DigiWebApp.BautagebuchZeitenDetailsPage.content.VonBisContainer.VonBisGrid.stundeBisFeld.id)[0].value),b=parseIntRadixTen($("#"+DigiWebApp.BautagebuchZeitenDetailsPage.content.VonBisContainer.VonBisGrid.minuteBisFeld.id)[0].value),c=parseIntRadixTen(DigiWebApp.BautagebuchEinstellungenController.settings.minutenSchritte);if(b+c>59)a=(a+1)%24;b=(b+c)%60;if(b%c!=0)b-=
b%c;c=a.padLeft(2,"0")+":"+b.padLeft(2,"0");if(DigiWebApp.SettingsController.getSetting("bautagebuchLimit_autoStartUhrzeit")){var d=DigiWebApp.BautagebuchBautagesberichtDetailsController.get("startUhrzeit"),e=d.split(":")[0];d=d.split(":")[1];if(parseIntRadixTen(a)<parseIntRadixTen(e))return false;if(parseIntRadixTen(a)==parseIntRadixTen(e)&&parseIntRadixTen(b)<parseIntRadixTen(d))return false}DigiWebApp.BautagebuchZeitenDetailsController.set("bis",c);DigiWebApp.BautagebuchZeitenDetailsController.setVonBis()}}}})}),
VonBisGrid:M.GridView.design({childViews:"stundeVonFeld minuteVonFeld trennText stundeBisFeld minuteBisFeld",layout:{cssClass:"vonbiscontainer",columns:{0:"column1",1:"column2",2:"column3",3:"column4",4:"column5"}},stundeVonFeld:M.TextFieldView.design({cssClass:"startUhrzeit",inputType:M.INPUT_TEXT}),minuteVonFeld:M.TextFieldView.design({cssClass:"startUhrzeit",inputType:M.INPUT_TEXT}),trennText:M.LabelView.design({value:"-"}),stundeBisFeld:M.TextFieldView.design({cssClass:"startUhrzeit",inputType:M.INPUT_TEXT}),
minuteBisFeld:M.TextFieldView.design({cssClass:"startUhrzeit",inputType:M.INPUT_TEXT})}),minusGrid:M.GridView.design({childViews:"stundeVonMinusButton minuteVonMinusButton trennText stundeBisMinusButton minuteBisMinusButton",layout:{cssClass:"vonbiscontainer",columns:{0:"column1",1:"column2",2:"column3",3:"column4",4:"column5"}},stundeVonMinusButton:M.ButtonView.design({value:"-",cssClass:"plusMinusButton",events:{tap:{action:function(){var a=parseIntRadixTen($("#"+DigiWebApp.BautagebuchZeitenDetailsPage.content.VonBisContainer.VonBisGrid.stundeVonFeld.id)[0].value),
b=parseIntRadixTen($("#"+DigiWebApp.BautagebuchZeitenDetailsPage.content.VonBisContainer.VonBisGrid.minuteVonFeld.id)[0].value);a-=1;if(a<0)a=23;var c=a.padLeft(2,"0")+":"+b.padLeft(2,"0");if(DigiWebApp.SettingsController.getSetting("bautagebuchLimit_autoStartUhrzeit")){var d=DigiWebApp.BautagebuchBautagesberichtDetailsController.get("startUhrzeit"),e=d.split(":")[0];d=d.split(":")[1];if(parseIntRadixTen(a)<parseIntRadixTen(e))return false;if(parseIntRadixTen(a)==parseIntRadixTen(e)&&parseIntRadixTen(b)<
parseIntRadixTen(d))return false}DigiWebApp.BautagebuchZeitenDetailsController.set("von",c);DigiWebApp.BautagebuchZeitenDetailsController.setVonBis()}}}}),minuteVonMinusButton:M.ButtonView.design({value:"-",cssClass:"plusMinusButton",events:{tap:{action:function(){var a=parseIntRadixTen($("#"+DigiWebApp.BautagebuchZeitenDetailsPage.content.VonBisContainer.VonBisGrid.stundeVonFeld.id)[0].value),b=parseIntRadixTen($("#"+DigiWebApp.BautagebuchZeitenDetailsPage.content.VonBisContainer.VonBisGrid.minuteVonFeld.id)[0].value),
c=parseIntRadixTen(DigiWebApp.BautagebuchEinstellungenController.settings.minutenSchritte);if(b-c<0){a-=1;if(a<0)a=23;b=60}b=(b-c)%60;if(b<0)b=60-c;if(b%c!=0)b-=b%c;c=a.padLeft(2,"0")+":"+b.padLeft(2,"0");if(DigiWebApp.SettingsController.getSetting("bautagebuchLimit_autoStartUhrzeit")){var d=DigiWebApp.BautagebuchBautagesberichtDetailsController.get("startUhrzeit"),e=d.split(":")[0];d=d.split(":")[1];if(parseIntRadixTen(a)<parseIntRadixTen(e))return false;if(parseIntRadixTen(a)==parseIntRadixTen(e)&&
parseIntRadixTen(b)<parseIntRadixTen(d))return false}DigiWebApp.BautagebuchZeitenDetailsController.set("von",c);DigiWebApp.BautagebuchZeitenDetailsController.setVonBis()}}}}),trennText:M.LabelView.design({value:"&nbsp;"}),stundeBisMinusButton:M.ButtonView.design({value:"-",cssClass:"plusMinusButton",events:{tap:{action:function(){var a=parseIntRadixTen($("#"+DigiWebApp.BautagebuchZeitenDetailsPage.content.VonBisContainer.VonBisGrid.stundeBisFeld.id)[0].value),b=parseIntRadixTen($("#"+DigiWebApp.BautagebuchZeitenDetailsPage.content.VonBisContainer.VonBisGrid.minuteBisFeld.id)[0].value);
a-=1;if(a<0)a=23;var c=a.padLeft(2,"0")+":"+b.padLeft(2,"0");if(DigiWebApp.SettingsController.getSetting("bautagebuchLimit_autoStartUhrzeit")){var d=DigiWebApp.BautagebuchBautagesberichtDetailsController.get("startUhrzeit"),e=d.split(":")[0];d=d.split(":")[1];if(parseIntRadixTen(a)<parseIntRadixTen(e))return false;if(parseIntRadixTen(a)==parseIntRadixTen(e)&&parseIntRadixTen(b)<parseIntRadixTen(d))return false}DigiWebApp.BautagebuchZeitenDetailsController.set("bis",c);DigiWebApp.BautagebuchZeitenDetailsController.setVonBis()}}}}),
minuteBisMinusButton:M.ButtonView.design({value:"-",cssClass:"plusMinusButton",events:{tap:{action:function(){var a=parseIntRadixTen($("#"+DigiWebApp.BautagebuchZeitenDetailsPage.content.VonBisContainer.VonBisGrid.stundeBisFeld.id)[0].value),b=parseIntRadixTen($("#"+DigiWebApp.BautagebuchZeitenDetailsPage.content.VonBisContainer.VonBisGrid.minuteBisFeld.id)[0].value),c=parseIntRadixTen(DigiWebApp.BautagebuchEinstellungenController.settings.minutenSchritte);if(b-c<0){a-=1;if(a<0)a=23;b=60}b=(b-c)%
60;if(b<0)b=60-c;if(b%c!=0)b-=b%c;c=a.padLeft(2,"0")+":"+b.padLeft(2,"0");if(DigiWebApp.SettingsController.getSetting("bautagebuchLimit_autoStartUhrzeit")){var d=DigiWebApp.BautagebuchBautagesberichtDetailsController.get("startUhrzeit"),e=d.split(":")[0];d=d.split(":")[1];if(parseIntRadixTen(a)<parseIntRadixTen(e))return false;if(parseIntRadixTen(a)==parseIntRadixTen(e)&&parseIntRadixTen(b)<parseIntRadixTen(d))return false}DigiWebApp.BautagebuchZeitenDetailsController.set("bis",c);DigiWebApp.BautagebuchZeitenDetailsController.setVonBis()}}}})})}),
dauerContainer:M.ContainerView.design({label:M.I18N.l("bookingDuration"),childViews:"plusGrid dauerGrid minusGrid",plusGrid:M.GridView.design({childViews:"stundePlusButton trennText minutePlusButton",layout:{cssClass:"timecontainer",columns:{0:"column1",1:"column2",2:"column3"}},stundePlusButton:M.ButtonView.design({value:"+",cssClass:"plusMinusButton",events:{tap:{action:function(){var a=parseIntRadixTen($("#"+DigiWebApp.BautagebuchZeitenDetailsPage.content.dauerContainer.dauerGrid.stundeFeld.id)[0].value),
b=parseIntRadixTen($("#"+DigiWebApp.BautagebuchZeitenDetailsPage.content.dauerContainer.dauerGrid.minuteFeld.id)[0].value);a+=1;a=a.padLeft(2,"0")+":"+b.padLeft(2,"0");DigiWebApp.BautagebuchZeitenDetailsController.set("dauer",a);DigiWebApp.BautagebuchZeitenDetailsController.setDauer()}}}}),trennText:M.LabelView.design({value:"&nbsp;"}),minutePlusButton:M.ButtonView.design({value:"+",cssClass:"plusMinusButton",events:{tap:{action:function(){var a=parseIntRadixTen($("#"+DigiWebApp.BautagebuchZeitenDetailsPage.content.dauerContainer.dauerGrid.stundeFeld.id)[0].value),
b=parseIntRadixTen($("#"+DigiWebApp.BautagebuchZeitenDetailsPage.content.dauerContainer.dauerGrid.minuteFeld.id)[0].value),c=parseIntRadixTen(DigiWebApp.BautagebuchEinstellungenController.settings.minutenSchritte);if(b+c>59)a+=1;b=(b+c)%60;a=a.padLeft(2,"0")+":"+b.padLeft(2,"0");DigiWebApp.BautagebuchZeitenDetailsController.set("dauer",a);DigiWebApp.BautagebuchZeitenDetailsController.setDauer()}}}})}),dauerGrid:M.GridView.design({childViews:"stundeFeld trennText minuteFeld",layout:{cssClass:"timecontainer",
columns:{0:"column1",1:"column2",2:"column3"}},stundeFeld:M.TextFieldView.design({cssClass:"startUhrzeit",inputType:M.INPUT_TEXT}),trennText:M.LabelView.design({value:":"}),minuteFeld:M.TextFieldView.design({cssClass:"startUhrzeit",inputType:M.INPUT_TEXT})}),minusGrid:M.GridView.design({childViews:"stundeMinusButton trennText minuteMinusButton",layout:{cssClass:"timecontainer",columns:{0:"column1",1:"column2",2:"column3"}},stundeMinusButton:M.ButtonView.design({value:"-",cssClass:"plusMinusButton",
events:{tap:{action:function(){var a=parseIntRadixTen($("#"+DigiWebApp.BautagebuchZeitenDetailsPage.content.dauerContainer.dauerGrid.stundeFeld.id)[0].value),b=parseIntRadixTen($("#"+DigiWebApp.BautagebuchZeitenDetailsPage.content.dauerContainer.dauerGrid.minuteFeld.id)[0].value);a-=1;if(a<0)a=0;a=a.padLeft(2,"0")+":"+b.padLeft(2,"0");DigiWebApp.BautagebuchZeitenDetailsController.set("dauer",a);DigiWebApp.BautagebuchZeitenDetailsController.setDauer()}}}}),trennText:M.LabelView.design({value:"&nbsp;"}),
minuteMinusButton:M.ButtonView.design({value:"-",cssClass:"plusMinusButton",events:{tap:{action:function(){var a=parseIntRadixTen($("#"+DigiWebApp.BautagebuchZeitenDetailsPage.content.dauerContainer.dauerGrid.stundeFeld.id)[0].value),b=parseIntRadixTen($("#"+DigiWebApp.BautagebuchZeitenDetailsPage.content.dauerContainer.dauerGrid.minuteFeld.id)[0].value),c=parseIntRadixTen(DigiWebApp.BautagebuchEinstellungenController.settings.minutenSchritte);if(b-c<0&&a>0){a-=1;b=60}b=(b-c)%60;if(b<0)b=0;a=a.padLeft(2,
"0")+":"+b.padLeft(2,"0");DigiWebApp.BautagebuchZeitenDetailsController.set("dauer",a);DigiWebApp.BautagebuchZeitenDetailsController.setDauer()}}}})})}),remarkInput:M.TextFieldView.design({label:M.I18N.l("remark"),cssClass:"remarkInput",cssClassOnInit:"remarkInputInitial",initialText:"max. 255 "+M.I18N.l("characters"),hasMultipleLines:YES,events:{keyup:{action:function(){if(M.ViewManager.getView("bautagebuchZeitenDetailsPage","remarkInput").getValue().length<=255)DigiWebApp.BautagebuchZeitenDetailsController.set("remark",
M.ViewManager.getView("bautagebuchZeitenDetailsPage","remarkInput").getValue());else{M.ViewManager.getView("bautagebuchZeitenDetailsPage","remarkInput").setValue(DigiWebApp.BautagebuchZeitenDetailsController.remark);DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("maximaleFeldlaengeErreicht"),message:M.I18N.l("maximaleFeldlaengeErreichtMsg")})}}}}}),grid:M.GridView.design({childViews:"button icon",layout:{cssClass:"digiButton",columns:{0:"button",1:"icon"}},button:M.ButtonView.design({value:M.I18N.l("save"),
cssClass:"digiButton green_background",anchorLocation:M.RIGHT,events:{tap:{target:DigiWebApp.BautagebuchZeitenDetailsController,action:function(){try{DigiWebApp.ApplicationController.vibrate()}catch(a){}this.save()}}}}),icon:M.ImageView.design({value:"theme/images/icon_bookTime.png"})}),loeschenButton:M.ButtonView.design({value:M.I18N.l("BautagebuchDelete"),cssClass:"red_background",events:{tap:{target:DigiWebApp.BautagebuchZeitenDetailsController,action:function(){try{DigiWebApp.ApplicationController.vibrate()}catch(a){}this.deleteZeitbuchung()}}}})})});
DigiWebApp.BautagebuchZeitenTemplateView=M.ListItemView.design({isSelectable:YES,childViews:"positionName handOrderName activityName spacer von bis dauer latitude longitude latitude_bis longitude_bis mitarbeiterIds",events:{tap:{action:function(a){var b=M.ViewManager.getViewById(a).modelId;_.each(DigiWebApp.BautagebuchZeitenListeController.items,function(c){c.m_id===b&&DigiWebApp.BautagebuchZeitenDetailsController.load(c)});DigiWebApp.NavigationController.toBautagebuchZeitenDetailsPageTransition()}}},
spacer:M.LabelView.design({value:""}),mitarbeiterIds:M.LabelView.design({cssClass:"small unselectable",computedValue:{valuePattern:"<%= mitarbeiterIds %>",operation:function(a){if(a!==""&&a!==null){var b="",c=JSON.parse(a);a=DigiWebApp.BautagebuchMitarbeiter.findSorted();_.each(a,function(d){if(c.indexOf(d.get("id"))!==-1){if(b!=="")b+=", ";b+="<nobr>"+d.vollername()+"</nobr>"}});return b}else return""}}}),positionName:M.LabelView.design({cssClass:"normal unselectable",isInline:YES,computedValue:{valuePattern:"<%= positionName %>",
operation:function(a){return a!==""&&a!==null?a:""}}}),handOrderName:M.LabelView.design({cssClass:"normal unselectable",isInline:YES,computedValue:{valuePattern:"<%= handOrderName %>",operation:function(a){return a!==""&&a!==null?a:""}}}),activityName:M.LabelView.design({cssClass:"normal unselectable",isInline:YES,computedValue:{valuePattern:"<%= activityName %>",operation:function(a){return a!==""&&a!==null?", "+a+":":":"}}}),von:M.LabelView.design({cssClass:"normal unselectable",isInline:YES,computedValue:{valuePattern:"<%= von %>",
operation:function(a){return a!==""&&a!==null&&!DigiWebApp.BautagebuchEinstellungen.find()[0].get("inStundenBuchen")?a:""}}}),bis:M.LabelView.design({cssClass:"normal unselectable",isInline:YES,computedValue:{valuePattern:"<%= bis %>",operation:function(a){return a!==""&&a!==null&&!DigiWebApp.BautagebuchEinstellungen.find()[0].get("inStundenBuchen")?" - "+a:""}}}),dauer:M.LabelView.design({cssClass:"normal unselectable",isInline:YES,computedValue:{valuePattern:"<%= dauer %>",operation:function(a){return a!==
""&&a!==null&&DigiWebApp.BautagebuchEinstellungen.find()[0].get("inStundenBuchen")?M.I18N.l("bookingDuration")+": "+a+" h":""}}}),latitude:M.LabelView.design({cssClass:"location unselectable",computedValue:{valuePattern:"<%= latitude %>",operation:function(a){if(a>0){a=new Number(a);return M.I18N.l("latitude")+" Von: "+a.toFixed(6)}else return""}}}),longitude:M.LabelView.design({cssClass:"location unselectable",computedValue:{valuePattern:"<%= longitude %>",operation:function(a){if(a>0){a=new Number(a);
return M.I18N.l("longitude")+" Von: "+a.toFixed(6)}else return""}}}),latitude_bis:M.LabelView.design({cssClass:"location unselectable",computedValue:{valuePattern:"<%= latitude_bis %>",operation:function(a){if(a>0){a=new Number(a);return M.I18N.l("latitude")+" Bis: "+a.toFixed(6)}else return""}}}),longitude_bis:M.LabelView.design({cssClass:"location unselectable",computedValue:{valuePattern:"<%= longitude_bis %>",operation:function(a){if(a>0){a=new Number(a);return M.I18N.l("longitude")+" Bis: "+
a.toFixed(6)}else return""}}})});
DigiWebApp.BautagebuchZusammenfassungMitarbeiterSummeTemplateView=M.ListItemView.design({isSelectable:NO,childViews:"positionName handOrderName vonbisdauer endOfLine activity mitarbeiterId",events:{tap:{action:function(a){a=M.ViewManager.getViewById(a);var b=a.mitarbeiterId.value;if(M.ViewManager.getCurrentPage()===DigiWebApp.BautagebuchZeitenListePage){var c=a.value.modelId;_.each(DigiWebApp.BautagebuchZeitenListeController.items,function(d){d.m_id===c&&DigiWebApp.BautagebuchZeitenDetailsController.load(d)});DigiWebApp.NavigationController.toBautagebuchZeitenDetailsPageTransition()}else DigiWebApp.BautagebuchZeitenListeController.neu(b)}}},
mitarbeiterId:M.LabelView.design({cssClass:"hiddenLabel",isInline:YES,computedValue:{valuePattern:"<%= mitarbeiterId %>",operation:function(a){return a}}}),endOfLine:M.LabelView.design({value:""}),positionName:M.LabelView.design({cssClass:"normal unselectable",isInline:YES,computedValue:{valuePattern:"<%= positionName %>",operation:function(a){return a!==""&&a!==null?a:""}}}),handOrderName:M.LabelView.design({cssClass:"normal unselectable",isInline:YES,computedValue:{valuePattern:"<%= handOrderName %>",
operation:function(a){return a!==""&&a!==null?a:""}}}),activity:M.LabelView.design({cssClass:"normal unselectable normalLabel",isInline:YES,computedValue:{valuePattern:"<%= activityName %>",operation:function(a){return a}}}),vonbisdauer:M.LabelView.design({cssClass:"normal unselectable normalLabel right",isInline:YES,computedValue:{valuePattern:"<%= vonbisdauer %>",operation:function(a){return": "+a}}})});m_require("app/views/BautagebuchZusammenfassungMitarbeiterSummeTemplateView");m_require("app/views/BautagebuchZeitenTemplateView");
DigiWebApp.BautagebuchZeitenListePage=M.PageView.design({events:{pagebeforeshow:{target:DigiWebApp.BautagebuchZeitenListeController,action:"init"}},controller:DigiWebApp.BautagebuchZeitenListeController,navigationController:DigiWebApp.NavigationController,childViews:"header content",cssClass:"bautagebuchListePage unselectable",header:M.ToolbarView.design({childViews:"backButton title newButton",cssClass:"header unselectable",isFixed:YES,backButton:M.ButtonView.design({value:M.I18N.l("back"),icon:"arrow-l",
anchorLocation:M.LEFT,events:{tap:{target:DigiWebApp.NavigationController,action:function(){try{DigiWebApp.ApplicationController.vibrate()}catch(a){}this.backToBautagebuchBautagesberichtDetailsPageTransition()}}}}),title:M.LabelView.design({value:M.I18N.l("BautagebuchZeiten"),anchorLocation:M.CENTER}),newButton:M.ButtonView.design({value:M.I18N.l("BautagebuchAdd"),icon:"new",anchorLocation:M.RIGHT,cssClass:"green_background",events:{tap:{action:function(){try{DigiWebApp.ApplicationController.vibrate()}catch(a){}DigiWebApp.BautagebuchZeitenListeController.neu()}}}}),
anchorLocation:M.TOP}),content:M.ScrollView.design({childViews:"leistungsnachweisList",list:M.ListView.design({contentBinding:{target:DigiWebApp.BautagebuchZeitenListeController,property:"items"},listItemTemplateView:DigiWebApp.BautagebuchZeitenTemplateView}),leistungsnachweisList:M.ContainerView.design({childViews:"list",cssClass:"marginBottom20 leistungsnachweisList",doNotOverlapAtTop:YES,doNotOverlapAtBottom:YES,list:M.ListView.design({cssClass:"",isDividedList:YES,contentBinding:{target:DigiWebApp.BautagebuchZusammenfassungController,
property:"ZeitbuchungenPerMitarbeiterList"},listItemTemplateView:DigiWebApp.BautagebuchZusammenfassungMitarbeiterSummeTemplateView})})})});m_require("app/views/BautagebuchZusammenfassungMitarbeiterSummeTemplateView");m_require("app/views/BautagebuchMaterialienTemplateView");m_require("app/views/BautagebuchNotizenZusammenfassungTemplateView");m_require("app/views/BautagebuchMedienTemplateView");
DigiWebApp.BautagebuchZusammenfassungPage=M.PageView.design({events:{pagebeforeshow:{action:function(){DigiWebApp.BautagebuchZusammenfassungController.init(YES);$("#"+DigiWebApp.BautagebuchZusammenfassungPage.content.container.detailsGrid.id).addClass("marginBottom20");$("#"+DigiWebApp.BautagebuchZusammenfassungPage.content.container.detailsGrid.id).addClass("detailsGrid");DigiWebApp.BautagebuchMaterialienListeController.init(YES);DigiWebApp.BautagebuchNotizenListeController.init(YES);DigiWebApp.BautagebuchMedienListeController.init(YES);
if(parseBool(DigiWebApp.BautagebuchZusammenfassungController.item.get("abgeschlossen"))){$("#"+DigiWebApp.BautagebuchZusammenfassungPage.content.grid.id).hide();$("#"+DigiWebApp.BautagebuchZusammenfassungPage.header.delButton.id).show();$("#"+DigiWebApp.BautagebuchZusammenfassungPage.content.transferGrid.id).show();$("#"+DigiWebApp.BautagebuchZusammenfassungPage.content.container.leistungsnachweisList.zeitenAendernButton.id).hide()}else{$("#"+DigiWebApp.BautagebuchZusammenfassungPage.content.grid.id).show();
$("#"+DigiWebApp.BautagebuchZusammenfassungPage.header.delButton.id).show();$("#"+DigiWebApp.BautagebuchZusammenfassungPage.content.transferGrid.id).hide();$("#"+DigiWebApp.BautagebuchZusammenfassungPage.content.container.leistungsnachweisList.zeitenAendernButton.id).show()}$("#"+DigiWebApp.BautagebuchZusammenfassungPage.content.container.leistungsnachweisList.zeitenAendernButton.id).addClass("zeitenAendernButton");if(DigiWebApp.SettingsController.featureAvailable("405")&&typeof window.requestFileSystem!==
"undefined"){$("#"+DigiWebApp.BautagebuchZusammenfassungPage.content.container.signature.id).show();var a={bgColour:"#aaa",lineTop:300,drawOnly:true};if(DigiWebApp.BautagebuchZusammenfassungPage.signaturePadAPI===null)DigiWebApp.BautagebuchZusammenfassungPage.signaturePadAPI=$(".sigPad2").signaturePad(a)}else $("#"+DigiWebApp.BautagebuchZusammenfassungPage.content.container.signature.id).hide();if(DigiWebApp.SettingsController.featureAvailable("405")&&typeof window.requestFileSystem!=="undefined")DigiWebApp.BautagebuchZusammenfassungController.item.hasFileName()===
YES?DigiWebApp.BautagebuchZusammenfassungController.item.readFromFile(function(b){b&&b!==""&&DigiWebApp.BautagebuchZusammenfassungPage.signaturePadAPI.regenerate(b)},function(){DigiWebApp.BautagebuchZusammenfassungPage.signaturePadAPI.clearCanvas()}):DigiWebApp.BautagebuchZusammenfassungPage.signaturePadAPI.clearCanvas()}}},signaturePadAPI:null,childViews:"header content",cssClass:"bautagebuchListePage unselectable",header:M.ToolbarView.design({childViews:"backButton title",cssClass:"header unselectable",
isFixed:YES,backButton:M.ButtonView.design({value:M.I18N.l("back"),icon:"arrow-l",anchorLocation:M.LEFT,events:{tap:{action:function(){try{DigiWebApp.ApplicationController.vibrate()}catch(a){}history.back()}}}}),title:M.LabelView.design({value:M.I18N.l("BautagebuchZusammenfassung"),anchorLocation:M.CENTER}),delButton:M.ButtonView.design({value:M.I18N.l("BautagebuchDelete"),icon:"delete",anchorLocation:M.RIGHT,cssClass:"red_background",events:{tap:{action:function(){try{DigiWebApp.ApplicationController.vibrate()}catch(a){}DigiWebApp.BautagebuchBautagesberichtDetailsController.deleteBautagesbericht(DigiWebApp.NavigationController.backToBautagebuchBautagesberichteListePageTransition)}}}}),
anchorLocation:M.TOP}),content:M.ScrollView.design({childViews:"container grid transferGrid loeschenButton",container:M.ContainerView.design({childViews:"detailsGrid leistungsnachweisList materialienList notizenList medienList signature spacer",cssClass:"bautagebuchZusammenfassungScrollView",spacer:M.LabelView.design({value:"&nbsp;",cssClass:"invisible"}),detailsGrid:M.GridView.design({childViews:"details wetter",cssClass:"marginBottom20 detailsGrid",layout:M.TWO_COLUMNS,details:M.ContainerView.design({childViews:"auftrag datum spacer1 projektleiter spacer2 startUhrzeit",
spacer1:M.LabelView.design({value:"&nbsp;"}),spacer2:M.LabelView.design({value:"&nbsp;"}),auftrag:M.LabelView.design({value:"",cssClass:"bigLabel bold underline",isInline:YES,computedValue:{contentBinding:{target:DigiWebApp.BautagebuchZusammenfassungController,property:"auftragsName"},value:"",operation:function(a){return a+": "}}}),datum:M.LabelView.design({value:"",cssClass:"bigLabel bold underline",isInline:YES,contentBinding:{target:DigiWebApp.BautagebuchZusammenfassungController,property:"datum"}}),
projektleiter:M.LabelView.design({value:"",cssClass:"bigLabel",computedValue:{contentBinding:{target:DigiWebApp.BautagebuchZusammenfassungController,property:"projektleiterId"},value:"",operation:function(a){var b=_.find(DigiWebApp.BautagebuchProjektleiter.find(),function(c){return parseIntRadixTen(c.get("id"))===a});return typeof b!=="undefined"?M.I18N.l("BautagebuchProjektleiter")+": "+b.vollername():""}}}),startUhrzeit:M.LabelView.design({value:"",cssClass:"bigLabel",computedValue:{contentBinding:{target:DigiWebApp.BautagebuchZusammenfassungController,
property:"startUhrzeit"},value:"",operation:function(a){return M.I18N.l("BautagebuchStartingFrom")+" "+a+" "+M.I18N.l("oclock")}}})}),wetter:M.ContainerView.design({childViews:"temperatur luftfeuchte bewoelkung niederschlag wind wechselhaft",cssClass:"wetterBlock",temperatur:M.GridView.design({layout:M.TWO_COLUMNS,childViews:"myLabel myValue",myLabel:M.LabelView.design({value:M.I18N.l("BautagebuchTemperatur")}),myValue:M.LabelView.design({value:"",cssClass:"right",computedValue:{contentBinding:{target:DigiWebApp.BautagebuchZusammenfassungController,
property:"wetter.temperatur"},value:"",operation:function(a){return a+"\u00b0C"}}})}),luftfeuchte:M.GridView.design({layout:M.TWO_COLUMNS,childViews:"myLabel myValue",myLabel:M.LabelView.design({value:M.I18N.l("BautagebuchLuftfeuchtigkeit")}),myValue:M.LabelView.design({value:"",cssClass:"right",computedValue:{contentBinding:{target:DigiWebApp.BautagebuchZusammenfassungController,property:"wetter.luftfeuchtigkeit"},value:"",operation:function(a){return a+"%"}}})}),bewoelkung:M.GridView.design({layout:M.TWO_COLUMNS,
childViews:"myLabel myValue",myLabel:M.LabelView.design({value:M.I18N.l("BautagebuchBewoelkung")}),myValue:M.LabelView.design({value:"",cssClass:"right",computedValue:{contentBinding:{target:DigiWebApp.BautagebuchZusammenfassungController,property:"wetter.bewoelkung"},value:0,operation:function(a){switch(a){case 0:return M.I18N.l("BautagebuchBewoelkungKlar");case 1:return M.I18N.l("BautagebuchBewoelkungMaessig");case 2:return M.I18N.l("BautagebuchBewoelkungBedeckt");case 3:return M.I18N.l("BautagebuchBewoelkungNeblig");
default:return""}}}})}),niederschlag:M.GridView.design({layout:M.TWO_COLUMNS,childViews:"myLabel myValue",myLabel:M.LabelView.design({value:M.I18N.l("BautagebuchNiederschlag")}),myValue:M.LabelView.design({value:"",cssClass:"right",computedValue:{contentBinding:{target:DigiWebApp.BautagebuchZusammenfassungController,property:"wetter.niederschlag"},value:0,operation:function(a){switch(a){case 0:return M.I18N.l("BautagebuchNiederschlagKein");case 1:return M.I18N.l("BautagebuchNiederschlagNiesel");case 2:return M.I18N.l("BautagebuchNiederschlagRegen");
case 3:return M.I18N.l("BautagebuchNiederschlagGraupel");case 4:return M.I18N.l("BautagebuchNiederschlagSchnee");case 5:return M.I18N.l("BautagebuchNiederschlagHagel");default:return""}}}})}),wind:M.GridView.design({layout:M.TWO_COLUMNS,childViews:"myLabel myValue",myLabel:M.LabelView.design({value:M.I18N.l("BautagebuchWind")}),myValue:M.LabelView.design({value:"",cssClass:"right",computedValue:{contentBinding:{target:DigiWebApp.BautagebuchZusammenfassungController,property:"wetter.wind"},value:0,
operation:function(a){switch(a){case 0:return M.I18N.l("BautagebuchWindStill");case 1:return M.I18N.l("BautagebuchWindMaessig");case 2:return M.I18N.l("BautagebuchWindBoeig");case 3:return M.I18N.l("BautagebuchWindStuermisch");case 4:return M.I18N.l("BautagebuchWindOrkan");default:return""}}}})}),wechselhaft:M.GridView.design({layout:M.TWO_COLUMNS,childViews:"myLabel myValue",myLabel:M.LabelView.design({value:M.I18N.l("BautagebuchWechselhaft")}),myValue:M.LabelView.design({value:"",cssClass:"right",
computedValue:{contentBinding:{target:DigiWebApp.BautagebuchZusammenfassungController,property:"wetter.wechselhaft"},value:0,operation:function(a){switch(a){case false:return M.I18N.l("no");case true:return M.I18N.l("yes");default:return""}}}})})})}),leistungsnachweisList:M.ContainerView.design({childViews:"myLabel zeitenAendernButton list",cssClass:"marginBottom20 leistungsnachweisList",doNotOverlapAtTop:YES,doNotOverlapAtBottom:YES,myLabel:M.LabelView.design({cssClass:"bigLabel bold",isInline:YES,
value:M.I18N.l("BautagebuchLeistungsnachweis")+":"}),zeitenAendernButton:M.ButtonView.design({value:M.I18N.l("BautagebuchZeitenAendern"),anchorLocation:M.RIGHT,isInline:YES,events:{tap:{target:DigiWebApp.NavigationController,action:"backToBautagebuchZeitenListePageTransition"}}}),list:M.ListView.design({cssClass:"marginTop25important",isDividedList:YES,contentBinding:{target:DigiWebApp.BautagebuchZusammenfassungController,property:"ZeitbuchungenPerMitarbeiterList"},listItemTemplateView:DigiWebApp.BautagebuchZusammenfassungMitarbeiterSummeTemplateView})}),
materialienList:M.ContainerView.design({childViews:"myLabel list",cssClass:"marginBottom20 materialienList",doNotOverlapAtTop:YES,doNotOverlapAtBottom:YES,myLabel:M.LabelView.design({cssClass:"bigLabel bold",value:M.I18N.l("BautagebuchMaterialien")+":"}),list:M.ListView.design({cssClass:"marginTop20",contentBinding:{target:DigiWebApp.BautagebuchMaterialienListeController,property:"items"},listItemTemplateView:DigiWebApp.BautagebuchMaterialienTemplateView})}),notizenList:M.ContainerView.design({childViews:"myLabel list",
cssClass:"marginBottom20 notizenList",doNotOverlapAtTop:YES,doNotOverlapAtBottom:YES,myLabel:M.LabelView.design({cssClass:"bigLabel bold",value:M.I18N.l("BautagebuchNotizen")+":"}),list:M.ListView.design({cssClass:"marginTop20",contentBinding:{target:DigiWebApp.BautagebuchNotizenListeController,property:"items"},listItemTemplateView:DigiWebApp.BautagebuchNotizenZusammenfassungTemplateView})}),medienList:M.ContainerView.design({childViews:"myLabel list",cssClass:"marginBottom20 medienList borderBottom",
doNotOverlapAtTop:YES,doNotOverlapAtBottom:YES,myLabel:M.LabelView.design({cssClass:"bigLabel bold",value:M.I18N.l("BautagebuchMedien")+":"}),list:M.ListView.design({cssClass:"marginTop20",contentBinding:{target:DigiWebApp.BautagebuchMedienListeController,property:"items"},listItemTemplateView:DigiWebApp.BautagebuchMedienTemplateView})}),signature:M.ContainerView.design({childViews:"signatureform",cssClass:"signaturecanvas2 marginTop20 marginBottom20",signatureform:M.FormView.design({childViews:"signaturecanvas",
signaturecanvas:M.CanvasView.design({label:M.I18N.l("signature")+":",canvasWidth:550,canvasHeight:320,render:function(){if(this.label)this.html+='<label for="'+this.id+'" class="signaturecanvaslabel">'+this.label+"</label>";this.html+='  <div id="'+this.id+'_container" class="sig sigWrapper2">';this.html+='    <canvas id="'+this.id+'_canvas" class="pad" width="'+this.canvasWidth+'px" height="'+this.canvasHeight+'px" style="border-color: #000; border: 1px solid #ccc;"></canvas>';this.html+='    <input id="'+
this.id+'" type="hidden" name="output" class="output">';this.html+="  </div>";return this.html}}),render:function(){this.html+='<form method="post" action="" class="sigPad2">';this.renderChildViews();this.html+="</form>";return this.html}})})}),grid:M.GridView.design({childViews:"button icon",layout:{cssClass:"digiButton marginTop20",columns:{0:"button",1:"icon"}},button:M.ButtonView.design({value:M.I18N.l("BautagebuchBautagesberichtAbschliessen"),cssClass:"digiButton green_background",anchorLocation:M.RIGHT,
events:{tap:{action:function(){try{DigiWebApp.ApplicationController.vibrate()}catch(a){}DigiWebApp.BautagebuchZusammenfassungController.finish(DigiWebApp.NavigationController.backToBautagebuchBautagesberichteListePageTransition);DigiWebApp.BautagebuchZusammenfassungController.load(DigiWebApp.BautagebuchZusammenfassungController.item);DigiWebApp.NavigationController.toBautagebuchZusammenfassungPageTransition()}}}}),icon:M.ImageView.design({value:"theme/images/icon_bookTime.png"})}),transferGrid:M.GridView.design({childViews:"button icon",
layout:{cssClass:"digiButton marginTop20",columns:{0:"button",1:"icon"}},button:M.ButtonView.design({value:M.I18N.l("BautagebuchUebertragen"),cssClass:"digiButton",anchorLocation:M.RIGHT,events:{tap:{action:function(){try{DigiWebApp.ApplicationController.vibrate()}catch(a){}var b=DigiWebApp.BautagebuchZusammenfassungController,c=NO;if(b.lastTimestampDatatransfer!==null)if(D8.now().getTimestamp()-b.lastTimestampDatatransfer>parseIntRadixTen(DigiWebApp.SettingsController.getSetting("datatransfer_min_delay")))c=
YES;if(c===YES||b.lastTimestampDatatransfer===null){b.set("lastTimestampDatatransfer",D8.now().getTimestamp());DigiWebApp.BautagebuchDatenuebertragungController.senden(DigiWebApp.BautagebuchZusammenfassungController.item,function(){DigiWebApp.BautagebuchZusammenfassungController.set("item",null);DigiWebApp.NavigationController.backToBautagebuchBautagesberichteListePageTransition()},function(d,e){trackError(e);DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("BautagebuchUebertragungsfehler"),
message:M.I18N.l("BautagebuchUebertragungsfehlerMsg")})})}}}}}),icon:M.ImageView.design({value:"theme/images/icon_bookTime.png"})}),loeschenButton:M.ButtonView.design({value:M.I18N.l("BautagebuchDelete"),cssClass:"red_background",events:{tap:{target:DigiWebApp.BautagebuchBautagesberichtDetailsController,action:function(){try{DigiWebApp.ApplicationController.vibrate()}catch(a){}this.deleteBautagesbericht(DigiWebApp.NavigationController.backToBautagebuchBautagesberichteListePageTransition)}}}})})});
DigiWebApp.BautagebuchZusammenfassungMitarbeiterZeitenTemplateView=M.ListItemView.design({isSelectable:NO,childViews:"name summe",events:{tap:{action:function(){}}},name:M.LabelView.design({cssClass:"normal unselectable bigLabel",isInline:YES,computedValue:{valuePattern:"<%= id %>",operation:function(a){var b=_.find(DigiWebApp.BautagebuchMitarbeiter.find(),function(c){return parseIntRadixTen(c.get("id"))===a});return typeof b!=="undefined"?b.vollername():a}}}),summe:M.LabelView.design({cssClass:"normal unselectable bigLabel right",
isInline:YES,computedValue:{valuePattern:"<%= id %>",operation:function(a){return a}}})});
DigiWebApp.ButtonDashboardTemplateView=M.ListItemView.design({isSelectable:NO,childViews:"button icon",events:{tap:{target:DigiWebApp.DashboardController,action:"itemSelected"}},button:M.ButtonView.design({cssClass:"scholppButton",computedValue:{valuePattern:"<%= label %>",operation:function(a){return a===null||typeof a==="undefined"?null:a}},events:{tap:{target:DigiWebApp.DashboardController,action:"itemSelected"}}}),icon:M.ImageView.design({cssClass:"scholppButtonMenuIcon",computedValue:{valuePattern:"<%= icon %>",
operation:function(a){return a===null||typeof a==="undefined"?null:"theme/images/"+a}}})});
DigiWebApp.CameraPage=M.PageView.design({events:{pagebeforeshow:{target:DigiWebApp.CameraController,action:"init"}},cssClass:"cameraPage",childViews:"header content",savePicture:function(){var a="";if(M.ViewManager.getView("cameraPage","remarkInput").value!==null&&typeof M.ViewManager.getView("cameraPage","remarkInput").value!=="undefined")a=M.ViewManager.getView("cameraPage","remarkInput").value;if(a.length>255){DigiWebApp.ApplicationController.DigiLoaderView.hide();DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("remarkTooLong"),
message:M.I18N.l("remarkTooLongMessage")})}else if(DigiWebApp.ApplicationController.sonderzeichenCheck(a)){DigiWebApp.ApplicationController.DigiLoaderView.hide();DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("specialCharProblem"),message:M.I18N.l("specialCharProblemMsg")})}else DigiWebApp.CameraController.savePicture()},header:M.ToolbarView.design({childViews:"backButton title",cssClass:"header",isFixed:YES,backButton:M.ButtonView.design({value:M.I18N.l("back"),icon:"arrow-l",
anchorLocation:M.LEFT,events:{tap:{target:DigiWebApp.NavigationController,action:"backToMediaListPageTransition"}}}),title:M.LabelView.design({value:M.I18N.l("takePicture"),anchorLocation:M.CENTER}),anchorLocation:M.TOP}),content:M.ScrollView.design({childViews:"image spacer order position activity remarkInput savePictureGrid",image:M.ImageView.design({value:"",cssClass:"photo"}),spacer:M.LabelView.design({value:" "}),order:M.SelectionListView.design({selectionMode:M.SINGLE_SELECTION_DIALOG,initialText:M.I18N.l("noData"),
label:M.I18N.l("order"),applyTheme:NO,contentBinding:{target:DigiWebApp.CameraController,property:"orders"},events:{change:{target:DigiWebApp.CameraController,action:function(){this.setPositions()}}}}),position:M.SelectionListView.design({selectionMode:M.SINGLE_SELECTION_DIALOG,label:M.I18N.l("position"),initialText:M.I18N.l("noData"),applyTheme:NO,contentBinding:{target:DigiWebApp.CameraController,property:"positions"},events:{change:{target:DigiWebApp.CameraController,action:function(){this.setActivities(YES)}}}}),
activity:M.SelectionListView.design({selectionMode:M.SINGLE_SELECTION_DIALOG,label:M.I18N.l("activity"),initialText:M.I18N.l("noData"),applyTheme:NO,contentBinding:{target:DigiWebApp.CameraController,property:"activities"},events:{change:{target:DigiWebApp.CameraController,action:function(){}}}}),remarkInput:M.TextFieldView.design({label:M.I18N.l("remark"),cssClass:"remarkInput",hasMultipleLines:YES,numberOfChars:255}),savePictureGrid:M.GridView.design({childViews:"button icon",layout:{cssClass:"marginTop40 digiButton",
columns:{0:"button",1:"icon"}},button:M.ButtonView.design({value:M.I18N.l("assume"),cssClass:"digiButton",anchorLocation:M.RIGHT,events:{tap:{action:function(){DigiWebApp.CameraPage.savePicture()}}}}),icon:M.ImageView.design({value:"theme/images/icon_bookTime.png"})})})});
DigiWebApp.DashboardTemplateView=M.ListItemView.design({isSelectable:NO,childViews:"icon label",events:{tap:{target:DigiWebApp.DashboardController,action:"itemSelected"}},icon:M.ImageView.design({cssClass:"unselectable",computedValue:{valuePattern:"<%= icon %>",operation:function(a){return"theme/images/"+a}}}),label:M.LabelView.design({cssClass:"unselectable",valuePattern:"<%= label %>"})});
DigiWebApp.DemoAudioPage=M.PageView.design({events:{pagebeforeshow:{target:DigiWebApp.DemoAudioController,action:"init"}},childViews:"header content",cssClass:"demoAudioPage",header:M.ToolbarView.design({childViews:"backButton title",cssClass:"header",isFixed:YES,backButton:M.ButtonView.design({value:M.I18N.l("back"),icon:"arrow-l",anchorLocation:M.LEFT,events:{tap:{target:DigiWebApp.NavigationController,action:"backToDemoMediaPage"}}}),title:M.LabelView.design({value:M.I18N.l("settings"),anchorLocation:M.CENTER}),
anchorLocation:M.TOP}),content:M.ScrollView.design({childViews:"audioIcon grid",audioIcon:M.ImageView.design({value:"theme/images/icon_record.png",cssClass:"audioIcon",events:{tap:{target:DigiWebApp.DemoAudioController,action:"recordAudio"}}}),recordIcon:M.ImageView.design({value:"theme/images/icon_record.png",cssClass:"mediaIcon",events:{tap:{action:DigiWebApp.DemoAudioController.recordAudio}}}),stopRecordIcon:M.ImageView.design({value:"theme/images/icon_stop.png",cssClass:"mediaIcon",events:{tap:{action:DigiWebApp.DemoAudioController.stopRecord}}}),
playIcon:M.ImageView.design({value:"theme/images/icon_playbackAudio.png",cssClass:"mediaIcon",events:{tap:{action:DigiWebApp.DemoAudioController.playbackAudio}}}),stopIcon:M.ImageView.design({value:"theme/images/icon_stop.png",cssClass:"mediaIcon",events:{tap:{action:DigiWebApp.DemoAudioController.stopPlayback}}}),grid:M.GridView.design({childViews:"button icon",layout:{cssClass:"marginTop40 digiButton",columns:{0:"button",1:"icon"}},button:M.ButtonView.design({value:M.I18N.l("recordAudio"),cssClass:"digiButton",
anchorLocation:M.RIGHT,events:{tap:{target:DigiWebApp.DemoAudioController,action:"recordAudio"}}}),icon:M.ImageView.design({value:"theme/images/icon_bookTime.png"})})})});DigiWebApp.DemoMediaPageTemplateView=M.ListItemView.design({isSelectable:NO,childViews:"icon label",events:{tap:{target:DigiWebApp.DemoMediaPageController,action:"itemSelected"}},icon:M.ImageView.design({computedValue:{valuePattern:"<%= icon %>",operation:function(a){return"theme/images/"+a}}}),label:M.LabelView.design({valuePattern:"<%= label %>"})});
m_require("app/views/DemoMediaPageTemplateView.js");
DigiWebApp.DemoMediaPage=M.PageView.design({childViews:"header content",cssClass:"demoMediaPage",events:{pagebeforeshow:{target:DigiWebApp.DemoMediaPageController,action:"init"}},needsUpdate:true,header:M.ToolbarView.design({childViews:"backButton title",cssClass:"header",isFixed:YES,backButton:M.ButtonView.design({value:M.I18N.l("back"),icon:"arrow-l",anchorLocation:M.LEFT,events:{tap:{target:DigiWebApp.NavigationController,action:"backToDashboardPage"}}}),title:M.LabelView.design({value:M.I18N.l("info"),
anchorLocation:M.CENTER}),anchorLocation:M.TOP}),content:M.ScrollView.design({childViews:"list",list:M.ListView.design({contentBinding:{target:DigiWebApp.DemoMediaPageController,property:"items"},listItemTemplateView:DigiWebApp.DemoMediaPageTemplateView})})});DigiWebApp.DummyTemplateView=M.ListItemView.design({isSelectable:NO,childViews:""});m_require("app/views/DummyTemplateView");
DigiWebApp.FestePauseStornierenPage=M.PageView.design({events:{pagebeforeshow:{target:DigiWebApp.FestePauseStornierenController,action:"init"}},childViews:"header content",cssClass:"festePauseStornierenPage",header:M.ToolbarView.design({childViews:"backButton title",cssClass:"header",isFixed:YES,backButton:M.ButtonView.design({value:M.I18N.l("back"),icon:"arrow-l",anchorLocation:M.LEFT,events:{tap:{action:function(){try{DigiWebApp.ApplicationController.vibrate()}catch(a){}DigiWebApp.SettingsController.featureAvailable("404")?
DigiWebApp.NavigationController.backToButtonDashboardPage():DigiWebApp.NavigationController.backToDashboardPage()}}}}),title:M.LabelView.design({value:M.I18N.l("FestePauseStornieren"),anchorLocation:M.CENTER}),anchorLocation:M.TOP}),content:M.ScrollView.design({childViews:"gesternBalken gesternPausenList heuteBalken heutePausenList morgenBalken morgenPausenList stornierenButton",gesternBalken:M.ListView.design({isDividedList:YES,contentBinding:{target:DigiWebApp.FestePauseStornierenController,property:"gesternBalken"},
listItemTemplateView:DigiWebApp.DummyTemplateView}),gesternPausenList:M.SelectionListView.design({selectionMode:M.MULTIPLE_SELECTION,cssClass:"festePausen",contentBinding:{target:DigiWebApp.FestePauseStornierenController,property:"gesternPausenList"}}),heuteBalken:M.ListView.design({isDividedList:YES,contentBinding:{target:DigiWebApp.FestePauseStornierenController,property:"heuteBalken"},listItemTemplateView:DigiWebApp.DummyTemplateView}),heutePausenList:M.SelectionListView.design({selectionMode:M.MULTIPLE_SELECTION,
cssClass:"festePausen",contentBinding:{target:DigiWebApp.FestePauseStornierenController,property:"heutePausenList"}}),morgenBalken:M.ListView.design({isDividedList:YES,contentBinding:{target:DigiWebApp.FestePauseStornierenController,property:"morgenBalken"},listItemTemplateView:DigiWebApp.DummyTemplateView}),morgenPausenList:M.SelectionListView.design({selectionMode:M.MULTIPLE_SELECTION,cssClass:"festePausen",contentBinding:{target:DigiWebApp.FestePauseStornierenController,property:"morgenPausenList"}}),
stornierenButton:M.GridView.design({childViews:"button icon",layout:{cssClass:"digiButton",columns:{0:"button",1:"icon"}},button:M.ButtonView.design({value:M.I18N.l("stornierenSpeichern"),cssClass:"digiButton",anchorLocation:M.RIGHT,events:{tap:{target:DigiWebApp.FestePauseStornierenController,action:function(){try{DigiWebApp.ApplicationController.vibrate()}catch(a){}this.save()}}}}),icon:M.ImageView.design({value:"theme/images/icon_bookTime.png"})})})});
DigiWebApp.EditPicturePage=M.PageView.design({childViews:"header content",cssClass:"editPicturePage",events:{pagebeforeshow:{target:DigiWebApp.EditPicturePageController,action:"init"},pageshow:{action:function(){}}},savePicture:function(){var a="";if(M.ViewManager.getView("editPicturePage","remarkInput").value!==null&&typeof M.ViewManager.getView("editPicturePage","remarkInput").value!=="undefined")a=M.ViewManager.getView("editPicturePage","remarkInput").value;if(a.length>255){DigiWebApp.ApplicationController.DigiLoaderView.hide();
DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("remarkTooLong"),message:M.I18N.l("remarkTooLongMessage")})}else if(DigiWebApp.ApplicationController.sonderzeichenCheck(a)){DigiWebApp.ApplicationController.DigiLoaderView.hide();DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("specialCharProblem"),message:M.I18N.l("specialCharProblemMsg")})}else DigiWebApp.EditPicturePageController.savePicture()},header:M.ToolbarView.design({childViews:"backButton title deleteButton",
cssClass:"header",isFixed:YES,backButton:M.ButtonView.design({value:M.I18N.l("back"),icon:"arrow-l",anchorLocation:M.LEFT,events:{tap:{target:DigiWebApp.NavigationController,action:function(){try{DigiWebApp.ApplicationController.vibrate()}catch(a){}this.backToMediaListPageTransition()}}}}),deleteButton:M.ButtonView.design({value:M.I18N.l("deleteLabel"),icon:"delete",anchorLocation:M.RIGHT,cssClass:"red_background",events:{tap:{action:function(){try{DigiWebApp.ApplicationController.vibrate()}catch(a){}DigiWebApp.ApplicationController.DigiLoaderView.show(M.I18N.l("deleteMediaFile"));
DigiWebApp.EditPicturePageController.myMediaFile.deleteFile(DigiWebApp.EditPicturePageController.deleteMediaFileFromLocalStorage,function(){DigiWebApp.EditPicturePageController.deleteMediaFileFromLocalStorage()})}}}}),title:M.LabelView.design({value:M.I18N.l("editPicture"),anchorLocation:M.CENTER}),anchorLocation:M.TOP}),content:M.ScrollView.design({childViews:"image spacer order position activity remarkInput savePictureGrid",image:M.ImageView.design({value:"",cssClass:"photo"}),spacer:M.LabelView.design({value:" "}),
order:M.SelectionListView.design({selectionMode:M.SINGLE_SELECTION_DIALOG,initialText:M.I18N.l("noData"),label:M.I18N.l("order"),applyTheme:NO,contentBinding:{target:DigiWebApp.EditPicturePageController,property:"orders"},events:{change:{target:DigiWebApp.EditPicturePageController,action:function(){this.setPositions()}}}}),position:M.SelectionListView.design({selectionMode:M.SINGLE_SELECTION_DIALOG,label:M.I18N.l("position"),initialText:M.I18N.l("noData"),applyTheme:NO,contentBinding:{target:DigiWebApp.EditPicturePageController,
property:"positions"},events:{change:{target:DigiWebApp.EditPicturePageController,action:function(){this.setActivities(YES)}}}}),activity:M.SelectionListView.design({selectionMode:M.SINGLE_SELECTION_DIALOG,label:M.I18N.l("activity"),initialText:M.I18N.l("noData"),applyTheme:NO,contentBinding:{target:DigiWebApp.EditPicturePageController,property:"activities"},events:{change:{target:DigiWebApp.EditPicturePageController,action:function(){}}}}),remarkInput:M.TextFieldView.design({label:M.I18N.l("remark"),
cssClass:"remarkInput",hasMultipleLines:YES,numberOfChars:255}),savePictureGrid:M.GridView.design({childViews:"button icon",layout:{cssClass:"marginTop40 digiButton",columns:{0:"button",1:"icon"}},button:M.ButtonView.design({value:M.I18N.l("assume"),cssClass:"digiButton",anchorLocation:M.RIGHT,events:{tap:{action:function(){try{DigiWebApp.ApplicationController.vibrate()}catch(a){}DigiWebApp.ApplicationController.DigiLoaderView.show(M.I18N.l("saveMediaFile"));DigiWebApp.EditPicturePage.savePicture()}}}}),
icon:M.ImageView.design({value:"theme/images/icon_bookTime.png"})})})});
DigiWebApp.EmployeePage=M.PageView.design({childViews:"header content",events:{pagebeforeshow:{target:DigiWebApp.EmployeeController,action:"init"}},cssClass:"employeePage",header:M.ToolbarView.design({cssClass:"header",isFixed:YES,value:M.I18N.l("selectEmployee"),anchorLocation:M.TOP}),content:M.ScrollView.design({childViews:"employeeSelection buttonGrid",employeeSelection:M.SelectionListView.design({selectionMode:M.MULTIPLE_SELECTION,label:M.I18N.l("employees"),cssClass:"infoLabel",contentBinding:{target:DigiWebApp.EmployeeController,
property:"employees"}}),buttonGrid:M.GridView.design({childViews:"button icon",layout:{cssClass:"digiButton",columns:{0:"button",1:"icon"}},button:M.ButtonView.design({value:M.I18N.l("apply"),cssClass:"digiButton",anchorLocation:M.RIGHT,events:{tap:{target:DigiWebApp.EmployeeController,action:function(){try{DigiWebApp.ApplicationController.vibrate()}catch(a){}this.saveEmployeeSelection()}}}}),icon:M.ImageView.design({value:"theme/images/icon_bookTime.png"})})})});
DigiWebApp.FileChooserPage=M.PageView.design({childViews:"header content",cssClass:"fileChooserPage",successCallback:function(){},events:{pagebeforeshow:{action:function(){$("#"+DigiWebApp.FileChooserPage.content.inputfile.id).val("");$("#"+DigiWebApp.FileChooserPage.content.inputfile.id).unbind("change");$("#"+DigiWebApp.FileChooserPage.content.inputfile.id).bind("change",function(a){var b=a.target.files[0];a=new FileReader;a.onload=function(){DigiWebApp.FileChooserPage.successCallback(this.result,
b.name)};a.onerror=function(){DigiWebApp.FileChooserPage.successCallback(null)};a.readAsDataURL(b)})}}},header:M.ToolbarView.design({childViews:"backButton title",cssClass:"header",isFixed:YES,backButton:M.ButtonView.design({value:M.I18N.l("back"),icon:"arrow-l",anchorLocation:M.LEFT,events:{tap:{action:function(){try{DigiWebApp.ApplicationController.vibrate()}catch(a){}history.back()}}}}),title:M.LabelView.design({value:M.I18N.l("editPicture"),anchorLocation:M.CENTER}),anchorLocation:M.TOP}),content:M.ScrollView.design({childViews:"inputfile",
cssClass:"inputfile",inputfile:M.FormView.design({childViews:"",render:function(){this.html+='<form method="post" action="" class="">';this.html+='<input type="file" id="'+this.id+'" enctype="multipart/form-data" />';this.html+="</form>";return this.html}})})});
DigiWebApp.MediaListTemplateView=M.ListItemView.design({isSelectable:YES,childViews:"icon timeStamp order position activity latitude longitude remark",events:{tap:{action:function(a){DigiWebApp.ApplicationController.DigiLoaderView.show(M.I18N.l("loadMediaFile"));var b=NO,c=M.ViewManager.getViewById(a).modelId;_.each(DigiWebApp.MediaListController.items,function(d){if(d.m_id===c){DigiWebApp.EditPicturePageController.set("myMediaFile",d);b=YES}});b===YES?DigiWebApp.NavigationController.toEditPicturePageTransition():
DigiWebApp.ApplicationController.DigiLoaderView.hide()}}},icon:M.ImageView.design({cssClass:"icon",computedValue:{valuePattern:"<%= icon %>",operation:function(a){return a?"theme/images/"+a:""}}}),timeStamp:M.LabelView.design({cssClass:"date",computedValue:{valuePattern:"<%= timeStamp %>",operation:function(a){a=M.Date.create(Number(a));return a.format("dd.mm.yyyy")+", "+a.format("HH:MM:ss")}}}),order:M.LabelView.design({cssClass:"application",computedValue:{valuePattern:"<%= orderId %>",operation:function(a){var b=
_.select(DigiWebApp.Order.findSorted().concat(DigiWebApp.HandOrder.findSorted()),function(d){if(d)return a==d.get("id")||a==d.get("name")}),c=DigiWebApp.SettingsController.getSetting("DTC6aktiv")===YES?M.I18N.l("dtc6Ordner"):M.I18N.l("order");if(b&&b.length>0){b=b[0];return DigiWebApp.SettingsController.globalDebugMode?c+": "+b.get("name")+" ("+b.get("id")+")":c+": "+b.get("name")}else return c+": "+M.I18N.l("notDefined")}}}),position:M.LabelView.design({cssClass:"position",computedValue:{valuePattern:"<%= positionId %>",
operation:function(a){var b=DigiWebApp.SettingsController.getSetting("DTC6aktiv")===YES?M.I18N.l("dtc6Auftrag"):M.I18N.l("position");if(a){var c=_.select(DigiWebApp.Position.findSorted(),function(d){if(d)return a==d.get("id")});if(c&&c.length>0){c=c[0];return b+": "+c.get("name")}else return b+": "+M.I18N.l("notDefined")}else return b+": "+M.I18N.l("unknown")}}}),activity:M.LabelView.design({cssClass:"activity",computedValue:{valuePattern:"<%= activityId %>",operation:function(a){var b=DigiWebApp.SettingsController.getSetting("DTC6aktiv")===
YES?M.I18N.l("dtc6Leistung"):M.I18N.l("activity");if(a){var c=null;if(parseIntRadixTen(a)!==0)c=_.select(DigiWebApp.Activity.findSorted(),function(d){if(d)return a==d.get("id")});if(c&&c.length>0){c=c[0];return b+": "+c.get("name")}else return b+": "+M.I18N.l("notDefined")}else return b+": "+M.I18N.l("unknown")}}}),latitude:M.LabelView.design({cssClass:"location",computedValue:{valuePattern:"<%= latitude %>",operation:function(a){return a>0?M.I18N.l("latitude")+": "+a.toFixed(6):""}}}),longitude:M.LabelView.design({cssClass:"location",
computedValue:{valuePattern:"<%= longitude %>",operation:function(a){return a>0?M.I18N.l("longitude")+": "+a.toFixed(6):""}}}),remark:M.LabelView.design({cssClass:"remark unselectable",computedValue:{valuePattern:"<%= remark %>",operation:function(a){return a?M.I18N.l("remark")+": "+a:""}}})});m_require("app/views/MediaListTemplateView.js");
DigiWebApp.MediaListPage=M.PageView.design({events:{pagebeforeshow:{target:DigiWebApp.MediaListController,action:"init"}},needsUpdate:true,childViews:"header newButton uebertragenButton mediafiles",cssClass:"mediaListPage unselectable",header:M.ToolbarView.design({childViews:"backButton title newButton",cssClass:"header",isFixed:YES,backButton:M.ButtonView.design({value:M.I18N.l("back"),icon:"arrow-l",anchorLocation:M.LEFT,events:{tap:{target:DigiWebApp.NavigationController,action:function(){try{DigiWebApp.ApplicationController.vibrate()}catch(a){}this.backToDashboardPage()}}}}),
title:M.LabelView.design({value:M.I18N.l("mediaList"),anchorLocation:M.CENTER}),newButton:M.ButtonView.design({value:M.I18N.l("BautagebuchAdd"),icon:"new",anchorLocation:M.RIGHT,cssClass:"green_background",events:{tap:{action:function(){DigiWebApp.MediaListController.neu()}}}}),anchorLocation:M.TOP}),uebertragenButton:M.ButtonView.design({value:M.I18N.l("uploadMediaFiles"),events:{tap:{action:function(){writeToLog("Medienliste: '"+M.I18N.l("uploadMediaFiles")+"' gedr\u00fcckt");DigiWebApp.MediaListController.uploadMediaFiles()}}}}),
newButton:M.ButtonView.design({value:M.I18N.l("BautagebuchAdd"),cssClass:"green_background",events:{tap:{action:function(){DigiWebApp.MediaListController.neu()}}}}),mediafiles:M.ScrollView.design({childViews:"mediafileslist",cssClass:"mediafilesList",mediafileslist:M.ListView.design({contentBinding:{target:DigiWebApp.MediaListController,property:"items"},listItemTemplateView:DigiWebApp.MediaListTemplateView})})});
DigiWebApp.OrderInfoTemplateView=M.ListItemView.design({isSelectable:NO,hasSingleAction:NO,childViews:"orderName positionName spacer1 positionStrasseUndHausnummer positionPLZundORT positionLand positionTelefon positionFax positionEmail spacerNachEmail positionAnsprechpartner positionKundenname spacer3 positionBeschreibung spacer4 positionLongitude positionLatitude spacer5 arbeitsbeginn arbeitsende spacer6 showCoordinatesInMapButton saveAsContactButton showAddressInMapButton",orderName:M.LabelView.design({cssClass:"orderName",
computedValue:{valuePattern:"<%= orderName %>",operation:function(a){return a}}}),positionName:M.LabelView.design({cssClass:"positionName",computedValue:{valuePattern:"<%= positionName %>",operation:function(a){var b=DigiWebApp.SettingsController.getSetting("DTC6aktiv")===YES?M.I18N.l("dtc6Auftrag"):M.I18N.l("position");return a===""||a===null?b+": "+M.I18N.l("noData"):b+": "+a}}}),positionStrasseUndHausnummer:M.LabelView.design({cssClass:"positionName",computedValue:{valuePattern:"<%= positionStrasseUndHausnummer %>",
operation:function(a){return a}}}),positionPLZundORT:M.LabelView.design({cssClass:"positionName",computedValue:{valuePattern:"<%= positionPLZundOrt %>",operation:function(a){return a}}}),positionLand:M.LabelView.design({cssClass:"positionName",computedValue:{valuePattern:"<%= positionLand %>",operation:function(a){return a}}}),positionTelefon:M.LabelView.design({cssClass:"positionName",computedValue:{valuePattern:"<%= positionTelefon %>",operation:function(a){return a===""||a===null||a==="undefined"||
typeof a==="undefined"?"":M.I18N.l("phone")+": "+a}}}),positionFax:M.LabelView.design({cssClass:"positionName",computedValue:{valuePattern:"<%= positionFax %>",operation:function(a){return a===""||a===null||a==="undefined"||typeof a==="undefined"?"":M.I18N.l("fax")+": "+a}}}),positionEmail:M.LabelView.design({cssClass:"positionName",computedValue:{valuePattern:"<%= positionEmail %>",operation:function(a){return a===""||a===null||a==="undefined"||typeof a==="undefined"?"":M.I18N.l("email")+": "+a}}}),
spacerNachEmail:M.LabelView.design({value:" ",cssClass:"marginBottom12"}),positionAnsprechpartner:M.LabelView.design({cssClass:"positionName",computedValue:{valuePattern:"<%= positionAnsprechpartner %>",operation:function(a){return a===""||a===null||a==="undefined"||typeof a==="undefined"?"":M.I18N.l("ansprechpartner")+": "+a}}}),positionKundenname:M.LabelView.design({cssClass:"positionName",computedValue:{valuePattern:"<%= positionKundenname %>",operation:function(a){return a===""||a===null||a===
"undefined"||typeof a==="undefined"?"":M.I18N.l("kundenname")+": "+a}}}),positionLongitude:M.LabelView.design({cssClass:"positionName",computedValue:{valuePattern:"<%= positionLongitude %>",operation:function(a){return a==="0.0"||a===0||a===null||a==="undefined"||typeof a==="undefined"?"":M.I18N.l("longitude")+": "+a}}}),positionLatitude:M.LabelView.design({cssClass:"positionName",computedValue:{valuePattern:"<%= positionLatitude %>",operation:function(a){return a==="0.0"||a===0||a===null||a==="undefined"||
typeof a==="undefined"?"":M.I18N.l("latitude")+": "+a}}}),positionBeschreibung:M.LabelView.design({cssClass:"positionName",computedValue:{valuePattern:"<%= positionBeschreibung %>",operation:function(a){return a===""||a===null||a==="undefined"||typeof a==="undefined"?"":M.I18N.l("positionDescription")+":<br />"+a}}}),arbeitsbeginn:M.LabelView.design({cssClass:"positionName",computedValue:{valuePattern:"<%= arbeitsbeginn %>",operation:function(a){return a===""||a===null||a==="undefined"||typeof a===
"undefined"?"":M.I18N.l("arbeitsbeginn")+": "+a}}}),arbeitsende:M.LabelView.design({cssClass:"positionName",computedValue:{valuePattern:"<%= arbeitsende %>",operation:function(a){return a===""||a===null||a==="undefined"||typeof a==="undefined"?"":M.I18N.l("arbeitsende")+": "+a}}}),spacer1:M.LabelView.design({value:" ",cssClass:"marginBottom12"}),spacer2:M.LabelView.design({value:" ",cssClass:"marginBottom12"}),spacer3:M.LabelView.design({value:" ",cssClass:"marginBottom12"}),spacer4:M.LabelView.design({value:" ",
cssClass:"marginBottom12"}),spacer5:M.LabelView.design({value:" ",cssClass:"marginBottom12"}),spacer6:M.LabelView.design({value:" ",cssClass:"marginBottom12"}),saveAsContactButton:M.ButtonView.design({value:M.I18N.l("saveAsContact"),events:{tap:{target:DigiWebApp.OrderInfoController,action:function(){try{DigiWebApp.ApplicationController.vibrate()}catch(a){}this.saveAsContact()}}}}),showAddressInMapButton:M.ButtonView.design({value:M.I18N.l("showAddressInMap"),events:{tap:{action:function(a,b){try{DigiWebApp.ApplicationController.vibrate()}catch(c){}DigiWebApp.OrderInfoController.items.length===
0&&DigiWebApp.OrderInfoController.set("items",DigiWebApp.OrderDetailsController.positionForDetails);try{b.preventDefault()}catch(d){trackError(d)}var e=DigiWebApp.OrderInfoController.items[0].positionCountryCode,f=DigiWebApp.OrderInfoController.items[0].positionPLZ,g=DigiWebApp.OrderInfoController.items[0].positionOrt,i=DigiWebApp.OrderInfoController.items[0].positionStrasse,h=DigiWebApp.OrderInfoController.items[0].positionHausnummer,j="";switch(DigiWebApp.SettingsController.getSetting("mapType")){case "OSM":DigiWebApp.SettingsController.featureAvailable("419")?
alert(M.I18N.l("showInMapScholpp")):alert(M.I18N.l("showInMapOSMAlert"));j="http://nominatim.openstreetmap.org/search/"+e+"/"+g+"/"+i+"/"+h+"?format=html&polygon=1&addressdetails=0";break;case "Bing":DigiWebApp.SettingsController.featureAvailable("419")?alert(M.I18N.l("showInMapScholpp")):alert(M.I18N.l("showInMapBingAlert"));j="http://www.bing.com/maps/default.aspx?rtp=~adr."+i+" "+h+" "+f+" "+g+" "+e;break;case "Google":DigiWebApp.SettingsController.featureAvailable("419")?alert(M.I18N.l("showInMapScholpp")):
alert(M.I18N.l("showInMapGoogleAlert"));j="http://maps.google.com/maps?q="+i+" "+h+" "+f+" "+g+" "+e+"&hl=de";break;default:j="disabled"}if(j!=="disabled")if(typeof plugins!=="undefined")if(typeof plugins.childBrowser!=="undefined"){try{plugins.childBrowser.close()}catch(l){alert("Error: "+l.message)}try{plugins.childBrowser.showWebPage(encodeURI(j),{showNavigationBar:true})}catch(n){alert("Error: "+n.message)}}else DigiWebApp.ApplicationController.inAppBrowser_var=window.open(j,"childBrowser","width=800,height=600,menubar=no,status=no,location=yes,copyhistory=no,directories=no");
else DigiWebApp.ApplicationController.inAppBrowser_var=window.open(j,"childBrowser","width=800,height=600,menubar=no,status=no,location=yes,copyhistory=no,directories=no");return false}}}}),showCoordinatesInMapButton:M.ButtonView.design({value:M.I18N.l("showCoordinatesInMap"),events:{tap:{action:function(){try{DigiWebApp.ApplicationController.vibrate()}catch(a){}DigiWebApp.OrderInfoController.items.length===0&&DigiWebApp.OrderInfoController.set("items",DigiWebApp.OrderDetailsController.positionForDetails);
var b=DigiWebApp.OrderInfoController.items[0].positionLongitude,c=DigiWebApp.OrderInfoController.items[0].positionLatitude,d="";switch(DigiWebApp.SettingsController.getSetting("mapType")){case "OSM":DigiWebApp.SettingsController.featureAvailable("419")?alert(M.I18N.l("showInMapScholpp")):alert(M.I18N.l("showInMapOSMAlert"));d="http://www.openstreetmap.org/index.html?mlat="+c+"&mlon="+b+"&zoom=15&layers=M";break;case "Bing":DigiWebApp.SettingsController.featureAvailable("419")?alert(M.I18N.l("showInMapScholpp")):
alert(M.I18N.l("showInMapBingAlert"));d="http://www.bing.com/maps/default.aspx?rtp=adr.~pos."+c+"_"+b+"_&lvl=151";break;case "Google":DigiWebApp.SettingsController.featureAvailable("419")?alert(M.I18N.l("showInMapScholpp")):alert(M.I18N.l("showInMapGoogleAlert"));d="http://maps.google.com/maps?q="+c+"+"+b+"&hl=de";break;default:d="disabled"}if(d!=="disabled")if(typeof plugins!=="undefined")if(typeof plugins.childBrowser!=="undefined"){try{plugins.childBrowser.close()}catch(e){alert("Error: "+e.message)}try{plugins.childBrowser.showWebPage(encodeURI(d),
{showNavigationBar:true})}catch(f){alert("Error: "+f.message)}}else DigiWebApp.ApplicationController.inAppBrowser_var=window.open(d,"childBrowser","width=800,height=600,menubar=no,status=no,location=yes,copyhistory=no,directories=no");else DigiWebApp.ApplicationController.inAppBrowser_var=window.open(d,"childBrowser","width=800,height=600,menubar=no,status=no,location=yes,copyhistory=no,directories=no")}}}})});m_require("app/views/OrderInfoTemplateView");
DigiWebApp.OrderDetailsPage=M.PageView.design({events:{pageshow:{target:DigiWebApp.OrderDetailsController,action:"init"}},childViews:"header spacer list",cssClass:"orderInfoPage",header:M.ToolbarView.design({childViews:"backButton title",cssClass:"header",isFixed:YES,backButton:M.ButtonView.design({value:M.I18N.l("back"),icon:"arrow-l",anchorLocation:M.LEFT,events:{tap:{target:DigiWebApp.NavigationController,action:function(){try{DigiWebApp.ApplicationController.vibrate()}catch(a){}this.backToZeitbuchungDetailsPageTransition()}}}}),
title:M.LabelView.design({value:M.I18N.l("orderInfo"),anchorLocation:M.CENTER}),anchorLocation:M.TOP}),spacer:M.LabelView.design({value:" ",cssClass:"marginBottom12"}),list:M.ListView.design({contentBinding:{target:DigiWebApp.OrderDetailsController,property:"positionForDetails"},listItemTemplateView:DigiWebApp.OrderInfoTemplateView})});m_require("app/views/OrderInfoTemplateView");
DigiWebApp.OrderInfoPage=M.PageView.design({events:{pagebeforeshow:{target:DigiWebApp.OrderInfoController,action:"init"},pageshow:{action:function(){}}},childViews:"header selectionContent list",cssClass:"orderInfoPage",header:M.ToolbarView.design({childViews:"backButton title",cssClass:"header",isFixed:YES,backButton:M.ButtonView.design({value:M.I18N.l("back"),icon:"arrow-l",anchorLocation:M.LEFT,events:{tap:{target:DigiWebApp.NavigationController,action:function(){try{DigiWebApp.ApplicationController.vibrate()}catch(a){}history.back()}}}}),
title:M.LabelView.design({value:M.I18N.l("orderInfo"),anchorLocation:M.CENTER}),anchorLocation:M.TOP}),selectionContent:M.ScrollView.design({childViews:"order position",order:M.SelectionListView.design({selectionMode:M.SINGLE_SELECTION_DIALOG,initialText:M.I18N.l("noData"),label:M.I18N.l("order"),applyTheme:NO,contentBinding:{target:DigiWebApp.OrderInfoController,property:"orders"},events:{change:{target:DigiWebApp.OrderInfoController,action:function(){var a=M.ViewManager.getView("orderInfoPage",
"order").getSelection(YES).value;if(a){var b=DigiWebApp.HandOrder.findSorted().concat(DigiWebApp.Order.findSorted());_.each(b,function(c){if(c.get("id")==a){DigiWebApp.OrderInfoController.set("activeOrder",[c]);if(DigiWebApp.SettingsController.getSetting("auftragsDetailsKoppeln")){c=DigiWebApp.SelectionController.selections;c.order=M.ViewManager.getView("orderInfoPage","order").getSelection();DigiWebApp.SelectionController.set("selections",c);M.ViewManager.getView("bookingPage","order").setSelection(M.ViewManager.getView("orderInfoPage",
"order").getSelection());DigiWebApp.SelectionController.setPositions()}}});DigiWebApp.OrderInfoController.setPositions()}DigiWebApp.OrderInfoController.setItem()}}}}),position:M.SelectionListView.design({selectionMode:M.SINGLE_SELECTION_DIALOG,initialText:M.I18N.l("noData"),label:M.I18N.l("position"),applyTheme:NO,contentBinding:{target:DigiWebApp.OrderInfoController,property:"positions"},events:{change:{target:DigiWebApp.OrderInfoController,action:function(){var a=M.ViewManager.getView("orderInfoPage",
"position").getSelection(YES).value;if(a){var b=DigiWebApp.Position.findSorted();_.each(b,function(c){if(c.get("id")==a){DigiWebApp.OrderInfoController.set("activePosition",[c]);if(DigiWebApp.SettingsController.getSetting("auftragsDetailsKoppeln")){c=DigiWebApp.SelectionController.selections;c.position=M.ViewManager.getView("orderInfoPage","position").getSelection();DigiWebApp.SelectionController.set("selections",c);M.ViewManager.getView("bookingPage","position").setSelection(M.ViewManager.getView("orderInfoPage",
"position").getSelection());DigiWebApp.SelectionController.setActivities(YES)}}})}DigiWebApp.OrderInfoController.setItem()}}}})}),list:M.ListView.design({contentBinding:{target:DigiWebApp.OrderInfoController,property:"items"},listItemTemplateView:DigiWebApp.OrderInfoTemplateView})});
DigiWebApp.SettingsPasswordPage=M.PageView.design({events:{pagebeforeshow:{action:function(){$("#"+DigiWebApp.SettingsPasswordPage.content.passwordGrid.passwordInput.id).val("")}}},childViews:"header content",cssClass:"settingsPasswordPage",header:M.ToolbarView.design({childViews:"backButton title",cssClass:"header",isFixed:YES,backButton:M.ButtonView.design({value:M.I18N.l("back"),icon:"arrow-l",anchorLocation:M.LEFT,events:{tap:{action:function(){try{DigiWebApp.ApplicationController.vibrate()}catch(a){}DigiWebApp.SettingsController.featureAvailable("404")?
DigiWebApp.NavigationController.backToButtonDashboardPagePOP():DigiWebApp.NavigationController.backToDashboardPagePOP()}}}}),title:M.LabelView.design({value:M.I18N.l("password"),anchorLocation:M.CENTER}),anchorLocation:M.TOP}),content:M.ScrollView.design({childViews:"passwordGrid grid",passwordGrid:M.GridView.design({childViews:"passwordLabel passwordInput",layout:M.TWO_COLUMNS,passwordLabel:M.LabelView.design({value:M.I18N.l("password")}),passwordInput:M.TextFieldView.design({inputType:M.INPUT_PASSWORD})}),
grid:M.GridView.design({childViews:"button icon",layout:{cssClass:"digiButton",columns:{0:"button",1:"icon"}},button:M.ButtonView.design({value:M.I18N.l("assume"),cssClass:"digiButton",anchorLocation:M.RIGHT,events:{tap:{action:function(){try{DigiWebApp.ApplicationController.vibrate()}catch(a){}$("#"+DigiWebApp.SettingsPasswordPage.content.passwordGrid.passwordInput.id).val()===DigiWebApp.SettingsController.getSetting("settingsPassword")?DigiWebApp.NavigationController.toSettingsPage():DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("wrongPasswordTitle"),
message:M.I18N.l("wrongPasswordMsg")})}}}}),icon:M.ImageView.design({value:"theme/images/icon_bookTime.png"})})})});
DigiWebApp.SpesenPage=M.PageView.design({events:{pagebeforeshow:{action:function(){var a;if(DigiWebApp.SpesenAuswahlOption.find().length===0){a=1;DigiWebApp.SpesenAuswahlOption.createRecord({id:a,beschreibung:"keine Spesen"}).saveSorted();a+=1;DigiWebApp.SpesenAuswahlOption.createRecord({id:a,beschreibung:"Tagesspesen"}).saveSorted();a+=1;DigiWebApp.SpesenAuswahlOption.createRecord({id:a,beschreibung:"mehrt\u00e4gige Spesen"}).saveSorted();a+=1}if(DigiWebApp.UebernachtungAuswahlOption.find().length===
0){a=1;DigiWebApp.UebernachtungAuswahlOption.createRecord({id:a,beschreibung:"keine \u00dcbernachtung"}).saveSorted();a+=1;DigiWebApp.UebernachtungAuswahlOption.createRecord({id:a,beschreibung:"\u00dcbernachtung mit Pauschale"}).saveSorted();a+=1;DigiWebApp.UebernachtungAuswahlOption.createRecord({id:a,beschreibung:"\u00dcbernachtung mit Beleg"}).saveSorted();a+=1}a=DigiWebApp.SpesenAuswahlOption.findSorted();a=_.map(a,function(b){if(b){var c={label:b.get("beschreibung"),value:b.get("id")};if(b.get("id")==
1)c.isSelected=YES;return c}});a=_.compact(a);DigiWebApp.BookingController.set("spesenOptionen",a);a=DigiWebApp.UebernachtungAuswahlOption.findSorted();a=_.map(a,function(b){if(b){var c={label:b.get("beschreibung"),value:b.get("id")};if(b.get("id")==1)c.isSelected=YES;return c}});a=_.compact(a);DigiWebApp.BookingController.set("uebernachtungOptionen",a)}}},myCallback:function(){},tab_action_timeoutvar:null,tab_action:function(){clearTimeout(DigiWebApp.SpesenPage.tab_action_timeoutvar);DigiWebApp.BookingController.currentBooking.set("spesenAuswahl",
M.ViewManager.getView("spesenPage","spesenAuswahl").getSelection(YES).value);DigiWebApp.BookingController.currentBooking.set("uebernachtungAuswahl",M.ViewManager.getView("spesenPage","uebernachtungAuswahl").getSelection(YES).value);DigiWebApp.BookingController.currentBooking.save();DigiWebApp.SpesenPage.myCallback()},childViews:"header content",cssClass:"remarkPage",header:M.ToolbarView.design({childViews:"backButton title",cssClass:"header",isFixed:YES,backButton:M.ButtonView.design({value:M.I18N.l("back"),
icon:"arrow-l",anchorLocation:M.LEFT,events:{tap:{target:DigiWebApp.NavigationController,action:function(){try{DigiWebApp.ApplicationController.vibrate()}catch(a){}this.backToBookTimePagePOP()}}}}),title:M.LabelView.design({value:M.I18N.l("Spesen_Ausloese"),anchorLocation:M.CENTER}),anchorLocation:M.TOP}),content:M.ScrollView.design({childViews:"spesenAuswahl uebernachtungAuswahl spacer grid",spacer:M.LabelView.design({value:"&nbsp;<br />"}),spesenAuswahl:M.SelectionListView.design({selectionMode:M.SINGLE_SELECTION_DIALOG,
initialText:M.I18N.l("noData"),label:M.I18N.l("Spesen"),applyTheme:NO,contentBinding:{target:DigiWebApp.BookingController,property:"spesenOptionen"},events:{change:{target:DigiWebApp.BookingController,action:function(){}}}}),uebernachtungAuswahl:M.SelectionListView.design({selectionMode:M.SINGLE_SELECTION_DIALOG,label:M.I18N.l("Uebernachtung"),initialText:M.I18N.l("noData"),applyTheme:NO,contentBinding:{target:DigiWebApp.BookingController,property:"uebernachtungOptionen"},events:{change:{target:DigiWebApp.BookingController,
action:function(){}}}}),grid:M.GridView.design({childViews:"button icon",layout:{cssClass:"digiButton",columns:{0:"button",1:"icon"}},button:M.ButtonView.design({value:M.I18N.l("SpeichernUndBuchen"),cssClass:"digiButton",anchorLocation:M.RIGHT,events:{tap:{action:function(){DigiWebApp.ApplicationController.DigiLoaderView.show(M.I18N.l("Save"));DigiWebApp.SpesenPage.tab_action_timeoutvar=setTimeout("DigiWebApp.SpesenPage.tab_action();",50)}}}}),icon:M.ImageView.design({value:"theme/images/icon_bookTime.png"})})})});
DigiWebApp.SplashViewPage=M.PageView.design({events:{pagebeforeshow:{action:function(){if(!(window.newAppVersionAvailable||DigiWebApp.ApplicationController.useSplashJustForFade))if(navigator.platform==="BlackBerry"&&restartOnBlackBerry)DigiWebApp.ApplicationController.blackBerryRestart_var=setTimeout("DigiWebApp.ApplicationController.blackBerryRestart()",3E3);else DigiWebApp.ApplicationController.regSecEv(YES)}},pageshow:{action:function(){window.newAppVersionAvailable||DigiWebApp.ApplicationController.useSplashJustForFade||
DigiWebApp.ApplicationController.DigiLoaderView.show(M.I18N.l("waitingForDevice"))}}},childViews:"content",cssClass:"splashViewPage",logo:M.ImageView.design({value:"theme/images/logo.png",cssClass:"logoSplashPage"}),content:M.ScrollView.design({cssClass:"infoBox",childViews:"title info",title:M.LabelView.design({value:"",cssClass:"appTitle"}),info:M.LabelView.design({value:"",cssClass:"infoMsg",contentBinding:{target:DigiWebApp.ApplicationController,property:"infoMsg"}})})});
DigiWebApp.StudieChecklisteTemplateView=M.DigiListItemView.design({isSelectable:NO,childViews:"comboBoxView",events:{tap:{action:function(){}}},label:M.LabelView.design({cssClass:"unselectable",computedValue:{valuePattern:"<%= label %>",operation:function(a){return a}}}),comboBox:M.LabelView.design({cssClass:"unselectable",computedValue:{valuePattern:"<%= comboBox %>",operation:function(a){if(a&&typeof a==="object"&&a.length>0){DigiWebApp.StudieChecklisteController.set("t1",$(this));DigiWebApp.StudieChecklisteController.set("t2",
this)}else console.log(this);return""}}}),comboBoxView:M.DigiSelectionListView.design({selectionMode:M.SINGLE_SELECTION_DIALOG,initialText:M.I18N.l("noData"),applyTheme:NO,computedValue:{valuePattern:"<%= comboBox %>",operation:function(a){console.log(a);return a}}})});m_require("app/views/StudieChecklisteTemplateView");
DigiWebApp.StudieChecklistePage=M.PageView.design({events:{pagebeforeshow:{target:DigiWebApp.StudieChecklisteController,action:"init"}},childViews:"header content",cssClass:"studieChecklistePage",header:M.ToolbarView.design({childViews:"backButton title",cssClass:"header",isFixed:YES,backButton:M.ButtonView.design({value:M.I18N.l("back"),icon:"arrow-l",anchorLocation:M.LEFT,events:{tap:{target:DigiWebApp.NavigationController,action:function(){try{DigiWebApp.ApplicationController.vibrate()}catch(a){}this.backToDashboardPage()}}}}),
title:M.LabelView.design({value:M.I18N.l("settings"),anchorLocation:M.CENTER}),anchorLocation:M.TOP}),content:M.ScrollView.design({childViews:"list",list:M.DigiListView.design({contentBinding:{target:DigiWebApp.StudieChecklisteController,property:"listData"},listItemTemplateView:DigiWebApp.StudieChecklisteTemplateView})})});
DigiWebApp.TabBar=M.TabBarView.design({childViews:"tabItem1 tabItem2",anchorLocation:M.BOTTOM,isFixed:YES,transition:M.TRANSITION.FADE,name:"tabbar1",tabItem1:M.TabBarItemView.design({value:M.I18N.l("book"),page:"bookingPage",icon:"book"}),tabItem2:M.TabBarItemView.design({value:M.I18N.l("menu"),page:"dashboard",icon:"menu"})});m_require("app/views/TabBar.js");
DigiWebApp.BookingPage=M.PageView.design({childViews:"header content tabBar",events:{pagebeforeshow:{action:function(){if(DigiWebApp.SettingsController.featureAvailable("416"))DigiWebApp.NavigationController.toBookTimePage();else{DigiWebApp.BookingController.init();if(DigiWebApp.SettingsController.getSetting("DTC6aktiv")){DigiWebApp.ApplicationController.dtc6AktivRenameHelper(DigiWebApp.BookingPage.content.order.id,M.I18N.l("dtc6Ordner"));DigiWebApp.ApplicationController.dtc6AktivRenameHelper(DigiWebApp.BookingPage.content.position.id,
M.I18N.l("dtc6Auftrag"));DigiWebApp.ApplicationController.dtc6AktivRenameHelper(DigiWebApp.BookingPage.content.activity.id,M.I18N.l("dtc6Leistung"))}}}},pageshow:{action:function(){DigiWebApp.TabBar.setActiveTab(DigiWebApp.TabBar.tabItem1);DigiWebApp.SettingsController.featureAvailable("415")?$("#"+DigiWebApp.BookingPage.header.feierabendButton.id).show():$("#"+DigiWebApp.BookingPage.header.feierabendButton.id).hide();DigiWebApp.SettingsController.featureAvailable("402")?$("#"+DigiWebApp.BookingPage.header.materialButton.id).show():
$("#"+DigiWebApp.BookingPage.header.materialButton.id).hide()}}},cssClass:"bookTimePage",header:M.ToolbarView.design({childViews:"materialButton title feierabendButton",cssClass:"header unselectable",isFixed:YES,materialButton:M.ButtonView.design({value:M.I18N.l("BautagebuchMaterial"),anchorLocation:M.LEFT,events:{tap:{action:function(){try{DigiWebApp.ApplicationController.vibrate()}catch(a){}DigiWebApp.DashboardController.materialerfassung()}}}}),pauseButton:M.ButtonView.design({value:M.I18N.l("back"),
icon:"arrow-l",anchorLocation:M.LEFT,events:{tap:{action:function(){}}}}),title:M.LabelView.design({value:M.I18N.l("timeRegistration"),anchorLocation:M.CENTER}),feierabendButton:M.ButtonView.design({value:"&nbsp;&nbsp;&nbsp;",icon:"home",anchorLocation:M.RIGHT,events:{tap:{action:function(){try{DigiWebApp.ApplicationController.vibrate()}catch(a){}DigiWebApp.BookingController.closeDay()}}}}),anchorLocation:M.TOP}),content:M.ScrollView.design({childViews:"order position activity grid currentBookingLabel",
cssClass:"unselectable",order:M.SelectionListView.design({selectionMode:M.SINGLE_SELECTION_DIALOG,initialText:M.I18N.l("noData"),label:M.I18N.l("order"),applyTheme:NO,contentBinding:{target:DigiWebApp.SelectionController,property:"orders"},events:{change:{target:DigiWebApp.SelectionController,action:function(){var a=M.ViewManager.getView("bookingPage","order").getSelection(YES);if(a.label==a.value||isGUID(a.value))try{$("#"+DigiWebApp.BookingPage.content.position.id+"_container").hide()}catch(b){trackError(b)}else try{$("#"+
DigiWebApp.BookingPage.content.position.id+"_container").show()}catch(c){trackError(c)}this.setPositions()}}}}),position:M.SelectionListView.design({selectionMode:M.SINGLE_SELECTION_DIALOG,label:M.I18N.l("position"),initialText:M.I18N.l("noData"),applyTheme:NO,contentBinding:{target:DigiWebApp.SelectionController,property:"positions"},events:{change:{target:DigiWebApp.SelectionController,action:function(){this.setActivities(YES)}}}}),activity:M.SelectionListView.design({selectionMode:M.SINGLE_SELECTION_DIALOG,
label:M.I18N.l("activity"),initialText:M.I18N.l("noData"),applyTheme:NO,contentBinding:{target:DigiWebApp.SelectionController,property:"activities"},events:{change:{target:DigiWebApp.SelectionController,action:function(){this.saveSelection()}}}}),grid:M.GridView.design({childViews:"button icon",layout:{cssClass:"marginTop40 digiButton",columns:{0:"button",1:"icon"}},button:M.ButtonView.design({value:M.I18N.l("book2"),cssClass:"digiButton",anchorLocation:M.RIGHT,events:{tap:{target:DigiWebApp.BookingController,
action:"book"}}}),icon:M.ImageView.design({value:"theme/images/icon_bookTime.png"})}),currentBookingLabel:M.LabelView.design({cssClass:"marginTop25 whiteLabel unselectable",computedValue:{contentBinding:{target:DigiWebApp.BookingController,property:"currentBookingStr"},value:"",operation:function(a){return a!==""?M.I18N.l("bookingRunningSince")+" &nbsp;"+a:""}}})}),tabBar:DigiWebApp.TabBar});m_require("app/views/TabBar.js");
DigiWebApp.BookingPageWithIconsScholpp=M.PageView.design({childViews:"header content tabBar",events:{pagebeforeshow:{target:DigiWebApp.BookingController,action:"init"},pageshow:{action:function(){DigiWebApp.TabBar.setActiveTab(DigiWebApp.TabBar.tabItem1);$("#"+DigiWebApp.BookingPageWithIconsScholpp.content.activity.id+"_container").hide();$("#"+DigiWebApp.BookingPageWithIconsScholpp.content.spesenkennzeichen.id).attr("disabled","disabled");if(DigiWebApp.SettingsController.featureAvailable("424")){$("#"+
DigiWebApp.BookingPageWithIconsScholpp.header.feierabendButton.id).show();$("#"+DigiWebApp.BookingPageWithIconsScholpp.content.spesenkennzeichen.id+"_container").hide();$("#"+DigiWebApp.BookingPageWithIconsScholpp.content.uebernachtungskennzeichen.id+"_container").hide()}else{$("#"+DigiWebApp.BookingPageWithIconsScholpp.header.feierabendButton.id).hide();$("#"+DigiWebApp.BookingPageWithIconsScholpp.content.spesenkennzeichen.id+"_container").show();$("#"+DigiWebApp.BookingPageWithIconsScholpp.content.uebernachtungskennzeichen.id+
"_container").show()}}}},cssClass:"bookTimePageWithIcons",header:M.ToolbarView.design({childViews:"title feierabendButton",cssClass:"header unselectable",isFixed:YES,pauseButton:M.ButtonView.design({value:M.I18N.l("back"),icon:"arrow-l",anchorLocation:M.LEFT,events:{tap:{action:function(){}}}}),title:M.LabelView.design({value:M.I18N.l("timeRegistration"),anchorLocation:M.CENTER}),feierabendButton:M.ButtonView.design({value:"&nbsp;&nbsp;&nbsp;",icon:"home",anchorLocation:M.RIGHT,events:{tap:{action:function(){DigiWebApp.BookingController.closeDay()}}}}),
anchorLocation:M.TOP}),content:M.ScrollView.design({childViews:"order position activity uebernachtungskennzeichen spesenkennzeichen fahrzeit_arbeitszeit_spezial_ButtonGrid unterbrechung_pause_arbeitsende_ButtonGrid currentBookingLabel",cssClass:"unselectable",activityLabel:M.LabelView.design({value:M.I18N.l("activity"),cssClass:"whiteLabel16px"}),unterbrechung_pause_arbeitsende_ButtonGrid:M.GridView.design({childViews:"unterbrechungButtonGrid pauseButtonGrid arbeitsendeButtonGrid",layout:M.THREE_COLUMNS,
arbeitsendeButtonGrid:M.GridView.design({childViews:"button icon",layout:{cssClass:"scholppButton",columns:{0:"button",1:"icon"}},button:M.ButtonView.design({value:"Ende",cssClass:"scholppButton",anchorLocation:M.RIGHT,events:{tap:{action:function(){try{DigiWebApp.ApplicationController.vibrate()}catch(a){}M.ViewManager.getView("bookingPageWithIconsScholpp","uebernachtungskennzeichen").setSelection("6");DigiWebApp.ScholppBookingController.bucheArbeitsende()}}}}),icon:M.ImageView.design({value:"theme/images/48x48_plain_home.png",
events:{tap:{action:function(){try{DigiWebApp.ApplicationController.vibrate()}catch(a){}M.ViewManager.getView("bookingPageWithIconsScholpp","uebernachtungskennzeichen").setSelection("6");DigiWebApp.ScholppBookingController.bucheArbeitsende()}}}})}),unterbrechungButtonGrid:M.GridView.design({childViews:"button icon",layout:{cssClass:"scholppButton",columns:{0:"button",1:"icon"}},button:M.ButtonView.design({value:"Unterbrechung",cssClass:"scholppButton",anchorLocation:M.RIGHT,events:{tap:{action:function(){try{DigiWebApp.ApplicationController.vibrate()}catch(a){}M.ViewManager.getView("bookingPageWithIconsScholpp",
"uebernachtungskennzeichen").setSelection("6");DigiWebApp.ScholppBookingController.bucheUnterbrechung()}}}}),icon:M.ImageView.design({value:"theme/images/48x48_plain_clock_pause.png",events:{tap:{action:function(){try{DigiWebApp.ApplicationController.vibrate()}catch(a){}M.ViewManager.getView("bookingPageWithIconsScholpp","uebernachtungskennzeichen").setSelection("6");DigiWebApp.ScholppBookingController.bucheUnterbrechung()}}}})}),pauseButtonGrid:M.GridView.design({childViews:"button icon",layout:{cssClass:"scholppButton",
columns:{0:"button",1:"icon"}},button:M.ButtonView.design({value:" ",cssClass:"scholppButton",anchorLocation:M.RIGHT,events:{tap:{action:function(){try{DigiWebApp.ApplicationController.vibrate()}catch(a){}}}}}),icon:M.ImageView.design({value:"",events:{tap:{action:function(){try{DigiWebApp.ApplicationController.vibrate()}catch(a){}}}}})})}),fahrzeit_arbeitszeit_spezial_ButtonGrid:M.GridView.design({childViews:"fahrzeitButtonGrid arbeitszeitButtonGrid spezialButtonGrid",layout:M.THREE_COLUMNS,fahrzeitButtonGrid:M.GridView.design({childViews:"button icon",
layout:{cssClass:"scholppButton",columns:{0:"button",1:"icon"}},button:M.ButtonView.design({value:"Reisezeit",cssClass:"scholppButton",anchorLocation:M.RIGHT,events:{tap:{action:function(){try{DigiWebApp.ApplicationController.vibrate()}catch(a){}DigiWebApp.ScholppBookingController.bucheFahrzeit()}}}}),icon:M.ImageView.design({value:"theme/images/48x48_plain_car_compact_grey.png",events:{tap:{action:function(){try{DigiWebApp.ApplicationController.vibrate()}catch(a){}DigiWebApp.ScholppBookingController.bucheFahrzeit()}}}})}),
arbeitszeitButtonGrid:M.GridView.design({childViews:"button icon",layout:{cssClass:"scholppButton",columns:{0:"button",1:"icon"}},button:M.ButtonView.design({value:"Arbeitszeit",cssClass:"scholppButton",anchorLocation:M.RIGHT,events:{tap:{action:function(){try{DigiWebApp.ApplicationController.vibrate()}catch(a){}M.ViewManager.getView("bookingPageWithIconsScholpp","uebernachtungskennzeichen").setSelection("6");DigiWebApp.ScholppBookingController.bucheArbeitszeit()}}}}),icon:M.ImageView.design({value:"theme/images/48x48_plain_wrench.png",
events:{tap:{action:function(){try{DigiWebApp.ApplicationController.vibrate()}catch(a){}M.ViewManager.getView("bookingPageWithIconsScholpp","uebernachtungskennzeichen").setSelection("6");DigiWebApp.ScholppBookingController.bucheArbeitszeit()}}}})}),spezialButtonGrid:M.GridView.design({childViews:"button icon",layout:{cssClass:"scholppButton",columns:{0:"button",1:"icon"}},button:M.ButtonView.design({value:"&nbsp;",cssClass:"scholppButton",anchorLocation:M.RIGHT,events:{tap:{action:function(){try{DigiWebApp.ApplicationController.vibrate()}catch(a){}}}}}),
icon:M.ImageView.design({value:"",events:{tap:{action:function(){try{DigiWebApp.ApplicationController.vibrate()}catch(a){}}}}})})}),order:M.SelectionListView.design({selectionMode:M.SINGLE_SELECTION_DIALOG,initialText:M.I18N.l("order"),label:"",applyTheme:NO,contentBinding:{target:DigiWebApp.SelectionController,property:"orders"},events:{change:{target:DigiWebApp.SelectionController,action:function(){this.setPositions()}}}}),position:M.SelectionListView.design({selectionMode:M.SINGLE_SELECTION_DIALOG,
label:"",initialText:M.I18N.l("position"),applyTheme:NO,contentBinding:{target:DigiWebApp.SelectionController,property:"positions"},events:{change:{target:DigiWebApp.SelectionController,action:function(){this.setActivities(YES)}}}}),activity:M.SelectionListView.design({selectionMode:M.SINGLE_SELECTION_DIALOG,label:"",initialText:M.I18N.l("activity"),applyTheme:NO,contentBinding:{target:DigiWebApp.SelectionController,property:"activities"},events:{change:{target:DigiWebApp.SelectionController,action:function(){this.saveSelection()}}}}),
uebernachtungskennzeichen:M.SelectionListView.design({selectionMode:M.SINGLE_SELECTION_DIALOG,applyTheme:NO,contentBinding:{target:DigiWebApp.SelectionController,property:"uebernachtungskennzeichenScholpp"},events:{change:{target:DigiWebApp.SelectionController,action:function(){this.saveSelection()}}}}),spesenkennzeichen:M.SelectionListView.design({selectionMode:M.SINGLE_SELECTION_DIALOG,applyTheme:NO,contentBinding:{target:DigiWebApp.SelectionController,property:"spesenkennzeichenScholpp"},events:{change:{target:DigiWebApp.SelectionController,
action:function(){}}}}),grid:M.GridView.design({childViews:"button icon",layout:{cssClass:"marginTop40 digiButton",columns:{0:"button",1:"icon"}},button:M.ButtonView.design({value:M.I18N.l("book2"),cssClass:"digiButton",anchorLocation:M.RIGHT,events:{tap:{target:DigiWebApp.BookingController,action:"book"}}}),icon:M.ImageView.design({value:"theme/images/icon_bookTime.png"})}),currentBookingLabel:M.LabelView.design({cssClass:"marginTop15 whiteLabel unselectable",computedValue:{contentBinding:{target:DigiWebApp.BookingController,
property:"currentBookingStr"},value:"",operation:function(a){return a!==""?M.I18N.l("bookingRunningSince")+" &nbsp;"+a:""}}})}),tabBar:DigiWebApp.TabBar});m_require("app/views/TabBar.js");m_require("app/views/ButtonDashboardTemplateView.js");
DigiWebApp.ButtonDashboardPage=M.PageView.design({childViews:"header content tabBar",cssClass:"buttonDashboardPage unselectable",events:{pagebeforeshow:{target:DigiWebApp.DashboardController,action:"initButtons"},pageshow:{action:function(){DigiWebApp.TabBar.setActiveTab(DigiWebApp.TabBar.tabItem2)}}},needsUpdate:true,header:M.ToolbarView.design({value:M.I18N.l("menu"),cssClass:"header unselectable",isFixed:YES,anchorLocation:M.TOP}),content:M.ScrollView.design({childViews:"list",list:M.ListView.design({contentBinding:{target:DigiWebApp.DashboardController,
property:"itemsButtons"},listItemTemplateView:DigiWebApp.ButtonDashboardTemplateView})}),tabBar:DigiWebApp.TabBar});m_require("app/views/TabBar.js");m_require("app/views/DashboardTemplateView.js");
DigiWebApp.DashboardPage=M.PageView.design({childViews:"header content tabBar",cssClass:"dashboardPage unselectable",events:{pagebeforeshow:{action:function(){DigiWebApp.SettingsController.featureAvailable("404")?DigiWebApp.NavigationController.toButtonDashboardPage():DigiWebApp.DashboardController.init()}},pageshow:{action:function(){DigiWebApp.TabBar.setActiveTab(DigiWebApp.TabBar.tabItem2)}}},needsUpdate:true,header:M.ToolbarView.design({value:M.I18N.l("menu"),cssClass:"header unselectable",isFixed:YES,
anchorLocation:M.TOP}),content:M.ScrollView.design({childViews:"list",list:M.ListView.design({contentBinding:{target:DigiWebApp.DashboardController,property:"items"},listItemTemplateView:DigiWebApp.DashboardTemplateView})}),tabBar:DigiWebApp.TabBar});m_require("app/views/TabBar.js");
DigiWebApp.HandOrderPage=M.PageView.design({childViews:"header content",cssClass:"handApplicationPage",events:{pageshow:{action:function(){$("#"+DigiWebApp.HandOrderPage.content.orderName.id)[0].focus()}}},header:M.ToolbarView.design({childViews:"backButton title",cssClass:"header",isFixed:YES,backButton:M.ButtonView.design({value:M.I18N.l("back"),icon:"arrow-l",anchorLocation:M.LEFT,events:{tap:{target:DigiWebApp.NavigationController,action:function(){try{DigiWebApp.ApplicationController.vibrate()}catch(a){}this.backToDashboardPage()}}}}),
title:M.LabelView.design({value:M.I18N.l("handApplications"),anchorLocation:M.CENTER}),anchorLocation:M.TOP}),content:M.ScrollView.design({childViews:"orderName grid",orderName:M.TextFieldView.design({label:M.I18N.l("orderName"),numberOfChars:50,events:{keyup:{action:function(){var a=M.ViewManager.getView("handOrderPage","orderName").getValue();if(a.length<=16)DigiWebApp.HandOrderController.set("orderNameToSave",M.ViewManager.getView("handOrderPage","orderName").getValue());else if(DigiWebApp.SettingsController.getSetting("DTC6aktiv"))if(a.length<=
50)DigiWebApp.HandOrderController.set("orderNameToSave",M.ViewManager.getView("handOrderPage","orderName").getValue());else{M.ViewManager.getView("handOrderPage","orderName").setValue(DigiWebApp.HandOrderController.orderNameToSave);DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("handOrderTooLong"),message:M.I18N.l("handOrderTooLongDTC6Msg")})}else{M.ViewManager.getView("handOrderPage","orderName").setValue(DigiWebApp.HandOrderController.orderNameToSave);DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("handOrderTooLong"),
message:M.I18N.l("handOrderTooLongMsg")})}}}}}),grid:M.GridView.design({childViews:"button icon",layout:{cssClass:"digiButton hack",columns:{0:"button",1:"icon"}},button:M.ButtonView.design({value:M.I18N.l("assume"),cssClass:"digiButton",anchorLocation:M.RIGHT,events:{tap:{target:DigiWebApp.HandOrderController,action:function(){try{DigiWebApp.ApplicationController.vibrate()}catch(a){}this.save()}}}}),icon:M.ImageView.design({value:"theme/images/icon_bookTime.png"})})}),tabBar:DigiWebApp.TabBar});
m_require("app/views/TabBar.js");
DigiWebApp.InfoPage=M.PageView.design({lastTimePageWasLoaded:null,events:{pagebeforeshow:{action:function(){DigiWebApp.InfoPage.pagebeforeshowFunction()}},pagehide:{action:function(){DigiWebApp.ApplicationController.clickCounter=0}}},pagebeforeshowFunction:function(){DigiWebApp.ApplicationController.clickCounter=0;M.ViewManager.getView("infoPage","languageSelection").setSelection(M.I18N.getLanguage());DigiWebApp.InfoPage.lastTimePageWasLoaded=+new Date;DigiWebApp.InfoPage.content.cordovaVersionLabel.renderUpdate();DigiWebApp.InfoPage.content.deviceinfo.renderUpdate();
DigiWebApp.InfoPage.content.connectioninfo.renderUpdate();DigiWebApp.InfoPage.content.localStorageUsage.renderUpdate();DigiWebApp.InfoPage.content.mitarbeiterNameVornameLabel.renderUpdate()},cssClass:"infoPage",childViews:"header content",header:M.ToolbarView.design({childViews:"backButton title refreshButton",cssClass:"header unselectable",isFixed:YES,backButton:M.ButtonView.design({value:M.I18N.l("back"),icon:"arrow-l",anchorLocation:M.LEFT,events:{tap:{target:DigiWebApp.NavigationController,action:function(){try{DigiWebApp.ApplicationController.vibrate()}catch(a){}try{event.stopImmediatePropagation()}catch(b){try{event.stopPropagation()}catch(c){}}this.backToDashboardPage();
return false}}}}),title:M.LabelView.design({value:M.I18N.l("info"),anchorLocation:M.CENTER}),refreshButton:M.ButtonView.design({value:M.I18N.l("refresh"),icon:"refresh",anchorLocation:M.RIGHT,events:{tap:{action:function(){try{DigiWebApp.ApplicationController.vibrate()}catch(a){}DigiWebApp.SettingsController.mitarbeiterNameVorname="";var b=DigiWebApp.Settings.find(),c="0";try{c=b[0].get("workerId")}catch(d){trackError(d)}DigiWebApp.SettingsController.refreshMitarbeiterNameVorname(c,DigiWebApp.InfoPage.pagebeforeshowFunction)}}}}),
anchorLocation:M.TOP}),content:M.ScrollView.design({childViews:"logo languageSelection spacer8 companyIdLabel mitarbeiterNameVornameLabel spacer9 versionLabel cordovaVersionLabel companyLabel streetLabel cityLabel phoneLabel emailLabel1 spacer1 emailLabel2 spacer2 spacer3 TMPVersionLabel spacer4 deviceinfo spacer5 connectioninfo spacer6 environmentinfo spacer7 localStorageUsage spacer10 toggleWeinreButton",logo:M.ImageView.design({value:"theme/images/NeuesLogo2013.png",cssClass:"logoInfoPage marginBottom25 unselectable"}),
languageSelection:M.SelectionListView.design({selectionMode:M.SINGLE_SELECTION_DIALOG,label:M.I18N.l("applicationLanguage"),applyTheme:NO,childViews:"languageDeDe languageEnUs",languageDeDe:M.SelectionListItemView.design({value:"de_de",label:M.I18N.l("language_de_de")}),languageEnUs:M.SelectionListItemView.design({value:"en_us",label:M.I18N.l("language_en_us")}),languageFrFr:M.SelectionListItemView.design({value:"fr_fr",label:M.I18N.l("language_fr_fr")}),languageEsEs:M.SelectionListItemView.design({value:"es_es",
label:M.I18N.l("language_es_es")}),languageNlNl:M.SelectionListItemView.design({value:"nl_nl",label:M.I18N.l("language_nl_nl")}),events:{change:{action:function(){var a=M.ViewManager.getView("infoPage","languageSelection").getSelection(YES).value;M.I18N.setLanguage(a)}}}}),companyIdLabel:M.LabelView.design({computedValue:{value:"",operation:function(){var a="";try{a=DigiWebApp.Settings.find()[0].get("company")}catch(b){}return M.I18N.l("company")+": "+a}},cssClass:"infoLabel unselectable"}),mitarbeiterNameVornameLabel:M.LabelView.design({computedValue:{value:"",
operation:function(){var a="";try{a=DigiWebApp.Settings.find()[0].get("workerId")}catch(b){}a=M.I18N.l("configuredUser")+": "+a;if(DigiWebApp.SettingsController.getSetting("mitarbeiterVorname")!==""||DigiWebApp.SettingsController.getSetting("mitarbeiterNachname")!=="")a=a+" ("+DigiWebApp.SettingsController.getSetting("mitarbeiterVorname")+" "+DigiWebApp.SettingsController.getSetting("mitarbeiterNachname")+")";return a}},cssClass:"infoLabel unselectable"}),versionLabel:M.LabelView.design({computedValue:{value:"",
operation:function(){return"Version: "+M.Application.getConfig("version")}},cssClass:"infoLabel unselectable"}),cordovaVersionLabel:M.LabelView.design({computedValue:{value:"",operation:function(){var a="";if(typeof device!=="undefined"){if(typeof device.cordova!=="undefined")a=a+"Cordova: "+device.cordova;if(typeof device.phonegap!=="undefined"){if(a!=="")a+="<br/>";a=a+"PhoneGap: "+device.phonegap}}return a}},cssClass:"infoLabel marginBottom25 unselectable"}),TMPVersionLabel:M.LabelView.design({computedValue:{value:"",
operation:function(){return"The-M-Project: "+M.Version}},cssClass:"infoLabel marginBottom25 unselectable"}),buildLabel:M.LabelView.design({value:"Build: 6360",cssClass:"infoLabel marginBottom25 unselectable"}),companyLabel:M.LabelView.design({value:"DIGI-Zeiterfassung GmbH",cssClass:"infoLabel unselectable"}),streetLabel:M.LabelView.design({value:"Raiffeisenstr. 30",cssClass:"infoLabel unselectable"}),cityLabel:M.LabelView.design({value:"D-70794 Filderstadt",cssClass:"infoLabel unselectable"}),phoneLabel:M.LabelView.design({value:'<a href="tel:+49711709600">+49-711-70960-0</a>',
cssClass:"infoLabel marginBottom25 unselectable"}),emailLabel1:M.LabelView.design({value:"eMail: ",cssClass:"infoLabel unselectable",isInline:YES}),emailLabel2:M.LabelView.design({value:"support@digi-zeiterfassung.de",hyperlinkTarget:'support@digi-zeiterfassung.de" onclick="return DigiWebApp.InfoPage.lastTimePageWasLoaded < (+new Date() - 1000);"',hyperlinkType:M.HYPERLINK_EMAIL,cssClass:"infoLabel unselectable",isInline:YES}),spacer1:M.LabelView.design({value:" "}),spacer2:M.LabelView.design({value:" "}),
spacer3:M.LabelView.design({value:"&nbsp;"}),spacer4:M.LabelView.design({value:" "}),spacer5:M.LabelView.design({value:" "}),spacer6:M.LabelView.design({value:" "}),spacer7:M.LabelView.design({value:" "}),spacer8:M.LabelView.design({value:"<br /><br />",cssClass:"infoLabel unselectable"}),spacer9:M.LabelView.design({value:"<br />",cssClass:"infoLabel unselectable"}),spacer10:M.LabelView.design({value:"<br />",cssClass:"infoLabel unselectable"}),webLabel1:M.LabelView.design({value:"Web: ",cssClass:"infoLabel unselectable",
isInline:YES}),webLabel2:M.LabelView.design({value:"www.digi-zeiterfassung.de",hyperlinkTarget:'http://www.digi-zeiterfassung.de" onclick="return DigiWebApp.InfoPage.lastTimePageWasLoaded < (+new Date() - 1000);"',hyperlinkType:M.HYPERLINK_WEBSITE,cssClass:"infoLabel unselectable",isInline:YES}),localStorageUsage:M.LabelView.design({computedValue:{value:"",operation:function(){var a="",b=(new Number(JSON.stringify(localStorage).length/1048576)).toFixed(2);if(typeof localStorage!=="undefined")a="LocalStorage-Usage: "+
b+" MB<br />";return a}},cssClass:"infoLabel marginTop25 unselectable"}),environmentinfo:M.LabelView.design({computedValue:{value:"",operation:function(){var a="";if(typeof M.Environment!=="undefined")a="Environment Platform: "+M.Environment.getPlatform()+"<br />";return a}},cssClass:"infoLabel marginTop25 unselectable"}),deviceinfo:M.LabelView.design({computedValue:{value:"",operation:function(){var a="";if(typeof device!=="undefined")a="Device Name: "+device.name+"<br />Device Model: "+device.model+
"<br />Device Platform: "+device.platform+"<br />Device UUID: "+device.uuid+"<br />Device Version: "+device.version+"<br />";return a}},cssClass:"infoLabel marginTop25 unselectable"}),connectioninfo:M.LabelView.design({computedValue:{value:"",operation:function(){if(typeof navigator.connection!=="undefined"&&typeof Connection!=="undefined"){var a=navigator.connection.type,b={};b[Connection.UNKNOWN]="Unknown connection";b[Connection.ETHERNET]="Ethernet connection";b[Connection.WIFI]="WiFi connection";
b[Connection.CELL_2G]="Cell 2G connection";b[Connection.CELL_3G]="Cell 3G connection";b[Connection.CELL_4G]="Cell 4G connection";b[Connection.CELL]="Cellular connection";b[Connection.NONE]="No network connection";return"Connection type: "+b[a]}else return""}},cssClass:"infoLabel marginBottom25 unselectable"}),toggleWeinreButton:M.ButtonView.design({value:M.I18N.l("fernwartung"),events:{tap:{action:function(){DigiWebApp.ApplicationController.DigiLoaderView.show("Ermittle IP-Adresse - Bitte Warten...");
try{DigiWebApp.ApplicationController.vibrate()}catch(a){}$.ajax({url:"http://freegeoip.net/json/",type:"POST",dataType:"jsonp",success:function(b){DigiWebApp.ApplicationController.DigiLoaderView.hide();if(toggleWeinre(b.ip))try{DigiWebApp.ApplicationController.vibrate()}catch(c){}else alert(M.I18N.l("fernwartungKonnteNichtGestartetWerden"))},error:function(){DigiWebApp.ApplicationController.DigiLoaderView.hide();DigiWebApp.ApplicationController.nativeConfirmDialogView({title:M.I18N.l("fernwartungKonnteNichtGestartetWerden"),
message:"M\u00f6chten Sie trotzdem fortfahren?",confirmButtonValue:M.I18N.l("yes"),cancelButtonValue:M.I18N.l("no"),callbacks:{confirm:{target:this,action:function(){if(toggleWeinre("nichtErmittelbar"))try{DigiWebApp.ApplicationController.vibrate()}catch(b){}else alert(M.I18N.l("fernwartungKonnteNichtGestartetWerden"))}}}})}})}}}})}),tabBar:DigiWebApp.TabBar});m_require("app/views/DummyTemplateView");m_require("app/views/TabBar.js");
DigiWebApp.SettingsPage=M.PageView.design({childViews:"header content",events:{pagebeforeshow:{target:DigiWebApp.SettingsController,action:"init"}},cssClass:"settingsPage",header:M.ToolbarView.design({childViews:"backButton title",cssClass:"header unselectable",isFixed:YES,backButton:M.ButtonView.design({value:M.I18N.l("back"),icon:"arrow-l",anchorLocation:M.LEFT,events:{tap:{action:function(){try{DigiWebApp.ApplicationController.vibrate()}catch(a){}DigiWebApp.SettingsController.showCredentialsAlert||
DigiWebApp.NavigationController.backToDashboardPage()}}}}),title:M.LabelView.design({value:M.I18N.l("settings"),anchorLocation:M.CENTER}),anchorLocation:M.TOP}),content:M.ScrollView.design({childViews:"companyGrid passwordGrid connectionCodeGrid workerIdGrid autoTransferAfterBookTimeCheck autoTransferAfterClosingDayCheck closeAppAfterCloseDay autoSyncAfterBookTimeCheck stammdatenabgleichBeimAppStartCheck BookingReminderHoursGrid remarkIsMandatory remarkIsOptional autoSaveGPSData GPSenableHighAccuracy GPSenableHighAccuracyFallback GPSmaximumAgeMinutesGrid GPSBackgroundService detailierteZeitdaten useTransitionsSetting daysToHoldBookingsOnDeviceSliderContainer bautagebuchLimit_autoStartUhrzeit ServiceApp_ermittleGeokoordinate ServiceApp_datenUebertragen ServiceApp_engeKopplung ServiceApp_PORTGrid ServiceApp_FallBack auftragsDetailsKoppeln vibrationsDauerSliderContainer terminlisteEinstellungen festePauseStornierenEinstellungen grid",
daysToHoldBookingsOnDeviceSliderContainer:M.ContainerView.design({childViews:"daysToHoldBookingsOnDeviceSlider",daysToHoldBookingsOnDeviceSlider:M.SliderView.design({label:M.I18N.l("daysToHoldBookingsOnDeviceLabel"),min:1,max:60,highlightLeftPart:YES,cssClass:"daysToHoldBookingsOnDeviceSlider",contentBinding:{target:DigiWebApp.SettingsController,property:"settings.daysToHoldBookingsOnDevice"}})}),vibrationsDauerSliderContainer:M.ContainerView.design({childViews:"vibrationsDauerSlider",vibrationsDauerSlider:M.SliderView.design({label:M.I18N.l("vibrationsDauerLabel"),
min:0,max:200,highlightLeftPart:YES,cssClass:"vibrationsDauerSlider",contentBinding:{target:DigiWebApp.SettingsController,property:"settings.vibrationsDauer"}})}),companyGrid:M.GridView.design({childViews:"companyLabel companyInput",layout:M.TWO_COLUMNS,companyLabel:M.LabelView.design({value:M.I18N.l("company")}),companyInput:M.TextFieldView.design({inputType:M.INPUT_NUMBER,contentBinding:{target:DigiWebApp.SettingsController,property:"settings.company"}})}),passwordGrid:M.GridView.design({childViews:"passwordLabel passwordInput",
layout:M.TWO_COLUMNS,passwordLabel:M.LabelView.design({value:M.I18N.l("password")}),passwordInput:M.TextFieldView.design({inputType:M.INPUT_PASSWORD,contentBinding:{target:DigiWebApp.SettingsController,property:"settings.password"}})}),connectionCodeGrid:M.GridView.design({childViews:"connectionCodeLabel connectionCodeInput",layout:M.TWO_COLUMNS,connectionCodeLabel:M.LabelView.design({value:M.I18N.l("connectionCode")}),connectionCodeInput:M.TextFieldView.design({inputType:M.INPUT_PASSWORD,contentBinding:{target:DigiWebApp.SettingsController,
property:"settings.connectionCode"}})}),workerIdGrid:M.GridView.design({childViews:"workerIdLabel workerIdInput",layout:M.TWO_COLUMNS,workerIdLabel:M.LabelView.design({value:M.I18N.l("workerId")}),workerIdInput:M.TextFieldView.design({inputType:M.INPUT_NUMBER,contentBinding:{target:DigiWebApp.SettingsController,property:"settings.workerId"}})}),autoTransferAfterBookTimeCheck:M.SelectionListView.design({selectionMode:M.MULTIPLE_SELECTION,contentBinding:{target:DigiWebApp.SettingsController,property:"settings.autoTransferAfterBookTime"}}),
autoTransferAfterClosingDayCheck:M.SelectionListView.design({selectionMode:M.MULTIPLE_SELECTION,contentBinding:{target:DigiWebApp.SettingsController,property:"settings.autoTransferAfterClosingDay"}}),closeAppAfterCloseDay:M.SelectionListView.design({selectionMode:M.MULTIPLE_SELECTION,contentBinding:{target:DigiWebApp.SettingsController,property:"settings.closeAppAfterCloseDay"}}),stammdatenabgleichBeimAppStartCheck:M.SelectionListView.design({selectionMode:M.MULTIPLE_SELECTION,contentBinding:{target:DigiWebApp.SettingsController,
property:"settings.stammdatenabgleichBeimAppStart"}}),autoSyncAfterBookTimeCheck:M.SelectionListView.design({selectionMode:M.MULTIPLE_SELECTION,contentBinding:{target:DigiWebApp.SettingsController,property:"settings.autoSyncAfterBookTime"}}),remarkIsMandatory:M.SelectionListView.design({selectionMode:M.MULTIPLE_SELECTION,contentBinding:{target:DigiWebApp.SettingsController,property:"settings.remarkIsMandatory"}}),remarkIsOptional:M.SelectionListView.design({selectionMode:M.MULTIPLE_SELECTION,contentBinding:{target:DigiWebApp.SettingsController,
property:"settings.remarkIsOptional"}}),detailierteZeitdaten:M.SelectionListView.design({selectionMode:M.MULTIPLE_SELECTION,contentBinding:{target:DigiWebApp.SettingsController,property:"settings.detailierteZeitdaten"}}),useTransitionsSetting:M.SelectionListView.design({selectionMode:M.MULTIPLE_SELECTION,contentBinding:{target:DigiWebApp.SettingsController,property:"settings.useTransitionsSetting"}}),autoSaveGPSData:M.SelectionListView.design({selectionMode:M.MULTIPLE_SELECTION,contentBinding:{target:DigiWebApp.SettingsController,
property:"settings.autoSaveGPSData"},events:{change:{target:this,action:function(){var a=NO;if(M.ViewManager.getView("settingsPage","autoSaveGPSData")!==null)a=$("#"+M.ViewManager.getView("settingsPage","autoSaveGPSData").id+" label.ui-checkbox-on").length>0?YES:NO;if(a){try{$("[id="+DigiWebApp.SettingsPage.content.GPSenableHighAccuracy.id+"]").each(function(){$(this).hide()})}catch(b){}try{$("[id="+DigiWebApp.SettingsPage.content.GPSenableHighAccuracyFallback.id+"]").each(function(){$(this).hide()})}catch(c){}try{$("[id="+
DigiWebApp.SettingsPage.content.GPSmaximumAgeMinutesGrid.id+"]").each(function(){$(this).hide()})}catch(d){}}else{try{$("[id="+DigiWebApp.SettingsPage.content.GPSenableHighAccuracy.id+"]").each(function(){$(this).show()})}catch(e){}try{$("[id="+DigiWebApp.SettingsPage.content.GPSenableHighAccuracyFallback.id+"]").each(function(){$(this).show()})}catch(f){}try{$("[id="+DigiWebApp.SettingsPage.content.GPSmaximumAgeMinutesGrid.id+"]").each(function(){$(this).show()})}catch(g){}}}}}}),GPSenableHighAccuracy:M.SelectionListView.design({selectionMode:M.MULTIPLE_SELECTION,
contentBinding:{target:DigiWebApp.SettingsController,property:"settings.GPSenableHighAccuracy"},events:{change:{target:this,action:function(){var a=NO;if(M.ViewManager.getView("settingsPage","GPSenableHighAccuracy")!==null)a=$("#"+M.ViewManager.getView("settingsPage","GPSenableHighAccuracy").id+" label.ui-checkbox-on").length>0?YES:NO;if(a)try{$("[id="+DigiWebApp.SettingsPage.content.GPSenableHighAccuracyFallback.id+"]").each(function(){$(this).show()})}catch(b){}else try{$("[id="+DigiWebApp.SettingsPage.content.GPSenableHighAccuracyFallback.id+
"]").each(function(){$(this).hide()})}catch(c){}}}}}),GPSenableHighAccuracyFallback:M.SelectionListView.design({selectionMode:M.MULTIPLE_SELECTION,contentBinding:{target:DigiWebApp.SettingsController,property:"settings.GPSenableHighAccuracyFallback"}}),GPSBackgroundService:M.SelectionListView.design({selectionMode:M.MULTIPLE_SELECTION,contentBinding:{target:DigiWebApp.SettingsController,property:"settings.GPSBackgroundService"}}),GPSmaximumAgeMinutesGrid:M.GridView.design({childViews:"GPSmaximumAgeMinutesLabel GPSmaximumAgeMinutesInput",
layout:M.TWO_COLUMNS,GPSmaximumAgeMinutesLabel:M.LabelView.design({value:M.I18N.l("GPSmaximumAgeMinutes")}),GPSmaximumAgeMinutesInput:M.TextFieldView.design({inputType:M.INPUT_NUMBER,contentBinding:{target:DigiWebApp.SettingsController,property:"settings.GPSmaximumAgeMinutes"}})}),BookingReminderHoursGrid:M.GridView.design({childViews:"BookingReminderHoursLabel BookingReminderHoursInput",layout:M.TWO_COLUMNS,BookingReminderHoursLabel:M.LabelView.design({value:M.I18N.l("BookingReminderHours")}),BookingReminderHoursInput:M.TextFieldView.design({inputType:M.INPUT_NUMBER,
contentBinding:{target:DigiWebApp.SettingsController,property:"settings.BookingReminderHours"}})}),bautagebuchLimit_autoStartUhrzeit:M.SelectionListView.design({selectionMode:M.MULTIPLE_SELECTION,contentBinding:{target:DigiWebApp.SettingsController,property:"settings.bautagebuchLimit_autoStartUhrzeit"}}),GPSDataIsMandatory:M.SelectionListView.design({selectionMode:M.MULTIPLE_SELECTION,cssClass:"lastSelectBox",contentBinding:{target:DigiWebApp.SettingsController,property:"settings.GPSDataIsMandatory"}}),
ServiceApp_ermittleGeokoordinate:M.SelectionListView.design({selectionMode:M.MULTIPLE_SELECTION,contentBinding:{target:DigiWebApp.SettingsController,property:"settings.ServiceApp_ermittleGeokoordinate"}}),ServiceApp_datenUebertragen:M.SelectionListView.design({selectionMode:M.MULTIPLE_SELECTION,contentBinding:{target:DigiWebApp.SettingsController,property:"settings.ServiceApp_datenUebertragen"}}),ServiceApp_engeKopplung:M.SelectionListView.design({selectionMode:M.MULTIPLE_SELECTION,contentBinding:{target:DigiWebApp.SettingsController,
property:"settings.ServiceApp_engeKopplung"}}),ServiceApp_FallBack:M.SelectionListView.design({selectionMode:M.MULTIPLE_SELECTION,contentBinding:{target:DigiWebApp.SettingsController,property:"settings.ServiceApp_FallBack"}}),ServiceApp_PORTGrid:M.GridView.design({childViews:"ServiceApp_PORTLabel ServiceApp_PORTInput",layout:M.TWO_COLUMNS,ServiceApp_PORTLabel:M.LabelView.design({value:M.I18N.l("ServiceApp_PORT")}),ServiceApp_PORTInput:M.TextFieldView.design({contentBinding:{target:DigiWebApp.SettingsController,
property:"settings.ServiceApp_PORT"}})}),auftragsDetailsKoppeln:M.SelectionListView.design({selectionMode:M.MULTIPLE_SELECTION,contentBinding:{target:DigiWebApp.SettingsController,property:"settings.auftragsDetailsKoppeln"}}),terminlisteEinstellungen:M.ContainerView.design({childViews:"terminlisteEinstellungen_titel terminliste_keineKuenstlichenTermine terminliste_ignoriereAuftragszeitraum",cssClass:"terminlisteEinstellungen",terminlisteEinstellungen_titel:M.ListView.design({isDividedList:YES,contentBinding:{target:DigiWebApp.SettingsController,
property:"terminlisteEinstellungen_titel"},listItemTemplateView:DigiWebApp.DummyTemplateView}),terminliste_keineKuenstlichenTermine:M.SelectionListView.design({selectionMode:M.MULTIPLE_SELECTION,contentBinding:{target:DigiWebApp.SettingsController,property:"settings.terminliste_keineKuenstlichenTermine"}}),terminliste_ignoriereAuftragszeitraum:M.SelectionListView.design({selectionMode:M.MULTIPLE_SELECTION,contentBinding:{target:DigiWebApp.SettingsController,property:"settings.terminliste_ignoriereAuftragszeitraum"}})}),
festePauseStornierenEinstellungen:M.ContainerView.design({childViews:"festePauseStornierenEinstellungen_titel festePauseStornieren_nurAktuellerTag",cssClass:"festePauseStornierenEinstellungen",festePauseStornierenEinstellungen_titel:M.ListView.design({isDividedList:YES,contentBinding:{target:DigiWebApp.SettingsController,property:"festePauseStornierenEinstellungen_titel"},listItemTemplateView:DigiWebApp.DummyTemplateView}),festePauseStornieren_nurAktuellerTag:M.SelectionListView.design({selectionMode:M.MULTIPLE_SELECTION,
contentBinding:{target:DigiWebApp.SettingsController,property:"settings.festePauseStornieren_nurAktuellerTag"}})}),grid:M.GridView.design({childViews:"button icon",layout:{cssClass:"digiButton",columns:{0:"button",1:"icon"}},button:M.ButtonView.design({value:M.I18N.l("assume"),cssClass:"digiButton",anchorLocation:M.RIGHT,events:{tap:{target:DigiWebApp.SettingsController,action:function(){try{DigiWebApp.ApplicationController.vibrate()}catch(a){}this.save()}}}}),icon:M.ImageView.design({value:"theme/images/icon_bookTime.png"})})}),
tabBar:DigiWebApp.TabBar});
DigiWebApp.TerminlisteTemplateView=M.ListItemView.design({isSelectable:YES,childViews:"betreff beschreibung auftragsBezeichnung positionsBezeichnung positionBegin positionEnd spacer1 von bis",events:{tap:{action:function(a){var b=M.ViewManager.getViewById(a).positionId,c=null;_.each(DigiWebApp.Position.find(),function(d){if(d.get("id")===b)c=d});if(c!==null){a=_.find(DigiWebApp.Order.find(),function(d){return parseIntRadixTen(c.get("orderId"))===parseIntRadixTen(d.get("id"))});if(DigiWebApp.SettingsController.featureAvailable("406")){typeof M.ViewManager.getView("orderInfoPage",
"order").getSelection()==="undefined"&&DigiWebApp.OrderInfoController.init();DigiWebApp.NavigationController.toOrderInfoPageTransition();M.ViewManager.getView("orderInfoPage","order").setSelection(c.get("orderId"));DigiWebApp.OrderInfoController.activeOrder=[a];DigiWebApp.OrderInfoController.setPositions();M.ViewManager.getView("orderInfoPage","position").setSelection(c.get("id"));DigiWebApp.OrderInfoController.activePosition=[c];DigiWebApp.OrderInfoController.setItem()}else{typeof M.ViewManager.getView("bookingPage",
"order").getSelection()==="undefined"&&DigiWebApp.BookingController.init();DigiWebApp.NavigationController.toBookTimePageTransition();M.ViewManager.getView("bookingPage","order").setSelection(c.get("orderId"));DigiWebApp.SelectionController.setPositions();M.ViewManager.getView("bookingPage","position").setSelection(c.get("id"));DigiWebApp.SelectionController.setActivities(YES)}}}}},betreff:M.LabelView.design({cssClass:"bold unselectable",computedValue:{valuePattern:"<%= betreff %>",operation:function(a){return a!==
""&&typeof a!=="undefined"&&a!=="undefined"&&a!=="null"&&a!==null?M.I18N.l("betreff")+": "+a:""}}}),beschreibung:M.LabelView.design({cssClass:"normal unselectable",computedValue:{valuePattern:"<%= beschreibung %>",operation:function(a){return a!==""&&typeof a!=="undefined"&&a!=="undefined"&&a!=="null"&&a!==null?M.I18N.l("beschreibung")+": "+a+"<br/><br/>":""}}}),auftragsBezeichnung:M.LabelView.design({cssClass:"normal unselectable",computedValue:{valuePattern:"<%= positionId %>",operation:function(a){var b=
"",c=_.find(DigiWebApp.Position.find(),function(e){return parseIntRadixTen(e.get("id"))===parseIntRadixTen(a)});if(c){var d=_.find(DigiWebApp.Order.find(),function(e){return parseIntRadixTen(e.get("id"))===parseIntRadixTen(c.get("orderId"))});if(d)b=d.get("name")}return b!==""&&typeof b!=="undefined"&&b!=="undefined"&&b!=="null"&&b!==null?(DigiWebApp.SettingsController.getSetting("DTC6aktiv")===YES?M.I18N.l("dtc6Ordner"):M.I18N.l("order"))+": "+b:""}}}),positionsBezeichnung:M.LabelView.design({cssClass:"normal unselectable",
computedValue:{valuePattern:"<%= positionId %>",operation:function(a){var b="",c=_.find(DigiWebApp.Position.find(),function(d){return parseIntRadixTen(d.get("id"))===parseIntRadixTen(a)});if(c)b=c.get("name");return b!==""&&typeof b!=="undefined"&&b!=="undefined"&&b!=="null"&&b!==null?(DigiWebApp.SettingsController.getSetting("DTC6aktiv")===YES?M.I18N.l("dtc6Auftrag"):M.I18N.l("position"))+": "+b:""}}}),positionBegin:M.LabelView.design({cssClass:"normal unselectable",isInline:YES,computedValue:{valuePattern:"<%= positionId %>",
operation:function(a){var b="",c=_.find(DigiWebApp.Position.find(),function(d){return parseIntRadixTen(d.get("id"))===parseIntRadixTen(a)});if(c)b=c.get("positionBegin");return b!==""&&typeof b!=="undefined"&&b!=="undefined"&&b!=="null"&&b!==null?M.I18N.l("positionZeitraum")+": "+b:""}}}),positionEnd:M.LabelView.design({cssClass:"normalInline unselectable",isInline:YES,computedValue:{valuePattern:"<%= positionId %>",operation:function(a){var b="",c=_.find(DigiWebApp.Position.find(),function(d){return parseIntRadixTen(d.get("id"))===
parseIntRadixTen(a)});if(c)b=c.get("positionEnd");return b!==""&&typeof b!=="undefined"&&b!=="undefined"&&b!=="null"&&b!==null?" - "+b:" - "+M.I18N.l("open")}}}),spacer1:M.LabelView.design({value:" "}),von:M.LabelView.design({cssClass:"bold unselectable",isInline:YES,computedValue:{valuePattern:"<%= von %>",operation:function(a){if(a&&a.indexOf("00:00:00")===-1){a=a.split(" ")[1];return a.split(":")[0]+":"+a.split(":")[1]}else return""}}}),bis:M.LabelView.design({cssClass:"boldInline unselectable",
isInline:YES,computedValue:{valuePattern:"<%= bis %>",operation:function(a){if(a&&a.indexOf("23:59:59")===-1){a=a.split(" ")[1];return" - "+a.split(":")[0]+":"+a.split(":")[1]}else return""}}})});
DigiWebApp.TerminlisteVorZurueckTabBar=M.TabBarView.design({childViews:"tabItemZurueck tabItemDayToShow tabItemVor",anchorLocation:M.BOTTOM,isFixed:YES,transition:M.TRANSITION.FADE,name:"terminlistevorzuruecktabbar",tabItemZurueck:M.TabBarItemView.design({value:M.I18N.l("backward"),page:"terminlistePage",icon:"arrow-l",switchPage:function(){try{DigiWebApp.ApplicationController.vibrate()}catch(a){}DigiWebApp.TerminlisteVorZurueckTabBar.backwardHandler()}}),tabItemDayToShow:M.TabBarItemView.design({value:"",
page:"terminlistePage",icon:""}),tabItemVor:M.TabBarItemView.design({value:M.I18N.l("forward"),page:"terminlistePage",icon:"arrow-r",switchPage:function(){try{DigiWebApp.ApplicationController.vibrate()}catch(a){}DigiWebApp.TerminlisteVorZurueckTabBar.forwardHandler()}}),backwardHandler:function(){DigiWebApp.TerminlisteController.items=null;var a=D8.create(DigiWebApp.TerminlisteController.datum),b=a.yesterday();DigiWebApp.TerminlisteController.set("datum",a.addMinutes(-a.date.getTimezoneOffset()+b.date.getTimezoneOffset()).addDays(-1).format("dd.mm.yyyy"));
DigiWebApp.TerminlisteController.init(YES)},forwardHandler:function(){DigiWebApp.TerminlisteController.items=null;var a=D8.create(DigiWebApp.TerminlisteController.datum),b=a.tomorrow();DigiWebApp.TerminlisteController.set("datum",a.addMinutes(-a.date.getTimezoneOffset()+b.date.getTimezoneOffset()).addDays(1).format("dd.mm.yyyy"));DigiWebApp.TerminlisteController.init(YES)}});m_require("app/views/TerminlisteTemplateView");m_require("app/views/TerminlisteVorZurueckTabBar.js");
DigiWebApp.TerminlistePage=M.PageView.design({events:{pagebeforeshow:{target:DigiWebApp.TerminlisteController,action:"init"}},childViews:"header content tabBar",cssClass:"terminlistePage",header:M.ToolbarView.design({childViews:"backButton titleGrid",cssClass:"header",isFixed:YES,backButton:M.ButtonView.design({value:M.I18N.l("back"),icon:"arrow-l",anchorLocation:M.LEFT,events:{tap:{action:function(){try{DigiWebApp.ApplicationController.vibrate()}catch(a){}DigiWebApp.SettingsController.featureAvailable("404")?
DigiWebApp.NavigationController.backToButtonDashboardPagePOP():DigiWebApp.NavigationController.backToDashboardPagePOP()}}}}),titleGrid:M.GridView.design({childViews:"titleDay titleTextFieldView",anchorLocation:M.CENTER,layout:{cssClass:"dateTitleGrid",columns:{0:"dateTitleGridColumn1",1:"dateTitleGridColumn2"}},titleDay:M.LabelView.design({computedValue:{contentBinding:{target:DigiWebApp.TerminlisteController,property:"datumAsDate"},value:0,operation:function(a){return DigiWebApp.ApplicationController.dayNamesShort[D8.create(a).date.getDay()].substring(0,
2)}},cssClass:"dateTitleDay"}),titleTextFieldView:M.TextFieldView.design({value:"",cssClass:"dateTitle",anchorLocation:M.CENTER,inputType:M.INPUT_DATE,contentBinding:{target:DigiWebApp.TerminlisteController,property:"datumAsDate"},contentBindingReverse:{target:DigiWebApp.TerminlisteController,property:"datumAsDate"},events:{blur:{action:function(){if(DigiWebApp.TerminlisteController.datumAsDate){var a=DigiWebApp.TerminlisteController.datumAsDate.split("-");DigiWebApp.TerminlisteController.set("datum",
a[2]+"."+a[1]+"."+a[0])}}},tap:{action:function(){try{DigiWebApp.ApplicationController.vibrate()}catch(a){}}}}})}),titleLabel:M.LabelView.design({value:M.I18N.l("Terminliste"),anchorLocation:M.CENTER}),anchorLocation:M.TOP}),content:M.ScrollView.design({childViews:"terminliste",terminliste:M.ListView.design({isDividedList:YES,contentBinding:{target:DigiWebApp.TerminlisteController,property:"items"},listItemTemplateView:DigiWebApp.TerminlisteTemplateView})}),tabBar:DigiWebApp.TerminlisteVorZurueckTabBar});
DigiWebApp.TimeDataForEditTemplateView=M.ListItemView.design({isSelectable:NO,childViews:"date order position activity latitude longitude",events:{tap:{action:function(){}}},date:M.LabelView.design({cssClass:"date",computedValue:{valuePattern:"<%= date %>",operation:function(a){var b=a.split(","),c;if(typeof b[2]==="undefined"){a=new Date(Number(b[0]));a=M.Date.create(a.getTime());c=null;if(b[1]!=="0"){c=new Date(Number(b[1]));c=M.Date.create(c.getTime())}}else{a=new Date(Number(b[0])+6E4*((new Date).getTimezoneOffset()-
Number(b[2])));a=M.Date.create(a.getTime());c=null;if(b[1]!=="0"){c=new Date(Number(b[1])+6E4*((new Date).getTimezoneOffset()-Number(b[2])));c=M.Date.create(c.getTime())}}if(c){a=M.Date.create(a.format("mm/dd/yyyy HH:MM"));c=M.Date.create(c.format("mm/dd/yyyy HH:MM"));if(a.format("mm/dd/yyyy HH:MM")===c.format("mm/dd/yyyy HH:MM"))return a.format("dd.mm.yyyy")+", "+a.format("HH:MM")+" - "+c.format("HH:MM")+" "+M.I18N.l("oclock")+", 00:01 h";else{var d=a.timeBetween(c,M.MINUTES);d=d<1?M.Math.round(d,
M.CEIL):M.Math.round(a.timeBetween(c,M.MINUTES),M.FLOOR);if(d>59){b=M.Math.round(d/60,M.FLOOR);b=b<10?"0"+b:b;d=d%60;d=d<10?"0"+d:d;d=b+":"+d}else d="00:"+(d<10?"0":"")+d;return a.format("dd.mm.yyyy")+", "+a.format("HH:MM")+" - "+c.format("HH:MM")+" "+M.I18N.l("oclock")+", "+d+" h"}}else return a.format("dd.mm.yyyy")+", "+a.format("HH:MM")+" - "+M.I18N.l("now")+" ("+M.Date.create().format("HH:MM")+")"}}}),order:M.LabelView.design({cssClass:"application",computedValue:{valuePattern:"<%= orderId %>",
operation:function(a){var b=_.select(DigiWebApp.Order.findSorted().concat(DigiWebApp.HandOrder.findSorted()),function(d){if(d)return a==d.get("id")||a==d.get("name")}),c=DigiWebApp.SettingsController.getSetting("DTC6aktiv")===YES?M.I18N.l("dtc6Ordner"):M.I18N.l("order");if(b&&b.length>0){b=b[0];return DigiWebApp.SettingsController.globalDebugMode?c+": "+b.get("name")+" ("+b.get("id")+")":c+": "+b.get("name")}else return c+": "+M.I18N.l("notDefined")}}}),position:M.LabelView.design({cssClass:"position",
computedValue:{valuePattern:"<%= positionId %>",operation:function(a){var b=DigiWebApp.SettingsController.getSetting("DTC6aktiv")===YES?M.I18N.l("dtc6Auftrag"):M.I18N.l("position");if(a){var c=_.select(DigiWebApp.Position.findSorted(),function(d){if(d)return a==d.get("id")});if(c&&c.length>0){c=c[0];return b+": "+c.get("name")}else return b+": "+M.I18N.l("notDefined")}else return b+": "+M.I18N.l("unknown")}}}),activity:M.LabelView.design({cssClass:"activity",computedValue:{valuePattern:"<%= activityId %>",
operation:function(a){var b=DigiWebApp.SettingsController.getSetting("DTC6aktiv")===YES?M.I18N.l("dtc6Leistung"):M.I18N.l("activity");if(a){var c=null;if(parseIntRadixTen(a)!==0)c=_.select(DigiWebApp.Activity.findSorted(),function(d){if(d)return a==d.get("id")});if(c&&c.length>0){c=c[0];return b+": "+c.get("name")}else return b+": "+M.I18N.l("notDefined")}else return b+": "+M.I18N.l("unknown")}}}),latitude:M.LabelView.design({cssClass:"location",computedValue:{valuePattern:"<%= latitude %>",operation:function(a){if(a>
0){a=new Number(a);return M.I18N.l("latitude")+": "+a.toFixed(6)}else return""}}}),longitude:M.LabelView.design({cssClass:"location",computedValue:{valuePattern:"<%= longitude %>",operation:function(a){if(a>0){a=new Number(a);return M.I18N.l("longitude")+": "+a.toFixed(6)}else return""}}}),remark:M.LabelView.design({cssClass:"remark",computedValue:{valuePattern:"<%= remark %>",operation:function(a){return a?M.I18N.l("remark")+": "+a:""}}})});m_require("app/views/TimeDataForEditTemplateView");
DigiWebApp.EditTimeDataPage=M.PageView.design({bookingToEdit:null,signaturePadAPI:null,events:{pagebeforeshow:{action:function(){DigiWebApp.BookingController.setTimeDataForEdit();if(DigiWebApp.SettingsController.featureAvailable("405")&&typeof window.requestFileSystem!=="undefined"){$("#"+DigiWebApp.EditTimeDataPage.content.signature.id).show();var a={bgColour:"#fff",lineTop:130,drawOnly:true};if(DigiWebApp.EditTimeDataPage.signaturePadAPI===null)DigiWebApp.EditTimeDataPage.signaturePadAPI=$(".sigPad").signaturePad(a)}else $("#"+
DigiWebApp.EditTimeDataPage.content.signature.id).hide();if(typeof DigiWebApp.EditTimeDataPage.bookingToEdit!=="undefined"&&DigiWebApp.EditTimeDataPage.bookingToEdit!==null)if(typeof DigiWebApp.EditTimeDataPage.bookingToEdit.get("remark")!=="undefined"&&DigiWebApp.EditTimeDataPage.bookingToEdit.get("remark")!==null){$("#"+DigiWebApp.EditTimeDataPage.content.remarkInput.id).val(DigiWebApp.EditTimeDataPage.bookingToEdit.get("remark"));M.ViewManager.getView("editTimeDataPage","remarkInput").value=DigiWebApp.EditTimeDataPage.bookingToEdit.get("remark")}else{$("#"+
DigiWebApp.EditTimeDataPage.content.remarkInput.id).val("");M.ViewManager.getView("editTimeDataPage","remarkInput").value=""}else{$("#"+DigiWebApp.EditTimeDataPage.content.remarkInput.id).val("");M.ViewManager.getView("editTimeDataPage","remarkInput").value=""}if(typeof DigiWebApp.EditTimeDataPage.bookingToEdit!=="undefined"&&DigiWebApp.EditTimeDataPage.bookingToEdit!==null)if(typeof DigiWebApp.EditTimeDataPage.bookingToEdit.get("gefahreneKilometer")!=="undefined"&&DigiWebApp.EditTimeDataPage.bookingToEdit.get("gefahreneKilometer")!==
null){$("#"+DigiWebApp.EditTimeDataPage.content.gefahreneKilometerInput.id).val(DigiWebApp.EditTimeDataPage.bookingToEdit.get("gefahreneKilometer"));M.ViewManager.getView("editTimeDataPage","gefahreneKilometerInput").value=DigiWebApp.EditTimeDataPage.bookingToEdit.get("gefahreneKilometer")}else{$("#"+DigiWebApp.EditTimeDataPage.content.gefahreneKilometerInput.id).val("0");M.ViewManager.getView("editTimeDataPage","gefahreneKilometerInput").value="0"}else{$("#"+DigiWebApp.EditTimeDataPage.content.gefahreneKilometerInput.id).val("0");
M.ViewManager.getView("editTimeDataPage","gefahreneKilometerInput").value="0"}if(DigiWebApp.SettingsController.featureAvailable("403")){$("[for="+DigiWebApp.EditTimeDataPage.content.remarkInput.id+"]").each(function(){$(this).show()});$("[id="+DigiWebApp.EditTimeDataPage.content.remarkInput.id+"]").each(function(){$(this).show()})}else{$("[for="+DigiWebApp.EditTimeDataPage.content.remarkInput.id+"]").each(function(){$(this).hide()});$("[id="+DigiWebApp.EditTimeDataPage.content.remarkInput.id+"]").each(function(){$(this).hide()})}if(DigiWebApp.SettingsController.featureAvailable("422"))if(typeof DigiWebApp.BookingController.currentBooking!==
"undefined"&&DigiWebApp.BookingController.currentBooking!==null){var b=null;_.each(DigiWebApp.Activity.find(),function(c){if(c.get("id")===parseIntRadixTen(DigiWebApp.BookingController.currentBooking.get("activityId")))b=c});if(b!==null&&b.get("istFahrzeitRelevant")){$("[for="+DigiWebApp.EditTimeDataPage.content.gefahreneKilometerInput.id+"]").each(function(){$(this).show()});$("[id="+DigiWebApp.EditTimeDataPage.content.gefahreneKilometerInput.id+"]").each(function(){$(this).show()})}else{$("[for="+
DigiWebApp.EditTimeDataPage.content.gefahreneKilometerInput.id+"]").each(function(){$(this).hide()});$("[id="+DigiWebApp.EditTimeDataPage.content.gefahreneKilometerInput.id+"]").each(function(){$(this).hide()})}}else{$("[for="+DigiWebApp.EditTimeDataPage.content.gefahreneKilometerInput.id+"]").each(function(){$(this).hide()});$("[id="+DigiWebApp.EditTimeDataPage.content.gefahreneKilometerInput.id+"]").each(function(){$(this).hide()})}else{$("[for="+DigiWebApp.EditTimeDataPage.content.gefahreneKilometerInput.id+
"]").each(function(){$(this).hide()});$("[id="+DigiWebApp.EditTimeDataPage.content.gefahreneKilometerInput.id+"]").each(function(){$(this).hide()})}DigiWebApp.SettingsController.featureAvailable("405")&&typeof window.requestFileSystem!=="undefined"&&DigiWebApp.EditTimeDataPage.bookingToEdit.readFromFile(function(c){c&&c!==""?DigiWebApp.EditTimeDataPage.signaturePadAPI.regenerate(c):DigiWebApp.EditTimeDataPage.signaturePadAPI.clearCanvas()},function(){DigiWebApp.EditTimeDataPage.signaturePadAPI.clearCanvas()})}}},
myCallback:function(){},tab_action_timeoutvar:null,tab_action:function(){clearTimeout(DigiWebApp.EditTimeDataPage.tab_action_timeoutvar);var a="";if(DigiWebApp.SettingsController.featureAvailable("405")&&typeof window.requestFileSystem!=="undefined"&&DigiWebApp.EditTimeDataPage.signaturePadAPI)a=DigiWebApp.EditTimeDataPage.signaturePadAPI.getSignatureString();if(M.ViewManager.getView("editTimeDataPage","remarkInput").value.length>255){DigiWebApp.ApplicationController.DigiLoaderView.hide();DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("remarkTooLong"),
message:M.I18N.l("remarkTooLongMessage")})}else if(DigiWebApp.SettingsController.getSetting("remarkIsMandatory")&&M.ViewManager.getView("editTimeDataPage","remarkInput").value===""){DigiWebApp.ApplicationController.DigiLoaderView.hide();DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("remarkIsMandatory"),message:M.I18N.l("remarkIsMandatoryMessage")})}else if(DigiWebApp.ApplicationController.sonderzeichenCheck(M.ViewManager.getView("editTimeDataPage","remarkInput").value)){DigiWebApp.ApplicationController.DigiLoaderView.hide();
DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("specialCharProblem"),message:M.I18N.l("specialCharProblemMsg")})}else{DigiWebApp.EditTimeDataPage.bookingToEdit.set("remark",M.ViewManager.getView("editTimeDataPage","remarkInput").value);DigiWebApp.EditTimeDataPage.bookingToEdit.set("gefahreneKilometer",M.ViewManager.getView("editTimeDataPage","gefahreneKilometerInput").value);DigiWebApp.EditTimeDataPage.bookingToEdit.save();if(a!==""){DigiWebApp.EditTimeDataPage.bookingToEdit.set("fileType",
DigiWebApp.ApplicationController.CONSTTextFiletype);DigiWebApp.EditTimeDataPage.bookingToEdit.set("unterschrift_breite",DigiWebApp.EditTimeDataPage.content.signature.signatureform.signaturecanvas.canvasWidth);DigiWebApp.EditTimeDataPage.bookingToEdit.set("unterschrift_hoehe",DigiWebApp.EditTimeDataPage.content.signature.signatureform.signaturecanvas.canvasHeight);DigiWebApp.EditTimeDataPage.bookingToEdit.save();DigiWebApp.EditTimeDataPage.bookingToEdit.saveToFile(a,DigiWebApp.EditTimeDataPage.myCallback)}else DigiWebApp.EditTimeDataPage.myCallback()}},
childViews:"header content",cssClass:"remarkPage",header:M.ToolbarView.design({childViews:"backButton title",cssClass:"header",isFixed:YES,backButton:M.ButtonView.design({value:M.I18N.l("back"),icon:"arrow-l",anchorLocation:M.LEFT,events:{tap:{target:DigiWebApp.NavigationController,action:function(){try{DigiWebApp.ApplicationController.vibrate()}catch(a){}this.backToTimeDataPage()}}}}),title:M.LabelView.design({value:M.I18N.l("EditTimeDataPageTitle"),anchorLocation:M.CENTER}),anchorLocation:M.TOP}),
content:M.ScrollView.design({childViews:"orderbox remarkInput gefahreneKilometerInput signature saveGrid",orderbox:M.ListView.design({contentBinding:{target:DigiWebApp.BookingController,property:"timeDataForEdit"},listItemTemplateView:DigiWebApp.TimeDataForEditTemplateView}),remarkInput:M.TextFieldView.design({label:M.I18N.l("remark"),cssClass:"remarkInput",hasMultipleLines:YES,initialText:"max. 255 "+M.I18N.l("characters"),numberOfChars:255}),gefahreneKilometerInput:M.TextFieldView.design({label:M.I18N.l("gefahreneKilometer"),
cssClass:"remarkInput",hasMultipleLines:NO,inputType:M.INPUT_NUMBER}),signature:M.ContainerView.design({childViews:"signatureform",cssClass:"signaturecanvas marginTop20 marginBottom20",signatureform:M.FormView.design({childViews:"signaturecanvas",signaturecanvas:M.CanvasView.design({label:M.I18N.l("signature"),canvasWidth:300,canvasHeight:150,render:function(){if(this.label)this.html+='<label for="'+this.id+'" class="signaturecanvaslabel">'+this.label+"</label>";this.html+='  <div id="'+this.id+'_container" class="sig sigWrapper">';
this.html+='    <canvas id="'+this.id+'_canvas" class="pad" width="'+this.canvasWidth+'px" height="'+this.canvasHeight+'px"></canvas>';this.html+='    <input id="'+this.id+'" type="hidden" name="output" class="output">';this.html+="  </div>";return this.html}}),render:function(){this.html+='<form method="post" action="" class="sigPad">';this.renderChildViews();this.html+="</form>";return this.html}})}),saveGrid:M.GridView.design({childViews:"saveButton icon",layout:{cssClass:"digiButton marginTop25",
columns:{0:"saveRemarkButton",1:"icon"}},saveButton:M.ButtonView.design({value:M.I18N.l("assume"),cssClass:"digiButton",anchorLocation:M.RIGHT,events:{tap:{action:function(){try{DigiWebApp.ApplicationController.vibrate()}catch(a){}DigiWebApp.ApplicationController.DigiLoaderView.show(M.I18N.l("Save"));DigiWebApp.EditTimeDataPage.tab_action_timeoutvar=setTimeout("DigiWebApp.EditTimeDataPage.tab_action();",50)}}}}),icon:M.ImageView.design({value:"theme/images/icon_bookTime.png"})})})});m_require("app/views/TimeDataForEditTemplateView");
DigiWebApp.RemarkPage=M.PageView.design({events:{pagebeforeshow:{action:function(){DigiWebApp.ApplicationController.DigiLoaderView.hide();DigiWebApp.BookingController.setTimeDataForRemark();if(DigiWebApp.SettingsController.featureAvailable("403")){$("[for="+DigiWebApp.RemarkPage.content.remarkInput.id+"]").each(function(){$(this).show()});$("[id="+DigiWebApp.RemarkPage.content.remarkInput.id+"]").each(function(){$(this).show()})}else{$("[for="+DigiWebApp.RemarkPage.content.remarkInput.id+"]").each(function(){$(this).hide()});
$("[id="+DigiWebApp.RemarkPage.content.remarkInput.id+"]").each(function(){$(this).hide()})}if(DigiWebApp.SettingsController.featureAvailable("422"))if(typeof DigiWebApp.BookingController.currentBooking!=="undefined"&&DigiWebApp.BookingController.currentBooking!==null){var a=null;_.each(DigiWebApp.Activity.find(),function(b){if(b.get("id")===parseIntRadixTen(DigiWebApp.BookingController.currentBooking.get("activityId")))a=b});if(a!==null&&a.get("istFahrzeitRelevant")){$("[for="+DigiWebApp.RemarkPage.content.gefahreneKilometerInput.id+
"]").each(function(){$(this).show()});$("[id="+DigiWebApp.RemarkPage.content.gefahreneKilometerInput.id+"]").each(function(){$(this).show()})}else{$("[for="+DigiWebApp.RemarkPage.content.gefahreneKilometerInput.id+"]").each(function(){$(this).hide()});$("[id="+DigiWebApp.RemarkPage.content.gefahreneKilometerInput.id+"]").each(function(){$(this).hide()})}}else{$("[for="+DigiWebApp.RemarkPage.content.gefahreneKilometerInput.id+"]").each(function(){$(this).hide()});$("[id="+DigiWebApp.RemarkPage.content.gefahreneKilometerInput.id+
"]").each(function(){$(this).hide()})}else{$("[for="+DigiWebApp.RemarkPage.content.gefahreneKilometerInput.id+"]").each(function(){$(this).hide()});$("[id="+DigiWebApp.RemarkPage.content.gefahreneKilometerInput.id+"]").each(function(){$(this).hide()})}if(typeof DigiWebApp.BookingController.currentBooking!=="undefined"&&DigiWebApp.BookingController.currentBooking!==null)if(typeof DigiWebApp.BookingController.currentBooking.get("remark")!=="undefined"&&DigiWebApp.BookingController.currentBooking.get("remark")!==
null){$("#"+DigiWebApp.RemarkPage.content.remarkInput.id).val(DigiWebApp.BookingController.currentBooking.get("remark"));M.ViewManager.getView("remarkPage","remarkInput").value=DigiWebApp.BookingController.currentBooking.get("remark")}else{$("#"+DigiWebApp.RemarkPage.content.remarkInput.id).val("");M.ViewManager.getView("remarkPage","remarkInput").value=""}else{$("#"+DigiWebApp.RemarkPage.content.remarkInput.id).val("");M.ViewManager.getView("remarkPage","remarkInput").value=""}if(typeof DigiWebApp.BookingController.currentBooking!==
"undefined"&&DigiWebApp.BookingController.currentBooking!==null)if(typeof DigiWebApp.BookingController.currentBooking.get("gefahreneKilometer")!=="undefined"&&DigiWebApp.BookingController.currentBooking.get("gefahreneKilometer")!==null){$("#"+DigiWebApp.RemarkPage.content.gefahreneKilometerInput.id).val(DigiWebApp.BookingController.currentBooking.get("gefahreneKilometer"));M.ViewManager.getView("remarkPage","gefahreneKilometerInput").value=DigiWebApp.BookingController.currentBooking.get("gefahreneKilometer")}else{$("#"+
DigiWebApp.RemarkPage.content.gefahreneKilometerInput.id).val("0");M.ViewManager.getView("remarkPage","gefahreneKilometerInput").value="0"}else{$("#"+DigiWebApp.RemarkPage.content.gefahreneKilometerInput.id).val("0");M.ViewManager.getView("remarkPage","gefahreneKilometerInput").value="0"}}}},myCallback:function(){},tab_action_timeoutvar:null,tab_action:function(){clearTimeout(DigiWebApp.RemarkPage.tab_action_timeoutvar);if(M.ViewManager.getView("remarkPage","remarkInput").value.length>255){DigiWebApp.ApplicationController.DigiLoaderView.hide();
DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("remarkTooLong"),message:M.I18N.l("remarkTooLongMessage")})}else if(DigiWebApp.SettingsController.getSetting("remarkIsMandatory")&&M.ViewManager.getView("remarkPage","remarkInput").value===""){DigiWebApp.ApplicationController.DigiLoaderView.hide();DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("remarkIsMandatory"),message:M.I18N.l("remarkIsMandatoryMessage")})}else if(DigiWebApp.ApplicationController.sonderzeichenCheck(M.ViewManager.getView("remarkPage",
"remarkInput").value)){DigiWebApp.ApplicationController.DigiLoaderView.hide();DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("specialCharProblem"),message:M.I18N.l("specialCharProblemMsg")})}else{DigiWebApp.BookingController.currentBooking.set("remark",M.ViewManager.getView("remarkPage","remarkInput").value);DigiWebApp.BookingController.currentBooking.set("gefahreneKilometer",parseIntRadixTen(M.ViewManager.getView("remarkPage","gefahreneKilometerInput").value));DigiWebApp.BookingController.currentBooking.save();
DigiWebApp.RemarkPage.myCallback()}},childViews:"header content",cssClass:"remarkPage",header:M.ToolbarView.design({childViews:"backButton title",cssClass:"header",isFixed:YES,backButton:M.ButtonView.design({value:M.I18N.l("back"),icon:"arrow-l",anchorLocation:M.LEFT,events:{tap:{target:DigiWebApp.NavigationController,action:function(){try{DigiWebApp.ApplicationController.vibrate()}catch(a){}this.backToBookTimePagePOP()}}}}),title:M.LabelView.design({value:M.I18N.l("remark"),anchorLocation:M.CENTER}),
anchorLocation:M.TOP}),content:M.ScrollView.design({childViews:"orderbox remarkInput gefahreneKilometerInput grid",orderbox:M.ListView.design({contentBinding:{target:DigiWebApp.BookingController,property:"timeDataForEdit"},listItemTemplateView:DigiWebApp.TimeDataForEditTemplateView}),remarkInput:M.TextFieldView.design({label:M.I18N.l("remark"),cssClass:"remarkInput",hasMultipleLines:YES,initialText:"max. 255 "+M.I18N.l("characters"),numberOfChars:255}),gefahreneKilometerInput:M.TextFieldView.design({label:M.I18N.l("gefahreneKilometer"),
cssClass:"remarkInput",hasMultipleLines:NO,inputType:M.INPUT_NUMBER}),grid:M.GridView.design({childViews:"button icon",layout:{cssClass:"digiButton marginTop25",columns:{0:"button",1:"icon"}},button:M.ButtonView.design({value:M.I18N.l("closeBooking"),cssClass:"digiButton",anchorLocation:M.RIGHT,events:{tap:{action:function(){DigiWebApp.ApplicationController.DigiLoaderView.show(M.I18N.l("Save"));DigiWebApp.RemarkPage.tab_action_timeoutvar=setTimeout("DigiWebApp.RemarkPage.tab_action();",50)}}}}),icon:M.ImageView.design({value:"theme/images/icon_bookTime.png"})})})});
DigiWebApp.TimeDataSentDaysTemplateView=M.ListItemView.design({isSelectable:YES,childViews:"tagLabel",events:{tap:{action:function(a,b){var c=NO;_.each(DigiWebApp.BookingController.timeDataSentDays,function(d){if(d.m_id===b){DigiWebApp.ZeitbuchungenController.set("datum",d.get("tagLabel").substring(4));d=DigiWebApp.Settings.find()[0];DigiWebApp.ZeitbuchungenController.set("mitarbeiterID",d.get("mitarbeiterId"));DigiWebApp.ZeitbuchungenController.set("mitarbeiterNameVorname",d.get("mitarbeiterNachname")+
", "+d.get("mitarbeiterVorname"));DigiWebApp.ZeitbuchungenController.set("backFunction",DigiWebApp.NavigationController.backToTimeDataPage);c=YES}});c===YES&&DigiWebApp.NavigationController.toZeitbuchungenPageTransition()}}},tagLabel:M.LabelView.design({cssClass:"tagLabel unselectable",computedValue:{valuePattern:"<%= tagLabel %>",operation:function(a){return M.I18N.l("archivedTimeDataOf")+" "+a}}})});
DigiWebApp.TimeDataSentTemplateView=M.ListItemView.design({isSelectable:NO,childViews:"date order position activity latitude longitude genauigkeit_von eolVon erfassungsverfahren_von gpszeitstempel_von latitude_bis longitude_bis genauigkeit_bis eolBis erfassungsverfahren_bis gpszeitstempel_bis ServiceApp_Status remark gefahreneKilometer",events:{tap:{action:function(){}}},date:M.LabelView.design({cssClass:"date unselectable",computedValue:{valuePattern:"<%= date %>",operation:function(a){a=a.split(",");
var b,c,d;if(typeof a[2]==="undefined"){b=new Date(Number(a[0]));b=M.Date.create(b.getTime());c=null;if(a[1]!=="0"){d=new Date(Number(a[1]));c=M.Date.create(d.getTime())}}else{b=new Date(Number(a[0])+6E4*((new Date).getTimezoneOffset()-Number(a[2])));b=M.Date.create(b.getTime());c=null;if(a[1]!=="0"){d=new Date(Number(a[1])+6E4*((new Date).getTimezoneOffset()-Number(a[2])));c=M.Date.create(d.getTime())}}if(c){b=M.Date.create(b.format("mm/dd/yyyy HH:MM"));c=M.Date.create(c.format("mm/dd/yyyy HH:MM"));
if(b.format("mm/dd/yyyy HH:MM")===c.format("mm/dd/yyyy HH:MM"))return a[3]+", "+a[4]+" - "+a[6]+" "+M.I18N.l("oclock")+", 00:01 h";else{d=b.timeBetween(c,M.MINUTES);d=d<1?M.Math.round(d,M.CEIL):M.Math.round(b.timeBetween(c,M.MINUTES),M.FLOOR);if(d>59){b=M.Math.round(d/60,M.FLOOR);b=b<10?"0"+b:b;d=d%60;d=d<10?"0"+d:d;d=b+":"+d}else d="00:"+(d<10?"0":"")+d;return a[3]+", "+a[4]+" - "+a[6]+" "+M.I18N.l("oclock")+", "+d+" h"}}else return a[3]+", "+a[4]+" - "+M.I18N.l("open")}}}),order:M.LabelView.design({cssClass:"application unselectable",
computedValue:{valuePattern:"<%= orderName %>",operation:function(a){var b=DigiWebApp.SettingsController.getSetting("DTC6aktiv")===YES?M.I18N.l("dtc6Ordner"):M.I18N.l("order");return a!==""?b+": "+a:b+": "+M.I18N.l("notDefined")}}}),position:M.LabelView.design({cssClass:"position unselectable",computedValue:{valuePattern:"<%= positionName %>",operation:function(a){var b=DigiWebApp.SettingsController.getSetting("DTC6aktiv")===YES?M.I18N.l("dtc6Auftrag"):M.I18N.l("position");return a!==""?b+": "+a:
b+": "+M.I18N.l("notDefined")}}}),activity:M.LabelView.design({cssClass:"activity unselectable",computedValue:{valuePattern:"<%= activityName %>",operation:function(a){var b=DigiWebApp.SettingsController.getSetting("DTC6aktiv")===YES?M.I18N.l("dtc6Leistung"):M.I18N.l("activity");return a!==""?b+": "+a:b+": "+M.I18N.l("notDefined")}}}),latitude:M.LabelView.design({cssClass:"location unselectable",isInline:YES,computedValue:{valuePattern:"<%= latitude %>",operation:function(a){if(a>0&&DigiWebApp.SettingsController.getSetting("detailierteZeitdaten")){a=
new Number(a);return M.I18N.l("vonKoordinate")+": "+a.toFixed(4)}else return""}}}),longitude:M.LabelView.design({cssClass:"location unselectable",isInline:YES,computedValue:{valuePattern:"<%= longitude %>",operation:function(a){return a>0&&DigiWebApp.SettingsController.getSetting("detailierteZeitdaten")?", "+(new Number(a)).toFixed(4):""}}}),genauigkeit_von:M.LabelView.design({cssClass:"location unselectable",isInline:YES,computedValue:{valuePattern:"<%= genauigkeitVon %>",operation:function(a){return a>
0&&DigiWebApp.SettingsController.getSetting("detailierteZeitdaten")?" ("+M.I18N.l("genauigkeit")+": "+a+" m)":""}}}),eolVon:M.LabelView.design({cssClass:"location unselectable",value:""}),latitude_bis:M.LabelView.design({cssClass:"location unselectable",isInline:YES,computedValue:{valuePattern:"<%= latitude_bis %>",operation:function(a){if(a>0&&DigiWebApp.SettingsController.getSetting("detailierteZeitdaten")){a=new Number(a);return M.I18N.l("bisKoordinate")+": "+a.toFixed(4)}else return""}}}),longitude_bis:M.LabelView.design({cssClass:"location unselectable",
isInline:YES,computedValue:{valuePattern:"<%= longitude_bis %>",operation:function(a){return a>0&&DigiWebApp.SettingsController.getSetting("detailierteZeitdaten")?", "+(new Number(a)).toFixed(4):""}}}),genauigkeit_bis:M.LabelView.design({cssClass:"location unselectable",isInline:YES,computedValue:{valuePattern:"<%= genauigkeitBis %>",operation:function(a){return a>0&&DigiWebApp.SettingsController.getSetting("detailierteZeitdaten")?" ("+M.I18N.l("genauigkeit")+": "+a+" m)":""}}}),eolBis:M.LabelView.design({cssClass:"location unselectable",
value:""}),erfassungsverfahren_von:M.LabelView.design({cssClass:"location unselectable",computedValue:{valuePattern:"<%= ermittlungsverfahrenVon %>",operation:function(a){return a!==null&&typeof a!=="undefined"&&a!=="undefined"&&DigiWebApp.SettingsController.getSetting("detailierteZeitdaten")?M.I18N.l("erfassungsverfahren_von")+": "+a.substring(0,16)+"...":""}}}),erfassungsverfahren_bis:M.LabelView.design({cssClass:"location unselectable",computedValue:{valuePattern:"<%= ermittlungsverfahrenBis %>",
operation:function(a){return a!==null&&typeof a!=="undefined"&&a!=="undefined"&&DigiWebApp.SettingsController.getSetting("detailierteZeitdaten")?M.I18N.l("erfassungsverfahren_bis")+": "+a.substring(0,16)+"...":""}}}),gpszeitstempel_von:M.LabelView.design({cssClass:"location unselectable",computedValue:{valuePattern:"<%= gps_zeitstempelVon %>",operation:function(a){if(a>0&&DigiWebApp.SettingsController.getSetting("detailierteZeitdaten"))try{var b=M.Date.create(parseIntRadixTen(a));return M.I18N.l("gpszeitstempel_von")+
": "+b.format("dd.mm.yyyy HH:MM")}catch(c){return""}else return""}}}),gpszeitstempel_bis:M.LabelView.design({cssClass:"location unselectable",computedValue:{valuePattern:"<%= gps_zeitstempelBis %>",operation:function(a){if(a>0&&DigiWebApp.SettingsController.getSetting("detailierteZeitdaten"))try{var b=M.Date.create(parseIntRadixTen(a));return M.I18N.l("gpszeitstempel_bis")+": "+b.format("dd.mm.yyyy HH:MM")}catch(c){return""}else return""}}}),ServiceApp_Status:M.LabelView.design({cssClass:"location unselectable",
computedValue:{valuePattern:"<%= ServiceApp_Status %>",operation:function(a){return a!==null&&DigiWebApp.SettingsController.getSetting("detailierteZeitdaten")&&DigiWebApp.SettingsController.getSetting("debug")?"Status: "+a:""}}}),remark:M.LabelView.design({cssClass:"remark unselectable",computedValue:{valuePattern:"<%= remark %>",operation:function(a){return a?M.I18N.l("remark")+": "+a:""}}}),gefahreneKilometer:M.LabelView.design({cssClass:"remark",computedValue:{valuePattern:"<%= gefahreneKilometer %>",
operation:function(a){return a&&a>0?M.I18N.l("gefahreneKilometer")+": "+a:""}}})});m_require("app/views/TimeDataSentTemplateView");
DigiWebApp.TimeDataArchivePage=M.PageView.design({events:{pagebeforeshow:{target:DigiWebApp.BookingController,action:"setArchivedBookings"}},childViews:"header contentSent",cssClass:"timeDataPage unselectable",header:M.ToolbarView.design({childViews:"backButton title",cssClass:"header unselectable",isFixed:YES,backButton:M.ButtonView.design({value:M.I18N.l("back"),icon:"arrow-l",anchorLocation:M.LEFT,events:{tap:{target:DigiWebApp.NavigationController,action:function(){try{DigiWebApp.ApplicationController.vibrate()}catch(a){}this.backToTimeDataPage()}}}}),
title:M.LabelView.design({value:M.I18N.l("archivedTimeData"),anchorLocation:M.CENTER}),anchorLocation:M.TOP}),contentSent:M.ScrollView.design({childViews:"list",cssClass:"sentBookings",list:M.ListView.design({contentBinding:{target:DigiWebApp.BookingController,property:"timeDataSentArchived"},listItemTemplateView:DigiWebApp.TimeDataSentTemplateView})})});
DigiWebApp.TimeDataTemplateView=M.ListItemView.design({isSelectable:YES,childViews:"date order position activity latitude longitude genauigkeit_von eolVon erfassungsverfahren_von gpszeitstempel_von latitude_bis longitude_bis genauigkeit_bis eolBis erfassungsverfahren_bis gpszeitstempel_bis ServiceApp_Status remark gefahreneKilometer",events:{tap:{action:function(a,b){if(DigiWebApp.SettingsController.featureAvailable("403")||DigiWebApp.SettingsController.featureAvailable("405")&&typeof window.requestFileSystem!==
"undefined"){_.each(DigiWebApp.Booking.find(),function(c){if(c.m_id===b)DigiWebApp.EditTimeDataPage.bookingToEdit=c});DigiWebApp.NavigationController.toEditTimeDataPage()}}}},date:M.LabelView.design({cssClass:"date unselectable",computedValue:{valuePattern:"<%= date %>",operation:function(a){a=a.split(",");var b,c,d;if(typeof a[2]==="undefined"){b=new Date(Number(a[0]));b=M.Date.create(b.getTime());c=null;if(a[1]!=="0"){d=new Date(Number(a[1]));c=M.Date.create(d.getTime())}}else{b=new Date(Number(a[0])+
6E4*((new Date).getTimezoneOffset()-Number(a[2])));b=M.Date.create(b.getTime());c=null;if(a[1]!=="0"){d=new Date(Number(a[1])+6E4*((new Date).getTimezoneOffset()-Number(a[2])));c=M.Date.create(d.getTime())}}if(c){b=M.Date.create(b.format("mm/dd/yyyy HH:MM"));c=M.Date.create(c.format("mm/dd/yyyy HH:MM"));if(b.format("mm/dd/yyyy HH:MM")===c.format("mm/dd/yyyy HH:MM"))return a[3]+", "+a[4]+" - "+a[6]+" "+M.I18N.l("oclock")+", 00:01 h";else{d=b.timeBetween(c,M.MINUTES);d=d<1?M.Math.round(d,M.CEIL):M.Math.round(b.timeBetween(c,
M.MINUTES),M.FLOOR);if(d>59){b=M.Math.round(d/60,M.FLOOR);b=b<10?"0"+b:b;d=d%60;d=d<10?"0"+d:d;d=b+":"+d}else d="00:"+(d<10?"0":"")+d;return a[3]+", "+a[4]+" - "+a[6]+" "+M.I18N.l("oclock")+", "+d+" h"}}else return a[3]+", "+a[4]+" - "+M.I18N.l("open")}}}),order:M.LabelView.design({cssClass:"application unselectable",computedValue:{valuePattern:"<%= orderName %>",operation:function(a){var b=_.select(DigiWebApp.Order.findSorted().concat(DigiWebApp.HandOrder.findSorted()),function(d){if(d)return a==
d.get("id")||a==d.get("name")}),c=DigiWebApp.SettingsController.getSetting("DTC6aktiv")===YES?M.I18N.l("dtc6Ordner"):M.I18N.l("order");if(b&&b.length>0){b=b[0];return DigiWebApp.SettingsController.globalDebugMode?c+": "+b.get("name")+" ("+b.get("id")+")":c+": "+b.get("name")}else return c+": "+M.I18N.l("notDefined")}}}),position:M.LabelView.design({cssClass:"position unselectable",computedValue:{valuePattern:"<%= positionId %>",operation:function(a){var b=DigiWebApp.SettingsController.getSetting("DTC6aktiv")===
YES?M.I18N.l("dtc6Auftrag"):M.I18N.l("position");if(a){var c=_.select(DigiWebApp.Position.findSorted(),function(d){if(d)return a==d.get("id")});if(c&&c.length>0){c=c[0];return b+": "+c.get("name")}else return b+": "+M.I18N.l("notDefined")}else return b+": "+M.I18N.l("unknown")}}}),activity:M.LabelView.design({cssClass:"activity unselectable",computedValue:{valuePattern:"<%= activityId %>",operation:function(a){var b=DigiWebApp.SettingsController.getSetting("DTC6aktiv")===YES?M.I18N.l("dtc6Leistung"):
M.I18N.l("activity");if(a){var c=null;if(parseIntRadixTen(a)!==0)c=_.select(DigiWebApp.Activity.findSorted(),function(d){if(d)return a==d.get("id")});if(c&&c.length>0){c=c[0];return b+": "+c.get("name")}else return b+": "+M.I18N.l("notDefined")}else return b+": "+M.I18N.l("unknown")}}}),latitude:M.LabelView.design({cssClass:"location unselectable",isInline:YES,computedValue:{valuePattern:"<%= latitude %>",operation:function(a){if(a>0&&DigiWebApp.SettingsController.getSetting("detailierteZeitdaten")){a=
new Number(a);return M.I18N.l("vonKoordinate")+": "+a.toFixed(4)}else return""}}}),longitude:M.LabelView.design({cssClass:"location unselectable",isInline:YES,computedValue:{valuePattern:"<%= longitude %>",operation:function(a){return a>0&&DigiWebApp.SettingsController.getSetting("detailierteZeitdaten")?", "+(new Number(a)).toFixed(4):""}}}),genauigkeit_von:M.LabelView.design({cssClass:"location unselectable",isInline:YES,computedValue:{valuePattern:"<%= genauigkeitVon %>",operation:function(a){return a>
0&&DigiWebApp.SettingsController.getSetting("detailierteZeitdaten")?" ("+M.I18N.l("genauigkeit")+": "+a+" m)":""}}}),eolVon:M.LabelView.design({cssClass:"location unselectable",value:""}),latitude_bis:M.LabelView.design({cssClass:"location unselectable",isInline:YES,computedValue:{valuePattern:"<%= latitude_bis %>",operation:function(a){if(a>0&&DigiWebApp.SettingsController.getSetting("detailierteZeitdaten")){a=new Number(a);return M.I18N.l("bisKoordinate")+": "+a.toFixed(4)}else return""}}}),longitude_bis:M.LabelView.design({cssClass:"location unselectable",
isInline:YES,computedValue:{valuePattern:"<%= longitude_bis %>",operation:function(a){return a>0&&DigiWebApp.SettingsController.getSetting("detailierteZeitdaten")?", "+(new Number(a)).toFixed(4):""}}}),genauigkeit_bis:M.LabelView.design({cssClass:"location unselectable",isInline:YES,computedValue:{valuePattern:"<%= genauigkeitBis %>",operation:function(a){return a>0&&DigiWebApp.SettingsController.getSetting("detailierteZeitdaten")?" ("+M.I18N.l("genauigkeit")+": "+a+" m)":""}}}),eolBis:M.LabelView.design({cssClass:"location unselectable",
value:""}),erfassungsverfahren_von:M.LabelView.design({cssClass:"location unselectable",computedValue:{valuePattern:"<%= ermittlungsverfahrenVon %>",operation:function(a){return a!==null&&typeof a!=="undefined"&&a!=="undefined"&&DigiWebApp.SettingsController.getSetting("detailierteZeitdaten")?M.I18N.l("erfassungsverfahren_von")+": "+a.substring(0,16)+"...":""}}}),erfassungsverfahren_bis:M.LabelView.design({cssClass:"location unselectable",computedValue:{valuePattern:"<%= ermittlungsverfahrenBis %>",
operation:function(a){return a!==null&&typeof a!=="undefined"&&a!=="undefined"&&DigiWebApp.SettingsController.getSetting("detailierteZeitdaten")?M.I18N.l("erfassungsverfahren_bis")+": "+a.substring(0,16)+"...":""}}}),gpszeitstempel_von:M.LabelView.design({cssClass:"location unselectable",computedValue:{valuePattern:"<%= gps_zeitstempelVon %>",operation:function(a){if(a>0&&DigiWebApp.SettingsController.getSetting("detailierteZeitdaten"))try{var b=M.Date.create(parseIntRadixTen(a));return M.I18N.l("gpszeitstempel_von")+
": "+b.format("dd.mm.yyyy HH:MM")}catch(c){return""}else return""}}}),gpszeitstempel_bis:M.LabelView.design({cssClass:"location unselectable",computedValue:{valuePattern:"<%= gps_zeitstempelBis %>",operation:function(a){if(a>0&&DigiWebApp.SettingsController.getSetting("detailierteZeitdaten"))try{var b=M.Date.create(parseIntRadixTen(a));return M.I18N.l("gpszeitstempel_bis")+": "+b.format("dd.mm.yyyy HH:MM")}catch(c){return""}else return""}}}),ServiceApp_Status:M.LabelView.design({cssClass:"location unselectable",
computedValue:{valuePattern:"<%= ServiceApp_Status %>",operation:function(a){return a!==null&&DigiWebApp.SettingsController.getSetting("detailierteZeitdaten")&&DigiWebApp.SettingsController.getSetting("debug")?"Status: "+a:""}}}),remark:M.LabelView.design({cssClass:"remark unselectable",computedValue:{valuePattern:"<%= remark %>",operation:function(a){return a?M.I18N.l("remark")+": "+a:""}}}),gefahreneKilometer:M.LabelView.design({cssClass:"remark",computedValue:{valuePattern:"<%= gefahreneKilometer %>",
operation:function(a){return a&&a>0?M.I18N.l("gefahreneKilometer")+": "+a:""}}})});m_require("app/views/TimeDataTemplateView");m_require("app/views/TimeDataSentTemplateView");m_require("app/views/TimeDataSentDaysTemplateView");
DigiWebApp.TimeDataPage=M.PageView.design({events:{pagebeforeshow:{target:DigiWebApp.BookingController,action:"setNotBookedBookings"},pageshow:{action:function(){if(DigiWebApp.BookingController.timeData)DigiWebApp.BookingController.timeData.length!==0?$("#"+DigiWebApp.TimeDataPage.contentNotSent.id).show():$("#"+DigiWebApp.TimeDataPage.contentNotSent.id).hide();else $("#"+DigiWebApp.TimeDataPage.contentNotSent.id).hide();if(DigiWebApp.BookingController.timeDataSent)DigiWebApp.BookingController.timeDataSent.length!==
0?$("#"+DigiWebApp.TimeDataPage.contentSent.id).show():$("#"+DigiWebApp.TimeDataPage.contentSent.id).hide();else $("#"+DigiWebApp.TimeDataPage.contentSent.id).hide();if(DigiWebApp.BookingController.timeDataSentDays&&DigiWebApp.SettingsController.featureAvailable("411"))DigiWebApp.BookingController.timeDataSentDays.length!==0?$("#"+DigiWebApp.TimeDataPage.contentDays.id).show():$("#"+DigiWebApp.TimeDataPage.contentDays.id).hide();else $("#"+DigiWebApp.TimeDataPage.contentDays.id).hide();if(DigiWebApp.SettingsController.featureAvailable("416")){$("#"+
DigiWebApp.TimeDataPage.contentNotSent.list.id).addClass("scholppNotSent");$("#"+DigiWebApp.TimeDataPage.contentSent.list.id).addClass("scholppSent")}else{$("#"+DigiWebApp.TimeDataPage.contentNotSent.list.id).removeClass("scholppNotSent");$("#"+DigiWebApp.TimeDataPage.contentSent.list.id).removeClass("scholppSent")}DigiWebApp.ApplicationController.DigiLoaderView.hide()}}},childViews:"header contentNotSent contentSent contentDays",cssClass:"timeDataPage unselectable",header:M.ToolbarView.design({childViews:"backButton title",
cssClass:"header unselectable",isFixed:YES,backButton:M.ButtonView.design({value:M.I18N.l("back"),icon:"arrow-l",anchorLocation:M.LEFT,events:{tap:{target:DigiWebApp.NavigationController,action:function(){try{DigiWebApp.ApplicationController.vibrate()}catch(a){}this.backToDashboardPage()}}}}),title:M.LabelView.design({value:M.I18N.l("timeData"),anchorLocation:M.CENTER}),anchorLocation:M.TOP}),contentNotSent:M.ScrollView.design({childViews:"list",cssClass:"notSentBookings",list:M.ListView.design({contentBinding:{target:DigiWebApp.BookingController,
property:"timeData"},listItemTemplateView:DigiWebApp.TimeDataTemplateView})}),contentSent:M.ScrollView.design({childViews:"list",cssClass:"sentBookings",list:M.ListView.design({contentBinding:{target:DigiWebApp.BookingController,property:"timeDataSent"},listItemTemplateView:DigiWebApp.TimeDataSentTemplateView})}),contentDays:M.ScrollView.design({childViews:"list",cssClass:"sentBookings",list:M.ListView.design({contentBinding:{target:DigiWebApp.BookingController,property:"timeDataSentDays"},listItemTemplateView:DigiWebApp.TimeDataSentDaysTemplateView})})});
DigiWebApp.VorZurueckTabBar=M.TabBarView.design({childViews:"tabItemZurueck tabItemDayToShow tabItemVor",anchorLocation:M.BOTTOM,isFixed:YES,transition:M.TRANSITION.FADE,name:"vorzuruecktabbar",tabItemZurueck:M.TabBarItemView.design({value:M.I18N.l("backward"),page:"zeitbuchungenPage",icon:"arrow-l",switchPage:function(){try{DigiWebApp.ApplicationController.vibrate()}catch(a){}DigiWebApp.VorZurueckTabBar.backwardHandler()}}),tabItemDayToShow:M.TabBarItemView.design({value:"",page:"zeitbuchungenPage",
icon:""}),tabItemVor:M.TabBarItemView.design({value:M.I18N.l("forward"),page:"zeitbuchungenPage",icon:"arrow-r",switchPage:function(){try{DigiWebApp.ApplicationController.vibrate()}catch(a){}DigiWebApp.VorZurueckTabBar.forwardHandler()}}),backwardHandler:function(){DigiWebApp.ZeitbuchungenController.set("items",null);DigiWebApp.ZeitbuchungenController.items=null;DigiWebApp.ZeitbuchungenController.set("datum",D8.create(DigiWebApp.ZeitbuchungenController.datum).addDays(-1).format("dd.mm.yyyy"));DigiWebApp.ZeitbuchungenController.init(YES)},
forwardHandler:function(){DigiWebApp.ZeitbuchungenController.set("items",null);DigiWebApp.ZeitbuchungenController.items=null;DigiWebApp.ZeitbuchungenController.set("datum",D8.create(DigiWebApp.ZeitbuchungenController.datum).addDays(1).format("dd.mm.yyyy"));DigiWebApp.ZeitbuchungenController.init(YES)}});
DigiWebApp.ZeitbuchungDetailsPage=M.PageView.design({updateContent:function(){_.each(DigiWebApp.ZeitbuchungDetailsPage.content,function(a){try{a.id!==DigiWebApp.ZeitbuchungDetailsPage.content.infoButton.id&&a.id!==DigiWebApp.ZeitbuchungDetailsPage.content.showBookingCoordinatesInMapButton.id&&a.id!==DigiWebApp.ZeitbuchungDetailsPage.content.showPositionCoordinatesInMapButton.id&&a.renderUpdate()}catch(b){}})},cssClass:"zeitbuchungDetailsPage",childViews:"header content",header:M.ToolbarView.design({childViews:"backButton title",
cssClass:"header unselectable",isFixed:YES,backButton:M.ButtonView.design({value:M.I18N.l("back"),icon:"arrow-l",anchorLocation:M.LEFT,events:{tap:{target:DigiWebApp.NavigationController,action:"backToZeitbuchungenPageTransition"}}}),title:M.LabelView.design({value:M.I18N.l("Zeitbuchung"),anchorLocation:M.CENTER}),anchorLocation:M.TOP}),content:M.ScrollView.design({childViews:"datum von bis spacerNachBis dauer infoButton spacerNachButton order position handApplications activity activityPositionInWorkplan spacerNachActivityPositionInWorkplan remark farbeAmpel gpsBreite gpsLaenge showBookingCoordinatesInMapButton gpsBreitePosition gpsLaengePosition showPositionCoordinatesInMapButton",
cssClass:"content",datum:M.LabelView.design({computedValue:{value:"",operation:function(){if(DigiWebApp.ZeitbuchungenController.itemForDetails!==null)return DigiWebApp.ZeitbuchungenController.itemForDetails.get("datum")+", "}},isInline:YES,cssClass:"datum unselectable"}),von:M.LabelView.design({computedValue:{value:"",operation:function(){return DigiWebApp.ZeitbuchungenController.itemForDetails!==null?DigiWebApp.ZeitbuchungenController.itemForDetails.get("bis")===""||DigiWebApp.ZeitbuchungenController.itemForDetails.get("bis")===
"-"?M.I18N.l("since")+" "+DigiWebApp.ZeitbuchungenController.itemForDetails.get("von"):DigiWebApp.ZeitbuchungenController.itemForDetails.get("von"):""}},isInline:YES,cssClass:"von marginBottom20 unselectable"}),bis:M.LabelView.design({computedValue:{value:"",operation:function(){return DigiWebApp.ZeitbuchungenController.itemForDetails!==null?DigiWebApp.ZeitbuchungenController.itemForDetails.get("bis")!==""&&DigiWebApp.ZeitbuchungenController.itemForDetails.get("bis")!=="-"?" - "+DigiWebApp.ZeitbuchungenController.itemForDetails.get("bis"):
"":""}},isInline:YES,cssClass:"bis marginBottom20 unselectable"}),spacerNachBis:M.LabelView.design({value:" "}),dauer:M.LabelView.design({computedValue:{value:"",operation:function(){return DigiWebApp.ZeitbuchungenController.itemForDetails!==null?DigiWebApp.ZeitbuchungenController.itemForDetails.get("dauer")!==""&&DigiWebApp.ZeitbuchungenController.itemForDetails.get("dauer")!=="-"&&typeof DigiWebApp.ZeitbuchungenController.itemForDetails.get("dauer")!=="undefined"&&DigiWebApp.ZeitbuchungenController.itemForDetails.get("bis")!==
""&&DigiWebApp.ZeitbuchungenController.itemForDetails.get("bis")!=="-"?M.I18N.l("dauer")+": "+DigiWebApp.ZeitbuchungenController.itemForDetails.get("dauer"):"":""}},cssClass:"dauer unselectable"}),order:M.LabelView.design({computedValue:{value:"",operation:function(){var a=DigiWebApp.SettingsController.getSetting("DTC6aktiv")===YES?M.I18N.l("dtc6Ordner"):M.I18N.l("order");return DigiWebApp.ZeitbuchungenController.itemForDetails!==null?DigiWebApp.ZeitbuchungenController.itemForDetails.get("auftragsBezeichnung")!==
""&&typeof DigiWebApp.ZeitbuchungenController.itemForDetails.get("auftragsBezeichnung")!=="undefined"&&DigiWebApp.ZeitbuchungenController.itemForDetails.get("auftragsBezeichnung")!=="null"&&DigiWebApp.ZeitbuchungenController.itemForDetails.get("auftragsBezeichnung")!==null?a+": "+DigiWebApp.ZeitbuchungenController.itemForDetails.get("auftragsBezeichnung"):a+": -":a+": -"}},cssClass:"normalDetail marginLeft35 moveUp38 unselectable"}),position:M.LabelView.design({computedValue:{value:"",operation:function(){var a=
DigiWebApp.SettingsController.getSetting("DTC6aktiv")===YES?M.I18N.l("dtc6Auftrag"):M.I18N.l("position");return DigiWebApp.ZeitbuchungenController.itemForDetails!==null?DigiWebApp.ZeitbuchungenController.itemForDetails.get("positionsBezeichnung")!==""&&typeof DigiWebApp.ZeitbuchungenController.itemForDetails.get("positionsBezeichnung")!=="undefined"&&DigiWebApp.ZeitbuchungenController.itemForDetails.get("positionsBezeichnung")!=="null"&&DigiWebApp.ZeitbuchungenController.itemForDetails.get("positionsBezeichnung")!==
null?a+": "+DigiWebApp.ZeitbuchungenController.itemForDetails.get("positionsBezeichnung"):a+": -":a+": -"}},cssClass:"normalDetail marginLeft35 marginTop0 marginBottom10 unselectable"}),infoButton:M.ButtonView.design({computedValue:{value:"",operation:function(){return"?"}},anchorLocation:M.LEFT,cssClass:"posInfoButton",events:{tap:{target:DigiWebApp.NavigationController,action:"toOrderDetailsPageTransition"}},isInline:YES}),spacerNachButton:M.LabelView.design({value:" ",isInline:YES}),handApplications:M.LabelView.design({computedValue:{value:"",
operation:function(){return DigiWebApp.ZeitbuchungenController.itemForDetails!==null?DigiWebApp.ZeitbuchungenController.itemForDetails.get("handauftragsBezeichnung")!==""&&typeof DigiWebApp.ZeitbuchungenController.itemForDetails.get("handauftragsBezeichnung")!=="undefined"&&DigiWebApp.ZeitbuchungenController.itemForDetails.get("handauftragsBezeichnung")!=="null"&&DigiWebApp.ZeitbuchungenController.itemForDetails.get("handauftragsBezeichnung")!==null?M.I18N.l("handApplications")+": "+DigiWebApp.ZeitbuchungenController.itemForDetails.get("handauftragsBezeichnung"):
"":""}},cssClass:"normalDetail unselectable"}),activity:M.LabelView.design({computedValue:{value:"",operation:function(){return DigiWebApp.ZeitbuchungenController.itemForDetails!==null?DigiWebApp.ZeitbuchungenController.itemForDetails.get("taetigkeit")!==""&&typeof DigiWebApp.ZeitbuchungenController.itemForDetails.get("taetigkeit")!=="undefined"&&DigiWebApp.ZeitbuchungenController.itemForDetails.get("taetigkeit")!=="null"&&DigiWebApp.ZeitbuchungenController.itemForDetails.get("taetigkeit")!==null?
(DigiWebApp.SettingsController.getSetting("DTC6aktiv")===YES?M.I18N.l("dtc6Leistung"):M.I18N.l("activity"))+": "+DigiWebApp.ZeitbuchungenController.itemForDetails.get("taetigkeit"):"":""}},isInline:YES,cssClass:"normalDetail unselectable"}),activityPositionInWorkplan:M.LabelView.design({computedValue:{value:"",operation:function(){return DigiWebApp.ZeitbuchungenController.itemForDetails!==null?DigiWebApp.ZeitbuchungenController.itemForDetails.get("taetigkeitreihenfolge")!==""&&typeof DigiWebApp.ZeitbuchungenController.itemForDetails.get("taetigkeitreihenfolge")!==
"undefined"&&DigiWebApp.ZeitbuchungenController.itemForDetails.get("taetigkeitreihenfolge")!=="null"&&DigiWebApp.ZeitbuchungenController.itemForDetails.get("taetigkeitreihenfolge")!==null?" ("+DigiWebApp.ZeitbuchungenController.itemForDetails.get("taetigkeitreihenfolge")+")":"":""}},isInline:YES,cssClass:"normalDetail unselectable"}),spacerNachActivityPositionInWorkplan:M.LabelView.design({value:" "}),remark:M.LabelView.design({computedValue:{value:"",operation:function(){return DigiWebApp.ZeitbuchungenController.itemForDetails!==
null?DigiWebApp.ZeitbuchungenController.itemForDetails.get("remark")!==""&&typeof DigiWebApp.ZeitbuchungenController.itemForDetails.get("remark")!=="undefined"&&DigiWebApp.ZeitbuchungenController.itemForDetails.get("remark")!=="null"&&DigiWebApp.ZeitbuchungenController.itemForDetails.get("remark")!==null?M.I18N.l("remark")+": "+DigiWebApp.ZeitbuchungenController.itemForDetails.get("remark"):"":""}},cssClass:"normalDetail unselectable"}),gpsBreite:M.LabelView.design({computedValue:{value:"",operation:function(){if(DigiWebApp.ZeitbuchungenController.itemForDetails!==
null)if(DigiWebApp.ZeitbuchungenController.itemForDetails.get("gpsBreite")!==""&&typeof DigiWebApp.ZeitbuchungenController.itemForDetails.get("gpsBreite")!=="undefined"&&DigiWebApp.ZeitbuchungenController.itemForDetails.get("gpsBreite")!=="0.0"&&DigiWebApp.ZeitbuchungenController.itemForDetails.get("gpsBreite")!==0&&DigiWebApp.ZeitbuchungenController.itemForDetails.get("gpsBreite")!==null){$("#"+DigiWebApp.ZeitbuchungDetailsPage.content.showBookingCoordinatesInMapButton.id).show();var a=new Number(DigiWebApp.ZeitbuchungenController.itemForDetails.get("gpsBreite"));
return M.I18N.l("booking")+"-"+M.I18N.l("latitude")+": "+a.toFixed(6)}else{$("#"+DigiWebApp.ZeitbuchungDetailsPage.content.showBookingCoordinatesInMapButton.id).hide();return""}else{$("#"+DigiWebApp.ZeitbuchungDetailsPage.content.showBookingCoordinatesInMapButton.id).hide();return""}}},cssClass:"smallDetail marginTop12 unselectable"}),gpsLaenge:M.LabelView.design({computedValue:{value:"",operation:function(){if(DigiWebApp.ZeitbuchungenController.itemForDetails!==null)if(DigiWebApp.ZeitbuchungenController.itemForDetails.get("gpsLaenge")!==
""&&typeof DigiWebApp.ZeitbuchungenController.itemForDetails.get("gpsLaenge")!=="undefined"&&DigiWebApp.ZeitbuchungenController.itemForDetails.get("gpsLaenge")!=="0.0"&&DigiWebApp.ZeitbuchungenController.itemForDetails.get("gpsLaenge")!==0&&DigiWebApp.ZeitbuchungenController.itemForDetails.get("gpsLaenge")!==null){$("#"+DigiWebApp.ZeitbuchungDetailsPage.content.showBookingCoordinatesInMapButton.id).show();var a=new Number(DigiWebApp.ZeitbuchungenController.itemForDetails.get("gpsLaenge"));return M.I18N.l("booking")+
"-"+M.I18N.l("longitude")+": "+a.toFixed(6)}else{$("#"+DigiWebApp.ZeitbuchungDetailsPage.content.showBookingCoordinatesInMapButton.id).hide();return""}else{$("#"+DigiWebApp.ZeitbuchungDetailsPage.content.showBookingCoordinatesInMapButton.id).hide();return""}}},cssClass:"smallDetail unselectable"}),gpsBreitePosition:M.LabelView.design({computedValue:{value:"",operation:function(){if(DigiWebApp.ZeitbuchungenController.itemForDetails!==null)if(DigiWebApp.ZeitbuchungenController.itemForDetails.get("gpsBreitePosition")!==
""&&typeof DigiWebApp.ZeitbuchungenController.itemForDetails.get("gpsBreitePosition")!=="undefined"&&DigiWebApp.ZeitbuchungenController.itemForDetails.get("gpsBreitePosition")!=="0.0"&&DigiWebApp.ZeitbuchungenController.itemForDetails.get("gpsBreitePosition")!==0&&DigiWebApp.ZeitbuchungenController.itemForDetails.get("gpsBreitePosition")!==null){$("#"+DigiWebApp.ZeitbuchungDetailsPage.content.showPositionCoordinatesInMapButton.id).show();var a=new Number(DigiWebApp.ZeitbuchungenController.itemForDetails.get("gpsBreitePosition"));
return(DigiWebApp.SettingsController.getSetting("DTC6aktiv")===YES?M.I18N.l("dtc6Ordner"):M.I18N.l("order"))+"-"+M.I18N.l("latitude")+": "+a.toFixed(6)}else{$("#"+DigiWebApp.ZeitbuchungDetailsPage.content.showPositionCoordinatesInMapButton.id).hide();return""}else{$("#"+DigiWebApp.ZeitbuchungDetailsPage.content.showPositionCoordinatesInMapButton.id).hide();return""}}},cssClass:"smallDetail marginTop12 unselectable"}),gpsLaengePosition:M.LabelView.design({computedValue:{value:"",operation:function(){if(DigiWebApp.ZeitbuchungenController.itemForDetails!==
null)if(DigiWebApp.ZeitbuchungenController.itemForDetails.get("gpsLaengePosition")!==""&&typeof DigiWebApp.ZeitbuchungenController.itemForDetails.get("gpsLaengePosition")!=="undefined"&&DigiWebApp.ZeitbuchungenController.itemForDetails.get("gpsLaengePosition")!=="0.0"&&DigiWebApp.ZeitbuchungenController.itemForDetails.get("gpsLaengePosition")!==0&&DigiWebApp.ZeitbuchungenController.itemForDetails.get("gpsLaengePosition")!==null){$("#"+DigiWebApp.ZeitbuchungDetailsPage.content.showPositionCoordinatesInMapButton.id).show();
var a=new Number(DigiWebApp.ZeitbuchungenController.itemForDetails.get("gpsLaengePosition"));return(DigiWebApp.SettingsController.getSetting("DTC6aktiv")===YES?M.I18N.l("dtc6Ordner"):M.I18N.l("order"))+"-"+M.I18N.l("longitude")+": "+a.toFixed(6)}else{$("#"+DigiWebApp.ZeitbuchungDetailsPage.content.showPositionCoordinatesInMapButton.id).hide();return""}else{$("#"+DigiWebApp.ZeitbuchungDetailsPage.content.showPositionCoordinatesInMapButton.id).hide();return""}}},cssClass:"smallDetail unselectable"}),
farbeAmpel:M.LabelView.design({computedValue:{value:"",operation:function(){if(DigiWebApp.ZeitbuchungenController.itemForDetails!==null)if(DigiWebApp.ZeitbuchungenController.itemForDetails.get("farbeAmpel")!==""&&typeof DigiWebApp.ZeitbuchungenController.itemForDetails.get("farbeAmpel")!=="undefined"){var a=DigiWebApp.ZeitbuchungenController.itemForDetails.get("farbeAmpel");return M.I18N.l("geozoneTrafficlight")+': <span style="box-shadow: 2px 2px 6px rgba(0,0,0,0.6);background:'+a+";color:"+a+';margin-right: 5px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>'}else return"";
else return""}},cssClass:"normalDetail unselectable"}),showBookingCoordinatesInMapButton:M.ButtonView.design({computedValue:{value:"",operation:function(){return M.I18N.l("showBookingCoordinatesInMap")}},events:{tap:{action:function(){var a=DigiWebApp.ZeitbuchungenController.itemForDetails.get("gpsLaenge"),b=DigiWebApp.ZeitbuchungenController.itemForDetails.get("gpsBreite"),c="";if(!(a==="0.0"&&b==="0.0"||a===0&&b===0)){switch(DigiWebApp.SettingsController.getSetting("mapType")){case "OSM":DigiWebApp.SettingsController.featureAvailable("419")?
alert(M.I18N.l("showInMapScholpp")):alert(M.I18N.l("showInMapOSMAlert"));c="http://www.openstreetmap.org/index.html?mlat="+b+"&mlon="+a+"&zoom=15&layers=M";break;case "Bing":DigiWebApp.SettingsController.featureAvailable("419")?alert(M.I18N.l("showInMapScholpp")):alert(M.I18N.l("showInMapBingAlert"));c="http://www.bing.com/maps/default.aspx?rtp=adr.~pos."+b+"_"+a+"_&lvl=151";break;case "Google":DigiWebApp.SettingsController.featureAvailable("419")?alert(M.I18N.l("showInMapScholpp")):alert(M.I18N.l("showInMapGoogleAlert"));
c="http://maps.google.com/maps?q="+b+"+"+a+"&hl=de";break;default:c="disabled"}if(c!=="disabled")if(typeof plugins!=="undefined")if(typeof plugins.childBrowser!=="undefined"){try{plugins.childBrowser.close()}catch(d){alert("Error: "+d.message)}try{plugins.childBrowser.showWebPage(encodeURI(c),{showNavigationBar:true})}catch(e){alert("Error: "+e.message)}}else DigiWebApp.ApplicationController.inAppBrowser_var=window.open(c,"childBrowser","width=800,height=600,menubar=no,status=no,location=yes,copyhistory=no,directories=no");
else DigiWebApp.ApplicationController.inAppBrowser_var=window.open(c,"childBrowser","width=800,height=600,menubar=no,status=no,location=yes,copyhistory=no,directories=no")}}}}}),showPositionCoordinatesInMapButton:M.ButtonView.design({computedValue:{value:"",operation:function(){return M.I18N.l("showPositionCoordinatesInMap")}},events:{tap:{action:function(){var a=DigiWebApp.ZeitbuchungenController.itemForDetails.get("gpsLaengePosition"),b=DigiWebApp.ZeitbuchungenController.itemForDetails.get("gpsBreitePosition"),
c="";if(!(a==="0.0"&&b==="0.0"||a===0&&b===0)){switch(DigiWebApp.SettingsController.getSetting("mapType")){case "OSM":DigiWebApp.SettingsController.featureAvailable("419")?alert(M.I18N.l("showInMapScholpp")):alert(M.I18N.l("showInMapOSMAlert"));c="http://www.openstreetmap.org/index.html?mlat="+b+"&mlon="+a+"&zoom=15&layers=M";break;case "Bing":DigiWebApp.SettingsController.featureAvailable("419")?alert(M.I18N.l("showInMapScholpp")):alert(M.I18N.l("showInMapBingAlert"));c="http://www.bing.com/maps/default.aspx?rtp=adr.~pos."+
b+"_"+a+"_&lvl=151";break;case "Google":DigiWebApp.SettingsController.featureAvailable("419")?alert(M.I18N.l("showInMapScholpp")):alert(M.I18N.l("showInMapGoogleAlert"));c="http://maps.google.com/maps?q="+b+"+"+a+"&hl=de";break;default:c="disabled"}if(c!=="disabled")if(typeof plugins!=="undefined")if(typeof plugins.childBrowser!=="undefined"){try{plugins.childBrowser.close()}catch(d){alert("Error: "+d.message)}try{plugins.childBrowser.showWebPage(encodeURI(c),{showNavigationBar:true})}catch(e){alert("Error: "+
e.message)}}else DigiWebApp.ApplicationController.inAppBrowser_var=window.open(c,"childBrowser","width=800,height=600,menubar=no,status=no,location=yes,copyhistory=no,directories=no");else DigiWebApp.ApplicationController.inAppBrowser_var=window.open(c,"childBrowser","width=800,height=600,menubar=no,status=no,location=yes,copyhistory=no,directories=no")}}}}})})});
DigiWebApp.ZeitbuchungenTemplateView=M.ListItemView.design({isSelectable:YES,childViews:"datum von bis dauer spacer2 auftragsBezeichnung positionsBezeichnung handauftragsBezeichnung taetigkeit bemerkung gpsBreite gpsLaenge gpsBreitePosition gpsLaengePosition",events:{tap:{action:function(a){if(DigiWebApp.SettingsController.featureAvailable("408")){var b=NO,c=M.ViewManager.getViewById(a).modelId;_.each(DigiWebApp.ZeitbuchungenController.items,function(d){if(d.m_id===c){b=YES;DigiWebApp.ZeitbuchungenController.set("itemForDetails",
d);DigiWebApp.ZeitbuchungDetailsPage.updateContent()}});b===YES&&DigiWebApp.NavigationController.toZeitbuchungDetailsPageTransition()}}}},spacer1:M.LabelView.design({value:" "}),spacer2:M.LabelView.design({value:" "}),auftragsBezeichnung:M.LabelView.design({cssClass:"normal unselectable",computedValue:{valuePattern:"<%= auftragsBezeichnung %>",operation:function(a){return a!==""&&typeof a!=="undefined"&&a!=="undefined"&&a!=="null"&&a!==null?(DigiWebApp.SettingsController.getSetting("DTC6aktiv")===
YES?M.I18N.l("dtc6Ordner"):M.I18N.l("order"))+": "+a:""}}}),auftragsId:M.LabelView.design({cssClass:"normal unselectable",computedValue:{valuePattern:"<%= auftragsId %>",operation:function(a){return a}}}),bis:M.LabelView.design({cssClass:"bold unselectable",isInline:YES,computedValue:{valuePattern:"<%= bis %>",operation:function(a){return a!=="-"?a:M.I18N.l("now")}}}),datum:M.LabelView.design({cssClass:"bold unselectable",isInline:YES,computedValue:{valuePattern:"<%= datum %>",operation:function(a){return a!==
"-"?a:""}}}),dauer:M.LabelView.design({cssClass:"normal unselectable",isInline:YES,computedValue:{valuePattern:"<%= dauer %>",operation:function(a){return a!=="00:00"&&a!=="-"&&a!=="null"&&a!==null?" ("+a+")":""}}}),farbeAmpel:M.LabelView.design({cssClass:"normal unselectable",computedValue:{valuePattern:"<%= farbeAmpel %>",operation:function(a){return a}}}),gpsBreite:M.LabelView.design({cssClass:"normal unselectable",computedValue:{valuePattern:"<%= gpsBreite %>",operation:function(a){if(a!="0.0"&&
a!=="null"&&a!==null&&DigiWebApp.SettingsController.featureAvailable("408")){a=new Number(a);return M.I18N.l("latitude")+": "+a.toFixed(6)}else return""}}}),gpsBreitePosition:M.LabelView.design({cssClass:"normal unselectable",computedValue:{valuePattern:"<%= gpsBreitePosition %>",operation:function(a){if(a!="0.0"&&a!=="null"&&a!==null&&DigiWebApp.SettingsController.featureAvailable("408")){a=new Number(a);return M.I18N.l("position")+"-"+M.I18N.l("latitude")+": "+a.toFixed(6)}else return""}}}),gpsLaenge:M.LabelView.design({cssClass:"normal unselectable",
computedValue:{valuePattern:"<%= gpsLaenge %>",operation:function(a){if(a!="0.0"&&a!=="null"&&a!==null&&DigiWebApp.SettingsController.featureAvailable("408")){a=new Number(a);return M.I18N.l("longitude")+": "+a.toFixed(6)}else return""}}}),gpsLaengePosition:M.LabelView.design({cssClass:"normal unselectable",computedValue:{valuePattern:"<%= gpsLaengePosition %>",operation:function(a){if(a!="0.0"&&a!=="null"&&a!==null&&DigiWebApp.SettingsController.featureAvailable("408")){a=new Number(a);return M.I18N.l("position")+
"-"+M.I18N.l("longitude")+": "+a.toFixed(6)}else return""}}}),handauftragsBezeichnung:M.LabelView.design({cssClass:"normal unselectable",computedValue:{valuePattern:"<%= handauftragsBezeichnung %>",operation:function(a){return a!==""&&typeof a!=="undefined"&&a!=="undefined"&&a!=="null"&&a!==null?M.I18N.l("handApplications")+": "+a:""}}}),handauftragsId:M.LabelView.design({cssClass:"normal unselectable",computedValue:{valuePattern:"<%= handauftragsId %>",operation:function(a){return a}}}),mitarbeiterId:M.LabelView.design({cssClass:"normal unselectable",
computedValue:{valuePattern:"<%= mitarbeiterId %>",operation:function(a){return a}}}),name:M.LabelView.design({cssClass:"normal unselectable",computedValue:{valuePattern:"<%= name %>",operation:function(a){return a}}}),nameVorname:M.LabelView.design({cssClass:"normal unselectable",computedValue:{valuePattern:"<%= nameVorname %>",operation:function(a){return a}}}),positionsBezeichnung:M.LabelView.design({cssClass:"normal unselectable",computedValue:{valuePattern:"<%= positionsBezeichnung %>",operation:function(a){return a!==
""&&typeof a!=="undefined"&&a!=="undefined"&&a!=="null"&&a!==null?(DigiWebApp.SettingsController.getSetting("DTC6aktiv")===YES?M.I18N.l("dtc6Auftrag"):M.I18N.l("position"))+": "+a:""}}}),positionsId:M.LabelView.design({cssClass:"normal unselectable",computedValue:{valuePattern:"<%= positionsId %>",operation:function(a){return a}}}),taetigkeit:M.LabelView.design({cssClass:"normal unselectable",computedValue:{valuePattern:"<%= taetigkeit %>",operation:function(a){return a!==""&&typeof a!=="undefined"&&
a!=="undefined"&&a!=="null"&&a!==null?(DigiWebApp.SettingsController.getSetting("DTC6aktiv")===YES?M.I18N.l("dtc6Leistung"):M.I18N.l("activity"))+": "+a:""}}}),bemerkung:M.LabelView.design({cssClass:"normal unselectable",computedValue:{valuePattern:"<%= remark %>",operation:function(a){return a!==""&&typeof a!=="undefined"&&a!=="undefined"&&a!=="null"&&a!==null?M.I18N.l("remark")+": "+a:""}}}),taetigkeitsId:M.LabelView.design({cssClass:"normal unselectable",computedValue:{valuePattern:"<%= taetigkeitsId %>",
operation:function(a){return a}}}),taetigkeitsart:M.LabelView.design({cssClass:"normal unselectable",computedValue:{valuePattern:"<%= taetigkeitsart %>",operation:function(a){return a}}}),von:M.LabelView.design({cssClass:"bold unselectable",isInline:YES,computedValue:{valuePattern:"<%= von %>",operation:function(a){return" "+a+" - "}}}),vorname:M.LabelView.design({cssClass:"normal unselectable",computedValue:{valuePattern:"<%= vorname %>",operation:function(a){return a}}})});m_require("app/views/ZeitbuchungenTemplateView");
m_require("app/views/VorZurueckTabBar.js");
DigiWebApp.ZeitbuchungenPage=M.PageView.design({events:{pageshow:{target:DigiWebApp.ZeitbuchungenController,action:"init"}},childViews:"header content tabBar",cssClass:"zeitbuchungenPage unselectable",header:M.ToolbarView.design({childViews:"backButton title",cssClass:"header unselectable",isFixed:YES,backButton:M.ButtonView.design({value:M.I18N.l("back"),icon:"arrow-l",anchorLocation:M.LEFT,events:{tap:{target:DigiWebApp.NavigationController,action:function(){try{DigiWebApp.ApplicationController.vibrate()}catch(a){}DigiWebApp.ZeitbuchungenController.backFunction()}}}}),title:M.LabelView.design({value:M.I18N.l("Zeitbuchungen"),
anchorLocation:M.CENTER}),anchorLocation:M.TOP}),content:M.ScrollView.design({childViews:"list",list:M.ListView.design({contentBinding:{target:DigiWebApp.ZeitbuchungenController,property:"items"},listItemTemplateView:DigiWebApp.ZeitbuchungenTemplateView})}),tabBar:DigiWebApp.VorZurueckTabBar});var logDelete=true,logSave=true,logDesign=false;function parseBool(a){return a==="YES"?YES:a===YES?YES:a==="true"?YES:a===true?YES:a==="NO"?NO:a===NO?NO:a==="false"?NO:a===false?NO:a>0?YES:NO}
function parseIntRadixTen(a){return parseInt(a,10)}function isGUID(a){return/^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}$/.test(a)}Number.prototype.padLeft=function(a,b){return(this<0?"-":"")+Array(a-String(Math.abs(this)).length+1).join(b||"0")+Math.abs(this)};function bulkClearInterval(a){for(var b=0;b<=a;b++)clearInterval(b)}window.timeoutList=[];window.intervalList=[];window.oldSetTimeout=window.setTimeout;window.oldSetInterval=window.setInterval;
window.oldClearTimeout=window.clearTimeout;window.oldClearInterval=window.clearInterval;window.setTimeout=function(a,b){var c=window.oldSetTimeout(a,b);window.timeoutList.push(c);return c};window.clearTimeout=function(a){var b=window.timeoutList.indexOf(a);b>=0&&window.timeoutList.splice(b,1);return window.oldClearTimeout(a)};window.setInterval=function(a,b){var c=window.oldSetInterval(a,b);window.intervalList.push(c);return c};
window.clearInterval=function(a){var b=window.intervalList.indexOf(a);b>=0&&window.intervalList.splice(b,1);return window.oldClearInterval(a)};window.clearAllTimeouts=function(){for(var a in window.timeoutList)window.oldClearTimeout(window.timeoutList[a]);window.timeoutList=[]};window.clearAllIntervals=function(){for(var a in window.intervalList)window.oldClearInterval(window.intervalList[a]);window.intervalList=[]};
function addToListIfNotFoundById(a,b,c){_.find(a,function(d){return typeof d.get==="function"?parseIntRadixTen(d.get("id"))===parseIntRadixTen(c):parseIntRadixTen(d.id)===parseIntRadixTen(c)})||a.push(b);return a}if(window.console){if(window.console.logLevel)window.console.logLevel=3}else window.console={log:function(){}};function toIntArray(a){var b=[];if(typeof a=="object"&&a.length>0)b=_.map(a,function(c){c=parseIntRadixTen(c);if(!isNaN(c))return c});return _.compact(b)}
function setTestLogin(){$("#"+DigiWebApp.SettingsPage.content.companyGrid.companyInput.id).val("312");$("#"+DigiWebApp.SettingsPage.content.passwordGrid.passwordInput.id).val("stuttgart11");$("#"+DigiWebApp.SettingsPage.content.connectionCodeGrid.connectionCodeInput.id).val("digi$");$("#"+DigiWebApp.SettingsPage.content.workerIdGrid.workerIdInput.id).val("1");DigiWebApp.SettingsController.save()}var newAppVersionAvailable=NO;M.Application.useTransitions=NO;
var DigiWebApp=DigiWebApp||{app:null},logQueue=[],logQueueIntervalId=null,logQueueInterval=500,logQueueIntervalRefreshInterval=6E4;function initLogQueueInterval(){if(logQueueInterval>0&&!logQueueIntervalId)logQueueIntervalId=window.setInterval(queuedLogWriter,logQueueInterval)}function deactivateLogQueueInterval(){if(logQueueIntervalId)try{logQueueIntervalId=window.clearInterval(logQueueIntervalId)}catch(a){}}
function refreshLogQueueInterval(){var a=logQueueInterval;if(DigiWebApp&&DigiWebApp.SettingsController){var b=parseIntRadixTen(DigiWebApp.SettingsController.getSetting("logWriterInterval"));if(b)a=b}else for(b=0;b<localStorage.length;b++){var c=localStorage.key(b);if(RegExp("^"+M.LOCAL_STORAGE_PREFIX+M.Application.name+M.LOCAL_STORAGE_SUFFIX+"Settings_").exec(c))if((c=JSON.parse(localStorage.getItem(c)))&&c.logWriterInterval)a=parseIntRadixTen(c.logWriterInterval)}if(a!=logQueueInterval){logQueueInterval=
a;deactivateLogQueueInterval();initLogQueueInterval()}}var logQueueIntervalRefreshIntervalId=window.setInterval(refreshLogQueueInterval,logQueueIntervalRefreshInterval);function flushLogQueueAndExit(){deactivateLogQueueInterval();if(logQueue.length>0){var a=logQueue.shift();writeToLogFromQueue(a,function(){flushLogQueueAndExit()})}else typeof navigator!="undefined"&&typeof navigator.app!="undefined"&&typeof navigator.app.exitApp!="undefined"&&navigator.app.exitApp()}
function queuedLogWriter(){if(logQueue.length>0){var a=logQueue.shift();deactivateLogQueueInterval();writeToLogFromQueue(a,function(){queuedLogWriter()})}else initLogQueueInterval()}initLogQueueInterval();
function writeToLog(a,b){var c=new Date,d="";d=typeof a==="string"?a:JSON.stringify(a);d="\n----------------------------------------------------------\n"+c.getFullYear()+"-"+("0"+(c.getMonth()+1)).slice(-2)+"-"+("0"+c.getDate()).slice(-2)+" "+("0"+c.getHours()).slice(-2)+":"+("0"+c.getMinutes()).slice(-2)+":"+("0"+c.getSeconds()).slice(-2)+"."+("0"+c.getMilliseconds()).slice(-2)+" "+d+"\n";console.log(d.toString());logQueueInterval>0&&logQueue.push({content:d,timestamp:c});typeof b=="function"&&b()}
function writeToLogFromQueue(a,b,c){var d;d=typeof b!=="function"?function(){}:b;var e;e=typeof c!=="function"?d:c;try{var f=a.content,g=a.timestamp,i=g.getFullYear()+"-"+("0"+(g.getMonth()+1)).slice(-2)+"-"+("0"+g.getDate()).slice(-2)+"_DIGI-WebApp.log.txt";if(typeof window.requestFileSystem=="undefined"&&typeof navigator.webkitPersistentStorage=="undefined"){d("no filesystem available");return true}var h=DigiWebApp.ApplicationController.CONSTApplicationQuota;typeof navigator.webkitPersistentStorage!==
"undefined"?navigator.webkitPersistentStorage.requestQuota(h,function(l){window.requestFileSystem(PERSISTENT,l,function(n){n.root.getDirectory("DIGIWebAppLogs",{create:true,exclusive:false},function(m){m.getFile(i,{create:true,exclusive:false},function(o){o.createWriter(function(p){p.onerror=function(r){console.error("[writeToLog]: writeError",r);e(r)};p.onwriteend=function(r){d(r)};var q=new Blob([f],{type:"text/plain"});p.seek(p.length);p.write(q)},e)},e)},e)},e)},function(l){console.error("[writeToLog]: Error while requesting Quota",
l);DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("error"),message:M.I18N.l("errorWhileRequestingQuota")+": "+err})}):window.requestFileSystem(LocalFileSystem.PERSISTENT,0,function(l){l.root.getDirectory("DIGIWebAppLogs",{create:true,exclusive:false},function(n){n.getFile(i,{create:true,exclusive:false},function(m){m.createWriter(function(o){o.onerror=function(p){console.error("[writeToLog]: writeError",p);e(p)};o.onwriteend=function(p){d(p)};o.seek(o.length);o.write(f.toString())},
e)},e)},e)},e)}catch(j){typeof e!="function"?alert("Die Protokollierung ist defekt! Bitte starten Sie die App neu und informieren DIGI-ZEITERFASSUNG GmbH!"):e(j)}}function trackError(a,b){try{console.error(a);typeof a.stack!=="undefined"&&console.log(a.stack);writeToLog(typeof a==="string"?"Exception "+a:"Exception "+a.name+": "+a.message+"\nStack: "+a.stack,b)}catch(c){}return true}window.onerror=function(a,b,c){writeToLog("window.onerror: "+a+"\nURL: "+b+"\nLine Number: "+c);return true};
var jQueryBind=jQuery.fn.bind;jQuery.fn.bind=function(a,b,c){c=c;b=b;if(!c&&b&&typeof b=="function"){c=b;b=null}if(c){var d=c;c=function(){try{d.apply(this,arguments)}catch(e){trackError(e)}}}return jQueryBind.call(this,a,b,c)};(function(a){a.fn.classes=function(b){var c=[];a.each(this,function(e,f){var g=f.className.split(/\s+/),i;for(i in g){var h=g[i];-1===c.indexOf(h)&&c.push(h)}});if("function"===typeof b)for(var d in c)b(c[d]);return c}})(jQuery);var globalFileSystem=null;
function getFS(a,b){var c;c=typeof a!=="function"?function(){}:a;var d;d=typeof b!=="function"?function(){}:b;if(globalFileSystem!=null){a(globalFileSystem);return true}if(typeof window.requestFileSystem=="undefined"&&typeof navigator.webkitPersistentStorage=="undefined"){d();return false}try{var e=DigiWebApp.ApplicationController.CONSTApplicationQuota;typeof navigator.webkitPersistentStorage!=="undefined"?navigator.webkitPersistentStorage.requestQuota(e,function(g){window.requestFileSystem(PERSISTENT,
g,function(i){c(i)},d)},function(g){console.error("Error while requesting Quota",g);DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("error"),message:M.I18N.l("errorWhileRequestingQuota")+": "+err})}):window.requestFileSystem(LocalFileSystem.PERSISTENT,0,function(g){c(g)},d)}catch(f){d(f)}}
function getDir(a,b,c){var d;d=typeof b!=="function"?function(){}:b;var e;e=typeof c!=="function"?function(){}:c;if(typeof window.requestFileSystem=="undefined"&&typeof navigator.webkitPersistentStorage=="undefined"){e();return false}try{getFS(function(g){g.root.getDirectory(a,{create:true,exclusive:false},function(i){d(i)},e)})}catch(f){e(f)}}var globalDataDir=null;
function getDataDir(a,b){if(globalDataDir!=null&&typeof a=="function"){a(globalDataDir);return true}getDir("DIGIWebAppData",function(c){globalDataDir=c;a(c)},b)}var globalLogDir=null;function getLogDir(a,b){if(globalLogDir!=null&&typeof a=="function"){a(globalLogDir);return true}getDir("DIGIWebAppLogs",function(c){globalLogDir=c;a(c)},b)}
function autoCleanLogs(a,b){var c;c=typeof a!=="function"?function(){}:a;if(typeof window.requestFileSystem=="undefined"&&typeof navigator.webkitPersistentStorage=="undefined"){c();return true}getLogDir(function(d){autoCleanLogFilesFromDirectory(d,a,b)})}
function autoCleanLogFilesFromDirectory(a,b,c){var d;d=typeof b!=="function"?function(){}:b;b=typeof c!=="function"?function(){}:c;if(typeof a!="object"||typeof a.createReader!="function")return b();a.createReader().readEntries(function(e){var f=[],g=[],i=parseIntRadixTen(DigiWebApp.SettingsController.getSetting("daysToHoldBookingsOnDevice")),h=parseIntRadixTen(D8.create().addDays(-i).format("yyyymmdd"));writeToLog("removing logfiles older than "+h+" (older than "+i+" days)",function(){_.each(e,function(m){if(m.name.substr(10)==
"_DIGI-WebApp.log.txt"){var o=false;o=m.name.substr(0,4);var p=m.name.substr(5,2),q=m.name.substr(8,2);if(o=parseIntRadixTen(o+p+q)<h){f.push(m);g.push(m.name)}}});var j=0,l=f.length;if(l>0){var n="";if(l>1)n="s";writeToLog("removing "+l+" logfile"+n+":\n"+g.join("\n"),function(){var m=function(){++j>=l&&d()},o=function(p){console.error("[autoCleanLogFilesFromDirectory error] ",p);m()};_.each(f,function(p){p.remove(m,o)})})}else d()})})}
function createFile(a,b){var c=function(d){console.error(d)};getFS(function(d){d.root.getDirectory(a,{create:true,exclusive:false},function(e){e.getFile(b,{create:true,exclusive:false},function(){console.log("file "+a+"/"+b+" created")},c)},c)})}function cat(a){var b=function(c){console.error(c)};getFS(function(c){c.root.getFile(a,{},function(d){d.file(function(e){var f=new FileReader;f.onloadend=function(){console.log(this.result)};f.readAsText(e)},b)},b)})}
function appendFile(a){var b=function(c){console.error(c)};getFS(function(c){c.root.getFile(a,{},function(d){d.createWriter(function(e){e.onerror=function(f){console.error(f)};e.onwriteend=function(f){console.log("successfully written to file");successCallback(f)};e.seek(e.length);e.write(writeContent.toString())},errorCallback)},b)})}function rm(a){var b=function(c){console.error(c)};getFS(function(c){c.root.getFile(a,{},function(d){d.remove(function(){console.log(a+" removed")},b)},b)})}
function ls(a){var b=function(c){console.error(c)};getDir(a,function(c){c.createReader().readEntries(function(d){_.each(d,function(e){console.log(e.name)})},b)})}
if(typeof localStorage!=="undefined"){var reloadAppOneMoreTime=localStorage.getItem("reloadAppOneMoreTime");if(reloadAppOneMoreTime!==null){localStorage.removeItem("reloadAppOneMoreTime");window.applicationCache&&window.applicationCache.status==window.applicationCache.UPDATEREADY&&window.applicationCache.swapCache();if(typeof navigator.app!=="undefined")typeof location.origin!=="undefined"?navigator.app.loadUrl(location.origin+location.pathname):navigator.app.loadUrl(location.protocol+"//"+location.pathname);
else window.location.reload()}}
$(window).bind("load",function(){window.applicationCache&&$(window.applicationCache).bind("updateready",function(){if(window.applicationCache.status==window.applicationCache.UPDATEREADY){console.log("Browser downloaded a new app cache");window.newAppVersionAvailable=YES;if(confirm(M.I18N.l("applicationUpdateAvailableMsg")+"\n\n"+DigiWebApp.app.config.version))try{window.applicationCache.swapCache();typeof localStorage!=="undefined"&&localStorage.setItem("reloadAppOneMoreTime","true");if(typeof navigator.app!==
"undefined")typeof location.origin!=="undefined"?navigator.app.loadUrl(location.origin+location.pathname):navigator.app.loadUrl(location.protocol+"//"+location.pathname);else window.location.reload()}catch(a){console.log(a)}else{DigiWebApp.NavigationController.toSplashViewPageTransition();DigiWebApp.NavigationController.toDashboardPage()}}})});var gefundeneFreischaltungen=[];
function searchForFeature(a){if(gefundeneFreischaltungen.length===0)for(var b=0;b<localStorage.length;b++){var c=localStorage.key(b);if(RegExp("^"+M.LOCAL_STORAGE_PREFIX+M.Application.name+M.LOCAL_STORAGE_SUFFIX+"Features_").exec(c)){c=JSON.parse(localStorage.getItem(c));gefundeneFreischaltungen.push(c)}}b=_.filter(gefundeneFreischaltungen,function(d){return d.id==a});if(b.length!=0)return b[0].isAvailable=="true";return false}
if(localStorage){var language=null;language=localStorage.getItem(M.LOCAL_STORAGE_PREFIX+M.Application.name+M.LOCAL_STORAGE_SUFFIX+"lang");language===null&&localStorage.setItem(M.LOCAL_STORAGE_PREFIX+M.Application.name+M.LOCAL_STORAGE_SUFFIX+"lang","de_de")}
var DigiWebAppBlackBerryDesign={entryPage:"splashView",splashView:DigiWebApp.SplashViewPage},DigiWebAppOrdinaryDesign={entryPage:"splashView",splashView:DigiWebApp.SplashViewPage,dashboard:DigiWebApp.DashboardPage,bookingPage:DigiWebApp.BookingPage,settingsPage:DigiWebApp.SettingsPage,settingsPasswordPage:DigiWebApp.SettingsPasswordPage,timeDataPage:DigiWebApp.TimeDataPage,employeePage:DigiWebApp.EmployeePage,infoPage:DigiWebApp.InfoPage};
if(searchForFeature(400)){DigiWebAppOrdinaryDesign.mediaListPage=DigiWebApp.MediaListPage;DigiWebAppOrdinaryDesign.cameraPage=DigiWebApp.CameraPage;DigiWebAppOrdinaryDesign.editPicturePage=DigiWebApp.EditPicturePage;DigiWebAppOrdinaryDesign.fileChooserPage=DigiWebApp.FileChooserPage}
if(searchForFeature(401)){DigiWebAppOrdinaryDesign.mediaListPage=DigiWebApp.MediaListPage;DigiWebAppOrdinaryDesign.audioPage=DigiWebApp.AudioPage;DigiWebAppOrdinaryDesign.demoaudioPage=DigiWebApp.DemoAudioPage;DigiWebAppOrdinaryDesign.demomediaPage=DigiWebApp.DemoMediaPage;DigiWebAppOrdinaryDesign.fileChooserPage=DigiWebApp.FileChooserPage}searchForFeature(402);
if(searchForFeature(403)&&!searchForFeature(409)){DigiWebAppOrdinaryDesign.editTimeDataPage=DigiWebApp.EditTimeDataPage;DigiWebAppOrdinaryDesign.remarkPage=DigiWebApp.RemarkPage}if(searchForFeature(404))DigiWebAppOrdinaryDesign.buttonsDashboard=DigiWebApp.ButtonDashboardPage;if(searchForFeature(405)&&!searchForFeature(409))DigiWebAppOrdinaryDesign.editTimeDataPage=DigiWebApp.EditTimeDataPage;if(searchForFeature(406)&&!searchForFeature(409))DigiWebAppOrdinaryDesign.orderInfoPage=DigiWebApp.OrderInfoPage;
if(searchForFeature(407))DigiWebAppOrdinaryDesign.studieChecklistePage=DigiWebApp.StudieChecklistePage;if(searchForFeature(408)){DigiWebAppOrdinaryDesign.anwesenheitslistePage=DigiWebApp.AnwesenheitslistePage;DigiWebAppOrdinaryDesign.zeitbuchungenPage=DigiWebApp.ZeitbuchungenPage;DigiWebAppOrdinaryDesign.zeitbuchungDetailsPage=DigiWebApp.ZeitbuchungDetailsPage;DigiWebAppOrdinaryDesign.orderDetailsPage=DigiWebApp.OrderDetailsPage}if(searchForFeature(409)){try{delete DigiWebAppOrdinaryDesign.timeDataPage}catch(e3$$59){}try{delete DigiWebAppOrdinaryDesign.employeePage}catch(e4$$38){}try{delete DigiWebAppOrdinaryDesign.handOrderPage}catch(e5$$14){}}
if(!searchForFeature(410)&&!searchForFeature(409))DigiWebAppOrdinaryDesign.handOrderPage=DigiWebApp.HandOrderPage;if(searchForFeature(411)&&!searchForFeature(409)){DigiWebAppOrdinaryDesign.timeDataArchivePage=DigiWebApp.TimeDataArchivePage;DigiWebAppOrdinaryDesign.zeitbuchungenPage=DigiWebApp.ZeitbuchungenPage}
if(searchForFeature(412)||searchForFeature(402)||searchForFeature(426)){DigiWebAppOrdinaryDesign.bautagebuchBautagesberichteListePage=DigiWebApp.BautagebuchBautagesberichteListePage;DigiWebAppOrdinaryDesign.bautagebuchBautagesberichtDetailsPage=DigiWebApp.BautagebuchBautagesberichtDetailsPage;DigiWebAppOrdinaryDesign.bautagebuchMaterialienListePage=DigiWebApp.BautagebuchMaterialienListePage;DigiWebAppOrdinaryDesign.bautagebuchMaterialienDetailsPage=DigiWebApp.BautagebuchMaterialienDetailsPage;DigiWebAppOrdinaryDesign.bautagebuchMedienListePage=
DigiWebApp.BautagebuchMedienListePage;DigiWebAppOrdinaryDesign.bautagebuchMedienDetailsPage=DigiWebApp.BautagebuchMedienDetailsPage;DigiWebAppOrdinaryDesign.bautagebuchNotizenListePage=DigiWebApp.BautagebuchNotizenListePage;DigiWebAppOrdinaryDesign.bautagebuchNotizenDetailsPage=DigiWebApp.BautagebuchNotizenDetailsPage;DigiWebAppOrdinaryDesign.bautagebuchZeitenListePage=DigiWebApp.BautagebuchZeitenListePage;DigiWebAppOrdinaryDesign.bautagebuchZeitenDetailsPage=DigiWebApp.BautagebuchZeitenDetailsPage;
DigiWebAppOrdinaryDesign.bautagebuchEinstellungenPage=DigiWebApp.BautagebuchEinstellungenPage;DigiWebAppOrdinaryDesign.bautagebuchWetterPage=DigiWebApp.BautagebuchWetterPage;DigiWebAppOrdinaryDesign.bautagebuchZusammenfassungPage=DigiWebApp.BautagebuchZusammenfassungPage;DigiWebAppOrdinaryDesign.fileChooserPage=DigiWebApp.FileChooserPage;DigiWebAppOrdinaryDesign.bautagebuchMitarbeiterAuswahlPage=DigiWebApp.BautagebuchMitarbeiterAuswahlPage}
if((searchForFeature(416)||searchForFeature(424))&&!searchForFeature(409))DigiWebAppOrdinaryDesign.bookingPageWithIconsScholpp=DigiWebApp.BookingPageWithIconsScholpp;if(searchForFeature(418))DigiWebAppOrdinaryDesign.spesenPage=DigiWebApp.SpesenPage;if(searchForFeature(422)){DigiWebAppOrdinaryDesign.editTimeDataPage=DigiWebApp.EditTimeDataPage;DigiWebAppOrdinaryDesign.remarkPage=DigiWebApp.RemarkPage}if(searchForFeature(423))DigiWebAppOrdinaryDesign.terminlistePage=DigiWebApp.TerminlistePage;
if(searchForFeature(425))DigiWebAppOrdinaryDesign.festePauseStornierenPage=DigiWebApp.FestePauseStornierenPage;searchForFeature(426);if(searchForFeature(427))DigiWebAppOrdinaryDesign.activityListPage=DigiWebApp.ActivityListPage;var restartOnBlackBerry=true;if(navigator.platform==="BlackBerry"&&restartOnBlackBerry)if(navigator.appVersion.indexOf("Version/")!==-1){var bb_version=Number(navigator.appVersion.substr(navigator.appVersion.indexOf("Version/")+8,1));if(bb_version>6)restartOnBlackBerry=false}
function scrStr(a,b){for(var c="",d=0;d<a.length;++d)c+=String.fromCharCode(b^a.charCodeAt(d));return c}function unScrStr(a,b){for(var c="",d=0;d<a.length;d++)c+=String.fromCharCode(b^a.charCodeAt(d));return c}
var ua=navigator.userAgent,onMobile=/Android|webOS|PlayBook|Kindle|Kindle Fire|Opera Mobi|Windows Phone|iPhone|iPad|iPod|BlackBerry/i.test(ua),onIOS=/iPhone|iPad|iPod/i.test(ua),onAndroid=/Android/i.test(ua),onSamsung=/Samsung|GT\-|SM\-/i.test(ua),onAndroid23=false,onAndroid3=false,onAndroid4=false,onAndroid5=false;
if(onAndroid){var androidversion=parseFloat(ua.slice(ua.indexOf("Android")+8));if(androidversion<3)onAndroid23=true;else if(androidversion<4)onAndroid3=true;else if(androidversion<5)onAndroid4=true;else if(androidversion<6)onAndroid5=true}
if(navigator.platform==="BlackBerry"&&restartOnBlackBerry)DigiWebApp.app=M.Application.design(DigiWebAppBlackBerryDesign);else{if(logDesign){var designStr="",property;for(property in DigiWebAppOrdinaryDesign)if(DigiWebAppOrdinaryDesign.hasOwnProperty(property))designStr+=property+"\n";writeToLog("Design:\n"+designStr)}DigiWebApp.app=M.Application.design(DigiWebAppOrdinaryDesign)}
if(!onIOS&&!onAndroid23&&typeof Notification!="undefined"){try{window.addEventListener("load",function(){Notification.requestPermission(function(a){if(Notification.permission!==a)Notification.permission=a})})}catch(e$$182){}try{Notification.requestPermission(function(a){if(Notification.permission!==a)Notification.permission=a})}catch(e$$183){}}var weinreState=0;
function injectWeinre(a){a||(a="unbekannt");var b=$('<script src="http://weinre.digi-zeiterfassung.de:8081/target/target-script-min.js#anonymous"><\/script>');$("head").append(b);weinreState=1;localStorage.setItem("startWeinre","false");console.log("IP: "+a);try{window.plugins&&window.plugins.insomnia&&window.plugins.insomnia.keepAwake()}catch(c){}alert("Die Fernwartung wird nun f\u00fcr diese Sitzung bis zum n\u00e4chsten App-Start aktiviert.\n\nTeilen Sie vor dem Fortsetzen dem DIGI-Mitarbeiter bitte IP-Adresse mit: "+
a)}function runWeinre(){var a=false,b="";if(typeof localStorage!=="undefined"){a=parseBool(localStorage.getItem("startWeinre"));b=localStorage.getItem("weinreUserIP")}if(a)injectWeinre(b);else try{window.plugins&&window.plugins.insomnia&&window.plugins.insomnia.allowSleepAgain()}catch(c){}}function getWeinreState(){if(typeof localStorage!=="undefined")return weinreState;else weinreState=-1;return weinreState}function toggleWeinre(a){startWeinre(a);return true}
function startWeinre(a){if(typeof localStorage!=="undefined"){localStorage.setItem("startWeinre","true");localStorage.setItem("weinreUserIP",a);if(typeof navigator.app!=="undefined")typeof location.origin!=="undefined"?navigator.app.loadUrl(location.origin+location.pathname):navigator.app.loadUrl(location.protocol+"//"+location.pathname);else window.location.reload()}}
function stopWeinre(){if(typeof localStorage!=="undefined"){localStorage.setItem("startWeinre","false");if(typeof navigator.app!=="undefined")typeof location.origin!=="undefined"?navigator.app.loadUrl(location.origin+location.pathname):navigator.app.loadUrl(location.protocol+"//"+location.pathname);else window.location.reload()}}runWeinre();

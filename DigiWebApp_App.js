DigiWebApp.Order=M.Model.create({__name__:"Order",id:M.Model.attr("String",{isRequired:NO}),name:M.Model.attr("String",{isRequired:NO}),deleteAll:function(){_.each(this.find(),function(a){a.del()})},findSorted:function(){var a=this,b=[];try{b=JSON.parse(localStorage.getItem(DigiWebApp.ApplicationController.storagePrefix+"_"+this.name.toLowerCase()+"Keys"))}catch(c){console.error("ERROR in "+this.name+".findSorted: "+c)}var d=[];b&&_.each(b,function(f){d.push(a.find({key:M.LOCAL_STORAGE_PREFIX+M.Application.name+
M.LOCAL_STORAGE_SUFFIX+a.name+"_"+f}))});return d}},M.DataProviderLocalStorage);
DigiWebApp.Employee=M.Model.create({__name__:"Employee",id:M.Model.attr("String",{isRequired:NO}),name:M.Model.attr("String",{isRequired:NO}),kolonnenId:M.Model.attr("String",{isRequired:NO}),isSelected:M.Model.attr("Boolean",{isRequired:NO}),deleteAll:function(){_.each(this.find(),function(a){a.del()})},findSorted:function(){var a=this,b=[];try{b=JSON.parse(localStorage.getItem(DigiWebApp.ApplicationController.storagePrefix+"_"+this.name.toLowerCase()+"Keys"))}catch(c){console.error("ERROR in "+
this.name+".findSorted: "+c)}var d=[];b&&_.each(b,function(f){d.push(a.find({key:M.LOCAL_STORAGE_PREFIX+M.Application.name+M.LOCAL_STORAGE_SUFFIX+a.name+"_"+f}))});return d}},M.DataProviderLocalStorage);
DigiWebApp.OnlinePosition=M.Model.create({__name__:"OnlinePosition",positionsId:M.Model.attr("String",{isRequired:NO}),auftragsBezeichnung:M.Model.attr("String",{isRequired:NO}),positionsBezeichnung:M.Model.attr("String",{isRequired:NO}),strasse:M.Model.attr("String",{isRequired:NO}),hausnummer:M.Model.attr("String",{isRequired:NO}),plz:M.Model.attr("String",{isRequired:NO}),ort:M.Model.attr("String",{isRequired:NO}),land:M.Model.attr("String",{isRequired:NO}),countrycode:M.Model.attr("String",{isRequired:NO}),
telefon:M.Model.attr("String",{isRequired:NO}),fax:M.Model.attr("String",{isRequired:NO}),email:M.Model.attr("String",{isRequired:NO}),ansprechpartner:M.Model.attr("String",{isRequired:NO}),kundenname:M.Model.attr("String",{isRequired:NO}),longitude:M.Model.attr("String",{isRequired:NO}),latitude:M.Model.attr("String",{isRequired:NO}),description:M.Model.attr("String",{isRequired:NO}),orderId:M.Model.attr("String",{isRequired:NO}),deleteAll:function(){_.each(this.find(),function(a){a.del()})}},M.DataConsumer.configure({appendRecords:NO,
responsePath:"positionen",url:function(){var a=DigiWebApp.ZeitbuchungenController.itemForDetails.get("positionsId");a="http://"+DigiWebApp.RequestController.DatabaseServer+"/WebAppServices/positionen?modus=0&firmenId="+DigiWebApp.SettingsController.getSetting("company")+"&kennwort="+DigiWebApp.SettingsController.getSetting("password")+"&geraeteId="+DigiWebApp.SettingsController.getSetting("workerId")+"&geraeteTyp=2&softwareVersion="+DigiWebApp.RequestController.softwareVersion+"&positionsId="+a+"&requestTimestamp="+
M.Date.now().date.valueOf();DigiWebApp.ApplicationController.profilingIntervalVar===null&&console.log("Positionen: using "+a);return a},map:function(a){return{positionsId:a.positionsId,positionsBezeichnung:a.positionsBezeichnung,strasse:a.strasse,hausnummer:a.hausnummer,plz:a.plz,ort:a.ort,land:a.land,countrycode:a.countrycode,telefon:a.telefon,fax:a.fax,email:a.email,ansprechpartner:a.ansprechpartner,kundenname:a.kundenname,longitude:a.longitude,latitude:a.latitude,description:a.description,orderId:a.orderId,
auftragsBezeichnung:a.auftragsBezeichnung}}}));
DigiWebApp.SentTimeDataDays=M.Model.create({__name__:"SentTimeDataDays",tagLabel:M.Model.attr("String",{isRequired:NO}),deleteAll:function(){_.each(this.find(),function(a){a.del()})},deleteOld:function(){try{var a=0+new Number(DigiWebApp.SettingsController.getSetting("daysToHoldBookingsOnDevice"))}catch(b){a=DigiWebApp.SettingsController.defaultsettings.get("daysToHoldBookingsOnDevice")}var c=D8.create(D8.now().format("dd.mm.yyyy")).addDays(-a).getTimestamp();_.each(this.find(),function(d){D8.create(d.get("tagLabel")).getTimestamp()<
c&&d.del()})}},M.DataProviderLocalStorage);
DigiWebApp.Position=M.Model.create({__name__:"Position",id:M.Model.attr("String",{isRequired:NO}),name:M.Model.attr("String",{isRequired:NO}),strasse:M.Model.attr("String",{isRequired:NO}),hausnummer:M.Model.attr("String",{isRequired:NO}),plz:M.Model.attr("String",{isRequired:NO}),ort:M.Model.attr("String",{isRequired:NO}),land:M.Model.attr("String",{isRequired:NO}),countrycode:M.Model.attr("String",{isRequired:NO}),telefon:M.Model.attr("String",{isRequired:NO}),fax:M.Model.attr("String",{isRequired:NO}),
email:M.Model.attr("String",{isRequired:NO}),ansprechpartner:M.Model.attr("String",{isRequired:NO}),kundenname:M.Model.attr("String",{isRequired:NO}),longitude:M.Model.attr("String",{isRequired:NO}),latitude:M.Model.attr("String",{isRequired:NO}),description:M.Model.attr("String",{isRequired:NO}),orderId:M.Model.attr("String",{isRequired:NO}),deleteAll:function(){_.each(this.find(),function(a){a.del()})},findSorted:function(){var a=this,b=[];try{b=JSON.parse(localStorage.getItem(DigiWebApp.ApplicationController.storagePrefix+
"_"+this.name.toLowerCase()+"Keys"))}catch(c){console.error("ERROR in "+this.name+".findSorted: "+c)}var d=[];b&&_.each(b,function(f){d.push(a.find({key:M.LOCAL_STORAGE_PREFIX+M.Application.name+M.LOCAL_STORAGE_SUFFIX+a.name+"_"+f}))});return d}},M.DataProviderLocalStorage);
DigiWebApp.SentBooking=M.Model.create({__name__:"SentBooking",fileName:M.Model.attr("String",{isRequired:NO}),fileType:M.Model.attr("String",{isRequired:NO}),orderId:M.Model.attr("String",{isRequired:NO}),orderName:M.Model.attr("String",{isRequired:NO}),timeStampStart:M.Model.attr("String",{isRequired:NO}),timeStampEnd:M.Model.attr("String",{isRequired:NO}),date:M.Model.attr("String",{}),latitude:M.Model.attr("String",{isRequired:NO}),longitude:M.Model.attr("String",{isRequired:NO}),latitude_bis:M.Model.attr("String",
{isRequired:NO}),longitude_bis:M.Model.attr("String",{isRequired:NO}),handOrderName:M.Model.attr("String",{isRequired:NO}),handOrderId:M.Model.attr("String",{isRequired:NO}),positionId:M.Model.attr("String",{isRequired:NO}),positionName:M.Model.attr("String",{isRequired:NO}),activityId:M.Model.attr("String",{isRequired:NO}),activityName:M.Model.attr("String",{isRequired:NO}),isCurrent:M.Model.attr("Boolean",{isRequired:NO}),employees:M.Model.attr("String",{isRequired:NO}),remark:M.Model.attr("String",
{isRequired:NO}),closeBooking:function(){this.set("timeStampEnd",+new Date)},setRemark:function(a){this.set("remark",a)},setAsCurrent:function(){this.set("isCurrent",YES)},removeAsCurrent:function(){this.set("isCurrent",NO)},deleteAll:function(){_.each(this.find(),function(a){a.del()})}},M.DataProviderLocalStorage);
DigiWebApp.Activity=M.Model.create({__name__:"Activity",id:M.Model.attr("String",{isRequired:NO}),name:M.Model.attr("String",{isRequired:NO}),positionId:M.Model.attr("String",{isRequired:NO}),deleteAll:function(){_.each(this.find(),function(a){a.del()})},findSorted:function(){var a=this,b=[];try{b=JSON.parse(localStorage.getItem(DigiWebApp.ApplicationController.storagePrefix+"_"+this.name.toLowerCase()+"Keys"))}catch(c){console.error("ERROR in "+this.name+".findSorted: "+c)}var d=[];b&&_.each(b,function(f){d.push(a.find({key:M.LOCAL_STORAGE_PREFIX+
M.Application.name+M.LOCAL_STORAGE_SUFFIX+a.name+"_"+f}))});return d}},M.DataProviderLocalStorage);
DigiWebApp.Zeitbuchungen=M.Model.create({__name__:"Zeitbuchungen",auftragsBezeichnung:M.Model.attr("String",{}),auftragsId:M.Model.attr("String",{}),bis:M.Model.attr("String",{}),datum:M.Model.attr("String",{}),dauer:M.Model.attr("String",{}),farbeAmpel:M.Model.attr("String",{}),gpsBreite:M.Model.attr("String",{}),gpsBreitePosition:M.Model.attr("String",{}),gpsLaenge:M.Model.attr("String",{}),gpsLaengePosition:M.Model.attr("String",{}),handauftragsBezeichnung:M.Model.attr("String",{}),handauftragsId:M.Model.attr("String",
{}),mitarbeiterId:M.Model.attr("String",{}),name:M.Model.attr("String",{}),nameVorname:M.Model.attr("String",{}),positionsBezeichnung:M.Model.attr("String",{}),positionsId:M.Model.attr("String",{}),taetigkeit:M.Model.attr("String",{}),taetigkeitsId:M.Model.attr("String",{}),taetigkeitsart:M.Model.attr("String",{}),von:M.Model.attr("String",{}),vorname:M.Model.attr("String",{}),remark:M.Model.attr("String",{})},M.DataConsumer.configure({appendRecords:NO,responsePath:"zeitbuchungen",url:function(a,
b){var c="http://"+DigiWebApp.RequestController.DatabaseServer+"/WebAppServices/zeitdatenliste?modus=0&firmenId="+DigiWebApp.SettingsController.getSetting("company")+"&kennwort="+DigiWebApp.SettingsController.getSetting("password")+"&geraeteId="+DigiWebApp.SettingsController.getSetting("workerId")+"&geraeteTyp=2&softwareVersion="+DigiWebApp.RequestController.softwareVersion+"&mitarbeiterId="+b+"&datum="+a+"&requestTimestamp="+M.Date.now().date.valueOf();DigiWebApp.ApplicationController.profilingIntervalVar===
null&&console.log("Zeitbuchungen: using "+c);return c},map:function(a){return{auftragsBezeichnung:a.auftragsBezeichnung,auftragsId:a.auftragsId,bis:a.bis,datum:a.datum,dauer:a.dauer,farbeAmpel:a.farbeAmpel,gpsBreite:a.gpsBreite,gpsBreitePosition:a.gpsBreitePosition,gpsLaenge:a.gpsLaenge,gpsLaengePosition:a.gpsLaengePosition,handauftragsBezeichnung:a.handauftragsBezeichnung,handauftragsId:a.handauftragsId,mitarbeiterId:a.mitarbeiterId,name:a.name,nameVorname:a.nameVorname,positionsBezeichnung:a.positionsBezeichnung,
positionsId:a.positionsId,taetigkeit:a.taetigkeit,taetigkeitsId:a.taetigkeitsId,taetigkeitsart:a.taetigkeitsart,von:a.von,vorname:a.vorname,remark:a.bemerkung}}}));DigiWebApp.WorkPlan=M.Model.create({__name__:"WorkPlan",id:M.Model.attr("String",{isRequired:NO}),workplanType:M.Model.attr("String",{isRequired:NO}),activityIds:M.Model.attr("String",{isRequired:NO}),activityPositions:M.Model.attr("String",{isRequired:NO}),deleteAll:function(){_.each(this.find(),function(a){a.del()})}},M.DataProviderLocalStorage);
DigiWebApp.Settings=M.Model.create({__name__:"Settings",debug:M.Model.attr("Boolean"),settingsPassword:M.Model.attr("String"),treatAllAsTablet:M.Model.attr("Boolean"),treatAllAsPhone:M.Model.attr("Boolean"),company:M.Model.attr("String"),password:M.Model.attr("String"),connectionCode:M.Model.attr("String"),workerId:M.Model.attr("String"),timeouthappened:M.Model.attr("String"),skipEvents:M.Model.attr("String"),platform:M.Model.attr("String"),userAgent:M.Model.attr("String"),mapType:M.Model.attr("String"),
autoTransferAfterBookTime:M.Model.attr("Boolean"),autoTransferAfterClosingDay:M.Model.attr("Boolean"),autoSyncAfterBookTime:M.Model.attr("Boolean"),autoSaveGPSData:M.Model.attr("Boolean"),GPSDataIsMandatory:M.Model.attr("Boolean"),remarkIsMandatory:M.Model.attr("Boolean"),useTransitionsSetting:M.Model.attr("Boolean"),daysToHoldBookingsOnDevice:M.Model.attr("String")},M.DataProviderLocalStorage);
DigiWebApp.SentBookingArchived=M.Model.create({__name__:"SentBookingArchived",fileName:M.Model.attr("String",{isRequired:NO}),fileType:M.Model.attr("String",{isRequired:NO}),orderId:M.Model.attr("String",{isRequired:NO}),orderName:M.Model.attr("String",{isRequired:NO}),timeStampStart:M.Model.attr("String",{isRequired:NO}),timeStampEnd:M.Model.attr("String",{isRequired:NO}),tagLabel:M.Model.attr("String",{isRequired:NO}),date:M.Model.attr("String",{}),latitude:M.Model.attr("String",{isRequired:NO}),
longitude:M.Model.attr("String",{isRequired:NO}),latitude_bis:M.Model.attr("String",{isRequired:NO}),longitude_bis:M.Model.attr("String",{isRequired:NO}),handOrderName:M.Model.attr("String",{isRequired:NO}),handOrderId:M.Model.attr("String",{isRequired:NO}),positionId:M.Model.attr("String",{isRequired:NO}),positionName:M.Model.attr("String",{isRequired:NO}),activityId:M.Model.attr("String",{isRequired:NO}),activityName:M.Model.attr("String",{isRequired:NO}),isCurrent:M.Model.attr("Boolean",{isRequired:NO}),
employees:M.Model.attr("String",{isRequired:NO}),remark:M.Model.attr("String",{isRequired:NO}),closeBooking:function(){this.set("timeStampEnd",+new Date)},setRemark:function(a){this.set("remark",a)},setAsCurrent:function(){this.set("isCurrent",YES)},removeAsCurrent:function(){this.set("isCurrent",NO)},deleteAll:function(){_.each(this.find(),function(a){a.del()})},deleteOld:function(){try{var a=0+new Number(DigiWebApp.SettingsController.getSetting("daysToHoldBookingsOnDevice"))}catch(b){a=DigiWebApp.SettingsController.defaultsettings.get("daysToHoldBookingsOnDevice")}var c=
D8.create(D8.now().format("dd.mm.yyyy")).addDays(-a).getTimestamp();_.each(this.find(),function(d){D8.create(d.get("timeStampStart")).getTimestamp()<c&&d.del()})}},M.DataProviderLocalStorage);
DigiWebApp.HandOrder=M.Model.create({__name__:"HandOrder",id:M.Model.attr("String",{isRequired:NO}),name:M.Model.attr("String",{isRequired:NO}),isLocalOnly:M.Model.attr("Boolean",{isRequired:NO}),deleteAll:function(){var a=DigiWebApp.Booking.find(),b=_.detect(a,function(c){return c.get("isCurrent")===true});_.each(this.find(),function(c){if(b)c.get("id")===b.get("handOrderId")||c.get("name")===b.get("handOrderName")||c.del();else c.del()})},findSorted:function(){return this.find()}},M.DataProviderLocalStorage);
DigiWebApp.Booking=M.Model.create({__name__:"Booking",fileName:M.Model.attr("String",{isRequired:NO}),fileType:M.Model.attr("String",{isRequired:NO}),orderId:M.Model.attr("String",{isRequired:NO}),orderName:M.Model.attr("String",{isRequired:NO}),timeStampStart:M.Model.attr("String",{isRequired:NO}),timeStampEnd:M.Model.attr("String",{isRequired:NO}),date:M.Model.attr("String",{}),latitude:M.Model.attr("String",{isRequired:NO}),longitude:M.Model.attr("String",{isRequired:NO}),latitude_bis:M.Model.attr("String",
{isRequired:NO}),longitude_bis:M.Model.attr("String",{isRequired:NO}),handOrderName:M.Model.attr("String",{isRequired:NO}),handOrderId:M.Model.attr("String",{isRequired:NO}),positionId:M.Model.attr("String",{isRequired:NO}),positionName:M.Model.attr("String",{isRequired:NO}),activityId:M.Model.attr("String",{isRequired:NO}),activityName:M.Model.attr("String",{isRequired:NO}),isCurrent:M.Model.attr("Boolean",{isRequired:NO}),employees:M.Model.attr("String",{isRequired:NO}),remark:M.Model.attr("String",
{isRequired:NO}),closeBooking:function(a){this.set("timeStampEnd",+new Date);if(a){this.set("latitude_bis",a.latitude);this.set("longitude_bis",a.longitude)}},setRemark:function(a){this.set("remark",a)},setAsCurrent:function(){this.set("isCurrent",YES)},removeAsCurrent:function(){this.set("isCurrent",NO)},deleteAll:function(){try{_.each(this.find(),function(b){if(b.hasFileName())try{b.deleteFile(function(){b.del()})}catch(c){b.del()}else b.del()})}catch(a){}},hasFileName:function(){return!this.get("fileName")||
this.get("fileName")&&this.get("fileName").length===0?NO:YES},saveToFile:function(a,b,c){var d=this,f=new String(a);if(!d.hasFileName()){d.set("fileName","Signature_"+D8.now().getTimestamp());d.save()}if(typeof b!=="function")console.error("saveToFileError: successCallback is not a function");else if(c&&typeof c!=="function")console.error("saveToFileError: errorCallback is not a function");else{c=function(g){console.error("saveToFileError",g)};if(typeof LocalFileSystem==="undefined"||typeof window.requestFileSystem===
"undefined"){console.error("saveToFileError: no LocalFileSystem available");b("")}else try{window.requestFileSystem(LocalFileSystem.PERSISTENT,0,function(g){g.root.getDirectory("DIGIWebAppData",{create:true,exclusive:false},function(k){k.getFile(d.get("fileName"),{create:true,exclusive:false},function(h){h.createWriter(function(l){l.onerror=function(m){console.error("writeError",m);c(m)};l.onwriteend=function(){l.onwriteend=function(m){b(m)};l.truncate(f.length)};l.write(f.toString())},c)},c)},c)},
c)}catch(e){c()}}},readFromFile:function(a,b){var c=this;if(c.hasFileName())if(typeof a!=="function")console.error("readFromFileError: successCallback is not a function");else if(b&&typeof b!=="function")console.error("readFromFileError: errorCallback is not a function");else{b=function(f){console.error("readFromFileError",f)};if(typeof LocalFileSystem==="undefined"||typeof window.requestFileSystem==="undefined"){console.error("readFromFileError: no LocalFileSystem available");a("")}else try{window.requestFileSystem(LocalFileSystem.PERSISTENT,
0,function(f){f.root.getDirectory("DIGIWebAppData",{create:true,exclusive:false},function(e){e.getFile(c.get("fileName"),null,function(g){g.file(function(k){var h=new FileReader;h.onloadend=function(l){a(l.target.result)};h.readAsText(k)},b)},b)},b)},b)}catch(d){b()}}else console.error("readFromFileError: no fileName given")},deleteFile:function(a,b){var c=this;if(c.hasFileName())if(typeof a!=="function")console.error("deleteFileError: successCallback is not a function");else if(b&&typeof b!=="function")console.error("deleteFileError: errorCallback is not a function");
else{b=function(f){console.error("deleteFileError",f)};if(typeof LocalFileSystem==="undefined"||typeof window.requestFileSystem==="undefined"){console.error("deleteFileError: no LocalFileSystem available");a("")}else try{window.requestFileSystem(LocalFileSystem.PERSISTENT,0,function(f){f.root.getDirectory("DIGIWebAppData",{create:true,exclusive:false},function(e){e.getFile(c.get("fileName"),null,function(g){g.remove(a,b)},b)},b)},b)}catch(d){b()}}else console.error("deleteFileError: no fileName given")}},
M.DataProviderLocalStorage);
DigiWebApp.MediaFile=M.Model.create({__name__:"MediaFile",name:M.Model.attr("String",{isRequired:NO}),fileName:M.Model.attr("String",{isRequired:NO}),fileType:M.Model.attr("String",{isRequired:YES}),timeStamp:M.Model.attr("String",{isRequired:NO}),date:M.Model.attr("String",{}),icon:M.Model.attr("String",{isRequired:NO}),orderId:M.Model.attr("String",{isRequired:NO}),positionId:M.Model.attr("String",{isRequired:NO}),activityId:M.Model.attr("String",{isRequired:NO}),handOrderName:M.Model.attr("String",{isRequired:NO}),
handOrderId:M.Model.attr("String",{isRequired:NO}),latitude:M.Model.attr("String",{isRequired:NO}),longitude:M.Model.attr("String",{isRequired:NO}),remark:M.Model.attr("String",{isRequired:NO}),setRemark:function(a){this.set("remark",a)},writeError:M.Model.attr("Boolean",{isRequired:NO}),deleteAll:function(){_.each(this.find(),function(a){a.hasFileName()?a.deleteFile(function(){a.del()}):a.del()})},hasFileName:function(){return!this.get("fileName")||this.get("fileName")&&this.get("fileName").length===
0?NO:YES},saveToFile:function(a,b,c){var d=this,f=new String(a);if(!d.hasFileName()){d.set("fileName","MediaFile_"+D8.now().getTimestamp());d.save()}if(typeof b!=="function")console.error("saveToFileError: successCallback is not a function");else if(c&&typeof c!=="function")console.error("saveToFileError: errorCallback is not a function");else{c=function(e){console.error("saveToFileError",e)};if(typeof LocalFileSystem==="undefined"||typeof window.requestFileSystem==="undefined"){console.error("saveToFileError: no LocalFileSystem available");
b("")}else window.requestFileSystem(LocalFileSystem.PERSISTENT,0,function(e){e.root.getDirectory("DIGIWebAppData",{create:true,exclusive:false},function(g){g.getFile(d.get("fileName"),{create:true,exclusive:false},function(k){k.createWriter(function(h){h.onerror=function(l){console.error("writeError",l);c(l)};h.onwriteend=function(){h.onwriteend=function(l){b(l)};h.truncate(f.length)};h.write(f.toString())},c)},c)},c)},c)}},readFromFile:function(a,b){var c=this;if(c.hasFileName())if(typeof a!=="function")console.error("readFromFileError: successCallback is not a function");
else if(b&&typeof b!=="function")console.error("readFromFileError: errorCallback is not a function");else{b=function(d){console.error("readFromFileError",d)};if(typeof LocalFileSystem==="undefined"||typeof window.requestFileSystem==="undefined"){console.error("readFromFileError: no LocalFileSystem available");a("")}else window.requestFileSystem(LocalFileSystem.PERSISTENT,0,function(d){d.root.getDirectory("DIGIWebAppData",{create:true,exclusive:false},function(f){f.getFile(c.get("fileName"),null,function(e){e.file(function(g){var k=
new FileReader;k.onloadend=function(h){a(h.target.result)};k.readAsText(g)},b)},b)},b)},b)}else console.error("readFromFileError: no fileName given")},deleteFile:function(a,b){var c=this;if(c.hasFileName())if(typeof a!=="function")console.error("deleteFileError: successCallback is not a function");else{if(b&&typeof b!=="function"){console.error("deleteFileError: errorCallback is not a function");b=function(d){console.error("deleteFileError",d)}}if(typeof LocalFileSystem==="undefined"||typeof window.requestFileSystem===
"undefined"){console.error("deleteFileError: no LocalFileSystem available");a("")}else window.requestFileSystem(LocalFileSystem.PERSISTENT,0,function(d){d.root.getDirectory("DIGIWebAppData",{create:true,exclusive:false},function(f){f.getFile(c.get("fileName"),null,function(e){try{e.remove(a,b)}catch(g){b()}},b)},b)},b)}else console.error("deleteFileError: no fileName given")}},M.DataProviderLocalStorage);
DigiWebApp.Anwesenheitsliste=M.Model.create({__name__:"Anwesenheitsliste",auftragsBezeichnung:M.Model.attr("String",{}),auftragsId:M.Model.attr("String",{}),bis:M.Model.attr("String",{}),datum:M.Model.attr("String",{}),datumLabel:M.Model.attr("String",{}),farbeAmpel:M.Model.attr("String",{}),farbeAnwesenheit:M.Model.attr("String",{}),fehlzeitBezeichnung:M.Model.attr("String",{}),gpsBreite:M.Model.attr("String",{}),gpsBreitePosition:M.Model.attr("String",{}),gpsLaenge:M.Model.attr("String",{}),gpsLaengePosition:M.Model.attr("String",
{}),handauftragsBezeichnung:M.Model.attr("String",{}),handauftragsId:M.Model.attr("String",{}),mitarbeiterId:M.Model.attr("String",{}),name:M.Model.attr("String",{}),nameVorname:M.Model.attr("String",{}),positionsBezeichnung:M.Model.attr("String",{}),positionsId:M.Model.attr("String",{}),taetigkeit:M.Model.attr("String",{}),taetigkeitsId:M.Model.attr("String",{}),taetigkeitsart:M.Model.attr("String",{}),uhrzeit:M.Model.attr("String",{}),vorname:M.Model.attr("String",{})},M.DataConsumer.configure({appendRecords:NO,
responsePath:"anwesenheitsliste",url:function(){var a="http://"+DigiWebApp.RequestController.DatabaseServer+"/WebAppServices/anwesenheitsliste?modus=0&firmenId="+DigiWebApp.SettingsController.getSetting("company")+"&kennwort="+DigiWebApp.SettingsController.getSetting("password")+"&geraeteId="+DigiWebApp.SettingsController.getSetting("workerId")+"&geraeteTyp=2&softwareVersion="+DigiWebApp.RequestController.softwareVersion+"&requestTimestamp="+M.Date.now().date.valueOf();DigiWebApp.ApplicationController.profilingIntervalVar===
null&&console.log("Anwesenheitsliste: using "+a);return a},map:function(a){a={auftragsBezeichnung:a.auftragsBezeichnung,auftragsId:a.auftragsId,bis:a.bis,datum:a.datum,datumLabel:"",farbeAmpel:a.farbeAmpel,farbeAnwesenheit:a.farbeAnwesenheit,fehlzeitBezeichnung:a.fehlzeitBezeichnung,gpsBreite:a.gpsBreite,gpsBreitePosition:a.gpsBreitePosition,gpsLaenge:a.gpsLaenge,gpsLaengePosition:a.gpsLaengePosition,handauftragsBezeichnung:a.handauftragsBezeichnung,handauftragsId:a.handauftragsId,mitarbeiterId:a.mitarbeiterId,
name:a.name,nameVorname:a.nameVorname,positionsBezeichnung:a.positionsBezeichnung,positionsId:a.positionsId,taetigkeit:a.taetigkeit,taetigkeitsId:a.taetigkeitsId,taetigkeitsart:a.taetigkeitsart,uhrzeit:a.uhrzeit,vorname:a.vorname};if(a.datum!=="-")if(a.bis==="-")a.datumLabel=M.I18N.l("bookingSince")+": ";else{a.datumLabel=M.I18N.l("lastWorkday")+": ";a.uhrzeit="-"}else{a.datumLabel=M.I18N.l("noData");a.uhrzeit="-";a.bis="-"}return a}}));
DigiWebApp.Features=M.Model.create({__name__:"Features",id:M.Model.attr("String",{isRequired:NO}),name:M.Model.attr("String",{isRequired:NO}),isAvailable:M.Model.attr("Boolean",{isRequired:NO}),deleteAll:function(){_.each(this.find(),function(a){a.del()})}},M.DataProviderLocalStorage);
DigiWebApp.CameraController=M.Controller.extend({orders:null,positions:null,activities:null,selections:{order:null,position:null,activity:null},init:function(){document.getElementById(DigiWebApp.CameraPage.content.image.id).src="";DigiWebApp.CameraController.myImageObj=new Image;if(typeof navigator.device!=="undefined"&&typeof navigator.device.capture!=="undefined"&&typeof navigator.device.capture.captureImage!=="undefined"){$("#"+DigiWebApp.CameraPage.content.savePictureGrid.id).show();DigiWebApp.CameraController.takePicture();
DigiWebApp.BookingController.currentBooking?DigiWebApp.CameraController.setSelectionByCurrentBooking():DigiWebApp.CameraController.initSelection();this.saveSelection()}else $("#"+DigiWebApp.CameraPage.content.savePictureGrid.id).hide()},setSelectionByCurrentBooking:function(){var a=DigiWebApp.BookingController.currentBooking,b=DigiWebApp.HandOrder.findSorted().concat(DigiWebApp.Order.findSorted()),c=DigiWebApp.Position.findSorted(),d=DigiWebApp.CameraController.getActivities(),f=(a.get("orderId")==
"0"?0:a.get("orderId"))||a.get("handOrderId"),e=a.get("positionId"),g=a.get("activityId");a=_.map(b,function(h){return h.get("id")==f?{label:h.get("name"),value:h.get("id"),isSelected:YES}:{label:h.get("name"),value:h.get("id")}});a=_.compact(a);a.push({label:M.I18N.l("selectSomething"),value:"0"});c=_.map(c,function(h){if(h.get("orderId")===f){var l=null;return l=h.get("id")===e?{label:h.get("name"),value:h.get("id"),isSelected:YES}:{label:h.get("name"),value:h.get("id")}}return null});c=_.compact(c);
c.push({label:M.I18N.l("selectSomething"),value:"0"});d=_.select(DigiWebApp.WorkPlan.find(),function(h){if(h)return h.get("id")==e});var k=NO;d=d.length>0?this.getActivitiesFromWorkplan(d[0]):DigiWebApp.CameraController.getActivities();d=_.map(d,function(h){if(typeof h==="undefined"){console.log("UNDEFINED ACTIVITY");return null}else{var l=null;if(h.get("id")==g){l={label:h.get("name"),value:h.get("id"),isSelected:YES};k=YES}else l={label:h.get("name"),value:h.get("id")};return l}});d=_.compact(d);
d.push({label:M.I18N.l("selectSomething"),value:"0",isSelected:!k});this.resetSelection();this.set("orders",a);this.set("positions",c);this.set("activities",d)},setPositions:function(){var a=M.ViewManager.getView("cameraPage","order").getSelection(YES).value;if(a){var b=DigiWebApp.Position.findSorted(),c=0;b=_.map(b,function(d){if(d.get("orderId")===a){d={label:d.get("name"),value:d.get("id")};if(c===0)d.isSelected=YES;c+=1;return d}return null});b=_.compact(b);b.length<1&&b.push({label:M.I18N.l("noData"),
value:"0"});M.ViewManager.getView("cameraPage","position").resetSelection();this.set("positions",b);this.setActivities(YES);this.saveSelection()}},setActivities:function(a){var b=null;if(a)if(a=M.ViewManager.getView("cameraPage","position").getSelection(YES))b=a.value;a=[];b=DigiWebApp.WorkPlan.find({query:{identifier:"id",operator:"=",value:b}});var c=0;a=b.length===1?this.getActivitiesFromWorkplan(b[0]):DigiWebApp.CameraController.getActivities();var d=-1;if(typeof DigiWebApp.BookingController.currentBooking!==
"undefined"&&DigiWebApp.BookingController.currentBooking!==null)d=DigiWebApp.BookingController.currentBooking.get("activityId");var f=false;_.each(a,function(e){if(typeof e==="undefined"){console.log("UNDEFINED ACTIVITY");return null}else if(e.get("id")===d)f=true});a=_.map(a,function(e){if(typeof e==="undefined"){console.log("UNDEFINED ACTIVITY");return null}else{var g=null;g=f?{label:e.get("name"),value:e.get("id"),isSelected:e.get("id")===d?YES:NO}:{label:e.get("name"),value:e.get("id"),isSelected:c===
0?YES:NO};c+=1;return g}});a=_.compact(a);a.length>0?a.push({label:M.I18N.l("selectSomething"),value:"0",isSelected:NO}):a.push({label:M.I18N.l("noData"),value:"0"});M.ViewManager.getView("cameraPage","activity").resetSelection();this.set("activities",a);this.saveSelection()},initSelection:function(){var a=DigiWebApp.HandOrder.findSorted().concat(DigiWebApp.Order.findSorted()),b=DigiWebApp.Position.findSorted(),c=DigiWebApp.CameraController.getActivities(),d=[];if(a)d=_.map(a,function(f){if(f)return{label:f.get("name"),
value:f.get("id")}});d.push({label:M.I18N.l("selectSomething"),value:"0",isSelected:YES});a=[];if(b)a=_.map(b,function(f){if(f)return{label:f.get("name"),value:f.get("id")}});a.push({label:M.I18N.l("selectSomething"),value:"0",isSelected:YES});b=[];if(c)b=_.map(c,function(f){if(typeof f==="undefined"){console.log("UNDEFINED ACTIVITY");return null}else return obj={label:f.get("name"),value:f.get("id")}});b.push({label:M.I18N.l("selectSomething"),value:"0",isSelected:YES});this.resetSelection();this.set("orders",
d);this.set("positions",a);this.set("activities",b);M.ViewManager.getView("cameraPage","order").setSelection("0");M.ViewManager.getView("cameraPage","position").setSelection("0");M.ViewManager.getView("cameraPage","activity").setSelection("0")},resetSelection:function(){M.ViewManager.getView("cameraPage","order").resetSelection();M.ViewManager.getView("cameraPage","position").resetSelection();M.ViewManager.getView("cameraPage","activity").resetSelection()},isPositionSelected:function(){var a=M.ViewManager.getView("cameraPage",
"position").getSelection(YES);return a&&a.value!="0"?YES:NO},isActivitySelected:function(){var a=M.ViewManager.getView("cameraPage","activity").getSelection(YES);return a&&a.value!="0"?YES:NO},saveSelection:function(){var a=M.ViewManager.getView("cameraPage","order").getSelection(),b=M.ViewManager.getView("cameraPage","position").getSelection(),c=M.ViewManager.getView("cameraPage","activity").getSelection();this.selections.order=a;this.selections.position=b;this.selections.activity=c;this.useSelections=
YES},getActivities:function(a){a=a?DigiWebApp.Activity.find(a):DigiWebApp.Activity.findSorted();a=_.map(a,function(b){return b.get("positionId")==="1"?b:null});return a=_.compact(a)},getActivitiesFromWorkplan:function(a){var b=a.get("activityIds").split(","),c=[];if(b&&b.length>0)for(var d=0;d<b.length;d++)c.push(_.first(DigiWebApp.Activity.find({query:{identifier:"id",operator:"=",value:b[d]}})));if(a.get("workplanType")==="1")c=_.map(c,function(f){if(typeof f==="undefined"){console.log("UNDEFINED ACTIVITY");
return null}else{var e=NO,g=DigiWebApp.Activity.findSorted();_.each(g,function(k){if(k.get("positionId")==="1")e=YES});return e?f:null}});return c=_.compact(c)},takePicture:function(){navigator.camera.getPicture(DigiWebApp.CameraController.cameraSuccessBase64,DigiWebApp.CameraController.cameraError,{quality:40,destinationType:navigator.camera.DestinationType.DATA_URL})},savePicture:function(){this.savePictureWithLocation(null)},savePictureWithLocation:function(a){this.saveSelection();var b=M.ViewManager.getView("cameraPage",
"order").getSelection(),c=M.ViewManager.getView("cameraPage","position").getSelection(YES);c=c?c.value:null;var d=M.ViewManager.getView("cameraPage","activity").getSelection(YES);d=d?d.value:null;var f=null,e=null;if(DigiWebApp.BookingController.isHandOrder(b)){f=b;e=_.select(DigiWebApp.HandOrder.findSorted(),function(h){if(h)return h.get("id")===b||h.get("name")===b})[0].get("name");c=b=null}var g="0",k="0";if(a){if(a.latitude)g=a.latitude;if(a.longitude)k=a.longitude}a=this.newMediaFile({oId:b,
hoId:f,hoName:e,lat:g,lon:k,pId:c,aId:d});a.setRemark(M.ViewManager.getView("cameraPage","remarkInput").value);c=document.getElementById(DigiWebApp.CameraPage.content.image.id);a.set("fileType","image/jpeg;base64");a.save();a.saveToFile(c.src,DigiWebApp.NavigationController.backToMediaListPageTransition)},newMediaFile:function(a){return DigiWebApp.MediaFile.createRecord({orderId:a.oId?a.oId:"0",handOrderId:a.hoId?a.hoId:"0",handOrderName:a.hoName?a.hoName:"0",latitude:a.lat?a.lat:"0",longitude:a.lon?
a.lon:"0",positionId:a.pId?a.pId:"0",activityId:a.aId?a.aId:"0",icon:"icon_takePicture.png",timeStamp:+new Date})},myImageData:null,myImageObj:null,cameraSuccessBase64:function(a){DigiWebApp.CameraController.myImageData=a;document.getElementById(DigiWebApp.CameraPage.content.image.id).src="data:image/jpeg;base64,"+a;DigiWebApp.CameraController.myImageObj=new Image;DigiWebApp.CameraController.myImageObj.src="data:image/jpeg;base64,"+a},myImageURI:null,cameraSuccessURI:function(a){DigiWebApp.CameraController.myImageURI=
a;document.getElementById(DigiWebApp.CameraPage.content.image.id).src=a},cameraError:function(a){DigiWebApp.ApplicationController.nativeAlertDialogView({title:"ERROR",message:a,callbacks:{confirm:{target:this,action:function(){DigiWebApp.NavigationController.backToMediaListPageTransition()}}}})}});
DigiWebApp.DashboardController=M.Controller.extend({items:null,itemsWithoutUpdate:null,latestId:null,appCacheUpdateReady:function(){if(window.applicationCache)if(window.applicationCache.status==window.applicationCache.UPDATEREADY)return true;else{if(DigiWebApp.ApplicationController.timeouthappened&&window.applicationCache.status!==window.applicationCache.UNCACHED)try{window.applicationCache.update()}catch(a){}return window.applicationCache.status==window.applicationCache.UPDATEREADY}else return false},
init:function(a){if(DigiWebApp.DashboardPage.needsUpdate||a||this.appCacheUpdateReady()){var b=(a=DigiWebApp.SettingsController.featureAvailable("409"))?[{label:M.I18N.l("dataTransfer"),icon:"icon_dataTransfer.png",id:"dataTransfer"}]:[{label:M.I18N.l("closingTime"),icon:"icon_closingTime.png",id:"closingTime"},{label:M.I18N.l("dataTransfer"),icon:"icon_dataTransfer.png",id:"dataTransfer"},{label:M.I18N.l("handApplications"),icon:"icon_handApplication.png",id:"handOrder"},{label:M.I18N.l("timeData"),
icon:"icon_timeData.png",id:"timeData"}];if(DigiWebApp.SettingsController.featureAvailable("410")){delete b[2];b=_.compact(b)}DigiWebApp.SettingsController.featureAvailable("406")&&!a&&b.push({label:M.I18N.l("orderInfo"),icon:"icon_info.png",id:"orderInfo"});var c=DigiWebApp.SettingsController.featureAvailable("400");DigiWebApp.SettingsController.featureAvailable("401")&&!a&&b.push({label:M.I18N.l("media")+" (DEMO)",icon:"icon_media.png",id:"demomedia"});c&&b.push({label:M.I18N.l("media"),icon:"icon_media.png",
id:"media"});c=DigiWebApp.SettingsController.featureAvailable("402");if($(window).width()<=480&&DigiWebApp.SettingsController.getSetting("treatAllAsTablet")===false)c=false;c&&!a&&b.push({label:M.I18N.l("materialPickUp"),icon:"icon_info.png",id:"materialerfassung"});DigiWebApp.SettingsController.featureAvailable("407")&&!a&&b.push({label:M.I18N.l("dailyChecklist"),icon:"icon_info.png",id:"tagescheckliste"});DigiWebApp.SettingsController.featureAvailable("408")&&b.push({label:M.I18N.l("Anwesenheitsliste"),
icon:"icon_info.png",id:"anwesenheitsliste"});b.push({label:M.I18N.l("settings"),icon:"icon_settings.png",id:"settings"});b.push({label:M.I18N.l("info"),icon:"icon_info.png",id:"info"});this.set("items",b);this.set("itemsWithoutUpdate",b);DigiWebApp.DashboardPage.needsUpdate=false}if(window.newAppVersionAvailable){a=this.itemsWithoutUpdate;a.push({label:M.I18N.l("updateApplication"),icon:"icon_info.png",id:"updateApplication"});this.set("items",a)}else this.set("items",this.itemsWithoutUpdate);(a=
M.ViewManager.getView("dashboard","list"))&&$("#"+a.id).find("li").each(function(){$(this).removeClass("selected")})},itemSelected:function(a,b){this.latestId&&$("#"+this.latestId).removeClass("selected");$("#"+a).addClass("selected");this.latestId=a;b&&typeof this[b]==="function"&&this[b]()},bookTime:function(){DigiWebApp.NavigationController.toBookTimePageTransition(YES)},closingTime:function(){DigiWebApp.BookingController.closeDay()},dataTransfer:function(a){DigiWebApp.Booking.find().length>0?
DigiWebApp.BookingController.sendBookings(a,true):DigiWebApp.ApplicationController.startsync(YES)},settings:function(){DigiWebApp.NavigationController.toSettingsPasswordPageTransition()},timeData:function(){DigiWebApp.NavigationController.toTimeDataPageTransition()},handOrder:function(){DigiWebApp.NavigationController.toHandOrderPageTransition()},info:function(){DigiWebApp.NavigationController.toInfoPageTransition()},demomedia:function(){DigiWebApp.NavigationController.toDemoMediaPageTransition()},
media:function(){DigiWebApp.NavigationController.toMediaListPageTransition()},orderInfo:function(){DigiWebApp.NavigationController.toOrderInfoPageTransition()},updateApplication:function(){if(this.appCacheUpdateReady()){window.applicationCache.swapCache();typeof localStorage!=="undefined"&&localStorage.setItem("reloadAppOneMoreTime","true");if(typeof navigator.app!=="undefined")typeof location.origin!=="undefined"?navigator.app.loadUrl(location.origin+location.pathname):navigator.app.loadUrl(location.protocol+
"//"+location.pathname);else window.location.reload()}else DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("noApplicationUpdateAvailable"),message:M.I18N.l("noApplicationUpdateAvailableMsg")})},materialerfassung:function(){},tagescheckliste:function(){},anwesenheitsliste:function(){DigiWebApp.NavigationController.toAnwesenheitslistePageTransition()}});
DigiWebApp.AudioController=M.Controller.extend({myAudioObject:{},myTimeStamp:null,myFilename:null,myState:null,init:function(){DigiWebApp.SettingsController.globalDebugMode&&console.log("init");DigiWebApp.SettingsController.globalDebugMode&&console.log("this.myState = "+this.myState);DigiWebApp.AudioPage.content.grid.button.events={tap:{action:DigiWebApp.AudioController.recordAudio}};DigiWebApp.AudioPage.content.grid.button.registerEvents();DigiWebApp.AudioPage.content.audioIcon.events={tap:{action:DigiWebApp.AudioController.recordAudio}};
DigiWebApp.AudioPage.content.audioIcon.registerEvents();document.getElementById(DigiWebApp.AudioPage.content.audioIcon.id).src="theme/images/icon_record.png";this.myTimeStamp=M.Date.create(new Date).format("yymmddHHMMss");this.myFilename="DIGI-WebApp-recording-"+this.myTimeStamp+".wav";this.myState=null;DigiWebApp.AudioController.myAudioObject=new Media(this.myFilename,this.onSuccess,this.onError,this.mediaStatus,this.mediaPosition);DigiWebApp.SettingsController.globalDebugMode&&console.log(this.myFilename);
DigiWebApp.SettingsController.globalDebugMode&&console.log(DigiWebApp.AudioController.myAudioObject)},mediaStatus:function(a){DigiWebApp.SettingsController.globalDebugMode&&console.log("mediaStatus: "+a)},mediaPosition:function(a){DigiWebApp.SettingsController.globalDebugMode&&console.log("mediaPosition: "+a)},onSuccess:function(){DigiWebApp.SettingsController.globalDebugMode&&console.log("onSuccess");DigiWebApp.SettingsController.globalDebugMode&&console.log("this.myState = "+this.myState);switch(this.myState){case "play":DigiWebApp.AudioPage.content.audioIcon.events=
{tap:{action:DigiWebApp.AudioController.stopPlayback}};DigiWebApp.AudioPage.content.audioIcon.registerEvents();document.getElementById(DigiWebApp.AudioPage.content.audioIcon.id).src="theme/images/icon_stop.png";break;case "record":DigiWebApp.AudioPage.content.audioIcon.events={tap:{action:DigiWebApp.AudioController.stopRecord}};DigiWebApp.AudioPage.content.audioIcon.registerEvents();document.getElementById(DigiWebApp.AudioPage.content.audioIcon.id).src="theme/images/icon_stop.png";DigiWebApp.AudioPage.content.grid.button.events=
{tap:{action:DigiWebApp.AudioController.init}};DigiWebApp.AudioPage.content.grid.button.registerEvents();break;case "stop":DigiWebApp.AudioPage.content.audioIcon.events={tap:{action:DigiWebApp.AudioController.playbackAudio}};DigiWebApp.AudioPage.content.audioIcon.registerEvents();document.getElementById(DigiWebApp.AudioPage.content.audioIcon.id).src="theme/images/icon_playbackAudio.png";break;default:DigiWebApp.AudioPage.content.audioIcon.events={tap:{action:DigiWebApp.AudioController.playbackAudio}};
DigiWebApp.AudioPage.content.audioIcon.registerEvents();document.getElementById(DigiWebApp.AudioPage.content.audioIcon.id).src="theme/images/icon_playbackAudio.png"}},onError:function(a){DigiWebApp.SettingsController.globalDebugMode&&console.log("onError");console.log("code: "+a.code+"\nmessage: "+a.message+"\n");console.log("Filename: "+this.myFilename);DigiWebApp.AudioPage.content.audioIcon.events={tap:{action:DigiWebApp.AudioController.playbackAudio}};DigiWebApp.AudioPage.content.audioIcon.registerEvents();
document.getElementById(DigiWebApp.AudioPage.content.audioIcon.id).src="theme/images/icon_playbackAudio.png";DigiWebApp.AudioPage.content.grid.button.events={tap:{action:DigiWebApp.AudioController.init}};DigiWebApp.AudioPage.content.grid.button.registerEvents()},recordAudio:function(){this.myState="record";DigiWebApp.AudioController.myAudioObject.startRecord();DigiWebApp.AudioPage.content.audioIcon.events={tap:{action:DigiWebApp.AudioController.stopRecord}};DigiWebApp.AudioPage.content.audioIcon.registerEvents();
document.getElementById(DigiWebApp.AudioPage.content.audioIcon.id).src="theme/images/icon_stop.png";DigiWebApp.AudioPage.content.grid.button.events={tap:{action:DigiWebApp.AudioController.init}};DigiWebApp.AudioPage.content.grid.button.registerEvents();DigiWebApp.SettingsController.globalDebugMode&&console.log("recordAudio");DigiWebApp.SettingsController.globalDebugMode&&console.log("this.myState = "+this.myState)},stopRecord:function(){this.myState="stop";DigiWebApp.AudioController.myAudioObject.stopRecord();
DigiWebApp.AudioPage.content.audioIcon.events={tap:{action:DigiWebApp.AudioController.playbackAudio}};DigiWebApp.AudioPage.content.audioIcon.registerEvents();document.getElementById(DigiWebApp.AudioPage.content.audioIcon.id).src="theme/images/icon_playbackAudio.png";DigiWebApp.SettingsController.globalDebugMode&&console.log("stopRecord");DigiWebApp.SettingsController.globalDebugMode&&console.log("this.myState = "+this.myState)},playbackAudio:function(){this.myState="play";DigiWebApp.AudioController.myAudioObject.play();
DigiWebApp.AudioPage.content.audioIcon.events={tap:{action:DigiWebApp.AudioController.stopPlayback}};DigiWebApp.AudioPage.content.audioIcon.registerEvents();document.getElementById(DigiWebApp.AudioPage.content.audioIcon.id).src="theme/images/icon_stop.png";DigiWebApp.SettingsController.globalDebugMode&&console.log("playbackAudio");DigiWebApp.SettingsController.globalDebugMode&&console.log("this.myState = "+this.myState)},stopPlayback:function(){this.myState="stop";DigiWebApp.AudioController.myAudioObject.stop();
DigiWebApp.AudioPage.content.audioIcon.events={tap:{action:DigiWebApp.AudioController.playbackAudio}};DigiWebApp.AudioPage.content.audioIcon.registerEvents();document.getElementById(DigiWebApp.AudioPage.content.audioIcon.id).src="theme/images/icon_playbackAudio.png";DigiWebApp.SettingsController.globalDebugMode&&console.log("stopPlayback");DigiWebApp.SettingsController.globalDebugMode&&console.log("this.myState = "+this.myState)}});
DigiWebApp.OrderInfoController=M.Controller.extend({orders:null,positions:null,activeOrder:null,activePosition:null,items:[],init:function(){DigiWebApp.OrderInfoController.set("activeOrder",null);DigiWebApp.OrderInfoController.set("activePosition",null);DigiWebApp.OrderInfoController.set("items",[]);var a=DigiWebApp.HandOrder.findSorted().concat(DigiWebApp.Order.findSorted()),b=DigiWebApp.Position.findSorted(),c=NO;a=_.map(a,function(d){if(d){var f={label:d.get("name"),value:d.get("id")};if(DigiWebApp.BookingController.currentBooking!==
null)if(f.value===DigiWebApp.BookingController.currentBooking.get("orderId")||f.value===DigiWebApp.BookingController.currentBooking.get("handOrderId")){c=f.isSelected=YES;DigiWebApp.OrderInfoController.set("activeOrder",[d])}return f}});a=_.compact(a);c===NO&&a.push({label:M.I18N.l("selectSomething"),value:"0",isSelected:!c});c=NO;b=_.map(b,function(d){if(d){if(DigiWebApp.OrderInfoController.activeOrder!==null){if(d.get("orderId")!==DigiWebApp.OrderInfoController.activeOrder[0].get("id"))return null}else return null;
var f={label:d.get("name"),value:d.get("id")};if(DigiWebApp.BookingController.currentBooking!==null)if(f.value===DigiWebApp.BookingController.currentBooking.get("positionId")){c=f.isSelected=YES;DigiWebApp.OrderInfoController.set("activePosition",[d])}return f}});b=_.compact(b);c===NO&&b.push({label:M.I18N.l("selectSomething"),value:"0",isSelected:!c});this.set("orders",a);this.set("positions",b);this.setItem()},setItem:function(){var a={orderName:"",positionName:"",positionStrasse:"",positionHausnummer:"",
positionPLZ:"",positionOrt:"",positionLand:"",positionStrasseUndHausnummer:"",positionPLZundOrt:"",positionCountryCode:"",positionTelefon:"",positionFax:"",positionEmail:"",positionAnsprechpartner:"",positionKundenname:"",positionLongitude:"",positionLatitude:"",positionBeschreibung:""};if(DigiWebApp.OrderInfoController.activeOrder!==null)a.orderName=DigiWebApp.OrderInfoController.activeOrder[0].get("name");if(DigiWebApp.OrderInfoController.activePosition!==null){a.positionName=DigiWebApp.OrderInfoController.activePosition[0].get("name");
a.positionStrasse=DigiWebApp.OrderInfoController.activePosition[0].get("strasse");a.positionHausnummer=DigiWebApp.OrderInfoController.activePosition[0].get("hausnummer");a.positionPLZ=DigiWebApp.OrderInfoController.activePosition[0].get("plz");a.positionOrt=DigiWebApp.OrderInfoController.activePosition[0].get("ort");a.positionLand=DigiWebApp.OrderInfoController.activePosition[0].get("land");a.positionTelefon=DigiWebApp.OrderInfoController.activePosition[0].get("telefon");a.positionFax=DigiWebApp.OrderInfoController.activePosition[0].get("fax");
a.positionEmail=DigiWebApp.OrderInfoController.activePosition[0].get("email");a.positionAnsprechpartner=DigiWebApp.OrderInfoController.activePosition[0].get("ansprechpartner");a.positionKundenname=DigiWebApp.OrderInfoController.activePosition[0].get("kundenname");a.positionLongitude=DigiWebApp.OrderInfoController.activePosition[0].get("longitude");a.positionLatitude=DigiWebApp.OrderInfoController.activePosition[0].get("latitude");a.positionBeschreibung=DigiWebApp.OrderInfoController.activePosition[0].get("description");
a.positionCountryCode=DigiWebApp.OrderInfoController.activePosition[0].get("countrycode");a.positionPLZundOrt=a.positionPLZ+" "+a.positionOrt;a.positionStrasseUndHausnummer=a.positionStrasse+" "+a.positionHausnummer}a.orderName===""&&a.positionName===""?DigiWebApp.OrderInfoController.set("items",[]):DigiWebApp.OrderInfoController.set("items",[a])},setPositions:function(){var a=M.ViewManager.getView("orderInfoPage","order").getSelection(YES).value;if(a){var b=DigiWebApp.Position.findSorted(),c=0;b=
_.map(b,function(d){if(d){if(d.get("orderId")===a){var f={label:d.get("name"),value:d.get("id")};if(c===0){f.isSelected=YES;DigiWebApp.OrderInfoController.set("activePosition",[d])}c+=1;return f}return null}});b=_.compact(b);if(b.length<1){b.push({label:M.I18N.l("noData"),value:"0"});DigiWebApp.OrderInfoController.set("activePosition",null)}M.ViewManager.getView("orderInfoPage","position").resetSelection();this.set("positions",b);this.setItem()}},saveAsContact:function(){if(typeof navigator.contacts===
"undefined")DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("saveAsContact"),message:M.I18N.l("noContactsAvailable")});else{var a=DigiWebApp.OrderInfoController.items[0],b=new ContactFindOptions;b.filter=a.orderName+", "+a.positionName;DigiWebApp.ApplicationController.DigiLoaderView.show(M.I18N.l("saveAsContact"));navigator.contacts.find(["displayName","name","givenName","familyName"],DigiWebApp.OrderInfoController.saveAsContactFound,DigiWebApp.OrderInfoController.saveAsContactFoundError,
b)}},saveAsContactFound:function(a){var b=DigiWebApp.OrderInfoController.items[0];DigiWebApp.ApplicationController.DigiLoaderView.hide();if(typeof a==="undefined"){b=navigator.contacts.create({displayName:M.I18N.l("orderInfo")+" "+b.orderName});return DigiWebApp.OrderInfoController.saveAsContactSave(b)}else if(a.length===0){b=navigator.contacts.create({displayName:M.I18N.l("orderInfo")+" "+b.orderName+", "+b.positionName});return DigiWebApp.OrderInfoController.saveAsContactSave(b)}else if(a.length>
1)DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("saveAsContact"),message:M.I18N.l("contactExistsMultiple")});else{b=M.I18N.l("saveAsContactChangeQuestionMsg");DigiWebApp.ApplicationController.nativeConfirmDialogView({title:M.I18N.l("saveAsContactChangeQuestionTitle"),message:b,confirmButtonValue:M.I18N.l("yes"),cancelButtonValue:M.I18N.l("no"),callbacks:{confirm:{target:this,action:function(){a[0].remove(DigiWebApp.OrderInfoController.contactRemoveSuccess,DigiWebApp.OrderInfoController.contactRemoveError)}},
cancel:{target:this,action:function(){}}}})}},contactRemoveSuccess:function(){var a=DigiWebApp.OrderInfoController.items[0];a=navigator.contacts.create({displayName:M.I18N.l("orderInfo")+" "+a.orderName});return DigiWebApp.OrderInfoController.saveAsContactSave(a)},contactRemoveError:function(){DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("saveAsContact"),message:M.I18N.l("saveAsContactChangeErrorMsg")})},saveAsContactFoundError:function(){DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("saveAsContact"),
message:M.I18N.l("error")})},saveAsContactSave:function(a){var b=DigiWebApp.OrderInfoController.items[0],c=new ContactName;c.givenName=M.I18N.l("orderInfo");c.familyName=b.orderName+", "+b.positionName;c.honorificPrefix="DIGI-WebApp";a.name=c;c=[];var d="",f="";try{d=b.positionTelefon}catch(e){}try{f=b.positionFax}catch(g){}c[0]=new ContactField("work",d,true);c[1]=new ContactField("fax",f,false);a.phoneNumbers=c;c=[];d="";try{d=b.positionEmail}catch(k){}c[0]=new ContactField("work",d,true);a.emails=
c;c=new ContactAddress;c.type="Work";c.streetAddress=b.positionStrasseUndHausnummer;c.locality=b.positionOrt;c.postalCode=b.positionPLZ;c.country=b.positionLand;if(a.addresses===null)a.addresses=[c];else a.addresses[0]=c;c=new Date;a.note=b.positionBeschreibung+" ("+M.I18N.l("contactLastChange")+": "+c.toString()+")";DigiWebApp.ApplicationController.DigiLoaderView.show(M.I18N.l("saveAsContact"));a.save(DigiWebApp.OrderInfoController.saveAsContactSuccess,DigiWebApp.OrderInfoController.saveAsContactError)},
saveAsContactSuccess:function(){DigiWebApp.ApplicationController.DigiLoaderView.hide()},saveAsContactError:function(){DigiWebApp.ApplicationController.DigiLoaderView.hide()}});
DigiWebApp.RequestController=M.Controller.extend({GatewayServer:"www.digi-gps.de",DatabaseServer:null,handy2WebServicesUrl:"/Handy2WebServices/services/DatenTransfer",successCallback:{},errorCallback:{},softwareVersion:2845,makeRequest:function(a){var b=this;M.Request.init({url:"http://"+DigiWebApp.RequestController.DatabaseServer+DigiWebApp.RequestController.handy2WebServicesUrl+"/"+a.url+(a.urlParams?"?"+a.urlParams:""),method:"GET",beforeSend:function(c){a.loaderText?DigiWebApp.ApplicationController.DigiLoaderView.show(a.loaderText):
DigiWebApp.ApplicationController.DigiLoaderView.show("Lade Daten");c.setRequestHeader("Cache-Control","no-cache")},onSuccess:function(c,d,f){var e=NO;if(typeof a.leaveLoaderOpen!=="undefined")e=a.leaveLoaderOpen;e||DigiWebApp.ApplicationController.DigiLoaderView.hide();this.bindToCaller(b,b.handleSuccessCallback,[c,d,f,a.isWorkPlanRequest,a.isKolonnenRequest,a.source])()},onError:function(c,d){console.error("Error in makeRequest: "+d);DigiWebApp.ApplicationController.DigiLoaderView.hide();this.bindToCaller(b,
b.handleErrorCallback,[c,d,a.source])()}}).send()},getUrl:function(){try{if(device&&device.uuid)return"http://"+DigiWebApp.RequestController.DatabaseServer+DigiWebApp.RequestController.handy2WebServicesUrl+"/"}catch(a){return"/Handy2WebServices/services/DatenTransfer/"}},getDatabaseServer:function(a,b){DigiWebApp.RequestController.DatabaseServer="";var c=DigiWebApp.SettingsController.getSetting("company"),d=DigiWebApp.RequestController.GatewayServer;if(typeof device==="undefined")d=location.host;
M.Request.init({url:"http://"+d+DigiWebApp.RequestController.handy2WebServicesUrl+"/empfangeUrl?firmenId="+c+"&modus=0&requestTimestamp="+M.Date.now().date.valueOf(),method:"GET",beforeSend:function(f){DigiWebApp.ApplicationController.DigiLoaderView.show(M.I18N.l("empfangeUrlLoader"));f.setRequestHeader("Cache-Control","no-cache")},onSuccess:function(f){DigiWebApp.ApplicationController.DigiLoaderView.hide();f=DigiWebApp.RequestController.transformResultToJson(f);if(typeof f["return"]==="undefined"&&
typeof f["ns:return"]!=="undefined")f["return"]=f["ns:return"];if(f["return"]!=="")DigiWebApp.RequestController.DatabaseServer=f["return"];else{console.log("FALLBACK: empty DatabaseServer --\> falling back to GatewayServer");DigiWebApp.RequestController.DatabaseServer=DigiWebApp.RequestController.GatewayServer}if(typeof device==="undefined")location.host!==DigiWebApp.RequestController.DatabaseServer?DigiWebApp.ApplicationController.nativeConfirmDialogView({title:M.I18N.l("wrongServer"),message:M.I18N.l("wrongServerMessage"),
confirmButtonValue:M.I18N.l("yes"),cancelButtonValue:M.I18N.l("appZuruecksetzen"),callbacks:{confirm:{target:this,action:function(){location.href="http://"+DigiWebApp.RequestController.DatabaseServer+location.pathname}},cancel:{target:this,action:function(){DigiWebApp.ApplicationController.deleteAllData();if(typeof navigator.app!=="undefined")typeof location.origin!=="undefined"?navigator.app.loadUrl(location.origin+location.pathname):navigator.app.loadUrl(location.protocol+"//"+location.pathname);
else window.location.reload()}}}}):a(b);else a(b)},onError:function(f,e){console.error("Error in getDatabaseServer: "+e);DigiWebApp.ApplicationController.DigiLoaderView.hide();DigiWebApp.ApplicationController.proceedWithLocalData("getDatabaseServer")}}).send()},authenticate:function(a){DigiWebApp.RequestController.getDatabaseServer(DigiWebApp.RequestController.authenticateWithDatabaseServer,a)},authenticateWithDatabaseServer:function(a){DigiWebApp.RequestController.saveCallbacks(a.success,a.error,
"authenticate");var b=DigiWebApp.SettingsController.getSetting("company"),c=DigiWebApp.SettingsController.getSetting("password"),d=DigiWebApp.SettingsController.getSetting("workerId");b={url:"authentifizieren",urlParams:"firmenId="+b+"&kennwort="+c+"&geraeteId="+d+"&geraeteTyp=2&softwareVersion="+DigiWebApp.RequestController.softwareVersion+"&requestTimestamp="+M.Date.now().date.valueOf(),loaderText:M.I18N.l("authenticateLoader"),source:"authenticate"};DigiWebApp.RequestController.makeRequest(_.extend(a,
b))},endSession:function(a){this.saveCallbacks(a.success,a.error,"endSession");this.makeRequest(_.extend(a,{url:"beendeSession",urlParams:"modus=0&requestTimestamp="+M.Date.now().date.valueOf(),loaderText:M.I18N.l("logout"),source:"endSession"}))},getActivities:function(a){this.saveCallbacks(a.success,a.error,"getActivities");this.makeRequest(_.extend(a,{url:"empfangeTaetigkeiten",urlParams:"modus=1&requestTimestamp="+M.Date.now().date.valueOf(),loaderText:M.I18N.l("getActivitiesLoader"),source:"getActivities",
leaveLoaderOpen:YES}))},getOrders:function(a){this.saveCallbacks(a.success,a.error,"getOrders");this.makeRequest(_.extend(a,{url:"empfangeAuftraege",urlParams:"modus=0&requestTimestamp="+M.Date.now().date.valueOf(),loaderText:M.I18N.l("getOrdersLoader"),source:"getOrders",leaveLoaderOpen:YES}))},getFeatures:function(a){this.saveCallbacks(a.success,a.error,"getFeatures");this.makeRequest(_.extend(a,{url:"empfangeKonfiguration",urlParams:"modus=0&requestTimestamp="+M.Date.now().date.valueOf(),loaderText:M.I18N.l("getFeaturesLoader"),
source:"getFeatures",leaveLoaderOpen:YES}))},getPositions:function(a){this.saveCallbacks(a.success,a.error,"getPositions");this.makeRequest(_.extend(a,{url:"empfangePositionenInfo",urlParams:"modus=0&requestTimestamp="+M.Date.now().date.valueOf(),loaderText:M.I18N.l("getPositionsLoader"),source:"getPositions",leaveLoaderOpen:YES}))},getWorkPlans:function(a){this.saveCallbacks(a.success,a.error,"getWorkPlans");this.makeRequest(_.extend(a,{isWorkPlanRequest:YES,url:"empfangeArbeitsplanNeu",urlParams:"modus=0&requestTimestamp="+
M.Date.now().date.valueOf(),loaderText:M.I18N.l("getWorkPlansLoader"),source:"getWorkPlans",leaveLoaderOpen:YES}))},getHandOrders:function(a){this.saveCallbacks(a.success,a.error,"getHandOrders");this.makeRequest(_.extend(a,{url:"empfangeHandauftraege",urlParams:"modus=0&requestTimestamp="+M.Date.now().date.valueOf(),loaderText:M.I18N.l("getHandOrdersLoader"),source:"getHandOrders",leaveLoaderOpen:YES}))},getKolonne:function(a){this.saveCallbacks(a.success,a.error,"getKolonne");this.makeRequest(_.extend(a,
{isKolonnenRequest:YES,url:"empfangeKolonne",urlParams:"modus=0&requestTimestamp="+M.Date.now().date.valueOf(),loaderText:M.I18N.l("getKolonne"),source:"getKolonne",leaveLoaderOpen:YES}))},sendConfiguration:function(a){this.authenticate({success:{target:this,action:function(){var b=this;this.saveCallbacks(a.success,a.error,"sendConfiguration");var c='<soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/" xmlns:tran="http://transfer.webservice.handy2.digi.de" xmlns:xsd="http://transferClasses.data.handy2.digi.de/xsd"><soapenv:Header/><soapenv:Body><tran:sendeKonfiguration>';
c+=this.buildDataBodyConfiguration(a.settings);c+="   <tran:modus>0</tran:modus></tran:sendeKonfiguration></soapenv:Body></soapenv:Envelope>";M.Request.init({url:"http://"+DigiWebApp.RequestController.DatabaseServer+DigiWebApp.RequestController.handy2WebServicesUrl+".DatenTransferHttpSoap11Endpoint/",method:"POST",data:c,timeout:15E3,contentType:"text/xml; charset=UTF-8",dataType:"xml",beforeSend:function(d){a.loaderText?DigiWebApp.ApplicationController.DigiLoaderView.show(a.loaderText):DigiWebApp.ApplicationController.DigiLoaderView.show(M.I18N.l("sendConfigurationMsg"));
d.setRequestHeader("SOAPAction","urn:sendeKonfiguration");d.setRequestHeader("Content-Type","text/xml;charset=UTF-8")},onSuccess:function(d,f,e){b.endSession({success:{target:b,action:function(){DigiWebApp.ApplicationController.DigiLoaderView.hide();this.bindToCaller(this,this.handleSuccessCallback,[d,f,e,null,null,"sendConfiguration"])();DigiWebApp.ApplicationController.authenticate()}},error:{target:b,action:function(){DigiWebApp.ApplicationController.DigiLoaderView.hide();this.bindToCaller(this,
this.handleSuccessCallback,[d,f,e,null,null,"sendConfiguration"])();DigiWebApp.ApplicationController.authenticate()}}})},onError:function(d,f){b.endSession({success:{target:b,action:function(){DigiWebApp.ApplicationController.DigiLoaderView.hide();b.bindToCaller(b,b.handleErrorCallback,[d,f,"sendConfiguration"])();DigiWebApp.ApplicationController.authenticate()}},error:{target:b,action:function(){DigiWebApp.ApplicationController.DigiLoaderView.hide();b.bindToCaller(b,b.handleErrorCallback,[d,f,"sendConfiguration"])();
DigiWebApp.ApplicationController.authenticate()}}})}}).send()}},error:{target:this,action:function(){DigiWebApp.ApplicationController.authenticate();console.error("ConnectionError while sendConfiguration")}}})},sendData:function(a,b,c){this.authenticate({success:{target:this,action:function(){var d=this;this.saveCallbacks(a.success,a.error,"sendData");var f='<soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/" xmlns:tran="http://transfer.webservice.handy2.digi.de" xmlns:xsd="http://transferClasses.data.handy2.digi.de/xsd"><soapenv:Header/><soapenv:Body><tran:sendeDaten>';
f+=this.buildDataBodyBookings(a.bookings);var e=this.buildEmployeeBody();f+=e;f+="   <tran:modus>0</tran:modus></tran:sendeDaten></soapenv:Body></soapenv:Envelope>";M.Request.init({url:"http://"+DigiWebApp.RequestController.DatabaseServer+DigiWebApp.RequestController.handy2WebServicesUrl+".DatenTransferHttpSoap11Endpoint/",method:"POST",data:f,timeout:15E3,contentType:"text/xml; charset=UTF-8",dataType:"xml",beforeSend:function(g){a.loaderText?DigiWebApp.ApplicationController.DigiLoaderView.show(a.loaderText):
DigiWebApp.ApplicationController.DigiLoaderView.show(M.I18N.l("sendDataMsg"));g.setRequestHeader("SOAPAction","urn:sendeDaten");g.setRequestHeader("Content-Type","text/xml;charset=UTF-8")},onSuccess:function(g,k,h){d.endSession({success:{target:d,action:function(){DigiWebApp.ApplicationController.DigiLoaderView.hide();this.bindToCaller(this,this.handleSuccessCallback,[g,k,h,null,null,"sendData"])();if(DigiWebApp.SettingsController.getSetting("autoSyncAfterBookTime")||c===true)DigiWebApp.ApplicationController.startsync(YES)}},
error:{target:d,action:function(){DigiWebApp.ApplicationController.DigiLoaderView.hide();this.bindToCaller(this,this.handleSuccessCallback,[g,k,h,null,null,"sendData"])();DigiWebApp.ApplicationController.init(YES)}}})},onError:function(g,k){d.endSession({success:{target:d,action:function(){DigiWebApp.ApplicationController.DigiLoaderView.hide();d.bindToCaller(d,d.handleErrorCallback,[g,k,"sendData"])()}},error:{target:d,action:function(){DigiWebApp.ApplicationController.DigiLoaderView.hide();d.bindToCaller(d,
d.handleErrorCallback,[g,k,"sendData"])()}}})}}).send()}},error:{target:this,action:function(){if(b){DigiWebApp.EmployeeController.getEmployeeState()==2&&DigiWebApp.EmployeeController.setEmployeeState(1);localStorage.removeItem(DigiWebApp.EmployeeController.empSelectionKey);localStorage.removeItem(DigiWebApp.EmployeeController.empSelectionKeyTmp)}this.connectionError()}}})},buildDataBodyBookings:function(a){var b="",c="";c+="   <tran:zeitdatenHandy>\n";c+="       <xsd:auftragsId><orderId></xsd:auftragsId>\n";
c+="       <xsd:von><timeStampStart></xsd:von>\n";c+="       <xsd:bis><timeStampEnd></xsd:bis>\n";c+="       <xsd:gpsBreite><latitude></xsd:gpsBreite>\n";c+="       <xsd:gpsLaenge><longitude></xsd:gpsLaenge>\n";c+="       <xsd:handauftrag><handOrderName></xsd:handauftrag>\n";c+="       <xsd:handauftragsId><handOrderId></xsd:handauftragsId>\n";c+="       <xsd:positonsId><positionId></xsd:positonsId>\n";c+="       <xsd:taetigkeitsId><activityId></xsd:taetigkeitsId>\n";c+="       <xsd:bemerkungsfeld><remark></xsd:bemerkungsfeld>\n";
c+="   </tran:zeitdatenHandy>\n";if(typeof a==="object"&&!_.isArray(a))a=[a];if(_.isArray(a))for(var d in a){var f=a[d],e=c,g;for(g in f.record)g==="_createdAt"||g==="_updatedAt"||(e=g==="handOrderName"?e.replace(RegExp("<"+g+">"),f.get(g)==="0"?"":f.get(g)):g==="orderId"?e.replace(RegExp("<"+g+">"),f.get(g)===f.get("handOrderName")||f.get("handOrderName")!==""?"0":f.get(g)):g==="handOrderId"?e.replace(RegExp("<"+g+">"),f.get(g)===f.get("handOrderName")?"":f.get(g)):g==="fileName"?e.replace(/<signature>/,
typeof f.signature==="undefined"?"":f.signature):e.replace(RegExp("<"+g+">"),f.get(g)));b+=e}for(;b.match(/><.*<\/xsd:/)!==null;)b=b.replace(/><.*<\/xsd:/,"></xsd:");return b},buildDataBodyConfiguration:function(a){var b="";if(typeof a==="object"&&!_.isArray(a))a=[a];var c=+new Date;if(_.isArray(a))for(var d in a){var f=a[d],e;for(e in f.record){var g="   <tran:konfigurationHandy>\n       <xsd:keyId><keyId></xsd:keyId>\n       <xsd:value><value></xsd:value>\n       <xsd:valueType><valueType></xsd:valueType>\n       <xsd:mitarbeiter><mitarbeiter></xsd:mitarbeiter>\n       <xsd:timestamp><timestamp></xsd:timestamp>\n   </tran:konfigurationHandy>\n";
if(!(e==="_createdAt"||e==="_updatedAt")){g=g.replace(/<keyId>/,e);g=g.replace(/<value>/,f.get(e));g=g.replace(/<valueType>/,"SettingRemote_WebApp");g=g.replace(/<mitarbeiter>/,DigiWebApp.SettingsController.getSetting("workerId"));g=g.replace(/<timestamp>/,c);b+=g}}}for(;b.match(/><.*<\/xsd:/)!==null;)b=b.replace(/><.*<\/xsd:/,"></xsd:");return b},buildEmployeeBody:function(){var a="",b=localStorage.getItem(DigiWebApp.EmployeeController.empSelectionKey)||localStorage.getItem(DigiWebApp.EmployeeController.empSelectionKeyTmp);
if(b)b=b.split(",");if(b&&b!="null"&&_.isArray(b)&&b.length>0){_.each(b,function(c){a+="   <tran:mitarbeiterIds><mitarbeiterIds></tran:mitarbeiterIds>\n".replace(/<mitarbeiterIds>/,c)});return a}else return"<tran:mitarbeiterIds>0</tran:mitarbeiterIds>\n"},handleSuccessCallback:function(a,b,c,d,f,e){var g=null;if(!d&&!f)g=this.transformResultToJson(a);else if(d)g=this.transformWorkPlanXmlToJson(a);else if(f)g=this.transformKolonneXmlToJson(a);M.EventDispatcher.checkHandler(this.successCallback[e]);
this.successCallback[e].target=this.successCallback[e].target||this;this.bindToCaller(this.successCallback[e].target,this.successCallback[e].action,[g,b,c])()},handleErrorCallback:function(a,b,c){M.EventDispatcher.checkHandler(this.errorCallback[c]);this.errorCallback[c].target=this.errorCallback[c].target||this;this.bindToCaller(this.errorCallback[c].target,this.errorCallback[c].action,[a,b])()},saveCallbacks:function(a,b,c){if(a)this.successCallback[c]=a;if(b)this.errorCallback[c]=b},transformResultToJson:function(a){return $.xml2json(a)},
transformWorkPlanXmlToJson:function(a){var b={};b["return"]=[];a=$.parseXML(a);YES||$(a).find("return").length!==a.documentElement.childNodes.length?_.forEach(a.documentElement.childNodes,function(c){var d={};d.positionen=[];d.taetigkeitsIds=[];var f=(c.childNodes.length-2)/2,e=c.childNodes[0].childNodes[0].nodeValue,g=c.childNodes[1].childNodes[0].nodeValue;for(j=2;j<f+2;j++){var k=c.childNodes[j].childNodes[0].nodeValue,h=c.childNodes[j+f].childNodes[0].nodeValue;d.arbeitsplanId=e;d.arbeitsplanTyp=
g;d.positionen.push(k);d.taetigkeitsIds.push(h)}b["return"].push(d)}):$(a).find("return").each(function(c,d){var f={};$(d).find('[localName$="arbeitsplanId"]').each(function(e,g){f.arbeitsplanId=$(g).text()});$(d).find('[localName$="arbeitsplanTyp"]').each(function(e,g){f.arbeitsplanTyp=$(g).text()});f.positionen=[];$(d).find('[localName$="positionTaetigkeit"]').each(function(e,g){f.positionen.push($(g).text())});f.taetigkeitsIds=[];$(d).find('[localName$="tateigkeitId"]').each(function(e,g){f.taetigkeitsIds.push($(g).text())});
b["return"].push(f)});return b},transformKolonneXmlToJson:function(a){var b={};b["return"]=[];a=$.parseXML(a);YES||$(a).find("return").length!==a.documentElement.childNodes.length?_.forEach(a.documentElement.childNodes,function(d){var f={};f.mitarbeiterIds=[];f.mitarbeiterName=[];var e=(d.childNodes.length-1)/2,g=d.childNodes[0].childNodes[0].nodeValue;for(j=1;j<=e;j++){var k=d.childNodes[j].childNodes[0].nodeValue,h=d.childNodes[j+e].childNodes[0].nodeValue;f.kolonnenId=g;f.mitarbeiterIds.push(k);
f.mitarbeiterName.push(h)}b["return"]=f}):$(a).find("return").each(function(d,f){var e={};$(f).find('[nodeName$="kolonnenId"]').each(function(g,k){e.kolonnenId=$(k).text()});e.mitarbeiterIds=[];$(f).find('[nodeName$="mitarbeiterId"]').each(function(g,k){e.mitarbeiterIds.push($(k).text())});e.mitarbeiterName=[];$(f).find('[nodeName$="mitarbeiterName"]').each(function(g,k){e.mitarbeiterName.push($(k).text())});b["return"]=e});if(b["return"]&&b["return"].mitarbeiterIds){a=[];for(var c in b["return"].mitarbeiterIds)a.push({kolonnenId:b["return"].kolonnenId,
id:b["return"].mitarbeiterIds[c],name:b["return"].mitarbeiterName[c]});b["return"]=a;return b}else return null},connectionError:function(){DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("connectionError"),message:M.I18N.l("connectionErrorMsg")})}});
DigiWebApp.BookingController=M.Controller.extend({currentBooking:null,currentBookingClosed:null,currentBookingStr:"",isBackFromEmployeePage:NO,isBackFromRemarkPage:NO,timeData:null,timeDataSent:null,timeDataForEdit:null,timeDataSentDays:null,timeDataSentArchived:null,dayToDisplay:null,init:function(){var a=M.Environment.getPlatform();a.substr(0,10)!=="BlackBerry"&&a.substr(0,12)!=="Linux armv7l"&&DigiWebApp.ApplicationController.setTransitionsSetting();this.isBackFromRemarkPage||this.isBackFromEmployeePage?
this.refreshCurrentBooking(false):this.refreshCurrentBooking(true);if(this.isBackFromEmployeePage)DigiWebApp.BookingController.set("isBackFromEmployeePage",NO);else if(this.isBackFromRemarkPage)DigiWebApp.BookingController.set("isBackFromRemarkPage",NO);else if(DigiWebApp.SelectionController.useSelections)DigiWebApp.SelectionController.setSelectionByPreviousSelection();else if(DigiWebApp.SelectionController.showHandOrderFirst){DigiWebApp.SelectionController.showHandOrderFirst=NO;DigiWebApp.SelectionController.setSelectionWithCurrentHandOrderFirst()}else this.currentBooking?
DigiWebApp.SelectionController.setSelectionByCurrentBooking():DigiWebApp.SelectionController.initSelection()},refreshCurrentBooking:function(a){var b=DigiWebApp.Booking.find(),c=null;if(b.length>0)c=_.select(b,function(d){if(d)return d.get("isCurrent")===true});if(c&&c.length>0){this.set("currentBooking",c[0]);this.set("currentBookingStr",this.buildBookingStr(this.currentBooking));a&&DigiWebApp.SelectionController.setSelectionByCurrentBooking()}},book:function(){if(this.checkBooking())if(this.currentBooking)if(DigiWebApp.SettingsController.featureAvailable("403")){this.refreshCurrentBooking(false);
DigiWebApp.NavigationController.toRemarkPage(function(){DigiWebApp.BookingController.set("isBackFromRemarkPage",YES);DigiWebApp.NavigationController.backToBookTimePagePOP();DigiWebApp.ApplicationController.DigiLoaderView.hide();DigiWebApp.ApplicationController.DigiLoaderView.show(M.I18N.l("Save"));DigiWebApp.BookingController.bookWithRemark()})}else{DigiWebApp.ApplicationController.DigiLoaderView.hide();DigiWebApp.ApplicationController.DigiLoaderView.show(M.I18N.l("Save"));DigiWebApp.BookingController.bookWithRemark()}else{DigiWebApp.ApplicationController.DigiLoaderView.hide();
DigiWebApp.ApplicationController.DigiLoaderView.show(M.I18N.l("Save"));DigiWebApp.BookingController.bookWithRemark()}},bookWithRemark:function(){this.setNotBookedBookings();this.refreshCurrentBooking(false);if(DigiWebApp.EmployeeController.getEmployeeState()==1)if(!localStorage.getItem(DigiWebApp.EmployeeController.empSelectionKey)){DigiWebApp.NavigationController.toEmployeePage();return}this.getBookingLocation(this.proceedBooking)},getBookingLocation:function(a){var b=DigiWebApp.BookingController;
if(DigiWebApp.SettingsController.getSetting("autoSaveGPSData")){DigiWebApp.ApplicationController.DigiLoaderView.show(M.I18N.l("getGPSPositionMsg"));M.LocationManager.getLocation(b,a,function(c){if(c==="POSITION_UNAVAILABLE")DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("GPSError"),message:M.I18N.l("GPSunavailable")});else if(c==="TIMEOUT")DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("GPSError"),message:M.I18N.l("GPStimeout")});else c==="PERMISSION_DENIED"?
DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("GPSError"),message:M.I18N.l("GPSmissingPermission")}):DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("GPSError"),message:M.I18N.l("GPSunknownError")+c});a()},{enableHighAccuracy:true,timeout:24E4})}else a()},checkBooking:function(){var a=M.ViewManager.getView("bookingPage","order").getSelection();if(!a||a&&a==="0"){DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("noOrderSelected"),
message:M.I18N.l("noOrderSelectedMsg")});return false}else{if(this.isHandOrder(a)){if(!DigiWebApp.SelectionController.isActivitySelected()){DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("noActSelected"),message:M.I18N.l("noActSelectedMsg")});return false}}else if(DigiWebApp.SelectionController.isPositionSelected()){if(!DigiWebApp.SelectionController.isActivitySelected()){DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("noActSelected"),message:M.I18N.l("noActSelectedMsg")});
return false}}else{DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("noPosSelected"),message:M.I18N.l("noPosSelectedMsg")});return false}var b=M.ViewManager.getView("bookingPage","position").getSelection(YES);b=b?b.value:null;var c=M.ViewManager.getView("bookingPage","activity").getSelection(YES);c=c?c.value:null;if(this.currentBooking){var d=this.currentBooking.get("orderId"),f=this.currentBooking.get("handOrderId"),e=this.currentBooking.get("positionId"),g=this.currentBooking.get("activityId");
if(d===a||f===a){if(!this.isHandOrder(a)&&e===b&&g===c){DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("doubleBooking"),message:M.I18N.l("doubleBookingMsg")});return false}if(this.isHandOrder(a)&&g===c){DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("doubleBooking"),message:M.I18N.l("doubleBookingMsg")});return false}}return true}return true}},proceedBooking:function(a){var b=DigiWebApp.BookingController;DigiWebApp.ApplicationController.DigiLoaderView.hide();
var c=M.ViewManager.getView("bookingPage","order").getSelection(),d=M.ViewManager.getView("bookingPage","position").getSelection(YES);d=d?d.value:null;var f=M.ViewManager.getView("bookingPage","activity").getSelection(YES);f=f?f.value:null;if(b.currentBooking){b.currentBooking.get("orderId");b.currentBooking.closeBooking(a);b.currentBooking.removeAsCurrent();b.currentBooking.save();b.currentBookingClosed=b.currentBooking}var e=null,g=null;if(b.isHandOrder(c)){e=c;g=_.select(DigiWebApp.HandOrder.findSorted(),
function(n){if(n)return n.get("id")===c||n.get("name")===c})[0].get("name");d=c=null}var k="0",h="0";if(a){if(a.latitude)k=a.latitude;if(a.longitude)h=a.longitude}try{M.ViewManager.getView("remarkPage","remarkInput").value=""}catch(l){}remarkStr="";b.set("currentBooking",b.openBooking({oId:c,hoId:e,hoName:g,lat:k,lon:h,pId:d,aId:f,remark:remarkStr}));b.currentBooking.setAsCurrent();b.currentBooking.save();b.set("currentBookingStr",b.buildBookingStr(b.currentBooking));DigiWebApp.SelectionController.useSelections=
NO;if(b.autoSend())b.sendCurrentBookings();else{DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("bookingSaved"),message:M.I18N.l("bookingSavedMsg"),callbacks:{confirm:{target:DigiWebApp.NavigationController,action:"backToBookTimePagePOP"}}});try{$.mobile.fixedToolbars.show()}catch(m){}}},sendCurrentBookings:function(){DigiWebApp.BookingController.sendBookings()},isHandOrder:function(a){return _.select(DigiWebApp.HandOrder.findSorted(),function(b){if(b)return b.get("id")==a||
b.get("name")==a}).length>0?YES:NO},autoSend:function(){return DigiWebApp.SettingsController.getSetting("autoTransferAfterBookTime")},openBooking:function(a){var b=M.I18N.l("notDefined"),c=M.I18N.l("notDefined"),d=M.I18N.l("notDefined");try{var f=a.oId,e=a.hoId;if(f!==null||e!=null){var g=_.select(DigiWebApp.Order.findSorted().concat(DigiWebApp.HandOrder.findSorted()),function(m){if(m){m=m.get("id");return f==m||e==m}});if(g&&g.length>0){g=g[0];b=g.get("name")}}}catch(k){}try{if(a.pId!==0)c=DigiWebApp.Position.find({query:{identifier:"id",
operator:"=",value:a.pId}})[0].get("name")}catch(h){}try{if(a.aId!==0)d=DigiWebApp.Activity.find({query:{identifier:"id",operator:"=",value:a.aId}})[0].get("name")}catch(l){}return DigiWebApp.Booking.createRecord({orderId:a.oId?a.oId:"0",orderName:b,handOrderId:a.hoId?a.hoId:"0",handOrderName:a.hoName?a.hoName:"0",latitude:a.lat?a.lat:"0",longitude:a.lon?a.lon:"0",latitude_bis:a.lat?a.lat:"0",longitude_bis:a.lon?a.lon:"0",positionId:a.pId?a.pId:"0",positionName:c,activityId:a.aId?a.aId:"0",activityName:d,
remark:a.remark?a.remark:"",timeStampStart:+new Date,timeStampEnd:"0"})},sentBooking:function(a){var b=M.I18N.l("notDefined"),c=M.I18N.l("notDefined"),d=M.I18N.l("notDefined");if(typeof a.get("orderName")!=="undefined")b=a.get("orderName");else try{var f=a.get("orderId"),e=a.get("handOrderId");if(f!==0||e!==0){var g=_.select(DigiWebApp.Order.findSorted().concat(DigiWebApp.HandOrder.findSorted()),function(m){if(m){m=m.get("id");return f==m||e==m}});if(g&&g.length>0){g=g[0];b=g.get("name")}}}catch(k){}if(typeof a.get("positionName")!==
"undefined")c=a.get("positionName");else try{if(a.get("positionId")!==0)c=DigiWebApp.Position.find({query:{identifier:"id",operator:"=",value:a.get("positionId")}})[0].get("name")}catch(h){}if(typeof a.get("activityName")!=="undefined")d=a.get("activityName");else try{if(a.get("activityId")!==0)d=DigiWebApp.Activity.find({query:{identifier:"id",operator:"=",value:a.get("activityId")}})[0].get("name")}catch(l){}return DigiWebApp.SentBooking.createRecord({orderId:a.get("orderId"),orderName:b,handOrderId:a.get("handOrderId"),
handOrderName:a.get("handOrderName"),latitude:a.get("latitude"),longitude:a.get("longitude"),latitude_bis:a.get("latitude_bis"),longitude_bis:a.get("longitude_bis"),positionId:a.get("positionId"),positionName:c,activityId:a.get("activityId"),activityName:d,remark:a.get("remark"),timeStampStart:a.get("timeStampStart"),timeStampEnd:a.get("timeStampEnd"),isCurrent:false})},sentBookingArchived:function(a){var b=D8.create(a.get("timeStampStart")).format("dd.mm.yyyy"),c=M.I18N.l("notDefined"),d=M.I18N.l("notDefined"),
f=M.I18N.l("notDefined");if(typeof a.get("orderName")!=="undefined")c=a.get("orderName");else try{var e=a.get("orderId"),g=a.get("handOrderId");if(e!==0||g!==0){var k=_.select(DigiWebApp.Order.findSorted().concat(DigiWebApp.HandOrder.findSorted()),function(n){if(n){n=n.get("id");return e==n||g==n}});if(k&&k.length>0){k=k[0];c=k.get("name")}}}catch(h){}if(typeof a.get("positionName")!=="undefined")d=a.get("positionName");else try{if(a.get("positionId")!==0)d=DigiWebApp.Position.find({query:{identifier:"id",
operator:"=",value:a.get("positionId")}})[0].get("name")}catch(l){}if(typeof a.get("activityName")!=="undefined")f=a.get("activityName");else try{if(a.get("activityId")!==0)f=DigiWebApp.Activity.find({query:{identifier:"id",operator:"=",value:a.get("activityId")}})[0].get("name")}catch(m){}return DigiWebApp.SentBookingArchived.createRecord({orderId:a.get("orderId"),orderName:c,handOrderId:a.get("handOrderId"),handOrderName:a.get("handOrderName"),latitude:a.get("latitude"),longitude:a.get("longitude"),
latitude_bis:a.get("latitude_bis"),longitude_bis:a.get("longitude_bis"),positionId:a.get("positionId"),positionName:d,activityId:a.get("activityId"),activityName:f,remark:a.get("remark"),timeStampStart:a.get("timeStampStart"),timeStampEnd:a.get("timeStampEnd"),tagLabel:b,isCurrent:false})},setNotBookedBookings:function(){try{var a=DigiWebApp.Booking.find();if(a.length>0){_.each(a,function(c){c.set("date",c.get("timeStampStart")+","+c.get("timeStampEnd"));c.get("orderId")==="0"&&c.get("handOrderId")!==
"0"&&c.set("orderId",c.get("handOrderId"))});a=_.sortBy(a,function(c){return parseInt(c.get("timeStampStart"))});this.set("timeData",a.reverse())}else this.set("timeData",[])}catch(b){this.set("timeData",[])}DigiWebApp.BookingController.setBookedBookings();DigiWebApp.BookingController.setArchivedDays()},setBookedBookings:function(){try{var a=DigiWebApp.SentBooking.find();if(a.length>0){_.each(a,function(c){c.set("date",c.get("timeStampStart")+","+c.get("timeStampEnd"));c.get("orderId")==="0"&&c.get("handOrderId")!==
"0"&&c.set("orderId",c.get("handOrderId"))});a=_.sortBy(a,function(c){return parseInt(c.get("timeStampStart"))});this.set("timeDataSent",a.reverse())}else this.set("timeDataSent",[])}catch(b){this.set("timeDataSent",[])}},setArchivedDays:function(){try{var a=DigiWebApp.SentTimeDataDays.find();if(a.length>0){a=_.sortBy(a,function(c){return parseInt(D8.create(c.get("tagLabel")).getTimestamp())});this.set("timeDataSentDays",a.reverse())}else this.set("timeDataSentDays",[])}catch(b){this.set("timeDataSentDays",
[])}},setArchivedBookings:function(){try{if(DigiWebApp.BookingController.dayToDisplay!==null){var a=DigiWebApp.SentBookingArchived.find({query:{identifier:"tagLabel",operator:"=",value:DigiWebApp.BookingController.dayToDisplay.get("tagLabel")}});if(a.length>0){_.each(a,function(c){c.set("date",c.get("timeStampStart")+","+c.get("timeStampEnd"));c.get("orderId")==="0"&&c.get("handOrderId")!=="0"&&c.set("orderId",c.get("handOrderId"))});a=_.sortBy(a,function(c){return parseInt(c.get("timeStampStart"))});
this.set("timeDataSentArchived",a.reverse())}else this.set("timeDataSentArchived",[])}else this.set("timeDataSentArchived",[])}catch(b){this.set("timeDataSentArchived",[])}},setTimeDataForRemark:function(){try{if(DigiWebApp.BookingController.currentBooking!==null){var a=[DigiWebApp.BookingController.currentBooking];if(a.length>0){_.each(a,function(c){c.set("date",c.get("timeStampStart")+","+c.get("timeStampEnd"));c.get("orderId")==="0"&&c.get("handOrderId")!=="0"&&c.set("orderId",c.get("handOrderId"))});
a=_.sortBy(a,function(c){return parseInt(c.get("timeStampStart"))});this.set("timeDataForEdit",a.reverse())}else this.set("timeDataForEdit",[])}}catch(b){this.set("timeDataForEdit",[])}},setTimeDataForEdit:function(){try{if(DigiWebApp.EditTimeDataPage.bookingToEdit!==null){var a=[DigiWebApp.EditTimeDataPage.bookingToEdit];if(a.length>0){_.each(a,function(c){c.set("date",c.get("timeStampStart")+","+c.get("timeStampEnd"));c.get("orderId")==="0"&&c.get("handOrderId")!=="0"&&c.set("orderId",c.get("handOrderId"))});
a=_.sortBy(a,function(c){return parseInt(c.get("timeStampStart"))});this.set("timeDataForEdit",a.reverse())}else this.set("timeDataForEdit",[])}}catch(b){this.set("timeDataForEdit",[])}},closeDay:function(){if(this.currentBooking)if(DigiWebApp.SettingsController.featureAvailable("403")){this.refreshCurrentBooking(false);DigiWebApp.NavigationController.toRemarkPage(function(){DigiWebApp.NavigationController.backToDashboardPagePOP();DigiWebApp.BookingController.closeDayWithRemark()})}else DigiWebApp.BookingController.closeDayWithRemark();
else DigiWebApp.BookingController.closeDayWithRemark()},closeDayWithRemark:function(){var a=DigiWebApp.BookingController;a.getBookingLocation(a.closeDayWithRemarkWithPosition)},closeDayWithRemarkWithPosition:function(a){var b=DigiWebApp.BookingController;if(b.currentBooking){b.currentBooking.closeBooking(a);b.currentBooking.removeAsCurrent();b.currentBooking.save();b.currentBookingClosed=b.currentBooking;b.currentBooking=null;b.set("currentBookingStr","");DigiWebApp.SelectionController.resetSelection();
DigiWebApp.SelectionController.initSelection();DigiWebApp.SelectionController.useSelections=NO;if(DigiWebApp.SettingsController.getSetting("autoTransferAfterClosingDay"))DigiWebApp.DashboardController.dataTransfer(YES);else{localStorage.setItem(DigiWebApp.EmployeeController.empSelectionKeyTmp,localStorage.getItem(DigiWebApp.EmployeeController.empSelectionKey));localStorage.removeItem(DigiWebApp.EmployeeController.empSelectionKey);DigiWebApp.EmployeeController.getEmployeeState()==2&&DigiWebApp.EmployeeController.setEmployeeState(1);
DigiWebApp.ApplicationController.DigiLoaderView.hide();DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("closingDaySuccess"),message:M.I18N.l("closingDaySuccessWithoutMsg")})}}else{DigiWebApp.ApplicationController.DigiLoaderView.hide();DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("error"),message:M.I18N.l("noOpenBookings")})}},loadSignatures:function(a,b){if(typeof b!=="function")console.error("loadSignaturesError: successCallback is not a function");
else{DigiWebApp.ApplicationController.DigiLoaderView.show(M.I18N.l("loadSignatures"));var c=a.length,d=0;if(c!==0)_.each(a,function(f){d+=1;if(f.hasFileName())f.readFromFile(function(e){e&&e!==""&&DigiWebApp.BookingController.propagateBookingWithSignature(a,f.m_id,e);if(d===c){DigiWebApp.ApplicationController.DigiLoaderView.hide();b()}});else if(d===c){DigiWebApp.ApplicationController.DigiLoaderView.hide();b()}});else{DigiWebApp.ApplicationController.DigiLoaderView.hide();b()}}},propagateBookingWithSignature:function(a,
b,c){_.each(a,function(d){if(d.m_id===b)d.signature=c})},sendBookings:function(a,b){var c=DigiWebApp.Booking.find();DigiWebApp.BookingController.loadSignatures(c,function(){DigiWebApp.BookingController.sendBookingsWithSignatures(c,a,b)})},sendBookingsWithSignatures:function(a,b,c){if(typeof c==="undefined")c=false;a.length>0&&DigiWebApp.RequestController.sendData({bookings:a,success:{target:this,action:function(){var d=false;_.each(DigiWebApp.Booking.find(),function(e){if(e.get("isCurrent"))d=true});
d||DigiWebApp.SentBooking.deleteAll();if(DigiWebApp.SettingsController.featureAvailable("411"))try{_.each(DigiWebApp.Booking.find(),function(e){if(!e.get("isCurrent")){DigiWebApp.BookingController.sentBookingArchived(e).save();var g=NO,k=D8.create(e.get("timeStampStart")).format("dd.mm.yyyy");_.each(DigiWebApp.SentTimeDataDays.find(),function(h){if(h.get("tagLabel")===k)g=YES});g===NO&&DigiWebApp.SentTimeDataDays.createRecord({tagLabel:k}).save()}});DigiWebApp.SentBookingArchived.deleteOld();DigiWebApp.SentTimeDataDays.deleteOld()}catch(f){DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("error"),
message:M.I18N.l("errorWhileArchivingBookings")})}_.each(DigiWebApp.Booking.find(),function(e){if(!e.get("isCurrent")){if(d)try{DigiWebApp.BookingController.sentBooking(e).save()}catch(g){DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("error"),message:M.I18N.l("errorWhileBackingUpBookings")})}e.del()}});DigiWebApp.SelectionController.resetSelection();this.currentBooking?DigiWebApp.SelectionController.setSelectionByCurrentBooking():DigiWebApp.SelectionController.initSelection();
if(b){this.set("currentBookingStr","");DigiWebApp.EmployeeController.getEmployeeState()==2&&DigiWebApp.EmployeeController.setEmployeeState(1);localStorage.removeItem(DigiWebApp.EmployeeController.empSelectionKey);localStorage.removeItem(DigiWebApp.EmployeeController.empSelectionKeyTmp)}}},error:{target:this,action:function(){DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("sendDataFail"),message:M.I18N.l("sendDataFailMsg")})}}},b,c)},buildBookingStr:function(){var a="";return a=
M.Date.create(this.currentBooking.get("timeStampStart")).format("dd.mm.yy HH:MM")}});
DigiWebApp.EditPicturePageController=M.Controller.extend({myMediaFile:null,orders:null,positions:null,activities:null,selections:{order:null,position:null,activity:null},deleteMediaFileFromLocalStorage:function(){var a=DigiWebApp.EditPicturePageController.myMediaFile;console.log(a);try{a.del()}catch(b){}DigiWebApp.ApplicationController.DigiLoaderView.hide();DigiWebApp.NavigationController.backToMediaListPageTransition()},init:function(){$("#"+DigiWebApp.EditPicturePage.content.remarkInput.id).val("");
M.ViewManager.getView("editPicturePage","remarkInput").value="";$("#"+DigiWebApp.EditPicturePage.content.remarkInput.id).val(this.myMediaFile.get("remark"));M.ViewManager.getView("editPicturePage","remarkInput").value=this.myMediaFile.get("remark");document.getElementById(DigiWebApp.EditPicturePage.content.image.id).src="";DigiWebApp.EditPicturePageController.myImageObj=new Image;this.myMediaFile.readFromFile(function(a){if(a&&a!=="")document.getElementById(DigiWebApp.EditPicturePage.content.image.id).src=
a});$("#"+DigiWebApp.EditPicturePage.content.savePictureGrid.id).show();DigiWebApp.EditPicturePageController.setSelectionByMediaFile();DigiWebApp.ApplicationController.DigiLoaderView.hide()},setSelectionByMediaFile:function(){var a=DigiWebApp.HandOrder.findSorted().concat(DigiWebApp.Order.findSorted()),b=DigiWebApp.Position.findSorted(),c=DigiWebApp.EditPicturePageController.getActivities(),d=this.myMediaFile.get("orderId"),f=this.myMediaFile.get("positionId"),e=this.myMediaFile.get("activityId"),
g=NO,k=null;k=_.map(a,function(l){var m=null;if(l)if(l.get("id")==d){m={label:l.get("name"),value:l.get("id"),isSelected:YES};g=YES}else m={label:l.get("name"),value:l.get("id")};return m});k=_.compact(k);k.push({label:M.I18N.l("selectSomething"),value:"0"});k=g===NO?_.map(k,function(l){var m=null;if(l)m=l.value==d?{label:l.label,value:l.value,isSelected:YES}:{label:l.label,value:l.value};return m}):k;k=_.compact(k);b=_.map(b,function(l){if(l){if(l.get("orderId")===d){var m=null;return m=l.get("id")===
f?{label:l.get("name"),value:l.get("id"),isSelected:YES}:{label:l.get("name"),value:l.get("id")}}return null}});b=_.compact(b);b.push({label:M.I18N.l("selectSomething"),value:"0"});c=_.select(DigiWebApp.WorkPlan.find(),function(l){if(l)return l.get("id")==f});var h=NO;c=c.length>0?this.getActivitiesFromWorkplan(c[0]):DigiWebApp.EditPicturePageController.getActivities();c=_.map(c,function(l){if(typeof l==="undefined"){console.log("UNDEFINED ACTIVITY");return null}else{var m=null;if(l.get("id")==e){m=
{label:l.get("name"),value:l.get("id"),isSelected:YES};h=YES}else m={label:l.get("name"),value:l.get("id")};return m}});c=_.compact(c);c.push({label:M.I18N.l("selectSomething"),value:"0",isSelected:!h});this.resetSelection();this.set("orders",k);this.set("positions",b);this.set("activities",c)},setPositions:function(){var a=M.ViewManager.getView("editPicturePage","order").getSelection(YES).value;if(a){var b=DigiWebApp.Position.findSorted(),c=0;b=_.map(b,function(d){if(d){if(d.get("orderId")===a){d=
{label:d.get("name"),value:d.get("id")};if(c===0)d.isSelected=YES;c+=1;return d}return null}});b=_.compact(b);b.length<1&&b.push({label:M.I18N.l("noData"),value:"0"});M.ViewManager.getView("editPicturePage","position").resetSelection();this.set("positions",b);this.setActivities(YES);this.saveSelection()}},setActivities:function(a){var b=null;if(a)if(a=M.ViewManager.getView("editPicturePage","position").getSelection(YES))b=a.value;a=[];b=DigiWebApp.WorkPlan.find({query:{identifier:"id",operator:"=",
value:b}});var c=0;a=b.length===1?this.getActivitiesFromWorkplan(b[0]):DigiWebApp.EditPicturePageController.getActivities();var d=false;_.each(a,function(f){if(typeof f==="undefined"){console.log("UNDEFINED ACTIVITY");return null}else if(f.get("id")===-1)d=true});a=_.map(a,function(f){if(typeof f==="undefined"){console.log("UNDEFINED ACTIVITY");return null}else{var e=null;e=d?{label:f.get("name"),value:f.get("id"),isSelected:f.get("id")===-1?YES:NO}:{label:f.get("name"),value:f.get("id"),isSelected:c===
0?YES:NO};c+=1;return e}});a=_.compact(a);a.length>0?a.push({label:M.I18N.l("selectSomething"),value:"0",isSelected:NO}):a.push({label:M.I18N.l("noData"),value:"0"});M.ViewManager.getView("editPicturePage","activity").resetSelection();this.set("activities",a);this.saveSelection()},initSelection:function(){var a=DigiWebApp.HandOrder.findSorted().concat(DigiWebApp.Order.findSorted()),b=DigiWebApp.Position.findSorted(),c=DigiWebApp.EditPicturePageController.getActivities(),d=[];if(a)d=_.map(a,function(f){if(f)return{label:f.get("name"),
value:f.get("id")}});d.push({label:M.I18N.l("selectSomething"),value:"0",isSelected:YES});a=[];if(b)a=_.map(b,function(f){if(f)return{label:f.get("name"),value:f.get("id")}});a.push({label:M.I18N.l("selectSomething"),value:"0",isSelected:YES});b=[];if(c)b=_.map(c,function(f){if(typeof f==="undefined"){console.log("UNDEFINED ACTIVITY");return null}else return obj={label:f.get("name"),value:f.get("id")}});b.push({label:M.I18N.l("selectSomething"),value:"0",isSelected:YES});this.resetSelection();this.set("orders",
d);this.set("positions",a);this.set("activities",b);M.ViewManager.getView("editPicturePage","order").setSelection("0");M.ViewManager.getView("editPicturePage","position").setSelection("0");M.ViewManager.getView("editPicturePage","activity").setSelection("0")},resetSelection:function(){M.ViewManager.getView("editPicturePage","order").resetSelection();M.ViewManager.getView("editPicturePage","position").resetSelection();M.ViewManager.getView("editPicturePage","activity").resetSelection()},isPositionSelected:function(){var a=
M.ViewManager.getView("editPicturePage","position").getSelection(YES);return a&&a.value!="0"?YES:NO},isActivitySelected:function(){var a=M.ViewManager.getView("editPicturePage","activity").getSelection(YES);return a&&a.value!="0"?YES:NO},saveSelection:function(){var a=M.ViewManager.getView("editPicturePage","order").getSelection(),b=M.ViewManager.getView("editPicturePage","position").getSelection(),c=M.ViewManager.getView("editPicturePage","activity").getSelection();this.selections.order=a;this.selections.position=
b;this.selections.activity=c;this.useSelections=YES},getActivities:function(a){a=a?DigiWebApp.Activity.find(a):DigiWebApp.Activity.findSorted();a=_.map(a,function(b){return b.get("positionId")==="1"?b:null});return a=_.compact(a)},getActivitiesFromWorkplan:function(a){var b=a.get("activityIds").split(","),c=[];if(b&&b.length>0)for(var d=0;d<b.length;d++)c.push(_.first(DigiWebApp.Activity.find({query:{identifier:"id",operator:"=",value:b[d]}})));if(a.get("workplanType")==="1")c=_.map(c,function(f){if(typeof f===
"undefined"){console.log("UNDEFINED ACTIVITY");return null}else{var e=NO,g=DigiWebApp.Activity.findSorted();_.each(g,function(k){if(k.get("positionId")==="1")e=YES});return e?f:null}});return c=_.compact(c)},savePicture:function(){this.saveSelection();var a=M.ViewManager.getView("editPicturePage","order").getSelection(),b=M.ViewManager.getView("editPicturePage","position").getSelection(YES);b=b?b.value:null;var c=M.ViewManager.getView("editPicturePage","activity").getSelection(YES),d=c?c.value:null,
f=null,e=null;if(DigiWebApp.BookingController.isHandOrder(a)){f=a;e=_.select(DigiWebApp.HandOrder.findSorted(),function(g){if(g)return g.get("id")===a||g.get("name")===a})[0].get("name");b=a=null}c=this.myMediaFile;c.set("orderId",a);c.set("handOrderId",f);c.set("handOrderName",e);c.set("positionId",b);c.set("activityId",d);c.set("remark",M.ViewManager.getView("editPicturePage","remarkInput").value);b=document.getElementById(DigiWebApp.EditPicturePage.content.image.id);c.set("fileType","image/jpeg;base64");
c.save();c.saveToFile(b.src,function(){DigiWebApp.ApplicationController.DigiLoaderView.hide();DigiWebApp.NavigationController.backToMediaListPageTransition()})}});
DigiWebApp.DemoMediaPageController=M.Controller.extend({events:{pagebeforeshow:{target:this,action:"init"}},items:null,latestId:null,init:function(){if(DigiWebApp.DemoMediaPage.needsUpdate){var a=[];if(DigiWebApp.SettingsController.featureAvailable("401")){DigiWebApp.SettingsController.globalDebugMode&&console.log("enabling Feature 401 (RecordAudio)");a.push({label:M.I18N.l("recordAudio"),icon:"icon_recordAudio.png",id:"audio"})}this.set("items",a);DigiWebApp.DemoMediaPage.needsUpdate=false}(a=M.ViewManager.getView("mediaPage",
"list"))&&$("#"+a.id).find("li").each(function(){$(this).removeClass("selected")})},itemSelected:function(a,b){this.latestId&&$("#"+this.latestId).removeClass("selected");$("#"+a).addClass("selected");this.latestId=a;b&&typeof this[b]==="function"&&this[b]()},camera:function(){DigiWebApp.NavigationController.toDemoCameraPageTransition()},audio:function(){DigiWebApp.NavigationController.toDemoAudioPageTransition()}});
DigiWebApp.OrderDetailsController=M.Controller.extend({positionForDetails:null,loadedPosition:null,init:function(a){var b=DigiWebApp.OrderDetailsController;b.items===null?DigiWebApp.RequestController.getDatabaseServer(b.initWithServer,a):b.initWithServer(a)},initWithServer:function(){var a=DigiWebApp.OrderDetailsController;if(a.positionForDetails===null){DigiWebApp.ApplicationController.DigiLoaderView.show(M.I18N.l("positionLaden"));DigiWebApp.OnlinePosition.find({urlParams:{},callbacks:{success:{action:function(b){DigiWebApp.ApplicationController.DigiLoaderView.hide();
if(b&&b.length===0||DigiWebApp.ZeitbuchungenController.itemForDetails.get("positionsId")==="0")DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("error"),message:M.I18N.l("positionKonnteNichtGeladenWerden"),callbacks:{confirm:{target:a,action:function(){DigiWebApp.NavigationController.backToZeitbuchungDetailsPageTransition()}}}});else{a.set("loadedPosition",b);a.setItem()}}},error:{action:function(){DigiWebApp.ApplicationController.DigiLoaderView.hide();DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("error"),
message:M.I18N.l("positionKonnteNichtGeladenWerden"),callbacks:{confirm:{target:a,action:function(){DigiWebApp.NavigationController.backToZeitbuchungDetailsPageTransition()}}}})}}}})}},setItem:function(){var a=DigiWebApp.OrderDetailsController,b={orderName:"",positionName:"",positionStrasse:"",positionHausnummer:"",positionPLZ:"",positionOrt:"",positionLand:"",positionStrasseUndHausnummer:"",positionPLZundOrt:"",positionCountryCode:"",positionTelefon:"",positionFax:"",positionEmail:"",positionAnsprechpartner:"",
positionKundenname:"",positionLongitude:"",positionLatitude:"",positionBeschreibung:""};b.orderName=a.loadedPosition[0].get("auftragsBezeichnung");b.positionName=a.loadedPosition[0].get("positionsBezeichnung");b.positionStrasse=a.loadedPosition[0].get("strasse");b.positionHausnummer=a.loadedPosition[0].get("hausnummer");b.positionPLZ=a.loadedPosition[0].get("plz");b.positionOrt=a.loadedPosition[0].get("ort");b.positionLand=a.loadedPosition[0].get("land");b.positionTelefon=a.loadedPosition[0].get("telefon");
b.positionFax=a.loadedPosition[0].get("fax");b.positionEmail=a.loadedPosition[0].get("email");b.positionAnsprechpartner=a.loadedPosition[0].get("ansprechpartner");b.positionKundenname=a.loadedPosition[0].get("kundenname");b.positionLongitude=a.loadedPosition[0].get("longitude");b.positionLatitude=a.loadedPosition[0].get("latitude");b.positionBeschreibung=a.loadedPosition[0].get("description");b.positionCountryCode=a.loadedPosition[0].get("countrycode");b.positionPLZundOrt=b.positionPLZ+" "+b.positionOrt;
b.positionStrasseUndHausnummer=b.positionStrasse+" "+b.positionHausnummer;b.orderName===""&&b.positionName===""?a.set("positionForDetails",[]):a.set("positionForDetails",[b])}});
DigiWebApp.WipeController=M.Controller.extend({wipeStartX:0,wipeStartY:0,wipeStopX:0,wipeStopY:0,wipeIsMoving:false,wipeIsPressed:false,wipeIsPressedStart:0,wipeIsPressedStop:0,wipeDecideX:150,wipeDecideY:300,wipeDecideTimeout:200,wipeActionUp:function(){},wipeActionDown:function(){if(M.ViewManager.currentPage.id!==DigiWebApp.TimeDataPage.id&&M.ViewManager.currentPage.id!==DigiWebApp.EditTimeDataPage.id&&M.ViewManager.currentPage.id!==DigiWebApp.SettingsPage.id&&M.ViewManager.currentPage.id!==DigiWebApp.CameraPage.id&&
M.ViewManager.currentPage.id!==DigiWebApp.EditPicturePage.id&&M.ViewManager.currentPage.id!==DigiWebApp.MediaListPage.id)try{if(typeof M.ViewManager.currentPage.header!=="undefined"&&M.ViewManager.currentPage.header!==null)if(typeof M.ViewManager.currentPage.header.backButton!=="undefined"&&M.ViewManager.currentPage.header.backButton!==null)if(typeof M.ViewManager.currentPage.header.backButton.events!=="undefined"&&M.ViewManager.currentPage.header.backButton.events!==null)if(typeof M.ViewManager.currentPage.header.backButton.events.tap!==
"undefined"&&M.ViewManager.currentPage.header.backButton.events.tap!==null)typeof M.ViewManager.currentPage.header.backButton.events.tap.action==="function"?M.ViewManager.currentPage.header.backButton.events.tap.action():M.ViewManager.currentPage.header.backButton.events.tap.target.get(M.ViewManager.currentPage.header.backButton.events.tap.action)()}catch(a){console.log(a)}},wipeActionLeft:function(){if(M.ViewManager.currentPage.id===DigiWebApp.BookingPage.id)DigiWebApp.NavigationController.toDashboardPageFlipTransition();
else M.ViewManager.currentPage.id===DigiWebApp.DashboardPage.id&&DigiWebApp.NavigationController.backToBookTimePageFlipTransition()},wipeActionRight:function(){if(M.ViewManager.currentPage.id===DigiWebApp.DashboardPage.id)DigiWebApp.NavigationController.toBookTimePageFlipTransition();else if(M.ViewManager.currentPage.id===DigiWebApp.BookingPage.id)DigiWebApp.NavigationController.backToDashboardPageFlipTransition();else if(M.ViewManager.currentPage.id!==DigiWebApp.EditTimeDataPage.id&&M.ViewManager.currentPage.id!==
DigiWebApp.CameraPage.id)try{if(typeof M.ViewManager.currentPage.header!=="undefined"&&M.ViewManager.currentPage.header!==null)if(typeof M.ViewManager.currentPage.header.backButton!=="undefined"&&M.ViewManager.currentPage.header.backButton!==null)if(typeof M.ViewManager.currentPage.header.backButton.events!=="undefined"&&M.ViewManager.currentPage.header.backButton.events!==null)if(typeof M.ViewManager.currentPage.header.backButton.events.tap!=="undefined"&&M.ViewManager.currentPage.header.backButton.events.tap!==
null)typeof M.ViewManager.currentPage.header.backButton.events.tap.action==="function"?M.ViewManager.currentPage.header.backButton.events.tap.action():M.ViewManager.currentPage.header.backButton.events.tap.target.get(M.ViewManager.currentPage.header.backButton.events.tap.action)()}catch(a){console.log(a)}},stopDefault:function(a){if(!navigator.userAgent.match(/Android/i)){a&&a.preventDefault&&a.preventDefault();if(window.event&&window.event.returnValue)window.event.returnValue=false}},wipeDoStop:function(a){var b=
DigiWebApp.WipeController.wipeStartX-DigiWebApp.WipeController.wipeStopX,c=DigiWebApp.WipeController.wipeStartY-DigiWebApp.WipeController.wipeStopY,d=DigiWebApp.WipeController.wipeIsPressedStart-DigiWebApp.WipeController.wipeIsPressedStop;try{$(this).unbind(a)}catch(f){console.log("error while unbind")}_.each(DigiWebApp.app.pages,function(l){try{$("#"+l.id).unbind("touchmove",DigiWebApp.WipeController.wipeOnTouchMove)}catch(m){console.log("error while unbind touchmove")}try{$("#"+l.id).unbind("mousemove",
DigiWebApp.WipeController.wipeOnTouchMove)}catch(n){console.log("error while unbind mousemove")}try{$("#"+l.id).unbind("touchmove")}catch(o){console.log("error while unbind touchmove")}try{$("#"+l.id).unbind("mousemove")}catch(p){console.log("error while unbind mousemove")}try{$("#"+l.id).unbind("touchstop",DigiWebApp.WipeController.wipeOnMoveStop)}catch(q){console.log("error while unbind touchstop")}try{$("#"+l.id).unbind("mouseup",DigiWebApp.WipeController.wipeOnMoveStop)}catch(s){console.log("error while unbind mouseup")}try{$("#"+
l.id).unbind("touchstop")}catch(t){console.log("error while unbind touchstop")}try{$("#"+l.id).unbind("mouseup")}catch(u){console.log("error while unbind mouseup")}});var e=Math.abs(b)>=DigiWebApp.WipeController.wipeDecideX,g=Math.abs(c)>=DigiWebApp.WipeController.wipeDecideY;d=d<DigiWebApp.WipeController.wipeDecideTimeout;var k=DigiWebApp.WipeController.wipeStopX>0,h=DigiWebApp.WipeController.wipeStopY>0;if(DigiWebApp.WipeController.wipeIsMoving)if(d)if((e||g)&&k&&h){if(e)if(b>0){console.log("wipe left");
DigiWebApp.WipeController.wipeActionLeft()}else{console.log("wipe right");DigiWebApp.WipeController.wipeActionRight()}if(g)if(c>0){console.log("wipe up");DigiWebApp.WipeController.wipeActionUp()}else{console.log("wipe down");DigiWebApp.WipeController.wipeActionDown()}DigiWebApp.WipeController.stopDefault(a);return false}DigiWebApp.WipeController.wipeIsPressed=false;DigiWebApp.WipeController.wipeIsPressedStop=0;DigiWebApp.WipeController.wipeIsPressedStart=0;DigiWebApp.WipeController.wipeStartX=0;DigiWebApp.WipeController.wipeStartY=
0;DigiWebApp.WipeController.wipeStopX=0;DigiWebApp.WipeController.wipeStopY=0;DigiWebApp.WipeController.wipeIsMoving=false},wipeOnMoveStop:function(a){try{$(this).unbind(a)}catch(b){console.log("error while unbind")}DigiWebApp.WipeController.wipeDoStop(a)},wipeOnTouchStart:function(){},touchMoveEventSaved:null,touchStartEventSaved:null,wipeOnTouchMove:function(a){DigiWebApp.WipeController.touchMoveEventSaved=a;var b=0,c=0;if(typeof a.touches!=="undefined"){b=a.touches[0].pageX;c=a.touches[0].pageY}else if(typeof a.originalEvent.touches!==
"undefined"){b=a.originalEvent.touches[0].pageX;c=a.originalEvent.touches[0].pageY}else if(typeof a.originalEvent!=="undefined"){b=a.originalEvent.pageX;c=a.originalEvent.pageY}else{b=a.pageX;c=a.pageY}var d=Math.abs(Math.abs(DigiWebApp.WipeController.wipeStopY)-c);if(Math.abs(Math.abs(DigiWebApp.WipeController.wipeStopX)-b)<200&&d<200&&b>0&&c>0||DigiWebApp.WipeController.wipeStopX===0&&DigiWebApp.WipeController.wipeStopY===0){DigiWebApp.WipeController.wipeStopX=b;DigiWebApp.WipeController.wipeStopY=
c;DigiWebApp.WipeController.wipeIsPressedStop=(+new Date).toString();b=DigiWebApp.WipeController.wipeStartX-b;d=DigiWebApp.WipeController.wipeStartY-c;c=DigiWebApp.WipeController.wipeIsPressedStart-DigiWebApp.WipeController.wipeIsPressedStop;DigiWebApp.WipeController.wipeIsMoving=Math.abs(b)>10||Math.abs(d)>10?true:false;d=Math.abs(d)>=DigiWebApp.WipeController.wipeDecideY;c=c>=DigiWebApp.WipeController.wipeDecideTimeout;if((Math.abs(b)>=DigiWebApp.WipeController.wipeDecideX||d||c)&&DigiWebApp.WipeController.wipeIsMoving){try{$(this).unbind(a)}catch(f){console.log("error while unbind")}typeof device!==
"undefined"&&device.version.substr(0,1)>=4&&device.platform.substr(0,7)>="Android"&&DigiWebApp.SettingsController.globalDebugMode&&DigiWebApp.WipeController.stopDefault(a);DigiWebApp.WipeController.wipeDoStop(a)}}else{console.log("blocked wipe");DigiWebApp.WipeController.wipeIsPressed=false;DigiWebApp.WipeController.wipeIsPressedStop=0;DigiWebApp.WipeController.wipeIsPressedStart=0;DigiWebApp.WipeController.wipeStartX=0;DigiWebApp.WipeController.wipeStartY=0;DigiWebApp.WipeController.wipeStopX=0;
DigiWebApp.WipeController.wipeStopY=0;DigiWebApp.WipeController.wipeIsMoving=false;try{$(this).unbind(a)}catch(e){console.log("error while unbind")}DigiWebApp.WipeController.wipeDoStop(a)}},regTouchStart:function(a,b){DigiWebApp.WipeController.wipeIsPressed=false;DigiWebApp.WipeController.wipeIsPressedStop=0;DigiWebApp.WipeController.wipeIsPressedStart=0;DigiWebApp.WipeController.wipeStartX=0;DigiWebApp.WipeController.wipeStartY=0;DigiWebApp.WipeController.wipeStopX=0;DigiWebApp.WipeController.wipeStopY=
0;DigiWebApp.WipeController.wipeIsMoving=false;DigiWebApp.WipeController.touchStartEventSaved=b;navigator.userAgent.match(/Android/i);if(typeof b.touches!=="undefined"){DigiWebApp.WipeController.wipeStartX=b.touches[0].pageX;DigiWebApp.WipeController.wipeStartY=b.touches[0].pageY}else if(typeof b.originalEvent.touches!=="undefined"){DigiWebApp.WipeController.wipeStartX=b.originalEvent.touches[0].pageX;DigiWebApp.WipeController.wipeStartY=b.originalEvent.touches[0].pageY}else{DigiWebApp.WipeController.wipeStartX=
b.pageX;DigiWebApp.WipeController.wipeStartY=b.pageY}DigiWebApp.WipeController.wipeIsMoving=false;DigiWebApp.WipeController.wipeIsPressed=true;DigiWebApp.WipeController.wipeIsPressedStart=(+new Date).toString();DigiWebApp.WipeController.wipeIsPressedStop=null;var c=b.type.substr(0,5),d=M.Environment.getPlatform(),f="0";if(typeof device!=="undefined")f=new String(device.version);var e="";if(typeof device!=="undefined")e=new String(device.platform);if(d.substr(-2)==="86"||d.substr(-5)==="Win32"||d.substr(-5)===
"Win64"||d.substr(0,3)==="Mac"||d.substr(0,2)==="iP"||DigiWebApp.SettingsController.globalDebugMode||f.substr(0,1)>=4&&e.substr(0,7)>="Android"&&DigiWebApp.SettingsController.globalDebugMode){try{$("#"+a).bind(c+"move",DigiWebApp.WipeController.wipeOnTouchMove)}catch(g){console.log("error while binding "+c+"move for "+a)}if(c==="touch")try{$("#"+a).bind("touchstop",DigiWebApp.WipeController.wipeOnMoveStop)}catch(k){console.log("error while binding touchstop for "+a)}else if(c==="mouse")try{$("#"+
a).bind("mouseup",DigiWebApp.WipeController.wipeOnMoveStop)}catch(h){console.log("error while binding mouseup for "+a)}else console.log("unknown eventtype: "+b.type)}else DigiWebApp.SettingsController.globalDebugMode&&console.log("skipping touchmove")}});
DigiWebApp.SelectionController=M.Controller.extend({orders:null,positions:null,activities:null,selections:{order:null,position:null,activity:null},useSelections:NO,showHandOrderFirst:NO,setSelectionByPreviousSelection:function(){var a=this,b=DigiWebApp.HandOrder.findSorted().concat(DigiWebApp.Order.findSorted()),c=DigiWebApp.Position.findSorted(),d=DigiWebApp.SelectionController.getActivities(),f=NO;b=_.map(b,function(e){if(e){e={label:e.get("name"),value:e.get("id")};if(e.value===a.selections.order)f=
e.isSelected=YES;return e}});b=_.compact(b);b.push({label:M.I18N.l("selectSomething"),value:"0",isSelected:!f});f=NO;c=_.map(c,function(e){if(e){e={label:e.get("name"),value:e.get("id")};if(e.value===a.selections.position)f=e.isSelected=YES;return e}});c=_.compact(c);c.push({label:M.I18N.l("selectSomething"),value:"0",isSelected:!f});f=NO;d=_.map(d,function(e){if(typeof e==="undefined")console.log("UNDEFINED ACTIVITY");else{e={label:e.get("name"),value:e.get("id")};if(e.value===a.selections.activity)f=
e.isSelected=YES;return e}});d=_.compact(d);d.push({label:M.I18N.l("selectSomething"),value:"0",isSelected:!f});this.resetSelection();this.set("orders",b);this.set("positions",c);this.set("activities",d)},setSelectionWithCurrentHandOrderFirst:function(){var a=DigiWebApp.HandOrder.findSorted().concat(DigiWebApp.Order.findSorted()),b=DigiWebApp.SelectionController.getActivities(),c=NO;a=_.map(a,function(e){if(e){e={label:e.get("name"),value:e.get("id")};if(e.label===DigiWebApp.HandOrderController.currentHandOrderName)c=
e.isSelected=YES;else e.isSelected=NO;return e}});a=_.compact(a);a.push({label:M.I18N.l("selectSomething"),value:"0",isSelected:!c});var d=[];d.push({label:M.I18N.l("noData"),value:"0",isSelected:YES});var f=0;b=_.map(b,function(e){if(typeof e==="undefined"){console.log("UNDEFINED ACTIVITY");return null}else{var g=null;if(f===0){c=YES;g={label:e.get("name"),value:e.get("id"),isSelected:YES}}else g={label:e.get("name"),value:e.get("id")};f++;return g}});b=_.compact(b);b.push({label:M.I18N.l("selectSomething"),
value:"0",isSelected:!c});this.resetSelection();this.set("orders",a);this.set("positions",d);this.set("activities",b);M.ViewManager.getView("bookingPage","position").setSelection("0")},setSelectionByCurrentBooking:function(){var a=DigiWebApp.BookingController.currentBooking,b=DigiWebApp.HandOrder.findSorted().concat(DigiWebApp.Order.findSorted()),c=DigiWebApp.Position.findSorted(),d=DigiWebApp.SelectionController.getActivities(),f=(a.get("orderId")=="0"?0:a.get("orderId"))||a.get("handOrderId"),e=
a.get("positionId"),g=a.get("activityId");a=_.map(b,function(h){if(h)return h.get("id")==f?{label:h.get("name"),value:h.get("id"),isSelected:YES}:{label:h.get("name"),value:h.get("id")}});a=_.compact(a);a.push({label:M.I18N.l("selectSomething"),value:"0"});c=_.map(c,function(h){if(h){if(h.get("orderId")===f){var l=null;return l=h.get("id")===e?{label:h.get("name"),value:h.get("id"),isSelected:YES}:{label:h.get("name"),value:h.get("id")}}return null}});c=_.compact(c);c.push({label:M.I18N.l("selectSomething"),
value:"0"});d=_.select(DigiWebApp.WorkPlan.find(),function(h){if(h)return h.get("id")==e});var k=NO;d=d.length>0?this.getActivitiesFromWorkplan(d[0]):DigiWebApp.SelectionController.getActivities();d=_.map(d,function(h){if(typeof h==="undefined"){console.log("UNDEFINED ACTIVITY");return null}else{var l=null;if(h.get("id")==g){l={label:h.get("name"),value:h.get("id"),isSelected:YES};k=YES}else l={label:h.get("name"),value:h.get("id")};return l}});d=_.compact(d);d.push({label:M.I18N.l("selectSomething"),
value:"0",isSelected:!k});this.resetSelection();this.set("orders",a);this.set("positions",c);this.set("activities",d)},setPositions:function(){var a=M.ViewManager.getView("bookingPage","order").getSelection(YES).value;if(a){var b=DigiWebApp.Position.findSorted(),c=0;b=_.map(b,function(d){if(d){if(d.get("orderId")===a){d={label:d.get("name"),value:d.get("id")};if(c===0)d.isSelected=YES;c+=1;return d}return null}});b=_.compact(b);b.length<1&&b.push({label:M.I18N.l("noData"),value:"0"});M.ViewManager.getView("bookingPage",
"position").resetSelection();this.set("positions",b);this.setActivities(YES);this.saveSelection()}},setActivities:function(a){var b=null;if(a)if(a=M.ViewManager.getView("bookingPage","position").getSelection(YES))b=a.value;a=[];b=DigiWebApp.WorkPlan.find({query:{identifier:"id",operator:"=",value:b}});var c=0;a=b.length===1?this.getActivitiesFromWorkplan(b[0]):DigiWebApp.SelectionController.getActivities();var d=-1;if(typeof DigiWebApp.BookingController.currentBooking!=="undefined"&&DigiWebApp.BookingController.currentBooking!==
null)d=DigiWebApp.BookingController.currentBooking.get("activityId");var f=false;_.each(a,function(e){if(typeof e==="undefined"){console.log("UNDEFINED ACTIVITY");return null}else if(e.get("id")===d)f=true});a=_.map(a,function(e){if(typeof e==="undefined"){console.log("UNDEFINED ACTIVITY");return null}else{var g=null;g=f?{label:e.get("name"),value:e.get("id"),isSelected:e.get("id")===d?YES:NO}:{label:e.get("name"),value:e.get("id"),isSelected:c===0?YES:NO};c+=1;return g}});a=_.compact(a);a.length>
0?a.push({label:M.I18N.l("selectSomething"),value:"0",isSelected:NO}):a.push({label:M.I18N.l("noData"),value:"0"});M.ViewManager.getView("bookingPage","activity").resetSelection();this.set("activities",a);this.saveSelection()},initSelection:function(){var a=DigiWebApp.HandOrder.findSorted().concat(DigiWebApp.Order.findSorted()),b=DigiWebApp.Position.findSorted(),c=DigiWebApp.SelectionController.getActivities(),d=[];if(a)d=_.map(a,function(e){if(e)return{label:e.get("name"),value:e.get("id")}});d.push({label:M.I18N.l("selectSomething"),
value:"0",isSelected:YES});a=[];if(b)a=_.map(b,function(e){if(e)return{label:e.get("name"),value:e.get("id")}});a.push({label:M.I18N.l("selectSomething"),value:"0",isSelected:YES});b=[];if(c)b=_.map(c,function(e){if(typeof e==="undefined"){console.log("UNDEFINED ACTIVITY");return null}else return obj={label:e.get("name"),value:e.get("id")}});b.push({label:M.I18N.l("selectSomething"),value:"0",isSelected:YES});this.resetSelection();this.set("orders",d);this.set("positions",a);this.set("activities",
b);try{M.ViewManager.getView("bookingPage","order").setSelection("0");M.ViewManager.getView("bookingPage","position").setSelection("0");M.ViewManager.getView("bookingPage","activity").setSelection("0")}catch(f){}},resetSelection:function(){try{M.ViewManager.getView("bookingPage","order").resetSelection();M.ViewManager.getView("bookingPage","position").resetSelection();M.ViewManager.getView("bookingPage","activity").resetSelection()}catch(a){}},isPositionSelected:function(){var a=M.ViewManager.getView("bookingPage",
"position").getSelection(YES);return a&&a.value!="0"?YES:NO},isActivitySelected:function(){var a=M.ViewManager.getView("bookingPage","activity").getSelection(YES);return a&&a.value!="0"?YES:NO},saveSelection:function(){var a=M.ViewManager.getView("bookingPage","order").getSelection(),b=M.ViewManager.getView("bookingPage","position").getSelection(),c=M.ViewManager.getView("bookingPage","activity").getSelection();this.selections.order=a;this.selections.position=b;this.selections.activity=c;this.useSelections=
YES},getActivities:function(a){a=a?DigiWebApp.Activity.find(a):DigiWebApp.Activity.findSorted();a=_.map(a,function(b){if(b)return b.get("positionId")==="1"?b:null});return a=_.compact(a)},getActivitiesFromWorkplan:function(a){var b=a.get("activityIds").split(","),c=[];if(b&&b.length>0)for(var d=0;d<b.length;d++)c.push(_.first(DigiWebApp.Activity.find({query:{identifier:"id",operator:"=",value:b[d]}})));if(a.get("workplanType")==="1")c=_.map(c,function(f){if(typeof f==="undefined"){console.log("UNDEFINED ACTIVITY");
return null}else{var e=NO,g=DigiWebApp.Activity.findSorted();_.each(g,function(k){if(k.get("positionId")==="1")e=YES});return e?f:null}});return c=_.compact(c)}});
DigiWebApp.ApplicationController=M.Controller.extend({myns:"ax21",restartApp:NO,activeFeaturesBeforeTransfer:[],syncStartTimestamp:null,syncStopTimestamp:null,syncLastDuration:null,syncRunning:NO,savedUseTransitions:NO,triggerUpdate:NO,useSplashJustForFade:NO,makeUnselectable:function(){},blackBerryRestart_var:null,blackBerryRestart:function(){DigiWebApp.ApplicationController.blackBerryRestart_var!==null&&clearTimeout(DigiWebApp.ApplicationController.blackBerryRestart_var);DigiWebApp.app=M.Application.design(DigiWebAppOrdinaryDesign);
DigiWebApp.app.main();DigiWebApp.ApplicationController.regSecEv(YES)},nativeAlertDialogView:function(a){M.Environment.getPlatform().substr(0,10);if(typeof a.confirmButtonValue==="undefined")a.confirmButtonValue="Ok";if(typeof a.title==="undefined")a.title="Alert";if(typeof a.message==="undefined")a.message="";var b=function(){};if(typeof a.callbacks!=="undefined")if(typeof a.callbacks.confirm.target===undefined)if(typeof a.callbacks.confirm.action==="function")b=a.callbacks.confirm.action;else console.error("ERROR: callback without target given but action is not a function!");
else if(typeof a.callbacks.confirm.target==="function")b=a.callbacks.confirm.target;else if(typeof a.callbacks.confirm.action==="string")b=a.callbacks.confirm.target[a.callbacks.confirm.action];else if(typeof a.callbacks.confirm.action==="function")b=a.callbacks.confirm.action;else console.error("ERROR: action is neither a string nor a function!");typeof navigator.notification==="undefined"?M.DialogView.alert(a):navigator.notification.alert(a.message,function(c){switch(c){case 0:b();break;case "0":b();
break;case 1:b();break;case "1":b();break;case a.confirmButtonValue:b();break;case "OK":b();break;default:alert('ERROR: yet unknown button "'+c+'" pressed.');return}try{$.mobile.fixedToolbars.show()}catch(d){}},a.title,a.confirmButtonValue)},nativeConfirmDialogView:function(a){M.Environment.getPlatform().substr(0,10);if(typeof a.confirmButtonValue==="undefined")a.confirmButtonValue="Ok";if(typeof a.cancelButtonValue==="undefined")a.cancelButtonValue="Cancel";if(typeof a.title==="undefined")a.title=
"Confirm";if(typeof a.message==="undefined")a.message="";typeof navigator.notification==="undefined"?M.DialogView.confirm(a):navigator.notification.confirm(a.message,function(b){switch(b){case 0:a.callbacks.confirm.action();break;case 1:a.callbacks.confirm.action();break;case 2:a.callbacks.cancel.action();break;case "0":a.callbacks.confirm.action();break;case "1":a.callbacks.confirm.action();break;case "2":a.callbacks.cancel.action();break;case a.confirmButtonValue:a.callbacks.confirm.action();break;
case a.cancelButtonValue:a.callbacks.cancel.action();break;case "OK":a.callbacks.confirm.action();break;case "CANCEL":a.callbacks.cancel.action();break;default:alert('ERROR: yet unknown button "'+b+'" pressed.');return}try{$.mobile.fixedToolbars.show()}catch(c){}},a.title,a.confirmButtonValue+","+a.cancelButtonValue)},DigiLoaderView:{loaderMessage:"loading",isVisible:function(){return M.LoaderView.refCount!==0},hide:function(){this.loaderMessage="loading";return M.LoaderView.hide(true)},show:function(a){this.isVisible()&&
this.hide();this.loaderMessage=a;return M.LoaderView.show(this.loaderMessage)},getTitle:function(){return this.loaderMessage},setTitle:function(a){return this.show(a)},changeTitle:function(a){return this.setTitle(a)}},infoMsg:"",callbackStatus:null,storagePrefix:M.LOCAL_STORAGE_PREFIX+M.Application.name+M.LOCAL_STORAGE_SUFFIX,clickCounter:0,clickLimit:9,skipEvents:false,regSecEv:function(a){DigiWebApp.ApplicationController.setImageClass();if(a){var b=this;a=M.ViewManager.getView("infoPage","logo");
$("#"+a.id).bind("touchstart",function(){b.showConfirmDialog()});$("#"+a.id).bind("mousedown",function(){b.showConfirmDialog()});if(M.Environment.getPlatform().substr(0,10)==="BlackBerry"){console.log("registering emergencyhandler");$(document).bind("keydown",DigiWebApp.ApplicationController.keydownHandler)}}_.each(DigiWebApp.app.pages,function(c){typeof c.header!=="undefined"&&$("#"+c.header.id).removeClass("fade")});$("[id="+DigiWebApp.TabBar.id+"]").each(function(){$(this).removeClass("fade")});
this.setSkipEvents();if(this.skipEvents)this.devicereadyhandler();else if(typeof device==="undefined"){DigiWebApp.ApplicationController.timeoutdeviceready_var=setTimeout("DigiWebApp.ApplicationController.timeoutdevicereadyhandler()",8E3);$(document).bind("deviceready",DigiWebApp.ApplicationController.devicereadyhandler)}else DigiWebApp.ApplicationController.devicereadyhandler()},setSkipEvents:function(){var a=M.Environment.getPlatform();this.skipEvents=a.substr(-2)==="86"||a.substr(-5)==="Win32"||
a.substr(-5)==="Win64"||a.substr(0,3)==="Mac"||a.substr(0,10)==="BlackBerry"?true:false;this.skipEvents=false},sizeMode:null,checkSizeModeChange:function(){if(this.sizeMode===null||this.timeouthappened)switch(true){case $(window).width()<=320:if(this.sizeMode!=="w320"){this.sizeMode="w320";return true}else return false;case $(window).width()>320&&$(window).width()<=480:if(this.sizeMode!=="w480"){this.sizeMode="w480";return true}else return false;case $(window).width()>480&&$(window).width()<=640:if(this.sizeMode!==
"w640"){this.sizeMode="w640";return true}else return false;case $(window).width()>640&&$(window).width()<=1024:if(this.sizeMode!=="w1024"){this.sizeMode="w1024";return true}else return false;case $(window).width()>1024&&$(window).width()<=1536:if(this.sizeMode!=="w1536"){this.sizeMode="w1536";return true}else return false;default:if(this.sizeMode!=="w1536"){this.sizeMode="w1536";return true}else return false}else return false},setImageClass:function(){if(M.Environment.getPlatform().substr(0,10)===
"BlackBerry")console.log("We are on BlackBerry, so we skip dynamic Background!");else this.checkSizeModeChange()&&_.each(DigiWebApp.app.pages,function(a){if($("#"+a.id).get("0").classList)if(!$("#"+a.id).get("0").classList.contains(DigiWebApp.ApplicationController.sizeMode)){$("#"+a.id).removeClass("w320").removeClass("w480").removeClass("w640").removeClass("w1024").removeClass("w1536");$("#"+a.id).addClass(DigiWebApp.ApplicationController.sizeMode)}})},timeoutdeviceready_var:null,timeouthappened:false,
timeoutdevicereadyhandler:function(){DigiWebApp.ApplicationController.timeoutdeviceready_var!==null&&clearTimeout(DigiWebApp.ApplicationController.timeoutdeviceready_var);DigiWebApp.ApplicationController.timeouthappened=true;console.log('DIGI-WebApp hat Plattform "'+M.Environment.getPlatform()+'" ('+navigator.userAgent+") erkannt. Es werden keine Eventhandler registriert! (Version "+M.Application.getConfig("version")+")");this.skipEvents=true;this.devicereadyhandler()},emergencyCode:"007RESET007",
emergencyStartedTimestamp:null,emergencyStringEntered:"",keydownHandler:function(a){if(a.timeStamp-DigiWebApp.ApplicationController.emergencyStartedTimestamp>2E4){console.log("timeout: reset emergency-mechanism");DigiWebApp.ApplicationController.emergencyStartedTimestamp=a.timeStamp;DigiWebApp.ApplicationController.emergencyStringEntered=""}var b=DigiWebApp.ApplicationController.emergencyStringEntered.length,c=String.fromCharCode(a.which).toUpperCase();if(c===DigiWebApp.ApplicationController.emergencyCode.substr(b,
1))DigiWebApp.ApplicationController.emergencyStringEntered+=c;else{DigiWebApp.ApplicationController.emergencyStartedTimestamp=a.timeStamp;DigiWebApp.ApplicationController.emergencyStringEntered="";return true}if(DigiWebApp.ApplicationController.emergencyStringEntered===DigiWebApp.ApplicationController.emergencyCode){DigiWebApp.ApplicationController.emergencyStartedTimestamp=a.timeStamp;DigiWebApp.ApplicationController.emergencyStringEntered="";DigiWebApp.ApplicationController.showConfirmDialog()}return true},
fixToobarsIntervalVar:null,devicereadyhandler:function(){try{DigiWebApp.ApplicationController.DigiLoaderView.hide();if(M.Environment.getPlatform().substr(0,10)==="BlackBerry"){_.each(DigiWebApp.app.pages,function(b){typeof b.header!=="undefined"&&$("#"+b.header.id).removeClass("ui-header-fixed")});$("[id="+DigiWebApp.TabBar.id+"]").each(function(){$(this).removeClass("ui-footer-fixed")})}else DigiWebApp.ApplicationController.fixToobarsIntervalVar=setInterval(function(){try{$.mobile.fixedToolbars.show()}catch(b){}},
5E3);DigiWebApp.ApplicationController.timeoutdeviceready_var!==null&&clearTimeout(DigiWebApp.ApplicationController.timeoutdeviceready_var);DigiWebApp.ApplicationController.setImageClass();$(window).resize(function(){DigiWebApp.ApplicationController.setImageClass()});DigiWebApp.ApplicationController.init(true);if(this.skipEvents!==true||M.Environment.getPlatform().substr(0,10)==="BlackBerry"&&DigiWebApp.ApplicationController.timeouthappened!==true){$(document).bind("backbutton",DigiWebApp.ApplicationController.backbuttonhandler);
$(document).bind("menubutton",DigiWebApp.ApplicationController.menubuttonhandler)}}catch(a){trackError(a)}},closeChildbrowser:function(){try{plugins.childBrowser.close()}catch(a){console.log(a)}},backButtonTimeoutVar:null,backbuttonhandler:function(){var a=DigiWebApp.SettingsController.featureAvailable("409");if(!DigiWebApp.SettingsController.showCredentialsAlert)if(DigiWebApp.TabBar.tabItem1.isActive||a&&M.ViewManager.getCurrentPage().get("id")===DigiWebApp.DashboardPage.get("id"))typeof navigator.app!==
"undefined"&&DigiWebApp.ApplicationController.nativeConfirmDialogView({title:M.I18N.l("quitQuestion"),message:M.I18N.l("quitQuestionMsg"),confirmButtonValue:M.I18N.l("yes"),cancelButtonValue:M.I18N.l("no"),callbacks:{confirm:{target:this,action:function(){navigator.app.exitApp()}},cancel:{target:this,action:function(){}}}});else DigiWebApp.ApplicationController.backButtonTimeoutVar=setTimeout("DigiWebApp.ApplicationController.backButtonToBookTimePage()",500)},registerButtonHandlerByTimeoutVar:null,
registerButtonHandlerByTimeout:function(){if(M.Environment.getPlatform().substr(0,10)==="BlackBerry"&&DigiWebApp.ApplicationController.timeouthappened!==true){console.log("registering buttonhandler again on blackberry");$(document).bind("backbutton",DigiWebApp.ApplicationController.backbuttonhandler);$(document).bind("menubutton",DigiWebApp.ApplicationController.menubuttonhandler)}clearTimeout(DigiWebApp.ApplicationController.registerButtonHandlerByTimeoutVar)},backButtonToBookTimePage:function(){clearTimeout(DigiWebApp.ApplicationController.backButtonTimeoutVar);
DigiWebApp.SettingsController.featureAvailable("409")?DigiWebApp.NavigationController.toDashboardPageFlipTransition():DigiWebApp.NavigationController.toBookTimePageFlipTransition()},menubuttonhandler:function(){DigiWebApp.SettingsController.showCredentialsAlert||DigiWebApp.NavigationController.backToDashboardPageFlipTransition()},showConfirmDialog:function(){var a=this;DigiWebApp.ApplicationController.nativeConfirmDialogView({title:M.I18N.l("secretQuestion"),message:M.I18N.l("secretQuestionMsg"),
confirmButtonValue:M.I18N.l("yes"),cancelButtonValue:M.I18N.l("no"),callbacks:{confirm:{target:this,action:function(){DigiWebApp.SettingsController.credentialsAlertShown=false;DigiWebApp.ApplicationController.deleteAllData();DigiWebApp.BookingController.currentBooking=null;$("#"+DigiWebApp.BookingPage.content.currentBookingLabel.id).html("");DigiWebApp.SettingsController.showIOSMessage=false;DigiWebApp.ApplicationController.init(true)}},cancel:{target:this,action:function(){a.clickCounter=0}}}})},
setTransitionsSetting:function(){var a="0";if(typeof device!=="undefined")a=new String(device.version);var b="";if(typeof device!=="undefined")b=new String(device.platform);var c=M.Environment.getPlatform();M.Application.config.useTransitions=c.substr(-2)==="86"||c.substr(-5)==="Win32"||c.substr(-5)==="Win64"||c.substr(0,3)==="Mac"||c.substr(0,6)==="iPhone"||c.substr(0,4)==="iPad"||a.substr(0,1)>=4&&b.substr(0,7)>="Android"?DigiWebApp.SettingsController.getSetting("useTransitionsSetting"):NO},init:function(){DigiWebApp.TabBar.tabItem1.internalEvents.tap.action=
function(){this.page?M.Controller.switchToTab(this,YES):this.parentView.setActiveTab(this)};DigiWebApp.TabBar.tabItem2.internalEvents.tap.action=function(){this.page?M.Controller.switchToTab(this,NO):this.parentView.setActiveTab(this)};this.callbackStatus={position:{remote:NO,local:NO},activity:{remote:NO,local:NO},order:{remote:NO,local:NO},workPlan:{remote:NO,local:NO},handOrder:{remote:NO,local:NO},kolonne:{remote:NO,local:NO},features:{remote:NO,local:NO}};DigiWebApp.SettingsController.init();
DigiWebApp.SettingsController.globalDebugMode=DigiWebApp.SettingsController.getSetting("debug")?YES:NO;DigiWebApp.ApplicationController.setTransitionsSetting();var a=DigiWebApp.Booking.find();if(a.length>0){for(var b=NO,c=0;c<a.length;c++)if(a[c].get("isCurrent")===YES){b=YES;break}if(b===YES){DigiWebApp.NavigationController.toBookTimePage();return}}this.startsync()},enforceChefToolOnly:function(){var a=DigiWebApp.SettingsController.showCredentialsAlert;if(DigiWebApp.SettingsController.featureAvailable("409")||
a){try{$("[id="+DigiWebApp.TabBar.id+"]").each(function(){$(this).hide()})}catch(b){}try{$("[id="+DigiWebApp.SettingsPage.content.autoTransferAfterBookTimeCheck.id+"]").each(function(){$(this).hide()})}catch(c){}try{$("[id="+DigiWebApp.SettingsPage.content.autoTransferAfterClosingDayCheck.id+"]").each(function(){$(this).hide()})}catch(d){}try{$("[id="+DigiWebApp.SettingsPage.content.autoSyncAfterBookTimeCheck.id+"]").each(function(){$(this).hide()})}catch(f){}try{$("[id="+DigiWebApp.SettingsPage.content.remarkIsMandatory.id+
"]").each(function(){$(this).hide()})}catch(e){}try{$("[id="+DigiWebApp.SettingsPage.content.autoSaveGPSData.id+"]").each(function(){$(this).hide()})}catch(g){}try{$("[id="+DigiWebApp.SettingsPage.content.daysToHoldBookingsOnDeviceSliderContainer.id+"]").each(function(){$(this).hide()})}catch(k){}}else{try{$("[id="+DigiWebApp.TabBar.id+"]").each(function(){$(this).show()})}catch(h){}try{$("[id="+DigiWebApp.SettingsPage.content.autoTransferAfterBookTimeCheck.id+"]").each(function(){$(this).show()})}catch(l){}try{$("[id="+
DigiWebApp.SettingsPage.content.autoTransferAfterClosingDayCheck.id+"]").each(function(){$(this).show()})}catch(m){}try{$("[id="+DigiWebApp.SettingsPage.content.autoSyncAfterBookTimeCheck.id+"]").each(function(){$(this).show()})}catch(n){}if(DigiWebApp.SettingsController.featureAvailable("403"))try{$("[id="+DigiWebApp.SettingsPage.content.remarkIsMandatory.id+"]").each(function(){$(this).show()})}catch(o){}try{$("[id="+DigiWebApp.SettingsPage.content.autoSaveGPSData.id+"]").each(function(){$(this).show()})}catch(p){}if(DigiWebApp.SettingsController.featureAvailable("411"))try{$("[id="+
DigiWebApp.SettingsPage.content.daysToHoldBookingsOnDeviceSliderContainer.id+"]").each(function(){$(this).show()})}catch(q){}}},startsync:function(){DigiWebApp.ApplicationController.syncStartTimestamp=D8.now().getTimestamp();var a=DigiWebApp.SettingsController.getSetting("company"),b=DigiWebApp.SettingsController.getSetting("password");if(!a||!b){DigiWebApp.NavigationController.toBookTimePage(YES);DigiWebApp.SettingsController.showCredentialsAlert=YES;DigiWebApp.NavigationController.toSettingsPage(YES)}else{M.Application.config.useTransitions=
NO;DigiWebApp.ApplicationController.syncRunning=YES;DigiWebApp.SettingsController.sendConfiguration()}},connectionError:function(){DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("connectionError"),message:M.I18N.l("connectionErrorMsg"),callbacks:{confirm:{target:this,action:"proceedWithLocalData"}}})},proceedWithLocalData:function(a){var b=DigiWebApp.ApplicationController;b.enforceChefToolOnly();if(DigiWebApp.SettingsController.featureAvailable("409"))DigiWebApp.NavigationController.toDashboardPage();
else{DigiWebApp.Order.findSorted().length>0&&b.setCallbackStatus("order","local",YES);DigiWebApp.Position.findSorted().length>0&&b.setCallbackStatus("position","local",YES);DigiWebApp.Activity.findSorted().length>0&&b.setCallbackStatus("activity","local",YES);DigiWebApp.Features.find().length>0&&b.setCallbackStatus("features","local",YES);DigiWebApp.SettingsController.globalDebugMode&&DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("offlineWork"),message:a});if(b.isReadyToProceed()){DigiWebApp.NavigationController.toBookTimePage(YES);
DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("offlineWork"),message:M.I18N.l("offlineWorkMsg")})}else{DigiWebApp.NavigationController.toDashboardPage();DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("offlineWorkNotPossible"),message:M.I18N.l("offlineWorkNotPossibleMsg")})}}},authenticate:function(){DigiWebApp.RequestController.authenticate({success:{target:this,action:"authenticateSuccess"},error:{target:this,action:function(){console.error("authenticate-error");
this.proceedWithLocalData("authenticate")}}})},authenticateSuccess:function(a){if(typeof a["return"]==="undefined"&&typeof a["ns:return"]!=="undefined")a["return"]=a["ns:return"];switch(a["return"]){case "1":DigiWebApp.ApplicationController.activeFeaturesBeforeTransfer=[];_.each(DigiWebApp.Features.find(),function(b){b.get("isAvailable")==="true"&&DigiWebApp.ApplicationController.activeFeaturesBeforeTransfer.push(b.get("id"))});DigiWebApp.Features.deleteAll();this.setCallbackStatus("features","local",
NO);DigiWebApp.ApplicationController.triggerUpdate=YES;DigiWebApp.DashboardController.init(YES);DigiWebApp.MediaListController.init(YES);this.getFeaturesFromRemote();DigiWebApp.ApplicationController.enforceChefToolOnly();break;case "2":DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("authenticationError2"),message:M.I18N.l("authenticationErrorMsg2")});DigiWebApp.NavigationController.toSettingsPage(YES);break;case "3":DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("authenticationError3"),
message:M.I18N.l("authenticationErrorMsg3")});DigiWebApp.NavigationController.toSettingsPage(YES);break;default:DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("authenticationError"),message:M.I18N.l("authenticationErrorMsg")});DigiWebApp.NavigationController.toSettingsPage(YES)}},getOrdersFromRemote:function(){DigiWebApp.RequestController.getOrders({success:{target:this,action:function(a,b,c){this.getOrdersFromRemoteSuccess(a,b,c)===true?this.getPositionsFromRemote():DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("noOrdersAvailable"),
message:M.I18N.l("noOrdersAvailableMsg")})}},error:{target:this,action:function(){console.error("getOrdersFromRemote-error");this.proceedWithLocalData("getOrdersFromRemote")}}})},getOrdersFromRemoteSuccess:function(a){if(typeof a["return"]==="undefined"&&typeof a["ns:return"]!=="undefined"){a["return"]=a["ns:return"];try{var b=this.myns=a["return"][0]["xsi:type"].split(":")[0];_.each(a["return"],function(e){e.auftragsId=e[b+":auftragsId"];e.auftragsBezeichnung=e[b+":auftragsBezeichnung"]})}catch(c){}}if(a["return"]){this.setCallbackStatus("order",
"remote",YES);DigiWebApp.Order.deleteAll();this.setCallbackStatus("order","local",NO);var d=[],f=null;if(_.isObject(a["return"])&&!_.isArray(a["return"]))a["return"]=[a["return"]];_.each(a["return"],function(e){f=DigiWebApp.Order.createRecord({id:e.auftragsId,name:e.auftragsBezeichnung});try{f.save();d.push(f.m_id)}catch(g){console.error("ERROR in "+this.name+".getOrdersFromRemoteSuccess: "+g)}});localStorage.setItem(this.storagePrefix+"_orderKeys",JSON.stringify(d));this.setCallbackStatus("order",
"local",YES);return true}else return false},getPositionsFromRemote:function(){DigiWebApp.RequestController.getPositions({success:{target:this,action:function(a,b,c){this.getPositionsFromRemoteSuccess(a,b,c);this.getActivitiesFromRemote()}},error:{target:this,action:function(){console.error("getPositionsFromRemote-error");this.proceedWithLocalData("getPositionsFromRemote")}}})},getPositionsFromRemoteSuccess:function(a){if(typeof a["return"]==="undefined"&&typeof a["ns:return"]!=="undefined"){a["return"]=
a["ns:return"];try{var b=this.myns;_.each(a["return"],function(e){e.positionsId=e[b+":positionsId"];e.positionsBezeichnung=e[b+":positionsBezeichnung"];e.auftragsId=e[b+":auftragsId"];e.positionHausnummer=e[b+":positionHausnummer"];e.positionPlz=e[b+":positionPlz"];e.positionOrt=e[b+":positionOrt"];e.positionLand=e[b+":positionZusatz"];e.positionLongitude=e[b+":positionLongitude"];e.positionLatitude=e[b+":positionLatitude"];e.positionBeschreibung=e[b+":positionBeschreibung"];e.positionTelefon=e[b+
":positionTelefon"]})}catch(c){}}if(a["return"]){this.setCallbackStatus("position","remote",YES);DigiWebApp.Position.deleteAll();this.setCallbackStatus("position","local",NO);var d=[],f=null;if(_.isObject(a["return"])&&!_.isArray(a["return"]))a["return"]=[a["return"]];_.each(a["return"],function(e){var g=e.positionsId,k=e.positionsBezeichnung,h=e.positionStrasse,l=e.positionHausnummer,m=e.positionPlz,n=e.positionOrt,o=e.positionZusatz,p=e.positionLand,q=e.positionTelefon,s=e.positionFax,t=e.positionEmail,
u=e.positionAnsprechpartner,r=e.positionKundenname,v=e.positionLongitude,w=e.positionLatitude,x=e.positionBeschreibung;e=e.auftragsId;if(typeof g==="object")g="";if(typeof k==="object")k="";if(typeof h==="object")h="";if(typeof l==="object")l="";if(typeof m==="object")m="";if(typeof n==="object")n="";if(typeof o==="object")o="";if(typeof p==="object")p="";if(typeof q==="object")q="";if(typeof s==="object")s="";if(typeof t==="object")t="";if(typeof u==="object")u="";if(typeof r==="object")r="";if(typeof v===
"object")v="";if(typeof w==="object")w="";if(typeof x==="object")x="";if(typeof e==="object")e="";f=DigiWebApp.Position.createRecord({id:g,name:k,strasse:h,hausnummer:l,plz:m,ort:n,land:o,countrycode:p,telefon:q,fax:s,email:t,ansprechpartner:u,kundenname:r,longitude:v,latitude:w,description:x,orderId:e});try{f.save();d.push(f.m_id)}catch(i){console.error("ERROR in "+this.name+".getPositionsFromRemoteSuccess: "+i)}});localStorage.setItem(this.storagePrefix+"_positionKeys",JSON.stringify(d));this.setCallbackStatus("position",
"local",YES)}},getActivitiesFromRemote:function(){DigiWebApp.RequestController.getActivities({success:{target:this,action:function(a,b,c){this.getActivitiesFromRemoteSuccess(a,b,c);this.getWorkPlansFromRemote()}},error:{target:this,action:function(){console.error("getActivitiesFromRemote-error");this.proceedWithLocalData("getActivitiesFromRemote")}}})},getActivitiesFromRemoteSuccess:function(a){if(typeof a["return"]==="undefined"&&typeof a["ns:return"]!=="undefined"){a["return"]=a["ns:return"];try{var b=
this.myns;_.each(a["return"],function(e){e.taetigkeitsId=e[b+":taetigkeitsId"];e.taetigkeitsBezeichnung=e[b+":taetigkeitsBezeichnung"];e.positionsId=e[b+":positionsId"]})}catch(c){}}if(a["return"]){this.setCallbackStatus("activity","remote",YES);DigiWebApp.Activity.deleteAll();this.setCallbackStatus("activity","local",NO);var d=[],f=null;if(_.isObject(a["return"])&&!_.isArray(a["return"]))a["return"]=[a["return"]];_.each(a["return"],function(e){f=DigiWebApp.Activity.createRecord({id:e.taetigkeitsId,
name:e.taetigkeitsBezeichnung,positionId:e.positionsId});try{f.save();d.push(f.m_id)}catch(g){console.error("ERROR in "+this.name+".getActivitiesFromRemoteSuccess: "+g)}});localStorage.setItem(this.storagePrefix+"_activityKeys",JSON.stringify(d));this.setCallbackStatus("activity","local",YES)}},getWorkPlansFromRemote:function(){DigiWebApp.RequestController.getWorkPlans({success:{target:this,action:function(a,b,c){this.getWorkPlansFromRemoteSuccess(a,b,c);this.getHandOrdersFromRemote()}},error:{target:this,
action:function(){console.error("getWorkPlansFromRemote-error");this.proceedWithLocalData("getWorkPlansFromRemote")}}})},getWorkPlansFromRemoteSuccess:function(a){if(typeof a["return"]==="undefined"&&typeof a["ns:return"]!=="undefined"){a["return"]=a["ns:return"];try{var b=this.myns;_.each(a["return"],function(d){d.arbeitsplanId=d[b+":arbeitsplanId"];d.positionen=d[b+":positionen"];d.taetigkeitsIds=d[b+":taetigkeitsIds"];d.arbeitsplanTyp=d[b+":arbeitsplanTyp"]})}catch(c){}}if(a["return"]){this.setCallbackStatus("workPlan",
"remote",YES);DigiWebApp.WorkPlan.deleteAll();this.setCallbackStatus("workPlan","local",NO);_.each(a["return"],function(d){DigiWebApp.WorkPlan.createRecord({id:d.arbeitsplanId,workplanType:d.arbeitsplanTyp,activityPositions:d.positionen.join(","),activityIds:d.taetigkeitsIds.join(",")}).save()});this.setCallbackStatus("workPlan","local",YES)}},getHandOrdersFromRemote:function(){DigiWebApp.RequestController.getHandOrders({success:{target:this,action:function(a,b,c){this.getHandOrdersFromRemoteSuccess(a,
b,c);this.getKolonneFromRemote()}},error:{target:this,action:function(){console.error("getHandOrdersFromRemote-error");this.proceedWithLocalData("getHandOrdersFromRemote")}}})},getHandOrdersFromRemoteSuccess:function(a){if(typeof a["return"]==="undefined"&&typeof a["ns:return"]!=="undefined"){a["return"]=a["ns:return"];try{var b=this.myns;_.each(a["return"],function(e){e.handauftragsId=e[b+":handauftragsId"];e.handauftragsBezeichnung=e[b+":handauftragsBezeichnung"]})}catch(c){}}if(a["return"]){this.setCallbackStatus("handOrder",
"remote",YES);DigiWebApp.HandOrder.deleteAll();this.setCallbackStatus("handOrder","local",NO);if(typeof a["return"]==="object"&&!_.isArray(a["return"]))a["return"]=[a["return"]];var d=[],f=null;if(_.isObject(a["return"])&&!_.isArray(a["return"]))a["return"]=[a["return"]];_.each(a["return"],function(e){f=DigiWebApp.HandOrder.createRecord({id:e.handauftragsId,name:e.handauftragsBezeichnung,isLocalOnly:NO});try{f.save();d.push(f.m_id)}catch(g){console.error("ERROR in "+this.name+".getHandOrdersFromRemoteSuccess: "+
g)}});a=_.select(DigiWebApp.HandOrder.findSorted(),function(e){if(e)return e.get("isLocalOnly")===YES});_.each(a,function(e){d.push(e.m_id)});localStorage.setItem(this.storagePrefix+"_handorderKeys",JSON.stringify(d));this.setCallbackStatus("handOrder","local",YES)}else{this.setCallbackStatus("handOrder","remote",NO);DigiWebApp.HandOrder.deleteAll();this.setCallbackStatus("handOrder","local",NO)}},getFeaturesFromRemote:function(){DigiWebApp.RequestController.getFeatures({success:{target:this,action:function(a,
b,c){this.getFeaturesFromRemoteSuccess(a,b,c);DigiWebApp.SettingsController.featureAvailable("409")?this.endSession():this.getOrdersFromRemote()}},error:{target:this,action:function(){console.error("getFeaturesFromRemote-error");this.getOrdersFromRemote()}}})},getFeaturesFromRemoteSuccess:function(a){if(a)if(typeof a["return"]==="undefined"&&typeof a["ns:return"]!=="undefined"){a["return"]=a["ns:return"];try{var b=this.myns;_.each(a["return"],function(d){d.keyId=d[b+":keyId"];d.value=d[b+":value"]})}catch(c){}}if(a&&
a["return"]){this.setCallbackStatus("features","remote",YES);if(_.isObject(a["return"])&&!_.isArray(a["return"]))a["return"]=[a["return"]];DigiWebApp.SettingsController.setSetting("treatAllAsTablet",false);DigiWebApp.SettingsController.setSetting("treatAllAsPhone",false);DigiWebApp.SettingsController.setSetting("settingsPassword","digi$");DigiWebApp.ApplicationController.triggerUpdate=NO;_.each(a["return"],function(d){var f="";if(typeof d.valueType==="undefined")f=DigiWebApp.ApplicationController.myns+
":";if(d[f+"valueType"]==="Setting_WebApp"){var e=d[f+"value"];if(e==="false"||e==="true")e=e==="true";DigiWebApp.SettingsController.setSetting(d[f+"keyId"],e)}else if(d[f+"valueType"]==="Feature"){DigiWebApp.Features.createRecord({id:d[f+"keyId"],name:d[f+"keyId"],isAvailable:d[f+"value"]}).save();var g=NO;_.each(DigiWebApp.ApplicationController.activeFeaturesBeforeTransfer,function(k){if(d[f+"keyId"]===k)g=YES});if(d[f+"value"]==="true"&&!g||d[f+"value"]==="false"&&g){if(d[f+"keyId"]==="400")DigiWebApp.ApplicationController.restartApp=
YES;if(d[f+"keyId"]==="401")DigiWebApp.ApplicationController.restartApp=YES;if(d[f+"keyId"]==="403")DigiWebApp.ApplicationController.restartApp=YES;if(d[f+"keyId"]==="405")DigiWebApp.ApplicationController.restartApp=YES;if(d[f+"keyId"]==="406")DigiWebApp.ApplicationController.restartApp=YES;if(d[f+"keyId"]==="408")DigiWebApp.ApplicationController.restartApp=YES;if(d[f+"keyId"]==="409")DigiWebApp.ApplicationController.restartApp=YES;if(d[f+"keyId"]==="410")DigiWebApp.ApplicationController.restartApp=
YES;if(d[f+"keyId"]==="411")DigiWebApp.ApplicationController.restartApp=YES;if(d[f+"keyId"]==="412")DigiWebApp.ApplicationController.restartApp=YES}}DigiWebApp.ApplicationController.triggerUpdate=YES});if(DigiWebApp.ApplicationController.triggerUpdate){DigiWebApp.DashboardPage.needsUpdate=true;DigiWebApp.MediaListPage.needsUpdate=true;DigiWebApp.DashboardController.init(YES);DigiWebApp.MediaListController.init(YES)}DigiWebApp.ApplicationController.triggerUpdate=NO}else{this.setCallbackStatus("features",
"remote",YES);DigiWebApp.Features.deleteAll();this.setCallbackStatus("features","local",NO)}this.setCallbackStatus("features","local",YES);DigiWebApp.SettingsController.globalDebugMode=DigiWebApp.SettingsController.getSetting("debug")?YES:NO;if(DigiWebApp.SettingsController.featureAvailable("409")&&DigiWebApp.ApplicationController.profilingIntervalVar===null){DigiWebApp.NavigationController.toDashboardPage(YES);DigiWebApp.ApplicationController.restartApp===YES&&DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("newFeatureActive"),
message:M.I18N.l("newFeatureActiveMsg"),callbacks:{confirm:{action:function(){if(typeof navigator.app!=="undefined")typeof location.origin!=="undefined"?navigator.app.loadUrl(location.origin+location.pathname):navigator.app.loadUrl(location.protocol+"//"+location.pathname);else window.location.reload()}}}})}},getKolonneFromRemote:function(){DigiWebApp.RequestController.getKolonne({success:{target:this,action:function(a,b,c){this.getKolonneFromRemoteSuccess(a,b,c)}},error:{target:this,action:function(){console.error("getKolonneFromRemote-error");
this.proceedWithLocalData("getKolonneFromRemote")}}})},getKolonneFromRemoteSuccess:function(a){if(a)if(typeof a["return"]==="undefined")a["return"]=a["ns:return"];if(a&&a["return"]){this.setCallbackStatus("kolonne","remote",YES);DigiWebApp.Employee.deleteAll();this.setCallbackStatus("kolonne","local",NO);var b=[],c=null;if(_.isObject(a["return"])&&!_.isArray(a["return"]))a["return"]=[a["return"]];_.each(a["return"],function(d){c=DigiWebApp.Employee.createRecord({id:d.id,name:d.name,kolonnenId:d.kolonnenId,
isSelected:NO});try{c.save();b.push(c.m_id)}catch(f){console.error("ERROR in "+this.name+".getKolonneFromRemoteSuccess: "+f)}});localStorage.setItem(this.storagePrefix+"_employeeKeys",JSON.stringify(b));this.setCallbackStatus("kolonne","local",YES);localStorage.getItem(DigiWebApp.EmployeeController.empSelectionKey)==0&&localStorage.removeItem(DigiWebApp.EmployeeController.empSelectionKey);DigiWebApp.EmployeeController.getEmployeeState()!=2&&DigiWebApp.EmployeeController.setEmployeeState(1)}else{this.setCallbackStatus("kolonne",
"remote",YES);DigiWebApp.Employee.deleteAll();this.setCallbackStatus("kolonne","local",NO);b=[];c=DigiWebApp.Employee.createRecord({id:"0",name:"Standardmitarbeiter",kolonnenId:"",isSelected:YES}).save();b.push(c.m_id);localStorage.setItem(this.storagePrefix+"_employeeKeys",JSON.stringify(b));this.setCallbackStatus("kolonne","local",YES);DigiWebApp.EmployeeController.setEmployeeState(0)}this.endSession();this.syncStopTimestamp=D8.now().getTimestamp();this.syncLastDuration=this.syncStopTimestamp-this.syncStartTimestamp;
this.profilingIntervalVar!==null&&console.log("DIGI-WebApp-Profiling "+D8.now().format("yyyymmdd-HHMMss")+" "+this.syncLastDuration+"ms");this.profilingShowAlert&&alert("DIGI-WebApp-Profiling: "+M.I18N.l("profilingTook")+" "+this.syncLastDuration+"ms");DigiWebApp.ApplicationController.syncRunning=NO;if(this.isReadyToProceed()){if(DigiWebApp.ApplicationController.profilingIntervalVar===null){if(DigiWebApp.SettingsController.featureAvailable("409"))DigiWebApp.NavigationController.toDashboardPage(YES);
else{DigiWebApp.NavigationController.toBookTimePage(YES);DigiWebApp.BookingController.init()}DigiWebApp.ApplicationController.restartApp===YES&&DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("newFeatureActive"),message:M.I18N.l("newFeatureActiveMsg"),callbacks:{confirm:{action:function(){if(typeof navigator.app!=="undefined")typeof location.origin!=="undefined"?navigator.app.loadUrl(location.origin+location.pathname):navigator.app.loadUrl(location.protocol+"//"+location.pathname);
else window.location.reload()}}}})}DigiWebApp.ApplicationController.setTransitionsSetting()}else{DigiWebApp.ApplicationController.setTransitionsSetting();DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("offlineWorkNotPossible"),message:M.I18N.l("offlineWorkNotPossibleMsg")})}if(this.profilingSingleRun)this.profilingIntervalVar=null},endSession:function(){DigiWebApp.ApplicationController.enforceChefToolOnly();DigiWebApp.RequestController.endSession({success:{target:this,action:function(){}},
error:{target:this,action:function(){console.error("endSession-error")}}})},setCallbackStatus:function(a,b,c){this.callbackStatus[a][b]=c},isReadyToProceed:function(){var a=this.callbackStatus.position,b=this.callbackStatus.activity,c=this.callbackStatus.order;return(a.remote||a.local)&&(b.remote||b.local)&&(c.remote||c.local)},sonderzeichenCheck:function(a){return/[^\w\s\u00e4\u00f6\u00fc\u00c4\u00d6\u00dc\u00df \x40"(){}*%\$\u00a7\u20ac=/\\!?.,;:+-]+/.test(a)},profilingIntervalVar:null,profilingSingleRun:NO,
profilingShowAlert:NO,startProfiling:function(a){if(DigiWebApp.ApplicationController.profilingIntervalVar===null)if(typeof a==="undefined")DigiWebApp.ApplicationController.profilingIntervalVar=null;else if(a!==0)if(a>1E4){DigiWebApp.ApplicationController.profilingSingleRun=NO;DigiWebApp.ApplicationController.profilingIntervalVar=setInterval(function(){DigiWebApp.ApplicationController.startsync()},a)}else console.error("Profiling-Interval too low!");else{DigiWebApp.ApplicationController.profilingSingleRun=
YES;DigiWebApp.ApplicationController.profilingIntervalVar=setTimeout(function(){clearTimeout(DigiWebApp.ApplicationController.profilingIntervalVar);DigiWebApp.ApplicationController.startsync()},10)}else console.error("Profiling already running!")},stopProfiling:function(){clearInterval(DigiWebApp.ApplicationController.profilingIntervalVar);DigiWebApp.ApplicationController.profilingIntervalVar=null},deleteAllData:function(){try{DigiWebApp.Booking.deleteAll()}catch(a){}try{DigiWebApp.MediaFile.deleteAll()}catch(b){}try{localStorage.clear("f")}catch(c){}}});
DigiWebApp.ZeitbuchungenController=M.Controller.extend({items:null,itemForDetails:null,datum:null,mitarbeiterID:null,mitarbeiterNameVorname:null,init:function(a){DigiWebApp.VorZurueckTabBar.setActiveTab(DigiWebApp.VorZurueckTabBar.tabItemDayToShow);DigiWebApp.ZeitbuchungenController.items===null?DigiWebApp.RequestController.getDatabaseServer(DigiWebApp.ZeitbuchungenController.initWithServer,a):DigiWebApp.ZeitbuchungenController.initWithServer(a)},initWithServer:function(){if(DigiWebApp.ZeitbuchungenController.items===
null){DigiWebApp.ApplicationController.DigiLoaderView.show(M.I18N.l("ZeitbuchungenLaden"));DigiWebApp.Zeitbuchungen.find({urlParams:{datum:DigiWebApp.ZeitbuchungenController.datum,mitarbeiterID:DigiWebApp.ZeitbuchungenController.mitarbeiterID},callbacks:{success:{action:function(c){DigiWebApp.ApplicationController.DigiLoaderView.hide();try{!c||c&&c.length===0||c&&c.length===1&&typeof c[0].get("mitarbeiterId")==="undefined"?DigiWebApp.ZeitbuchungenController.set("items",[]):DigiWebApp.ZeitbuchungenController.set("items",
c)}catch(d){DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("error"),message:M.I18N.l("ZeitbuchungenKonntenNichtGeladenWerden"),callbacks:{confirm:{target:this,action:function(){DigiWebApp.NavigationController.backToAnwesenheitslistePageTransition()}}}})}}},error:{action:function(){DigiWebApp.ApplicationController.DigiLoaderView.hide();DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("error"),message:M.I18N.l("ZeitbuchungenKonntenNichtGeladenWerden"),callbacks:{confirm:{target:this,
action:function(){DigiWebApp.NavigationController.backToAnwesenheitslistePageTransition()}}}})}}}})}if(DigiWebApp.ZeitbuchungenController.mitarbeiterNameVorname!==null){try{var a=M.I18N.l(D8.create(DigiWebApp.ZeitbuchungenController.datum).format("dddd")).substring(0,2)+", "}catch(b){a=""}DigiWebApp.ZeitbuchungenPage.header.title.set("value",DigiWebApp.ZeitbuchungenController.mitarbeiterNameVorname+"<br />"+a+DigiWebApp.ZeitbuchungenController.datum);DigiWebApp.ZeitbuchungenPage.header.title.renderUpdate()}}});
DigiWebApp.DemoAudioController=M.Controller.extend({myAudioObject:{},myTimeStamp:null,myFilename:null,myState:null,init:function(){DigiWebApp.SettingsController.globalDebugMode&&console.log("init");DigiWebApp.SettingsController.globalDebugMode&&console.log("this.myState = "+this.myState);DigiWebApp.DemoAudioPage.content.grid.button.events={tap:{action:DigiWebApp.DemoAudioController.recordAudio}};DigiWebApp.DemoAudioPage.content.grid.button.registerEvents();DigiWebApp.DemoAudioPage.content.audioIcon.events=
{tap:{action:DigiWebApp.DemoAudioController.recordAudio}};DigiWebApp.DemoAudioPage.content.audioIcon.registerEvents();document.getElementById(DigiWebApp.DemoAudioPage.content.audioIcon.id).src="theme/images/icon_record.png";this.myTimeStamp=M.Date.create(new Date).format("yymmddHHMMss");this.myFilename="DIGI-WebApp-recording-"+this.myTimeStamp+".wav";this.myState=null;DigiWebApp.DemoAudioController.myAudioObject=new Media(this.myFilename,this.onSuccess,this.onError,this.mediaStatus,this.mediaPosition);
DigiWebApp.SettingsController.globalDebugMode&&console.log(this.myFilename);DigiWebApp.SettingsController.globalDebugMode&&console.log(DigiWebApp.DemoAudioController.myAudioObject)},mediaStatus:function(a){DigiWebApp.SettingsController.globalDebugMode&&console.log("mediaStatus: "+a)},mediaPosition:function(a){DigiWebApp.SettingsController.globalDebugMode&&console.log("mediaPosition: "+a)},onSuccess:function(){DigiWebApp.SettingsController.globalDebugMode&&console.log("onSuccess");DigiWebApp.SettingsController.globalDebugMode&&
console.log("this.myState = "+this.myState);switch(this.myState){case "play":DigiWebApp.DemoAudioPage.content.audioIcon.events={tap:{action:DigiWebApp.DemoAudioController.stopPlayback}};DigiWebApp.DemoAudioPage.content.audioIcon.registerEvents();document.getElementById(DigiWebApp.DemoAudioPage.content.audioIcon.id).src="theme/images/icon_stop.png";break;case "record":DigiWebApp.DemoAudioPage.content.audioIcon.events={tap:{action:DigiWebApp.DemoAudioController.stopRecord}};DigiWebApp.DemoAudioPage.content.audioIcon.registerEvents();
document.getElementById(DigiWebApp.DemoAudioPage.content.audioIcon.id).src="theme/images/icon_stop.png";DigiWebApp.DemoAudioPage.content.grid.button.events={tap:{action:DigiWebApp.DemoAudioController.init}};DigiWebApp.DemoAudioPage.content.grid.button.registerEvents();break;case "stop":DigiWebApp.DemoAudioPage.content.audioIcon.events={tap:{action:DigiWebApp.DemoAudioController.playbackAudio}};DigiWebApp.DemoAudioPage.content.audioIcon.registerEvents();document.getElementById(DigiWebApp.DemoAudioPage.content.audioIcon.id).src=
"theme/images/icon_playbackAudio.png";break;default:DigiWebApp.DemoAudioPage.content.audioIcon.events={tap:{action:DigiWebApp.DemoAudioController.playbackAudio}};DigiWebApp.DemoAudioPage.content.audioIcon.registerEvents();document.getElementById(DigiWebApp.DemoAudioPage.content.audioIcon.id).src="theme/images/icon_playbackAudio.png"}},onError:function(a){DigiWebApp.SettingsController.globalDebugMode&&console.log("onError");console.log("code: "+a.code+"\nmessage: "+a.message+"\n");console.log("Filename: "+
this.myFilename);DigiWebApp.DemoAudioPage.content.audioIcon.events={tap:{action:DigiWebApp.DemoAudioController.playbackAudio}};DigiWebApp.DemoAudioPage.content.audioIcon.registerEvents();document.getElementById(DigiWebApp.DemoAudioPage.content.audioIcon.id).src="theme/images/icon_playbackAudio.png";DigiWebApp.DemoAudioPage.content.grid.button.events={tap:{action:DigiWebApp.DemoAudioController.init}};DigiWebApp.DemoAudioPage.content.grid.button.registerEvents()},recordAudio:function(){this.myState=
"record";DigiWebApp.DemoAudioController.myAudioObject.startRecord();DigiWebApp.DemoAudioPage.content.audioIcon.events={tap:{action:DigiWebApp.DemoAudioController.stopRecord}};DigiWebApp.DemoAudioPage.content.audioIcon.registerEvents();document.getElementById(DigiWebApp.DemoAudioPage.content.audioIcon.id).src="theme/images/icon_stop.png";DigiWebApp.DemoAudioPage.content.grid.button.events={tap:{action:DigiWebApp.DemoAudioController.init}};DigiWebApp.DemoAudioPage.content.grid.button.registerEvents();
DigiWebApp.SettingsController.globalDebugMode&&console.log("recordAudio");DigiWebApp.SettingsController.globalDebugMode&&console.log("this.myState = "+this.myState)},stopRecord:function(){this.myState="stop";DigiWebApp.DemoAudioController.myAudioObject.stopRecord();DigiWebApp.DemoAudioPage.content.audioIcon.events={tap:{action:DigiWebApp.DemoAudioController.playbackAudio}};DigiWebApp.DemoAudioPage.content.audioIcon.registerEvents();document.getElementById(DigiWebApp.DemoAudioPage.content.audioIcon.id).src=
"theme/images/icon_playbackAudio.png";DigiWebApp.SettingsController.globalDebugMode&&console.log("stopRecord");DigiWebApp.SettingsController.globalDebugMode&&console.log("this.myState = "+this.myState)},playbackAudio:function(){this.myState="play";DigiWebApp.DemoAudioController.myAudioObject.play();DigiWebApp.DemoAudioPage.content.audioIcon.events={tap:{action:DigiWebApp.DemoAudioController.stopPlayback}};DigiWebApp.DemoAudioPage.content.audioIcon.registerEvents();document.getElementById(DigiWebApp.DemoAudioPage.content.audioIcon.id).src=
"theme/images/icon_stop.png";DigiWebApp.SettingsController.globalDebugMode&&console.log("playbackAudio");DigiWebApp.SettingsController.globalDebugMode&&console.log("this.myState = "+this.myState)},stopPlayback:function(){this.myState="stop";DigiWebApp.DemoAudioController.myAudioObject.stop();DigiWebApp.DemoAudioPage.content.audioIcon.events={tap:{action:DigiWebApp.DemoAudioController.playbackAudio}};DigiWebApp.DemoAudioPage.content.audioIcon.registerEvents();document.getElementById(DigiWebApp.DemoAudioPage.content.audioIcon.id).src=
"theme/images/icon_playbackAudio.png";DigiWebApp.SettingsController.globalDebugMode&&console.log("stopPlayback");DigiWebApp.SettingsController.globalDebugMode&&console.log("this.myState = "+this.myState)}});
DigiWebApp.NavigationController=M.Controller.extend({toSplashViewPage:function(){DigiWebApp.NavigationController.switchToPage("splashView",M.TRANSITION.NONE,NO)},toSplashViewPageTransition:function(){DigiWebApp.NavigationController.switchToPage("splashView",M.TRANSITION.FADE,NO)},backToDashboardPage:function(){DigiWebApp.NavigationController.switchToPage("dashboard",M.TRANSITION.SLIDEUP,YES)},backToDashboardPagePOP:function(){DigiWebApp.NavigationController.switchToPage("dashboard",M.TRANSITION.POP,
YES)},backToDashboardPageFlipTransition:function(){DigiWebApp.NavigationController.switchToPage("dashboard",M.TRANSITION.FLIP,YES)},toDashboardPageFlipTransition:function(){DigiWebApp.NavigationController.switchToPage("dashboard",M.TRANSITION.FLIP,NO)},toInfoPage:function(){DigiWebApp.NavigationController.switchToPage("infoPage",M.TRANSITION.NONE,NO)},toInfoPageTransition:function(){DigiWebApp.NavigationController.switchToPage("infoPage",M.TRANSITION.SLIDEUP,NO)},backToBookTimePage:function(){if(DigiWebApp.SettingsController.featureAvailable("409")){DigiWebApp.ApplicationController.useSplashJustForFade=
YES;DigiWebApp.NavigationController.toSplashViewPage();DigiWebApp.ApplicationController.useSplashJustForFade=0}else try{DigiWebApp.NavigationController.switchToPage("bookingPage",M.TRANSITION.SLIDEUP,YES)}catch(a){}},backToBookTimePagePOP:function(){if(DigiWebApp.SettingsController.featureAvailable("409")){DigiWebApp.ApplicationController.useSplashJustForFade=YES;DigiWebApp.NavigationController.toSplashViewPage();DigiWebApp.ApplicationController.useSplashJustForFade=0}else try{DigiWebApp.NavigationController.switchToPage("bookingPage",
M.TRANSITION.POP,YES)}catch(a){}},toBookTimePage:function(){if(DigiWebApp.SettingsController.featureAvailable("409")){DigiWebApp.ApplicationController.useSplashJustForFade=YES;DigiWebApp.NavigationController.toSplashViewPage();DigiWebApp.ApplicationController.useSplashJustForFade=0}else try{DigiWebApp.NavigationController.switchToPage("bookingPage",M.TRANSITION.NONE,NO)}catch(a){}},toBookTimePageTransition:function(){if(DigiWebApp.SettingsController.featureAvailable("409")){DigiWebApp.ApplicationController.useSplashJustForFade=
YES;DigiWebApp.NavigationController.toSplashViewPage();DigiWebApp.ApplicationController.useSplashJustForFade=0}else try{DigiWebApp.NavigationController.switchToPage("bookingPage",M.TRANSITION.SLIDEUP,NO)}catch(a){}},toBookTimePageFlipTransition:function(){if(DigiWebApp.SettingsController.featureAvailable("409")){DigiWebApp.ApplicationController.useSplashJustForFade=YES;DigiWebApp.NavigationController.toSplashViewPage();DigiWebApp.ApplicationController.useSplashJustForFade=0}else try{DigiWebApp.NavigationController.switchToPage("bookingPage",
M.TRANSITION.FLIP,YES)}catch(a){}},backToBookTimePageFlipTransition:function(){if(DigiWebApp.SettingsController.featureAvailable("409")){DigiWebApp.ApplicationController.useSplashJustForFade=YES;DigiWebApp.NavigationController.toSplashViewPage();DigiWebApp.ApplicationController.useSplashJustForFade=0}else try{DigiWebApp.NavigationController.switchToPage("bookingPage",M.TRANSITION.FLIP,NO)}catch(a){}},toHandOrderPage:function(){DigiWebApp.SettingsController.featureAvailable("409")?DigiWebApp.NavigationController.toDashboardPage():
DigiWebApp.NavigationController.switchToPage("handOrderPage",M.TRANSITION.NONE,NO)},toHandOrderPageTransition:function(){DigiWebApp.SettingsController.featureAvailable("409")?DigiWebApp.NavigationController.toDashboardPage():DigiWebApp.NavigationController.switchToPage("handOrderPage",M.TRANSITION.SLIDEUP,NO)},toSettingsPage:function(){DigiWebApp.NavigationController.switchToPage("settingsPage",M.TRANSITION.NONE,NO)},backToSettingsPage:function(){DigiWebApp.NavigationController.switchToPage("settingsPage",
M.TRANSITION.POP,YES)},toSettingsPasswordPage:function(){DigiWebApp.NavigationController.switchToPage("settingsPasswordPage",M.TRANSITION.NONE,NO)},toSettingsPasswordPageTransition:function(){DigiWebApp.NavigationController.switchToPage("settingsPasswordPage",M.TRANSITION.POP,NO)},toTimeDataPage:function(){DigiWebApp.NavigationController.switchToPage("timeDataPage",M.TRANSITION.NONE,NO)},toTimeDataPageTransition:function(){DigiWebApp.NavigationController.switchToPage("timeDataPage",M.TRANSITION.SLIDEUP,
NO)},backToTimeDataPage:function(){DigiWebApp.NavigationController.switchToPage("timeDataPage",M.TRANSITION.SLIDEUP,YES)},toEmployeePage:function(){DigiWebApp.NavigationController.switchToPage("employeePage",M.TRANSITION.POP,NO)},toDashboardPage:function(){DigiWebApp.NavigationController.switchToPage("dashboard",M.TRANSITION.NONE,NO)},toDashboardPageTransition:function(){DigiWebApp.NavigationController.switchToPage("dashboard",M.TRANSITION.SLIDEUP,NO)},toOrderInfoPage:function(){DigiWebApp.NavigationController.switchToPage("orderInfoPage",
M.TRANSITION.NONE,NO)},toOrderInfoPageTransition:function(){DigiWebApp.NavigationController.switchToPage("orderInfoPage",M.TRANSITION.SLIDEUP,NO)},toEditPicturePage:function(){DigiWebApp.NavigationController.switchToPage("editPicturePage",M.TRANSITION.NONE,NO)},toEditPicturePageTransition:function(){DigiWebApp.NavigationController.switchToPage("editPicturePage",M.TRANSITION.SLIDEUP,NO)},backToEditPicturePage:function(){DigiWebApp.NavigationController.switchToPage("editPicturePage",M.TRANSITION.SLIDEUP,
YES)},toDemoMediaPage:function(){DigiWebApp.NavigationController.switchToPage("demomediaPage",M.TRANSITION.NONE,NO)},toDemoMediaPageTransition:function(){DigiWebApp.NavigationController.switchToPage("demomediaPage",M.TRANSITION.SLIDEUP,NO)},backToDemoMediaPage:function(){DigiWebApp.NavigationController.switchToPage("demomediaPage",M.TRANSITION.SLIDEUP,YES)},toMediaListPage:function(){DigiWebApp.NavigationController.switchToPage("mediaListPage",M.TRANSITION.NONE,NO)},toMediaListPageTransition:function(){DigiWebApp.NavigationController.switchToPage("mediaListPage",
M.TRANSITION.SLIDEUP,NO)},backToMediaListPage:function(){DigiWebApp.NavigationController.switchToPage("mediaListPage",M.TRANSITION.NONE,YES)},backToMediaListPageTransition:function(){DigiWebApp.NavigationController.switchToPage("mediaListPage",M.TRANSITION.SLIDEUP,YES)},toAudioPage:function(){DigiWebApp.NavigationController.switchToPage("audioPage",M.TRANSITION.NONE,NO)},toAudioPageTransition:function(){DigiWebApp.NavigationController.switchToPage("audioPage",M.TRANSITION.SLIDEUP,NO)},toDemoAudioPage:function(){DigiWebApp.NavigationController.switchToPage("demoaudioPage",
M.TRANSITION.NONE,NO)},toDemoAudioPageTransition:function(){DigiWebApp.NavigationController.switchToPage("demoaudioPage",M.TRANSITION.SLIDEUP,NO)},toCameraPage:function(){DigiWebApp.NavigationController.switchToPage("cameraPage",M.TRANSITION.NONE,NO)},toCameraPageTransition:function(){DigiWebApp.NavigationController.switchToPage("cameraPage",M.TRANSITION.SLIDEUP,NO)},toDemoCameraPage:function(){DigiWebApp.NavigationController.switchToPage("democameraPage",M.TRANSITION.NONE,NO)},toDemoCameraPageTransition:function(){DigiWebApp.NavigationController.switchToPage("democameraPage",
M.TRANSITION.SLIDEUP,NO)},toRemarkPage:function(a){DigiWebApp.RemarkPage.myCallback=typeof a==="function"?a:function(){DigiWebApp.NavigationController.toBookTimePage();DigiWebApp.BookingController.bookWithRemark()};DigiWebApp.NavigationController.switchToPage("remarkPage",M.TRANSITION.POP,NO)},toEditTimeDataPage:function(a){DigiWebApp.EditTimeDataPage.myCallback=typeof a==="function"?a:function(){DigiWebApp.NavigationController.backToTimeDataPage()};DigiWebApp.NavigationController.switchToPage("editTimeDataPage",
M.TRANSITION.SLIDEUP,NO)},toAnwesenheitslistePage:function(){DigiWebApp.AnwesenheitslisteController.set("items",{});DigiWebApp.AnwesenheitslisteController.items=null;DigiWebApp.NavigationController.switchToPage("anwesenheitslistePage",M.TRANSITION.NONE,NO)},toAnwesenheitslistePageTransition:function(){DigiWebApp.AnwesenheitslisteController.set("items",{});DigiWebApp.AnwesenheitslisteController.items=null;DigiWebApp.NavigationController.switchToPage("anwesenheitslistePage",M.TRANSITION.SLIDEUP,NO)},
backToAnwesenheitslistePage:function(){DigiWebApp.ZeitbuchungenController.set("items",{});DigiWebApp.ZeitbuchungenController.items=null;DigiWebApp.NavigationController.switchToPage("anwesenheitslistePage",M.TRANSITION.NONE,YES)},backToAnwesenheitslistePageTransition:function(){DigiWebApp.ZeitbuchungenController.set("items",{});DigiWebApp.ZeitbuchungenController.items=null;DigiWebApp.NavigationController.switchToPage("anwesenheitslistePage",M.TRANSITION.SLIDEUP,YES)},toZeitbuchungenPage:function(){DigiWebApp.ZeitbuchungenController.set("items",
{});DigiWebApp.ZeitbuchungenController.items=null;DigiWebApp.NavigationController.switchToPage("zeitbuchungenPage",M.TRANSITION.NONE,NO)},toZeitbuchungenPageTransition:function(){DigiWebApp.ZeitbuchungenController.set("items",{});DigiWebApp.ZeitbuchungenController.items=null;DigiWebApp.NavigationController.switchToPage("zeitbuchungenPage",M.TRANSITION.SLIDEUP,NO)},backToZeitbuchungenPage:function(){DigiWebApp.ZeitbuchungenController.set("itemForDetails",{});DigiWebApp.ZeitbuchungenController.itemForDetails=
null;DigiWebApp.NavigationController.switchToPage("zeitbuchungenPage",M.TRANSITION.NONE,YES)},backToZeitbuchungenPageTransition:function(){DigiWebApp.ZeitbuchungenController.set("itemForDetails",{});DigiWebApp.ZeitbuchungenController.itemForDetails=null;DigiWebApp.NavigationController.switchToPage("zeitbuchungenPage",M.TRANSITION.SLIDEUP,YES)},toZeitbuchungDetailsPage:function(){DigiWebApp.NavigationController.switchToPage("zeitbuchungDetailsPage",M.TRANSITION.NONE,NO)},toZeitbuchungDetailsPageTransition:function(){DigiWebApp.NavigationController.switchToPage("zeitbuchungDetailsPage",
M.TRANSITION.SLIDEUP,NO)},backToZeitbuchungDetailsPage:function(){DigiWebApp.OrderDetailsController.set("positionForDetails",{});DigiWebApp.OrderDetailsController.positionForDetails=null;DigiWebApp.NavigationController.switchToPage("zeitbuchungDetailsPage",M.TRANSITION.NONE,YES)},backToZeitbuchungDetailsPageTransition:function(){DigiWebApp.OrderDetailsController.set("positionForDetails",{});DigiWebApp.OrderDetailsController.positionForDetails=null;DigiWebApp.NavigationController.switchToPage("zeitbuchungDetailsPage",
M.TRANSITION.SLIDEUP,YES)},toOrderDetailsPage:function(){DigiWebApp.NavigationController.switchToPage("orderDetailsPage",M.TRANSITION.NONE,NO)},toOrderDetailsPageTransition:function(){DigiWebApp.NavigationController.switchToPage("orderDetailsPage",M.TRANSITION.SLIDEUP,NO)},toTimeDataArchivePage:function(){DigiWebApp.NavigationController.switchToPage("timeDataArchivePage",M.TRANSITION.NONE,NO)},toTimeDataArchivePageTransition:function(){DigiWebApp.NavigationController.switchToPage("timeDataArchivePage",
M.TRANSITION.SLIDEUP,NO)}});
DigiWebApp.SettingsController=M.Controller.extend({showCredentialsAlert:NO,credentialsAlertShown:false,showIOSMessage:true,settings:null,mitarbeiterNameVorname:"",globalDebugMode:NO,defaultsettings_object:{debug:false,treatAllAsTablet:false,treatAllAsPhone:false,company:"",password:"",connectionCode:"",settingsPassword:"digi$",workerId:"",platform:"",userAgent:"",skipEvents:"",timeouthappened:"",mapType:"Google",autoSyncAfterBookTime:false,autoTransferAfterBookTime:true,autoTransferAfterClosingDay:true,
autoSaveGPSData:false,GPSDataIsMandatory:false,remarkIsMandatory:false,useTransitionsSetting:true,daysToHoldBookingsOnDevice:"10"},defaultsettings:null,init:function(){DigiWebApp.TabBar.setActiveTab(DigiWebApp.TabBar.tabItem2);if(this.showCredentialsAlert&&!this.credentialsAlertShown){if((M.Environment.getPlatform().substr(0,4)==="iPad"||M.Environment.getPlatform().substr(0,6)==="iPhone")&&typeof device!=="undefined"){DigiWebApp.ApplicationController.enforceChefToolOnly();console.log("device.version: "+
device.version)}else DigiWebApp.ApplicationController.enforceChefToolOnly();DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("noCredentials"),message:M.I18N.l("noCredentialsMsg")});this.credentialsAlertShown=true}this.defaultsettings=DigiWebApp.Settings.createRecord(DigiWebApp.SettingsController.defaultsettings_object);DigiWebApp.Settings.find();DigiWebApp.SettingsController.featureAvailable("403")?$("#"+DigiWebApp.SettingsPage.content.remarkIsMandatory.id).show():$("#"+DigiWebApp.SettingsPage.content.remarkIsMandatory.id).hide();
DigiWebApp.SettingsController.featureAvailable("411")?$("#"+DigiWebApp.SettingsPage.content.daysToHoldBookingsOnDeviceSliderContainer.id).show():$("#"+DigiWebApp.SettingsPage.content.daysToHoldBookingsOnDeviceSliderContainer.id).hide();DigiWebApp.ApplicationController.enforceChefToolOnly();$("#"+DigiWebApp.SettingsPage.content.useTransitionsSetting.id).hide();var a=null;if(DigiWebApp.Settings.records().length>0){a=DigiWebApp.Settings.records()[0];var b=a.get("daysToHoldBookingsOnDevice");b||(b=DigiWebApp.SettingsController.defaultsettings.get("daysToHoldBookingsOnDevice"));
var c=a.get("GPSDataIsMandatory");c||(c=DigiWebApp.SettingsController.defaultsettings.get("GPSDataIsMandatory"));a={debug:[{value:a.get("debug"),label:"debug",isSelected:a.get("debug")}],treatAllAsTablet:[{value:a.get("treatAllAsTablet"),label:"treatAllAsTablet",isSelected:a.get("treatAllAsTablet")}],treatAllAsPhone:[{value:a.get("treatAllAsPhone"),label:"treatAllAsPhone",isSelected:a.get("treatAllAsPhone")}],daysToHoldBookingsOnDevice:b,company:a.get("company"),password:a.get("password"),connectionCode:a.get("connectionCode"),
settingsPassword:a.get("settingsPassword"),workerId:a.get("workerId"),timeouthappened:DigiWebApp.ApplicationController.timeouthappened,skipEvents:DigiWebApp.ApplicationController.skipEvents,platform:M.Environment.getPlatform(),userAgent:navigator.userAgent,mapType:a.get("mapType"),autoSyncAfterBookTime:[{value:a.get("autoSyncAfterBookTime"),label:M.I18N.l("autoSyncAfterBookTimeCheck"),isSelected:a.get("autoSyncAfterBookTime")}],autoTransferAfterBookTime:[{value:a.get("autoTransferAfterBookTime"),
label:M.I18N.l("autoTransferAfterBookTimeCheck"),isSelected:a.get("autoTransferAfterBookTime")}],autoTransferAfterClosingDay:[{value:a.get("autoTransferAfterClosingDay"),label:M.I18N.l("autoTransferAfterClosingDayCheck"),isSelected:a.get("autoTransferAfterClosingDay")}],autoSaveGPSData:[{value:a.get("autoSaveGPSData"),label:M.I18N.l("autoSaveGPSData"),isSelected:a.get("autoSaveGPSData")}],GPSDataIsMandatory:[{value:c,label:M.I18N.l("GPSDataIsMandatory"),isSelected:c}],remarkIsMandatory:[{value:a.get("remarkIsMandatory"),
label:M.I18N.l("remarkIsMandatory"),isSelected:a.get("remarkIsMandatory")}],useTransitionsSetting:[{value:a.get("useTransitionsSetting"),label:M.I18N.l("useTransitionsSetting"),isSelected:a.get("useTransitionsSetting")}]}}else{a={debug:[{value:DigiWebApp.SettingsController.defaultsettings.get("debug"),label:"debug"}],treatAllAsTablet:[{value:DigiWebApp.SettingsController.defaultsettings.get("treatAllAsTablet"),label:"treatAllAsTablet"}],treatAllAsPhone:[{value:DigiWebApp.SettingsController.defaultsettings.get("treatAllAsPhone"),
label:"treatAllAsPhone"}],daysToHoldBookingsOnDevice:DigiWebApp.SettingsController.defaultsettings.get("daysToHoldBookingsOnDevice"),company:DigiWebApp.SettingsController.defaultsettings.get("company"),password:DigiWebApp.SettingsController.defaultsettings.get("password"),connectionCode:DigiWebApp.SettingsController.defaultsettings.get("connectionCode"),settingsPassword:DigiWebApp.SettingsController.defaultsettings.get("settingsPassword"),workerId:DigiWebApp.SettingsController.defaultsettings.get("workerId"),
timeouthappened:DigiWebApp.ApplicationController.timeouthappened,skipEvents:DigiWebApp.ApplicationController.skipEvents,platform:M.Environment.getPlatform(),userAgent:navigator.userAgent,mapType:DigiWebApp.SettingsController.defaultsettings.get("mapType"),autoSyncAfterBookTime:[{value:DigiWebApp.SettingsController.defaultsettings.get("autoSyncAfterBookTime"),label:M.I18N.l("autoSyncAfterBookTimeCheck")}],autoTransferAfterBookTime:[{value:DigiWebApp.SettingsController.defaultsettings.get("autoTransferAfterBookTime"),
label:M.I18N.l("autoTransferAfterBookTimeCheck")}],autoTransferAfterClosingDay:[{value:DigiWebApp.SettingsController.defaultsettings.get("autoTransferAfterClosingDay"),label:M.I18N.l("autoTransferAfterClosingDayCheck")}],autoSaveGPSData:[{value:DigiWebApp.SettingsController.defaultsettings.get("autoSaveGPSData"),label:M.I18N.l("autoSaveGPSData")}],GPSDataIsMandatory:[{value:DigiWebApp.SettingsController.defaultsettings.get("GPSDataIsMandatory"),label:M.I18N.l("GPSDataIsMandatory")}],remarkIsMandatory:[{value:DigiWebApp.SettingsController.defaultsettings.get("remarkIsMandatory"),
label:M.I18N.l("remarkIsMandatory")}],useTransitionsSetting:[{value:DigiWebApp.SettingsController.defaultsettings.get("useTransitionsSetting"),label:M.I18N.l("useTransitionsSetting")}]};DigiWebApp.Settings.createRecord(DigiWebApp.SettingsController.defaultsettings_object).save()}this.set("settings",a)},saveDone:YES,save:function(){if(DigiWebApp.SettingsController.saveDone===YES){DigiWebApp.SettingsController.saveDone=NO;var a=DigiWebApp.SettingsController.globalDebugMode,b=DigiWebApp.SettingsController.getSetting("treatAllAsTablet"),
c=DigiWebApp.SettingsController.getSetting("treatAllAsPhone"),d=DigiWebApp.SettingsController.getSetting("settingsPassword"),f=$("#"+M.ViewManager.getView("settingsPage","daysToHoldBookingsOnDeviceSlider").id).val(),e=$("#"+M.ViewManager.getView("settingsPage","companyInput").id).val(),g=$("#"+M.ViewManager.getView("settingsPage","passwordInput").id).val(),k=$("#"+M.ViewManager.getView("settingsPage","connectionCodeInput").id).val(),h=$("#"+M.ViewManager.getView("settingsPage","workerIdInput").id).val(),
l=DigiWebApp.ApplicationController.timeouthappened,m=DigiWebApp.ApplicationController.skipEvents,n=M.Environment.getPlatform(),o=navigator.userAgent,p=DigiWebApp.SettingsController.getSetting("mapType"),q=$("#"+M.ViewManager.getView("settingsPage","autoSyncAfterBookTimeCheck").id+" label.ui-checkbox-on").length>0?YES:NO,s=$("#"+M.ViewManager.getView("settingsPage","autoTransferAfterBookTimeCheck").id+" label.ui-checkbox-on").length>0?YES:NO,t=$("#"+M.ViewManager.getView("settingsPage","autoTransferAfterClosingDayCheck").id+
" label.ui-checkbox-on").length>0?YES:NO,u=$("#"+M.ViewManager.getView("settingsPage","autoSaveGPSData").id+" label.ui-checkbox-on").length>0?YES:NO,r=NO;if(M.ViewManager.getView("settingsPage","remarkIsMandatory")!==null)r=$("#"+M.ViewManager.getView("settingsPage","remarkIsMandatory").id+" label.ui-checkbox-on").length>0?YES:NO;var v=NO;if(M.ViewManager.getView("settingsPage","GPSDataIsMandatory")!==null)r=$("#"+M.ViewManager.getView("settingsPage","GPSDataIsMandatory").id+" label.ui-checkbox-on").length>
0?YES:NO;var w=$("#"+M.ViewManager.getView("settingsPage","useTransitionsSetting").id+" label.ui-checkbox-on").length>0?YES:NO,x=/^[0-9]+$/;if(e)if(!x.test(e)){DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("inputError"),message:M.I18N.l("inputErrorOnlyNumbers")+":<br />"+M.I18N.l("company")});DigiWebApp.SettingsController.saveDone=YES;return}if(h)if(!x.test(h)){DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("inputError"),message:M.I18N.l("inputErrorOnlyNumbers")+
":<br />"+M.I18N.l("workerId")});DigiWebApp.SettingsController.saveDone=YES;return}if(f)if(!x.test(f)){DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("inputError"),message:M.I18N.l("inputErrorOnlyNumbers")+":<br />"+M.I18N.l("daysToHoldBookingsOnDeviceLabel")});DigiWebApp.SettingsController.saveDone=YES;return}DigiWebApp.ApplicationController.nativeConfirmDialogView({title:M.I18N.l("hint"),message:M.I18N.l("confirmSaveOfSettings"),callbacks:{confirm:{action:function(){var i=
DigiWebApp.Settings.find()[0];if(i){var y=i.get("company")==""&&i.get("password")==""&&i.get("connectionCode")==""&&i.get("workerId")=="";if(!y&&(i.get("company")!=e||i.get("password")!=g||i.get("connectionCode")!=k||i.get("workerId")!=h))if(DigiWebApp.Booking.find().length>0)DigiWebApp.ApplicationController.nativeConfirmDialogView({title:M.I18N.l("hint"),message:M.I18N.l("openBookingsOverwriteBySettingsUpdate"),callbacks:{confirm:{action:function(){DigiWebApp.ApplicationController.restartApp=YES;
i.set("debug",a);i.set("treatAllAsTablet",b);i.set("treatAllAsPhone",c);i.set("daysToHoldBookingsOnDevice",f);i.set("company",e);i.set("password",g);i.set("connectionCode",k);i.set("settingsPassword",d);i.set("workerId",h);i.set("timeouthappened",l);i.set("skipEvents",m);i.set("platform",n);i.set("userAgent",o);i.set("mapType",p);i.set("autoSyncAfterBookTime",q);i.set("autoTransferAfterBookTime",s);i.set("autoTransferAfterClosingDay",t);i.set("autoSaveGPSData",u);i.set("GPSDataIsMandatory",v);i.set("remarkIsMandatory",
r);i.set("useTransitionsSetting",w);DigiWebApp.SettingsController.saveSettings(i,YES);DigiWebApp.SettingsController.saveDone=YES}},cancel:{action:function(){DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("hint"),message:M.I18N.l("settingsUpdateCanceled"),callbacks:{confirm:{action:function(){DigiWebApp.NavigationController.backToDashboardPage();DigiWebApp.SettingsController.saveDone=YES}}}})}}}});else{DigiWebApp.ApplicationController.restartApp=YES;i.set("debug",a);i.set("treatAllAsTablet",
b);i.set("treatAllAsPhone",c);i.set("daysToHoldBookingsOnDevice",f);i.set("company",e);i.set("password",g);i.set("connectionCode",k);i.set("settingsPassword",d);i.set("workerId",h);i.set("timeouthappened",l);i.set("skipEvents",m);i.set("platform",n);i.set("userAgent",o);i.set("mapType",p);i.set("autoSyncAfterBookTime",q);i.set("autoTransferAfterBookTime",s);i.set("autoTransferAfterClosingDay",t);i.set("autoSaveGPSData",u);i.set("GPSDataIsMandatory",v);i.set("remarkIsMandatory",r);i.set("useTransitionsSetting",
w);DigiWebApp.SettingsController.saveSettings(i,YES);DigiWebApp.SettingsController.saveDone=YES}else{if(y){i.set("debug",a);i.set("treatAllAsTablet",b);i.set("treatAllAsPhone",c);i.set("daysToHoldBookingsOnDevice",f);i.set("company",e);i.set("password",g);i.set("connectionCode",k);i.set("settingsPassword",d);i.set("workerId",h);i.set("timeouthappened",l);i.set("skipEvents",m);i.set("platform",n);i.set("userAgent",o);i.set("mapType",p);i.set("autoSyncAfterBookTime",q);i.set("autoTransferAfterBookTime",
s);i.set("autoTransferAfterClosingDay",t);i.set("autoSaveGPSData",u);i.set("GPSDataIsMandatory",v);i.set("remarkIsMandatory",r);i.set("useTransitionsSetting",w);DigiWebApp.SettingsController.saveSettings(i,YES)}else{i.set("debug",a);i.set("treatAllAsTablet",b);i.set("treatAllAsPhone",c);i.set("daysToHoldBookingsOnDevice",f);i.set("company",e);i.set("password",g);i.set("connectionCode",k);i.set("settingsPassword",d);i.set("workerId",h);i.set("timeouthappened",l);i.set("skipEvents",m);i.set("platform",
n);i.set("userAgent",o);i.set("mapType",p);i.set("autoSyncAfterBookTime",q);i.set("autoTransferAfterBookTime",s);i.set("autoTransferAfterClosingDay",t);i.set("autoSaveGPSData",u);i.set("GPSDataIsMandatory",v);i.set("remarkIsMandatory",r);i.set("useTransitionsSetting",w);DigiWebApp.SettingsController.saveSettings(i)}DigiWebApp.SettingsController.saveDone=YES}}else{i=DigiWebApp.Settings.createRecord({debug:a,treatAllAsTablet:b,treatAllAsPhone:c,daysToHoldBookingsOnDevice:f,company:e,password:g,connectionCode:k,
settingsPassword:d,workerId:h,timeouthappened:l,skipEvents:m,platform:n,userAgent:o,mapType:p,autoSyncAfterBookTime:q,autoTransferAfterBookTime:s,autoTransferAfterClosingDay:t,autoSaveGPSData:u,GPSDataIsMandatory:v,remarkIsMandatory:r,useTransitionsSetting:w});DigiWebApp.SettingsController.saveSettings(i);DigiWebApp.SettingsController.saveDone=YES}}},cancel:{action:function(){DigiWebApp.SettingsController.saveDone=YES}}}})}},saveSettings:function(a,b,c){if(b){DigiWebApp.ApplicationController.deleteAllData();
DigiWebApp.BookingController.currentBooking=null;$("#"+DigiWebApp.BookingPage.content.currentBookingLabel.id).html("")}if(a.save()){DigiWebApp.SettingsController.mitarbeiterNameVorname="";if(b)DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("hint"),message:M.I18N.l("settingsSaveDoneReloadApp"),callbacks:{confirm:{action:function(){DigiWebApp.SettingsController.showCredentialsAlert=NO;DigiWebApp.ApplicationController.init(true)}}}});else if(c)DigiWebApp.ApplicationController.profilingIntervalVar===
null&&DigiWebApp.ApplicationController.syncRunning!==YES&&DigiWebApp.NavigationController.backToDashboardPage();else DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("hint"),message:M.I18N.l("settingsSaveDone"),callbacks:{confirm:{action:function(){DigiWebApp.NavigationController.backToDashboardPage()}}}})}else DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("error"),message:M.I18N.l("settingsSaveError")})},getSetting:function(a){var b=DigiWebApp.Settings.find()[0];
if(typeof b!=="undefined"){var c=b.get(a);if(typeof c==="undefined")try{c=DigiWebApp.SettingsController.defaultsettings.get(a);b.set(a,c)}catch(d){console.error("ERROR: setting.set for prop="+a)}return c}},setSetting:function(a,b){var c=DigiWebApp.Settings.find()[0];if(typeof c!=="undefined"){try{c.set(a,b)}catch(d){console.error("ERROR: setting.get for prop="+a)}DigiWebApp.SettingsController.saveSettings(c,NO,YES)}},featureAvailable:function(a){if(typeof a!=="string")return false;if(a.length===0)return false;
var b=_.select(DigiWebApp.Features.find(),function(c){if(c)return c.get("id")===a})[0];return typeof b==="undefined"?false:b.get("isAvailable")==="true"},refreshMitarbeiterNameVorname:function(a,b){try{DigiWebApp.Anwesenheitsliste.find({urlParams:{},callbacks:{success:{action:function(d){try{_.each(d,function(e){try{if(e.get("geraeteId")===a)DigiWebApp.SettingsController.mitarbeiterNameVorname=e.get("nameVorname")}catch(g){}});b&&b()}catch(f){}}},error:{action:function(){}}}})}catch(c){}},sendConfiguration:function(){var a=
DigiWebApp.Settings.find(),b="0";try{b=a[0].get("workerId")}catch(c){}DigiWebApp.RequestController.sendConfiguration({settings:a,success:{target:this,action:function(){DigiWebApp.ApplicationController.profilingIntervalVar===null&&DigiWebApp.NavigationController.toBookTimePageTransition();DigiWebApp.SettingsController.mitarbeiterNameVorname!==""&&DigiWebApp.SettingsController.mitarbeiterNameVorname!==null&&DigiWebApp.SettingsController.refreshMitarbeiterNameVorname(b)}},error:{target:this,action:function(){}}})}});
DigiWebApp.AnwesenheitslisteController=M.Controller.extend({items:null,init:function(a){DigiWebApp.AnwesenheitslisteController.items===null?DigiWebApp.RequestController.getDatabaseServer(DigiWebApp.AnwesenheitslisteController.initWithServer,a):DigiWebApp.AnwesenheitslisteController.initWithServer(a)},initWithServer:function(){var a=DigiWebApp.AnwesenheitslisteController;if(a.items===null){DigiWebApp.ApplicationController.DigiLoaderView.show(M.I18N.l("AnwesenheitslisteLaden"));DigiWebApp.Anwesenheitsliste.find({urlParams:{},
callbacks:{success:{action:function(b){DigiWebApp.ApplicationController.DigiLoaderView.hide();b&&b.length===0?DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("error"),message:M.I18N.l("AnwesenheitslisteKonnteNichtGeladenWerden"),callbacks:{confirm:{target:a,action:function(){DigiWebApp.NavigationController.backToDashboardPageFlipTransition()}}}}):DigiWebApp.AnwesenheitslisteController.set("items",b)}},error:{action:function(){DigiWebApp.ApplicationController.DigiLoaderView.hide();
DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("error"),message:M.I18N.l("AnwesenheitslisteKonnteNichtGeladenWerden"),callbacks:{confirm:{target:a,action:function(){DigiWebApp.NavigationController.backToDashboardPageFlipTransition()}}}})}}}})}}});
DigiWebApp.EmployeeController=M.Controller.extend({empSelectionKey:M.LOCAL_STORAGE_PREFIX+M.Application.name+M.LOCAL_STORAGE_SUFFIX+"employeeSelection",empSelectionKeyTmp:M.LOCAL_STORAGE_PREFIX+M.Application.name+M.LOCAL_STORAGE_SUFFIX+"employeeSelectionTmp",employeeState:0,employees:null,init:function(){this.setEmployeesForList()},setEmployeesForList:function(){if(this.getEmployeeState()==1){var a=DigiWebApp.Employee.findSorted();if(a.length>0){a=_.map(a,function(b){if(b)return{label:b.get("name"),
value:b.get("id")}});this.set("employees",a)}}},saveEmployeeSelection:function(){var a=DigiWebApp.Employee.find();_.each(a,function(b){b.set("isSelected",NO);b.save()});a=M.ViewManager.getView("employeePage","employeeSelection").getSelection();if(a.length>0){_.each(a,function(b){var c=_.select(DigiWebApp.Employee.find(),function(d){if(d)return d.get("id")===b});if(c=_.isArray(c)?c[0]:c){c.set("isSelected",YES);c.save()}});DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("employeeSelectionSuccess"),
message:M.I18N.l("employeeSelectionSuccessMsg"),callbacks:{confirm:{target:this,action:"callbackEmployeesSave"}}})}else DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("employeeSelection"),message:M.I18N.l("employeeSelectionMsg")})},callbackEmployeesSave:function(){that=DigiWebApp.EmployeeController;DigiWebApp.BookingController.set("isBackFromEmployeePage",YES);DigiWebApp.NavigationController.backToBookTimePagePOP();localStorage.setItem(DigiWebApp.EmployeeController.empSelectionKey,
that.getSelectedEmployeesAsString());that.setEmployeeState(2);DigiWebApp.BookingController.book()},getSelectedEmployees:function(){var a=DigiWebApp.Employee.find();if(a.length>0)return _.select(a,function(b){if(b)return b.get("isSelected")===true});return[]},getSelectedEmployeesAsString:function(){if(this.getEmployeeState===0)return"0";if(this.getEmployeeState===1)return"";var a=[],b=this.getSelectedEmployees();_.each(b,function(c){a.push(c.get("id"))});return a.join(",")},setEmployeeState:function(a){a==
0&&this.saveUniversalEmployeeToLocalStorage();this.set("employeeState",a);localStorage.setItem(M.LOCAL_STORAGE_PREFIX+M.Application.name+M.LOCAL_STORAGE_SUFFIX+"employeeState",this.employeeState)},saveUniversalEmployeeToLocalStorage:function(){localStorage.setItem(this.empSelectionKey,"0")},getEmployeeState:function(){this.set("employeeState",localStorage.getItem(M.LOCAL_STORAGE_PREFIX+M.Application.name+M.LOCAL_STORAGE_SUFFIX+"employeeState"));return this.employeeState}});
DigiWebApp.HandOrderController=M.Controller.extend({currentHandOrderName:"",save:function(){var a=M.ViewManager.getView("handOrderPage","orderName").value;if(a=$.trim(a)){var b=_.select(DigiWebApp.HandOrder.findSorted(),function(k){if(k)return k.get("name")===a});if(DigiWebApp.ApplicationController.sonderzeichenCheck(a))DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("specialCharProblem"),message:M.I18N.l("specialCharProblemMsg")});else if(b.length>0)DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("handOrderExists"),
message:M.I18N.l("handOrderExistsMsg")});else if(a.length>16)DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("handOrderTooLong"),message:M.I18N.l("handOrderTooLongMsg")});else{b=DigiWebApp.HandOrder.createRecord({name:a,id:a,isLocalOnly:YES});var c=DigiWebApp.ApplicationController.storagePrefix+"_handorderKeys",d=localStorage.getItem(c),f=[];if(typeof d==="string")try{f=JSON.parse(d)}catch(e){}try{f.push(b.m_id)}catch(g){console.error("ERROR in "+this.name+".save: "+g)}localStorage.setItem(c,
JSON.stringify(f));b.save();if(b){M.ViewManager.getView("handOrderPage","orderName").setValue("");DigiWebApp.SelectionController.useSelections=NO;DigiWebApp.SelectionController.showHandOrderFirst=YES;this.currentHandOrderName=a;DigiWebApp.NavigationController.toBookTimePage(YES)}else DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("handOrderSaveError"),message:M.I18N.l("handOrderSaveErrorMsg")})}}else DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("noHandOrderNameEntered"),
message:M.I18N.l("noHandOrderNameEnteredMsg")})}});
DigiWebApp.MediaListController=M.Controller.extend({items:null,actions:null,latestId:null,init:function(){var a=[];a=_.sortBy(DigiWebApp.MediaFile.find(),function(f){return parseInt(f.get("timeStamp"))});this.set("items",a.reverse());if(DigiWebApp.MediaListPage.needsUpdate){a=[];DigiWebApp.SettingsController.featureAvailable("400")&&a.push({label:M.I18N.l("takePicture"),icon:"icon_takePicture.png",id:"camera"});DigiWebApp.SettingsController.featureAvailable("401")&&a.push({label:M.I18N.l("recordAudio"),
icon:"icon_recordAudio.png",id:"audio"});a.push({label:M.I18N.l("uploadMediaFiles"),icon:"icon_dataTransfer.png",id:"uploadMediaFiles"});this.set("actions",a);DigiWebApp.MediaListPage.needsUpdate=false}var b;try{(b=M.ViewManager.getView("mediaListPage","mediafileslist"))&&$("#"+b.id).find("li").each(function(){$(this).removeClass("selected")})}catch(c){}try{(b=M.ViewManager.getView("mediaListPage","actionslist"))&&$("#"+b.id).find("li").each(function(){$(this).removeClass("selected")})}catch(d){}},
itemSelected:function(a,b){this.latestId&&$("#"+this.latestId).removeClass("selected");$("#"+a).addClass("selected");this.latestId=a;b&&typeof this[b]==="function"&&this[b]()},camera:function(){DigiWebApp.NavigationController.toCameraPageTransition()},audio:function(){DigiWebApp.NavigationController.toAudioPageTransition()},uploadMediaFiles:function(){}});
DigiWebApp.ZeitbuchungDetailsPage=M.PageView.design({updateContent:function(){_.each(DigiWebApp.ZeitbuchungDetailsPage.content,function(a){try{a.id!==DigiWebApp.ZeitbuchungDetailsPage.content.infoButton.id&&a.id!==DigiWebApp.ZeitbuchungDetailsPage.content.showBookingCoordinatesInMapButton.id&&a.id!==DigiWebApp.ZeitbuchungDetailsPage.content.showPositionCoordinatesInMapButton.id&&a.renderUpdate()}catch(b){}})},cssClass:"zeitbuchungDetailsPage",childViews:"header content",header:M.ToolbarView.design({childViews:"backButton title",
cssClass:"header unselectable",isFixed:YES,backButton:M.ButtonView.design({value:M.I18N.l("back"),icon:"arrow-l",anchorLocation:M.LEFT,events:{tap:{target:DigiWebApp.NavigationController,action:"backToZeitbuchungenPageTransition"}}}),title:M.LabelView.design({value:M.I18N.l("Zeitbuchung"),anchorLocation:M.CENTER}),anchorLocation:M.TOP}),content:M.ScrollView.design({childViews:"datum von bis spacerNachBis dauer infoButton spacerNachButton order position handApplications activity activityPositionInWorkplan spacerNachActivityPositionInWorkplan remark farbeAmpel gpsBreite gpsLaenge showBookingCoordinatesInMapButton gpsBreitePosition gpsLaengePosition showPositionCoordinatesInMapButton",
cssClass:"content",datum:M.LabelView.design({computedValue:{value:"",operation:function(){if(DigiWebApp.ZeitbuchungenController.itemForDetails!==null)return DigiWebApp.ZeitbuchungenController.itemForDetails.get("datum")+", "}},isInline:YES,cssClass:"datum unselectable"}),von:M.LabelView.design({computedValue:{value:"",operation:function(){return DigiWebApp.ZeitbuchungenController.itemForDetails!==null?DigiWebApp.ZeitbuchungenController.itemForDetails.get("bis")===""||DigiWebApp.ZeitbuchungenController.itemForDetails.get("bis")===
"-"?M.I18N.l("since")+" "+DigiWebApp.ZeitbuchungenController.itemForDetails.get("von"):DigiWebApp.ZeitbuchungenController.itemForDetails.get("von"):""}},isInline:YES,cssClass:"von marginBottom20 unselectable"}),bis:M.LabelView.design({computedValue:{value:"",operation:function(){return DigiWebApp.ZeitbuchungenController.itemForDetails!==null?DigiWebApp.ZeitbuchungenController.itemForDetails.get("bis")!==""&&DigiWebApp.ZeitbuchungenController.itemForDetails.get("bis")!=="-"?" - "+DigiWebApp.ZeitbuchungenController.itemForDetails.get("bis"):
"":""}},isInline:YES,cssClass:"bis marginBottom20 unselectable"}),spacerNachBis:M.LabelView.design({value:" "}),dauer:M.LabelView.design({computedValue:{value:"",operation:function(){return DigiWebApp.ZeitbuchungenController.itemForDetails!==null?DigiWebApp.ZeitbuchungenController.itemForDetails.get("dauer")!==""&&DigiWebApp.ZeitbuchungenController.itemForDetails.get("dauer")!=="-"&&typeof DigiWebApp.ZeitbuchungenController.itemForDetails.get("dauer")!=="undefined"&&DigiWebApp.ZeitbuchungenController.itemForDetails.get("bis")!==
""&&DigiWebApp.ZeitbuchungenController.itemForDetails.get("bis")!=="-"?M.I18N.l("dauer")+": "+DigiWebApp.ZeitbuchungenController.itemForDetails.get("dauer"):"":""}},cssClass:"dauer unselectable"}),order:M.LabelView.design({computedValue:{value:"",operation:function(){return DigiWebApp.ZeitbuchungenController.itemForDetails!==null?DigiWebApp.ZeitbuchungenController.itemForDetails.get("auftragsBezeichnung")!==""&&typeof DigiWebApp.ZeitbuchungenController.itemForDetails.get("auftragsBezeichnung")!==
"undefined"?M.I18N.l("order")+": "+DigiWebApp.ZeitbuchungenController.itemForDetails.get("auftragsBezeichnung"):M.I18N.l("order")+": -":M.I18N.l("order")+": -"}},cssClass:"normalDetail marginLeft35 moveUp38 unselectable"}),position:M.LabelView.design({computedValue:{value:"",operation:function(){return DigiWebApp.ZeitbuchungenController.itemForDetails!==null?DigiWebApp.ZeitbuchungenController.itemForDetails.get("positionsBezeichnung")!==""&&typeof DigiWebApp.ZeitbuchungenController.itemForDetails.get("positionsBezeichnung")!==
"undefined"?M.I18N.l("position")+": "+DigiWebApp.ZeitbuchungenController.itemForDetails.get("positionsBezeichnung"):M.I18N.l("position")+": -":M.I18N.l("position")+": -"}},cssClass:"normalDetail marginLeft35 marginTop0 marginBottom10 unselectable"}),infoButton:M.ButtonView.design({computedValue:{value:"",operation:function(){return"?"}},anchorLocation:M.LEFT,cssClass:"posInfoButton",events:{tap:{target:DigiWebApp.NavigationController,action:"toOrderDetailsPageTransition"}},isInline:YES}),spacerNachButton:M.LabelView.design({value:" ",
isInline:YES}),handApplications:M.LabelView.design({computedValue:{value:"",operation:function(){return DigiWebApp.ZeitbuchungenController.itemForDetails!==null?DigiWebApp.ZeitbuchungenController.itemForDetails.get("handauftragsBezeichnung")!==""&&typeof DigiWebApp.ZeitbuchungenController.itemForDetails.get("handauftragsBezeichnung")!=="undefined"?M.I18N.l("handApplications")+": "+DigiWebApp.ZeitbuchungenController.itemForDetails.get("handauftragsBezeichnung"):"":""}},cssClass:"normalDetail unselectable"}),
activity:M.LabelView.design({computedValue:{value:"",operation:function(){return DigiWebApp.ZeitbuchungenController.itemForDetails!==null?DigiWebApp.ZeitbuchungenController.itemForDetails.get("taetigkeit")!==""&&typeof DigiWebApp.ZeitbuchungenController.itemForDetails.get("taetigkeit")!=="undefined"?M.I18N.l("activity")+": "+DigiWebApp.ZeitbuchungenController.itemForDetails.get("taetigkeit"):"":""}},isInline:YES,cssClass:"normalDetail unselectable"}),activityPositionInWorkplan:M.LabelView.design({computedValue:{value:"",
operation:function(){return DigiWebApp.ZeitbuchungenController.itemForDetails!==null?DigiWebApp.ZeitbuchungenController.itemForDetails.get("taetigkeitreihenfolge")!==""&&typeof DigiWebApp.ZeitbuchungenController.itemForDetails.get("taetigkeitreihenfolge")!=="undefined"?" ("+DigiWebApp.ZeitbuchungenController.itemForDetails.get("taetigkeitreihenfolge")+")":"":""}},isInline:YES,cssClass:"normalDetail unselectable"}),spacerNachActivityPositionInWorkplan:M.LabelView.design({value:" "}),remark:M.LabelView.design({computedValue:{value:"",
operation:function(){return DigiWebApp.ZeitbuchungenController.itemForDetails!==null?DigiWebApp.ZeitbuchungenController.itemForDetails.get("remark")!==""&&typeof DigiWebApp.ZeitbuchungenController.itemForDetails.get("remark")!=="undefined"?M.I18N.l("remark")+": "+DigiWebApp.ZeitbuchungenController.itemForDetails.get("remark"):"":""}},cssClass:"normalDetail unselectable"}),gpsBreite:M.LabelView.design({computedValue:{value:"",operation:function(){if(DigiWebApp.ZeitbuchungenController.itemForDetails!==
null)if(DigiWebApp.ZeitbuchungenController.itemForDetails.get("gpsBreite")!==""&&typeof DigiWebApp.ZeitbuchungenController.itemForDetails.get("gpsBreite")!=="undefined"&&DigiWebApp.ZeitbuchungenController.itemForDetails.get("gpsBreite")!=="0.0"){$("#"+DigiWebApp.ZeitbuchungDetailsPage.content.showBookingCoordinatesInMapButton.id).show();var a=new Number(DigiWebApp.ZeitbuchungenController.itemForDetails.get("gpsBreite"));return M.I18N.l("booking")+"-"+M.I18N.l("latitude")+": "+a.toFixed(6)}else{$("#"+
DigiWebApp.ZeitbuchungDetailsPage.content.showBookingCoordinatesInMapButton.id).hide();return""}else{$("#"+DigiWebApp.ZeitbuchungDetailsPage.content.showBookingCoordinatesInMapButton.id).hide();return""}}},cssClass:"smallDetail marginTop12 unselectable"}),gpsLaenge:M.LabelView.design({computedValue:{value:"",operation:function(){if(DigiWebApp.ZeitbuchungenController.itemForDetails!==null)if(DigiWebApp.ZeitbuchungenController.itemForDetails.get("gpsLaenge")!==""&&typeof DigiWebApp.ZeitbuchungenController.itemForDetails.get("gpsLaenge")!==
"undefined"&&DigiWebApp.ZeitbuchungenController.itemForDetails.get("gpsLaenge")!=="0.0"){$("#"+DigiWebApp.ZeitbuchungDetailsPage.content.showBookingCoordinatesInMapButton.id).show();var a=new Number(DigiWebApp.ZeitbuchungenController.itemForDetails.get("gpsLaenge"));return M.I18N.l("booking")+"-"+M.I18N.l("longitude")+": "+a.toFixed(6)}else{$("#"+DigiWebApp.ZeitbuchungDetailsPage.content.showBookingCoordinatesInMapButton.id).hide();return""}else{$("#"+DigiWebApp.ZeitbuchungDetailsPage.content.showBookingCoordinatesInMapButton.id).hide();
return""}}},cssClass:"smallDetail unselectable"}),gpsBreitePosition:M.LabelView.design({computedValue:{value:"",operation:function(){if(DigiWebApp.ZeitbuchungenController.itemForDetails!==null)if(DigiWebApp.ZeitbuchungenController.itemForDetails.get("gpsBreitePosition")!==""&&typeof DigiWebApp.ZeitbuchungenController.itemForDetails.get("gpsBreitePosition")!=="undefined"&&DigiWebApp.ZeitbuchungenController.itemForDetails.get("gpsBreitePosition")!=="0.0"){$("#"+DigiWebApp.ZeitbuchungDetailsPage.content.showPositionCoordinatesInMapButton.id).show();
var a=new Number(DigiWebApp.ZeitbuchungenController.itemForDetails.get("gpsBreitePosition"));return M.I18N.l("order")+"-"+M.I18N.l("latitude")+": "+a.toFixed(6)}else{$("#"+DigiWebApp.ZeitbuchungDetailsPage.content.showPositionCoordinatesInMapButton.id).hide();return""}else{$("#"+DigiWebApp.ZeitbuchungDetailsPage.content.showPositionCoordinatesInMapButton.id).hide();return""}}},cssClass:"smallDetail marginTop12 unselectable"}),gpsLaengePosition:M.LabelView.design({computedValue:{value:"",operation:function(){if(DigiWebApp.ZeitbuchungenController.itemForDetails!==
null)if(DigiWebApp.ZeitbuchungenController.itemForDetails.get("gpsLaengePosition")!==""&&typeof DigiWebApp.ZeitbuchungenController.itemForDetails.get("gpsLaengePosition")!=="undefined"&&DigiWebApp.ZeitbuchungenController.itemForDetails.get("gpsLaengePosition")!=="0.0"){$("#"+DigiWebApp.ZeitbuchungDetailsPage.content.showPositionCoordinatesInMapButton.id).show();var a=new Number(DigiWebApp.ZeitbuchungenController.itemForDetails.get("gpsLaengePosition"));return M.I18N.l("order")+"-"+M.I18N.l("longitude")+
": "+a.toFixed(6)}else{$("#"+DigiWebApp.ZeitbuchungDetailsPage.content.showPositionCoordinatesInMapButton.id).hide();return""}else{$("#"+DigiWebApp.ZeitbuchungDetailsPage.content.showPositionCoordinatesInMapButton.id).hide();return""}}},cssClass:"smallDetail unselectable"}),farbeAmpel:M.LabelView.design({computedValue:{value:"",operation:function(){if(DigiWebApp.ZeitbuchungenController.itemForDetails!==null)if(DigiWebApp.ZeitbuchungenController.itemForDetails.get("farbeAmpel")!==""&&typeof DigiWebApp.ZeitbuchungenController.itemForDetails.get("farbeAmpel")!==
"undefined"){var a=DigiWebApp.ZeitbuchungenController.itemForDetails.get("farbeAmpel");return M.I18N.l("geozoneTrafficlight")+': <span style="box-shadow: 2px 2px 6px rgba(0,0,0,0.6);background:'+a+";color:"+a+';margin-right: 5px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>'}else return"";else return""}},cssClass:"normalDetail unselectable"}),showBookingCoordinatesInMapButton:M.ButtonView.design({computedValue:{value:"",operation:function(){return M.I18N.l("showBookingCoordinatesInMap")}},events:{tap:{action:function(){var a=
DigiWebApp.ZeitbuchungenController.itemForDetails.get("gpsLaenge"),b=DigiWebApp.ZeitbuchungenController.itemForDetails.get("gpsBreite"),c="";if(!(a==="0.0"&&b==="0.0")){switch(DigiWebApp.SettingsController.getSetting("mapType")){case "OSM":alert(M.I18N.l("showInMapOSMAlert"));c="http://www.openstreetmap.org/index.html?mlat="+b+"&mlon="+a+"&zoom=15&layers=M";break;case "Bing":alert(M.I18N.l("showInMapBingAlert"));c="http://www.bing.com/maps/default.aspx?rtp=adr.~pos."+b+"_"+a+"_&lvl=151";break;case "Google":alert(M.I18N.l("showInMapGoogleAlert"));
c="http://maps.google.com/maps?q="+b+"+"+a+"&hl=de";break;default:c="disabled"}if(c!=="disabled")if(typeof plugins!=="undefined")if(typeof plugins.childBrowser!=="undefined"){try{plugins.childBrowser.close()}catch(d){alert("Error: "+d.message)}try{plugins.childBrowser.showWebPage(encodeURI(c),{showNavigationBar:true})}catch(f){alert("Error: "+f.message)}}else window.open(c,"childBrowser","width=800,height=600,menubar=no,status=no,location=no,copyhistory=no,directories=no");else window.open(c,"childBrowser",
"width=800,height=600,menubar=no,status=no,location=no,copyhistory=no,directories=no")}}}}}),showPositionCoordinatesInMapButton:M.ButtonView.design({computedValue:{value:"",operation:function(){return M.I18N.l("showPositionCoordinatesInMap")}},events:{tap:{action:function(){var a=DigiWebApp.ZeitbuchungenController.itemForDetails.get("gpsLaengePosition"),b=DigiWebApp.ZeitbuchungenController.itemForDetails.get("gpsBreitePosition"),c="";if(!(a==="0.0"&&b==="0.0")){switch(DigiWebApp.SettingsController.getSetting("mapType")){case "OSM":alert(M.I18N.l("showInMapOSMAlert"));
c="http://www.openstreetmap.org/index.html?mlat="+b+"&mlon="+a+"&zoom=15&layers=M";break;case "Bing":alert(M.I18N.l("showInMapBingAlert"));c="http://www.bing.com/maps/default.aspx?rtp=adr.~pos."+b+"_"+a+"_&lvl=151";break;case "Google":alert(M.I18N.l("showInMapGoogleAlert"));c="http://maps.google.com/maps?q="+b+"+"+a+"&hl=de";break;default:c="disabled"}if(c!=="disabled")if(typeof plugins!=="undefined")if(typeof plugins.childBrowser!=="undefined"){try{plugins.childBrowser.close()}catch(d){alert("Error: "+
d.message)}try{plugins.childBrowser.showWebPage(encodeURI(c),{showNavigationBar:true})}catch(f){alert("Error: "+f.message)}}else window.open(c,"childBrowser","width=800,height=600,menubar=no,status=no,location=no,copyhistory=no,directories=no");else window.open(c,"childBrowser","width=800,height=600,menubar=no,status=no,location=no,copyhistory=no,directories=no")}}}}})})});
DigiWebApp.CameraPage=M.PageView.design({events:{pagebeforeshow:{target:DigiWebApp.CameraController,action:"init"}},cssClass:"cameraPage",childViews:"header content",savePicture:function(){var a="";if(M.ViewManager.getView("cameraPage","remarkInput").value!==null&&typeof M.ViewManager.getView("cameraPage","remarkInput").value!=="undefined")a=M.ViewManager.getView("cameraPage","remarkInput").value;if(a.length>255){DigiWebApp.ApplicationController.DigiLoaderView.hide();DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("remarkTooLong"),
message:M.I18N.l("remarkTooLongMessage")})}else if(DigiWebApp.ApplicationController.sonderzeichenCheck(a)){DigiWebApp.ApplicationController.DigiLoaderView.hide();DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("specialCharProblem"),message:M.I18N.l("specialCharProblemMsg")})}else DigiWebApp.CameraController.savePicture()},header:M.ToolbarView.design({childViews:"backButton title",cssClass:"header",isFixed:YES,backButton:M.ButtonView.design({value:M.I18N.l("back"),icon:"arrow-l",
anchorLocation:M.LEFT,events:{tap:{target:DigiWebApp.NavigationController,action:"backToMediaListPageTransition"}}}),title:M.LabelView.design({value:M.I18N.l("takePicture"),anchorLocation:M.CENTER}),anchorLocation:M.TOP}),content:M.ScrollView.design({childViews:"image spacer order position activity remarkInput savePictureGrid",image:M.ImageView.design({value:"",cssClass:"photo"}),spacer:M.LabelView.design({value:" "}),order:M.SelectionListView.design({selectionMode:M.SINGLE_SELECTION_DIALOG,initialText:M.I18N.l("noData"),
label:M.I18N.l("order"),applyTheme:NO,contentBinding:{target:DigiWebApp.CameraController,property:"orders"},events:{change:{target:DigiWebApp.CameraController,action:function(){this.setPositions()}}}}),position:M.SelectionListView.design({selectionMode:M.SINGLE_SELECTION_DIALOG,label:M.I18N.l("position"),initialText:M.I18N.l("noData"),applyTheme:NO,contentBinding:{target:DigiWebApp.CameraController,property:"positions"},events:{change:{target:DigiWebApp.CameraController,action:function(){this.setActivities(YES)}}}}),
activity:M.SelectionListView.design({selectionMode:M.SINGLE_SELECTION_DIALOG,label:M.I18N.l("activity"),initialText:M.I18N.l("noData"),applyTheme:NO,contentBinding:{target:DigiWebApp.CameraController,property:"activities"},events:{change:{target:DigiWebApp.CameraController,action:function(){}}}}),remarkInput:M.TextFieldView.design({label:M.I18N.l("remark"),cssClass:"remarkInput",hasMultipleLines:YES,numberOfChars:255}),savePictureGrid:M.GridView.design({childViews:"button icon",layout:{cssClass:"marginTop40 digiButton",
columns:{0:"button",1:"icon"}},button:M.ButtonView.design({value:M.I18N.l("assume"),cssClass:"digiButton",anchorLocation:M.RIGHT,events:{tap:{action:function(){DigiWebApp.CameraPage.savePicture()}}}}),icon:M.ImageView.design({value:"theme/images/icon_bookTime.png"})})})});
DigiWebApp.TabBar=M.TabBarView.design({childViews:"tabItem1 tabItem2",anchorLocation:M.BOTTOM,isFixed:YES,transition:M.TRANSITION.FADE,name:"tabbar1",tabItem1:M.TabBarItemView.design({value:M.I18N.l("book"),page:"bookingPage",icon:"book"}),tabItem2:M.TabBarItemView.design({value:M.I18N.l("menu"),page:"dashboard",icon:"menu"})});m_require("app/views/TabBar.js");
DigiWebApp.InfoPage=M.PageView.design({lastTimePageWasLoaded:null,events:{pagebeforeshow:{action:function(){DigiWebApp.InfoPage.pagebeforeshowFunction()}},pagehide:{action:function(){DigiWebApp.ApplicationController.clickCounter=0}}},pagebeforeshowFunction:function(){DigiWebApp.ApplicationController.clickCounter=0;M.ViewManager.getView("infoPage","languageSelection").setSelection(M.I18N.getLanguage());DigiWebApp.InfoPage.lastTimePageWasLoaded=+new Date;DigiWebApp.InfoPage.content.cordovaVersionLabel.renderUpdate();
DigiWebApp.InfoPage.content.deviceinfo.renderUpdate();DigiWebApp.InfoPage.content.connectioninfo.renderUpdate();DigiWebApp.InfoPage.content.localStorageUsage.renderUpdate();DigiWebApp.InfoPage.content.mitarbeiterNameVornameLabel.renderUpdate()},cssClass:"infoPage",childViews:"header content",header:M.ToolbarView.design({childViews:"backButton title refreshButton",cssClass:"header unselectable",isFixed:YES,backButton:M.ButtonView.design({value:M.I18N.l("back"),icon:"arrow-l",anchorLocation:M.LEFT,
events:{tap:{target:DigiWebApp.NavigationController,action:"backToDashboardPage"}}}),title:M.LabelView.design({value:M.I18N.l("info"),anchorLocation:M.CENTER}),refreshButton:M.ButtonView.design({value:M.I18N.l("refresh"),icon:"refresh",anchorLocation:M.RIGHT,events:{tap:{action:function(){DigiWebApp.SettingsController.mitarbeiterNameVorname="";var a=DigiWebApp.Settings.find(),b="0";try{b=a[0].get("workerId")}catch(c){}DigiWebApp.SettingsController.refreshMitarbeiterNameVorname(b,DigiWebApp.InfoPage.pagebeforeshowFunction)}}}}),
anchorLocation:M.TOP}),content:M.ScrollView.design({childViews:"logo languageSelection spacer8 companyIdLabel mitarbeiterNameVornameLabel spacer9 versionLabel cordovaVersionLabel companyLabel streetLabel cityLabel emailLabel1 spacer1 emailLabel2 spacer2 spacer3 TMPVersionLabel spacer4 deviceinfo spacer5 connectioninfo spacer6 environmentinfo spacer7 localStorageUsage",logo:M.ImageView.design({value:"theme/images/logo.png",cssClass:"logoInfoPage marginBottom25 unselectable"}),languageSelection:M.SelectionListView.design({selectionMode:M.SINGLE_SELECTION_DIALOG,
label:M.I18N.l("applicationLanguage"),applyTheme:NO,childViews:"languageDeDe languageEnUs",languageDeDe:M.SelectionListItemView.design({value:"de_de",label:M.I18N.l("language_de_de")}),languageEnUs:M.SelectionListItemView.design({value:"en_us",label:M.I18N.l("language_en_us")}),languageFrFr:M.SelectionListItemView.design({value:"fr_fr",label:M.I18N.l("language_fr_fr")}),languageEsEs:M.SelectionListItemView.design({value:"es_es",label:M.I18N.l("language_es_es")}),languageNlNl:M.SelectionListItemView.design({value:"nl_nl",
label:M.I18N.l("language_nl_nl")}),events:{change:{action:function(){var a=M.ViewManager.getView("infoPage","languageSelection").getSelection(YES).value;M.I18N.setLanguage(a)}}}}),companyIdLabel:M.LabelView.design({computedValue:{value:"",operation:function(){var a="";try{a=DigiWebApp.Settings.find()[0].get("company")}catch(b){}return M.I18N.l("company")+": "+a}},cssClass:"infoLabel unselectable"}),mitarbeiterNameVornameLabel:M.LabelView.design({computedValue:{value:"",operation:function(){var a=
"";try{a=DigiWebApp.Settings.find()[0].get("workerId")}catch(b){}a=M.I18N.l("configuredUser")+": "+a;if(typeof DigiWebApp.SettingsController.mitarbeiterNameVorname!=="undefined"&&DigiWebApp.SettingsController.mitarbeiterNameVorname!==null&&DigiWebApp.SettingsController.mitarbeiterNameVorname!=="")a=a+" ("+DigiWebApp.SettingsController.mitarbeiterNameVorname+")";return a}},cssClass:"infoLabel unselectable"}),versionLabel:M.LabelView.design({computedValue:{value:"",operation:function(){return"Version: "+
M.Application.getConfig("version")}},cssClass:"infoLabel unselectable"}),cordovaVersionLabel:M.LabelView.design({computedValue:{value:"",operation:function(){var a="";if(typeof device!=="undefined"){if(typeof device.cordova!=="undefined")a=a+"Cordova: "+device.cordova;if(typeof device.phonegap!=="undefined"){if(a!=="")a+="<br/>";a=a+"PhoneGap: "+device.phonegap}}return a}},cssClass:"infoLabel marginBottom25 unselectable"}),TMPVersionLabel:M.LabelView.design({computedValue:{value:"",operation:function(){return"The-M-Project: "+
M.Version}},cssClass:"infoLabel marginBottom25 unselectable"}),buildLabel:M.LabelView.design({value:"Build: 2845",cssClass:"infoLabel marginBottom25 unselectable"}),companyLabel:M.LabelView.design({value:"DIGI-Zeiterfassung GmbH",cssClass:"infoLabel unselectable"}),streetLabel:M.LabelView.design({value:"Raiffeisenstr. 30",cssClass:"infoLabel unselectable"}),cityLabel:M.LabelView.design({value:"D-70794 Filderstadt",cssClass:"infoLabel marginBottom25 unselectable"}),emailLabel1:M.LabelView.design({value:"eMail: ",
cssClass:"infoLabel unselectable",isInline:YES}),emailLabel2:M.LabelView.design({value:"support@digi-zeiterfassung.de",hyperlinkTarget:'support@digi-zeiterfassung.de" onclick="return DigiWebApp.InfoPage.lastTimePageWasLoaded < (+new Date() - 1000);"',hyperlinkType:M.HYPERLINK_EMAIL,cssClass:"infoLabel unselectable",isInline:YES}),spacer1:M.LabelView.design({value:" "}),spacer2:M.LabelView.design({value:" "}),spacer3:M.LabelView.design({value:"&nbsp;"}),spacer4:M.LabelView.design({value:" "}),spacer5:M.LabelView.design({value:" "}),
spacer6:M.LabelView.design({value:" "}),spacer7:M.LabelView.design({value:" "}),spacer8:M.LabelView.design({value:"<br /><br />",cssClass:"infoLabel unselectable"}),spacer9:M.LabelView.design({value:"<br />",cssClass:"infoLabel unselectable"}),webLabel1:M.LabelView.design({value:"Web: ",cssClass:"infoLabel unselectable",isInline:YES}),webLabel2:M.LabelView.design({value:"www.digi-zeiterfassung.de",hyperlinkTarget:'http://www.digi-zeiterfassung.de" onclick="return DigiWebApp.InfoPage.lastTimePageWasLoaded < (+new Date() - 1000);"',
hyperlinkType:M.HYPERLINK_WEBSITE,cssClass:"infoLabel unselectable",isInline:YES}),localStorageUsage:M.LabelView.design({computedValue:{value:"",operation:function(){var a="",b=(new Number(JSON.stringify(localStorage).length/1048576)).toFixed(2);if(typeof localStorage!=="undefined")a="LocalStorage-Usage: "+b+" MB<br />";return a}},cssClass:"infoLabel marginTop25 unselectable"}),environmentinfo:M.LabelView.design({computedValue:{value:"",operation:function(){var a="";if(typeof M.Environment!=="undefined")a=
"Environment Platform: "+M.Environment.getPlatform()+"<br />";return a}},cssClass:"infoLabel marginTop25 unselectable"}),deviceinfo:M.LabelView.design({computedValue:{value:"",operation:function(){var a="";if(typeof device!=="undefined")a="Device Name: "+device.name+"<br />Device Platform: "+device.platform+"<br />Device UUID: "+device.uuid+"<br />Device Version: "+device.version+"<br />";return a}},cssClass:"infoLabel marginTop25 unselectable"}),connectioninfo:M.LabelView.design({computedValue:{value:"",
operation:function(){if(typeof navigator.network!=="undefined")if(typeof navigator.network.connection!=="undefined"){var a=navigator.network.connection.type,b={};b[Connection.UNKNOWN]="Unknown connection";b[Connection.ETHERNET]="Ethernet connection";b[Connection.WIFI]="WiFi connection";b[Connection.CELL_2G]="Cell 2G connection";b[Connection.CELL_3G]="Cell 3G connection";b[Connection.CELL_4G]="Cell 4G connection";b[Connection.NONE]="No network connection";return"Connection type: "+b[a]}else return"";
else return""}},cssClass:"infoLabel marginBottom25 unselectable"})}),tabBar:DigiWebApp.TabBar});m_require("app/views/TabBar.js");
DigiWebApp.BookingPage=M.PageView.design({childViews:"header content tabBar",events:{pagebeforeshow:{target:DigiWebApp.BookingController,action:"init"},pageshow:{action:function(){DigiWebApp.TabBar.setActiveTab(DigiWebApp.TabBar.tabItem1)}}},cssClass:"bookTimePage",header:M.ToolbarView.design({cssClass:"header unselectable",isFixed:YES,value:M.I18N.l("timeRegistration"),anchorLocation:M.TOP}),content:M.ScrollView.design({childViews:"order position activity grid currentBookingLabel",cssClass:"unselectable",
order:M.SelectionListView.design({selectionMode:M.SINGLE_SELECTION_DIALOG,initialText:M.I18N.l("noData"),label:M.I18N.l("order"),applyTheme:NO,contentBinding:{target:DigiWebApp.SelectionController,property:"orders"},events:{change:{target:DigiWebApp.SelectionController,action:function(){this.setPositions()}}}}),position:M.SelectionListView.design({selectionMode:M.SINGLE_SELECTION_DIALOG,label:M.I18N.l("position"),initialText:M.I18N.l("noData"),applyTheme:NO,contentBinding:{target:DigiWebApp.SelectionController,
property:"positions"},events:{change:{target:DigiWebApp.SelectionController,action:function(){this.setActivities(YES)}}}}),activity:M.SelectionListView.design({selectionMode:M.SINGLE_SELECTION_DIALOG,label:M.I18N.l("activity"),initialText:M.I18N.l("noData"),applyTheme:NO,contentBinding:{target:DigiWebApp.SelectionController,property:"activities"},events:{change:{target:DigiWebApp.SelectionController,action:function(){this.saveSelection()}}}}),grid:M.GridView.design({childViews:"button icon",layout:{cssClass:"marginTop40 digiButton",
columns:{0:"button",1:"icon"}},button:M.ButtonView.design({value:M.I18N.l("book2"),cssClass:"digiButton",anchorLocation:M.RIGHT,events:{tap:{target:DigiWebApp.BookingController,action:"book"}}}),icon:M.ImageView.design({value:"theme/images/icon_bookTime.png"})}),currentBookingLabel:M.LabelView.design({cssClass:"marginTop25 whiteLabel unselectable",computedValue:{contentBinding:{target:DigiWebApp.BookingController,property:"currentBookingStr"},value:"",operation:function(a){return a!==""?M.I18N.l("bookingRunningSince")+
" &nbsp;"+a:""}}})}),tabBar:DigiWebApp.TabBar});m_require("app/views/TabBar.js");
DigiWebApp.HandOrderPage=M.PageView.design({childViews:"header content",cssClass:"handApplicationPage",header:M.ToolbarView.design({childViews:"backButton title",cssClass:"header",isFixed:YES,backButton:M.ButtonView.design({value:M.I18N.l("back"),icon:"arrow-l",anchorLocation:M.LEFT,events:{tap:{target:DigiWebApp.NavigationController,action:"backToDashboardPage"}}}),title:M.LabelView.design({value:M.I18N.l("handApplications"),anchorLocation:M.CENTER}),anchorLocation:M.TOP}),content:M.ScrollView.design({childViews:"orderName grid",
orderName:M.TextFieldView.design({label:M.I18N.l("orderName")}),grid:M.GridView.design({childViews:"button icon",layout:{cssClass:"digiButton hack",columns:{0:"button",1:"icon"}},button:M.ButtonView.design({value:M.I18N.l("assume"),cssClass:"digiButton",anchorLocation:M.RIGHT,events:{tap:{target:DigiWebApp.HandOrderController,action:"save"}}}),icon:M.ImageView.design({value:"theme/images/icon_bookTime.png"})})}),tabBar:DigiWebApp.TabBar});m_require("app/views/TabBar.js");
DigiWebApp.SettingsPage=M.PageView.design({childViews:"header content",events:{pagebeforeshow:{target:DigiWebApp.SettingsController,action:"init"}},cssClass:"settingsPage",header:M.ToolbarView.design({childViews:"backButton title",cssClass:"header unselectable",isFixed:YES,backButton:M.ButtonView.design({value:M.I18N.l("back"),icon:"arrow-l",anchorLocation:M.LEFT,events:{tap:{action:function(){DigiWebApp.SettingsController.showCredentialsAlert||DigiWebApp.NavigationController.backToDashboardPage()}}}}),
title:M.LabelView.design({value:M.I18N.l("settings"),anchorLocation:M.CENTER}),anchorLocation:M.TOP}),content:M.ScrollView.design({childViews:"companyGrid passwordGrid connectionCodeGrid workerIdGrid autoTransferAfterBookTimeCheck autoTransferAfterClosingDayCheck autoSyncAfterBookTimeCheck remarkIsMandatory autoSaveGPSData useTransitionsSetting daysToHoldBookingsOnDeviceSliderContainer grid",daysToHoldBookingsOnDeviceSliderContainer:M.ContainerView.design({childViews:"daysToHoldBookingsOnDeviceSlider",
daysToHoldBookingsOnDeviceSlider:M.SliderView.design({label:M.I18N.l("daysToHoldBookingsOnDeviceLabel"),min:1,max:40,highlightLeftPart:YES,cssClass:"daysToHoldBookingsOnDeviceSlider",contentBinding:{target:DigiWebApp.SettingsController,property:"settings.daysToHoldBookingsOnDevice"}})}),companyGrid:M.GridView.design({childViews:"companyLabel companyInput",layout:M.TWO_COLUMNS,companyLabel:M.LabelView.design({value:M.I18N.l("company")}),companyInput:M.TextFieldView.design({contentBinding:{target:DigiWebApp.SettingsController,
property:"settings.company"}})}),passwordGrid:M.GridView.design({childViews:"passwordLabel passwordInput",layout:M.TWO_COLUMNS,passwordLabel:M.LabelView.design({value:M.I18N.l("password")}),passwordInput:M.TextFieldView.design({inputType:M.INPUT_PASSWORD,contentBinding:{target:DigiWebApp.SettingsController,property:"settings.password"}})}),connectionCodeGrid:M.GridView.design({childViews:"connectionCodeLabel connectionCodeInput",layout:M.TWO_COLUMNS,connectionCodeLabel:M.LabelView.design({value:M.I18N.l("connectionCode")}),
connectionCodeInput:M.TextFieldView.design({inputType:M.INPUT_PASSWORD,contentBinding:{target:DigiWebApp.SettingsController,property:"settings.connectionCode"}})}),workerIdGrid:M.GridView.design({childViews:"workerIdLabel workerIdInput",layout:M.TWO_COLUMNS,workerIdLabel:M.LabelView.design({value:M.I18N.l("workerId")}),workerIdInput:M.TextFieldView.design({contentBinding:{target:DigiWebApp.SettingsController,property:"settings.workerId"}})}),autoSyncAfterBookTimeCheck:M.SelectionListView.design({selectionMode:M.MULTIPLE_SELECTION,
contentBinding:{target:DigiWebApp.SettingsController,property:"settings.autoSyncAfterBookTime"}}),autoTransferAfterBookTimeCheck:M.SelectionListView.design({selectionMode:M.MULTIPLE_SELECTION,contentBinding:{target:DigiWebApp.SettingsController,property:"settings.autoTransferAfterBookTime"}}),autoTransferAfterClosingDayCheck:M.SelectionListView.design({selectionMode:M.MULTIPLE_SELECTION,contentBinding:{target:DigiWebApp.SettingsController,property:"settings.autoTransferAfterClosingDay"}}),remarkIsMandatory:M.SelectionListView.design({selectionMode:M.MULTIPLE_SELECTION,
contentBinding:{target:DigiWebApp.SettingsController,property:"settings.remarkIsMandatory"}}),useTransitionsSetting:M.SelectionListView.design({selectionMode:M.MULTIPLE_SELECTION,contentBinding:{target:DigiWebApp.SettingsController,property:"settings.useTransitionsSetting"}}),autoSaveGPSData:M.SelectionListView.design({selectionMode:M.MULTIPLE_SELECTION,contentBinding:{target:DigiWebApp.SettingsController,property:"settings.autoSaveGPSData"}}),GPSDataIsMandatory:M.SelectionListView.design({selectionMode:M.MULTIPLE_SELECTION,
cssClass:"lastSelectBox",contentBinding:{target:DigiWebApp.SettingsController,property:"settings.GPSDataIsMandatory"}}),grid:M.GridView.design({childViews:"button icon",layout:{cssClass:"digiButton",columns:{0:"button",1:"icon"}},button:M.ButtonView.design({value:M.I18N.l("assume"),cssClass:"digiButton",anchorLocation:M.RIGHT,events:{tap:{target:DigiWebApp.SettingsController,action:"save"}}}),icon:M.ImageView.design({value:"theme/images/icon_bookTime.png"})})}),tabBar:DigiWebApp.TabBar});
DigiWebApp.TimeDataForEditTemplateView=M.ListItemView.design({isSelectable:NO,childViews:"date order position activity latitude longitude",events:{tap:{action:function(){}}},date:M.LabelView.design({cssClass:"date",computedValue:{valuePattern:"<%= date %>",operation:function(a){a=a.split(",");var b=M.Date.create(Number(a[0]));if(a=a[1]!=="0"?M.Date.create(Number(a[1])):null){b=M.Date.create(b.format("mm/dd/yyyy HH:MM"));a=M.Date.create(a.format("mm/dd/yyyy HH:MM"));if(b.format("mm/dd/yyyy HH:MM")===
a.format("mm/dd/yyyy HH:MM"))return b.format("dd.mm.yyyy")+", "+b.format("HH:MM")+" - "+a.format("HH:MM")+" "+M.I18N.l("oclock")+", 00:01 h";else{var c=b.timeBetween(a,M.MINUTES);c=c<1?M.Math.round(c,M.CEIL):M.Math.round(b.timeBetween(a,M.MINUTES),M.FLOOR);if(c>59){var d=M.Math.round(c/60,M.FLOOR);d=d<10?"0"+d:d;c=c%60;c=c<10?"0"+c:c;c=d+":"+c}else c="00:"+(c<10?"0":"")+c;return b.format("dd.mm.yyyy")+", "+b.format("HH:MM")+" - "+a.format("HH:MM")+" "+M.I18N.l("oclock")+", "+c+" h"}}else return b.format("dd.mm.yyyy")+
", "+b.format("HH:MM")+" - "+M.I18N.l("now")+" ("+M.Date.create().format("HH:MM")+")"}}}),order:M.LabelView.design({cssClass:"application",computedValue:{valuePattern:"<%= orderId %>",operation:function(a){var b=_.select(DigiWebApp.Order.findSorted().concat(DigiWebApp.HandOrder.findSorted()),function(c){if(c)return a==c.get("id")||a==c.get("name")});if(b&&b.length>0){b=b[0];return DigiWebApp.SettingsController.globalDebugMode?M.I18N.l("order")+": "+b.get("name")+" ("+b.get("id")+")":M.I18N.l("order")+
": "+b.get("name")}else return M.I18N.l("order")+": "+M.I18N.l("notDefined")}}}),position:M.LabelView.design({cssClass:"position",computedValue:{valuePattern:"<%= positionId %>",operation:function(a){if(a){var b=_.select(DigiWebApp.Position.findSorted(),function(c){if(c)return a==c.get("id")});if(b&&b.length>0){b=b[0];return M.I18N.l("position")+": "+b.get("name")}else return M.I18N.l("position")+": "+M.I18N.l("notDefined")}else return M.I18N.l("position")+": "+M.I18N.l("unknown")}}}),activity:M.LabelView.design({cssClass:"activity",
computedValue:{valuePattern:"<%= activityId %>",operation:function(a){if(a){var b=_.select(DigiWebApp.Activity.findSorted(),function(c){if(c)return a==c.get("id")});if(b&&b.length>0){b=b[0];return M.I18N.l("activity")+": "+b.get("name")}else return M.I18N.l("activity")+": "+M.I18N.l("notDefined")}else return M.I18N.l("activity")+": "+M.I18N.l("unknown")}}}),latitude:M.LabelView.design({cssClass:"location",computedValue:{valuePattern:"<%= latitude %>",operation:function(a){if(a>0){a=new Number(a);
return M.I18N.l("latitude")+": "+a.toFixed(6)}else return""}}}),longitude:M.LabelView.design({cssClass:"location",computedValue:{valuePattern:"<%= longitude %>",operation:function(a){if(a>0){a=new Number(a);return M.I18N.l("longitude")+": "+a.toFixed(6)}else return""}}}),remark:M.LabelView.design({cssClass:"remark",computedValue:{valuePattern:"<%= remark %>",operation:function(a){return a?M.I18N.l("remark")+": "+a:""}}})});m_require("app/views/TimeDataForEditTemplateView");
DigiWebApp.EditTimeDataPage=M.PageView.design({bookingToEdit:null,signaturePadAPI:null,events:{pagebeforeshow:{action:function(){DigiWebApp.BookingController.setTimeDataForEdit();if(DigiWebApp.SettingsController.featureAvailable("405")&&typeof LocalFileSystem!=="undefined"&&typeof window.requestFileSystem!=="undefined"){$("#"+DigiWebApp.EditTimeDataPage.content.signature.id).show();DigiWebApp.EditTimeDataPage.signaturePadAPI=$(".sigPad").signaturePad({bgColour:"#fff",lineTop:110,drawOnly:true})}else $("#"+
DigiWebApp.EditTimeDataPage.content.signature.id).hide();if(typeof DigiWebApp.EditTimeDataPage.bookingToEdit!=="undefined"&&DigiWebApp.EditTimeDataPage.bookingToEdit!==null)if(typeof DigiWebApp.EditTimeDataPage.bookingToEdit.get("remark")!=="undefined"&&DigiWebApp.EditTimeDataPage.bookingToEdit.get("remark")!==null){$("#"+DigiWebApp.EditTimeDataPage.content.remarkInput.id).val(DigiWebApp.EditTimeDataPage.bookingToEdit.get("remark"));M.ViewManager.getView("editTimeDataPage","remarkInput").value=DigiWebApp.EditTimeDataPage.bookingToEdit.get("remark")}else{$("#"+
DigiWebApp.EditTimeDataPage.content.remarkInput.id).val("");M.ViewManager.getView("editTimeDataPage","remarkInput").value=""}else{$("#"+DigiWebApp.EditTimeDataPage.content.remarkInput.id).val("");M.ViewManager.getView("editTimeDataPage","remarkInput").value=""}if(DigiWebApp.SettingsController.featureAvailable("403")){$("[for="+DigiWebApp.EditTimeDataPage.content.remarkInput.id+"]").each(function(){$(this).show()});$("[id="+DigiWebApp.EditTimeDataPage.content.remarkInput.id+"]").each(function(){$(this).show()})}else{$("[for="+
DigiWebApp.EditTimeDataPage.content.remarkInput.id+"]").each(function(){$(this).hide()});$("[id="+DigiWebApp.EditTimeDataPage.content.remarkInput.id+"]").each(function(){$(this).hide()})}DigiWebApp.SettingsController.featureAvailable("405")&&typeof LocalFileSystem!=="undefined"&&typeof window.requestFileSystem!=="undefined"&&DigiWebApp.EditTimeDataPage.bookingToEdit.readFromFile(function(a){a&&a!==""&&DigiWebApp.EditTimeDataPage.signaturePadAPI.regenerate(a)})}}},myCallback:function(){},tab_action_timeoutvar:null,
tab_action:function(){clearTimeout(DigiWebApp.EditTimeDataPage.tab_action_timeoutvar);var a="";if(DigiWebApp.SettingsController.featureAvailable("405")&&typeof LocalFileSystem!=="undefined"&&typeof window.requestFileSystem!=="undefined")a=DigiWebApp.EditTimeDataPage.signaturePadAPI.getSignatureString();if(M.ViewManager.getView("editTimeDataPage","remarkInput").value.length>255){DigiWebApp.ApplicationController.DigiLoaderView.hide();DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("remarkTooLong"),
message:M.I18N.l("remarkTooLongMessage")})}else if(DigiWebApp.SettingsController.getSetting("remarkIsMandatory")&&M.ViewManager.getView("editTimeDataPage","remarkInput").value===""){DigiWebApp.ApplicationController.DigiLoaderView.hide();DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("remarkIsMandatory"),message:M.I18N.l("remarkIsMandatoryMessage")})}else if(DigiWebApp.ApplicationController.sonderzeichenCheck(M.ViewManager.getView("editTimeDataPage","remarkInput").value)){DigiWebApp.ApplicationController.DigiLoaderView.hide();
DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("specialCharProblem"),message:M.I18N.l("specialCharProblemMsg")})}else{DigiWebApp.EditTimeDataPage.bookingToEdit.set("remark",M.ViewManager.getView("editTimeDataPage","remarkInput").value);DigiWebApp.EditTimeDataPage.bookingToEdit.save();if(a!==""){DigiWebApp.EditTimeDataPage.bookingToEdit.set("fileType","text/plain");DigiWebApp.EditTimeDataPage.bookingToEdit.save();DigiWebApp.EditTimeDataPage.bookingToEdit.saveToFile(a,DigiWebApp.EditTimeDataPage.myCallback)}else DigiWebApp.EditTimeDataPage.myCallback()}},
childViews:"header content",cssClass:"remarkPage",header:M.ToolbarView.design({childViews:"backButton title",cssClass:"header",isFixed:YES,backButton:M.ButtonView.design({value:M.I18N.l("back"),icon:"arrow-l",anchorLocation:M.LEFT,events:{tap:{target:DigiWebApp.NavigationController,action:"backToTimeDataPage"}}}),title:M.LabelView.design({value:M.I18N.l("EditTimeDataPageTitle"),anchorLocation:M.CENTER}),anchorLocation:M.TOP}),content:M.ScrollView.design({childViews:"orderbox remarkInput signature saveGrid",
orderbox:M.ListView.design({contentBinding:{target:DigiWebApp.BookingController,property:"timeDataForEdit"},listItemTemplateView:DigiWebApp.TimeDataForEditTemplateView}),remarkInput:M.TextFieldView.design({label:M.I18N.l("remark"),hasMultipleLines:YES,numberOfChars:255}),signature:M.ContainerView.design({childViews:"signatureform",cssClass:"signaturecanvas marginTop20 marginBottom20",signatureform:M.FormView.design({childViews:"signaturecanvas",signaturecanvas:M.CanvasView.design({label:M.I18N.l("signature"),
canvasWidth:290,canvasHeight:120,render:function(){if(this.label)this.html+='<label for="'+this.id+'" class="signaturecanvaslabel">'+this.label+"</label>";this.html+='  <div id="'+this.id+'_container" class="sig sigWrapper">';this.html+='    <canvas id="'+this.id+'_canvas" class="pad" width="'+this.canvasWidth+'px" height="'+this.canvasHeight+'px"></canvas>';this.html+='    <input id="'+this.id+'" type="hidden" name="output" class="output">';this.html+="  </div>";return this.html}}),render:function(){this.html+=
'<form method="post" action="" class="sigPad">';this.renderChildViews();this.html+="</form>";return this.html}})}),saveGrid:M.GridView.design({childViews:"saveButton icon",layout:{cssClass:"digiButton",columns:{0:"saveRemarkButton",1:"icon"}},saveButton:M.ButtonView.design({value:M.I18N.l("assume"),cssClass:"digiButton",anchorLocation:M.RIGHT,events:{tap:{action:function(){DigiWebApp.ApplicationController.DigiLoaderView.show(M.I18N.l("Save"));DigiWebApp.EditTimeDataPage.tab_action_timeoutvar=setTimeout("DigiWebApp.EditTimeDataPage.tab_action();",
50)}}}}),icon:M.ImageView.design({value:"theme/images/icon_bookTime.png"})})})});m_require("app/views/TimeDataForEditTemplateView");
DigiWebApp.RemarkPage=M.PageView.design({events:{pagebeforeshow:{action:function(){DigiWebApp.BookingController.setTimeDataForRemark();if(typeof DigiWebApp.BookingController.currentBooking!=="undefined"&&DigiWebApp.BookingController.currentBooking!==null)if(typeof DigiWebApp.BookingController.currentBooking.get("remark")!=="undefined"&&DigiWebApp.BookingController.currentBooking.get("remark")!==null){$("#"+DigiWebApp.RemarkPage.content.remarkInput.id).val(DigiWebApp.BookingController.currentBooking.get("remark"));
M.ViewManager.getView("remarkPage","remarkInput").value=DigiWebApp.BookingController.currentBooking.get("remark")}else{$("#"+DigiWebApp.RemarkPage.content.remarkInput.id).val("");M.ViewManager.getView("remarkPage","remarkInput").value=""}else{$("#"+DigiWebApp.RemarkPage.content.remarkInput.id).val("");M.ViewManager.getView("remarkPage","remarkInput").value=""}}}},myCallback:function(){},tab_action_timeoutvar:null,tab_action:function(){clearTimeout(DigiWebApp.RemarkPage.tab_action_timeoutvar);if(M.ViewManager.getView("remarkPage",
"remarkInput").value.length>255){DigiWebApp.ApplicationController.DigiLoaderView.hide();DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("remarkTooLong"),message:M.I18N.l("remarkTooLongMessage")})}else if(DigiWebApp.SettingsController.getSetting("remarkIsMandatory")&&M.ViewManager.getView("remarkPage","remarkInput").value===""){DigiWebApp.ApplicationController.DigiLoaderView.hide();DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("remarkIsMandatory"),message:M.I18N.l("remarkIsMandatoryMessage")})}else if(DigiWebApp.ApplicationController.sonderzeichenCheck(M.ViewManager.getView("remarkPage",
"remarkInput").value)){DigiWebApp.ApplicationController.DigiLoaderView.hide();DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("specialCharProblem"),message:M.I18N.l("specialCharProblemMsg")})}else{DigiWebApp.BookingController.currentBooking.set("remark",M.ViewManager.getView("remarkPage","remarkInput").value);DigiWebApp.BookingController.currentBooking.save();DigiWebApp.RemarkPage.myCallback()}},childViews:"header content",cssClass:"remarkPage",header:M.ToolbarView.design({childViews:"backButton title",
cssClass:"header",isFixed:YES,backButton:M.ButtonView.design({value:M.I18N.l("back"),icon:"arrow-l",anchorLocation:M.LEFT,events:{tap:{target:DigiWebApp.NavigationController,action:"backToBookTimePagePOP"}}}),title:M.LabelView.design({value:M.I18N.l("remark"),anchorLocation:M.CENTER}),anchorLocation:M.TOP}),content:M.ScrollView.design({childViews:"orderbox remarkInput grid",orderbox:M.ListView.design({contentBinding:{target:DigiWebApp.BookingController,property:"timeDataForEdit"},listItemTemplateView:DigiWebApp.TimeDataForEditTemplateView}),
remarkInput:M.TextFieldView.design({label:M.I18N.l("remark"),cssClass:"remarkInput",hasMultipleLines:YES,numberOfChars:255}),grid:M.GridView.design({childViews:"button icon",layout:{cssClass:"digiButton",columns:{0:"button",1:"icon"}},button:M.ButtonView.design({value:M.I18N.l("closeBooking"),cssClass:"digiButton",anchorLocation:M.RIGHT,events:{tap:{action:function(){DigiWebApp.ApplicationController.DigiLoaderView.show(M.I18N.l("Save"));DigiWebApp.RemarkPage.tab_action_timeoutvar=setTimeout("DigiWebApp.RemarkPage.tab_action();",
50)}}}}),icon:M.ImageView.design({value:"theme/images/icon_bookTime.png"})})})});
DigiWebApp.DemoAudioPage=M.PageView.design({events:{pagebeforeshow:{target:DigiWebApp.DemoAudioController,action:"init"}},childViews:"header content",cssClass:"demoAudioPage",header:M.ToolbarView.design({childViews:"backButton title",cssClass:"header",isFixed:YES,backButton:M.ButtonView.design({value:M.I18N.l("back"),icon:"arrow-l",anchorLocation:M.LEFT,events:{tap:{target:DigiWebApp.NavigationController,action:"backToDemoMediaPage"}}}),title:M.LabelView.design({value:M.I18N.l("settings"),anchorLocation:M.CENTER}),
anchorLocation:M.TOP}),content:M.ScrollView.design({childViews:"audioIcon grid",audioIcon:M.ImageView.design({value:"theme/images/icon_record.png",cssClass:"audioIcon",events:{tap:{target:DigiWebApp.DemoAudioController,action:"recordAudio"}}}),recordIcon:M.ImageView.design({value:"theme/images/icon_record.png",cssClass:"mediaIcon",events:{tap:{action:DigiWebApp.DemoAudioController.recordAudio}}}),recordIcon:M.ImageView.design({value:"theme/images/icon_record.png",cssClass:"mediaIcon",events:{tap:{action:DigiWebApp.DemoAudioController.recordAudio}}}),
stopRecordIcon:M.ImageView.design({value:"theme/images/icon_stop.png",cssClass:"mediaIcon",events:{tap:{action:DigiWebApp.DemoAudioController.stopRecord}}}),playIcon:M.ImageView.design({value:"theme/images/icon_playbackAudio.png",cssClass:"mediaIcon",events:{tap:{action:DigiWebApp.DemoAudioController.playbackAudio}}}),stopIcon:M.ImageView.design({value:"theme/images/icon_stop.png",cssClass:"mediaIcon",events:{tap:{action:DigiWebApp.DemoAudioController.stopPlayback}}}),grid:M.GridView.design({childViews:"button icon",
layout:{cssClass:"marginTop40 digiButton",columns:{0:"button",1:"icon"}},button:M.ButtonView.design({value:M.I18N.l("recordAudio"),cssClass:"digiButton",anchorLocation:M.RIGHT,events:{tap:{target:DigiWebApp.DemoAudioController,action:"recordAudio"}}}),icon:M.ImageView.design({value:"theme/images/icon_bookTime.png"})})})});
DigiWebApp.SplashViewPage=M.PageView.design({events:{pagebeforeshow:{action:function(){if(!(window.newAppVersionAvailable||DigiWebApp.ApplicationController.useSplashJustForFade))if(navigator.platform==="BlackBerry"&&restartOnBlackBerry)DigiWebApp.ApplicationController.blackBerryRestart_var=setTimeout("DigiWebApp.ApplicationController.blackBerryRestart()",3E3);else DigiWebApp.ApplicationController.regSecEv(YES)}},pageshow:{action:function(){window.newAppVersionAvailable||DigiWebApp.ApplicationController.useSplashJustForFade||
DigiWebApp.ApplicationController.DigiLoaderView.show(M.I18N.l("waitingForDevice"))}}},childViews:"content",cssClass:"splashViewPage",logo:M.ImageView.design({value:"theme/images/logo.png",cssClass:"logoSplashPage"}),content:M.ScrollView.design({cssClass:"infoBox",childViews:"title info",title:M.LabelView.design({value:"",cssClass:"appTitle"}),info:M.LabelView.design({value:"",cssClass:"infoMsg",contentBinding:{target:DigiWebApp.ApplicationController,property:"infoMsg"}})})});
DigiWebApp.AnwesenheitslisteTemplateView=M.ListItemView.design({isSelectable:YES,childViews:"farbeAnwesenheit nameVorname spacer1 datumLabel datum uhrzeit spacer2 fehlzeitBezeichnung auftragsBezeichnung positionsBezeichnung handauftragsBezeichnung taetigkeit gpsBreite gpsLaenge spacer3 gpsBreitePosition gpsLaengePosition",events:{tap:{action:function(a){var b=NO,c=M.ViewManager.getViewById(a).modelId;_.each(DigiWebApp.AnwesenheitslisteController.items,function(d){if(d.m_id===c)if(d.get("datum")!==
"-"){DigiWebApp.ZeitbuchungenController.set("datum",d.get("datum"));DigiWebApp.ZeitbuchungenController.set("mitarbeiterID",d.get("mitarbeiterId"));DigiWebApp.ZeitbuchungenController.set("mitarbeiterNameVorname",d.get("nameVorname"));b=YES}});b===YES&&DigiWebApp.NavigationController.toZeitbuchungenPageTransition()}}},spacer1:M.LabelView.design({cssClass:"unselectable marginBottom12",value:" "}),spacer2:M.LabelView.design({cssClass:"unselectable marginBottom12",value:" "}),spacer3:M.LabelView.design({cssClass:"unselectable",
value:" "}),datumLabel:M.LabelView.design({cssClass:"normal unselectable",isInline:YES,computedValue:{valuePattern:"<%= datumLabel %>",operation:function(a){return a}}}),datum:M.LabelView.design({cssClass:"normal unselectable",isInline:YES,computedValue:{valuePattern:"<%= datum %>",operation:function(a){return a!=="-"?a:""}}}),farbeAmpel:M.LabelView.design({cssClass:"unselectable",computedValue:{valuePattern:"<%= farbeAmpel %>",operation:function(a){return a}}}),farbeAnwesenheit:M.LabelView.design({cssClass:"unselectable",
isInline:YES,computedValue:{valuePattern:"<%= farbeAnwesenheit %>",operation:function(a){return'<span style="box-shadow: 2px 2px 6px rgba(0,0,0,0.6);background:'+a+";color:"+a+';margin-right: 5px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>&nbsp;&nbsp;'}}}),fehlzeitBezeichnung:M.LabelView.design({cssClass:"normal unselectable",computedValue:{valuePattern:"<%= fehlzeitBezeichnung %>",operation:function(a){return a!==""&&typeof a!=="undefined"&&a!=="undefined"&&a!=="-"?M.I18N.l("fehlzeit")+": "+a:""}}}),
gpsBreite:M.LabelView.design({cssClass:"normal unselectable",isInline:YES,computedValue:{valuePattern:"<%= gpsBreite %>",operation:function(a){if(a!="0.0"){a=new Number(a);return M.I18N.l("buchungskoordinaten")+": "+a.toFixed(4)}else return""}}}),gpsBreitePosition:M.LabelView.design({cssClass:"normal unselectable",isInline:YES,computedValue:{valuePattern:"<%= gpsBreitePosition %>",operation:function(a){if(a!="0.0"){a=new Number(a);return M.I18N.l("auftragskoordinaten")+": "+a.toFixed(4)}else return""}}}),
gpsLaenge:M.LabelView.design({cssClass:"normal unselectable",isInline:YES,computedValue:{valuePattern:"<%= gpsLaenge %>",operation:function(a){return a!="0.0"?", "+(new Number(a)).toFixed(4):""}}}),gpsLaengePosition:M.LabelView.design({cssClass:"normal unselectable",isInline:YES,computedValue:{valuePattern:"<%= gpsLaengePosition %>",operation:function(a){return a!="0.0"?", "+(new Number(a)).toFixed(4):""}}}),handauftragsBezeichnung:M.LabelView.design({cssClass:"normal unselectable",computedValue:{valuePattern:"<%= handauftragsBezeichnung %>",
operation:function(a){return a!==""&&typeof a!=="undefined"&&a!=="undefined"&&a!=="-"?M.I18N.l("handApplications")+": "+a:""}}}),handauftragsId:M.LabelView.design({cssClass:"unselectable",computedValue:{valuePattern:"<%= handauftragsId %>",operation:function(a){return a}}}),mitarbeiterId:M.LabelView.design({cssClass:"unselectable",computedValue:{valuePattern:"<%= mitarbeiterId %>",operation:function(a){return a}}}),name:M.LabelView.design({cssClass:"bold unselectable",computedValue:{valuePattern:"<%= name %>",
operation:function(a){return a}}}),nameVorname:M.LabelView.design({cssClass:"bold unselectable",isInline:YES,computedValue:{valuePattern:"<%= nameVorname %>",operation:function(a){return a}}}),auftragsBezeichnung:M.LabelView.design({cssClass:"normal unselectable",computedValue:{valuePattern:"<%= auftragsBezeichnung %>",operation:function(a){return a!==""&&typeof a!=="undefined"&&a!=="undefined"&&a!=="-"?M.I18N.l("order")+": "+a:""}}}),positionsBezeichnung:M.LabelView.design({cssClass:"normal unselectable",
computedValue:{valuePattern:"<%= positionsBezeichnung %>",operation:function(a){return a!==""&&typeof a!=="undefined"&&a!=="undefined"&&a!=="-"?M.I18N.l("position")+": "+a:""}}}),positionsId:M.LabelView.design({cssClass:"unselectable",computedValue:{valuePattern:"<%= positionsId %>",operation:function(a){return a}}}),taetigkeit:M.LabelView.design({cssClass:"normal unselectable",computedValue:{valuePattern:"<%= taetigkeit %>",operation:function(a){return a!==""&&typeof a!=="undefined"&&a!=="undefined"&&
a!=="-"?M.I18N.l("activity")+": "+a:""}}}),taetigkeitsId:M.LabelView.design({cssClass:"unselectable",computedValue:{valuePattern:"<%= taetigkeitsId %>",operation:function(a){return a}}}),taetigkeitsart:M.LabelView.design({cssClass:"unselectable",computedValue:{valuePattern:"<%= taetigkeitsart %>",operation:function(a){return a}}}),uhrzeit:M.LabelView.design({cssClass:"normal unselectable",isInline:YES,computedValue:{valuePattern:"<%= uhrzeit %>",operation:function(a){return a!==""&&typeof a!=="undefined"&&
a!=="undefined"&&a!=="-"?" "+a:""}}}),vorname:M.LabelView.design({cssClass:"bold unselectable",computedValue:{valuePattern:"<%= vorname %>",operation:function(a){return a}}})});m_require("app/views/AnwesenheitslisteTemplateView");
DigiWebApp.AnwesenheitslistePage=M.PageView.design({events:{pagebeforeshow:{target:DigiWebApp.AnwesenheitslisteController,action:"init"}},childViews:"header content",cssClass:"anwesenheitslistePage unselectable",header:M.ToolbarView.design({childViews:"backButton title refreshButton",cssClass:"header unselectable",isFixed:YES,backButton:M.ButtonView.design({value:M.I18N.l("back"),icon:"arrow-l",anchorLocation:M.LEFT,events:{tap:{target:DigiWebApp.NavigationController,action:"backToDashboardPage"}}}),
title:M.LabelView.design({value:M.I18N.l("Anwesenheitsliste"),anchorLocation:M.CENTER}),refreshButton:M.ButtonView.design({value:M.I18N.l("refresh"),icon:"refresh",anchorLocation:M.RIGHT,events:{tap:{action:function(){DigiWebApp.AnwesenheitslisteController.set("items",{});DigiWebApp.AnwesenheitslisteController.items=null;DigiWebApp.AnwesenheitslisteController.init()}}}}),anchorLocation:M.TOP}),content:M.ScrollView.design({childViews:"list",list:M.ListView.design({contentBinding:{target:DigiWebApp.AnwesenheitslisteController,
property:"items"},listItemTemplateView:DigiWebApp.AnwesenheitslisteTemplateView})})});
DigiWebApp.TimeDataSentTemplateView=M.ListItemView.design({isSelectable:NO,childViews:"date order position activity latitude longitude remark",events:{tap:{action:function(){}}},date:M.LabelView.design({cssClass:"date unselectable",computedValue:{valuePattern:"<%= date %>",operation:function(a){a=a.split(",");var b=M.Date.create(Number(a[0]));if(a=a[1]!=="0"?M.Date.create(Number(a[1])):null){b=M.Date.create(b.format("mm/dd/yyyy HH:MM"));a=M.Date.create(a.format("mm/dd/yyyy HH:MM"));if(b.format("mm/dd/yyyy HH:MM")===
a.format("mm/dd/yyyy HH:MM"))return b.format("dd.mm.yyyy")+", "+b.format("HH:MM")+" - "+a.format("HH:MM")+" "+M.I18N.l("oclock")+", 00:01 h";else{var c=b.timeBetween(a,M.MINUTES);c=c<1?M.Math.round(c,M.CEIL):M.Math.round(b.timeBetween(a,M.MINUTES),M.FLOOR);if(c>59){var d=M.Math.round(c/60,M.FLOOR);d=d<10?"0"+d:d;c=c%60;c=c<10?"0"+c:c;c=d+":"+c}else c="00:"+(c<10?"0":"")+c;return b.format("dd.mm.yyyy")+", "+b.format("HH:MM")+" - "+a.format("HH:MM")+" "+M.I18N.l("oclock")+", "+c+" h"}}else return b.format("dd.mm.yyyy")+
", "+b.format("HH:MM")+" - "+M.I18N.l("open")}}}),order:M.LabelView.design({cssClass:"application unselectable",computedValue:{valuePattern:"<%= orderName %>",operation:function(a){return a!==""?M.I18N.l("order")+": "+a:M.I18N.l("order")+": "+M.I18N.l("notDefined")}}}),position:M.LabelView.design({cssClass:"position unselectable",computedValue:{valuePattern:"<%= positionName %>",operation:function(a){return a!==""?M.I18N.l("position")+": "+a:M.I18N.l("position")+": "+M.I18N.l("notDefined")}}}),activity:M.LabelView.design({cssClass:"activity unselectable",
computedValue:{valuePattern:"<%= activityName %>",operation:function(a){return a!==""?M.I18N.l("activity")+": "+a:M.I18N.l("activity")+": "+M.I18N.l("notDefined")}}}),latitude:M.LabelView.design({cssClass:"location unselectable",computedValue:{valuePattern:"<%= latitude %>",operation:function(a){if(a>0){a=new Number(a);return M.I18N.l("latitude")+": "+a.toFixed(6)}else return""}}}),longitude:M.LabelView.design({cssClass:"location unselectable",computedValue:{valuePattern:"<%= longitude %>",operation:function(a){if(a>
0){a=new Number(a);return M.I18N.l("longitude")+": "+a.toFixed(6)}else return""}}}),remark:M.LabelView.design({cssClass:"remark unselectable",computedValue:{valuePattern:"<%= remark %>",operation:function(a){return a?M.I18N.l("remark")+": "+a:""}}})});m_require("app/views/TimeDataSentTemplateView");
DigiWebApp.TimeDataArchivePage=M.PageView.design({events:{pagebeforeshow:{target:DigiWebApp.BookingController,action:"setArchivedBookings"}},childViews:"header contentSent",cssClass:"timeDataPage unselectable",header:M.ToolbarView.design({childViews:"backButton title",cssClass:"header unselectable",isFixed:YES,backButton:M.ButtonView.design({value:M.I18N.l("back"),icon:"arrow-l",anchorLocation:M.LEFT,events:{tap:{target:DigiWebApp.NavigationController,action:"backToTimeDataPage"}}}),title:M.LabelView.design({value:M.I18N.l("archivedTimeData"),
anchorLocation:M.CENTER}),anchorLocation:M.TOP}),contentSent:M.ScrollView.design({childViews:"list",cssClass:"sentBookings",list:M.ListView.design({contentBinding:{target:DigiWebApp.BookingController,property:"timeDataSentArchived"},listItemTemplateView:DigiWebApp.TimeDataSentTemplateView})})});
DigiWebApp.TimeDataSentDaysTemplateView=M.ListItemView.design({isSelectable:YES,childViews:"tagLabel",events:{tap:{action:function(a,b){_.each(DigiWebApp.SentTimeDataDays.find(),function(c){if(c.m_id===b)DigiWebApp.BookingController.dayToDisplay=c});DigiWebApp.NavigationController.toTimeDataArchivePageTransition()}}},tagLabel:M.LabelView.design({cssClass:"tagLabel unselectable",computedValue:{valuePattern:"<%= tagLabel %>",operation:function(a){return M.I18N.l("archivedTimeDataOf")+" "+a}}})});
DigiWebApp.EditPicturePage=M.PageView.design({childViews:"header content",cssClass:"editPicturePage",events:{pagebeforeshow:{target:DigiWebApp.EditPicturePageController,action:"init"}},savePicture:function(){var a="";if(M.ViewManager.getView("editPicturePage","remarkInput").value!==null&&typeof M.ViewManager.getView("editPicturePage","remarkInput").value!=="undefined")a=M.ViewManager.getView("editPicturePage","remarkInput").value;if(a.length>255){DigiWebApp.ApplicationController.DigiLoaderView.hide();
DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("remarkTooLong"),message:M.I18N.l("remarkTooLongMessage")})}else if(DigiWebApp.ApplicationController.sonderzeichenCheck(a)){DigiWebApp.ApplicationController.DigiLoaderView.hide();DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("specialCharProblem"),message:M.I18N.l("specialCharProblemMsg")})}else DigiWebApp.EditPicturePageController.savePicture()},header:M.ToolbarView.design({childViews:"backButton title deleteButton",
cssClass:"header",isFixed:YES,backButton:M.ButtonView.design({value:M.I18N.l("back"),icon:"arrow-l",anchorLocation:M.LEFT,events:{tap:{target:DigiWebApp.NavigationController,action:"backToMediaListPageTransition"}}}),deleteButton:M.ButtonView.design({value:M.I18N.l("deleteLabel"),icon:"delete",anchorLocation:M.RIGHT,events:{tap:{action:function(){DigiWebApp.ApplicationController.DigiLoaderView.show(M.I18N.l("deleteMediaFile"));DigiWebApp.EditPicturePageController.myMediaFile.deleteFile(DigiWebApp.EditPicturePageController.deleteMediaFileFromLocalStorage,
function(){DigiWebApp.EditPicturePageController.deleteMediaFileFromLocalStorage()})}}}}),title:M.LabelView.design({value:M.I18N.l("editPicture"),anchorLocation:M.CENTER}),anchorLocation:M.TOP}),content:M.ScrollView.design({childViews:"image spacer order position activity remarkInput savePictureGrid",image:M.ImageView.design({value:"",cssClass:"photo"}),spacer:M.LabelView.design({value:" "}),order:M.SelectionListView.design({selectionMode:M.SINGLE_SELECTION_DIALOG,initialText:M.I18N.l("noData"),label:M.I18N.l("order"),
applyTheme:NO,contentBinding:{target:DigiWebApp.EditPicturePageController,property:"orders"},events:{change:{target:DigiWebApp.EditPicturePageController,action:function(){this.setPositions()}}}}),position:M.SelectionListView.design({selectionMode:M.SINGLE_SELECTION_DIALOG,label:M.I18N.l("position"),initialText:M.I18N.l("noData"),applyTheme:NO,contentBinding:{target:DigiWebApp.EditPicturePageController,property:"positions"},events:{change:{target:DigiWebApp.EditPicturePageController,action:function(){this.setActivities(YES)}}}}),
activity:M.SelectionListView.design({selectionMode:M.SINGLE_SELECTION_DIALOG,label:M.I18N.l("activity"),initialText:M.I18N.l("noData"),applyTheme:NO,contentBinding:{target:DigiWebApp.EditPicturePageController,property:"activities"},events:{change:{target:DigiWebApp.EditPicturePageController,action:function(){}}}}),remarkInput:M.TextFieldView.design({label:M.I18N.l("remark"),cssClass:"remarkInput",hasMultipleLines:YES,numberOfChars:255}),savePictureGrid:M.GridView.design({childViews:"button icon",
layout:{cssClass:"marginTop40 digiButton",columns:{0:"button",1:"icon"}},button:M.ButtonView.design({value:M.I18N.l("assume"),cssClass:"digiButton",anchorLocation:M.RIGHT,events:{tap:{action:function(){DigiWebApp.ApplicationController.DigiLoaderView.show(M.I18N.l("saveMediaFile"));DigiWebApp.EditPicturePage.savePicture()}}}}),icon:M.ImageView.design({value:"theme/images/icon_bookTime.png"})})})});
DigiWebApp.VorZurueckTabBar=M.TabBarView.design({childViews:"tabItemZurueck tabItemDayToShow tabItemVor",anchorLocation:M.BOTTOM,isFixed:YES,transition:M.TRANSITION.FADE,name:"vorzuruecktabbar",tabItemZurueck:M.TabBarItemView.design({value:M.I18N.l("backward"),page:"zeitbuchungenPage",icon:"arrow-l",switchPage:function(){DigiWebApp.VorZurueckTabBar.backwardHandler()}}),tabItemDayToShow:M.TabBarItemView.design({value:"",page:"zeitbuchungenPage",icon:""}),tabItemVor:M.TabBarItemView.design({value:M.I18N.l("forward"),
page:"zeitbuchungenPage",icon:"arrow-r",switchPage:function(){DigiWebApp.VorZurueckTabBar.forwardHandler()}}),backwardHandler:function(){DigiWebApp.ZeitbuchungenController.set("items",null);DigiWebApp.ZeitbuchungenController.items=null;DigiWebApp.ZeitbuchungenController.set("datum",D8.create(DigiWebApp.ZeitbuchungenController.datum).addDays(-1).format("dd.mm.yyyy"));DigiWebApp.ZeitbuchungenController.init(YES)},forwardHandler:function(){DigiWebApp.ZeitbuchungenController.set("items",null);DigiWebApp.ZeitbuchungenController.items=
null;DigiWebApp.ZeitbuchungenController.set("datum",D8.create(DigiWebApp.ZeitbuchungenController.datum).addHours(25).format("dd.mm.yyyy"));DigiWebApp.ZeitbuchungenController.init(YES)}});
DigiWebApp.DashboardTemplateView=M.ListItemView.design({isSelectable:NO,childViews:"icon label",events:{tap:{target:DigiWebApp.DashboardController,action:"itemSelected"}},icon:M.ImageView.design({cssClass:"unselectable",computedValue:{valuePattern:"<%= icon %>",operation:function(a){return"theme/images/"+a}}}),label:M.LabelView.design({cssClass:"unselectable",valuePattern:"<%= label %>"})});m_require("app/views/TabBar.js");m_require("app/views/DashboardTemplateView.js");
DigiWebApp.DashboardPage=M.PageView.design({childViews:"header content tabBar",cssClass:"dashboardPage unselectable",events:{pagebeforeshow:{target:DigiWebApp.DashboardController,action:"init"},pageshow:{action:function(){DigiWebApp.TabBar.setActiveTab(DigiWebApp.TabBar.tabItem2)}}},needsUpdate:true,header:M.ToolbarView.design({value:M.I18N.l("menu"),cssClass:"header unselectable",isFixed:YES,anchorLocation:M.TOP}),content:M.ScrollView.design({childViews:"list",list:M.ListView.design({contentBinding:{target:DigiWebApp.DashboardController,
property:"items"},listItemTemplateView:DigiWebApp.DashboardTemplateView})}),tabBar:DigiWebApp.TabBar});
DigiWebApp.ZeitbuchungenTemplateView=M.ListItemView.design({isSelectable:YES,childViews:"datum von bis dauer spacer2 auftragsBezeichnung positionsBezeichnung handauftragsBezeichnung taetigkeit gpsBreite gpsLaenge gpsBreitePosition gpsLaengePosition",events:{tap:{action:function(a){var b=NO,c=M.ViewManager.getViewById(a).modelId;_.each(DigiWebApp.ZeitbuchungenController.items,function(d){if(d.m_id===c){b=YES;DigiWebApp.ZeitbuchungenController.set("itemForDetails",d);DigiWebApp.ZeitbuchungDetailsPage.updateContent()}});
b===YES&&DigiWebApp.NavigationController.toZeitbuchungDetailsPageTransition()}}},spacer1:M.LabelView.design({value:" "}),spacer2:M.LabelView.design({value:" "}),auftragsBezeichnung:M.LabelView.design({cssClass:"normal unselectable",computedValue:{valuePattern:"<%= auftragsBezeichnung %>",operation:function(a){return a!==""&&typeof a!=="undefined"&&a!=="undefined"?M.I18N.l("order")+": "+a:""}}}),auftragsId:M.LabelView.design({cssClass:"normal unselectable",computedValue:{valuePattern:"<%= auftragsId %>",
operation:function(a){return a}}}),bis:M.LabelView.design({cssClass:"bold unselectable",isInline:YES,computedValue:{valuePattern:"<%= bis %>",operation:function(a){return a!=="-"?a:M.I18N.l("now")}}}),datum:M.LabelView.design({cssClass:"bold unselectable",isInline:YES,computedValue:{valuePattern:"<%= datum %>",operation:function(a){return a!=="-"?a:""}}}),dauer:M.LabelView.design({cssClass:"normal unselectable",isInline:YES,computedValue:{valuePattern:"<%= dauer %>",operation:function(a){return a!==
"00:00"&&a!=="-"?" ("+a+")":""}}}),farbeAmpel:M.LabelView.design({cssClass:"normal unselectable",computedValue:{valuePattern:"<%= farbeAmpel %>",operation:function(a){return a}}}),gpsBreite:M.LabelView.design({cssClass:"normal unselectable",computedValue:{valuePattern:"<%= gpsBreite %>",operation:function(a){if(a!="0.0"){a=new Number(a);return M.I18N.l("latitude")+": "+a.toFixed(6)}else return""}}}),gpsBreitePosition:M.LabelView.design({cssClass:"normal unselectable",computedValue:{valuePattern:"<%= gpsBreitePosition %>",
operation:function(a){if(a!="0.0"){a=new Number(a);return M.I18N.l("position")+"-"+M.I18N.l("latitude")+": "+a.toFixed(6)}else return""}}}),gpsLaenge:M.LabelView.design({cssClass:"normal unselectable",computedValue:{valuePattern:"<%= gpsLaenge %>",operation:function(a){if(a!="0.0"){a=new Number(a);return M.I18N.l("longitude")+": "+a.toFixed(6)}else return""}}}),gpsLaengePosition:M.LabelView.design({cssClass:"normal unselectable",computedValue:{valuePattern:"<%= gpsLaengePosition %>",operation:function(a){if(a!=
"0.0"){a=new Number(a);return M.I18N.l("position")+"-"+M.I18N.l("longitude")+": "+a.toFixed(6)}else return""}}}),handauftragsBezeichnung:M.LabelView.design({cssClass:"normal unselectable",computedValue:{valuePattern:"<%= handauftragsBezeichnung %>",operation:function(a){return a!==""&&typeof a!=="undefined"&&a!=="undefined"?M.I18N.l("handApplications")+": "+a:""}}}),handauftragsId:M.LabelView.design({cssClass:"normal unselectable",computedValue:{valuePattern:"<%= handauftragsId %>",operation:function(a){return a}}}),
mitarbeiterId:M.LabelView.design({cssClass:"normal unselectable",computedValue:{valuePattern:"<%= mitarbeiterId %>",operation:function(a){return a}}}),name:M.LabelView.design({cssClass:"normal unselectable",computedValue:{valuePattern:"<%= name %>",operation:function(a){return a}}}),nameVorname:M.LabelView.design({cssClass:"normal unselectable",computedValue:{valuePattern:"<%= nameVorname %>",operation:function(a){return a}}}),positionsBezeichnung:M.LabelView.design({cssClass:"normal unselectable",
computedValue:{valuePattern:"<%= positionsBezeichnung %>",operation:function(a){return a!==""&&typeof a!=="undefined"&&a!=="undefined"?M.I18N.l("position")+": "+a:""}}}),positionsId:M.LabelView.design({cssClass:"normal unselectable",computedValue:{valuePattern:"<%= positionsId %>",operation:function(a){return a}}}),taetigkeit:M.LabelView.design({cssClass:"normal unselectable",computedValue:{valuePattern:"<%= taetigkeit %>",operation:function(a){return a!==""&&typeof a!=="undefined"&&a!=="undefined"?
M.I18N.l("activity")+": "+a:""}}}),taetigkeitsId:M.LabelView.design({cssClass:"normal unselectable",computedValue:{valuePattern:"<%= taetigkeitsId %>",operation:function(a){return a}}}),taetigkeitsart:M.LabelView.design({cssClass:"normal unselectable",computedValue:{valuePattern:"<%= taetigkeitsart %>",operation:function(a){return a}}}),von:M.LabelView.design({cssClass:"bold unselectable",isInline:YES,computedValue:{valuePattern:"<%= von %>",operation:function(a){return" "+a+" - "}}}),vorname:M.LabelView.design({cssClass:"normal unselectable",
computedValue:{valuePattern:"<%= vorname %>",operation:function(a){return a}}})});m_require("app/views/ZeitbuchungenTemplateView");m_require("app/views/VorZurueckTabBar.js");
DigiWebApp.ZeitbuchungenPage=M.PageView.design({events:{pageshow:{target:DigiWebApp.ZeitbuchungenController,action:"init"}},childViews:"header content tabBar",cssClass:"zeitbuchungenPage unselectable",header:M.ToolbarView.design({childViews:"backButton title",cssClass:"header unselectable",isFixed:YES,backButton:M.ButtonView.design({value:M.I18N.l("back"),icon:"arrow-l",anchorLocation:M.LEFT,events:{tap:{target:DigiWebApp.NavigationController,action:"backToAnwesenheitslistePageTransition"}}}),title:M.LabelView.design({value:M.I18N.l("Zeitbuchungen"),
anchorLocation:M.CENTER}),anchorLocation:M.TOP}),content:M.ScrollView.design({childViews:"list",list:M.ListView.design({contentBinding:{target:DigiWebApp.ZeitbuchungenController,property:"items"},listItemTemplateView:DigiWebApp.ZeitbuchungenTemplateView})}),tabBar:DigiWebApp.VorZurueckTabBar});
DigiWebApp.OrderInfoTemplateView=M.ListItemView.design({isSelectable:NO,hasSingleAction:NO,childViews:"orderName positionName spacer1 positionStrasseUndHausnummer positionPLZundORT positionLand positionTelefon positionFax positionEmail spacerNachEmail positionAnsprechpartner positionKundenname spacer3 positionBeschreibung spacer4 positionLongitude positionLatitude spacer5 showCoordinatesInMapButton saveAsContactButton showAddressInMapButton",orderName:M.LabelView.design({cssClass:"orderName",computedValue:{valuePattern:"<%= orderName %>",
operation:function(a){return a}}}),positionName:M.LabelView.design({cssClass:"positionName",computedValue:{valuePattern:"<%= positionName %>",operation:function(a){return a===""?M.I18N.l("position")+": "+M.I18N.l("noData"):M.I18N.l("position")+": "+a}}}),positionStrasseUndHausnummer:M.LabelView.design({cssClass:"positionName",computedValue:{valuePattern:"<%= positionStrasseUndHausnummer %>",operation:function(a){return a}}}),positionPLZundORT:M.LabelView.design({cssClass:"positionName",computedValue:{valuePattern:"<%= positionPLZundOrt %>",
operation:function(a){return a}}}),positionLand:M.LabelView.design({cssClass:"positionName",computedValue:{valuePattern:"<%= positionLand %>",operation:function(a){return a}}}),positionTelefon:M.LabelView.design({cssClass:"positionName",computedValue:{valuePattern:"<%= positionTelefon %>",operation:function(a){return a===""?"":M.I18N.l("phone")+": "+a}}}),positionFax:M.LabelView.design({cssClass:"positionName",computedValue:{valuePattern:"<%= positionFax %>",operation:function(a){return a===""?a:
M.I18N.l("fax")+": "+a}}}),positionEmail:M.LabelView.design({cssClass:"positionName",computedValue:{valuePattern:"<%= positionEmail %>",operation:function(a){return a===""?"":M.I18N.l("email")+": "+a}}}),spacerNachEmail:M.LabelView.design({value:" ",cssClass:"marginBottom12"}),positionAnsprechpartner:M.LabelView.design({cssClass:"positionName",computedValue:{valuePattern:"<%= positionAnsprechpartner %>",operation:function(a){return a===""?a:M.I18N.l("ansprechpartner")+": "+a}}}),positionKundenname:M.LabelView.design({cssClass:"positionName",
computedValue:{valuePattern:"<%= positionKundenname %>",operation:function(a){return a===""?a:M.I18N.l("kundenname")+": "+a}}}),positionLongitude:M.LabelView.design({cssClass:"positionName",computedValue:{valuePattern:"<%= positionLongitude %>",operation:function(a){return a==="0.0"?"":M.I18N.l("longitude")+": "+a}}}),positionLatitude:M.LabelView.design({cssClass:"positionName",computedValue:{valuePattern:"<%= positionLatitude %>",operation:function(a){return a==="0.0"?"":M.I18N.l("latitude")+": "+
a}}}),positionBeschreibung:M.LabelView.design({cssClass:"positionName",computedValue:{valuePattern:"<%= positionBeschreibung %>",operation:function(a){return a}}}),spacer1:M.LabelView.design({value:" ",cssClass:"marginBottom12"}),spacer2:M.LabelView.design({value:" ",cssClass:"marginBottom12"}),spacer3:M.LabelView.design({value:" ",cssClass:"marginBottom12"}),spacer4:M.LabelView.design({value:" ",cssClass:"marginBottom12"}),spacer5:M.LabelView.design({value:" ",cssClass:"marginBottom12"}),saveAsContactButton:M.ButtonView.design({value:M.I18N.l("saveAsContact"),
events:{tap:{target:DigiWebApp.OrderInfoController,action:"saveAsContact"}}}),showAddressInMapButton:M.ButtonView.design({value:M.I18N.l("showAddressInMap"),events:{tap:{action:function(a,b){try{b.preventDefault()}catch(c){}var d=DigiWebApp.OrderInfoController.items[0].positionCountryCode,f=DigiWebApp.OrderInfoController.items[0].positionPLZ,e=DigiWebApp.OrderInfoController.items[0].positionOrt,g=DigiWebApp.OrderInfoController.items[0].positionStrasse,k=DigiWebApp.OrderInfoController.items[0].positionHausnummer,
h="";switch(DigiWebApp.SettingsController.getSetting("mapType")){case "OSM":alert(M.I18N.l("showInMapOSMAlert"));h="http://nominatim.openstreetmap.org/search/"+d+"/"+e+"/"+g+"/"+k+"?format=html&polygon=1&addressdetails=0";break;case "Bing":alert(M.I18N.l("showInMapBingAlert"));h="http://www.bing.com/maps/default.aspx?rtp=~adr."+g+" "+k+" "+f+" "+e+" "+d;break;case "Google":alert(M.I18N.l("showInMapGoogleAlert"));h="http://maps.google.com/maps?q="+g+" "+k+" "+f+" "+e+" "+d+"&hl=de";break;default:h=
"disabled"}if(h!=="disabled")if(typeof plugins!=="undefined")if(typeof plugins.childBrowser!=="undefined"){try{plugins.childBrowser.close()}catch(l){alert("Error: "+l.message)}try{plugins.childBrowser.showWebPage(encodeURI(h),{showNavigationBar:true})}catch(m){alert("Error: "+m.message)}}else window.open(h,"childBrowser","width=800,height=600,menubar=no,status=no,location=no,copyhistory=no,directories=no");else window.open(h,"childBrowser","width=800,height=600,menubar=no,status=no,location=no,copyhistory=no,directories=no");
return false}}}}),showCoordinatesInMapButton:M.ButtonView.design({value:M.I18N.l("showCoordinatesInMap"),events:{tap:{action:function(){var a=DigiWebApp.OrderInfoController.items[0].positionLongitude,b=DigiWebApp.OrderInfoController.items[0].positionLatitude,c="";switch(DigiWebApp.SettingsController.getSetting("mapType")){case "OSM":alert(M.I18N.l("showInMapOSMAlert"));c="http://www.openstreetmap.org/index.html?mlat="+b+"&mlon="+a+"&zoom=15&layers=M";break;case "Bing":alert(M.I18N.l("showInMapBingAlert"));
c="http://www.bing.com/maps/default.aspx?rtp=adr.~pos."+b+"_"+a+"_&lvl=151";break;case "Google":alert(M.I18N.l("showInMapGoogleAlert"));c="http://maps.google.com/maps?q="+b+"+"+a+"&hl=de";break;default:c="disabled"}if(c!=="disabled")if(typeof plugins!=="undefined")if(typeof plugins.childBrowser!=="undefined"){try{plugins.childBrowser.close()}catch(d){alert("Error: "+d.message)}try{plugins.childBrowser.showWebPage(encodeURI(c),{showNavigationBar:true})}catch(f){alert("Error: "+f.message)}}else window.open(c,
"childBrowser","width=800,height=600,menubar=no,status=no,location=no,copyhistory=no,directories=no");else window.open(c,"childBrowser","width=800,height=600,menubar=no,status=no,location=no,copyhistory=no,directories=no")}}}})});m_require("app/views/OrderInfoTemplateView");
DigiWebApp.OrderInfoPage=M.PageView.design({events:{pagebeforeshow:{target:DigiWebApp.OrderInfoController,action:"init"}},childViews:"header selectionContent list",cssClass:"orderInfoPage",header:M.ToolbarView.design({childViews:"backButton title",cssClass:"header",isFixed:YES,backButton:M.ButtonView.design({value:M.I18N.l("back"),icon:"arrow-l",anchorLocation:M.LEFT,events:{tap:{target:DigiWebApp.NavigationController,action:"backToDashboardPage"}}}),title:M.LabelView.design({value:M.I18N.l("orderInfo"),
anchorLocation:M.CENTER}),anchorLocation:M.TOP}),selectionContent:M.ScrollView.design({childViews:"order position",order:M.SelectionListView.design({selectionMode:M.SINGLE_SELECTION_DIALOG,initialText:M.I18N.l("noData"),label:M.I18N.l("order"),applyTheme:NO,contentBinding:{target:DigiWebApp.OrderInfoController,property:"orders"},events:{change:{target:DigiWebApp.OrderInfoController,action:function(){var a=M.ViewManager.getView("orderInfoPage","order").getSelection(YES).value;if(a){var b=DigiWebApp.HandOrder.findSorted().concat(DigiWebApp.Order.findSorted());
_.each(b,function(c){c.get("id")===a&&DigiWebApp.OrderInfoController.set("activeOrder",[c])});DigiWebApp.OrderInfoController.setPositions()}DigiWebApp.OrderInfoController.setItem()}}}}),position:M.SelectionListView.design({selectionMode:M.SINGLE_SELECTION_DIALOG,initialText:M.I18N.l("noData"),label:M.I18N.l("position"),applyTheme:NO,contentBinding:{target:DigiWebApp.OrderInfoController,property:"positions"},events:{change:{target:DigiWebApp.OrderInfoController,action:function(){var a=M.ViewManager.getView("orderInfoPage",
"position").getSelection(YES).value;if(a){var b=DigiWebApp.Position.findSorted();_.each(b,function(c){c.get("id")===a&&DigiWebApp.OrderInfoController.set("activePosition",[c])})}DigiWebApp.OrderInfoController.setItem()}}}})}),list:M.ListView.design({contentBinding:{target:DigiWebApp.OrderInfoController,property:"items"},listItemTemplateView:DigiWebApp.OrderInfoTemplateView})});m_require("app/views/OrderInfoTemplateView");
DigiWebApp.OrderDetailsPage=M.PageView.design({events:{pageshow:{target:DigiWebApp.OrderDetailsController,action:"init"}},childViews:"header spacer list",cssClass:"orderInfoPage",header:M.ToolbarView.design({childViews:"backButton title",cssClass:"header",isFixed:YES,backButton:M.ButtonView.design({value:M.I18N.l("back"),icon:"arrow-l",anchorLocation:M.LEFT,events:{tap:{target:DigiWebApp.NavigationController,action:"backToZeitbuchungDetailsPageTransition"}}}),title:M.LabelView.design({value:M.I18N.l("orderInfo"),
anchorLocation:M.CENTER}),anchorLocation:M.TOP}),spacer:M.LabelView.design({value:" ",cssClass:"marginBottom12"}),list:M.ListView.design({contentBinding:{target:DigiWebApp.OrderDetailsController,property:"positionForDetails"},listItemTemplateView:DigiWebApp.OrderInfoTemplateView})});
DigiWebApp.MediaListTemplateView=M.ListItemView.design({isSelectable:YES,childViews:"icon timeStamp order position activity latitude longitude remark",events:{tap:{action:function(a){DigiWebApp.ApplicationController.DigiLoaderView.show(M.I18N.l("loadMediaFile"));var b=NO,c=M.ViewManager.getViewById(a).modelId;_.each(DigiWebApp.MediaListController.items,function(d){if(d.m_id===c){DigiWebApp.EditPicturePageController.set("myMediaFile",d);b=YES}});b===YES?DigiWebApp.NavigationController.toEditPicturePageTransition():
DigiWebApp.ApplicationController.DigiLoaderView.hide()}}},icon:M.ImageView.design({cssClass:"icon",computedValue:{valuePattern:"<%= icon %>",operation:function(a){return a?"theme/images/"+a:""}}}),timeStamp:M.LabelView.design({cssClass:"date",computedValue:{valuePattern:"<%= timeStamp %>",operation:function(a){a=M.Date.create(Number(a));return a.format("dd.mm.yyyy")+", "+a.format("HH:MM:ss")}}}),order:M.LabelView.design({cssClass:"application",computedValue:{valuePattern:"<%= orderId %>",operation:function(a){var b=
_.select(DigiWebApp.Order.findSorted().concat(DigiWebApp.HandOrder.findSorted()),function(c){if(c)return a==c.get("id")||a==c.get("name")});if(b&&b.length>0){b=b[0];return DigiWebApp.SettingsController.globalDebugMode?M.I18N.l("order")+": "+b.get("name")+" ("+b.get("id")+")":M.I18N.l("order")+": "+b.get("name")}else return M.I18N.l("order")+": "+M.I18N.l("notDefined")}}}),position:M.LabelView.design({cssClass:"position",computedValue:{valuePattern:"<%= positionId %>",operation:function(a){if(a){var b=
_.select(DigiWebApp.Position.findSorted(),function(c){if(c)return a==c.get("id")});if(b&&b.length>0){b=b[0];return M.I18N.l("position")+": "+b.get("name")}else return M.I18N.l("position")+": "+M.I18N.l("notDefined")}else return M.I18N.l("position")+": "+M.I18N.l("unknown")}}}),activity:M.LabelView.design({cssClass:"activity",computedValue:{valuePattern:"<%= activityId %>",operation:function(a){if(a){var b=_.select(DigiWebApp.Activity.findSorted(),function(c){if(c)return a==c.get("id")});if(b&&b.length>
0){b=b[0];return M.I18N.l("activity")+": "+b.get("name")}else return M.I18N.l("activity")+": "+M.I18N.l("notDefined")}else return M.I18N.l("activity")+": "+M.I18N.l("unknown")}}}),latitude:M.LabelView.design({cssClass:"location",computedValue:{valuePattern:"<%= latitude %>",operation:function(a){return a>0?M.I18N.l("latitude")+": "+a.toFixed(6):""}}}),longitude:M.LabelView.design({cssClass:"location",computedValue:{valuePattern:"<%= longitude %>",operation:function(a){return a>0?M.I18N.l("longitude")+
": "+a.toFixed(6):""}}}),remark:M.LabelView.design({cssClass:"remark unselectable",computedValue:{valuePattern:"<%= remark %>",operation:function(a){return a?M.I18N.l("remark")+": "+a:""}}})});
DigiWebApp.TimeDataTemplateView=M.ListItemView.design({isSelectable:YES,childViews:"date order position activity latitude longitude remark",events:{tap:{action:function(a,b){if(DigiWebApp.SettingsController.featureAvailable("403")||DigiWebApp.SettingsController.featureAvailable("405")&&typeof LocalFileSystem!=="undefined"&&typeof window.requestFileSystem!=="undefined"){_.each(DigiWebApp.Booking.find(),function(c){if(c.m_id===b)DigiWebApp.EditTimeDataPage.bookingToEdit=c});DigiWebApp.NavigationController.toEditTimeDataPage()}}}},
date:M.LabelView.design({cssClass:"date unselectable",computedValue:{valuePattern:"<%= date %>",operation:function(a){a=a.split(",");var b=M.Date.create(Number(a[0]));if(a=a[1]!=="0"?M.Date.create(Number(a[1])):null){b=M.Date.create(b.format("mm/dd/yyyy HH:MM"));a=M.Date.create(a.format("mm/dd/yyyy HH:MM"));if(b.format("mm/dd/yyyy HH:MM")===a.format("mm/dd/yyyy HH:MM"))return b.format("dd.mm.yyyy")+", "+b.format("HH:MM")+" - "+a.format("HH:MM")+" "+M.I18N.l("oclock")+", 00:01 h";else{var c=b.timeBetween(a,
M.MINUTES);c=c<1?M.Math.round(c,M.CEIL):M.Math.round(b.timeBetween(a,M.MINUTES),M.FLOOR);if(c>59){var d=M.Math.round(c/60,M.FLOOR);d=d<10?"0"+d:d;c=c%60;c=c<10?"0"+c:c;c=d+":"+c}else c="00:"+(c<10?"0":"")+c;return b.format("dd.mm.yyyy")+", "+b.format("HH:MM")+" - "+a.format("HH:MM")+" "+M.I18N.l("oclock")+", "+c+" h"}}else return b.format("dd.mm.yyyy")+", "+b.format("HH:MM")+" - "+M.I18N.l("open")}}}),order:M.LabelView.design({cssClass:"application unselectable",computedValue:{valuePattern:"<%= orderId %>",
operation:function(a){var b=_.select(DigiWebApp.Order.findSorted().concat(DigiWebApp.HandOrder.findSorted()),function(c){if(c)return a==c.get("id")||a==c.get("name")});if(b&&b.length>0){b=b[0];return DigiWebApp.SettingsController.globalDebugMode?M.I18N.l("order")+": "+b.get("name")+" ("+b.get("id")+")":M.I18N.l("order")+": "+b.get("name")}else return M.I18N.l("order")+": "+M.I18N.l("notDefined")}}}),position:M.LabelView.design({cssClass:"position unselectable",computedValue:{valuePattern:"<%= positionId %>",
operation:function(a){if(a){var b=_.select(DigiWebApp.Position.findSorted(),function(c){if(c)return a==c.get("id")});if(b&&b.length>0){b=b[0];return M.I18N.l("position")+": "+b.get("name")}else return M.I18N.l("position")+": "+M.I18N.l("notDefined")}else return M.I18N.l("position")+": "+M.I18N.l("unknown")}}}),activity:M.LabelView.design({cssClass:"activity unselectable",computedValue:{valuePattern:"<%= activityId %>",operation:function(a){if(a){var b=_.select(DigiWebApp.Activity.findSorted(),function(c){if(c)return a==
c.get("id")});if(b&&b.length>0){b=b[0];return M.I18N.l("activity")+": "+b.get("name")}else return M.I18N.l("activity")+": "+M.I18N.l("notDefined")}else return M.I18N.l("activity")+": "+M.I18N.l("unknown")}}}),latitude:M.LabelView.design({cssClass:"location unselectable",computedValue:{valuePattern:"<%= latitude %>",operation:function(a){if(a>0){a=new Number(a);return M.I18N.l("latitude")+": "+a.toFixed(6)}else return""}}}),longitude:M.LabelView.design({cssClass:"location unselectable",computedValue:{valuePattern:"<%= longitude %>",
operation:function(a){if(a>0){a=new Number(a);return M.I18N.l("longitude")+": "+a.toFixed(6)}else return""}}}),remark:M.LabelView.design({cssClass:"remark unselectable",computedValue:{valuePattern:"<%= remark %>",operation:function(a){return a?M.I18N.l("remark")+": "+a:""}}})});m_require("app/views/TimeDataTemplateView");m_require("app/views/TimeDataSentTemplateView");m_require("app/views/TimeDataSentDaysTemplateView");
DigiWebApp.TimeDataPage=M.PageView.design({events:{pagebeforeshow:{target:DigiWebApp.BookingController,action:"setNotBookedBookings"},pageshow:{action:function(){if(DigiWebApp.BookingController.timeData)DigiWebApp.BookingController.timeData.length!==0?$("#"+DigiWebApp.TimeDataPage.contentNotSent.id).show():$("#"+DigiWebApp.TimeDataPage.contentNotSent.id).hide();else $("#"+DigiWebApp.TimeDataPage.contentNotSent.id).hide();if(DigiWebApp.BookingController.timeDataSent)DigiWebApp.BookingController.timeDataSent.length!==
0?$("#"+DigiWebApp.TimeDataPage.contentSent.id).show():$("#"+DigiWebApp.TimeDataPage.contentSent.id).hide();else $("#"+DigiWebApp.TimeDataPage.contentSent.id).hide();if(DigiWebApp.BookingController.timeDataSentDays)DigiWebApp.BookingController.timeDataSentDays.length!==0?$("#"+DigiWebApp.TimeDataPage.contentDays.id).show():$("#"+DigiWebApp.TimeDataPage.contentDays.id).hide();else $("#"+DigiWebApp.TimeDataPage.contentDays.id).hide()}}},childViews:"header contentNotSent contentSent contentDays",cssClass:"timeDataPage unselectable",
header:M.ToolbarView.design({childViews:"backButton title",cssClass:"header unselectable",isFixed:YES,backButton:M.ButtonView.design({value:M.I18N.l("back"),icon:"arrow-l",anchorLocation:M.LEFT,events:{tap:{target:DigiWebApp.NavigationController,action:"backToDashboardPage"}}}),title:M.LabelView.design({value:M.I18N.l("timeData"),anchorLocation:M.CENTER}),anchorLocation:M.TOP}),contentNotSent:M.ScrollView.design({childViews:"list",list:M.ListView.design({contentBinding:{target:DigiWebApp.BookingController,
property:"timeData"},listItemTemplateView:DigiWebApp.TimeDataTemplateView})}),contentSent:M.ScrollView.design({childViews:"list",cssClass:"sentBookings",list:M.ListView.design({contentBinding:{target:DigiWebApp.BookingController,property:"timeDataSent"},listItemTemplateView:DigiWebApp.TimeDataSentTemplateView})}),contentDays:M.ScrollView.design({childViews:"list",cssClass:"sentBookings",list:M.ListView.design({contentBinding:{target:DigiWebApp.BookingController,property:"timeDataSentDays"},listItemTemplateView:DigiWebApp.TimeDataSentDaysTemplateView})})});
DigiWebApp.AudioPage=M.PageView.design({events:{pagebeforeshow:{target:DigiWebApp.AudioController,action:"init"}},childViews:"header content",cssClass:"audioPage",header:M.ToolbarView.design({childViews:"backButton title",cssClass:"header",isFixed:YES,backButton:M.ButtonView.design({value:M.I18N.l("back"),icon:"arrow-l",anchorLocation:M.LEFT,events:{tap:{target:DigiWebApp.NavigationController,action:"backToMediaListPageTransition"}}}),title:M.LabelView.design({value:M.I18N.l("settings"),anchorLocation:M.CENTER}),
anchorLocation:M.TOP}),content:M.ScrollView.design({childViews:"audioIcon grid",audioIcon:M.ImageView.design({value:"theme/images/icon_record.png",cssClass:"audioIcon",events:{tap:{target:DigiWebApp.AudioController,action:"recordAudio"}}}),recordIcon:M.ImageView.design({value:"theme/images/icon_record.png",cssClass:"mediaIcon",events:{tap:{action:DigiWebApp.AudioController.recordAudio}}}),recordIcon:M.ImageView.design({value:"theme/images/icon_record.png",cssClass:"mediaIcon",events:{tap:{action:DigiWebApp.AudioController.recordAudio}}}),
stopRecordIcon:M.ImageView.design({value:"theme/images/icon_stop.png",cssClass:"mediaIcon",events:{tap:{action:DigiWebApp.AudioController.stopRecord}}}),playIcon:M.ImageView.design({value:"theme/images/icon_playbackAudio.png",cssClass:"mediaIcon",events:{tap:{action:DigiWebApp.AudioController.playbackAudio}}}),stopIcon:M.ImageView.design({value:"theme/images/icon_stop.png",cssClass:"mediaIcon",events:{tap:{action:DigiWebApp.AudioController.stopPlayback}}}),grid:M.GridView.design({childViews:"button icon",
layout:{cssClass:"marginTop40 digiButton",columns:{0:"button",1:"icon"}},button:M.ButtonView.design({value:M.I18N.l("recordAudio"),cssClass:"digiButton",anchorLocation:M.RIGHT,events:{tap:{target:DigiWebApp.AudioController,action:"recordAudio"}}}),icon:M.ImageView.design({value:"theme/images/icon_bookTime.png"})})})});
DigiWebApp.SettingsPasswordPage=M.PageView.design({events:{pagebeforeshow:{action:function(){$("#"+DigiWebApp.SettingsPasswordPage.content.passwordGrid.passwordInput.id).val("")}}},childViews:"header content",cssClass:"settingsPasswordPage",header:M.ToolbarView.design({childViews:"backButton title",cssClass:"header",isFixed:YES,backButton:M.ButtonView.design({value:M.I18N.l("back"),icon:"arrow-l",anchorLocation:M.LEFT,events:{tap:{target:DigiWebApp.NavigationController,action:"backToDashboardPagePOP"}}}),
title:M.LabelView.design({value:M.I18N.l("password"),anchorLocation:M.CENTER}),anchorLocation:M.TOP}),content:M.ScrollView.design({childViews:"passwordGrid grid",passwordGrid:M.GridView.design({childViews:"passwordLabel passwordInput",layout:M.TWO_COLUMNS,passwordLabel:M.LabelView.design({value:M.I18N.l("password")}),passwordInput:M.TextFieldView.design({inputType:M.INPUT_PASSWORD})}),grid:M.GridView.design({childViews:"button icon",layout:{cssClass:"digiButton",columns:{0:"button",1:"icon"}},button:M.ButtonView.design({value:M.I18N.l("assume"),
cssClass:"digiButton",anchorLocation:M.RIGHT,events:{tap:{action:function(){$("#"+DigiWebApp.SettingsPasswordPage.content.passwordGrid.passwordInput.id).val()===DigiWebApp.SettingsController.getSetting("settingsPassword")?DigiWebApp.NavigationController.toSettingsPage():DigiWebApp.ApplicationController.nativeAlertDialogView({title:M.I18N.l("wrongPasswordTitle"),message:M.I18N.l("wrongPasswordMsg")})}}}}),icon:M.ImageView.design({value:"theme/images/icon_bookTime.png"})})})});
DigiWebApp.EmployeePage=M.PageView.design({childViews:"header content",events:{pagebeforeshow:{target:DigiWebApp.EmployeeController,action:"init"}},cssClass:"employeePage",header:M.ToolbarView.design({cssClass:"header",isFixed:YES,value:M.I18N.l("selectEmployee"),anchorLocation:M.TOP}),content:M.ScrollView.design({childViews:"employeeSelection buttonGrid",employeeSelection:M.SelectionListView.design({selectionMode:M.MULTIPLE_SELECTION,label:M.I18N.l("employees"),cssClass:"infoLabel",contentBinding:{target:DigiWebApp.EmployeeController,
property:"employees"}}),buttonGrid:M.GridView.design({childViews:"button icon",layout:{cssClass:"digiButton",columns:{0:"button",1:"icon"}},button:M.ButtonView.design({value:M.I18N.l("apply"),cssClass:"digiButton",anchorLocation:M.RIGHT,events:{tap:{target:DigiWebApp.EmployeeController,action:"saveEmployeeSelection"}}}),icon:M.ImageView.design({value:"theme/images/icon_bookTime.png"})})})});
DigiWebApp.MediaActionTemplateView=M.ListItemView.design({isSelectable:NO,childViews:"icon label",events:{tap:{target:DigiWebApp.MediaListController,action:"itemSelected"}},icon:M.ImageView.design({computedValue:{valuePattern:"<%= icon %>",operation:function(a){return"theme/images/"+a}}}),label:M.LabelView.design({valuePattern:"<%= label %>"})});m_require("app/views/MediaListTemplateView.js");m_require("app/views/MediaActionTemplateView.js");
DigiWebApp.MediaListPage=M.PageView.design({events:{pagebeforeshow:{target:DigiWebApp.MediaListController,action:"init"}},needsUpdate:true,childViews:"header actions mediafiles",cssClass:"mediaListPage unselectable",header:M.ToolbarView.design({childViews:"backButton title",cssClass:"header",isFixed:YES,backButton:M.ButtonView.design({value:M.I18N.l("back"),icon:"arrow-l",anchorLocation:M.LEFT,events:{tap:{target:DigiWebApp.NavigationController,action:"backToDashboardPage"}}}),title:M.LabelView.design({value:M.I18N.l("mediaList"),
anchorLocation:M.CENTER}),anchorLocation:M.TOP}),mediafiles:M.ScrollView.design({childViews:"mediafileslist",cssClass:"mediafilesList",mediafileslist:M.ListView.design({contentBinding:{target:DigiWebApp.MediaListController,property:"items"},listItemTemplateView:DigiWebApp.MediaListTemplateView})}),actions:M.ScrollView.design({childViews:"actionslist",cssClass:"actionsList",actionslist:M.ListView.design({contentBinding:{target:DigiWebApp.MediaListController,property:"actions"},listItemTemplateView:DigiWebApp.MediaActionTemplateView})})});
DigiWebApp.DemoMediaPageTemplateView=M.ListItemView.design({isSelectable:NO,childViews:"icon label",events:{tap:{target:DigiWebApp.DemoMediaPageController,action:"itemSelected"}},icon:M.ImageView.design({computedValue:{valuePattern:"<%= icon %>",operation:function(a){return"theme/images/"+a}}}),label:M.LabelView.design({valuePattern:"<%= label %>"})});m_require("app/views/DemoMediaPageTemplateView.js");
DigiWebApp.DemoMediaPage=M.PageView.design({childViews:"header content",cssClass:"demoMediaPage",events:{pagebeforeshow:{target:DigiWebApp.DemoMediaPageController,action:"init"}},needsUpdate:true,header:M.ToolbarView.design({childViews:"backButton title",cssClass:"header",isFixed:YES,backButton:M.ButtonView.design({value:M.I18N.l("back"),icon:"arrow-l",anchorLocation:M.LEFT,events:{tap:{target:DigiWebApp.NavigationController,action:"backToDashboardPage"}}}),title:M.LabelView.design({value:M.I18N.l("info"),
anchorLocation:M.CENTER}),anchorLocation:M.TOP}),content:M.ScrollView.design({childViews:"list",list:M.ListView.design({contentBinding:{target:DigiWebApp.DemoMediaPageController,property:"items"},listItemTemplateView:DigiWebApp.DemoMediaPageTemplateView})})});if(window.console){if(window.console.logLevel)window.console.logLevel=3}else window.console={log:function(){}};window.newAppVersionAvailable=NO;M.Application.useTransitions=NO;var DigiWebApp=DigiWebApp||{};
function trackError(a){var b="";b=typeof(a.message==="undefined")?b+"'"+a+"'":b+"'"+a.message+"'";if(typeof a.stack!=="undefined")b=b+"\n"+a.stack.split("\n")[1];else if(typeof a.lineNumber!=="undefined")b=b+" at "+a.lineNumber;else if(typeof a.line!=="undefined")b=b+" at "+a.line;b+="\n\nBitte melden Sie dies bei DIGI-Zeiterfassung GmbH, damit dieser Fehler behoben werden kann.\n\nHerzlichen Dank!";alert(b);console.log(a);typeof a.stack!=="undefined"&&console.log(a.stack);return true}
window.onerror=function(a,b,c){trackError("Error: "+a+"\nURL: "+b+"\nLine Number: "+c);return true};
if(typeof localStorage!=="undefined"){var reloadAppOneMoreTime=localStorage.getItem("reloadAppOneMoreTime");if(reloadAppOneMoreTime!==null){localStorage.removeItem("reloadAppOneMoreTime");window.applicationCache&&window.applicationCache.status==window.applicationCache.UPDATEREADY&&window.applicationCache.swapCache();if(typeof navigator.app!=="undefined")typeof location.origin!=="undefined"?navigator.app.loadUrl(location.origin+location.pathname):navigator.app.loadUrl(location.protocol+"//"+location.pathname);
else window.location.reload()}}
$(window).bind("load",function(){window.applicationCache&&$(window.applicationCache).bind("updateready",function(){if(window.applicationCache.status==window.applicationCache.UPDATEREADY){console.log("Browser downloaded a new app cache");window.newAppVersionAvailable=YES;if(confirm(M.I18N.l("applicationUpdateAvailableMsg"))){window.applicationCache.swapCache();typeof localStorage!=="undefined"&&localStorage.setItem("reloadAppOneMoreTime","true");if(typeof navigator.app!=="undefined")typeof location.origin!==
"undefined"?navigator.app.loadUrl(location.origin+location.pathname):navigator.app.loadUrl(location.protocol+"//"+location.pathname);else window.location.reload()}else{DigiWebApp.NavigationController.toSplashViewPageTransition();DigiWebApp.NavigationController.toDashboardPage()}}})});
function searchForFeature(a){for(var b=0;b<localStorage.length;b++){var c=localStorage.key(b);if(regexResult=RegExp("^"+M.LOCAL_STORAGE_PREFIX+M.Application.name+M.LOCAL_STORAGE_SUFFIX+"Features_").exec(c)){c=JSON.parse(localStorage.getItem(c));if(a.toString()===c.id.toString())return c.isAvailable.toString()==="true"}}return false}DigiWebAppBlackBerryDesign={entryPage:"splashView",splashView:DigiWebApp.SplashViewPage};
DigiWebAppOrdinaryDesign={entryPage:"splashView",splashView:DigiWebApp.SplashViewPage,dashboard:DigiWebApp.DashboardPage,bookingPage:DigiWebApp.BookingPage,settingsPage:DigiWebApp.SettingsPage,settingsPasswordPage:DigiWebApp.SettingsPasswordPage,timeDataPage:DigiWebApp.TimeDataPage,employeePage:DigiWebApp.EmployeePage,infoPage:DigiWebApp.InfoPage};
if(searchForFeature(400)){DigiWebAppOrdinaryDesign.mediaListPage=DigiWebApp.MediaListPage;DigiWebAppOrdinaryDesign.cameraPage=DigiWebApp.CameraPage;DigiWebAppOrdinaryDesign.editPicturePage=DigiWebApp.EditPicturePage}if(searchForFeature(401)){DigiWebAppOrdinaryDesign.mediaListPage=DigiWebApp.MediaListPage;DigiWebAppOrdinaryDesign.audioPage=DigiWebApp.AudioPage;DigiWebAppOrdinaryDesign.demoaudioPage=DigiWebApp.DemoAudioPage;DigiWebAppOrdinaryDesign.demomediaPage=DigiWebApp.DemoMediaPage}searchForFeature(402);
if(searchForFeature(403)&&!searchForFeature(409)){DigiWebAppOrdinaryDesign.editTimeDataPage=DigiWebApp.EditTimeDataPage;DigiWebAppOrdinaryDesign.remarkPage=DigiWebApp.RemarkPage}searchForFeature(404);if(searchForFeature(405)&&!searchForFeature(409))DigiWebAppOrdinaryDesign.editTimeDataPage=DigiWebApp.EditTimeDataPage;if(searchForFeature(406)&&!searchForFeature(409))DigiWebAppOrdinaryDesign.orderInfoPage=DigiWebApp.OrderInfoPage;searchForFeature(407);
if(searchForFeature(408)){DigiWebAppOrdinaryDesign.anwesenheitslistePage=DigiWebApp.AnwesenheitslistePage;DigiWebAppOrdinaryDesign.zeitbuchungenPage=DigiWebApp.ZeitbuchungenPage;DigiWebAppOrdinaryDesign.zeitbuchungDetailsPage=DigiWebApp.ZeitbuchungDetailsPage;DigiWebAppOrdinaryDesign.orderDetailsPage=DigiWebApp.OrderDetailsPage}if(searchForFeature(409)){try{delete DigiWebAppOrdinaryDesign.bookingPage}catch(e$$130){}try{delete DigiWebAppOrdinaryDesign.timeDataPage}catch(e$$131){}try{delete DigiWebAppOrdinaryDesign.employeePage}catch(e$$132){}try{delete DigiWebAppOrdinaryDesign.handOrderPage}catch(e$$133){}}
if(!searchForFeature(410)&&!searchForFeature(409))DigiWebAppOrdinaryDesign.handOrderPage=DigiWebApp.HandOrderPage;if(searchForFeature(411)&&!searchForFeature(409))DigiWebAppOrdinaryDesign.timeDataArchivePage=DigiWebApp.TimeDataArchivePage;searchForFeature(412);var restartOnBlackBerry=true;
if(navigator.platform==="BlackBerry"&&restartOnBlackBerry)if(navigator.appVersion.indexOf("Version/")!==-1){var bb_version=Number(navigator.appVersion.substr(navigator.appVersion.indexOf("Version/")+8,1));if(bb_version>6)restartOnBlackBerry=false}DigiWebApp.app=navigator.platform==="BlackBerry"&&restartOnBlackBerry?M.Application.design(DigiWebAppBlackBerryDesign):M.Application.design(DigiWebAppOrdinaryDesign);
